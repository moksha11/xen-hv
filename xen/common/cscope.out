cscope 15 /home/sudarsun/xen-hv/xen/common               0001260896
	@bitmap.c

8 
	~<x’/cÚfig.h
>

9 
	~<x’/ty³s.h
>

10 
	~<x’/”ºo.h
>

11 
	~<x’/b™m­.h
>

12 
	~<x’/b™İs.h
>

13 
	~<asm/by‹Üd”.h
>

41 
	$__b™m­_em±y
(cÚ¡ *
b™m­
, 
b™s
)

43 
k
, 
lim
 = 
b™s
/
BITS_PER_LONG
;

44 
k
 = 0; k < 
lim
; ++k)

45 ià(
b™m­
[
k
])

48 ià(
b™s
 % 
BITS_PER_LONG
)

49 ià(
b™m­
[
k
] & 
	`BITMAP_LAST_WORD_MASK
(
b™s
))

53 
	}
}

54 
EXPORT_SYMBOL
(
__b™m­_em±y
);

56 
	$__b™m­_fuÎ
(cÚ¡ *
b™m­
, 
b™s
)

58 
k
, 
lim
 = 
b™s
/
BITS_PER_LONG
;

59 
k
 = 0; k < 
lim
; ++k)

60 ià(~
b™m­
[
k
])

63 ià(
b™s
 % 
BITS_PER_LONG
)

64 ià(~
b™m­
[
k
] & 
	`BITMAP_LAST_WORD_MASK
(
b™s
))

68 
	}
}

69 
EXPORT_SYMBOL
(
__b™m­_fuÎ
);

71 
	$__b™m­_equ®
(cÚ¡ *
b™m­1
,

72 cÚ¡ *
b™m­2
, 
b™s
)

74 
k
, 
lim
 = 
b™s
/
BITS_PER_LONG
;

75 
k
 = 0; k < 
lim
; ++k)

76 ià(
b™m­1
[
k
] !ğ
b™m­2
[k])

79 ià(
b™s
 % 
BITS_PER_LONG
)

80 ià((
b™m­1
[
k
] ^ 
b™m­2
[k]è& 
	`BITMAP_LAST_WORD_MASK
(
b™s
))

84 
	}
}

85 
EXPORT_SYMBOL
(
__b™m­_equ®
);

87 
	$__b™m­_com¶em’t
(*
d¡
, cÚ¡ *
¤c
, 
b™s
)

89 
k
, 
lim
 = 
b™s
/
BITS_PER_LONG
;

90 
k
 = 0; k < 
lim
; ++k)

91 
d¡
[
k
] = ~
¤c
[k];

93 ià(
b™s
 % 
BITS_PER_LONG
)

94 
d¡
[
k
] = ~
¤c
[k] & 
	`BITMAP_LAST_WORD_MASK
(
b™s
);

95 
	}
}

96 
EXPORT_SYMBOL
(
__b™m­_com¶em’t
);

109 
	$__b™m­_shiá_right
(*
d¡
,

110 cÚ¡ *
¤c
, 
shiá
, 
b™s
)

112 
k
, 
lim
 = 
	`BITS_TO_LONGS
(
b™s
), 
Ëá
 = b™ % 
BITS_PER_LONG
;

113 
off
 = 
shiá
/
BITS_PER_LONG
, 
»m
 = shift % BITS_PER_LONG;

114 
mask
 = (1UL << 
Ëá
) - 1;

115 
k
 = 0; 
off
 + k < 
lim
; ++k) {

116 
uµ”
, 
low”
;

122 ià(!
»m
 || 
off
 + 
k
 + 1 >ğ
lim
)

123 
uµ”
 = 0;

125 
uµ”
 = 
¤c
[
off
 + 
k
 + 1];

126 ià(
off
 + 
k
 + 1 =ğ
lim
 - 1 && 
Ëá
)

127 
uµ”
 &ğ
mask
;

129 
low”
 = 
¤c
[
off
 + 
k
];

130 ià(
Ëá
 && 
off
 + 
k
 =ğ
lim
 - 1)

131 
low”
 &ğ
mask
;

132 
d¡
[
k
] = 
uµ”
 << (
BITS_PER_LONG
 - 
»m
è| 
low”
 >>„em;

133 ià(
Ëá
 && 
k
 =ğ
lim
 - 1)

134 
d¡
[
k
] &ğ
mask
;

136 ià(
off
)

137 
	`mem£t
(&
d¡
[
lim
 - 
off
], 0, off*());

138 
	}
}

139 
EXPORT_SYMBOL
(
__b™m­_shiá_right
);

154 
	$__b™m­_shiá_Ëá
(*
d¡
,

155 cÚ¡ *
¤c
, 
shiá
, 
b™s
)

157 
k
, 
lim
 = 
	`BITS_TO_LONGS
(
b™s
), 
Ëá
 = b™ % 
BITS_PER_LONG
;

158 
off
 = 
shiá
/
BITS_PER_LONG
, 
»m
 = shift % BITS_PER_LONG;

159 
k
 = 
lim
 - 
off
 - 1; k >= 0; --k) {

160 
uµ”
, 
low”
;

166 ià(
»m
 && 
k
 > 0)

167 
low”
 = 
¤c
[
k
 - 1];

169 
low”
 = 0;

170 
uµ”
 = 
¤c
[
k
];

171 ià(
Ëá
 && 
k
 =ğ
lim
 - 1)

172 
uµ”
 &ğ(1UL << 
Ëá
) - 1;

173 
d¡
[
k
 + 
off
] = 
low”
 >> (
BITS_PER_LONG
 - 
»m
è| 
uµ”
 <<„em;

174 ià(
Ëá
 && 
k
 + 
off
 =ğ
lim
 - 1)

175 
d¡
[
k
 + 
off
] &ğ(1UL << 
Ëá
) - 1;

177 ià(
off
)

178 
	`mem£t
(
d¡
, 0, 
off
*());

179 
	}
}

180 
EXPORT_SYMBOL
(
__b™m­_shiá_Ëá
);

182 
	$__b™m­_ªd
(*
d¡
, cÚ¡ *
b™m­1
,

183 cÚ¡ *
b™m­2
, 
b™s
)

185 
k
;

186 
Ä
 = 
	`BITS_TO_LONGS
(
b™s
);

188 
k
 = 0; k < 
Ä
; k++)

189 
d¡
[
k
] = 
b™m­1
[k] & 
b™m­2
[k];

190 
	}
}

191 
EXPORT_SYMBOL
(
__b™m­_ªd
);

193 
	$__b™m­_Ü
(*
d¡
, cÚ¡ *
b™m­1
,

194 cÚ¡ *
b™m­2
, 
b™s
)

196 
k
;

197 
Ä
 = 
	`BITS_TO_LONGS
(
b™s
);

199 
k
 = 0; k < 
Ä
; k++)

200 
d¡
[
k
] = 
b™m­1
[k] | 
b™m­2
[k];

201 
	}
}

202 
EXPORT_SYMBOL
(
__b™m­_Ü
);

204 
	$__b™m­_xÜ
(*
d¡
, cÚ¡ *
b™m­1
,

205 cÚ¡ *
b™m­2
, 
b™s
)

207 
k
;

208 
Ä
 = 
	`BITS_TO_LONGS
(
b™s
);

210 
k
 = 0; k < 
Ä
; k++)

211 
d¡
[
k
] = 
b™m­1
[k] ^ 
b™m­2
[k];

212 
	}
}

213 
EXPORT_SYMBOL
(
__b™m­_xÜ
);

215 
	$__b™m­_ªdnÙ
(*
d¡
, cÚ¡ *
b™m­1
,

216 cÚ¡ *
b™m­2
, 
b™s
)

218 
k
;

219 
Ä
 = 
	`BITS_TO_LONGS
(
b™s
);

221 
k
 = 0; k < 
Ä
; k++)

222 
d¡
[
k
] = 
b™m­1
[k] & ~
b™m­2
[k];

223 
	}
}

224 
EXPORT_SYMBOL
(
__b™m­_ªdnÙ
);

226 
	$__b™m­_š‹r£ùs
(cÚ¡ *
b™m­1
,

227 cÚ¡ *
b™m­2
, 
b™s
)

229 
k
, 
lim
 = 
b™s
/
BITS_PER_LONG
;

230 
k
 = 0; k < 
lim
; ++k)

231 ià(
b™m­1
[
k
] & 
b™m­2
[k])

234 ià(
b™s
 % 
BITS_PER_LONG
)

235 ià((
b™m­1
[
k
] & 
b™m­2
[k]è& 
	`BITMAP_LAST_WORD_MASK
(
b™s
))

238 
	}
}

239 
EXPORT_SYMBOL
(
__b™m­_š‹r£ùs
);

241 
	$__b™m­_sub£t
(cÚ¡ *
b™m­1
,

242 cÚ¡ *
b™m­2
, 
b™s
)

244 
k
, 
lim
 = 
b™s
/
BITS_PER_LONG
;

245 
k
 = 0; k < 
lim
; ++k)

246 ià(
b™m­1
[
k
] & ~
b™m­2
[k])

249 ià(
b™s
 % 
BITS_PER_LONG
)

250 ià((
b™m­1
[
k
] & ~
b™m­2
[k]è& 
	`BITMAP_LAST_WORD_MASK
(
b™s
))

253 
	}
}

254 
EXPORT_SYMBOL
(
__b™m­_sub£t
);

256 #ià
BITS_PER_LONG
 == 32

257 
	$__b™m­_weight
(cÚ¡ *
b™m­
, 
b™s
)

259 
k
, 
w
 = 0, 
lim
 = 
b™s
/
BITS_PER_LONG
;

261 
k
 = 0; k < 
lim
; k++)

262 
w
 +ğ
	`hweight32
(
b™m­
[
k
]);

264 ià(
b™s
 % 
BITS_PER_LONG
)

265 
w
 +ğ
	`hweight32
(
b™m­
[
k
] & 
	`BITMAP_LAST_WORD_MASK
(
b™s
));

267  
w
;

268 
	}
}

270 
	$__b™m­_weight
(cÚ¡ *
b™m­
, 
b™s
)

272 
k
, 
w
 = 0, 
lim
 = 
b™s
/
BITS_PER_LONG
;

274 
k
 = 0; k < 
lim
; k++)

275 
w
 +ğ
	`hweight64
(
b™m­
[
k
]);

277 ià(
b™s
 % 
BITS_PER_LONG
)

278 
w
 +ğ
	`hweight64
(
b™m­
[
k
] & 
	`BITMAP_LAST_WORD_MASK
(
b™s
));

280  
w
;

281 
	}
}

283 
EXPORT_SYMBOL
(
__b™m­_weight
);

290 
	#CHUNKSZ
 32

	)

291 
	#nb™s_to_hŞd_v®ue
(
v®
è
	`æs
(v®)

	)

292 
	#roundup_pow”2
(
v®
,
modulus
è(((v®è+ (modulusè- 1è& ~((modulusè- 1))

	)

293 
	#unhex
(
c
è(
	`isdig™
(cè? (ø- '0'è: (
	`touµ”
(cè- 'A' + 10))

	)

294 
	#BASEDEC
 10

	)

306 
	$b™m­_sú´štf
(*
buf
, 
buæ’
,

307 cÚ¡ *
maskp
, 
nmaskb™s
)

309 
i
, 
wÜd
, 
b™
, 
Ën
 = 0;

310 
v®
;

311 cÚ¡ *
£p
 = "";

312 
chunksz
;

313 
u32
 
chunkmask
;

315 
chunksz
 = 
nmaskb™s
 & (
CHUNKSZ
 - 1);

316 ià(
chunksz
 == 0)

317 
chunksz
 = 
CHUNKSZ
;

319 
i
 = 
	`roundup_pow”2
(
nmaskb™s
, 
CHUNKSZ
) - CHUNKSZ;

320 ; 
i
 >ğ0; i -ğ
CHUNKSZ
) {

321 
chunkmask
 = ((1ULL << 
chunksz
) - 1);

322 
wÜd
 = 
i
 / 
BITS_PER_LONG
;

323 
b™
 = 
i
 % 
BITS_PER_LONG
;

324 
v®
 = (
maskp
[
wÜd
] >> 
b™
è& 
chunkmask
;

325 
Ën
 +ğ
	`sú´štf
(
buf
+Ën, 
buæ’
-Ën, "%s%0*lx", 
£p
,

326 (
chunksz
+3)/4, 
v®
);

327 
chunksz
 = 
CHUNKSZ
;

328 
£p
 = ",";

330  
Ën
;

331 
	}
}

332 
EXPORT_SYMBOL
(
b™m­_sú´štf
);

342 
šlše
 
	$bsúl_em™
(*
buf
, 
buæ’
, 
rbÙ
, 
¹İ
, 
Ën
)

344 ià(
Ën
 > 0)

345 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†en, ",");

346 ià(
rbÙ
 =ğ
¹İ
)

347 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†’, "%d", 
rbÙ
);

349 
Ën
 +ğ
	`sú´štf
(
buf
 +†’, 
buæ’
 -†’, "%d-%d", 
rbÙ
, 
¹İ
);

350  
Ën
;

351 
	}
}

370 
	$b™m­_súli¡´štf
(*
buf
, 
buæ’
,

371 cÚ¡ *
maskp
, 
nmaskb™s
)

373 
Ën
 = 0;

375 
cur
, 
rbÙ
, 
¹İ
;

377 
rbÙ
 = 
cur
 = 
	`fšd_fœ¡_b™
(
maskp
, 
nmaskb™s
);

378 
cur
 < 
nmaskb™s
) {

379 
¹İ
 = 
cur
;

380 
cur
 = 
	`fšd_Ãxt_b™
(
maskp
, 
nmaskb™s
, cur+1);

381 ià(
cur
 >ğ
nmaskb™s
 || cu¸> 
¹İ
 + 1) {

382 
Ën
 = 
	`bsúl_em™
(
buf
, 
buæ’
, 
rbÙ
, 
¹İ
,†en);

383 
rbÙ
 = 
cur
;

386  
Ën
;

387 
	}
}

388 
EXPORT_SYMBOL
(
b™m­_súli¡´štf
);

405 
	$b™m­_fšd_ä“_»giÚ
(*
b™m­
, 
b™s
, 
Üd”
)

407 
mask
;

408 
·ges
 = 1 << 
Üd”
;

409 
i
;

411 if(
·ges
 > 
BITS_PER_LONG
)

412  -
EINVAL
;

415 
mask
 = (1uÈ<< (
·ges
 - 1));

416 
mask
 += mask - 1;

419 
i
 = 0; i < 
b™s
; i +ğ
·ges
) {

420 
šdex
 = 
i
/
BITS_PER_LONG
;

421 
off£t
 = 
i
 - (
šdex
 * 
BITS_PER_LONG
);

422 if((
b™m­
[
šdex
] & (
mask
 << 
off£t
)) == 0) {

424 
b™m­
[
šdex
] |ğ(
mask
 << 
off£t
);

425  
i
;

428  -
ENOMEM
;

429 
	}
}

430 
EXPORT_SYMBOL
(
b™m­_fšd_ä“_»giÚ
);

441 
	$b™m­_»Ëa£_»giÚ
(*
b™m­
, 
pos
, 
Üd”
)

443 
·ges
 = 1 << 
Üd”
;

444 
mask
 = (1uÈ<< (
·ges
 - 1));

445 
šdex
 = 
pos
/
BITS_PER_LONG
;

446 
off£t
 = 
pos
 - (
šdex
 * 
BITS_PER_LONG
);

447 
mask
 += mask - 1;

448 
b™m­
[
šdex
] &ğ~(
mask
 << 
off£t
);

449 
	}
}

450 
EXPORT_SYMBOL
(
b™m­_»Ëa£_»giÚ
);

452 
	$b™m­_®loÿ‹_»giÚ
(*
b™m­
, 
pos
, 
Üd”
)

454 
·ges
 = 1 << 
Üd”
;

455 
mask
 = (1uÈ<< (
·ges
 - 1));

456 
šdex
 = 
pos
/
BITS_PER_LONG
;

457 
off£t
 = 
pos
 - (
šdex
 * 
BITS_PER_LONG
);

463 
	`BUG_ON
(
·ges
 > 
BITS_PER_LONG
);

464 
mask
 += mask - 1;

465 ià(
b™m­
[
šdex
] & (
mask
 << 
off£t
))

466  -
EBUSY
;

467 
b™m­
[
šdex
] |ğ(
mask
 << 
off£t
);

469 
	}
}

470 
EXPORT_SYMBOL
(
b™m­_®loÿ‹_»giÚ
);

472 #ifdeà
__BIG_ENDIAN


474 
	$b™m­_lÚg_to_by‹
(
ušt8_t
 *
bp
, cÚ¡ *
Í
, 
nb™s
)

476 
l
;

477 
i
, 
j
, 
b
;

479 
i
 = 0, 
b
 = 0; 
nb™s
 > 0; i++, b +ğ(
l
)) {

480 
l
 = 
Í
[
i
];

481 
j
 = 0; (j < (
l
)è&& (
nb™s
 > 0); j++) {

482 
bp
[
b
+
j
] = 
l
;

483 
l
 >>= 8;

484 
nb™s
 -= 8;

487 
	}
}

489 
	$b™m­_by‹_to_lÚg
(*
Í
, cÚ¡ 
ušt8_t
 *
bp
, 
nb™s
)

491 
l
;

492 
i
, 
j
, 
b
;

494 
i
 = 0, 
b
 = 0; 
nb™s
 > 0; i++, b +ğ(
l
)) {

495 
l
 = 0;

496 
j
 = 0; (j < (
l
)è&& (
nb™s
 > 0); j++) {

497 
l
 |ğ()
bp
[
b
+
j
] << (j*8);

498 
nb™s
 -= 8;

500 
Í
[
i
] = 
l
;

502 
	}
}

504 #–ià
defšed
(
__LITTLE_ENDIAN
)

506 
	$b™m­_lÚg_to_by‹
(
ušt8_t
 *
bp
, cÚ¡ *
Í
, 
nb™s
)

508 
	`memıy
(
bp
, 
Í
, (
nb™s
+7)/8);

509 
	}
}

511 
	$b™m­_by‹_to_lÚg
(*
Í
, cÚ¡ 
ušt8_t
 *
bp
, 
nb™s
)

514 ià(
nb™s
 & (
BITS_PER_LONG
-1))

515 
Í
[
	`BITS_TO_LONGS
(
nb™s
)-1] = 0;

516 
	`memıy
(
Í
, 
bp
, (
nb™s
+7)/8);

517 
	}
}

	@bunzip2.c

47 
	~"decom´ess.h
"

49 #iâdeà
INT_MAX


50 
	#INT_MAX
 0x7fffffff

	)

54 
	#MAX_GROUPS
 6

	)

55 
	#GROUP_SIZE
 50

	)

56 
	#MAX_HUFCODE_BITS
 20

	)

57 
	#MAX_SYMBOLS
 258

	)

58 
	#SYMBOL_RUNA
 0

	)

59 
	#SYMBOL_RUNB
 1

	)

62 
	#RETVAL_OK
 0

	)

63 
	#RETVAL_LAST_BLOCK
 (-1)

	)

64 
	#RETVAL_NOT_BZIP_DATA
 (-2)

	)

65 
	#RETVAL_UNEXPECTED_INPUT_EOF
 (-3)

	)

66 
	#RETVAL_UNEXPECTED_OUTPUT_EOF
 (-4)

	)

67 
	#RETVAL_DATA_ERROR
 (-5)

	)

68 
	#RETVAL_OUT_OF_MEMORY
 (-6)

	)

69 
	#RETVAL_OBSOLETE_INPUT
 (-7)

	)

72 
	#BZIP2_IOBUF_SIZE
 4096

	)

75 
	sgroup_d©a
 {

77 
	mlim™
[
MAX_HUFCODE_BITS
+1];

78 
	mba£
[
MAX_HUFCODE_BITS
];

79 
	m³rmu‹
[
MAX_SYMBOLS
];

80 
	mmšL’
, 
	mmaxL’
;

85 
	sbunz_d©a
 {

87 
	mwr™eCİ›s
, 
	mwr™ePos
, 
	mwr™eRunCouÁdown
, 
	mwr™eCouÁ
, 
	mwr™eCu¼’t
;

89 (*
	mfl
)(*, );

90 
	mšbufCouÁ
, 
	mšbufPos
 ;

91 *
	mšbuf
 ;

92 
	mšbufB™CouÁ
, 
	mšbufB™s
;

95 
	müc32TabË
[256], 
	mh—d”CRC
, 
	mtÙ®CRC
, 
	mwr™eCRC
;

97 *
	mdbuf
, 
	mdbufSize
;

99 
	m£ËùÜs
[32768];

100 
group_d©a
 
	mgroups
[
MAX_GROUPS
];

101 
	mio_”rÜ
;

107 
INIT
 
	$g‘_b™s
(
bunz_d©a
 *
bd
, 
b™s_wª‹d
)

109 
b™s
 = 0;

114 
bd
->
šbufB™CouÁ
 < 
b™s_wª‹d
) {

117 ià(
bd
->
šbufPos
 =ğbd->
šbufCouÁ
) {

118 ià(
bd
->
io_”rÜ
)

120 
bd
->
šbufCouÁ
 = bd->
	`fl
(bd->
šbuf
, 
BZIP2_IOBUF_SIZE
);

121 ià(
bd
->
šbufCouÁ
 <= 0) {

122 
bd
->
io_”rÜ
 = 
RETVAL_UNEXPECTED_INPUT_EOF
;

125 
bd
->
šbufPos
 = 0;

128 ià(
bd
->
šbufB™CouÁ
 >= 24) {

129 
b™s
 = 
bd
->
šbufB™s
&((1 << bd->
šbufB™CouÁ
)-1);

130 
b™s_wª‹d
 -ğ
bd
->
šbufB™CouÁ
;

131 
b™s
 <<ğ
b™s_wª‹d
;

132 
bd
->
šbufB™CouÁ
 = 0;

135 
bd
->
šbufB™s
 = (bd->šbufB™ << 8)|bd->
šbuf
[bd->
šbufPos
++];

136 
bd
->
šbufB™CouÁ
 += 8;

139 
bd
->
šbufB™CouÁ
 -ğ
b™s_wª‹d
;

140 
b™s
 |ğ(
bd
->
šbufB™s
 >> bd->
šbufB™CouÁ
)&((1 << 
b™s_wª‹d
)-1);

142  
b™s
;

143 
	}
}

147 
INIT
 
	$g‘_Ãxt_block
(
bunz_d©a
 *
bd
)

149 
group_d©a
 *
hufGroup
 = 
NULL
;

150 *
ba£
 = 
NULL
;

151 *
lim™
 = 
NULL
;

152 
dbufCouÁ
, 
ÃxtSym
, 
dbufSize
, 
groupCouÁ
, 
£ËùÜ
,

153 
i
, 
j
, 
k
, 
t
, 
runPos
, 
symCouÁ
, 
symTÙ®
, 
nS–eùÜs
,

154 
by‹CouÁ
[256];

155 
uc
, 
symToBy‹
[256], 
mtfSymbŞ
[256], *
£ËùÜs
;

156 *
dbuf
, 
ÜigPŒ
;

158 
dbuf
 = 
bd
->dbuf;

159 
dbufSize
 = 
bd
->dbufSize;

160 
£ËùÜs
 = 
bd
->selectors;

164 
i
 = 
	`g‘_b™s
(
bd
, 24);

165 
j
 = 
	`g‘_b™s
(
bd
, 24);

166 
bd
->
h—d”CRC
 = 
	`g‘_b™s
(bd, 32);

167 ià((
i
 =ğ0x177245è&& (
j
 == 0x385090))

168  
RETVAL_LAST_BLOCK
;

169 ià((
i
 !ğ0x314159è|| (
j
 != 0x265359))

170  
RETVAL_NOT_BZIP_DATA
;

174 ià(
	`g‘_b™s
(
bd
, 1))

175  
RETVAL_OBSOLETE_INPUT
;

176 
ÜigPŒ
 = 
	`g‘_b™s
(
bd
, 24);

177 ià(
ÜigPŒ
 > 
dbufSize
)

178  
RETVAL_DATA_ERROR
;

184 
t
 = 
	`g‘_b™s
(
bd
, 16);

185 
symTÙ®
 = 0;

186 
i
 = 0; i < 16; i++) {

187 ià(
t
&(1 << (15-
i
))) {

188 
k
 = 
	`g‘_b™s
(
bd
, 16);

189 
j
 = 0; j < 16; j++)

190 ià(
k
&(1 << (15-
j
)))

191 
symToBy‹
[
symTÙ®
++] = (16*
i
)+
j
;

195 
groupCouÁ
 = 
	`g‘_b™s
(
bd
, 3);

196 ià(
groupCouÁ
 < 2 || groupCouÁ > 
MAX_GROUPS
)

197  
RETVAL_DATA_ERROR
;

203 
nS–eùÜs
 = 
	`g‘_b™s
(
bd
, 15);

204 ià(!
nS–eùÜs
)

205  
RETVAL_DATA_ERROR
;

206 
i
 = 0; i < 
groupCouÁ
; i++)

207 
mtfSymbŞ
[
i
] = i;

208 
i
 = 0; i < 
nS–eùÜs
; i++) {

210 
j
 = 0; 
	`g‘_b™s
(
bd
, 1); j++)

211 ià(
j
 >ğ
groupCouÁ
)

212  
RETVAL_DATA_ERROR
;

214 
uc
 = 
mtfSymbŞ
[
j
];

215 ; 
j
; j--)

216 
mtfSymbŞ
[
j
] = mtfSymbol[j-1];

217 
mtfSymbŞ
[0] = 
£ËùÜs
[
i
] = 
uc
;

222 
symCouÁ
 = 
symTÙ®
+2;

223 
j
 = 0; j < 
groupCouÁ
; j++) {

224 
Ëngth
[
MAX_SYMBOLS
], 
‹mp
[
MAX_HUFCODE_BITS
+1];

225 
mšL’
, 
maxL’
, 
µ
;

235 
t
 = 
	`g‘_b™s
(
bd
, 5)-1;

236 
i
 = 0; i < 
symCouÁ
; i++) {

238 ià((()
t
è> (
MAX_HUFCODE_BITS
-1))

239  
RETVAL_DATA_ERROR
;

247 
k
 = 
	`g‘_b™s
(
bd
, 2);

248 ià(
k
 < 2) {

249 
bd
->
šbufB™CouÁ
++;

254 
t
 +ğ(((
k
+1)&2)-1);

258 
Ëngth
[
i
] = 
t
+1;

261 
mšL’
 = 
maxL’
 = 
Ëngth
[0];

263 
i
 = 1; i < 
symCouÁ
; i++) {

264 ià(
Ëngth
[
i
] > 
maxL’
)

265 
maxL’
 = 
Ëngth
[
i
];

266 ià(
Ëngth
[
i
] < 
mšL’
)

267 
mšL’
 = 
Ëngth
[
i
];

285 
hufGroup
 = 
bd
->
groups
+
j
;

286 
hufGroup
->
mšL’
 = minLen;

287 
hufGroup
->
maxL’
 = maxLen;

292 
ba£
 = 
hufGroup
->base-1;

293 
lim™
 = 
hufGroup
->limit-1;

296 
µ
 = 0;

297 
i
 = 
mšL’
; i <ğ
maxL’
; i++) {

298 
‹mp
[
i
] = 
lim™
[i] = 0;

299 
t
 = 0; < 
symCouÁ
;++)

300 ià(
Ëngth
[
t
] =ğ
i
)

301 
hufGroup
->
³rmu‹
[
µ
++] = 
t
;

304 
i
 = 0; i < 
symCouÁ
; i++)

305 
‹mp
[
Ëngth
[
i
]]++;

312 
µ
 = 
t
 = 0;

313 
i
 = 
mšL’
; i < 
maxL’
; i++) {

314 
µ
 +ğ
‹mp
[
i
];

325 
lim™
[
i
] = (
µ
 << (
maxL’
 - i)) - 1;

326 
µ
 <<= 1;

327 
ba£
[
i
+1] = 
µ
-(
t
 +ğ
‹mp
[i]);

329 
lim™
[
maxL’
+1] = 
INT_MAX
;

331 
lim™
[
maxL’
] = 
µ
+
‹mp
[maxLen]-1;

332 
ba£
[
mšL’
] = 0;

341 
i
 = 0; i < 256; i++) {

342 
by‹CouÁ
[
i
] = 0;

343 
mtfSymbŞ
[
i
] = ()i;

346 
runPos
 = 
dbufCouÁ
 = 
symCouÁ
 = 
£ËùÜ
 = 0;

349 ià(!(
symCouÁ
--)) {

350 
symCouÁ
 = 
GROUP_SIZE
-1;

351 ià(
£ËùÜ
 >ğ
nS–eùÜs
)

352  
RETVAL_DATA_ERROR
;

353 
hufGroup
 = 
bd
->
groups
+
£ËùÜs
[
£ËùÜ
++];

354 
ba£
 = 
hufGroup
->base-1;

355 
lim™
 = 
hufGroup
->limit-1;

369 
bd
->
šbufB™CouÁ
 < 
hufGroup
->
maxL’
) {

370 ià(
bd
->
šbufPos
 =ğbd->
šbufCouÁ
) {

371 
j
 = 
	`g‘_b™s
(
bd
, 
hufGroup
->
maxL’
);

372 
gÙ_huff_b™s
;

374 
bd
->
šbufB™s
 =

375 (
bd
->
šbufB™s
 << 8)|bd->
šbuf
[bd->
šbufPos
++];

376 
bd
->
šbufB™CouÁ
 += 8;

378 
bd
->
šbufB™CouÁ
 -ğ
hufGroup
->
maxL’
;

379 
j
 = (
bd
->
šbufB™s
 >> bd->
šbufB™CouÁ
)&

380 ((1 << 
hufGroup
->
maxL’
)-1);

381 
gÙ_huff_b™s
:

384 
i
 = 
hufGroup
->
mšL’
;

385 
j
 > 
lim™
[
i
])

386 ++
i
;

387 
bd
->
šbufB™CouÁ
 +ğ(
hufGroup
->
maxL’
 - 
i
);

389 ià((
i
 > 
hufGroup
->
maxL’
)

390 || ((()(
j
 = (j>>(
hufGroup
->
maxL’
-
i
))-
ba£
[i]))

391 >ğ
MAX_SYMBOLS
))

392  
RETVAL_DATA_ERROR
;

393 
ÃxtSym
 = 
hufGroup
->
³rmu‹
[
j
];

399 ià((()
ÃxtSym
è<ğ
SYMBOL_RUNB
) {

402 ià(!
runPos
) {

403 
runPos
 = 1;

404 
t
 = 0;

416 
t
 +ğ(
runPos
 << 
ÃxtSym
);

419 
runPos
 <<= 1;

428 ià(
runPos
) {

429 
runPos
 = 0;

430 ià(
dbufCouÁ
+
t
 >ğ
dbufSize
)

431  
RETVAL_DATA_ERROR
;

433 
uc
 = 
symToBy‹
[
mtfSymbŞ
[0]];

434 
by‹CouÁ
[
uc
] +ğ
t
;

435 
t
--)

436 
dbuf
[
dbufCouÁ
++] = 
uc
;

439 ià(
ÃxtSym
 > 
symTÙ®
)

450 ià(
dbufCouÁ
 >ğ
dbufSize
)

451  
RETVAL_DATA_ERROR
;

452 
i
 = 
ÃxtSym
 - 1;

453 
uc
 = 
mtfSymbŞ
[
i
];

460 
mtfSymbŞ
[
i
] = mtfSymbol[i-1];

461 } --
i
);

462 
mtfSymbŞ
[0] = 
uc
;

463 
uc
 = 
symToBy‹
[uc];

465 
by‹CouÁ
[
uc
]++;

466 
dbuf
[
dbufCouÁ
++] = ()
uc
;

476 
j
 = 0;

477 
i
 = 0; i < 256; i++) {

478 
k
 = 
j
+
by‹CouÁ
[
i
];

479 
by‹CouÁ
[
i
] = 
j
;

480 
j
 = 
k
;

483 
i
 = 0; i < 
dbufCouÁ
; i++) {

484 
uc
 = ()(
dbuf
[
i
] & 0xff);

485 
dbuf
[
by‹CouÁ
[
uc
]] |ğ(
i
 << 8);

486 
by‹CouÁ
[
uc
]++;

492 ià(
dbufCouÁ
) {

493 ià(
ÜigPŒ
 >ğ
dbufCouÁ
)

494  
RETVAL_DATA_ERROR
;

495 
bd
->
wr™ePos
 = 
dbuf
[
ÜigPŒ
];

496 
bd
->
wr™eCu¼’t
 = ()(bd->
wr™ePos
&0xff);

497 
bd
->
wr™ePos
 >>= 8;

498 
bd
->
wr™eRunCouÁdown
 = 5;

500 
bd
->
wr™eCouÁ
 = 
dbufCouÁ
;

502  
RETVAL_OK
;

503 
	}
}

512 
INIT
 
	$»ad_bunz
(
bunz_d©a
 *
bd
, *
outbuf
, 
Ën
)

514 cÚ¡ *
dbuf
;

515 
pos
, 
xcu¼’t
, 
´evious
, 
gÙcouÁ
;

518 ià(
bd
->
wr™eCouÁ
 < 0)

519  
bd
->
wr™eCouÁ
;

521 
gÙcouÁ
 = 0;

522 
dbuf
 = 
bd
->dbuf;

523 
pos
 = 
bd
->
wr™ePos
;

524 
xcu¼’t
 = 
bd
->
wr™eCu¼’t
;

530 ià(
bd
->
wr™eCİ›s
) {

532 --
bd
->
wr™eCİ›s
;

537 ià(
gÙcouÁ
 >ğ
Ën
) {

538 
bd
->
wr™ePos
 = 
pos
;

539 
bd
->
wr™eCu¼’t
 = 
xcu¼’t
;

540 
bd
->
wr™eCİ›s
++;

541  
Ën
;

544 
outbuf
[
gÙcouÁ
++] = 
xcu¼’t
;

545 
bd
->
wr™eCRC
 = (((bd->writeCRC) << 8)

546 ^
bd
->
üc32TabË
[((bd->
wr™eCRC
) >> 24)

547 ^
xcu¼’t
]);

550 ià(
bd
->
wr™eCİ›s
) {

551 --
bd
->
wr™eCİ›s
;

554 
decode_Ãxt_by‹
:

555 ià(!
bd
->
wr™eCouÁ
--)

559 
´evious
 = 
xcu¼’t
;

560 
pos
 = 
dbuf
[pos];

561 
xcu¼’t
 = 
pos
&0xff;

562 
pos
 >>= 8;

567 ià(--
bd
->
wr™eRunCouÁdown
) {

568 ià(
xcu¼’t
 !ğ
´evious
)

569 
bd
->
wr™eRunCouÁdown
 = 4;

573 
bd
->
wr™eCİ›s
 = 
xcu¼’t
;

574 
xcu¼’t
 = 
´evious
;

575 
bd
->
wr™eRunCouÁdown
 = 5;

578 ià(!
bd
->
wr™eCİ›s
)

579 
decode_Ãxt_by‹
;

582 --
bd
->
wr™eCİ›s
;

586 
bd
->
wr™eCRC
 = ~bd->writeCRC;

587 
bd
->
tÙ®CRC
 = ((bd->totalCRC << 1) |

588 (
bd
->
tÙ®CRC
 >> 31)è^ bd->
wr™eCRC
;

590 ià(
bd
->
wr™eCRC
 !ğbd->
h—d”CRC
) {

591 
bd
->
tÙ®CRC
 = bd->
h—d”CRC
+1;

592  
RETVAL_LAST_BLOCK
;

599 
´evious
 = 
	`g‘_Ãxt_block
(
bd
);

600 ià(
´evious
) {

601 
bd
->
wr™eCouÁ
 = 
´evious
;

602  (
´evious
 !ğ
RETVAL_LAST_BLOCK
è?…»viou : 
gÙcouÁ
;

604 
bd
->
wr™eCRC
 = 0xffffffffUL;

605 
pos
 = 
bd
->
wr™ePos
;

606 
xcu¼’t
 = 
bd
->
wr™eCu¼’t
;

607 
decode_Ãxt_by‹
;

608 
	}
}

610 
INIT
 
	$nofl
(*
buf
, 
Ën
)

613 
	}
}

618 
INIT
 
¡¬t_bunz
(
bunz_d©a
 **
bdp
, *
šbuf
, 
Ën
,

619 (*
fl
)(*, ))

621 
bunz_d©a
 *
bd
;

622 
i
, 
j
, 
c
;

623 cÚ¡ 
BZh0
 =

628 
i
 = (
bunz_d©a
);

631 
bd
 = *
bdp
 = 
	`m®loc
(
i
);

632 
	`mem£t
(
bd
, 0, (
bunz_d©a
));

634 
bd
->
šbuf
 = inbuf;

635 
bd
->
šbufCouÁ
 = 
Ën
;

636 ià(
fl
 !ğ
NULL
)

637 
bd
->
fl
 = fill;

639 
bd
->
fl
 = 
nofl
;

642 
i
 = 0; i < 256; i++) {

643 
c
 = 
i
 << 24;

644 
j
 = 8; j; j--)

645 
c
 = c&0x80000000 ? (c << 1)^0x04c11db7 : (c << 1);

646 
bd
->
üc32TabË
[
i
] = 
c
;

650 
i
 = 
	`g‘_b™s
(
bd
, 32);

651 ià((()(
i
-
BZh0
-1)) >= 9)

652  
RETVAL_NOT_BZIP_DATA
;

656 
bd
->
dbufSize
 = 100000*(
i
-
BZh0
);

658 
bd
->
dbuf
 = 
	`Ïrge_m®loc
(bd->
dbufSize
 * ());

659  
RETVAL_OK
;

660 
	}
}

664 
STATIC
 
INIT
 
bunz2
(*
buf
, 
Ën
,

665 (*
fl
)(*, ),

666 (*
æush
)(*, ),

667 *
outbuf
,

668 *
pos
,

669 (*
”rÜ_â
)(cÚ¡ *
x
))

671 
bunz_d©a
 *
bd
;

672 
i
 = -1;

673 *
šbuf
;

675 
	`£t_”rÜ_â
(
”rÜ_â
);

676 ià(
æush
)

677 
outbuf
 = 
	`m®loc
(
BZIP2_IOBUF_SIZE
);

679 ià(!
outbuf
) {

680 
	`”rÜ
("Could‚ot‡llocate output bufer");

683 ià(
buf
)

684 
šbuf
 = 
buf
;

686 
šbuf
 = 
	`m®loc
(
BZIP2_IOBUF_SIZE
);

687 ià(!
šbuf
) {

688 
	`”rÜ
("Could‚ot‡llocate input bufer");

689 
ex™_0
;

691 
i
 = 
	`¡¬t_bunz
(&
bd
, 
šbuf
, 
Ën
, 
fl
);

692 ià(!
i
) {

694 
i
 = 
	`»ad_bunz
(
bd
, 
outbuf
, 
BZIP2_IOBUF_SIZE
);

695 ià(
i
 <= 0)

697 ià(!
æush
)

698 
outbuf
 +ğ
i
;

700 ià(
i
 !ğ
	`æush
(
outbuf
, i)) {

701 
i
 = 
RETVAL_UNEXPECTED_OUTPUT_EOF
;

707 ià(
i
 =ğ
RETVAL_LAST_BLOCK
) {

708 ià(
bd
->
h—d”CRC
 !ğbd->
tÙ®CRC
)

709 
	`”rÜ
("Data integrityƒrror when decompressing.");

711 
i
 = 
RETVAL_OK
;

712 } ià(
i
 =ğ
RETVAL_UNEXPECTED_OUTPUT_EOF
) {

713 
	`”rÜ
("Compressed fileƒnds unexpectedly");

715 ià(
bd
->
dbuf
)

716 
	`Ïrge_ä“
(
bd
->
dbuf
);

717 ià(
pos
)

718 *
pos
 = 
bd
->
šbufPos
;

719 
	`ä“
(
bd
);

720 ià(!
buf
)

721 
	`ä“
(
šbuf
);

722 
ex™_0
:

723 ià(
æush
)

724 
	`ä“
(
outbuf
);

725  
i
;

726 
	}
}

	@compat/domain.c

6 
	~<x’/cÚfig.h
>

7 
	~<x’/lib.h
>

8 
	~<x’/sched.h
>

9 
	~<x’/domaš.h
>

10 
	~<x’/gue¡_acûss.h
>

11 
	~<x’/hy³rÿÎ.h
>

12 
	~<com·t/vıu.h
>

14 
	#x’_vıu_£t_³riodic_tim”
 
vıu_£t_³riodic_tim”


	)

15 
	gCHECK_vıu_£t_³riodic_tim”
;

16 #undeà
x’_vıu_£t_³riodic_tim”


18 
com·t_vıu_İ
(
cmd
, 
vıuid
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

20 
domaš
 *
d
 = 
cu¼’t
->domain;

21 
vıu
 *
v
;

22 
rc
 = 0;

24 iàĞ(
vıuid
 < 0è|| (vıuid >ğ
MAX_VIRT_CPUS
) )

25  -
EINVAL
;

27 iàĞ
vıuid
 >ğ
d
->
max_vıus
 || (
v
 = d->
vıu
[vıuid]è=ğ
NULL
 )

28  -
ENOENT
;

30  
cmd
 )

32 
VCPUOP_š™Ÿli£
:

34 
com·t_vıu_gue¡_cÚ‹xt
 *
cmp_ùxt
;

36 iàĞ(
cmp_ùxt
 = 
	`xm®loc
(
com·t_vıu_gue¡_cÚ‹xt
)è=ğ
NULL
 )

38 
rc
 = -
ENOMEM
;

42 iàĞ
	`cİy_äom_gue¡
(
cmp_ùxt
, 
¬g
, 1) )

44 
	`xä“
(
cmp_ùxt
);

45 
rc
 = -
EFAULT
;

49 
	`domaš_lock
(
d
);

50 
rc
 = -
EEXIST
;

51 iàĞ!
v
->
is_š™Ÿli£d
 )

52 
rc
 = 
	`boÙ_vıu
(
d
, 
vıuid
, 
cmp_ùxt
);

53 
	`domaš_uÆock
(
d
);

55 
	`xä“
(
cmp_ùxt
);

59 
VCPUOP_up
:

60 
VCPUOP_down
:

61 
VCPUOP_is_up
:

62 
VCPUOP_£t_³riodic_tim”
:

63 
VCPUOP_¡İ_³riodic_tim”
:

64 
VCPUOP_¡İ_sšgËshÙ_tim”
:

65 
VCPUOP_£nd_nmi
:

66 
rc
 = 
	`do_vıu_İ
(
cmd
, 
vıuid
, 
¬g
);

69 
VCPUOP_g‘_run¡©e_šfo
:

72 
vıu_run¡©e_šfo
 
Çt
;

73 
com·t_vıu_run¡©e_šfo
 
cmp
;

74 } 
run¡©e
;

76 
	`vıu_run¡©e_g‘
(
v
, &
run¡©e
.
Çt
);

77 
	`xÏt_vıu_run¡©e_šfo
(&
run¡©e
.
Çt
);

78 iàĞ
	`cİy_to_gue¡
(
¬g
, &
run¡©e
.
cmp
, 1) )

79 
rc
 = -
EFAULT
;

83 
VCPUOP_£t_sšgËshÙ_tim”
:

85 
com·t_vıu_£t_sšgËshÙ_tim”
 
cmp
;

86 
vıu_£t_sšgËshÙ_tim”
 *
Çt
;

88 iàĞ
	`cİy_äom_gue¡
(&
cmp
, 
¬g
, 1) )

89  -
EFAULT
;

90 
Çt
 = 
COMPAT_ARG_XLAT_VIRT_BASE
;

91 
	`XLAT_vıu_£t_sšgËshÙ_tim”
(
Çt
, &
cmp
);

92 
rc
 = 
	`do_vıu_İ
(
cmd
, 
vıuid
, 
	`gue¡_hªdË_äom_±r
(
Çt
, ));

97 
rc
 = 
	`¬ch_com·t_vıu_İ
(
cmd
, 
v
, 
¬g
);

101  
rc
;

102 
	}
}

	@compat/grant_table.c

6 
	~<com·t/g¿Á_bË.h
>

8 
	#x’_g¿Á_’Œy_v1
 
g¿Á_’Œy_v1


	)

9 
	gCHECK_g¿Á_’Œy_v1
;

10 #undeà
x’_g¿Á_’Œy_v1


12 
	#x’_g¿Á_’Œy_h—d”
 
g¿Á_’Œy_h—d”


	)

13 
	gCHECK_g¿Á_’Œy_h—d”
;

14 #undeà
x’_g¿Á_’Œy_h—d”


16 
	#x’_g¿Á_’Œy_v2
 
g¿Á_’Œy_v2


	)

17 
	gCHECK_g¿Á_’Œy_v2
;

18 #undeà
x’_g¿Á_’Œy_v2


20 
	#x’_gÁb_m­_g¿Á_»f
 
gÁb_m­_g¿Á_»f


	)

21 
	gCHECK_gÁb_m­_g¿Á_»f
;

22 #undeà
x’_gÁb_m­_g¿Á_»f


24 
	#x’_gÁb_unm­_g¿Á_»f
 
gÁb_unm­_g¿Á_»f


	)

25 
	gCHECK_gÁb_unm­_g¿Á_»f
;

26 #undeà
x’_gÁb_unm­_g¿Á_»f


28 
	#x’_gÁb_unm­_ªd_»¶aû
 
gÁb_unm­_ªd_»¶aû


	)

29 
	gCHECK_gÁb_unm­_ªd_»¶aû
;

30 #undeà
x’_gÁb_unm­_ªd_»¶aû


32 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_£tup_bË_com·t_t
);

33 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_Œªsãr_com·t_t
);

34 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_cİy_com·t_t
);

36 
	#x’_gÁb_dump_bË
 
gÁb_dump_bË


	)

37 
	gCHECK_gÁb_dump_bË
;

38 #undeà
x’_gÁb_dump_bË


40 
	#x’_gÁb_£t_v”siÚ
 
gÁb_£t_v”siÚ


	)

41 
	gCHECK_gÁb_£t_v”siÚ
;

42 #undeà
x’_gÁb_£t_v”siÚ


44 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_g‘_¡©us_äames_com·t_t
);

46 
	#x’_gÁb_g‘_v”siÚ
 
gÁb_g‘_v”siÚ


	)

47 
	gCHECK_gÁb_g‘_v”siÚ
;

48 #undeà
x’_gÁb_g‘_v”siÚ


50 
com·t_g¿Á_bË_İ
(
cmd
,

51 
	$XEN_GUEST_HANDLE
(è
cmp_uİ
,

52 
couÁ
)

54 
rc
 = 0;

55 
i
;

56 
	`XEN_GUEST_HANDLE
(è
út_uİ
;

58 
	`£t_x’_gue¡_hªdË
(
út_uİ
, 
NULL
);

59  
cmd
 )

61 
	#CASE
(
Çme
) \

62 
GNTTABOP_
##
Çme
: \

63 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
	`gue¡_hªdË_ÿ¡
(
cmp_uİ
, \

64 
gÁb_
##
Çme
##
_com·t_t
), \

65 
couÁ
)) ) \

66 
rc
 = -
EFAULT
; \

67 

	)

69 #iâdeà
CHECK_gÁb_m­_g¿Á_»f


70 
	`CASE
(
m­_g¿Á_»f
);

73 #iâdeà
CHECK_gÁb_unm­_g¿Á_»f


74 
	`CASE
(
unm­_g¿Á_»f
);

77 #iâdeà
CHECK_gÁb_unm­_ªd_»¶aû


78 
	`CASE
(
unm­_ªd_»¶aû
);

81 #iâdeà
CHECK_gÁb_£tup_bË


82 
	`CASE
(
£tup_bË
);

85 #iâdeà
CHECK_gÁb_Œªsãr


86 
	`CASE
(
Œªsãr
);

89 #iâdeà
CHECK_gÁb_cİy


90 
	`CASE
(
cİy
);

93 #iâdeà
CHECK_gÁb_dump_bË


94 
	`CASE
(
dump_bË
);

97 #iâdeà
CHECK_gÁb_g‘_¡©us_äames


98 
	`CASE
(
g‘_¡©us_äames
);

101 #undeà
CASE


103  
	`do_g¿Á_bË_İ
(
cmd
, 
cmp_uİ
, 
couÁ
);

106 iàĞ()
couÁ
 < 0 )

107 
rc
 = -
EINVAL
;

109  
i
 = 0; i < 
couÁ
 && 
rc
 == 0; )

111 
n
;

113 
	`XEN_GUEST_HANDLE
(è
uİ
;

114 
gÁb_£tup_bË
 *
£tup
;

115 
gÁb_Œªsãr
 *
xãr
;

116 
gÁb_cİy
 *
cİy
;

117 
gÁb_g‘_¡©us_äames
 *
g‘_¡©us
;

118 } 
Çt
;

120 
com·t_gÁb_£tup_bË
 
£tup
;

121 
com·t_gÁb_Œªsãr
 
xãr
;

122 
com·t_gÁb_cİy
 
cİy
;

123 
com·t_gÁb_g‘_¡©us_äames
 
g‘_¡©us
;

124 } 
cmp
;

126 
	`£t_x’_gue¡_hªdË
(
Çt
.
uİ
, 
COMPAT_ARG_XLAT_VIRT_BASE
);

127  
cmd
 )

129 
GNTTABOP_£tup_bË
:

130 iàĞ
	`uÆik–y
(
couÁ
 > 1) )

131 
rc
 = -
EINVAL
;

132 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡
(&
cmp
.
£tup
, 
cmp_uİ
, 1)) )

133 
rc
 = -
EFAULT
;

134 iàĞ
	`uÆik–y
(!
	`com·t_hªdË_okay
(
cmp
.
£tup
.
äame_li¡
, cmp.£tup.
Ä_äames
)) )

135 
rc
 = -
EFAULT
;

138 
max_äame_li¡_size_š_·ge
 =

139 (
COMPAT_ARG_XLAT_SIZE
 - (*
Çt
.
£tup
)) /

140 (*
Çt
.
£tup
->
äame_li¡
.
p
);

141 iàĞ
max_äame_li¡_size_š_·ge
 < 
max_Ä_g¿Á_äames
 )

143 
	`gd´štk
(
XENLOG_WARNING
,

145 
max_Ä_g¿Á_äames
, 
max_äame_li¡_size_š_·ge
);

146 
rc
 = -
EINVAL
;

150 
	#XLAT_gÁb_£tup_bË_HNDL_äame_li¡
(
_d_
, 
_s_
) \

151 
	`£t_x’_gue¡_hªdË
((
_d_
)->
äame_li¡
, (*)(
Çt
.
£tup
 + 1))

	)

152 
	`XLAT_gÁb_£tup_bË
(
Çt
.
£tup
, &
cmp
.setup);

153 #undeà
XLAT_gÁb_£tup_bË_HNDL_äame_li¡


154 
rc
 = 
	`gÁb_£tup_bË
(
	`gue¡_hªdË_ÿ¡
(
Çt
.
uİ
, 
gÁb_£tup_bË_t
), 1);

157 
	`ASSERT
(
rc
 <= 0);

158 iàĞ
rc
 == 0 )

160 
	#XLAT_gÁb_£tup_bË_HNDL_äame_li¡
(
_d_
, 
_s_
) \

163 iàĞ(
_s_
)->
¡©us
 =ğ
GNTST_okay
 ) \

165  
i
 = 0; i < (
_s_
)->
Ä_äames
; ++i ) \

167 
äame
 = (
_s_
)->
äame_li¡
.
p
[
i
]; \

168 ()
	`__cİy_to_com·t_off£t
((
_d_
)->
äame_li¡
, 
i
, &
äame
, 1); \

171 } 0)

	)

172 
	`XLAT_gÁb_£tup_bË
(&
cmp
.
£tup
, 
Çt
.setup);

173 #undeà
XLAT_gÁb_£tup_bË_HNDL_äame_li¡


174 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡
(
cmp_uİ
, &
cmp
.
£tup
, 1)) )

175 
rc
 = -
EFAULT
;

177 
i
 = 1;

181 
GNTTABOP_Œªsãr
:

182  
n
 = 0;‚ < 
COMPAT_ARG_XLAT_SIZE
 / (*
Çt
.
xãr
è&& 
i
 < 
couÁ
 && 
rc
 == 0; ++i, ++n )

184 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
cmp
.
xãr
, 
cmp_uİ
, 
i
, 1)) )

185 
rc
 = -
EFAULT
;

188 
	`XLAT_gÁb_Œªsãr
(
Çt
.
xãr
 + 
n
, &
cmp
.xfer);

191 iàĞ
rc
 == 0 )

192 
rc
 = 
	`gÁb_Œªsãr
(
	`gue¡_hªdË_ÿ¡
(
Çt
.
uİ
, 
gÁb_Œªsãr_t
), 
n
);

193 iàĞ
rc
 > 0 )

195 
	`ASSERT
(
rc
 < 
n
);

196 
i
 -ğ
n
 - 
rc
;

197 
n
 = 
rc
;

199 iàĞ
rc
 >= 0 )

201 
	`XEN_GUEST_HANDLE
(
gÁb_Œªsãr_com·t_t
è
xãr
;

203 
xãr
 = 
	`gue¡_hªdË_ÿ¡
(
cmp_uİ
, 
gÁb_Œªsãr_com·t_t
);

204 
	`gue¡_hªdË_add_off£t
(
xãr
, 
i
);

205 
út_uİ
 = 
	`gue¡_hªdË_ÿ¡
(
xãr
, );

206  
n
-- )

208 
	`gue¡_hªdË_add_off£t
(
xãr
, -1);

209 iàĞ
	`__cİy_f›ld_to_gue¡
(
xãr
, 
Çt
.xã¸+ 
n
, 
¡©us
) )

210 
rc
 = -
EFAULT
;

215 
GNTTABOP_cİy
:

216  
n
 = 0;‚ < 
COMPAT_ARG_XLAT_SIZE
 / (*
Çt
.
cİy
è&& 
i
 < 
couÁ
 && 
rc
 == 0; ++i, ++n )

218 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
cmp
.
cİy
, 
cmp_uİ
, 
i
, 1)) )

219 
rc
 = -
EFAULT
;

222 
XLAT_gÁb_cİy_sourû_u
 
sourû_u
;

223 
XLAT_gÁb_cİy_de¡_u
 
de¡_u
;

225 iàĞ
cmp
.
cİy
.
æags
 & 
GNTCOPY_sourû_g»f
 )

226 
sourû_u
 = 
XLAT_gÁb_cİy_sourû_u_»f
;

228 
sourû_u
 = 
XLAT_gÁb_cİy_sourû_u_gmâ
;

229 iàĞ
cmp
.
cİy
.
æags
 & 
GNTCOPY_de¡_g»f
 )

230 
de¡_u
 = 
XLAT_gÁb_cİy_de¡_u_»f
;

232 
de¡_u
 = 
XLAT_gÁb_cİy_de¡_u_gmâ
;

233 
	`XLAT_gÁb_cİy
(
Çt
.
cİy
 + 
n
, &
cmp
.copy);

236 iàĞ
rc
 == 0 )

237 
rc
 = 
	`gÁb_cİy
(
	`gue¡_hªdË_ÿ¡
(
Çt
.
uİ
, 
gÁb_cİy_t
), 
n
);

238 iàĞ
rc
 > 0 )

240 
	`ASSERT
(
rc
 < 
n
);

241 
i
 -ğ
n
 - 
rc
;

242 
n
 = 
rc
;

244 iàĞ
rc
 >= 0 )

246 
	`XEN_GUEST_HANDLE
(
gÁb_cİy_com·t_t
è
cİy
;

248 
cİy
 = 
	`gue¡_hªdË_ÿ¡
(
cmp_uİ
, 
gÁb_cİy_com·t_t
);

249 
	`gue¡_hªdË_add_off£t
(
cİy
, 
i
);

250 
út_uİ
 = 
	`gue¡_hªdË_ÿ¡
(
cİy
, );

251  
n
-- )

253 
	`gue¡_hªdË_add_off£t
(
cİy
, -1);

254 iàĞ
	`__cİy_f›ld_to_gue¡
(
cİy
, 
Çt
.cİy + 
n
, 
¡©us
) )

255 
rc
 = -
EFAULT
;

260 
GNTTABOP_g‘_¡©us_äames
: {

261 
max_äame_li¡_size_š_·ges
 =

262 (
COMPAT_ARG_XLAT_SIZE
 - (*
Çt
.
g‘_¡©us
)) /

263 (*
Çt
.
g‘_¡©us
->
äame_li¡
.
p
);

264 iàĞ
couÁ
 != 1)

266 
rc
 = -
EINVAL
;

269 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡
(&
cmp
.
g‘_¡©us
, 
cmp_uİ
, 1) ||

270 !
	`com·t_hªdË_okay
(
cmp
.
g‘_¡©us
.
äame_li¡
,

271 
cmp
.
g‘_¡©us
.
Ä_äames
)) )

273 
rc
 = -
EFAULT
;

276 iàĞ
max_äame_li¡_size_š_·ges
 <

277 
	`g¿Á_to_¡©us_äames
(
max_Ä_g¿Á_äames
) )

279 
	`gd´štk
(
XENLOG_WARNING
,

281 
	`g¿Á_to_¡©us_äames
(
max_Ä_g¿Á_äames
),

282 
max_äame_li¡_size_š_·ges
);

283 
rc
 = -
EINVAL
;

287 
	#XLAT_gÁb_g‘_¡©us_äames_HNDL_äame_li¡
(
_d_
, 
_s_
) \

288 
	`£t_x’_gue¡_hªdË
((
_d_
)->
äame_li¡
, (
ušt64_t
 *)(
Çt
.
g‘_¡©us
 + 1))

	)

289 
	`XLAT_gÁb_g‘_¡©us_äames
(
Çt
.
g‘_¡©us
, &
cmp
.get_status);

290 #undeà
XLAT_gÁb_g‘_¡©us_äames_HNDL_äame_li¡


292 
rc
 = 
	`gÁb_g‘_¡©us_äames
(

293 
	`gue¡_hªdË_ÿ¡
(
Çt
.
uİ
, 
gÁb_g‘_¡©us_äames_t
),

294 
couÁ
);

295 iàĞ
rc
 >= 0 )

297 
	#XLAT_gÁb_g‘_¡©us_äames_HNDL_äame_li¡
(
_d_
, 
_s_
) \

300 iàĞ(
_s_
)->
¡©us
 =ğ
GNTST_okay
 ) \

302  
i
 = 0; i < (
_s_
)->
Ä_äames
; ++i ) \

304 
ušt64_t
 
äame
 = (
_s_
)->
äame_li¡
.
p
[
i
]; \

305 ()
	`__cİy_to_com·t_off£t
((
_d_
)->
äame_li¡
, 
i
, &
äame
, 1); \

308 } 0)

	)

309 
	`XLAT_gÁb_g‘_¡©us_äames
(&
cmp
.
g‘_¡©us
, 
Çt
.get_status);

310 #undeà
XLAT_gÁb_g‘_¡©us_äames_HNDL_äame_li¡


311 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡
(
cmp_uİ
, &
cmp
.
g‘_¡©us
, 1)) )

312 
rc
 = -
EFAULT
;

318 
	`domaš_üash
(
cu¼’t
->
domaš
);

323 iàĞ
rc
 > 0 )

325 
	`ASSERT
(
i
 < 
couÁ
);

326 
	`ASSERT
(!
	`gue¡_hªdË_is_nuÎ
(
út_uİ
));

327 
rc
 = 
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(
__HYPERVISOR_g¿Á_bË_İ
,

328 "ihi", 
cmd
, 
út_uİ
, 
couÁ
 - 
i
);

331  
rc
;

332 
	}
}

	@compat/kernel.c

5 
	~<x’/cÚfig.h
>

6 
	~<x’/š™.h
>

7 
	~<x’/lib.h
>

8 
	~<x’/”ºo.h
>

9 
	~<x’/v”siÚ.h
>

10 
	~<x’/sched.h
>

11 
	~<x’/nmi.h
>

12 
	~<x’/gue¡_acûss.h
>

13 
	~<asm/cu¼’t.h
>

14 
	~<com·t/x’.h
>

15 
	~<com·t/nmi.h
>

16 
	~<com·t/v”siÚ.h
>

18 
x’_commªdlše_t
 
§ved_cmdlše
;

20 
	#x’_exŒav”siÚ
 
com·t_exŒav”siÚ


	)

21 
	#x’_exŒav”siÚ_t
 
com·t_exŒav”siÚ_t


	)

23 
	#x’_compe_šfo
 
com·t_compe_šfo


	)

24 
	#x’_compe_šfo_t
 
com·t_compe_šfo_t


	)

26 
CHECK_TYPE
(
ÿ·b™›s_šfo
);

28 
	#x’_¶©fÜm_·¿m‘”s
 
com·t_¶©fÜm_·¿m‘”s


	)

29 
	#x’_¶©fÜm_·¿m‘”s_t
 
com·t_¶©fÜm_·¿m‘”s_t


	)

30 #undeà
HYPERVISOR_VIRT_START


31 
	#HYPERVISOR_VIRT_START
 
	`HYPERVISOR_COMPAT_VIRT_START
(
cu¼’t
->
domaš
)

	)

33 
	#x’_chªge£t_šfo
 
com·t_chªge£t_šfo


	)

34 
	#x’_chªge£t_šfo_t
 
com·t_chªge£t_šfo_t


	)

36 
	#x’_ã©u»_šfo
 
com·t_ã©u»_šfo


	)

37 
	#x’_ã©u»_šfo_t
 
com·t_ã©u»_šfo_t


	)

39 
CHECK_TYPE
(
domaš_hªdË
);

41 
	#x’nmi_ÿÎback
 
com·t_nmi_ÿÎback


	)

42 
	#x’nmi_ÿÎback_t
 
com·t_nmi_ÿÎback_t


	)

44 
	#DO
(
â
è
com·t_
##
	)
fn

45 
	#COMPAT


	)

47 
	~"../k”Ãl.c
"

	@compat/memory.c

1 
	~<x’/cÚfig.h
>

2 
	~<x’/ty³s.h
>

3 
	~<x’/hy³rÿÎ.h
>

4 
	~<x’/gue¡_acûss.h
>

5 
	~<x’/sched.h
>

6 
	~<x’/ev’t.h
>

7 
	~<asm/cu¼’t.h
>

8 
	~<com·t/memÜy.h
>

10 
	#x’_domid_t
 
domid_t


	)

11 
	#com·t_domid_t
 
domid_com·t_t


	)

12 
CHECK_TYPE
(
domid
);

13 #undeà
com·t_domid_t


14 #undeà
x’_domid_t


16 
com·t_memÜy_İ
(
cmd
, 
	$XEN_GUEST_HANDLE
(è
com·t
)

18 
rc
, 
¥l™
, 
İ
 = 
cmd
 & 
MEMOP_CMD_MASK
;

19 
¡¬t_ex‹Á
 = 
cmd
 >> 
MEMOP_EXTENT_SHIFT
;

23 
i
, 
’d_ex‹Á
 = 0;

25 
	`XEN_GUEST_HANDLE
(è
hnd
;

26 
x’_memÜy_»£rv©iÚ
 *
r¤v
;

27 
x’_memÜy_exchªge
 *
xchg
;

28 } 
Çt
;

30 
com·t_memÜy_»£rv©iÚ
 
r¤v
;

31 
com·t_memÜy_exchªge
 
xchg
;

32 } 
cmp
;

34 
	`£t_x’_gue¡_hªdË
(
Çt
.
hnd
, 
COMPAT_ARG_XLAT_VIRT_BASE
);

35 
¥l™
 = 0;

36  
İ
 )

38 
x’_pâ_t
 *
¥aû
;

40 
XENMEM_šü—£_»£rv©iÚ
:

41 
XENMEM_deü—£_»£rv©iÚ
:

42 
XENMEM_pİuÏ‹_physm­
:

43 iàĞ
	`cİy_äom_gue¡
(&
cmp
.
r¤v
, 
com·t
, 1) )

44  
¡¬t_ex‹Á
;

47 iàĞ
cmp
.
r¤v
.
Ä_ex‹Ás
 > (
UINT_MAX
 >> 
MEMOP_EXTENT_SHIFT
) )

48  
¡¬t_ex‹Á
;

50 iàĞ!
	`com·t_hªdË_is_nuÎ
(
cmp
.
r¤v
.
ex‹Á_¡¬t
) &&

51 !
	`com·t_hªdË_okay
(
cmp
.
r¤v
.
ex‹Á_¡¬t
, cmp.r¤v.
Ä_ex‹Ás
) )

52  
¡¬t_ex‹Á
;

54 
’d_ex‹Á
 = 
¡¬t_ex‹Á
 + (
COMPAT_ARG_XLAT_SIZE
 - (*
Çt
.
r¤v
)) /

55 (*
¥aû
);

56 iàĞ
’d_ex‹Á
 > 
cmp
.
r¤v
.
Ä_ex‹Ás
 )

57 
’d_ex‹Á
 = 
cmp
.
r¤v
.
Ä_ex‹Ás
;

59 
¥aû
 = (
x’_pâ_t
 *)(
Çt
.
r¤v
 + 1);

60 
	#XLAT_memÜy_»£rv©iÚ_HNDL_ex‹Á_¡¬t
(
_d_
, 
_s_
) \

63 iàĞ!
	`com·t_hªdË_is_nuÎ
((
_s_
)->
ex‹Á_¡¬t
) ) \

65 
	`£t_x’_gue¡_hªdË
((
_d_
)->
ex‹Á_¡¬t
, 
¥aû
 - 
¡¬t_ex‹Á
); \

66 iàĞ
İ
 !ğ
XENMEM_šü—£_»£rv©iÚ
 ) \

68  
i
 = 
¡¬t_ex‹Á
; i < 
’d_ex‹Á
; ++i ) \

70 
com·t_pâ_t
 
pâ
; \

71 iàĞ
	`__cİy_äom_com·t_off£t
(&
pâ
, (
_s_
)->
ex‹Á_¡¬t
, 
i
, 1) ) \

73 
’d_ex‹Á
 = 
i
; \

74 
¥l™
 = -1; \

77 *
¥aû
++ = 
pâ
; \

83 
	`£t_x’_gue¡_hªdË
((
_d_
)->
ex‹Á_¡¬t
, 
NULL
); \

84 
’d_ex‹Á
 = 
cmp
.
r¤v
.
Ä_ex‹Ás
; \

86 } 0)

	)

87 
	`XLAT_memÜy_»£rv©iÚ
(
Çt
.
r¤v
, &
cmp
.rsrv);

88 #undeà
XLAT_memÜy_»£rv©iÚ_HNDL_ex‹Á_¡¬t


90 iàĞ
’d_ex‹Á
 < 
cmp
.
r¤v
.
Ä_ex‹Ás
 )

92 
Çt
.
r¤v
->
Ä_ex‹Ás
 = 
’d_ex‹Á
;

93 ++
¥l™
;

98 
XENMEM_exchªge
:

100 
Üd”_d–
;

102 iàĞ
	`cİy_äom_gue¡
(&
cmp
.
xchg
, 
com·t
, 1) )

103  -
EFAULT
;

105 
Üd”_d–
 = 
cmp
.
xchg
.
out
.
ex‹Á_Üd”
 - cmp.xchg.
š
.extent_order;

107 iàĞ(
cmp
.
xchg
.
Ä_exchªged
 > cmp.xchg.
š
.
Ä_ex‹Ás
) ||

108 (
Üd”_d–
 > 0 && (
cmp
.
xchg
.
Ä_exchªged
 & ((1U << order_delta) - 1))) ||

110 ((~0U >> 
cmp
.
xchg
.
š
.
ex‹Á_Üd”
è< cmp.xchg.š.
Ä_ex‹Ás
) ||

111 ((~0U >> 
cmp
.
xchg
.
out
.
ex‹Á_Üd”
è< cmp.xchg.out.
Ä_ex‹Ás
) ||

113 ((
cmp
.
xchg
.
š
.
Ä_ex‹Ás
 << cmp.xchg.š.
ex‹Á_Üd”
) !=

114 (
cmp
.
xchg
.
out
.
Ä_ex‹Ás
 << cmp.xchg.out.
ex‹Á_Üd”
)) )

115  -
EINVAL
;

117 
¡¬t_ex‹Á
 = 
cmp
.
xchg
.
Ä_exchªged
;

118 
’d_ex‹Á
 = (
COMPAT_ARG_XLAT_SIZE
 - (*
Çt
.
xchg
)) /

119 (((1U << 
	`ABS
(
Üd”_d–
)) + 1) *

120 (*
¥aû
));

121 iàĞ
’d_ex‹Á
 == 0 )

123 
	`´štk
("Cannotranslate compatibility mode XENMEM_exchangeƒxtents (%u,%u)\n",

124 
cmp
.
xchg
.
š
.
ex‹Á_Üd”
, cmp.xchg.
out
.extent_order);

125  -
E2BIG
;

127 iàĞ
Üd”_d–
 > 0 )

128 
’d_ex‹Á
 <<ğ
Üd”_d–
;

129 
’d_ex‹Á
 +ğ
¡¬t_ex‹Á
;

130 iàĞ
’d_ex‹Á
 > 
cmp
.
xchg
.
š
.
Ä_ex‹Ás
 )

131 
’d_ex‹Á
 = 
cmp
.
xchg
.
š
.
Ä_ex‹Ás
;

133 
¥aû
 = (
x’_pâ_t
 *)(
Çt
.
xchg
 + 1);

135 
	`BUILD_BUG_ON
(
	`off£tof
(
x’_memÜy_exchªge_t
, 
š
è> off£tof(x’_memÜy_exchªge_t, 
out
));

136 
	#XLAT_memÜy_»£rv©iÚ_HNDL_ex‹Á_¡¬t
(
_d_
, 
_s_
) \

139 
	`£t_x’_gue¡_hªdË
((
_d_
)->
ex‹Á_¡¬t
, 
¥aû
 - 
¡¬t_ex‹Á
); \

140  
i
 = 
¡¬t_ex‹Á
; i < 
’d_ex‹Á
; ++i ) \

142 
com·t_pâ_t
 
pâ
; \

143 iàĞ
	`__cİy_äom_com·t_off£t
(&
pâ
, (
_s_
)->
ex‹Á_¡¬t
, 
i
, 1) ) \

144  -
EFAULT
; \

145 *
¥aû
++ = 
pâ
; \

147 iàĞ
Üd”_d–
 > 0 ) \

149 
¡¬t_ex‹Á
 >>ğ
Üd”_d–
; \

150 
’d_ex‹Á
 >>ğ
Üd”_d–
; \

154 
¡¬t_ex‹Á
 <<ğ-
Üd”_d–
; \

155 
’d_ex‹Á
 <<ğ-
Üd”_d–
; \

157 
Üd”_d–
 = -order_delta; \

158 } 0)

	)

159 
	`XLAT_memÜy_exchªge
(
Çt
.
xchg
, &
cmp
.xchg);

160 #undeà
XLAT_memÜy_»£rv©iÚ_HNDL_ex‹Á_¡¬t


162 iàĞ
’d_ex‹Á
 < 
cmp
.
xchg
.
š
.
Ä_ex‹Ás
 )

164 
Çt
.
xchg
->
š
.
Ä_ex‹Ás
 = 
’d_ex‹Á
;

165 iàĞ
Üd”_d–
 >= 0 )

166 
Çt
.
xchg
->
out
.
Ä_ex‹Ás
 = 
’d_ex‹Á
 >> 
Üd”_d–
;

168 
Çt
.
xchg
->
out
.
Ä_ex‹Ás
 = 
’d_ex‹Á
 << 
Üd”_d–
;

169 ++
¥l™
;

175 
XENMEM_cu¼’t_»£rv©iÚ
:

176 
XENMEM_maximum_»£rv©iÚ
:

177 
XENMEM_maximum_gpâ
:

178 
XENMEM_maximum_¿m_·ge
:

179 
Çt
.
hnd
 = 
com·t
;

183  
	`com·t_¬ch_memÜy_İ
(
cmd
, 
com·t
);

186 
rc
 = 
	`do_memÜy_İ
(
cmd
, 
Çt
.
hnd
);

187 iàĞ
rc
 < 0 )

188  
rc
;

190 
cmd
 = 0;

191 iàĞ
	`hy³rÿÎ_xÏt_cÚtšu©iÚ
(&
cmd
, 0x02, 
Çt
.
hnd
, 
com·t
) )

193 
	`BUG_ON
(
rc
 !ğ
__HYPERVISOR_memÜy_İ
);

194 
	`BUG_ON
((
cmd
 & 
MEMOP_CMD_MASK
è!ğ
İ
);

195 
¥l™
 = -1;

198  
İ
 )

200 
XENMEM_šü—£_»£rv©iÚ
:

201 
XENMEM_deü—£_»£rv©iÚ
:

202 
XENMEM_pİuÏ‹_physm­
:

203 
’d_ex‹Á
 = 
¥l™
 >ğ0 ? 
rc
 : 
cmd
 >> 
MEMOP_EXTENT_SHIFT
;

204 iàĞ(
İ
 !ğ
XENMEM_deü—£_»£rv©iÚ
) &&

205 !
	`gue¡_hªdË_is_nuÎ
(
Çt
.
r¤v
->
ex‹Á_¡¬t
) )

207  ; 
¡¬t_ex‹Á
 < 
’d_ex‹Á
; ++start_extent )

209 
com·t_pâ_t
 
pâ
 = 
Çt
.
r¤v
->
ex‹Á_¡¬t
.
p
[
¡¬t_ex‹Á
];

211 
	`BUG_ON
(
pâ
 !ğ
Çt
.
r¤v
->
ex‹Á_¡¬t
.
p
[
¡¬t_ex‹Á
]);

212 iàĞ
	`__cİy_to_com·t_off£t
(
cmp
.
r¤v
.
ex‹Á_¡¬t
,

213 
¡¬t_ex‹Á
, &
pâ
, 1) )

215 iàĞ
¥l™
 >= 0 )

217 
rc
 = 
¡¬t_ex‹Á
;

218 
¥l™
 = 0;

226 
rc
 = (
¡¬t_ex‹Á
 << 
MEMOP_EXTENT_SHIFT
è| 
İ
;

233 
¡¬t_ex‹Á
 = 
’d_ex‹Á
;

236 iàĞ(
¥l™
 >ğ0è&& (
’d_ex‹Á
 !ğ
Çt
.
r¤v
->
Ä_ex‹Ás
) )

237 
¥l™
 = 0;

240 
XENMEM_exchªge
:

242 
	`DEFINE_XEN_GUEST_HANDLE
(
com·t_memÜy_exchªge_t
);

243 
Üd”_d–
;

245 
	`BUG_ON
(
¥l™
 >ğ0 && 
rc
);

246 
	`BUG_ON
(
’d_ex‹Á
 < 
Çt
.
xchg
->
Ä_exchªged
);

247 
’d_ex‹Á
 = 
Çt
.
xchg
->
Ä_exchªged
;

249 
Üd”_d–
 = 
cmp
.
xchg
.
out
.
ex‹Á_Üd”
 - cmp.xchg.
š
.extent_order;

250 iàĞ
Üd”_d–
 > 0 )

252 
¡¬t_ex‹Á
 >>ğ
Üd”_d–
;

253 
	`BUG_ON
(
’d_ex‹Á
 & ((1U << 
Üd”_d–
) - 1));

254 
’d_ex‹Á
 >>ğ
Üd”_d–
;

258 
¡¬t_ex‹Á
 <<ğ-
Üd”_d–
;

259 
’d_ex‹Á
 <<ğ-
Üd”_d–
;

262  ; 
¡¬t_ex‹Á
 < 
’d_ex‹Á
; ++start_extent )

264 
com·t_pâ_t
 
pâ
 = 
Çt
.
xchg
->
out
.
ex‹Á_¡¬t
.
p
[
¡¬t_ex‹Á
];

266 
	`BUG_ON
(
pâ
 !ğ
Çt
.
xchg
->
out
.
ex‹Á_¡¬t
.
p
[
¡¬t_ex‹Á
]);

268 
	`__cİy_to_com·t_off£t
(
cmp
.
xchg
.
out
.
ex‹Á_¡¬t
, 
¡¬t_ex‹Á
, &
pâ
, 1);

271 
cmp
.
xchg
.
Ä_exchªged
 = 
Çt
.xchg->nr_exchanged;

272 iàĞ
	`cİy_f›ld_to_gue¡
(
	`gue¡_hªdË_ÿ¡
(
com·t
, 
com·t_memÜy_exchªge_t
),

273 &
cmp
.
xchg
, 
Ä_exchªged
) )

275 iàĞ
¥l™
 < 0 )

277 
	`domaš_üash
(
cu¼’t
->
domaš
);

278  -
EFAULT
;

283 
XENMEM_maximum_¿m_·ge
:

284 
XENMEM_cu¼’t_»£rv©iÚ
:

285 
XENMEM_maximum_»£rv©iÚ
:

286 
XENMEM_maximum_gpâ
:

290 
	`domaš_üash
(
cu¼’t
->
domaš
);

291 
¥l™
 = 0;

295 
cmd
 = 
İ
 | (
¡¬t_ex‹Á
 << 
MEMOP_EXTENT_SHIFT
);

296 iàĞ
¥l™
 > 0 && 
	`hy³rÿÎ_´“m±_check
() )

297  
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(

298 
__HYPERVISOR_memÜy_İ
, "ih", 
cmd
, 
com·t
);

299 }  
¥l™
 > 0 );

301  
rc
;

302 
	}
}

	@compat/multicall.c

5 
	~<x’/cÚfig.h
>

6 
	~<x’/ty³s.h
>

7 
	~<x’/muÉiÿÎ.h
>

9 
	#COMPAT


	)

10 
	t»t_t
;

11 #undeà
do_muÉiÿÎ_ÿÎ


13 
šlše
 
	$xÏt_muÉiÿÎ_’Œy
(
mc_¡©e
 *
mcs
)

15 
i
;

16 
i
=0; i<6; i++)

17 
mcs
->
com·t_ÿÎ
.
¬gs
[
i
] = mcs->
ÿÎ
.args[i];

18 
	}
}

20 
DEFINE_XEN_GUEST_HANDLE
(
muÉiÿÎ_’Œy_com·t_t
);

21 
	#muÉiÿÎ_’Œy
 
com·t_muÉiÿÎ_’Œy


	)

22 
	#muÉiÿÎ_’Œy_t
 
muÉiÿÎ_’Œy_com·t_t


	)

23 
	#do_muÉiÿÎ_ÿÎ
 
com·t_muÉiÿÎ_ÿÎ


	)

24 
	#ÿÎ
 
com·t_ÿÎ


	)

25 
	#do_muÉiÿÎ
(
l
, 
n
è
	`com·t_muÉiÿÎ
(
_
##l,‚)

	)

26 
	#_XEN_GUEST_HANDLE
(
t
è
	`XEN_GUEST_HANDLE
Ñ)

	)

28 
	~"../muÉiÿÎ.c
"

	@compat/schedule.c

6 
	~<com·t/sched.h
>

8 
	#COMPAT


	)

9 
	#»t_t
 

	)

11 
	#do_sched_İ
 
com·t_sched_İ


	)

13 
	#x’_sched_shutdown
 
sched_shutdown


	)

14 
	gCHECK_sched_shutdown
;

15 #undeà
x’_sched_shutdown


17 
	#x’_sched_»mÙe_shutdown
 
sched_»mÙe_shutdown


	)

18 
	gCHECK_sched_»mÙe_shutdown
;

19 #undeà
x’_sched_»mÙe_shutdown


21 
	$com·t_pŞl
(
com·t_sched_pŞl
 *
com·t
)

23 
sched_pŞl
 
Çtive
;

25 
	#XLAT_sched_pŞl_HNDL_pÜts
(
_d_
, 
_s_
) \

26 
	`gue¡_äom_com·t_hªdË
((
_d_
)->
pÜts
, (
_s_
)->pÜts)

	)

27 
	`XLAT_sched_pŞl
(&
Çtive
, 
com·t
);

28 #undeà
XLAT_sched_pŞl_HNDL_pÜts


30  
	`do_pŞl
(&
Çtive
);

31 
	}
}

33 
	#do_pŞl
 
com·t_pŞl


	)

34 
	#sched_pŞl
 
com·t_sched_pŞl


	)

36 
	~"../scheduË.c
"

38 
	$com·t_£t_tim”_İ
(
u32
 
lo
, 
s32
 
hi
)

40  
	`do_£t_tim”_İ
(((
s64
)
hi
 << 32è| 
lo
);

41 
	}
}

	@compat/tmem_xen.c

6 
	~<x’/cÚfig.h
>

7 
	~<x’/lib.h
>

8 
	~<x’/sched.h
>

9 
	~<x’/domaš.h
>

10 
	~<x’/gue¡_acûss.h
>

11 
	~<x’/hy³rÿÎ.h
>

12 
	~<com·t/tmem.h
>

14 
	#x’_tmem_İ
 
tmem_İ


	)

16 #undeà
x’_tmem_İ


	@compat/xenoprof.c

5 
	~<com·t/x’İrof.h
>

7 
	#COMPAT


	)

9 
	#do_x’İrof_İ
 
com·t_x’İrof_İ


	)

11 
	#x’_İrof_š™
 
x’İrof_š™


	)

12 
	gCHECK_İrof_š™
;

13 #undeà
x’_İrof_š™


15 
	#x’İrof_g‘_bufãr
 
com·t_İrof_g‘_bufãr


	)

16 
	#x’İrof_İ_g‘_bufãr
 
com·t_İrof_İ_g‘_bufãr


	)

17 
	#x’İrof_¬ch_couÁ”
 
com·t_İrof_¬ch_couÁ”


	)

19 
	#x’_domid_t
 
domid_t


	)

20 
	#com·t_domid_t
 
domid_com·t_t


	)

21 
CHECK_TYPE
(
domid
);

22 #undeà
com·t_domid_t


23 #undeà
x’_domid_t


25 
	#x’_İrof_·ssive
 
x’İrof_·ssive


	)

26 
	gCHECK_İrof_·ssive
;

27 #undeà
x’_İrof_·ssive


29 
	#x’İrof_couÁ”
 
com·t_İrof_couÁ”


	)

31 
	~"../x’İrof.c
"

	@compat/xlat.c

5 
	~<x’/com·t.h
>

6 
	~<x’/lib.h
>

7 
	~<com·t/x’.h
>

8 
	~<com·t/ev’t_chªÃl.h
>

9 
	~<com·t/vıu.h
>

12 
	$xÏt_¡¬t_šfo
(
¡¬t_šfo
 *
Çtive
,

13 
XLAT_¡¬t_šfo_cÚsŞe
 
cÚsŞe
)

15 
com·t_¡¬t_šfo
 *
com·t
 = (*)
Çtive
;

17 
	`BUILD_BUG_ON
((*
Çtive
è< (*
com·t
));

18 
	`XLAT_¡¬t_šfo
(
com·t
, 
Çtive
);

19 
	}
}

21 
	$xÏt_vıu_run¡©e_šfo
(
vıu_run¡©e_šfo
 *
Çtive
)

23 
com·t_vıu_run¡©e_šfo
 *
com·t
 = (*)
Çtive
;

25 
	`BUILD_BUG_ON
((*
Çtive
è< (*
com·t
));

26 
	`XLAT_vıu_run¡©e_šfo
(
com·t
, 
Çtive
);

27 
	}
}

29 
	#x’_dom0_vga_cÚsŞe_šfo
 
dom0_vga_cÚsŞe_šfo


	)

30 
	gCHECK_dom0_vga_cÚsŞe_šfo
;

31 #undeà
dom0_vga_cÚsŞe_šfo


33 
	#x’_evtchn_®loc_unbound
 
evtchn_®loc_unbound


	)

34 
	#x’_evtchn_bšd_š‹rdomaš
 
evtchn_bšd_š‹rdomaš


	)

35 
	#x’_evtchn_bšd_i
 
evtchn_bšd_i


	)

36 
	#x’_evtchn_bšd_pœq
 
evtchn_bšd_pœq


	)

37 
	#x’_evtchn_bšd_vıu
 
evtchn_bšd_vıu


	)

38 
	#x’_evtchn_bšd_vœq
 
evtchn_bšd_vœq


	)

39 
	#x’_evtchn_şo£
 
evtchn_şo£


	)

40 
	#x’_evtchn_İ
 
evtchn_İ


	)

41 
	#x’_evtchn_£nd
 
evtchn_£nd


	)

42 
	#x’_evtchn_¡©us
 
evtchn_¡©us


	)

43 
	#x’_evtchn_unmask
 
evtchn_unmask


	)

44 
	gCHECK_evtchn_İ
;

45 #undeà
x’_evtchn_®loc_unbound


46 #undeà
x’_evtchn_bšd_š‹rdomaš


47 #undeà
x’_evtchn_bšd_i


48 #undeà
x’_evtchn_bšd_pœq


49 #undeà
x’_evtchn_bšd_vıu


50 #undeà
x’_evtchn_bšd_vœq


51 #undeà
x’_evtchn_şo£


52 #undeà
x’_evtchn_İ


53 #undeà
x’_evtchn_£nd


54 #undeà
x’_evtchn_¡©us


55 #undeà
x’_evtchn_unmask


57 
	#x’_mmu_upd©e
 
mmu_upd©e


	)

58 
	gCHECK_mmu_upd©e
;

59 #undeà
x’_mmu_upd©e


61 
	#x’_vıu_time_šfo
 
vıu_time_šfo


	)

62 
	gCHECK_vıu_time_šfo
;

63 #undeà
x’_vıu_time_šfo


	@cpu.c

1 
	~<x’/cÚfig.h
>

2 
	~<x’/ıumask.h
>

3 
	~<x’/ıu.h
>

4 
	~<x’/ev’t.h
>

5 
	~<x’/sched.h
>

6 
	~<x’/¡İ_machše.h
>

17 
	#MASK_DECLARE_1
(
x
è[x+1][0] = 1UL << (x)

	)

18 
	#MASK_DECLARE_2
(
x
è
	`MASK_DECLARE_1
(x), MASK_DECLARE_1(x+1)

	)

19 
	#MASK_DECLARE_4
(
x
è
	`MASK_DECLARE_2
(x), MASK_DECLARE_2(x+2)

	)

20 
	#MASK_DECLARE_8
(
x
è
	`MASK_DECLARE_4
(x), MASK_DECLARE_4(x+4)

	)

22 cÚ¡ 
	gıu_b™_b™m­
[
BITS_PER_LONG
+1][
BITS_TO_LONGS
(
NR_CPUS
)] = {

24 
MASK_DECLARE_8
(0), MASK_DECLARE_8(8),

25 
MASK_DECLARE_8
(16), MASK_DECLARE_8(24),

26 #ià
BITS_PER_LONG
 > 32

27 
MASK_DECLARE_8
(32), MASK_DECLARE_8(40),

28 
MASK_DECLARE_8
(48), MASK_DECLARE_8(56),

32 
DEFINE_SPINLOCK
(
ıu_add_»move_lock
);

34 
boŞ_t
 
	$g‘_ıu_m­s
()

36  
	`¥š_Œylock_»cursive
(&
ıu_add_»move_lock
);

37 
	}
}

39 
	$put_ıu_m­s
()

41 
	`¥š_uÆock_»cursive
(&
ıu_add_»move_lock
);

42 
	}
}

44 
boŞ_t
 
	$ıu_hÙ¶ug_begš
()

46  
	`g‘_ıu_m­s
();

47 
	}
}

49 
	$ıu_hÙ¶ug_dÚe
()

51 
	`put_ıu_m­s
();

52 
	}
}

54 
NOTIFIER_HEAD
(
ıu_chaš
);

56 
	$»gi¡”_ıu_nÙif›r
(
nÙif›r_block
 *
nb
)

58 iàĞ!
	`¥š_Œylock
(&
ıu_add_»move_lock
) )

59 
	`BUG
();

60 
	`nÙif›r_chaš_»gi¡”
(&
ıu_chaš
, 
nb
);

61 
	`¥š_uÆock
(&
ıu_add_»move_lock
);

62 
	}
}

64 
	$ke_ıu_down
(*
unu£d
)

66 *
hıu
 = (*)()
	`smp_´oûssÜ_id
();

67 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_DYING
, 
hıu
, 
NULL
);

68 
	`BUG_ON
(
nÙif›r_rc
 !ğ
NOTIFY_DONE
);

69 
	`__ıu_di§bË
();

71 
	}
}

73 
	$ıu_down
(
ıu
)

75 
”r
, 
nÙif›r_rc
;

76 *
hıu
 = (*)()
ıu
;

77 
nÙif›r_block
 *
nb
 = 
NULL
;

79 iàĞ!
	`ıu_hÙ¶ug_begš
() )

80  -
EBUSY
;

82 iàĞ(
ıu
 >ğ
NR_CPUS
è|| (ıu =ğ0è|| !
	`ıu_Úlše
(cpu) )

84 
	`ıu_hÙ¶ug_dÚe
();

85  -
EINVAL
;

88 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_DOWN_PREPARE
, 
hıu
, &
nb
);

89 iàĞ
nÙif›r_rc
 !ğ
NOTIFY_DONE
 )

91 
”r
 = 
	`nÙif›r_to_”ºo
(
nÙif›r_rc
);

92 
ç
;

95 iàĞ(
”r
 = 
	`¡İ_machše_run
(
ke_ıu_down
, 
NULL
, 
ıu
)) < 0 )

96 
ç
;

98 
	`__ıu_d›
(
ıu
);

99 
	`BUG_ON
(
	`ıu_Úlše
(
ıu
));

101 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_DEAD
, 
hıu
, 
NULL
);

102 
	`BUG_ON
(
nÙif›r_rc
 !ğ
NOTIFY_DONE
);

104 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_PCPU_STATE
);

105 
	`ıu_hÙ¶ug_dÚe
();

108 
ç
:

109 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_DOWN_FAILED
, 
hıu
, &
nb
);

110 
	`BUG_ON
(
nÙif›r_rc
 !ğ
NOTIFY_DONE
);

111 
	`ıu_hÙ¶ug_dÚe
();

112  
”r
;

113 
	}
}

115 
	$ıu_up
(
ıu
)

117 
nÙif›r_rc
, 
”r
 = 0;

118 *
hıu
 = (*)()
ıu
;

119 
nÙif›r_block
 *
nb
 = 
NULL
;

121 iàĞ!
	`ıu_hÙ¶ug_begš
() )

122  -
EBUSY
;

124 iàĞ(
ıu
 >ğ
NR_CPUS
è|| 
	`ıu_Úlše
(ıuè|| !
	`ıu_´e£Á
(cpu) )

126 
	`ıu_hÙ¶ug_dÚe
();

127  -
EINVAL
;

130 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_UP_PREPARE
, 
hıu
, &
nb
);

131 iàĞ
nÙif›r_rc
 !ğ
NOTIFY_DONE
 )

133 
”r
 = 
	`nÙif›r_to_”ºo
(
nÙif›r_rc
);

134 
ç
;

137 
”r
 = 
	`__ıu_up
(
ıu
);

138 iàĞ
”r
 < 0 )

139 
ç
;

141 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_ONLINE
, 
hıu
, 
NULL
);

142 
	`BUG_ON
(
nÙif›r_rc
 !ğ
NOTIFY_DONE
);

144 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_PCPU_STATE
);

146 
	`ıu_hÙ¶ug_dÚe
();

149 
ç
:

150 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(&
ıu_chaš
, 
CPU_UP_CANCELED
, 
hıu
, &
nb
);

151 
	`BUG_ON
(
nÙif›r_rc
 !ğ
NOTIFY_DONE
);

152 
	`ıu_hÙ¶ug_dÚe
();

153  
”r
;

154 
	}
}

156 
	$nÙify_ıu_¡¬tšg
(
ıu
)

158 *
hıu
 = (*)()
ıu
;

159 
nÙif›r_rc
 = 
	`nÙif›r_ÿÎ_chaš
(

160 &
ıu_chaš
, 
CPU_STARTING
, 
hıu
, 
NULL
);

161 
	`BUG_ON
(
nÙif›r_rc
 !ğ
NOTIFY_DONE
);

162 
	}
}

164 
ıumask_t
 
	gäoz’_ıus
;

166 
	$di§bË_nÚboÙ_ıus
()

168 
ıu
, 
”rÜ
 = 0;

170 
	`BUG_ON
(
	`smp_´oûssÜ_id
() != 0);

172 
	`ıus_ş—r
(
äoz’_ıus
);

174 
	`´štk
("Disabling‚on-boot CPUs ...\n");

176 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

178 iàĞ
ıu
 == 0 )

181 iàĞ(
”rÜ
 = 
	`ıu_down
(
ıu
)) )

183 
	`BUG_ON
(
”rÜ
 =ğ-
EBUSY
);

184 
	`´štk
("E¼Üakšg CPU%d down: %d\n", 
ıu
, 
”rÜ
);

188 
	`ıu_£t
(
ıu
, 
äoz’_ıus
);

191 
	`BUG_ON
(!
”rÜ
 && (
	`num_Úlše_ıus
() != 1));

192  
”rÜ
;

193 
	}
}

195 
	$’abË_nÚboÙ_ıus
()

197 
ıu
, 
”rÜ
;

199 
	`´štk
("Enabling‚on-boot CPUs ...\n");

201 
	`fÜ_—ch_ıu_mask
 ( 
ıu
, 
äoz’_ıus
 )

203 iàĞ(
”rÜ
 = 
	`ıu_up
(
ıu
)) )

205 
	`BUG_ON
(
”rÜ
 =ğ-
EBUSY
);

206 
	`´štk
("E¼Üakšg CPU%d up: %d\n", 
ıu
, 
”rÜ
);

210 
	`ıus_ş—r
(
äoz’_ıus
);

211 
	}
}

	@cpupool.c

14 
	~<x’/lib.h
>

15 
	~<x’/š™.h
>

16 
	~<x’/ıumask.h
>

17 
	~<x’/³rıu.h
>

18 
	~<x’/sched.h
>

19 
	~<x’/sched-if.h
>

20 
	~<x’/ıu.h
>

22 
	#fÜ_—ch_ıupoŞ
(
±r
) \

23 (
±r
èğ&
ıupoŞ_li¡
; *ÕŒè!ğ
NULL
; (±rèğ&((*ÕŒ))->
Ãxt
))

	)

25 
ıupoŞ
 *
	gıupoŞ0
;

26 
ıumask_t
 
	gıupoŞ_ä“_ıus
;

28 
ıupoŞ
 *
	gıupoŞ_li¡
;

30 
	gıupoŞ_movšg_ıu
 = -1;

31 
ıupoŞ
 *
	gıupoŞ_ıu_movšg
 = 
NULL
;

32 
ıumask_t
 
	gıupoŞ_locked_ıus
 = 
CPU_MASK_NONE
;

34 
DEFINE_SPINLOCK
(
ıupoŞ_lock
);

36 
DEFINE_PER_CPU
(
ıupoŞ
 *, cpupool);

38 
	#ıupoŞ_d´štk
(
x
...è(()0)

	)

40 
ıupoŞ
 *
	$®loc_ıupoŞ_¡ruù
()

42  
	`xm®loc
(
ıupoŞ
);

43 
	}
}

45 
	$ä“_ıupoŞ_¡ruù
(
ıupoŞ
 *
c
)

47 
	`xä“
(
c
);

48 
	}
}

56 
ıupoŞ
 *
	$__ıupoŞ_fšd_by_id
(
id
, 
exaù
)

58 
ıupoŞ
 **
q
;

60 
	`ASSERT
(
	`¥š_is_locked
(&
ıupoŞ_lock
));

62 
	`fÜ_—ch_ıupoŞ
(
q
)

63 iàĞ(*
q
)->
ıupoŞ_id
 >ğ
id
 )

66  (!
exaù
 || (*
q
 =ğ
NULL
è|| ((*q)->
ıupoŞ_id
 =ğ
id
)) ? *q : NULL;

67 
	}
}

69 
ıupoŞ
 *
	$ıupoŞ_fšd_by_id
(
poŞid
)

71  
	`__ıupoŞ_fšd_by_id
(
poŞid
, 1);

72 
	}
}

74 
ıupoŞ
 *
	$__ıupoŞ_g‘_by_id
(
poŞid
, 
exaù
)

76 
ıupoŞ
 *
c
;

77 
	`¥š_lock
(&
ıupoŞ_lock
);

78 
c
 = 
	`__ıupoŞ_fšd_by_id
(
poŞid
, 
exaù
);

79 iàĞ
c
 !ğ
NULL
 )

80 
	`©omic_šc
(&
c
->
»fút
);

81 
	`¥š_uÆock
(&
ıupoŞ_lock
);

82  
c
;

83 
	}
}

85 
ıupoŞ
 *
	$ıupoŞ_g‘_by_id
(
poŞid
)

87  
	`__ıupoŞ_g‘_by_id
(
poŞid
, 1);

88 
	}
}

90 
ıupoŞ
 *
	$ıupoŞ_g‘_Ãxt_by_id
(
poŞid
)

92  
	`__ıupoŞ_g‘_by_id
(
poŞid
, 0);

93 
	}
}

95 
	$ıupoŞ_put
(
ıupoŞ
 *
poŞ
)

97 iàĞ!
	`©omic_dec_ªd_‹¡
(&
poŞ
->
»fút
) )

99 
	`scheduËr_ä“
(
poŞ
->
sched
);

100 
	`ä“_ıupoŞ_¡ruù
(
poŞ
);

101 
	}
}

111 
ıupoŞ
 *
	$ıupoŞ_ü—‹
(

112 
poŞid
, 
sched_id
, *
³¼
)

114 
ıupoŞ
 *
c
;

115 
ıupoŞ
 **
q
;

116 
Ï¡
 = 0;

118 *
³¼
 = -
ENOMEM
;

119 iàĞ(
c
 = 
	`®loc_ıupoŞ_¡ruù
()è=ğ
NULL
 )

120  
NULL
;

121 
	`mem£t
(
c
, 0, (*c));

124 
	`©omic_£t
(&
c
->
»fút
, 2);

126 
	`ıupoŞ_d´štk
("ıupoŞ_ü—‹ÕoŞ=%d,sched=%u)\n", 
poŞid
, 
sched_id
);

128 
	`¥š_lock
(&
ıupoŞ_lock
);

130 
	`fÜ_—ch_ıupoŞ
(
q
)

132 
Ï¡
 = (*
q
)->
ıupoŞ_id
;

133 iàĞ(
poŞid
 !ğ
CPUPOOLID_NONE
è&& (
Ï¡
 >=…oolid) )

136 iàĞ*
q
 !ğ
NULL
 )

138 iàĞ(*
q
)->
ıupoŞ_id
 =ğ
poŞid
 )

140 
	`¥š_uÆock
(&
ıupoŞ_lock
);

141 
	`ä“_ıupoŞ_¡ruù
(
c
);

142 *
³¼
 = -
EEXIST
;

143  
NULL
;

145 
c
->
Ãxt
 = *
q
;

148 
c
->
ıupoŞ_id
 = (
poŞid
 =ğ
CPUPOOLID_NONE
è? (
Ï¡
 + 1) :…oolid;

149 iàĞ
poŞid
 == 0 )

151 
c
->
sched
 = 
	`scheduËr_g‘_deçuÉ
();

155 
c
->
sched
 = 
	`scheduËr_®loc
(
sched_id
, 
³¼
);

156 iàĞ
c
->
sched
 =ğ
NULL
 )

158 
	`¥š_uÆock
(&
ıupoŞ_lock
);

159 
	`ä“_ıupoŞ_¡ruù
(
c
);

160  
NULL
;

164 *
q
 = 
c
;

166 
	`¥š_uÆock
(&
ıupoŞ_lock
);

168 
	`ıupoŞ_d´štk
("Created cpupool %d with scheduler %s (%s)\n",

169 
c
->
ıupoŞ_id
, c->
sched
->
Çme
, c->sched->
İt_Çme
);

171 *
³¼
 = 0;

172  
c
;

173 
	}
}

182 
	$ıupoŞ_de¡roy
(
ıupoŞ
 *
c
)

184 
ıupoŞ
 **
q
;

186 
	`¥š_lock
(&
ıupoŞ_lock
);

187 
	`fÜ_—ch_ıupoŞ
(
q
)

188 iàĞ*
q
 =ğ
c
 )

190 iàĞ*
q
 !ğ
c
 )

192 
	`¥š_uÆock
(&
ıupoŞ_lock
);

193  -
ENOENT
;

195 iàĞ(
c
->
n_dom
 !ğ0è|| 
	`ıus_weight
(c->
ıu_v®id
) )

197 
	`¥š_uÆock
(&
ıupoŞ_lock
);

198  -
EBUSY
;

200 *
q
 = 
c
->
Ãxt
;

201 
	`¥š_uÆock
(&
ıupoŞ_lock
);

203 
	`ıupoŞ_put
(
c
);

205 
	`ıupoŞ_d´štk
("ıupoŞ_de¡royÕoŞ=%d)\n", 
c
->
ıupoŞ_id
);

207 
	}
}

213 
	$ıupoŞ_assign_ıu_locked
(
ıupoŞ
 *
c
, 
ıu
)

215 
»t
;

216 
ıupoŞ
 *
Şd
;

218 iàĞ(
ıupoŞ_movšg_ıu
 =ğ
ıu
è&& (
c
 !ğ
ıupoŞ_ıu_movšg
) )

219  -
EBUSY
;

220 
Şd
 = 
	`³r_ıu
(
ıupoŞ
, 
ıu
);

221 
	`³r_ıu
(
ıupoŞ
, 
ıu
èğ
c
;

222 
»t
 = 
	`scheduË_ıu_sw™ch
(
ıu
, 
c
);

223 iàĞ
»t
 )

225 
	`³r_ıu
(
ıupoŞ
, 
ıu
èğ
Şd
;

226  
»t
;

229 
	`ıu_ş—r
(
ıu
, 
ıupoŞ_ä“_ıus
);

230 ià(
ıupoŞ_movšg_ıu
 =ğ
ıu
)

232 
ıupoŞ_movšg_ıu
 = -1;

233 
	`ıupoŞ_put
(
ıupoŞ_ıu_movšg
);

234 
ıupoŞ_ıu_movšg
 = 
NULL
;

236 
	`ıu_£t
(
ıu
, 
c
->
ıu_v®id
);

238 
	}
}

240 
	$ıupoŞ_uÇssign_ıu_h–³r
(*
šfo
)

242 
ıu
 = 
ıupoŞ_movšg_ıu
;

243 
»t
;

245 
	`ıupoŞ_d´štk
("cpupool_unassign_cpu(pool=%d,cpu=%d)\n",

246 
ıupoŞ_ıu_movšg
->
ıupoŞ_id
, 
ıu
);

248 
	`¥š_lock
(&
ıupoŞ_lock
);

249 
»t
 = 
	`ıu_di§bË_scheduËr
(
ıu
);

250 
	`ıu_£t
(
ıu
, 
ıupoŞ_ä“_ıus
);

251 iàĞ!
»t
 )

253 
»t
 = 
	`scheduË_ıu_sw™ch
(
ıu
, 
NULL
);

254 iàĞ
»t
 )

256 
	`ıu_ş—r
(
ıu
, 
ıupoŞ_ä“_ıus
);

257 
out
;

259 
	`³r_ıu
(
ıupoŞ
, 
ıu
èğ
NULL
;

260 
ıupoŞ_movšg_ıu
 = -1;

261 
	`ıupoŞ_put
(
ıupoŞ_ıu_movšg
);

262 
ıupoŞ_ıu_movšg
 = 
NULL
;

265 
out
:

266 
	`¥š_uÆock
(&
ıupoŞ_lock
);

267 
	`ıupoŞ_d´štk
("ıupoŞ_uÇssign_ıu„‘=%ld\n", 
»t
);

268  
»t
;

269 
	}
}

283 
	$ıupoŞ_uÇssign_ıu
(
ıupoŞ
 *
c
, 
ıu
)

285 
wÜk_ıu
;

286 
»t
;

287 
domaš
 *
d
;

289 
	`ıupoŞ_d´štk
("cpupool_unassign_cpu(pool=%d,cpu=%d)\n",

290 
c
->
ıupoŞ_id
, 
ıu
);

292 
	`¥š_lock
(&
ıupoŞ_lock
);

293 
»t
 = -
EBUSY
;

294 iàĞ(
ıupoŞ_movšg_ıu
 !ğ-1è&& (
ıu
 != cpupool_moving_cpu) )

295 
out
;

296 iàĞ
	`ıu_is£t
(
ıu
, 
ıupoŞ_locked_ıus
) )

297 
out
;

299 
»t
 = 0;

300 iàĞ!
	`ıu_is£t
(
ıu
, 
c
->
ıu_v®id
è&& (ıu !ğ
ıupoŞ_movšg_ıu
) )

301 
out
;

303 iàĞ(
c
->
n_dom
 > 0è&& (
	`ıus_weight
(c->
ıu_v®id
) == 1) &&

304 (
ıu
 !ğ
ıupoŞ_movšg_ıu
) )

306 
	`fÜ_—ch_domaš
(
d
)

308 iàĞ
d
->
ıupoŞ
 !ğ
c
 )

310 iàĞ!
d
->
is_dyšg
 )

312 
»t
 = -
EBUSY
;

315 
c
->
n_dom
--;

316 
»t
 = 
	`sched_move_domaš
(
d
, 
ıupoŞ0
);

317 iàĞ
»t
 )

319 
c
->
n_dom
++;

322 
ıupoŞ0
->
n_dom
++;

324 iàĞ
»t
 )

325 
out
;

327 
ıupoŞ_movšg_ıu
 = 
ıu
;

328 
	`©omic_šc
(&
c
->
»fút
);

329 
ıupoŞ_ıu_movšg
 = 
c
;

330 
	`ıu_ş—r
(
ıu
, 
c
->
ıu_v®id
);

331 
	`¥š_uÆock
(&
ıupoŞ_lock
);

333 
wÜk_ıu
 = 
	`smp_´oûssÜ_id
();

334 iàĞ
wÜk_ıu
 =ğ
ıu
 )

336 
wÜk_ıu
 = 
	`fœ¡_ıu
(
ıupoŞ0
->
ıu_v®id
);

337 iàĞ
wÜk_ıu
 =ğ
ıu
 )

338 
wÜk_ıu
 = 
	`Ãxt_ıu
(
ıu
, 
ıupoŞ0
->
ıu_v®id
);

340  
	`cÚtšue_hy³rÿÎ_Ú_ıu
(
wÜk_ıu
, 
ıupoŞ_uÇssign_ıu_h–³r
, 
c
);

342 
out
:

343 
	`¥š_uÆock
(&
ıupoŞ_lock
);

344 
	`ıupoŞ_d´štk
("cpupool_unassign_cpu(pool=%d,cpu=%d)„et %d\n",

345 
c
->
ıupoŞ_id
, 
ıu
, 
»t
);

346  
»t
;

347 
	}
}

355 
	$ıupoŞ_add_domaš
(
domaš
 *
d
, 
poŞid
)

357 
ıupoŞ
 *
c
;

358 
rc
 = 1;

359 
n_dom
 = 0;

361 iàĞ
poŞid
 =ğ
CPUPOOLID_NONE
 )

363 
	`¥š_lock
(&
ıupoŞ_lock
);

364 
c
 = 
	`ıupoŞ_fšd_by_id
(
poŞid
);

365 iàĞ(
c
 !ğ
NULL
è&& 
	`ıus_weight
(c->
ıu_v®id
) )

367 
c
->
n_dom
++;

368 
n_dom
 = 
c
->n_dom;

369 
d
->
ıupoŞ
 = 
c
;

370 
rc
 = 0;

372 
	`¥š_uÆock
(&
ıupoŞ_lock
);

373 
	`ıupoŞ_d´štk
("cpupool_add_domain(dom=%d,pool=%d)‚_dom %d„c %d\n",

374 
d
->
domaš_id
, 
poŞid
, 
n_dom
, 
rc
);

375  
rc
;

376 
	}
}

381 
	$ıupoŞ_rm_domaš
(
domaš
 *
d
)

383 
ıupoŞ_id
;

384 
n_dom
;

386 iàĞ
d
->
ıupoŞ
 =ğ
NULL
 )

388 
	`¥š_lock
(&
ıupoŞ_lock
);

389 
ıupoŞ_id
 = 
d
->
ıupoŞ
->cpupool_id;

390 
d
->
ıupoŞ
->
n_dom
--;

391 
n_dom
 = 
d
->
ıupoŞ
->n_dom;

392 
d
->
ıupoŞ
 = 
NULL
;

393 
	`¥š_uÆock
(&
ıupoŞ_lock
);

394 
	`ıupoŞ_d´štk
("cpupool_rm_domain(dom=%d,pool=%d)‚_dom %d\n",

395 
d
->
domaš_id
, 
ıupoŞ_id
, 
n_dom
);

397 
	}
}

403 
	$ıupoŞ_ıu_add
(
ıu
)

405 
	`¥š_lock
(&
ıupoŞ_lock
);

406 
	`ıu_ş—r
(
ıu
, 
ıupoŞ_locked_ıus
);

407 
	`ıu_£t
(
ıu
, 
ıupoŞ_ä“_ıus
);

408 
	`ıupoŞ_assign_ıu_locked
(
ıupoŞ0
, 
ıu
);

409 
	`¥š_uÆock
(&
ıupoŞ_lock
);

410 
	}
}

417 
	$ıupoŞ_ıu_»move
(
ıu
)

419 
»t
 = 0;

421 
	`¥š_lock
(&
ıupoŞ_lock
);

422 iàĞ!
	`ıu_is£t
(
ıu
, 
ıupoŞ0
->
ıu_v®id
))

423 
»t
 = -
EBUSY
;

425 
	`ıu_£t
(
ıu
, 
ıupoŞ_locked_ıus
);

426 
	`¥š_uÆock
(&
ıupoŞ_lock
);

428  
»t
;

429 
	}
}

434 
	$ıupoŞ_do_sysùl
(
x’_sysùl_ıupoŞ_İ
 *
İ
)

436 
»t
;

437 
ıupoŞ
 *
c
;

439  
İ
->op )

442 
XEN_SYSCTL_CPUPOOL_OP_CREATE
:

444 
poŞid
;

446 
poŞid
 = (
İ
->
ıupoŞ_id
 =ğ
XEN_SYSCTL_CPUPOOL_PAR_ANY
) ?

447 
CPUPOOLID_NONE
: 
İ
->
ıupoŞ_id
;

448 
c
 = 
	`ıupoŞ_ü—‹
(
poŞid
, 
İ
->
sched_id
, &
»t
);

449 iàĞ
c
 !ğ
NULL
 )

451 
İ
->
ıupoŞ_id
 = 
c
->cpupool_id;

452 
	`ıupoŞ_put
(
c
);

457 
XEN_SYSCTL_CPUPOOL_OP_DESTROY
:

459 
c
 = 
	`ıupoŞ_g‘_by_id
(
İ
->
ıupoŞ_id
);

460 
»t
 = -
ENOENT
;

461 iàĞ
c
 =ğ
NULL
 )

463 
»t
 = 
	`ıupoŞ_de¡roy
(
c
);

464 
	`ıupoŞ_put
(
c
);

468 
XEN_SYSCTL_CPUPOOL_OP_INFO
:

470 
c
 = 
	`ıupoŞ_g‘_Ãxt_by_id
(
İ
->
ıupoŞ_id
);

471 
»t
 = -
ENOENT
;

472 iàĞ
c
 =ğ
NULL
 )

474 
İ
->
ıupoŞ_id
 = 
c
->cpupool_id;

475 
İ
->
sched_id
 = 
c
->
sched
->sched_id;

476 
İ
->
n_dom
 = 
c
->n_dom;

477 
»t
 = 
	`ıumask_to_x’ùl_ıum­
(&
İ
->
ıum­
, &
c
->
ıu_v®id
);

478 
	`ıupoŞ_put
(
c
);

482 
XEN_SYSCTL_CPUPOOL_OP_ADDCPU
:

484 
ıu
;

486 
ıu
 = 
İ
->cpu;

487 
	`ıupoŞ_d´štk
("cpupool_assign_cpu(pool=%d,cpu=%d)\n",

488 
İ
->
ıupoŞ_id
, 
ıu
);

489 
	`¥š_lock
(&
ıupoŞ_lock
);

490 iàĞ
ıu
 =ğ
XEN_SYSCTL_CPUPOOL_PAR_ANY
 )

491 
ıu
 = 
	`fœ¡_ıu
(
ıupoŞ_ä“_ıus
);

492 
»t
 = -
EINVAL
;

493 iàĞ
ıu
 >ğ
NR_CPUS
 )

494 
addıu_out
;

495 
»t
 = -
EBUSY
;

496 iàĞ!
	`ıu_is£t
(
ıu
, 
ıupoŞ_ä“_ıus
) )

497 
addıu_out
;

498 
c
 = 
	`ıupoŞ_fšd_by_id
(
İ
->
ıupoŞ_id
);

499 
»t
 = -
ENOENT
;

500 iàĞ
c
 =ğ
NULL
 )

501 
addıu_out
;

502 
»t
 = 
	`ıupoŞ_assign_ıu_locked
(
c
, 
ıu
);

503 
addıu_out
:

504 
	`¥š_uÆock
(&
ıupoŞ_lock
);

505 
	`ıupoŞ_d´štk
("cpupool_assign_cpu(pool=%d,cpu=%d)„et %d\n",

506 
İ
->
ıupoŞ_id
, 
ıu
, 
»t
);

510 
XEN_SYSCTL_CPUPOOL_OP_RMCPU
:

512 
ıu
;

514 
c
 = 
	`ıupoŞ_g‘_by_id
(
İ
->
ıupoŞ_id
);

515 
»t
 = -
ENOENT
;

516 iàĞ
c
 =ğ
NULL
 )

518 
ıu
 = 
İ
->cpu;

519 iàĞ
ıu
 =ğ
XEN_SYSCTL_CPUPOOL_PAR_ANY
 )

520 
ıu
 = 
	`Ï¡_ıu
(
c
->
ıu_v®id
);

521 
»t
 = (
ıu
 < 
NR_CPUS
è? 
	`ıupoŞ_uÇssign_ıu
(
c
, cpuè: -
EINVAL
;

522 
	`ıupoŞ_put
(
c
);

526 
XEN_SYSCTL_CPUPOOL_OP_MOVEDOMAIN
:

528 
domaš
 *
d
;

530 
»t
 = -
EINVAL
;

531 iàĞ
İ
->
domid
 == 0 )

533 
»t
 = -
ESRCH
;

534 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domid
);

535 iàĞ
d
 =ğ
NULL
 )

537 iàĞ
d
->
ıupoŞ
 =ğ
NULL
 )

539 
»t
 = -
EINVAL
;

540 
	`rcu_uÆock_domaš
(
d
);

543 iàĞ
İ
->
ıupoŞ_id
 =ğ
d
->
ıupoŞ
->cpupool_id )

545 
»t
 = 0;

546 
	`rcu_uÆock_domaš
(
d
);

549 
	`ıupoŞ_d´štk
("cpupool move_domain(dom=%d)->pool=%d\n",

550 
d
->
domaš_id
, 
İ
->
ıupoŞ_id
);

551 
»t
 = -
ENOENT
;

552 
	`¥š_lock
(&
ıupoŞ_lock
);

553 
c
 = 
	`ıupoŞ_fšd_by_id
(
İ
->
ıupoŞ_id
);

554 iàĞ(
c
 !ğ
NULL
è&& 
	`ıus_weight
(c->
ıu_v®id
) )

556 
d
->
ıupoŞ
->
n_dom
--;

557 
»t
 = 
	`sched_move_domaš
(
d
, 
c
);

558 iàĞ
»t
 )

559 
d
->
ıupoŞ
->
n_dom
++;

561 
c
->
n_dom
++;

563 
	`¥š_uÆock
(&
ıupoŞ_lock
);

564 
	`ıupoŞ_d´štk
("cpupool move_domain(dom=%d)->pool=%d„et %d\n",

565 
d
->
domaš_id
, 
İ
->
ıupoŞ_id
, 
»t
);

566 
	`rcu_uÆock_domaš
(
d
);

570 
XEN_SYSCTL_CPUPOOL_OP_FREEINFO
:

572 
»t
 = 
	`ıumask_to_x’ùl_ıum­
(

573 &
İ
->
ıum­
, &
ıupoŞ_ä“_ıus
);

578 
»t
 = -
ENOSYS
;

582  
»t
;

583 
	}
}

585 
scheduË_dump
(
ıupoŞ
 *
c
);

587 
	$dump_runq
(
key
)

589 
æags
;

590 
s_time_t
 
now
 = 
	`NOW
();

591 
ıupoŞ
 **
c
;

593 
	`¥š_lock
(&
ıupoŞ_lock
);

594 
	`loÿl_œq_§ve
(
æags
);

596 
	`´štk
("sched_smt_power_savings: %s\n",

597 
sched_smt_pow”_§všgs
? "enabled":"disabled");

598 
	`´štk
("NOW=0x%08X%08X\n", (
u32
)(
now
>>32), (u32)now);

600 
	`´štk
("Idle cpupool:\n");

601 
	`scheduË_dump
(
NULL
);

603 
	`fÜ_—ch_ıupoŞ
(
c
)

605 
	`´štk
("CpupoŞ %d:\n", (*
c
)->
ıupoŞ_id
);

606 
	`scheduË_dump
(*
c
);

609 
	`loÿl_œq_»¡Üe
(
æags
);

610 
	`¥š_uÆock
(&
ıupoŞ_lock
);

611 
	}
}

613 
	$ıu_ÿÎback
(

614 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

616 
ıu
 = ()
hıu
;

617 
rc
 = 0;

619  
aùiÚ
 )

621 
CPU_DOWN_FAILED
:

622 
CPU_ONLINE
:

623 
	`ıupoŞ_ıu_add
(
ıu
);

625 
CPU_DOWN_PREPARE
:

626 
rc
 = 
	`ıupoŞ_ıu_»move
(
ıu
);

632  !
rc
 ? 
NOTIFY_DONE
 : 
	`nÙif›r_äom_”ºo
(rc);

633 
	}
}

635 
nÙif›r_block
 
	gıu_nfb
 = {

636 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback


639 
__š™
 
	$ıupoŞ_´esmp_š™
()

641 
”r
;

642 *
ıu
 = (*)()
	`smp_´oûssÜ_id
();

643 
ıupoŞ0
 = 
	`ıupoŞ_ü—‹
(0, 0, &
”r
);

644 
	`BUG_ON
(
ıupoŞ0
 =ğ
NULL
);

645 
	`ıupoŞ_put
(
ıupoŞ0
);

646 
	`ıu_ÿÎback
(&
ıu_nfb
, 
CPU_ONLINE
, 
ıu
);

647 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

649 
	}
}

650 
´esmp_š™ÿÎ
(
ıupoŞ_´esmp_š™
);

	@decompress.c

1 
	~<x’/cÚfig.h
>

2 
	~<x’/š™.h
>

3 
	~<x’/lib.h
>

4 
	~<x’/¡ršg.h
>

5 
	~<x’/decom´ess.h
>

7 
__š™
 
	$”rÜ
(cÚ¡ *
msg
)

9 
	`´štk
("%s\n", 
msg
);

10 
	}
}

12 
__š™
 
	$decom´ess
(*
šbuf
, 
Ën
, *
outbuf
)

15 iàĞ
Ën
 >= 2 &&

16 (!
	`memcmp
(
šbuf
, "\037\213", 2) || !memcmp(inbuf, "\037\236", 2)) )

17  
	`gunz
(
šbuf
, 
Ën
, 
NULL
, NULL, 
outbuf
, NULL, 
”rÜ
);

20 iàĞ
Ën
 >ğ3 && !
	`memcmp
(
šbuf
, "\x42\x5a\x68", 3) )

21  
	`bunz2
(
šbuf
, 
Ën
, 
NULL
, NULL, 
outbuf
, NULL, 
”rÜ
);

23 iàĞ
Ën
 >ğ2 && !
	`memcmp
(
šbuf
, "\135\000", 2) )

24  
	`uÆzma
(
šbuf
, 
Ën
, 
NULL
, NULL, 
outbuf
, NULL, 
”rÜ
);

26 iàĞ
Ën
 >ğ5 && !
	`memcmp
(
šbuf
, "\x89LZO", 5) )

27  
	`uÆzo
(
šbuf
, 
Ën
, 
NULL
, NULL, 
outbuf
, NULL, 
”rÜ
);

30 
	}
}

	@decompress.h

1 
	~<x’/cÚfig.h
>

2 
	~<x’/ÿche.h
>

3 
	~<x’/decom´ess.h
>

4 
	~<x’/š™.h
>

5 
	~<x’/¡ršg.h
>

6 
	~<x’/ty³s.h
>

7 
	~<x’/xm®loc.h
>

9 
	#STATIC


	)

10 
	#INIT
 
__š™


	)

12 (*
__š™d©a
 
”rÜ
)(const *);

13 
	#£t_”rÜ_â
(
x
è
”rÜ
 = x;

	)

15 
	#m®loc
 
xm®loc_by‹s


	)

16 
	#ä“
 
xä“


	)

18 
	#Ïrge_m®loc
 
xm®loc_by‹s


	)

19 
	#Ïrge_ä“
 
xä“


	)

	@domain.c

7 
	~<x’/cÚfig.h
>

8 
	~<x’/com·t.h
>

9 
	~<x’/š™.h
>

10 
	~<x’/lib.h
>

11 
	~<x’/ùy³.h
>

12 
	~<x’/”ºo.h
>

13 
	~<x’/sched.h
>

14 
	~<x’/domaš.h
>

15 
	~<x’/mm.h
>

16 
	~<x’/ev’t.h
>

17 
	~<x’/time.h
>

18 
	~<x’/cÚsŞe.h
>

19 
	~<x’/soáœq.h
>

20 
	~<x’/skËt.h
>

21 
	~<x’/domaš_·ge.h
>

22 
	~<x’/¿nge£t.h
>

23 
	~<x’/gue¡_acûss.h
>

24 
	~<x’/hy³rÿÎ.h
>

25 
	~<x’/d–ay.h
>

26 
	~<x’/shutdown.h
>

27 
	~<x’/³rıu.h
>

28 
	~<x’/muÉiÿÎ.h
>

29 
	~<x’/rcupd©e.h
>

30 
	~<x’/wa™.h
>

31 
	~<aıi/ıuäeq/ıuäeq.h
>

32 
	~<asm/debugg”.h
>

33 
	~<public/sched.h
>

34 
	~<public/sysùl.h
>

35 
	~<public/vıu.h
>

36 
	~<xsm/xsm.h
>

37 
	~<x’/Œaû.h
>

38 
	~<x’/tmem.h
>

42 
	gx’_´oûssÜ_pmb™s
 = 
XEN_PROCESSOR_PM_PX
;

45 
boŞ_t
 
	gİt_dom0_vıus_pš
;

46 
boŞ—n_·¿m
("dom0_vıus_pš", 
İt_dom0_vıus_pš
);

49 
ıuäeq_cÚŒŞËr
 
	gıuäeq_cÚŒŞËr
 = 
FREQCTL_x’
;

51 
__š™
 
	$£tup_ıuäeq_İtiÚ
(*
¡r
)

53 *
¬g
;

55 iàĞ!
	`¡rcmp
(
¡r
, "dom0-kernel") )

57 
x’_´oûssÜ_pmb™s
 &ğ~
XEN_PROCESSOR_PM_PX
;

58 
ıuäeq_cÚŒŞËr
 = 
FREQCTL_dom0_k”Ãl
;

59 
İt_dom0_vıus_pš
 = 1;

63 iàĞ!
	`¡rcmp
(
¡r
, "none") )

65 
x’_´oûssÜ_pmb™s
 &ğ~
XEN_PROCESSOR_PM_PX
;

66 
ıuäeq_cÚŒŞËr
 = 
FREQCTL_nÚe
;

70 iàĞ(
¬g
 = 
	`¡½brk
(
¡r
, ",:")è!ğ
NULL
 )

71 *
¬g
++ = '\0';

73 iàĞ!
	`¡rcmp
(
¡r
, "xen") )

74 iàĞ
¬g
 && *arg )

75 
	`ıuäeq_cmdlše_·r£
(
¬g
);

76 
	}
}

77 
cu¡om_·¿m
("ıuäeq", 
£tup_ıuäeq_İtiÚ
);

80 
DEFINE_SPINLOCK
(
domli¡_upd©e_lock
);

81 
DEFINE_RCU_READ_LOCK
(
domli¡_»ad_lock
);

83 
	#DOMAIN_HASH_SIZE
 256

	)

84 
	#DOMAIN_HASH
(
_id
è(()(_id)&(
DOMAIN_HASH_SIZE
-1))

	)

85 
domaš
 *
	gdomaš_hash
[
DOMAIN_HASH_SIZE
];

86 
domaš
 *
	gdomaš_li¡
;

88 
domaš
 *
	gdom0
;

90 
vıu
 *
	gidË_vıu
[
NR_CPUS
] 
	g__»ad_mo¡ly
;

92 
vıu_šfo_t
 
	gdummy_vıu_šfo
;

94 
	$cu¼’t_domaš_id
()

96  
cu¼’t
->
domaš
->
domaš_id
;

97 
	}
}

99 
	$__domaš_fš®i£_shutdown
(
domaš
 *
d
)

101 
vıu
 *
v
;

103 
	`BUG_ON
(!
	`¥š_is_locked
(&
d
->
shutdown_lock
));

105 iàĞ
d
->
is_shut_down
 )

108 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

109 iàĞ!
v
->
·u£d_fÜ_shutdown
 )

112 
d
->
is_shut_down
 = 1;

113 iàĞ(
d
->
shutdown_code
 =ğ
SHUTDOWN_su¥’d
è&& d->
su¥’d_evtchn
 )

114 
	`evtchn_£nd
(
d
, d->
su¥’d_evtchn
);

116 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_DOM_EXC
);

117 
	}
}

119 
	$vıu_check_shutdown
(
vıu
 *
v
)

121 
domaš
 *
d
 = 
v
->domain;

123 
	`¥š_lock
(&
d
->
shutdown_lock
);

125 iàĞ
d
->
is_shu‰šg_down
 )

127 iàĞ!
v
->
·u£d_fÜ_shutdown
 )

128 
	`vıu_·u£_nosync
(
v
);

129 
v
->
·u£d_fÜ_shutdown
 = 1;

130 
v
->
deãr_shutdown
 = 0;

131 
	`__domaš_fš®i£_shutdown
(
d
);

134 
	`¥š_uÆock
(&
d
->
shutdown_lock
);

135 
	}
}

137 
vıu
 *
	$®loc_vıu
(

138 
domaš
 *
d
, 
vıu_id
, 
ıu_id
)

140 
vıu
 *
v
;

142 
	`BUG_ON
((!
	`is_idË_domaš
(
d
è|| 
vıu_id
è&& d->
vıu
[vcpu_id]);

144 iàĞ(
v
 = 
	`®loc_vıu_¡ruù
()è=ğ
NULL
 )

145  
NULL
;

147 
v
->
domaš
 = 
d
;

148 
v
->
vıu_id
 = vcpu_id;

150 
	`¥š_lock_š™
(&
v
->
vœq_lock
);

152 
	`skËt_š™
(&
v
->
cÚtšue_hy³rÿÎ_skËt
, 
NULL
, 0);

154 iàĞ
	`is_idË_domaš
(
d
) )

156 
v
->
run¡©e
.
¡©e
 = 
RUNSTATE_ruÂšg
;

160 
v
->
run¡©e
.
¡©e
 = 
RUNSTATE_ofæše
;

161 
v
->
run¡©e
.
¡©e_’Œy_time
 = 
	`NOW
();

162 
	`£t_b™
(
_VPF_down
, &
v
->
·u£_æags
);

163 
v
->
vıu_šfo
 = ((
vıu_id
 < 
XEN_LEGACY_MAX_VCPUS
)

164 ? (
vıu_šfo_t
 *)&
	`sh¬ed_šfo
(
d
, 
vıu_šfo
[
vıu_id
])

165 : &
dummy_vıu_šfo
);

166 
	`š™_wa™queue_vıu
(
v
);

169 iàĞ
	`sched_š™_vıu
(
v
, 
ıu_id
) != 0 )

171 
	`de¡roy_wa™queue_vıu
(
v
);

172 
	`ä“_vıu_¡ruù
(
v
);

173  
NULL
;

176 iàĞ
	`vıu_š™Ÿli£
(
v
) != 0 )

178 
	`sched_de¡roy_vıu
(
v
);

179 
	`de¡roy_wa™queue_vıu
(
v
);

180 
	`ä“_vıu_¡ruù
(
v
);

181  
NULL
;

184 
d
->
vıu
[
vıu_id
] = 
v
;

185 iàĞ
vıu_id
 != 0 )

187 
´ev_id
 = 
v
->
vıu_id
 - 1;

188  (
´ev_id
 >ğ0è&& (
d
->
vıu
[´ev_id] =ğ
NULL
) )

189 
´ev_id
--;

190 
	`BUG_ON
(
´ev_id
 < 0);

191 
v
->
Ãxt_š_li¡
 = 
d
->
vıu
[
´ev_id
]->next_in_list;

192 
d
->
vıu
[
´ev_id
]->
Ãxt_š_li¡
 = 
v
;

196 
	`vıu_check_shutdown
(
v
);

198 
	`domaš_upd©e_node_affš™y
(
d
);

200  
v
;

201 
	}
}

203 
__»ad_mo¡ly
 
	gexŒa_dom0_œqs
 = 256;

204 
__»ad_mo¡ly
 
	gexŒa_domU_œqs
 = 32;

205 
__š™
 
	$·r£_exŒa_gue¡_œqs
(cÚ¡ *
s
)

207 iàĞ
	`isdig™
(*
s
) )

208 
exŒa_domU_œqs
 = 
	`sim¶e_¡¹oul
(
s
, &s, 0);

209 iàĞ*
s
 =ğ',' && 
	`isdig™
(*++s) )

210 
exŒa_dom0_œqs
 = 
	`sim¶e_¡¹oul
(
s
, &s, 0);

211 
	}
}

212 
cu¡om_·¿m
("exŒa_gue¡_œqs", 
·r£_exŒa_gue¡_œqs
);

214 
domaš
 *
	$domaš_ü—‹
(

215 
domid_t
 
domid
, 
domü_æags
, 
ssid»f_t
 
ssid»f
)

217 
domaš
 *
d
, **
pd
;

218 ’um { 
INIT_xsm
 = 1u<<0, 
INIT_w©chdog
 = 1u<<1, 
INIT_¿nge£t
 = 1u<<2,

219 
INIT_evtchn
 = 1u<<3, 
INIT_gÁb
 = 1u<<4, 
INIT_¬ch
 = 1u<<5 };

220 
š™_¡©us
 = 0;

221 
poŞid
 = 
CPUPOOLID_NONE
;

223 iàĞ(
d
 = 
	`®loc_domaš_¡ruù
()è=ğ
NULL
 )

224  
NULL
;

226 
d
->
domaš_id
 = 
domid
;

228 
	`lock_´ofe_»gi¡”_¡ruù
(
LOCKPROF_TYPE_PERDOM
, 
d
, 
domid
, "Domain");

230 iàĞ
	`xsm_®loc_£cur™y_domaš
(
d
) != 0 )

231 
ç
;

232 
š™_¡©us
 |ğ
INIT_xsm
;

234 
	`w©chdog_domaš_š™
(
d
);

235 
š™_¡©us
 |ğ
INIT_w©chdog
;

237 
	`©omic_£t
(&
d
->
»fút
, 1);

238 
	`¥š_lock_š™_´of
(
d
, 
domaš_lock
);

239 
	`¥š_lock_š™_´of
(
d
, 
·ge_®loc_lock
);

240 
	`¥š_lock_š™
(&
d
->
hy³rÿÎ_d—dlock_mu‹x
);

241 
	`INIT_PAGE_LIST_HEAD
(&
d
->
·ge_li¡
);

242 
	`INIT_PAGE_LIST_HEAD
(&
d
->
x’·ge_li¡
);

244 
	`¥š_lock_š™
(&
d
->
node_affš™y_lock
);

246 
	`¥š_lock_š™
(&
d
->
shutdown_lock
);

247 
d
->
shutdown_code
 = -1;

249 iàĞ
domü_æags
 & 
DOMCRF_hvm
 )

250 
d
->
is_hvm
 = 1;

252 iàĞ
domid
 == 0 )

254 
d
->
is_pšÃd
 = 
İt_dom0_vıus_pš
;

255 
d
->
di§bË_mig¿‹
 = 1;

258 
	`¿nge£t_domaš_š™Ÿli£
(
d
);

259 
š™_¡©us
 |ğ
INIT_¿nge£t
;

261 
d
->
iomem_ÿps
 = 
	`¿nge£t_Ãw
(d, "I/O MemÜy", 
RANGESETF_´‘ty´št_hex
);

262 
d
->
œq_ÿps
 = 
	`¿nge£t_Ãw
(d, "Interrupts", 0);

263 iàĞ(
d
->
iomem_ÿps
 =ğ
NULL
è|| (d->
œq_ÿps
 == NULL) )

264 
ç
;

266 iàĞ
domü_æags
 & 
DOMCRF_dummy
 )

267  
d
;

269 iàĞ!
	`is_idË_domaš
(
d
) )

271 iàĞ
	`xsm_domaš_ü—‹
(
d
, 
ssid»f
) != 0 )

272 
ç
;

274 
d
->
is_·u£d_by_cÚŒŞËr
 = 1;

275 
	`©omic_šc
(&
d
->
·u£_couÁ
);

277 iàĞ
domid
 )

278 
d
->
Ä_pœqs
 = 
Ä_œqs_gsi
 + 
exŒa_domU_œqs
;

280 
d
->
Ä_pœqs
 = 
Ä_œqs_gsi
 + 
exŒa_dom0_œqs
;

281 iàĞ
d
->
Ä_pœqs
 > 
Ä_œqs
 )

282 
d
->
Ä_pœqs
 = 
Ä_œqs
;

284 
d
->
pœq_to_evtchn
 = 
	`xm®loc_¬¿y
(
u16
, d->
Ä_pœqs
);

285 
d
->
pœq_mask
 = 
	`xm®loc_¬¿y
(

286 , 
	`BITS_TO_LONGS
(
d
->
Ä_pœqs
));

287 iàĞ(
d
->
pœq_to_evtchn
 =ğ
NULL
è|| (d->
pœq_mask
 == NULL) )

288 
ç
;

289 
	`mem£t
(
d
->
pœq_to_evtchn
, 0, d->
Ä_pœqs
 * (*d->pirq_to_evtchn));

290 
	`b™m­_z”o
(
d
->
pœq_mask
, d->
Ä_pœqs
);

292 iàĞ
	`evtchn_š™
(
d
) != 0 )

293 
ç
;

294 
š™_¡©us
 |ğ
INIT_evtchn
;

296 iàĞ
	`g¿Á_bË_ü—‹
(
d
) != 0 )

297 
ç
;

298 
š™_¡©us
 |ğ
INIT_gÁb
;

300 
poŞid
 = 0;

303 iàĞ
	`¬ch_domaš_ü—‹
(
d
, 
domü_æags
) != 0 )

304 
ç
;

305 
š™_¡©us
 |ğ
INIT_¬ch
;

307 iàĞ
	`ıupoŞ_add_domaš
(
d
, 
poŞid
) != 0 )

308 
ç
;

310 iàĞ
	`sched_š™_domaš
(
d
) != 0 )

311 
ç
;

313 iàĞ!
	`is_idË_domaš
(
d
) )

315 
	`¥š_lock
(&
domli¡_upd©e_lock
);

316 
pd
 = &
domaš_li¡
;

317  
pd
 = &
domaš_li¡
; *pd !ğ
NULL
;…d = &(*pd)->
Ãxt_š_li¡
 )

318 iàĞ(*
pd
)->
domaš_id
 > 
d
->domain_id )

320 
d
->
Ãxt_š_li¡
 = *
pd
;

321 
d
->
Ãxt_š_hashbuck‘
 = 
domaš_hash
[
	`DOMAIN_HASH
(
domid
)];

322 
	`rcu_assign_poš‹r
(*
pd
, 
d
);

323 
	`rcu_assign_poš‹r
(
domaš_hash
[
	`DOMAIN_HASH
(
domid
)], 
d
);

324 
	`¥š_uÆock
(&
domli¡_upd©e_lock
);

327  
d
;

329 
ç
:

330 
d
->
is_dyšg
 = 
DOMDYING_d—d
;

331 
	`©omic_£t
(&
d
->
»fút
, 
DOMAIN_DESTROYED
);

332 iàĞ
š™_¡©us
 & 
INIT_¬ch
 )

333 
	`¬ch_domaš_de¡roy
(
d
);

334 iàĞ
š™_¡©us
 & 
INIT_gÁb
 )

335 
	`g¿Á_bË_de¡roy
(
d
);

336 iàĞ
š™_¡©us
 & 
INIT_evtchn
 )

338 
	`evtchn_de¡roy
(
d
);

339 
	`evtchn_de¡roy_fš®
(
d
);

341 iàĞ
š™_¡©us
 & 
INIT_¿nge£t
 )

342 
	`¿nge£t_domaš_de¡roy
(
d
);

343 iàĞ
š™_¡©us
 & 
INIT_w©chdog
 )

344 
	`w©chdog_domaš_de¡roy
(
d
);

345 iàĞ
š™_¡©us
 & 
INIT_xsm
 )

346 
	`xsm_ä“_£cur™y_domaš
(
d
);

347 
	`xä“
(
d
->
pœq_mask
);

348 
	`xä“
(
d
->
pœq_to_evtchn
);

349 
	`ä“_domaš_¡ruù
(
d
);

350  
NULL
;

351 
	}
}

354 
	$domaš_upd©e_node_affš™y
(
domaš
 *
d
)

356 
ıumask_t
 
ıumask
 = 
CPU_MASK_NONE
;

357 
nodemask_t
 
nodemask
 = 
NODE_MASK_NONE
;

358 
vıu
 *
v
;

359 
node
;

361 
	`¥š_lock
(&
d
->
node_affš™y_lock
);

363 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

364 
	`ıus_Ü
(
ıumask
, cpumask, 
v
->
ıu_affš™y
);

366 
	`fÜ_—ch_Úlše_node
 ( 
node
 )

367 iàĞ
	`ıus_š‹r£ùs
(
	`node_to_ıumask
(
node
), 
ıumask
) )

368 
	`node_£t
(
node
, 
nodemask
);

370 
d
->
node_affš™y
 = 
nodemask
;

371 
	`¥š_uÆock
(&
d
->
node_affš™y_lock
);

372 
	}
}

375 
domaš
 *
	$g‘_domaš_by_id
(
domid_t
 
dom
)

377 
domaš
 *
d
;

379 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

381  
d
 = 
	`rcu_d”eã»nû
(
domaš_hash
[
	`DOMAIN_HASH
(
dom
)]);

382 
d
 !ğ
NULL
;

383 
d
 = 
	`rcu_d”eã»nû
(d->
Ãxt_š_hashbuck‘
) )

385 iàĞ
d
->
domaš_id
 =ğ
dom
 )

387 iàĞ
	`uÆik–y
(!
	`g‘_domaš
(
d
)) )

388 
d
 = 
NULL
;

393 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

395  
d
;

396 
	}
}

399 
domaš
 *
	$rcu_lock_domaš_by_id
(
domid_t
 
dom
)

401 
domaš
 *
d
 = 
NULL
;

403 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

405  
d
 = 
	`rcu_d”eã»nû
(
domaš_hash
[
	`DOMAIN_HASH
(
dom
)]);

406 
d
 !ğ
NULL
;

407 
d
 = 
	`rcu_d”eã»nû
(d->
Ãxt_š_hashbuck‘
) )

409 iàĞ
d
->
domaš_id
 =ğ
dom
 )

411 
	`rcu_lock_domaš
(
d
);

416 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

418  
d
;

419 
	}
}

421 
	$rcu_lock_rg‘_domaš_by_id
(
domid_t
 
dom
, 
domaš
 **
d
)

423 iàĞ
dom
 =ğ
DOMID_SELF
 )

425 *
d
 = 
	`rcu_lock_cu¼’t_domaš
();

429 iàĞ(*
d
 = 
	`rcu_lock_domaš_by_id
(
dom
)è=ğ
NULL
 )

430  -
ESRCH
;

432 iàĞ!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, *
d
) )

434 
	`rcu_uÆock_domaš
(*
d
);

435  -
EPERM
;

439 
	}
}

441 
	$rcu_lock_»mÙe_rg‘_domaš_by_id
(
domid_t
 
dom
, 
domaš
 **
d
)

443 iàĞ(*
d
 = 
	`rcu_lock_domaš_by_id
(
dom
)è=ğ
NULL
 )

444  -
ESRCH
;

446 iàĞ(*
d
 =ğ
cu¼’t
->
domaš
è|| !
	`IS_PRIV_FOR
(current->domain, *d) )

448 
	`rcu_uÆock_domaš
(*
d
);

449  -
EPERM
;

453 
	}
}

455 
	$domaš_kl
(
domaš
 *
d
)

457 
rc
 = 0;

459 iàĞ
d
 =ğ
cu¼’t
->
domaš
 )

460  -
EINVAL
;

462 #ifdeà
ENABLE_PGD


464 
vıu
 *
v
;

466 
	`fÜ_—ch_vıu
(
d
, 
v
) {

467 ià(
v
->
cu¼’t_pgd
) {

468 
·ge_dœ
 *
pgd
;

469 
pgd
 = 
v
->
cu¼’t_pgd
;

470 
v
->
cu¼’t_pgd
 = 
NULL
;

471 
	`my´štk
("d%dv%d de¡royed..…gd„e£t.. \n", 
v
->
domaš
->
domaš_id
, v->
vıu_id
);

472 
	`©omic_dec
(&
pgd
->
»fút
);

474 
v
->
cu¼’t_k¡ack
 = 
NULL
;

475 ià(
v
->
de¡_ÿche
 != -1) {

476 
	`my´štk
("INFO v->dest_cache==%d ??\n");

484  
d
->
is_dyšg
 )

486 
DOMDYING_®ive
:

487 
	`domaš_·u£
(
d
);

488 
d
->
is_dyšg
 = 
DOMDYING_dyšg
;

489 
	`¥š_b¬r›r
(&
d
->
domaš_lock
);

490 
	`evtchn_de¡roy
(
d
);

491 
	`gÁb_»Ëa£_m­pšgs
(
d
);

492 
	`tmem_de¡roy
(
d
->
tmem
);

493 
d
->
tmem
 = 
NULL
;

495 
DOMDYING_dyšg
:

496 
rc
 = 
	`domaš_»lšquish_»sourûs
(
d
);

497 iàĞ
rc
 != 0 )

499 
	`BUG_ON
(
rc
 !ğ-
EAGAIN
);

502 
d
->
is_dyšg
 = 
DOMDYING_d—d
;

503 
	`put_domaš
(
d
);

504 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_DOM_EXC
);

506 
DOMDYING_d—d
:

510  
rc
;

511 
	}
}

514 
	$__domaš_üash
(
domaš
 *
d
)

516 iàĞ
d
->
is_shu‰šg_down
 )

520 iàĞ
d
 =ğ
cu¼’t
->
domaš
 )

522 
	`´štk
("Domain %d (vcpu#%d) crashed on cpu#%d:\n",

523 
d
->
domaš_id
, 
cu¼’t
->
vıu_id
, 
	`smp_´oûssÜ_id
());

524 
	`show_executiÚ_¡©e
(
	`gue¡_ıu_u£r_»gs
());

528 
	`´štk
("Domain %d„eported crashed by domain %d on cpu#%d:\n",

529 
d
->
domaš_id
, 
cu¼’t
->
domaš
->domaš_id, 
	`smp_´oûssÜ_id
());

532 
	`domaš_shutdown
(
d
, 
SHUTDOWN_üash
);

533 
	}
}

536 
	$__domaš_üash_synchrÚous
()

538 
	`__domaš_üash
(
cu¼’t
->
domaš
);

540 
	`vıu_’d_shutdown_deã¼®
(
cu¼’t
);

543 
	`do_soáœq
();

544 
	}
}

547 
	$domaš_shutdown
(
domaš
 *
d
, 
u8
 
»asÚ
)

549 
vıu
 *
v
;

551 
	`¥š_lock
(&
d
->
shutdown_lock
);

553 iàĞ
d
->
shutdown_code
 == -1 )

554 
d
->
shutdown_code
 = 
»asÚ
;

555 
»asÚ
 = 
d
->
shutdown_code
;

557 iàĞ
d
->
domaš_id
 == 0 )

558 
	`dom0_shutdown
(
»asÚ
);

560 iàĞ
d
->
is_shu‰šg_down
 )

562 
	`¥š_uÆock
(&
d
->
shutdown_lock
);

566 
d
->
is_shu‰šg_down
 = 1;

568 
	`smp_mb
();

570 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

572 iàĞ
»asÚ
 =ğ
SHUTDOWN_üash
 )

573 
v
->
deãr_shutdown
 = 0;

574 iàĞ
v
->
deãr_shutdown
 )

576 
	`vıu_·u£_nosync
(
v
);

577 
v
->
·u£d_fÜ_shutdown
 = 1;

580 
	`__domaš_fš®i£_shutdown
(
d
);

582 
	`¥š_uÆock
(&
d
->
shutdown_lock
);

583 
	}
}

585 
	$domaš_»sume
(
domaš
 *
d
)

587 
vıu
 *
v
;

593 
	`domaš_·u£
(
d
);

595 
	`¥š_lock
(&
d
->
shutdown_lock
);

597 
d
->
is_shu‰šg_down
 = d->
is_shut_down
 = 0;

598 
d
->
shutdown_code
 = -1;

600 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

602 iàĞ
v
->
·u£d_fÜ_shutdown
 )

603 
	`vıu_uÅau£
(
v
);

604 
v
->
·u£d_fÜ_shutdown
 = 0;

607 
	`¥š_uÆock
(&
d
->
shutdown_lock
);

609 
	`domaš_uÅau£
(
d
);

610 
	}
}

612 
	$vıu_¡¬t_shutdown_deã¼®
(
vıu
 *
v
)

614 iàĞ
v
->
deãr_shutdown
 )

617 
v
->
deãr_shutdown
 = 1;

618 
	`smp_mb
();

619 iàĞ
	`uÆik–y
(
v
->
domaš
->
is_shu‰šg_down
) )

620 
	`vıu_check_shutdown
(
v
);

622  
v
->
deãr_shutdown
;

623 
	}
}

625 
	$vıu_’d_shutdown_deã¼®
(
vıu
 *
v
)

627 
v
->
deãr_shutdown
 = 0;

628 
	`smp_mb
();

629 iàĞ
	`uÆik–y
(
v
->
domaš
->
is_shu‰šg_down
) )

630 
	`vıu_check_shutdown
(
v
);

631 
	}
}

633 
	$domaš_·u£_fÜ_debugg”
()

635 
domaš
 *
d
 = 
cu¼’t
->domain;

636 
vıu
 *
v
;

638 
	`©omic_šc
(&
d
->
·u£_couÁ
);

639 iàĞ
	`‹¡_ªd_£t_boŞ
(
d
->
is_·u£d_by_cÚŒŞËr
) )

640 
	`domaš_uÅau£
(
d
);

642 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

643 
	`vıu_¦“p_nosync
(
v
);

645 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_DEBUGGER
);

646 
	}
}

649 
	$com¶‘e_domaš_de¡roy
(
rcu_h—d
 *
h—d
)

651 
domaš
 *
d
 = 
	`cÚš”_of
(
h—d
, domaš, 
rcu
);

652 
vıu
 *
v
;

653 
i
;

655  
i
 = 
d
->
max_vıus
 - 1; i >= 0; i-- )

657 iàĞ(
v
 = 
d
->
vıu
[
i
]è=ğ
NULL
 )

659 
	`skËt_kl
(&
v
->
cÚtšue_hy³rÿÎ_skËt
);

660 
	`vıu_de¡roy
(
v
);

661 
	`sched_de¡roy_vıu
(
v
);

662 
	`de¡roy_wa™queue_vıu
(
v
);

665 
	`g¿Á_bË_de¡roy
(
d
);

667 
	`¬ch_domaš_de¡roy
(
d
);

669 
	`w©chdog_domaš_de¡roy
(
d
);

671 
	`¿nge£t_domaš_de¡roy
(
d
);

673 
	`ıupoŞ_rm_domaš
(
d
);

675 
	`sched_de¡roy_domaš
(
d
);

678 
	`ä“_x’İrof_·ges
(
d
);

680  
i
 = 
d
->
max_vıus
 - 1; i >= 0; i-- )

681 iàĞ(
v
 = 
d
->
vıu
[
i
]è!ğ
NULL
 )

682 
	`ä“_vıu_¡ruù
(
v
);

684 iàĞ
d
->
rg‘
 !ğ
NULL
 )

685 
	`put_domaš
(
d
->
rg‘
);

687 
	`evtchn_de¡roy_fš®
(
d
);

689 
	`xä“
(
d
->
pœq_mask
);

690 
	`xä“
(
d
->
pœq_to_evtchn
);

692 
	`xsm_ä“_£cur™y_domaš
(
d
);

693 
	`ä“_domaš_¡ruù
(
d
);

695 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_DOM_EXC
);

696 
	}
}

699 
	$domaš_de¡roy
(
domaš
 *
d
)

701 
domaš
 **
pd
;

702 
©omic_t
 
Şd
, 
Ãw
;

704 
	`BUG_ON
(!
d
->
is_dyšg
);

707 
	`_©omic_£t
(
Şd
, 0);

708 
	`_©omic_£t
(
Ãw
, 
DOMAIN_DESTROYED
);

709 
Şd
 = 
	`©omic_com·»ªdsw­
(Şd, 
Ãw
, &
d
->
»fút
);

710 iàĞ
	`_©omic_»ad
(
Şd
) != 0 )

714 
	`TRACE_1D
(
TRC_SCHED_DOM_REM
, 
d
->
domaš_id
);

715 
	`¥š_lock
(&
domli¡_upd©e_lock
);

716 
pd
 = &
domaš_li¡
;

717  *
pd
 !ğ
d
 )

718 
pd
 = &(*pd)->
Ãxt_š_li¡
;

719 
	`rcu_assign_poš‹r
(*
pd
, 
d
->
Ãxt_š_li¡
);

720 
pd
 = &
domaš_hash
[
	`DOMAIN_HASH
(
d
->
domaš_id
)];

721  *
pd
 !ğ
d
 )

722 
pd
 = &(*pd)->
Ãxt_š_hashbuck‘
;

723 
	`rcu_assign_poš‹r
(*
pd
, 
d
->
Ãxt_š_hashbuck‘
);

724 
	`¥š_uÆock
(&
domli¡_upd©e_lock
);

727 
	`ÿÎ_rcu
(&
d
->
rcu
, 
com¶‘e_domaš_de¡roy
);

728 
	}
}

730 
	$vıu_·u£
(
vıu
 *
v
)

732 
	`ASSERT
(
v
 !ğ
cu¼’t
);

733 
	`©omic_šc
(&
v
->
·u£_couÁ
);

734 
	`vıu_¦“p_sync
(
v
);

735 
	}
}

737 
	$vıu_·u£_nosync
(
vıu
 *
v
)

739 
	`©omic_šc
(&
v
->
·u£_couÁ
);

740 
	`vıu_¦“p_nosync
(
v
);

741 
	}
}

743 
	$vıu_uÅau£
(
vıu
 *
v
)

745 iàĞ
	`©omic_dec_ªd_‹¡
(&
v
->
·u£_couÁ
) )

746 
	`vıu_wake
(
v
);

747 
	}
}

749 
	$domaš_·u£
(
domaš
 *
d
)

751 
vıu
 *
v
;

753 
	`ASSERT
(
d
 !ğ
cu¼’t
->
domaš
);

755 
	`©omic_šc
(&
d
->
·u£_couÁ
);

757 
	`fÜ_—ch_vıu
Ğ
d
, 
v
 )

758 
	`vıu_¦“p_sync
(
v
);

759 
	}
}

761 
	$domaš_uÅau£
(
domaš
 *
d
)

763 
vıu
 *
v
;

765 iàĞ
	`©omic_dec_ªd_‹¡
(&
d
->
·u£_couÁ
) )

766 
	`fÜ_—ch_vıu
Ğ
d
, 
v
 )

767 
	`vıu_wake
(
v
);

768 
	}
}

770 
	$domaš_·u£_by_sy¡emcÚŒŞËr
(
domaš
 *
d
)

772 
	`domaš_·u£
(
d
);

773 iàĞ
	`‹¡_ªd_£t_boŞ
(
d
->
is_·u£d_by_cÚŒŞËr
) )

774 
	`domaš_uÅau£
(
d
);

775 
	}
}

777 
	$domaš_uÅau£_by_sy¡emcÚŒŞËr
(
domaš
 *
d
)

779 iàĞ
	`‹¡_ªd_ş—r_boŞ
(
d
->
is_·u£d_by_cÚŒŞËr
) )

780 
	`domaš_uÅau£
(
d
);

781 
	}
}

783 
	$boÙ_vıu
(
domaš
 *
d
, 
vıuid
, 
vıu_gue¡_cÚ‹xt_u
 
ùxt
)

785 
vıu
 *
v
 = 
d
->vıu[
vıuid
];

787 
	`BUG_ON
(
v
->
is_š™Ÿli£d
);

789  
	`¬ch_£t_šfo_gue¡
(
v
, 
ùxt
);

790 
	}
}

792 
	$vıu_»£t
(
vıu
 *
v
)

794 
domaš
 *
d
 = 
v
->domain;

796 
	`vıu_·u£
(
v
);

797 
	`domaš_lock
(
d
);

799 
	`¬ch_vıu_»£t
(
v
);

801 
	`£t_b™
(
_VPF_down
, &
v
->
·u£_æags
);

803 
	`ş—r_b™
(
v
->
vıu_id
, 
d
->
pŞl_mask
);

804 
v
->
pŞl_evtchn
 = 0;

806 
v
->
åu_š™Ÿli£d
 = 0;

807 
v
->
åu_dœt›d
 = 0;

808 
v
->
is_š™Ÿli£d
 = 0;

809 #ifdeà
VCPU_TRAP_LAST


810 
v
->
async_exû±iÚ_mask
 = 0;

811 
	`mem£t
(
v
->
async_exû±iÚ_¡©e
, 0, (v->async_exception_state));

813 
	`ıus_ş—r
(
v
->
ıu_affš™y_tmp
);

814 
	`ş—r_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

816 
	`domaš_uÆock
(
v
->
domaš
);

817 
	`vıu_uÅau£
(
v
);

818 
	}
}

821 
do_vıu_İ
(
cmd
, 
vıuid
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

823 
domaš
 *
d
 = 
cu¼’t
->domain;

824 
vıu
 *
v
;

825 
vıu_gue¡_cÚ‹xt
 *
ùxt
;

826 
rc
 = 0;

828 iàĞ(
vıuid
 < 0è|| (vıuid >ğ
MAX_VIRT_CPUS
) )

829  -
EINVAL
;

831 iàĞ
vıuid
 >ğ
d
->
max_vıus
 || (
v
 = d->
vıu
[vıuid]è=ğ
NULL
 )

832  -
ENOENT
;

834  
cmd
 )

836 
VCPUOP_š™Ÿli£
:

837 iàĞ
v
->
vıu_šfo
 =ğ&
dummy_vıu_šfo
 )

838  -
EINVAL
;

840 iàĞ(
ùxt
 = 
	`xm®loc
(
vıu_gue¡_cÚ‹xt
)è=ğ
NULL
 )

841  -
ENOMEM
;

843 iàĞ
	`cİy_äom_gue¡
(
ùxt
, 
¬g
, 1) )

845 
	`xä“
(
ùxt
);

846  -
EFAULT
;

849 
	`domaš_lock
(
d
);

850 
rc
 = -
EEXIST
;

851 iàĞ!
v
->
is_š™Ÿli£d
 )

852 
rc
 = 
	`boÙ_vıu
(
d
, 
vıuid
, 
ùxt
);

853 
	`domaš_uÆock
(
d
);

855 
	`xä“
(
ùxt
);

858 
VCPUOP_up
:

859 iàĞ!
v
->
is_š™Ÿli£d
 )

860  -
EINVAL
;

862 iàĞ
	`‹¡_ªd_ş—r_b™
(
_VPF_down
, &
v
->
·u£_æags
) )

863 
	`vıu_wake
(
v
);

867 
VCPUOP_down
:

868 iàĞ!
	`‹¡_ªd_£t_b™
(
_VPF_down
, &
v
->
·u£_æags
) )

869 
	`vıu_¦“p_nosync
(
v
);

872 
VCPUOP_is_up
:

873 
rc
 = !
	`‹¡_b™
(
_VPF_down
, &
v
->
·u£_æags
);

876 
VCPUOP_g‘_run¡©e_šfo
:

878 
vıu_run¡©e_šfo
 
run¡©e
;

879 
	`vıu_run¡©e_g‘
(
v
, &
run¡©e
);

880 iàĞ
	`cİy_to_gue¡
(
¬g
, &
run¡©e
, 1) )

881 
rc
 = -
EFAULT
;

885 
VCPUOP_£t_³riodic_tim”
:

887 
vıu_£t_³riodic_tim”
 
£t
;

889 iàĞ
	`cİy_äom_gue¡
(&
£t
, 
¬g
, 1) )

890  -
EFAULT
;

892 iàĞ
£t
.
³riod_ns
 < 
	`MILLISECS
(1) )

893  -
EINVAL
;

895 
v
->
³riodic_³riod
 = 
£t
.
³riod_ns
;

896 
	`vıu_fÜû_»scheduË
(
v
);

901 
VCPUOP_¡İ_³riodic_tim”
:

902 
v
->
³riodic_³riod
 = 0;

903 
	`vıu_fÜû_»scheduË
(
v
);

906 
VCPUOP_£t_sšgËshÙ_tim”
:

908 
vıu_£t_sšgËshÙ_tim”
 
£t
;

910 iàĞ
v
 !ğ
cu¼’t
 )

911  -
EINVAL
;

913 iàĞ
	`cİy_äom_gue¡
(&
£t
, 
¬g
, 1) )

914  -
EFAULT
;

916 iàĞ(
£t
.
æags
 & 
VCPU_SSHOTTMR_futu»
) &&

917 (
£t
.
timeout_abs_ns
 < 
	`NOW
()) )

918  -
ETIME
;

920 
	`mig¿‹_tim”
(&
v
->
sšgËshÙ_tim”
, 
	`smp_´oûssÜ_id
());

921 
	`£t_tim”
(&
v
->
sšgËshÙ_tim”
, 
£t
.
timeout_abs_ns
);

926 
VCPUOP_¡İ_sšgËshÙ_tim”
:

927 iàĞ
v
 !ğ
cu¼’t
 )

928  -
EINVAL
;

930 
	`¡İ_tim”
(&
v
->
sšgËshÙ_tim”
);

934 #ifdeà
VCPU_TRAP_NMI


935 
VCPUOP_£nd_nmi
:

936 iàĞ!
	`gue¡_hªdË_is_nuÎ
(
¬g
) )

937  -
EINVAL
;

939 iàĞ!
	`‹¡_ªd_£t_boŞ
(
v
->
nmi_³ndšg
) )

940 
	`vıu_kick
(
v
);

946 
rc
 = 
	`¬ch_do_vıu_İ
(
cmd
, 
v
, 
¬g
);

950  
rc
;

951 
	}
}

953 
	$vm_assi¡
(
domaš
 *
p
, 
cmd
, 
ty³
)

955 iàĞ
ty³
 > 
MAX_VMASST_TYPE
 )

956  -
EINVAL
;

958  
cmd
 )

960 
VMASST_CMD_’abË
:

961 
	`£t_b™
(
ty³
, &
p
->
vm_assi¡
);

962 
	`´štk
("ENABLE %dth b™ iÀvm_assi¡(0:4gb,1:4gb_nÙi,2:wr™abË…t,3:·e_ext_ü3)\n", 
ty³
);

964 
VMASST_CMD_di§bË
:

965 
	`ş—r_b™
(
ty³
, &
p
->
vm_assi¡
);

966 
	`´štk
("DISABLE %dth b™ iÀvm_assi¡(0:4gb,1:4gb_nÙi,2:wr™abË…t,3:·e_ext_ü3)\n", 
ty³
);

970  -
ENOSYS
;

971 
	}
}

973 
	smig¿‹_šfo
 {

974 (*
	mfunc
)(*
	md©a
);

975 *
	md©a
;

976 
vıu
 *
	mvıu
;

977 
	mıu
;

978 
	mÃ¡
;

981 
DEFINE_PER_CPU
(
mig¿‹_šfo
 *, 
cÚtšue_šfo
);

983 
	$cÚtšue_hy³rÿÎ_skËt_hªdËr
(
_šfo
)

985 
mig¿‹_šfo
 *
šfo
 = (mig¿‹_šfØ*)
_šfo
;

986 
vıu
 *
v
 = 
šfo
->vcpu;

989 
	`vıu_¦“p_sync
(
v
);

991 
	`this_ıu
(
cÚtšue_šfo
èğ
šfo
;

992 
	`»tuº_»g
(
v
èğ(
šfo
->
ıu
 =ğ
	`smp_´oûssÜ_id
())

993 ? 
šfo
->
	`func
(šfo->
d©a
è: -
EINVAL
;

994 
	`this_ıu
(
cÚtšue_šfo
èğ
NULL
;

996 iàĞ
šfo
->
Ã¡
-- == 0 )

998 
	`xä“
(
šfo
);

999 
	`vıu_uÅau£
(
v
);

1000 
	`put_domaš
(
v
->
domaš
);

1002 
	}
}

1004 
cÚtšue_hy³rÿÎ_Ú_ıu
(

1005 
ıu
, (*
func
)(*
d©a
), *data)

1007 
mig¿‹_šfo
 *
šfo
;

1009 iàĞ(
ıu
 >ğ
NR_CPUS
è|| !
	`ıu_Úlše
(cpu) )

1010  -
EINVAL
;

1012 
šfo
 = 
	`this_ıu
(
cÚtšue_šfo
);

1013 iàĞ
šfo
 =ğ
NULL
 )

1015 
vıu
 *
cu¼
 = 
cu¼’t
;

1017 
šfo
 = 
	`xm®loc
(
mig¿‹_šfo
);

1018 iàĞ
šfo
 =ğ
NULL
 )

1019  -
ENOMEM
;

1021 
šfo
->
vıu
 = 
cu¼
;

1022 
šfo
->
Ã¡
 = 0;

1024 
	`skËt_kl
(

1025 &
cu¼
->
cÚtšue_hy³rÿÎ_skËt
);

1026 
	`skËt_š™
(

1027 &
cu¼
->
cÚtšue_hy³rÿÎ_skËt
,

1028 
cÚtšue_hy³rÿÎ_skËt_hªdËr
,

1029 ()
šfo
);

1031 
	`g‘_knowÇlive_domaš
(
cu¼
->
domaš
);

1032 
	`vıu_·u£_nosync
(
cu¼
);

1036 
	`BUG_ON
(
šfo
->
Ã¡
 != 0);

1037 
šfo
->
Ã¡
++;

1040 
šfo
->
func
 = func;

1041 
šfo
->
d©a
 = data;

1042 
šfo
->
ıu
 = cpu;

1044 
	`skËt_scheduË_Ú_ıu
(&
šfo
->
vıu
->
cÚtšue_hy³rÿÎ_skËt
, 
ıu
);

1048 
	}
}

	@domctl.c

9 
	~<x’/cÚfig.h
>

10 
	~<x’/ty³s.h
>

11 
	~<x’/lib.h
>

12 
	~<x’/mm.h
>

13 
	~<x’/sched.h
>

14 
	~<x’/sched-if.h
>

15 
	~<x’/domaš.h
>

16 
	~<x’/ev’t.h
>

17 
	~<x’/domaš_·ge.h
>

18 
	~<x’/Œaû.h
>

19 
	~<x’/cÚsŞe.h
>

20 
	~<x’/ioÿp.h
>

21 
	~<x’/rcupd©e.h
>

22 
	~<x’/gue¡_acûss.h
>

23 
	~<x’/b™m­.h
>

24 
	~<x’/·gšg.h
>

25 
	~<asm/cu¼’t.h
>

26 
	~<public/domùl.h
>

27 
	~<xsm/xsm.h
>

29 
DEFINE_SPINLOCK
(
domùl_lock
);

31 
¬ch_do_domùl
(

32 
x’_domùl
 *
İ
, 
	$XEN_GUEST_HANDLE
(
x’_domùl_t
è
u_domùl
);

34 
	$ıumask_to_x’ùl_ıum­
(

35 
x’ùl_ıum­
 *x’ùl_ıum­, 
ıumask_t
 *
ıumask
)

37 
gue¡_by‹s
, 
cİy_by‹s
, 
i
;

38 
ušt8_t
 
z”o
 = 0;

39 
ušt8_t
 
by‹m­
[(
NR_CPUS
 + 7) / 8];

41 
gue¡_by‹s
 = (
x’ùl_ıum­
->
Ä_ıus
 + 7) / 8;

42 
cİy_by‹s
 = 
	`mš_t
(, 
gue¡_by‹s
, (
by‹m­
));

44 
	`b™m­_lÚg_to_by‹
(
by‹m­
, 
	`ıus_addr
(*
ıumask
), 
NR_CPUS
);

46 iàĞ
cİy_by‹s
 != 0 )

47 iàĞ
	`cİy_to_gue¡
(
x’ùl_ıum­
->
b™m­
, 
by‹m­
, 
cİy_by‹s
) )

48  -
EFAULT
;

50  
i
 = 
cİy_by‹s
; i < 
gue¡_by‹s
; i++ )

51 iàĞ
	`cİy_to_gue¡_off£t
(
x’ùl_ıum­
->
b™m­
, 
i
, &
z”o
, 1) )

52  -
EFAULT
;

55 
	}
}

57 
	$x’ùl_ıum­_to_ıumask
(

58 
ıumask_t
 *
ıumask
, 
x’ùl_ıum­
 *xenctl_cpumap)

60 
gue¡_by‹s
, 
cİy_by‹s
;

61 
ušt8_t
 
by‹m­
[(
NR_CPUS
 + 7) / 8];

63 
gue¡_by‹s
 = (
x’ùl_ıum­
->
Ä_ıus
 + 7) / 8;

64 
cİy_by‹s
 = 
	`mš_t
(, 
gue¡_by‹s
, (
by‹m­
));

66 
	`mem£t
(
by‹m­
, 0, (bytemap));

68 iàĞ
cİy_by‹s
 != 0 )

70 iàĞ
	`cİy_äom_gue¡
(
by‹m­
, 
x’ùl_ıum­
->
b™m­
, 
cİy_by‹s
) )

71  -
EFAULT
;

72 iàĞ(
x’ùl_ıum­
->
Ä_ıus
 & 7è&& (
gue¡_by‹s
 <ğ(
by‹m­
)) )

73 
by‹m­
[
gue¡_by‹s
-1] &ğ~(0xfà<< (
x’ùl_ıum­
->
Ä_ıus
 & 7));

76 
	`b™m­_by‹_to_lÚg
(
	`ıus_addr
(*
ıumask
), 
by‹m­
, 
NR_CPUS
);

79 
	}
}

81 
šlše
 
	$is_ä“_domid
(
domid_t
 
dom
)

83 
domaš
 *
d
;

85 iàĞ
dom
 >ğ
DOMID_FIRST_RESERVED
 )

88 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
dom
)è=ğ
NULL
 )

91 
	`rcu_uÆock_domaš
(
d
);

93 
	}
}

95 
	$g‘domaššfo
(
domaš
 *
d
, 
x’_domùl_g‘domaššfo
 *
šfo
)

97 
vıu
 *
v
;

98 
u64
 
ıu_time
 = 0;

99 
æags
 = 
XEN_DOMINF_blocked
;

100 
vıu_run¡©e_šfo
 
run¡©e
;

102 
šfo
->
domaš
 = 
d
->
domaš_id
;

103 
šfo
->
Ä_Úlše_vıus
 = 0;

104 
šfo
->
ssid»f
 = 0;

110 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

112 
	`vıu_run¡©e_g‘
(
v
, &
run¡©e
);

113 
ıu_time
 +ğ
run¡©e
.
time
[
RUNSTATE_ruÂšg
];

114 
šfo
->
max_vıu_id
 = 
v
->
vıu_id
;

115 iàĞ!
	`‹¡_b™
(
_VPF_down
, &
v
->
·u£_æags
) )

117 iàĞ!(
v
->
·u£_æags
 & 
VPF_blocked
) )

118 
æags
 &ğ~
XEN_DOMINF_blocked
;

119 iàĞ
v
->
is_ruÂšg
 )

120 
æags
 |ğ
XEN_DOMINF_ruÂšg
;

121 
šfo
->
Ä_Úlše_vıus
++;

125 
šfo
->
ıu_time
 = cpu_time;

127 
šfo
->
æags
 = (šfo->
Ä_Úlše_vıus
 ? flags : 0) |

128 ((
d
->
is_dyšg
 =ğ
DOMDYING_d—d
è? 
XEN_DOMINF_dyšg
 : 0) |

129 (
d
->
is_shut_down
 ? 
XEN_DOMINF_shutdown
 : 0) |

130 (
d
->
is_·u£d_by_cÚŒŞËr
 ? 
XEN_DOMINF_·u£d
 : 0) |

131 (
d
->
debugg”_©ched
 ? 
XEN_DOMINF_debugged
 : 0) |

132 
d
->
shutdown_code
 << 
XEN_DOMINF_shutdownshiá
;

134 iàĞ
	`is_hvm_domaš
(
d
) )

135 
šfo
->
æags
 |ğ
XEN_DOMINF_hvm_gue¡
;

137 
	`xsm_£cur™y_domaššfo
(
d
, 
šfo
);

139 
šfo
->
tÙ_·ges
 = 
d
->tot_pages;

140 
šfo
->
max_·ges
 = 
d
->max_pages;

141 
šfo
->
shr_·ges
 = 
	`©omic_»ad
(&
d
->shr_pages);

142 
šfo
->
sh¬ed_šfo_äame
 = 
	`mâ_to_gmâ
(
d
, 
	`__·
(d->
sh¬ed_šfo
)>>
PAGE_SHIFT
);

143 
	`BUG_ON
(
	`SHARED_M2P
(
šfo
->
sh¬ed_šfo_äame
));

145 
šfo
->
ıupoŞ
 = 
d
->ıupoŞ ? d->ıupoŞ->
ıupoŞ_id
 : 
CPUPOOLID_NONE
;

147 
	`memıy
(
šfo
->
hªdË
, 
d
->hªdË, (
x’_domaš_hªdË_t
));

148 
	}
}

150 
	$deçuÉ_vıu0_loÿtiÚ
(
ıumask_t
 *
Úlše
)

152 
domaš
 *
d
;

153 
vıu
 *
v
;

154 
i
, 
ıu
, 
Ä_ıus
, *
út
;

155 
ıumask_t
 
ıu_exşude_m­
;

158 
Ä_ıus
 = 
	`Ï¡_ıu
(
ıu_Úlše_m­
) + 1;

159 
út
 = 
	`xm®loc_¬¿y
(, 
Ä_ıus
);

160 iàĞ
út
 )

162 
	`mem£t
(
út
, 0, 
Ä_ıus
 * (*cnt));

164 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

165 
	`fÜ_—ch_domaš
 ( 
d
 )

166 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

167 iàĞ!
	`‹¡_b™
(
_VPF_down
, &
v
->
·u£_æags
)

168 && ((
ıu
 = 
v
->
´oûssÜ
è< 
Ä_ıus
) )

169 
út
[
ıu
]++;

170 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

177 
ıu
 = 
	`fœ¡_ıu
(
	`³r_ıu
(
ıu_siblšg_m­
, 0));

178 iàĞ
	`ıus_weight
(
	`³r_ıu
(
ıu_siblšg_m­
, 0)) > 1 )

179 
ıu
 = 
	`Ãxt_ıu
(ıu, 
	`³r_ıu
(
ıu_siblšg_m­
, 0));

180 
ıu_exşude_m­
 = 
	`³r_ıu
(
ıu_siblšg_m­
, 0);

181 
	`fÜ_—ch_ıu_mask
(
i
, *
Úlše
)

183 iàĞ
	`ıu_is£t
(
i
, 
ıu_exşude_m­
) )

185 iàĞ(
i
 =ğ
	`fœ¡_ıu
(
	`³r_ıu
(
ıu_siblšg_m­
, i))) &&

186 (
	`ıus_weight
(
	`³r_ıu
(
ıu_siblšg_m­
, 
i
)) > 1) )

188 
	`ıus_Ü
(
ıu_exşude_m­
, cpu_exşude_m­, 
	`³r_ıu
(
ıu_siblšg_m­
, 
i
));

189 iàĞ!
út
 || cÁ[
i
] <ğút[
ıu
] )

190 
ıu
 = 
i
;

193 
	`xä“
(
út
);

195  
ıu
;

196 
	}
}

198 
boŞ_t
 
	$domùl_lock_acquœe
()

204 iàĞ!
	`¥š_Œylock
(&
cu¼’t
->
domaš
->
hy³rÿÎ_d—dlock_mu‹x
) )

212 iàĞ
	`¥š_Œylock
(&
domùl_lock
) )

215 
	`¥š_uÆock
(&
cu¼’t
->
domaš
->
hy³rÿÎ_d—dlock_mu‹x
);

217 
	}
}

219 
	$domùl_lock_»Ëa£
()

221 
	`¥š_uÆock
(&
domùl_lock
);

222 
	`¥š_uÆock
(&
cu¼’t
->
domaš
->
hy³rÿÎ_d—dlock_mu‹x
);

223 
	}
}

225 
do_domùl
(
	$XEN_GUEST_HANDLE
(
x’_domùl_t
è
u_domùl
)

227 
»t
 = 0;

228 
x’_domùl
 
curİ
, *
İ
 = &curop;

230 iàĞ
	`cİy_äom_gue¡
(
İ
, 
u_domùl
, 1) )

231  -
EFAULT
;

233 iàĞ
İ
->
š‹rçû_v”siÚ
 !ğ
XEN_DOMCTL_INTERFACE_VERSION
 )

234  -
EACCES
;

236  
İ
->
cmd
 )

238 
XEN_DOMCTL_iİÜt_m­pšg
:

239 
XEN_DOMCTL_memÜy_m­pšg
:

240 
XEN_DOMCTL_bšd_±_œq
:

241 
XEN_DOMCTL_unbšd_±_œq
: {

242 
domaš
 *
d
;

243 
boŞ_t
 
is_´iv
 = 
	`IS_PRIV
(
cu¼’t
->
domaš
);

244 iàĞ!
is_´iv
 && ((
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
)è!ğ
NULL
) )

246 
is_´iv
 = 
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
);

247 
	`rcu_uÆock_domaš
(
d
);

249 iàĞ!
is_´iv
 )

250  -
EPERM
;

254 iàĞ!
	`IS_PRIV
(
cu¼’t
->
domaš
) )

255  -
EPERM
;

259 iàĞ!
	`domùl_lock_acquœe
() )

260  
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(

261 
__HYPERVISOR_domùl
, "h", 
u_domùl
);

263  
İ
->
cmd
 )

266 
XEN_DOMCTL_£tvıucÚ‹xt
:

268 
domaš
 *
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->domain);

269 
vıu_gue¡_cÚ‹xt_u
 
c
 = { .
Çt
 = 
NULL
 };

270 
vıu
 = 
İ
->
u
.
vıucÚ‹xt
.vcpu;

271 
vıu
 *
v
;

273 
»t
 = -
ESRCH
;

274 iàĞ
d
 =ğ
NULL
 )

277 
»t
 = 
	`xsm_£tvıucÚ‹xt
(
d
);

278 iàĞ
»t
 )

279 
svc_out
;

281 
»t
 = -
EINVAL
;

282 iàĞ(
d
 =ğ
cu¼’t
->
domaš
) ||

283 (
vıu
 >ğ
d
->
max_vıus
è|| ((
v
 = d->vıu[vıu]è=ğ
NULL
) )

284 
svc_out
;

286 iàĞ
	`gue¡_hªdË_is_nuÎ
(
İ
->
u
.
vıucÚ‹xt
.
ùxt
) )

288 
	`vıu_»£t
(
v
);

289 
»t
 = 0;

290 
svc_out
;

293 #ifdeà
CONFIG_COMPAT


294 
	`BUILD_BUG_ON
((
vıu_gue¡_cÚ‹xt
)

295 < (
com·t_vıu_gue¡_cÚ‹xt
));

297 
»t
 = -
ENOMEM
;

298 iàĞ(
c
.
Çt
 = 
	`xm®loc
(
vıu_gue¡_cÚ‹xt
)è=ğ
NULL
 )

299 
svc_out
;

301 #ifdeà
CONFIG_COMPAT


302 iàĞ!
	`is_pv_32Ú64_vıu
(
v
) )

303 
»t
 = 
	`cİy_äom_gue¡
(
c
.
Çt
, 
İ
->
u
.
vıucÚ‹xt
.
ùxt
, 1);

305 
»t
 = 
	`cİy_äom_gue¡
(
c
.
cmp
,

306 
	`gue¡_hªdË_ÿ¡
(
İ
->
u
.
vıucÚ‹xt
.
ùxt
,

309 
»t
 = 
	`cİy_äom_gue¡
(
c
.
Çt
, 
İ
->
u
.
vıucÚ‹xt
.
ùxt
, 1);

311 
»t
 =„‘ ? -
EFAULT
 : 0;

313 iàĞ
»t
 == 0 )

315 
	`domaš_·u£
(
d
);

316 
»t
 = 
	`¬ch_£t_šfo_gue¡
(
v
, 
c
);

317 
	`domaš_uÅau£
(
d
);

320 
svc_out
:

321 
	`xä“
(
c
.
Çt
);

322 
	`rcu_uÆock_domaš
(
d
);

326 
XEN_DOMCTL_·u£domaš
:

328 
domaš
 *
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->domain);

329 
»t
 = -
ESRCH
;

330 iàĞ
d
 !ğ
NULL
 )

332 
»t
 = 
	`xsm_·u£domaš
(
d
);

333 iàĞ
»t
 )

334 
·u£domaš_out
;

336 
»t
 = -
EINVAL
;

337 iàĞ
d
 !ğ
cu¼’t
->
domaš
 )

339 
	`domaš_·u£_by_sy¡emcÚŒŞËr
(
d
);

340 
»t
 = 0;

342 
·u£domaš_out
:

343 
	`rcu_uÆock_domaš
(
d
);

348 
XEN_DOMCTL_uÅau£domaš
:

350 
domaš
 *
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->domain);

352 
»t
 = -
ESRCH
;

353 iàĞ
d
 =ğ
NULL
 )

356 
»t
 = 
	`xsm_uÅau£domaš
(
d
);

357 iàĞ
»t
 )

359 
	`rcu_uÆock_domaš
(
d
);

363 
	`domaš_uÅau£_by_sy¡emcÚŒŞËr
(
d
);

364 
	`rcu_uÆock_domaš
(
d
);

365 
»t
 = 0;

369 
XEN_DOMCTL_»sumedomaš
:

371 
domaš
 *
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->domain);

373 
»t
 = -
ESRCH
;

374 iàĞ
d
 =ğ
NULL
 )

377 
»t
 = 
	`xsm_»sumedomaš
(
d
);

378 iàĞ
»t
 )

380 
	`rcu_uÆock_domaš
(
d
);

384 
	`domaš_»sume
(
d
);

385 
	`rcu_uÆock_domaš
(
d
);

386 
»t
 = 0;

390 
XEN_DOMCTL_ü—‹domaš
:

392 
domaš
 *
d
;

393 
domid_t
 
dom
;

394 
domid_t
 
rov”
 = 0;

395 
domü_æags
;

397 
»t
 = -
EINVAL
;

398 iàĞ
su³rvisÜ_mode_k”Ãl
 ||

399 (
İ
->
u
.
ü—‹domaš
.
æags
 &

400 ~(
XEN_DOMCTL_CDF_hvm_gue¡
 | 
XEN_DOMCTL_CDF_h­
 |

401 
XEN_DOMCTL_CDF_s3_š‹gr™y
 | 
XEN_DOMCTL_CDF_oos_off
)) )

404 
dom
 = 
İ
->
domaš
;

405 iàĞ(
dom
 > 0è&& (dom < 
DOMID_FIRST_RESERVED
) )

407 
»t
 = -
EINVAL
;

408 iàĞ!
	`is_ä“_domid
(
dom
) )

413  
dom
 = 
rov”
 + 1; dom !=„over; dom++ )

415 iàĞ
dom
 =ğ
DOMID_FIRST_RESERVED
 )

416 
dom
 = 0;

417 iàĞ
	`is_ä“_domid
(
dom
) )

421 
»t
 = -
ENOMEM
;

422 iàĞ
dom
 =ğ
rov”
 )

425 
rov”
 = 
dom
;

428 
domü_æags
 = 0;

429 iàĞ
İ
->
u
.
ü—‹domaš
.
æags
 & 
XEN_DOMCTL_CDF_hvm_gue¡
 )

430 
domü_æags
 |ğ
DOMCRF_hvm
;

431 iàĞ
İ
->
u
.
ü—‹domaš
.
æags
 & 
XEN_DOMCTL_CDF_h­
 )

432 
domü_æags
 |ğ
DOMCRF_h­
;

433 iàĞ
İ
->
u
.
ü—‹domaš
.
æags
 & 
XEN_DOMCTL_CDF_s3_š‹gr™y
 )

434 
domü_æags
 |ğ
DOMCRF_s3_š‹gr™y
;

435 iàĞ
İ
->
u
.
ü—‹domaš
.
æags
 & 
XEN_DOMCTL_CDF_oos_off
 )

436 
domü_æags
 |ğ
DOMCRF_oos_off
;

438 
»t
 = -
ENOMEM
;

439 
d
 = 
	`domaš_ü—‹
(
dom
, 
domü_æags
, 
İ
->
u
.
ü—‹domaš
.
ssid»f
);

440 iàĞ
d
 =ğ
NULL
 )

443 
»t
 = 0;

445 
	`memıy
(
d
->
hªdË
, 
İ
->
u
.
ü—‹domaš
.handle,

446 (
x’_domaš_hªdË_t
));

448 
İ
->
domaš
 = 
d
->
domaš_id
;

449 iàĞ
	`cİy_to_gue¡
(
u_domùl
, 
İ
, 1) )

450 
»t
 = -
EFAULT
;

454 
XEN_DOMCTL_max_vıus
:

456 
domaš
 *
d
;

457 
i
, 
max
 = 
İ
->
u
.
max_vıus
.max, 
ıu
;

458 
ıumask_t
 *
Úlše
;

460 
»t
 = -
ESRCH
;

461 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
)è=ğ
NULL
 )

464 
»t
 = -
EINVAL
;

465 iàĞ(
d
 =ğ
cu¼’t
->
domaš
) ||

466 (
max
 > 
MAX_VIRT_CPUS
) ||

467 (
	`is_hvm_domaš
(
d
è&& (
max
 > 
MAX_HVM_VCPUS
)) )

469 
	`rcu_uÆock_domaš
(
d
);

473 
»t
 = 
	`xsm_max_vıus
(
d
);

474 iàĞ
»t
 )

476 
	`rcu_uÆock_domaš
(
d
);

481 iàĞ
d
->
x’İrof
 )

483 
	`rcu_uÆock_domaš
(
d
);

484 
»t
 = -
EAGAIN
;

489 
	`domaš_·u£
(
d
);

492 
»t
 = -
EINVAL
;

493 iàĞ(
max
 < 
d
->
max_vıus
è&& (d->
vıu
[max] !ğ
NULL
) )

494 
maxvıu_out
;

502 
»t
 = -
EBUSY
;

503 iàĞ(
d
->
max_vıus
 > 0è&& (
max
 > d->max_vcpus) )

504 
maxvıu_out
;

506 
»t
 = -
ENOMEM
;

507 
Úlše
 = (
d
->
ıupoŞ
 =ğ
NULL
è? &
ıu_Úlše_m­
 : &d->ıupoŞ->
ıu_v®id
;

508 iàĞ
max
 > 
d
->
max_vıus
 )

510 
vıu
 **
vıus
;

512 
	`BUG_ON
(
d
->
vıu
 !ğ
NULL
);

513 
	`BUG_ON
(
d
->
max_vıus
 != 0);

515 iàĞ(
vıus
 = 
	`xm®loc_¬¿y
(
vıu
 *, 
max
)è=ğ
NULL
 )

516 
maxvıu_out
;

517 
	`mem£t
(
vıus
, 0, 
max
 * (*vcpus));

520 
d
->
vıu
 = 
vıus
;

521 
	`wmb
();

522 
d
->
max_vıus
 = 
max
;

525  
i
 = 0; i < 
max
; i++ )

527 iàĞ
d
->
vıu
[
i
] !ğ
NULL
 )

530 
ıu
 = (
i
 == 0) ?

531 
	`deçuÉ_vıu0_loÿtiÚ
(
Úlše
) :

532 
	`cyşe_ıu
(
d
->
vıu
[
i
-1]->
´oûssÜ
, *
Úlše
);

534 iàĞ
	`®loc_vıu
(
d
, 
i
, 
ıu
è=ğ
NULL
 )

535 
maxvıu_out
;

538 
»t
 = 0;

540 
maxvıu_out
:

541 
	`domaš_uÅau£
(
d
);

542 
	`rcu_uÆock_domaš
(
d
);

546 
XEN_DOMCTL_de¡roydomaš
:

548 
domaš
 *
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->domain);

549 
»t
 = -
ESRCH
;

550 iàĞ
d
 !ğ
NULL
 )

552 
»t
 = 
	`xsm_de¡roydomaš
(
d
è? : 
	`domaš_kl
(d);

553 
	`rcu_uÆock_domaš
(
d
);

558 
XEN_DOMCTL_£tvıuaffš™y
:

559 
XEN_DOMCTL_g‘vıuaffš™y
:

561 
domid_t
 
dom
 = 
İ
->
domaš
;

562 
domaš
 *
d
 = 
	`rcu_lock_domaš_by_id
(
dom
);

563 
vıu
 *
v
;

564 
ıumask_t
 
Ãw_affš™y
;

566 
»t
 = -
ESRCH
;

567 iàĞ
d
 =ğ
NULL
 )

570 
»t
 = 
	`xsm_vıuaffš™y
(
İ
->
cmd
, 
d
);

571 iàĞ
»t
 )

572 
vıuaffš™y_out
;

574 
»t
 = -
EINVAL
;

575 iàĞ
İ
->
u
.
vıuaffš™y
.
vıu
 >ğ
d
->
max_vıus
 )

576 
vıuaffš™y_out
;

578 
»t
 = -
ESRCH
;

579 iàĞ(
v
 = 
d
->
vıu
[
İ
->
u
.
vıuaffš™y
.vıu]è=ğ
NULL
 )

580 
vıuaffš™y_out
;

582 iàĞ
İ
->
cmd
 =ğ
XEN_DOMCTL_£tvıuaffš™y
 )

584 
»t
 = 
	`x’ùl_ıum­_to_ıumask
(

585 &
Ãw_affš™y
, &
İ
->
u
.
vıuaffš™y
.
ıum­
);

586 iàĞ!
»t
 )

587 
»t
 = 
	`vıu_£t_affš™y
(
v
, &
Ãw_affš™y
);

591 
»t
 = 
	`ıumask_to_x’ùl_ıum­
(

592 &
İ
->
u
.
vıuaffš™y
.
ıum­
, &
v
->
ıu_affš™y
);

595 
vıuaffš™y_out
:

596 
	`rcu_uÆock_domaš
(
d
);

600 
XEN_DOMCTL_scheduËr_İ
:

602 
domaš
 *
d
;

604 
»t
 = -
ESRCH
;

605 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
)è=ğ
NULL
 )

608 
»t
 = 
	`xsm_scheduËr
(
d
);

609 iàĞ
»t
 )

610 
scheduËr_İ_out
;

612 
»t
 = 
	`sched_adju¡
(
d
, &
İ
->
u
.
scheduËr_İ
);

613 iàĞ
	`cİy_to_gue¡
(
u_domùl
, 
İ
, 1) )

614 
»t
 = -
EFAULT
;

616 
scheduËr_İ_out
:

617 
	`rcu_uÆock_domaš
(
d
);

621 
XEN_DOMCTL_g‘domaššfo
:

623 
domaš
 *
d
;

624 
domid_t
 
dom
 = 
İ
->
domaš
;

626 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

628 
	`fÜ_—ch_domaš
 ( 
d
 )

629 iàĞ
d
->
domaš_id
 >ğ
dom
 )

632 iàĞ
d
 =ğ
NULL
 )

634 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

635 
»t
 = -
ESRCH
;

639 
»t
 = 
	`xsm_g‘domaššfo
(
d
);

640 iàĞ
»t
 )

641 
g‘domaššfo_out
;

643 
	`g‘domaššfo
(
d
, &
İ
->
u
.
g‘domaššfo
);

645 
İ
->
domaš
 = op->
u
.
g‘domaššfo
.domain;

646 iàĞ
	`cİy_to_gue¡
(
u_domùl
, 
İ
, 1) )

647 
»t
 = -
EFAULT
;

649 
g‘domaššfo_out
:

650 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

654 
XEN_DOMCTL_g‘vıucÚ‹xt
:

656 
vıu_gue¡_cÚ‹xt_u
 
c
 = { .
Çt
 = 
NULL
 };

657 
domaš
 *
d
;

658 
vıu
 *
v
;

660 
»t
 = -
ESRCH
;

661 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
)è=ğ
NULL
 )

664 
»t
 = 
	`xsm_g‘vıucÚ‹xt
(
d
);

665 iàĞ
»t
 )

666 
g‘vıucÚ‹xt_out
;

668 
»t
 = -
EINVAL
;

669 iàĞ
İ
->
u
.
vıucÚ‹xt
.
vıu
 >ğ
d
->
max_vıus
 )

670 
g‘vıucÚ‹xt_out
;

672 
»t
 = -
ESRCH
;

673 iàĞ(
v
 = 
d
->
vıu
[
İ
->
u
.
vıucÚ‹xt
.vıu]è=ğ
NULL
 )

674 
g‘vıucÚ‹xt_out
;

676 
»t
 = -
ENODATA
;

677 iàĞ!
v
->
is_š™Ÿli£d
 )

678 
g‘vıucÚ‹xt_out
;

680 #ifdeà
CONFIG_COMPAT


681 
	`BUILD_BUG_ON
((
vıu_gue¡_cÚ‹xt
)

682 < (
com·t_vıu_gue¡_cÚ‹xt
));

684 
»t
 = -
ENOMEM
;

685 iàĞ(
c
.
Çt
 = 
	`xm®loc
(
vıu_gue¡_cÚ‹xt
)è=ğ
NULL
 )

686 
g‘vıucÚ‹xt_out
;

688 iàĞ
v
 !ğ
cu¼’t
 )

689 
	`vıu_·u£
(
v
);

691 
	`¬ch_g‘_šfo_gue¡
(
v
, 
c
);

692 
»t
 = 0;

694 iàĞ
v
 !ğ
cu¼’t
 )

695 
	`vıu_uÅau£
(
v
);

697 #ifdeà
CONFIG_COMPAT


698 iàĞ!
	`is_pv_32Ú64_vıu
(
v
) )

699 
»t
 = 
	`cİy_to_gue¡
(
İ
->
u
.
vıucÚ‹xt
.
ùxt
, 
c
.
Çt
, 1);

701 
»t
 = 
	`cİy_to_gue¡
(
	`gue¡_hªdË_ÿ¡
(
İ
->
u
.
vıucÚ‹xt
.
ùxt
,

702 ), 
c
.
cmp
, 1);

704 
»t
 = 
	`cİy_to_gue¡
(
İ
->
u
.
vıucÚ‹xt
.
ùxt
, 
c
.
Çt
, 1);

707 iàĞ
	`cİy_to_gue¡
(
u_domùl
, 
İ
, 1è|| 
»t
 )

708 
»t
 = -
EFAULT
;

710 
g‘vıucÚ‹xt_out
:

711 
	`xä“
(
c
.
Çt
);

712 
	`rcu_uÆock_domaš
(
d
);

716 
XEN_DOMCTL_g‘vıušfo
:

718 
domaš
 *
d
;

719 
vıu
 *
v
;

720 
vıu_run¡©e_šfo
 
run¡©e
;

722 
»t
 = -
ESRCH
;

723 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
)è=ğ
NULL
 )

726 
»t
 = 
	`xsm_g‘vıušfo
(
d
);

727 iàĞ
»t
 )

728 
g‘vıušfo_out
;

730 
»t
 = -
EINVAL
;

731 iàĞ
İ
->
u
.
g‘vıušfo
.
vıu
 >ğ
d
->
max_vıus
 )

732 
g‘vıušfo_out
;

734 
»t
 = -
ESRCH
;

735 iàĞ(
v
 = 
d
->
vıu
[
İ
->
u
.
g‘vıušfo
.vıu]è=ğ
NULL
 )

736 
g‘vıušfo_out
;

738 
	`vıu_run¡©e_g‘
(
v
, &
run¡©e
);

740 
İ
->
u
.
g‘vıušfo
.
Úlše
 = !
	`‹¡_b™
(
_VPF_down
, &
v
->
·u£_æags
);

741 
İ
->
u
.
g‘vıušfo
.
blocked
 = 
	`‹¡_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

742 
İ
->
u
.
g‘vıušfo
.
ruÂšg
 = 
v
->
is_ruÂšg
;

743 
İ
->
u
.
g‘vıušfo
.
ıu_time
 = 
run¡©e
.
time
[
RUNSTATE_ruÂšg
];

744 
İ
->
u
.
g‘vıušfo
.
ıu
 = 
v
->
´oûssÜ
;

745 
»t
 = 0;

747 iàĞ
	`cİy_to_gue¡
(
u_domùl
, 
İ
, 1) )

748 
»t
 = -
EFAULT
;

750 
g‘vıušfo_out
:

751 
	`rcu_uÆock_domaš
(
d
);

755 
XEN_DOMCTL_max_mem
:

757 
domaš
 *
d
;

758 
Ãw_max
;

760 
»t
 = -
ESRCH
;

761 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

762 iàĞ
d
 =ğ
NULL
 )

765 
»t
 = 
	`xsm_£tdomašmaxmem
(
d
);

766 iàĞ
»t
 )

767 
max_mem_out
;

769 
»t
 = -
EINVAL
;

770 
Ãw_max
 = 
İ
->
u
.
max_mem
.
max_memkb
 >> (
PAGE_SHIFT
-10);

772 
	`¥š_lock
(&
d
->
·ge_®loc_lock
);

778 
d
->
max_·ges
 = 
Ãw_max
;

779 
»t
 = 0;

780 
	`¥š_uÆock
(&
d
->
·ge_®loc_lock
);

782 
max_mem_out
:

783 
	`rcu_uÆock_domaš
(
d
);

787 
XEN_DOMCTL_£tdomašhªdË
:

789 
domaš
 *
d
;

791 
»t
 = -
ESRCH
;

792 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

793 iàĞ
d
 =ğ
NULL
 )

796 
»t
 = 
	`xsm_£tdomašhªdË
(
d
);

797 iàĞ
»t
 )

799 
	`rcu_uÆock_domaš
(
d
);

803 
	`memıy
(
d
->
hªdË
, 
İ
->
u
.
£tdomašhªdË
.handle,

804 (
x’_domaš_hªdË_t
));

805 
	`rcu_uÆock_domaš
(
d
);

806 
»t
 = 0;

810 
XEN_DOMCTL_£tdebuggšg
:

812 
domaš
 *
d
;

814 
»t
 = -
ESRCH
;

815 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

816 iàĞ
d
 =ğ
NULL
 )

819 
»t
 = -
EINVAL
;

820 iàĞ
d
 =ğ
cu¼’t
->
domaš
 )

822 
	`rcu_uÆock_domaš
(
d
);

826 
»t
 = 
	`xsm_£tdebuggšg
(
d
);

827 iàĞ
»t
 )

829 
	`rcu_uÆock_domaš
(
d
);

833 
	`domaš_·u£
(
d
);

834 
d
->
debugg”_©ched
 = !!
İ
->
u
.
£tdebuggšg
.
’abË
;

835 
	`domaš_uÅau£
(
d
);

836 
	`rcu_uÆock_domaš
(
d
);

837 
»t
 = 0;

841 
XEN_DOMCTL_œq_³rmissiÚ
:

843 
domaš
 *
d
;

844 
pœq
 = 
İ
->
u
.
œq_³rmissiÚ
.pirq;

846 
»t
 = -
ESRCH
;

847 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

848 iàĞ
d
 =ğ
NULL
 )

851 iàĞ
pœq
 >ğ
d
->
Ä_pœqs
 )

852 
»t
 = -
EINVAL
;

853 iàĞ
İ
->
u
.
œq_³rmissiÚ
.
®low_acûss
 )

854 
»t
 = 
	`œq_³rm™_acûss
(
d
, 
pœq
);

856 
»t
 = 
	`œq_d’y_acûss
(
d
, 
pœq
);

858 
	`rcu_uÆock_domaš
(
d
);

862 
XEN_DOMCTL_iomem_³rmissiÚ
:

864 
domaš
 *
d
;

865 
mâ
 = 
İ
->
u
.
iomem_³rmissiÚ
.
fœ¡_mâ
;

866 
Ä_mâs
 = 
İ
->
u
.
iomem_³rmissiÚ
.nr_mfns;

868 
»t
 = -
EINVAL
;

869 iàĞ(
mâ
 + 
Ä_mâs
 - 1) < mfn )

872 
»t
 = -
ESRCH
;

873 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

874 iàĞ
d
 =ğ
NULL
 )

877 iàĞ
İ
->
u
.
iomem_³rmissiÚ
.
®low_acûss
 )

878 
»t
 = 
	`iomem_³rm™_acûss
(
d
, 
mâ
, mâ + 
Ä_mâs
 - 1);

880 
»t
 = 
	`iomem_d’y_acûss
(
d
, 
mâ
, mâ + 
Ä_mâs
 - 1);

882 
	`rcu_uÆock_domaš
(
d
);

886 
XEN_DOMCTL_£‰imeoff£t
:

888 
domaš
 *
d
;

890 
»t
 = -
ESRCH
;

891 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

892 iàĞ
d
 =ğ
NULL
 )

895 
»t
 = 
	`xsm_domaš_£‰ime
(
d
);

896 iàĞ
»t
 )

898 
	`rcu_uÆock_domaš
(
d
);

902 
	`domaš_£t_time_off£t
(
d
, 
İ
->
u
.
£‰imeoff£t
.
time_off£t_£cÚds
);

903 
	`rcu_uÆock_domaš
(
d
);

904 
»t
 = 0;

908 
XEN_DOMCTL_£t_rg‘
:

910 
domaš
 *
d
, *
e
;

912 
»t
 = -
ESRCH
;

913 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

914 iàĞ
d
 =ğ
NULL
 )

917 
»t
 = -
ESRCH
;

918 
e
 = 
	`g‘_domaš_by_id
(
İ
->
u
.
£t_rg‘
.
rg‘
);

919 iàĞ
e
 =ğ
NULL
 )

920 
£t_rg‘_out
;

922 
»t
 = -
EINVAL
;

923 iàĞ(
d
 =ğ
e
è|| (d->
rg‘
 !ğ
NULL
) )

925 
	`put_domaš
(
e
);

926 
£t_rg‘_out
;

929 
»t
 = 
	`xsm_£t_rg‘
(
d
, 
e
);

930 iàĞ
»t
 ) {

931 
	`put_domaš
(
e
);

932 
£t_rg‘_out
;

936 
d
->
rg‘
 = 
e
;

938 
»t
 = 0;

940 
£t_rg‘_out
:

941 
	`rcu_uÆock_domaš
(
d
);

945 
XEN_DOMCTL_subsüibe
:

947 
domaš
 *
d
;

949 
»t
 = -
ESRCH
;

950 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
);

951 iàĞ
d
 !ğ
NULL
 )

953 
d
->
su¥’d_evtchn
 = 
İ
->
u
.
subsüibe
.
pÜt
;

954 
	`rcu_uÆock_domaš
(
d
);

955 
»t
 = 0;

960 
XEN_DOMCTL_di§bË_mig¿‹
:

962 
domaš
 *
d
;

963 
»t
 = -
ESRCH
;

964 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
İ
->
domaš
)è!ğ
NULL
 )

966 
d
->
di§bË_mig¿‹
 = 
İ
->
u
.di§bË_mig¿‹.
di§bË
;

967 
	`rcu_uÆock_domaš
(
d
);

968 
»t
 = 0;

974 
»t
 = 
	`¬ch_do_domùl
(
İ
, 
u_domùl
);

978 
	`domùl_lock_»Ëa£
();

980  
»t
;

981 
	}
}

	@estate-driver.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/k”Ãl.h
>

3 
	~<asm/uacûss.h
>

4 
	~<lšux/´oc_fs.h
>

5 
	~<lšux/tim”.h
>

6 
	~<lšux/k”Ãl_¡©.h
>

7 
	~<lšux/mm.h
>

9 
	~<lšux/tick.h
>

10 
	~<lšux/time.h
>

12 
	~<x’/x’.h
>

13 
	~<x’/š‹rçû/x’.h
>

14 
	~<asm/x’/hy³rÿÎ.h
>

15 
	~<asm/x’/hy³rvisÜ.h
>

17 
	#PROCFS_MAX_SIZE
 100

	)

18 
	#PROCFS_NAME
 "qos"

	)

19 
	#TIMER
 1000

	)

21 
	#ECODE
 0

	)

23 
	eESTATE
{

24 
	mEUP
 = 2,

25 
	mENC
 = 1,

26 
	mEDN
 = 0,

29 
eÿp
 
	gÿp
;

31 
	#NUM_ESTATES
 3

	)

33 
	#LOAD
 0

	)

34 
	#QOS
 1

	)

36 
	#HIST_COUNTER
 2

	)

38 
	ge¥“d
 = 100;

39 
	g’abË
 = 0;

40 
	gcouÁ”
[
NUM_ESTATES
] = {0};

41 
	gqos_m‘ric
 = 0, 
	glßd_m‘ric
 = 0;

44 
	gqos_max
 = 50;

45 
	gqos_mš
 = 30;

48 
	gm‘ric
 = 
QOS
;

49 
	glßd_max
 = 90;

50 
	glßd_mš
 = 60;

52 
moduË_·¿m
(
’abË
, , 0);

53 
moduË_·¿m
(
m‘ric
, , 0);

57 
tim”_li¡
 
	gmy_tim”
;

59 
	g´oc_d©a
[
PROCFS_MAX_SIZE
];

61 
´oc_dœ_’Œy
 *
	g´oc_wr™e_’Œy
;

63 
ušt16_t
 
	$ÿlc_pù_m‘ric
(
s64
 
dtİ
, s64 
dbÙtom
)

65 ià(
dbÙtom
>10000)

66 
dbÙtom
 /= 100;

68 
dtİ
 *= 100;

70 ià(!
dbÙtom
)

73 
dtİ
 /ğ
dbÙtom
;

74  
dtİ
;

75 
	}
}

77 
DEFINE_PER_CPU
(
s64
, 
idË_´evious
) = 0;

78 
DEFINE_PER_CPU
(
s64
, 
tÙ®_´evious
) = 0;

80 #iâdeà
¬ch_idË_time


81 
	#¬ch_idË_time
(
ıu
è0

	)

83 
u64
 
	$n£cs_to_jiff›s64
(
u64
 
n
)

85 #ià(
NSEC_PER_SEC
 % 
HZ
) == 0

87  
	`div_u64
(
n
, 
NSEC_PER_SEC
 / 
HZ
);

88 #–ià(
HZ
 % 512) == 0

90  
	`div_u64
(
n
 * 
HZ
 / 512, 
NSEC_PER_SEC
 / 512);

96  
	`div_u64
(
n
 * 9, (9uÎ * 
NSEC_PER_SEC
 + 
HZ
 / 2) / HZ);

98 
	}
}

100 
u64
 
	$g‘_idË_time
(
ıu
)

102 
u64
 
idË
, 
idË_time
 = 
	`g‘_ıu_idË_time_us
(
ıu
, 
NULL
);

104 ià(
idË_time
 == -1ULL) {

106 
idË
 = 
	`kıu¡©_ıu
(
ıu
).
ıu¡©
[
CPUTIME_IDLE
];

107 
idË
 +ğ
	`¬ch_idË_time
(
ıu
);

109 
idË
 = 
	`u£cs_to_ıutime64
(
idË_time
);

111  
idË
;

112 
	}
}

114 
u64
 
	$g‘_iowa™_time
(
ıu
)

116 
u64
 
iowa™
, 
iowa™_time
 = 
	`g‘_ıu_iowa™_time_us
(
ıu
, 
NULL
);

118 ià(
iowa™_time
 == -1ULL)

120 
iowa™
 = 
	`kıu¡©_ıu
(
ıu
).
ıu¡©
[
CPUTIME_IOWAIT
];

122 
iowa™
 = 
	`u£cs_to_ıutime64
(
iowa™_time
);

124  
iowa™
;

125 
	}
}

127 
	$g‘_lßd
(
ıu
)

129 
i
 = 
ıu
;

130 
u64
 
u£r
, 
niû
, 
sy¡em
, 
idË
, 
iowa™
, 
œq
, 
soáœq
, 
¡—l
;

131 
u64
 
gue¡
, 
gue¡_niû
;

132 
u64
 
sum
 = 0;

133 
s64
 
tÙ®_cu¼’t
, 
idË_cu¼’t
, 
idË_Ï¡
, 
tÙ®_Ï¡
;

134 
s64
 
lßd
;

136 
u£r
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_USER
];

137 
niû
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_NICE
];

138 
sy¡em
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_SYSTEM
];

139 
idË
 = 
	`g‘_idË_time
(
i
);

140 
iowa™
 = 
	`g‘_iowa™_time
(
i
);

141 
œq
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_IRQ
];

142 
soáœq
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_SOFTIRQ
];

143 
¡—l
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_STEAL
];

144 
gue¡
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_GUEST
];

145 
gue¡_niû
 = 
	`kıu¡©_ıu
(
i
).
ıu¡©
[
CPUTIME_GUEST_NICE
];

147 
u£r
 = 
	`ıutime64_to_şock_t
(user);

148 
niû
 = 
	`ıutime64_to_şock_t
(nice);

149 
sy¡em
 = 
	`ıutime64_to_şock_t
(system);

150 
idË
 = 
	`ıutime64_to_şock_t
(idle);

151 
iowa™
 = 
	`ıutime64_to_şock_t
(iowait);

152 
œq
 = 
	`ıutime64_to_şock_t
(irq);

153 
soáœq
 = 
	`ıutime64_to_şock_t
(softirq);

154 
¡—l
 = 
	`ıutime64_to_şock_t
(steal);

155 
gue¡
 = 
	`ıutime64_to_şock_t
(guest);

156 
gue¡_niû
 = 
	`ıutime64_to_şock_t
(guest_nice);

158 
sum
 = 
u£r
 + 
niû
 + 
sy¡em
 + 
idË
 + 
iowa™
 + 
œq
 + 
soáœq
 + 
¡—l
 + 
gue¡
 + 
gue¡_niû
;

160 
idË_Ï¡
 = 
	`³r_ıu
(
idË_´evious
,
ıu
);

161 
tÙ®_Ï¡
 = 
	`³r_ıu
(
tÙ®_´evious
,
ıu
);

163 
idË_cu¼’t
 = 
idË
 - 
idË_Ï¡
;

164 
tÙ®_cu¼’t
 = 
sum
 - 
tÙ®_Ï¡
;

166 
lßd
 = 
	`ÿlc_pù_m‘ric
(
tÙ®_cu¼’t
 - 
idË_cu¼’t
,total_current);

168 
	`³r_ıu
(
tÙ®_´evious
,
ıu
èğ
sum
;

169 
	`³r_ıu
(
idË_´evious
,
ıu
èğ
idË
;

171  
lßd
;

172 
	}
}

173 
šlše
 
s64
 
	$»ad_tsc
()

175 
s64
 
v
;

176 
	`rdtsşl
(
v
);

177  
v
;

178 
	}
}

187 
	$»ad_´oc
(*
buf
,**
¡¬t
,
off_t
 
off£t
,
couÁ
,*
eof
,*
d©a
 )

189 
Ën
=0;

190 
Ën
 = 
	`¥rštf
(
buf
,"%s",
´oc_d©a
);

191  
Ën
;

192 
	}
}

194 
ušt64_t
 
	gš¡ns
[
MAX_VCPUS
], 
	gaùive
[MAX_VCPUS], 
	glmis£s
[MAX_VCPUS], 
	grmis£s
[MAX_VCPUS], 
	gcyşes
[MAX_VCPUS];

195 
boŞ
 
	gty³
[
MAX_VCPUS
];

196 
	glßd
[
MAX_VCPUS
];

198 
	$»ad_³rf_ùrs
()

200 
ıu
;

201 
rc
, 
İ
 = 0;

202 
³rf_ùrs
 
¬g
[
MAX_VCPUS
];

203 
lßd_s
 = 0, 
lßd_f
 = 0;

204 
ušt16_t
 
cÜe_f
 = 0, 
cÜe_s
 = 0;

205 
ušt64_t
 
mem_ä“
 = 
	`glob®_·ge_¡©e
(
NR_FREE_PAGES
);

206 
lßd_m‘ric
 = 0;

208 
	`ssÿnf
(
´oc_d©a
,"%d",&
qos_m‘ric
);

210 
rc
 = 
	`HYPERVISOR_³rfùr_İ
(
İ
,
¬g
);

212 
	`´štk
("PCTRS ");

213 
	`fÜ_—ch_Úlše_ıu
(
ıu
){

214 
š¡ns
[
ıu
] = 
¬g
[cpu].instns;

215 
aùive
[
ıu
] = 
¬g
[cpu].active;

216 
lmis£s
[
ıu
] = 
¬g
[cpu].lmisses;

217 
rmis£s
[
ıu
] = 
¬g
[cpu].rmisses;

218 
cyşes
[
ıu
] = 
¬g
[cpu].cycles;

219 
ty³
[
ıu
] = 
¬g
[ıu].
cÜe_ty³
;

221 
lßd
[
ıu
] = 
	`max
(0,
	`ÿlc_pù_m‘ric
(
aùive
[ıu],
cyşes
[cpu]) -1);

223 if(
ty³
[
ıu
] == 0){

224 
lßd_s
 +ğ
lßd
[
ıu
];

225 
cÜe_s
++;

228 
lßd_f
 +ğ
lßd
[
ıu
];

229 
cÜe_f
++;

232 
	`´štk
("%d ",
lßd
[
ıu
]);

234 
lßd_m‘ric
 +ğ
cÜe_s
*
	`ÿlc_pù_m‘ric
(
lßd_s
, 
ÿp
.
sÿp
);

235 
lßd_m‘ric
 +ğ
cÜe_f
*
	`ÿlc_pù_m‘ric
(
lßd_f
, 
ÿp
.
fÿp
);

236 
lßd_m‘ric
 /ğ
	`num_Úlše_ıus
();

238 
	`´štk
("†d:%d (%d %dèqo %d f %dƒ %d c­ %d %dƒm %Îu\n",
lßd_m‘ric
,
lßd_s
,
lßd_f
,
qos_m‘ric
,
cÜe_f
,
e¥“d
,
ÿp
.
sÿp
,ÿp.
fÿp
,(
mem_ä“
*4)/1024);

239  
lßd_m‘ric
;

240 
	}
}

242 
	$g‘_e¡©e
()

244 
e¡©e
 = 1;

245 
i
;

247 ià(!
	`x’_domaš
())

250 
lßd_m‘ric
 = 
	`»ad_³rf_ùrs
();

252 if(
’abË
){

253 if(
m‘ric
 =ğ
QOS
){

255 ifĞ
qos_m‘ric
 >ğ
qos_max
 )

256 
e¡©e
 = 
EUP
;

257 if(
qos_m‘ric
 <ğ
qos_mš
 && 
lßd_m‘ric
 <ğ
lßd_mš
)

259 
e¡©e
 = 
EDN
;

261 
e¡©e
 = 
ENC
;

263 if(
m‘ric
 =ğ
LOAD
){

264 if(
lßd_m‘ric
 >ğ
lßd_max
)

265 
e¡©e
 = 
EUP
;

266 ifĞ
lßd_m‘ric
 <ğ
lßd_mš
)

267 
e¡©e
 = 
EDN
;

269 
e¡©e
 = 
ENC
;

273 
e¡©e
 = 
ENC
;

274 
i
=0;i<
NUM_ESTATES
;i++){

275 if(
i
 =ğ
e¡©e
){

276 
couÁ”
[
i
]++;

277 if(
couÁ”
[
i
] > 
HIST_COUNTER
)

278 
couÁ”
[
i
] = 1;

281 
couÁ”
[
i
]= 0;

284  
e¡©e
;

285 
	}
}

287 
time¥ec
 
	gnow
, 
	gÏ¡
 = {0,0};

288 
	$wr™e_´oc
(
fe
 *fe,cÚ¡ *
buf
,
couÁ
,*
d©a
 )

294 if(
	`cİy_äom_u£r
(
´oc_d©a
, 
buf
, 
couÁ
))

295  -
EFAULT
;

306  
couÁ
;

307 
	}
}

309 
	$ü—‹_Ãw_´oc_’Œy
() {

310 
´oc_wr™e_’Œy
 = 
	`ü—‹_´oc_’Œy
(
PROCFS_NAME
,0666,
NULL
);

311 if(!
´oc_wr™e_’Œy
)

312 
	`´štk
(
KERN_INFO
 "Error creating…rocƒntry");

314 
´oc_wr™e_’Œy
->
»ad_´oc
 =„ead_proc ;

315 
´oc_wr™e_’Œy
->
wr™e_´oc
 = write_proc;

316 
	`´štk
(
KERN_INFO
 "Estate-driver init\n");

319 
	}
}

321 
	$upd©e_e¡©e
Ğ
d©a
 ){

322 
e¡©e
;

324 
e¡©e
 = 
	`g‘_e¡©e
();

326 if(
couÁ”
[
e¡©e
] =ğ
HIST_COUNTER
){

327 
e¥“d
 = 
	`HYPERVISOR_e¡©e_İ
(
ECODE
,
e¡©e
,&
ÿp
);

328 
	`´štk
("E¡©%d qo %d (%d %dèlßd %d (%d %dè\n",
e¡©e
,
qos_m‘ric
,
qos_mš
,
qos_max
,
lßd_m‘ric
,
lßd_mš
,
lßd_max
);

332 
	`mod_tim”
Ğ&
my_tim”
, 
jiff›s
 + 
	`m£cs_to_jiff›s
(
TIMER
) );

333 
	}
}

335 
	$e¡©e_š™
 () {

336 
»t
 =0;

338 if(
	`num_Úlše_ıus
(è> 
MAX_VCPUS
)

339 
	`´štk
("Fix CPU count\n");

341 
	`£tup_tim”
Ğ&
my_tim”
, 
upd©e_e¡©e
 , 0 );

342 
»t
 = 
	`mod_tim”
Ğ&
my_tim”
, 
jiff›s
 + 
	`m£cs_to_jiff›s
(
TIMER
) );

344 
	`ü—‹_Ãw_´oc_’Œy
();

345  
»t
;

346 
	}
}

348 
	$e¡©e_ş—nup
() {

349 
»t
;

350 
	`´štk
(
KERN_INFO
 "Estate-driver unload\n");

352 
»t
 = 
	`d–_tim”
Ğ&
my_tim”
 );

353 
	`»move_´oc_’Œy
(
PROCFS_NAME
,
NULL
);

354 
	}
}

356 
MODULE_LICENSE
("GPL");

357 
moduË_š™
(
e¡©e_š™
);

358 
moduË_ex™
(
e¡©e_ş—nup
);

	@event_channel.c

18 
	~<x’/cÚfig.h
>

19 
	~<x’/š™.h
>

20 
	~<x’/lib.h
>

21 
	~<x’/”ºo.h
>

22 
	~<x’/sched.h
>

23 
	~<x’/ev’t.h
>

24 
	~<x’/œq.h
>

25 
	~<x’/ioÿp.h
>

26 
	~<x’/com·t.h
>

27 
	~<x’/gue¡_acûss.h
>

28 
	~<x’/keyhªdËr.h
>

29 
	~<asm/cu¼’t.h
>

31 
	~<public/x’.h
>

32 
	~<public/ev’t_chªÃl.h
>

33 
	~<xsm/xsm.h
>

35 
	#buck‘_äom_pÜt
(
d
,
p
) \

36 ((
d
)->
evtchn
[(
p
)/
EVTCHNS_PER_BUCKET
])

	)

37 
	#pÜt_is_v®id
(
d
,
p
) \

38 (((
p
è>ğ0è&& (Õè< 
	`MAX_EVTCHNS
(
d
)) && \

39 (
	`buck‘_äom_pÜt
(
d
,
p
è!ğ
NULL
))

	)

40 
	#evtchn_äom_pÜt
(
d
,
p
) \

41 (&(
	`buck‘_äom_pÜt
(
d
,
p
))[Õ)&(
EVTCHNS_PER_BUCKET
-1)])

	)

43 
	#ERROR_EXIT
(
_”ºo
) \

45 
	`gd´štk
(
XENLOG_WARNING
, \

47 (
_”ºo
)); \

48 
rc
 = (
_”ºo
); \

49 
out
; \

50 }  0 )

	)

51 
	#ERROR_EXIT_DOM
(
_”ºo
, 
_dom
) \

53 
	`gd´štk
(
XENLOG_WARNING
, \

55 (
_dom
)->
domaš_id
, (
_”ºo
)); \

56 
rc
 = (
_”ºo
); \

57 
out
; \

58 }  0 )

	)

60 
evtchn_£t_³ndšg
(
vıu
 *
v
, 
pÜt
);

62 
	$vœq_is_glob®
(
vœq
)

64 
rc
;

66 
	`ASSERT
((
vœq
 >ğ0è&& (vœq < 
NR_VIRQS
));

68  
vœq
 )

70 
VIRQ_TIMER
:

71 
VIRQ_DEBUG
:

72 
VIRQ_XENOPROF
:

73 
rc
 = 0;

75 
VIRQ_ARCH_0
 ... 
VIRQ_ARCH_7
:

76 
rc
 = 
	`¬ch_vœq_is_glob®
(
vœq
);

79 
rc
 = 1;

83  
rc
;

84 
	}
}

87 
	$g‘_ä“_pÜt
(
domaš
 *
d
)

89 
evtchn
 *
chn
;

90 
pÜt
;

91 
i
, 
j
;

93 iàĞ
d
->
is_dyšg
 )

94  -
EINVAL
;

96  
pÜt
 = 0; 
	`pÜt_is_v®id
(
d
,…ort);…ort++ )

97 iàĞ
	`evtchn_äom_pÜt
(
d
, 
pÜt
)->
¡©e
 =ğ
ECS_FREE
 )

98  
pÜt
;

100 iàĞ
pÜt
 =ğ
	`MAX_EVTCHNS
(
d
) )

101  -
ENOSPC
;

103 
chn
 = 
	`xm®loc_¬¿y
(
evtchn
, 
EVTCHNS_PER_BUCKET
);

104 iàĞ
	`uÆik–y
(
chn
 =ğ
NULL
) )

105  -
ENOMEM
;

106 
	`mem£t
(
chn
, 0, 
EVTCHNS_PER_BUCKET
 * (*chn));

107 
	`buck‘_äom_pÜt
(
d
, 
pÜt
èğ
chn
;

109  
i
 = 0; i < 
EVTCHNS_PER_BUCKET
; i++ )

111 iàĞ
	`xsm_®loc_£cur™y_evtchn
(&
chn
[
i
]) )

113  
j
 = 0; j < 
i
; j++ )

114 
	`xsm_ä“_£cur™y_evtchn
(&
chn
[
j
]);

115 
	`xä“
(
chn
);

116  -
ENOMEM
;

120  
pÜt
;

121 
	}
}

124 
	$evtchn_®loc_unbound
(
evtchn_®loc_unbound_t
 *
®loc
)

126 
evtchn
 *
chn
;

127 
domaš
 *
d
;

128 
pÜt
;

129 
domid_t
 
dom
 = 
®loc
->dom;

130 
rc
;

132 
rc
 = 
	`rcu_lock_rg‘_domaš_by_id
(
dom
, &
d
);

133 iàĞ
rc
 )

134  
rc
;

136 
	`¥š_lock
(&
d
->
ev’t_lock
);

138 iàĞ(
pÜt
 = 
	`g‘_ä“_pÜt
(
d
)) < 0 )

139 
	`ERROR_EXIT_DOM
(
pÜt
, 
d
);

140 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

142 
rc
 = 
	`xsm_evtchn_unbound
(
d
, 
chn
, 
®loc
->
»mÙe_dom
);

143 iàĞ
rc
 )

144 
out
;

146 
chn
->
¡©e
 = 
ECS_UNBOUND
;

147 iàĞ(
chn
->
u
.
unbound
.
»mÙe_domid
 = 
®loc
->
»mÙe_dom
è=ğ
DOMID_SELF
 )

148 
chn
->
u
.
unbound
.
»mÙe_domid
 = 
cu¼’t
->
domaš
->
domaš_id
;

150 
®loc
->
pÜt
 =…ort;

152 
out
:

153 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

154 
	`rcu_uÆock_domaš
(
d
);

156  
rc
;

157 
	}
}

160 
	$evtchn_bšd_š‹rdomaš
(
evtchn_bšd_š‹rdomaš_t
 *
bšd
)

162 
evtchn
 *
lchn
, *
rchn
;

163 
domaš
 *
ld
 = 
cu¼’t
->domaš, *
rd
;

164 
ÍÜt
, 
½Üt
 = 
bšd
->
»mÙe_pÜt
;

165 
domid_t
 
rdom
 = 
bšd
->
»mÙe_dom
;

166 
rc
;

168 iàĞ
rdom
 =ğ
DOMID_SELF
 )

169 
rdom
 = 
cu¼’t
->
domaš
->
domaš_id
;

171 iàĞ(
rd
 = 
	`rcu_lock_domaš_by_id
(
rdom
)è=ğ
NULL
 )

172  -
ESRCH
;

175 iàĞ
ld
 < 
rd
 )

177 
	`¥š_lock
(&
ld
->
ev’t_lock
);

178 
	`¥š_lock
(&
rd
->
ev’t_lock
);

182 iàĞ
ld
 !ğ
rd
 )

183 
	`¥š_lock
(&
rd
->
ev’t_lock
);

184 
	`¥š_lock
(&
ld
->
ev’t_lock
);

187 iàĞ(
ÍÜt
 = 
	`g‘_ä“_pÜt
(
ld
)) < 0 )

188 
	`ERROR_EXIT
(
ÍÜt
);

189 
lchn
 = 
	`evtchn_äom_pÜt
(
ld
, 
ÍÜt
);

191 iàĞ!
	`pÜt_is_v®id
(
rd
, 
½Üt
) )

192 
	`ERROR_EXIT_DOM
(-
EINVAL
, 
rd
);

193 
rchn
 = 
	`evtchn_äom_pÜt
(
rd
, 
½Üt
);

194 iàĞ(
rchn
->
¡©e
 !ğ
ECS_UNBOUND
) ||

195 (
rchn
->
u
.
unbound
.
»mÙe_domid
 !ğ
ld
->
domaš_id
) )

196 
	`ERROR_EXIT_DOM
(-
EINVAL
, 
rd
);

198 
rc
 = 
	`xsm_evtchn_š‹rdomaš
(
ld
, 
lchn
, 
rd
, 
rchn
);

199 iàĞ
rc
 )

200 
out
;

202 
lchn
->
u
.
š‹rdomaš
.
»mÙe_dom
 = 
rd
;

203 
lchn
->
u
.
š‹rdomaš
.
»mÙe_pÜt
 = (
u16
)
½Üt
;

204 
lchn
->
¡©e
 = 
ECS_INTERDOMAIN
;

206 
rchn
->
u
.
š‹rdomaš
.
»mÙe_dom
 = 
ld
;

207 
rchn
->
u
.
š‹rdomaš
.
»mÙe_pÜt
 = (
u16
)
ÍÜt
;

208 
rchn
->
¡©e
 = 
ECS_INTERDOMAIN
;

214 
	`evtchn_£t_³ndšg
(
ld
->
vıu
[
lchn
->
nÙify_vıu_id
], 
ÍÜt
);

216 
bšd
->
loÿl_pÜt
 = 
ÍÜt
;

218 
out
:

219 
	`¥š_uÆock
(&
ld
->
ev’t_lock
);

220 iàĞ
ld
 !ğ
rd
 )

221 
	`¥š_uÆock
(&
rd
->
ev’t_lock
);

223 
	`rcu_uÆock_domaš
(
rd
);

225  
rc
;

226 
	}
}

229 
	$evtchn_bšd_vœq
(
evtchn_bšd_vœq_t
 *
bšd
)

231 
evtchn
 *
chn
;

232 
vıu
 *
v
;

233 
domaš
 *
d
 = 
cu¼’t
->domain;

234 
pÜt
, 
vœq
 = 
bšd
->vœq, 
vıu
 = bind->vcpu;

235 
rc
 = 0;

237 iàĞ(
vœq
 < 0è|| (vœq >ğ
	`ARRAY_SIZE
(
v
->
vœq_to_evtchn
)) )

238  -
EINVAL
;

240 iàĞ
	`vœq_is_glob®
(
vœq
è&& (
vıu
 != 0) )

241  -
EINVAL
;

243 iàĞ(
vıu
 < 0è|| (vıu >ğ
d
->
max_vıus
) ||

244 ((
v
 = 
d
->
vıu
[vıu]è=ğ
NULL
) )

245  -
ENOENT
;

247 
	`¥š_lock
(&
d
->
ev’t_lock
);

249 iàĞ
v
->
vœq_to_evtchn
[
vœq
] != 0 )

250 
	`ERROR_EXIT
(-
EEXIST
);

252 iàĞ(
pÜt
 = 
	`g‘_ä“_pÜt
(
d
)) < 0 )

253 
	`ERROR_EXIT
(
pÜt
);

255 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

256 
chn
->
¡©e
 = 
ECS_VIRQ
;

257 
chn
->
nÙify_vıu_id
 = 
vıu
;

258 
chn
->
u
.
vœq
 = virq;

260 
v
->
vœq_to_evtchn
[
vœq
] = 
bšd
->
pÜt
 =…ort;

262 
out
:

263 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

265  
rc
;

266 
	}
}

269 
	$evtchn_bšd_i
(
evtchn_bšd_i_t
 *
bšd
)

271 
evtchn
 *
chn
;

272 
domaš
 *
d
 = 
cu¼’t
->domain;

273 
pÜt
, 
vıu
 = 
bšd
->vcpu;

274 
rc
 = 0;

276 iàĞ(
vıu
 < 0è|| (vıu >ğ
d
->
max_vıus
) ||

277 (
d
->
vıu
[vıu] =ğ
NULL
) )

278  -
ENOENT
;

280 
	`¥š_lock
(&
d
->
ev’t_lock
);

282 iàĞ(
pÜt
 = 
	`g‘_ä“_pÜt
(
d
)) < 0 )

283 
	`ERROR_EXIT
(
pÜt
);

285 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

286 
chn
->
¡©e
 = 
ECS_IPI
;

287 
chn
->
nÙify_vıu_id
 = 
vıu
;

289 
bšd
->
pÜt
 =…ort;

291 
out
:

292 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

294  
rc
;

295 
	}
}

298 
	$lšk_pœq_pÜt
(
pÜt
, 
evtchn
 *
chn
, 
vıu
 *
v
)

300 
chn
->
u
.
pœq
.
´ev_pÜt
 = 0;

301 
chn
->
u
.
pœq
.
Ãxt_pÜt
 = 
v
->
pœq_evtchn_h—d
;

302 iàĞ
v
->
pœq_evtchn_h—d
 )

303 
	`evtchn_äom_pÜt
(
v
->
domaš
, v->
pœq_evtchn_h—d
)

304 ->
u
.
pœq
.
´ev_pÜt
 = 
pÜt
;

305 
v
->
pœq_evtchn_h—d
 = 
pÜt
;

306 
	}
}

308 
	$uÆšk_pœq_pÜt
(
evtchn
 *
chn
, 
vıu
 *
v
)

310 
domaš
 *
d
 = 
v
->domain;

312 iàĞ
chn
->
u
.
pœq
.
´ev_pÜt
 )

313 
	`evtchn_äom_pÜt
(
d
, 
chn
->
u
.
pœq
.
´ev_pÜt
)->u.pœq.
Ãxt_pÜt
 =

314 
chn
->
u
.
pœq
.
Ãxt_pÜt
;

316 
v
->
pœq_evtchn_h—d
 = 
chn
->
u
.
pœq
.
Ãxt_pÜt
;

317 iàĞ
chn
->
u
.
pœq
.
Ãxt_pÜt
 )

318 
	`evtchn_äom_pÜt
(
d
, 
chn
->
u
.
pœq
.
Ãxt_pÜt
)->u.pœq.
´ev_pÜt
 =

319 
chn
->
u
.
pœq
.
´ev_pÜt
;

320 
	}
}

323 
	$evtchn_bšd_pœq
(
evtchn_bšd_pœq_t
 *
bšd
)

325 
evtchn
 *
chn
;

326 
domaš
 *
d
 = 
cu¼’t
->domain;

327 
vıu
 *
v
 = 
d
->vcpu[0];

328 
pÜt
, 
pœq
 = 
bšd
->pirq;

329 
rc
;

331 iàĞ(
pœq
 < 0è|| (pœq >ğ
d
->
Ä_pœqs
) )

332  -
EINVAL
;

334 iàĞ!
	`is_hvm_domaš
(
d
è&& !
	`œq_acûss_³rm™‹d
(d, 
pœq
) )

335  -
EPERM
;

337 
	`¥š_lock
(&
d
->
ev’t_lock
);

339 iàĞ
d
->
pœq_to_evtchn
[
pœq
] != 0 )

340 
	`ERROR_EXIT
(-
EEXIST
);

342 iàĞ(
pÜt
 = 
	`g‘_ä“_pÜt
(
d
)) < 0 )

343 
	`ERROR_EXIT
(
pÜt
);

345 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

347 
d
->
pœq_to_evtchn
[
pœq
] = 
pÜt
;

348 
rc
 = (!
	`is_hvm_domaš
(
d
)

349 ? 
	`pœq_gue¡_bšd
(

350 
v
, 
pœq
, !!(
bšd
->
æags
 & 
BIND_PIRQ__WILL_SHARE
))

352 iàĞ
rc
 != 0 )

354 
d
->
pœq_to_evtchn
[
pœq
] = 0;

355 
out
;

358 
chn
->
¡©e
 = 
ECS_PIRQ
;

359 
chn
->
u
.
pœq
.
œq
 =…irq;

360 
	`lšk_pœq_pÜt
(
pÜt
, 
chn
, 
v
);

362 
bšd
->
pÜt
 =…ort;

364 
out
:

365 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

367  
rc
;

368 
	}
}

371 
	$__evtchn_şo£
(
domaš
 *
d1
, 
pÜt1
)

373 
domaš
 *
d2
 = 
NULL
;

374 
vıu
 *
v
;

375 
evtchn
 *
chn1
, *
chn2
;

376 
pÜt2
;

377 
rc
 = 0;

379 
agaš
:

380 
	`¥š_lock
(&
d1
->
ev’t_lock
);

382 iàĞ!
	`pÜt_is_v®id
(
d1
, 
pÜt1
) )

384 
rc
 = -
EINVAL
;

385 
out
;

388 
chn1
 = 
	`evtchn_äom_pÜt
(
d1
, 
pÜt1
);

391 iàĞ
	`uÆik–y
(
chn1
->
cÚsum”_is_x’
) )

393 
rc
 = -
EINVAL
;

394 
out
;

397  
chn1
->
¡©e
 )

399 
ECS_FREE
:

400 
ECS_RESERVED
:

401 
rc
 = -
EINVAL
;

402 
out
;

404 
ECS_UNBOUND
:

407 
ECS_PIRQ
:

408 iàĞ!
	`is_hvm_domaš
(
d1
) )

409 
	`pœq_gue¡_unbšd
(
d1
, 
chn1
->
u
.
pœq
.
œq
);

410 
d1
->
pœq_to_evtchn
[
chn1
->
u
.
pœq
.
œq
] = 0;

411 
	`uÆšk_pœq_pÜt
(
chn1
, 
d1
->
vıu
[chn1->
nÙify_vıu_id
]);

414 
ECS_VIRQ
:

415 
	`fÜ_—ch_vıu
 ( 
d1
, 
v
 )

417 iàĞ
v
->
vœq_to_evtchn
[
chn1
->
u
.
vœq
] !ğ
pÜt1
 )

419 
v
->
vœq_to_evtchn
[
chn1
->
u
.
vœq
] = 0;

420 
	`¥š_b¬r›r_œq
(&
v
->
vœq_lock
);

424 
ECS_IPI
:

427 
ECS_INTERDOMAIN
:

428 iàĞ
d2
 =ğ
NULL
 )

430 
d2
 = 
chn1
->
u
.
š‹rdomaš
.
»mÙe_dom
;

433 iàĞ
	`uÆik–y
(!
	`g‘_domaš
(
d2
)) )

434 
	`BUG
();

436 iàĞ
d1
 < 
d2
 )

438 
	`¥š_lock
(&
d2
->
ev’t_lock
);

440 iàĞ
d1
 !ğ
d2
 )

442 
	`¥š_uÆock
(&
d1
->
ev’t_lock
);

443 
	`¥š_lock
(&
d2
->
ev’t_lock
);

444 
agaš
;

447 iàĞ
d2
 !ğ
chn1
->
u
.
š‹rdomaš
.
»mÙe_dom
 )

456 
rc
 = -
EINVAL
;

457 
out
;

460 
pÜt2
 = 
chn1
->
u
.
š‹rdomaš
.
»mÙe_pÜt
;

461 
	`BUG_ON
(!
	`pÜt_is_v®id
(
d2
, 
pÜt2
));

463 
chn2
 = 
	`evtchn_äom_pÜt
(
d2
, 
pÜt2
);

464 
	`BUG_ON
(
chn2
->
¡©e
 !ğ
ECS_INTERDOMAIN
);

465 
	`BUG_ON
(
chn2
->
u
.
š‹rdomaš
.
»mÙe_dom
 !ğ
d1
);

467 
chn2
->
¡©e
 = 
ECS_UNBOUND
;

468 
chn2
->
u
.
unbound
.
»mÙe_domid
 = 
d1
->
domaš_id
;

472 
	`BUG
();

476 
	`ş—r_b™
(
pÜt1
, &
	`sh¬ed_šfo
(
d1
, 
evtchn_³ndšg
));

479 
chn1
->
¡©e
 = 
ECS_FREE
;

480 
chn1
->
nÙify_vıu_id
 = 0;

482 
	`xsm_evtchn_şo£_po¡
(
chn1
);

484 
out
:

485 iàĞ
d2
 !ğ
NULL
 )

487 iàĞ
d1
 !ğ
d2
 )

488 
	`¥š_uÆock
(&
d2
->
ev’t_lock
);

489 
	`put_domaš
(
d2
);

492 
	`¥š_uÆock
(&
d1
->
ev’t_lock
);

494  
rc
;

495 
	}
}

498 
	$evtchn_şo£
(
evtchn_şo£_t
 *
şo£
)

500  
	`__evtchn_şo£
(
cu¼’t
->
domaš
, 
şo£
->
pÜt
);

501 
	}
}

503 
	$evtchn_£nd
(
domaš
 *
d
, 
ÍÜt
)

505 
evtchn
 *
lchn
, *
rchn
;

506 
domaš
 *
ld
 = 
d
, *
rd
;

507 
vıu
 *
rvıu
;

508 
½Üt
, 
»t
 = 0;

510 
	`¥š_lock
(&
ld
->
ev’t_lock
);

512 iàĞ
	`uÆik–y
(!
	`pÜt_is_v®id
(
ld
, 
ÍÜt
)) )

514 
	`¥š_uÆock
(&
ld
->
ev’t_lock
);

515  -
EINVAL
;

518 
lchn
 = 
	`evtchn_äom_pÜt
(
ld
, 
ÍÜt
);

521 iàĞ
	`uÆik–y
(
lchn
->
cÚsum”_is_x’
) )

523 
	`¥š_uÆock
(&
ld
->
ev’t_lock
);

524  -
EINVAL
;

527 
»t
 = 
	`xsm_evtchn_£nd
(
ld
, 
lchn
);

528 iàĞ
»t
 )

529 
out
;

531  
lchn
->
¡©e
 )

533 
ECS_INTERDOMAIN
:

534 
rd
 = 
lchn
->
u
.
š‹rdomaš
.
»mÙe_dom
;

535 
½Üt
 = 
lchn
->
u
.
š‹rdomaš
.
»mÙe_pÜt
;

536 
rchn
 = 
	`evtchn_äom_pÜt
(
rd
, 
½Üt
);

537 
rvıu
 = 
rd
->
vıu
[
rchn
->
nÙify_vıu_id
];

538 iàĞ
rchn
->
cÚsum”_is_x’
 )

541 iàĞ
	`‹¡_ªd_ş—r_b™
(
_VPF_blocked_š_x’
,

542 &
rvıu
->
·u£_æags
) )

543 
	`vıu_wake
(
rvıu
);

547 
	`evtchn_£t_³ndšg
(
rvıu
, 
½Üt
);

550 
ECS_IPI
:

551 
	`evtchn_£t_³ndšg
(
ld
->
vıu
[
lchn
->
nÙify_vıu_id
], 
ÍÜt
);

553 
ECS_UNBOUND
:

557 
»t
 = -
EINVAL
;

560 
out
:

561 
	`¥š_uÆock
(&
ld
->
ev’t_lock
);

563  
»t
;

564 
	}
}

566 
	$evtchn_£t_³ndšg
(
vıu
 *
v
, 
pÜt
)

568 
domaš
 *
d
 = 
v
->domain;

569 
vıuid
;

578 iàĞ
	`‹¡_ªd_£t_b™
(
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_³ndšg
)) )

581 iàĞ!
	`‹¡_b™
 (
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_mask
)) &&

582 !
	`‹¡_ªd_£t_b™
(
pÜt
 / 
	`BITS_PER_EVTCHN_WORD
(
d
),

583 &
	`vıu_šfo
(
v
, 
evtchn_³ndšg_£l
)) )

585 
	`vıu_m¬k_ev’ts_³ndšg
(
v
);

589 iàĞ
	`lik–y
(
	`b™m­_em±y
(
d
->
pŞl_mask
, d->
max_vıus
)) )

593  
vıuid
 = 
	`fšd_fœ¡_b™
(
d
->
pŞl_mask
, d->
max_vıus
);

594 
vıuid
 < 
d
->
max_vıus
;

595 
vıuid
 = 
	`fšd_Ãxt_b™
(
d
->
pŞl_mask
, d->
max_vıus
, vcpuid+1) )

597 
v
 = 
d
->
vıu
[
vıuid
];

598 iàĞ((
v
->
pŞl_evtchn
 <ğ0è|| (v->pŞl_evtchÀ=ğ
pÜt
)) &&

599 
	`‹¡_ªd_ş—r_b™
(
vıuid
, 
d
->
pŞl_mask
) )

601 
v
->
pŞl_evtchn
 = 0;

602 
	`vıu_unblock
(
v
);

607 
	}
}

609 
	$gue¡_’abËd_ev’t
(
vıu
 *
v
, 
vœq
)

611  ((
v
 !ğ
NULL
è&& (v->
vœq_to_evtchn
[
vœq
] != 0));

612 
	}
}

614 
	$£nd_gue¡_vıu_vœq
(
vıu
 *
v
, 
vœq
)

616 
æags
;

617 
pÜt
;

619 
	`ASSERT
(!
	`vœq_is_glob®
(
vœq
));

621 
	`¥š_lock_œq§ve
(&
v
->
vœq_lock
, 
æags
);

623 
pÜt
 = 
v
->
vœq_to_evtchn
[
vœq
];

624 iàĞ
	`uÆik–y
(
pÜt
 == 0) )

625 
out
;

627 
	`evtchn_£t_³ndšg
(
v
, 
pÜt
);

629 
out
:

630 
	`¥š_uÆock_œq»¡Üe
(&
v
->
vœq_lock
, 
æags
);

631 
	}
}

633 
	$£nd_gue¡_glob®_vœq
(
domaš
 *
d
, 
vœq
)

635 
æags
;

636 
pÜt
;

637 
vıu
 *
v
;

638 
evtchn
 *
chn
;

640 
	`ASSERT
(
	`vœq_is_glob®
(
vœq
));

642 iàĞ
	`uÆik–y
(
d
 =ğ
NULL
è|| uÆik–y(d->
vıu
 == NULL) )

645 
v
 = 
d
->
vıu
[0];

646 iàĞ
	`uÆik–y
(
v
 =ğ
NULL
) )

649 
	`¥š_lock_œq§ve
(&
v
->
vœq_lock
, 
æags
);

651 
pÜt
 = 
v
->
vœq_to_evtchn
[
vœq
];

652 iàĞ
	`uÆik–y
(
pÜt
 == 0) )

653 
out
;

655 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

656 
	`evtchn_£t_³ndšg
(
d
->
vıu
[
chn
->
nÙify_vıu_id
], 
pÜt
);

658 
out
:

659 
	`¥š_uÆock_œq»¡Üe
(&
v
->
vœq_lock
, 
æags
);

660 
	}
}

662 
	$£nd_gue¡_pœq
(
domaš
 *
d
, 
pœq
)

664 
pÜt
 = 
d
->
pœq_to_evtchn
[
pœq
];

665 
evtchn
 *
chn
;

673 iàĞ
pÜt
 == 0 )

675 
	`BUG_ON
(!
	`is_hvm_domaš
(
d
));

679 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

680  
	`evtchn_£t_³ndšg
(
d
->
vıu
[
chn
->
nÙify_vıu_id
], 
pÜt
);

681 
	}
}

684 
	$evtchn_¡©us
(
evtchn_¡©us_t
 *
¡©us
)

686 
domaš
 *
d
;

687 
domid_t
 
dom
 = 
¡©us
->dom;

688 
pÜt
 = 
¡©us
->port;

689 
evtchn
 *
chn
;

690 
rc
 = 0;

692 
rc
 = 
	`rcu_lock_rg‘_domaš_by_id
(
dom
, &
d
);

693 iàĞ
rc
 )

694  
rc
;

696 
	`¥š_lock
(&
d
->
ev’t_lock
);

698 iàĞ!
	`pÜt_is_v®id
(
d
, 
pÜt
) )

700 
rc
 = -
EINVAL
;

701 
out
;

704 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

706 
rc
 = 
	`xsm_evtchn_¡©us
(
d
, 
chn
);

707 iàĞ
rc
 )

708 
out
;

710  
chn
->
¡©e
 )

712 
ECS_FREE
:

713 
ECS_RESERVED
:

714 
¡©us
->¡©u ğ
EVTCHNSTAT_şo£d
;

716 
ECS_UNBOUND
:

717 
¡©us
->¡©u ğ
EVTCHNSTAT_unbound
;

718 
¡©us
->
u
.
unbound
.
dom
 = 
chn
->u.unbound.
»mÙe_domid
;

720 
ECS_INTERDOMAIN
:

721 
¡©us
->¡©u ğ
EVTCHNSTAT_š‹rdomaš
;

722 
¡©us
->
u
.
š‹rdomaš
.
dom
 =

723 
chn
->
u
.
š‹rdomaš
.
»mÙe_dom
->
domaš_id
;

724 
¡©us
->
u
.
š‹rdomaš
.
pÜt
 = 
chn
->u.š‹rdomaš.
»mÙe_pÜt
;

726 
ECS_PIRQ
:

727 
¡©us
->¡©u ğ
EVTCHNSTAT_pœq
;

728 
¡©us
->
u
.
pœq
 = 
chn
->u.pœq.
œq
;

730 
ECS_VIRQ
:

731 
¡©us
->¡©u ğ
EVTCHNSTAT_vœq
;

732 
¡©us
->
u
.
vœq
 = 
chn
->u.virq;

734 
ECS_IPI
:

735 
¡©us
->¡©u ğ
EVTCHNSTAT_i
;

738 
	`BUG
();

741 
¡©us
->
vıu
 = 
chn
->
nÙify_vıu_id
;

743 
out
:

744 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

745 
	`rcu_uÆock_domaš
(
d
);

747  
rc
;

748 
	}
}

751 
	$evtchn_bšd_vıu
(
pÜt
, 
vıu_id
)

753 
domaš
 *
d
 = 
cu¼’t
->domain;

754 
evtchn
 *
chn
;

755 
rc
 = 0;

757 iàĞ(
vıu_id
 >ğ
d
->
max_vıus
è|| (d->
vıu
[vıu_id] =ğ
NULL
) )

758  -
ENOENT
;

760 
	`¥š_lock
(&
d
->
ev’t_lock
);

762 iàĞ!
	`pÜt_is_v®id
(
d
, 
pÜt
) )

764 
rc
 = -
EINVAL
;

765 
out
;

768 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

771 iàĞ
	`uÆik–y
(
chn
->
cÚsum”_is_x’
) )

773 
rc
 = -
EINVAL
;

774 
out
;

777  
chn
->
¡©e
 )

779 
ECS_VIRQ
:

780 iàĞ
	`vœq_is_glob®
(
chn
->
u
.
vœq
) )

781 
chn
->
nÙify_vıu_id
 = 
vıu_id
;

783 
rc
 = -
EINVAL
;

785 
ECS_UNBOUND
:

786 
ECS_INTERDOMAIN
:

787 
chn
->
nÙify_vıu_id
 = 
vıu_id
;

789 
ECS_PIRQ
:

790 iàĞ
chn
->
nÙify_vıu_id
 =ğ
vıu_id
 )

792 
	`uÆšk_pœq_pÜt
(
chn
, 
d
->
vıu
[chn->
nÙify_vıu_id
]);

793 
chn
->
nÙify_vıu_id
 = 
vıu_id
;

794 
	`pœq_£t_affš™y
(
d
, 
chn
->
u
.
pœq
.
œq
,

795 
	`ıumask_of
(
d
->
vıu
[
vıu_id
]->
´oûssÜ
));

796 
	`lšk_pœq_pÜt
(
pÜt
, 
chn
, 
d
->
vıu
[
vıu_id
]);

799 
rc
 = -
EINVAL
;

803 
out
:

804 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

806  
rc
;

807 
	}
}

810 
	$evtchn_unmask
(
pÜt
)

812 
domaš
 *
d
 = 
cu¼’t
->domain;

813 
vıu
 *
v
;

815 
	`¥š_lock
(&
d
->
ev’t_lock
);

817 iàĞ
	`uÆik–y
(!
	`pÜt_is_v®id
(
d
, 
pÜt
)) )

819 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

820  -
EINVAL
;

823 
v
 = 
d
->
vıu
[
	`evtchn_äom_pÜt
(d, 
pÜt
)->
nÙify_vıu_id
];

829 iàĞ
	`‹¡_ªd_ş—r_b™
(
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_mask
)) &&

830 
	`‹¡_b™
 (
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_³ndšg
)) &&

831 !
	`‹¡_ªd_£t_b™
 (
pÜt
 / 
	`BITS_PER_EVTCHN_WORD
(
d
),

832 &
	`vıu_šfo
(
v
, 
evtchn_³ndšg_£l
)) )

834 
	`vıu_m¬k_ev’ts_³ndšg
(
v
);

837 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

840 
	}
}

843 
	$evtchn_»£t
(
evtchn_»£t_t
 *
r
)

845 
domid_t
 
dom
 = 
r
->dom;

846 
domaš
 *
d
;

847 
i
, 
rc
;

849 
rc
 = 
	`rcu_lock_rg‘_domaš_by_id
(
dom
, &
d
);

850 iàĞ
rc
 )

851  
rc
;

853 
rc
 = 
	`xsm_evtchn_»£t
(
cu¼’t
->
domaš
, 
d
);

854 iàĞ
rc
 )

855 
out
;

857  
i
 = 0; 
	`pÜt_is_v®id
(
d
, i); i++ )

858 ()
	`__evtchn_şo£
(
d
, 
i
);

860 
rc
 = 0;

862 
out
:

863 
	`rcu_uÆock_domaš
(
d
);

865  
rc
;

866 
	}
}

869 
do_ev’t_chªÃl_İ
(
cmd
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

871 
rc
;

873  
cmd
 )

875 
EVTCHNOP_®loc_unbound
: {

876 
evtchn_®loc_unbound
 
®loc_unbound
;

877 iàĞ
	`cİy_äom_gue¡
(&
®loc_unbound
, 
¬g
, 1) != 0 )

878  -
EFAULT
;

879 
rc
 = 
	`evtchn_®loc_unbound
(&
®loc_unbound
);

880 iàĞ(
rc
 =ğ0è&& (
	`cİy_to_gue¡
(
¬g
, &
®loc_unbound
, 1) != 0) )

881 
rc
 = -
EFAULT
;

885 
EVTCHNOP_bšd_š‹rdomaš
: {

886 
evtchn_bšd_š‹rdomaš
 
bšd_š‹rdomaš
;

887 iàĞ
	`cİy_äom_gue¡
(&
bšd_š‹rdomaš
, 
¬g
, 1) != 0 )

888  -
EFAULT
;

889 
rc
 = 
	`evtchn_bšd_š‹rdomaš
(&
bšd_š‹rdomaš
);

890 iàĞ(
rc
 =ğ0è&& (
	`cİy_to_gue¡
(
¬g
, &
bšd_š‹rdomaš
, 1) != 0) )

891 
rc
 = -
EFAULT
;

895 
EVTCHNOP_bšd_vœq
: {

896 
evtchn_bšd_vœq
 
bšd_vœq
;

897 iàĞ
	`cİy_äom_gue¡
(&
bšd_vœq
, 
¬g
, 1) != 0 )

898  -
EFAULT
;

899 
rc
 = 
	`evtchn_bšd_vœq
(&
bšd_vœq
);

900 iàĞ(
rc
 =ğ0è&& (
	`cİy_to_gue¡
(
¬g
, &
bšd_vœq
, 1) != 0) )

901 
rc
 = -
EFAULT
;

905 
EVTCHNOP_bšd_i
: {

906 
evtchn_bšd_i
 
bšd_i
;

907 iàĞ
	`cİy_äom_gue¡
(&
bšd_i
, 
¬g
, 1) != 0 )

908  -
EFAULT
;

909 
rc
 = 
	`evtchn_bšd_i
(&
bšd_i
);

910 iàĞ(
rc
 =ğ0è&& (
	`cİy_to_gue¡
(
¬g
, &
bšd_i
, 1) != 0) )

911 
rc
 = -
EFAULT
;

915 
EVTCHNOP_bšd_pœq
: {

916 
evtchn_bšd_pœq
 
bšd_pœq
;

917 iàĞ
	`cİy_äom_gue¡
(&
bšd_pœq
, 
¬g
, 1) != 0 )

918  -
EFAULT
;

919 
rc
 = 
	`evtchn_bšd_pœq
(&
bšd_pœq
);

920 iàĞ(
rc
 =ğ0è&& (
	`cİy_to_gue¡
(
¬g
, &
bšd_pœq
, 1) != 0) )

921 
rc
 = -
EFAULT
;

925 
EVTCHNOP_şo£
: {

926 
evtchn_şo£
 
şo£
;

927 iàĞ
	`cİy_äom_gue¡
(&
şo£
, 
¬g
, 1) != 0 )

928  -
EFAULT
;

929 
rc
 = 
	`evtchn_şo£
(&
şo£
);

933 
EVTCHNOP_£nd
: {

934 
evtchn_£nd
 
£nd
;

935 iàĞ
	`cİy_äom_gue¡
(&
£nd
, 
¬g
, 1) != 0 )

936  -
EFAULT
;

937 
rc
 = 
	`evtchn_£nd
(
cu¼’t
->
domaš
, 
£nd
.
pÜt
);

941 
EVTCHNOP_¡©us
: {

942 
evtchn_¡©us
 
¡©us
;

943 iàĞ
	`cİy_äom_gue¡
(&
¡©us
, 
¬g
, 1) != 0 )

944  -
EFAULT
;

945 
rc
 = 
	`evtchn_¡©us
(&
¡©us
);

946 iàĞ(
rc
 =ğ0è&& (
	`cİy_to_gue¡
(
¬g
, &
¡©us
, 1) != 0) )

947 
rc
 = -
EFAULT
;

951 
EVTCHNOP_bšd_vıu
: {

952 
evtchn_bšd_vıu
 
bšd_vıu
;

953 iàĞ
	`cİy_äom_gue¡
(&
bšd_vıu
, 
¬g
, 1) != 0 )

954  -
EFAULT
;

955 
rc
 = 
	`evtchn_bšd_vıu
(
bšd_vıu
.
pÜt
, bšd_vıu.
vıu
);

959 
EVTCHNOP_unmask
: {

960 
evtchn_unmask
 
unmask
;

961 iàĞ
	`cİy_äom_gue¡
(&
unmask
, 
¬g
, 1) != 0 )

962  -
EFAULT
;

963 
rc
 = 
	`evtchn_unmask
(
unmask
.
pÜt
);

967 
EVTCHNOP_»£t
: {

968 
evtchn_»£t
 
»£t
;

969 iàĞ
	`cİy_äom_gue¡
(&
»£t
, 
¬g
, 1) != 0 )

970  -
EFAULT
;

971 
rc
 = 
	`evtchn_»£t
(&
»£t
);

976 
rc
 = -
ENOSYS
;

980  
rc
;

981 
	}
}

984 
	$®loc_unbound_x’_ev’t_chªÃl
(

985 
vıu
 *
loÿl_vıu
, 
domid_t
 
»mÙe_domid
)

987 
evtchn
 *
chn
;

988 
domaš
 *
d
 = 
loÿl_vıu
->domain;

989 
pÜt
;

991 
	`¥š_lock
(&
d
->
ev’t_lock
);

993 iàĞ(
pÜt
 = 
	`g‘_ä“_pÜt
(
d
)) < 0 )

994 
out
;

995 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

997 
chn
->
¡©e
 = 
ECS_UNBOUND
;

998 
chn
->
cÚsum”_is_x’
 = 1;

999 
chn
->
nÙify_vıu_id
 = 
loÿl_vıu
->
vıu_id
;

1000 
chn
->
u
.
unbound
.
»mÙe_domid
 =„emote_domid;

1002 
out
:

1003 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

1005  
pÜt
;

1006 
	}
}

1009 
	$ä“_x’_ev’t_chªÃl
(

1010 
vıu
 *
loÿl_vıu
, 
pÜt
)

1012 
evtchn
 *
chn
;

1013 
domaš
 *
d
 = 
loÿl_vıu
->domain;

1015 
	`¥š_lock
(&
d
->
ev’t_lock
);

1017 iàĞ
	`uÆik–y
(
d
->
is_dyšg
) )

1019 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

1023 
	`BUG_ON
(!
	`pÜt_is_v®id
(
d
, 
pÜt
));

1024 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

1025 
	`BUG_ON
(!
chn
->
cÚsum”_is_x’
);

1026 
chn
->
cÚsum”_is_x’
 = 0;

1028 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

1030 ()
	`__evtchn_şo£
(
d
, 
pÜt
);

1031 
	}
}

1034 
	$nÙify_vŸ_x’_ev’t_chªÃl
(
domaš
 *
ld
, 
ÍÜt
)

1036 
evtchn
 *
lchn
, *
rchn
;

1037 
domaš
 *
rd
;

1038 
½Üt
;

1040 
	`¥š_lock
(&
ld
->
ev’t_lock
);

1042 iàĞ
	`uÆik–y
(
ld
->
is_dyšg
) )

1044 
	`¥š_uÆock
(&
ld
->
ev’t_lock
);

1048 
	`ASSERT
(
	`pÜt_is_v®id
(
ld
, 
ÍÜt
));

1049 
lchn
 = 
	`evtchn_äom_pÜt
(
ld
, 
ÍÜt
);

1050 
	`ASSERT
(
lchn
->
cÚsum”_is_x’
);

1052 iàĞ
	`lik–y
(
lchn
->
¡©e
 =ğ
ECS_INTERDOMAIN
) )

1054 
rd
 = 
lchn
->
u
.
š‹rdomaš
.
»mÙe_dom
;

1055 
½Üt
 = 
lchn
->
u
.
š‹rdomaš
.
»mÙe_pÜt
;

1056 
rchn
 = 
	`evtchn_äom_pÜt
(
rd
, 
½Üt
);

1057 
	`evtchn_£t_³ndšg
(
rd
->
vıu
[
rchn
->
nÙify_vıu_id
], 
½Üt
);

1060 
	`¥š_uÆock
(&
ld
->
ev’t_lock
);

1061 
	}
}

1064 
	$evtchn_š™
(
domaš
 *
d
)

1066 
	`¥š_lock_š™
(&
d
->
ev’t_lock
);

1067 iàĞ
	`g‘_ä“_pÜt
(
d
) != 0 )

1068  -
EINVAL
;

1069 
	`evtchn_äom_pÜt
(
d
, 0)->
¡©e
 = 
ECS_RESERVED
;

1071 #ià
MAX_VIRT_CPUS
 > 
BITS_PER_LONG


1072 
d
->
pŞl_mask
 = 
	`xm®loc_¬¿y
(, 
	`BITS_TO_LONGS
(
MAX_VIRT_CPUS
));

1073 iàĞ!
d
->
pŞl_mask
 )

1074  -
ENOMEM
;

1075 
	`b™m­_z”o
(
d
->
pŞl_mask
, 
MAX_VIRT_CPUS
);

1079 
	}
}

1082 
	$evtchn_de¡roy
(
domaš
 *
d
)

1084 
i
;

1087 
	`BUG_ON
(!
d
->
is_dyšg
);

1088 
	`¥š_b¬r›r
(&
d
->
ev’t_lock
);

1091  
i
 = 0; 
	`pÜt_is_v®id
(
d
, i); i++ )

1093 
	`evtchn_äom_pÜt
(
d
, 
i
)->
cÚsum”_is_x’
 = 0;

1094 ()
	`__evtchn_şo£
(
d
, 
i
);

1098 
	`¥š_lock
(&
d
->
ev’t_lock
);

1099  
i
 = 0; i < 
NR_EVTCHN_BUCKETS
; i++ )

1101 
	`xsm_ä“_£cur™y_evtchn
(
d
->
evtchn
[
i
]);

1102 
	`xä“
(
d
->
evtchn
[
i
]);

1103 
d
->
evtchn
[
i
] = 
NULL
;

1105 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

1106 
	}
}

1109 
	$evtchn_de¡roy_fš®
(
domaš
 *
d
)

1111 #ià
MAX_VIRT_CPUS
 > 
BITS_PER_LONG


1112 
	`xä“
(
d
->
pŞl_mask
);

1113 
d
->
pŞl_mask
 = 
NULL
;

1115 
	}
}

1118 
	$evtchn_move_pœqs
(
vıu
 *
v
)

1120 
domaš
 *
d
 = 
v
->domain;

1121 cÚ¡ 
ıumask_t
 *
mask
 = 
	`ıumask_of
(
v
->
´oûssÜ
);

1122 
pÜt
;

1123 
evtchn
 *
chn
;

1125 
	`¥š_lock
(&
d
->
ev’t_lock
);

1126  
pÜt
 = 
v
->
pœq_evtchn_h—d
;…Üt;…Üˆğ
chn
->
u
.
pœq
.
Ãxt_pÜt
 )

1128 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

1129 
	`pœq_£t_affš™y
(
d
, 
chn
->
u
.
pœq
.
œq
, 
mask
);

1131 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

1132 
	}
}

1135 
	$domaš_dump_evtchn_šfo
(
domaš
 *
d
)

1137 
pÜt
;

1139 
	`b™m­_súli¡´štf
(
keyhªdËr_sü©ch
, (keyhandler_scratch),

1140 
d
->
pŞl_mask
, d->
max_vıus
);

1141 
	`´štk
("Event channel information for domain %d:\n"

1143 "…Üˆ[p/m]\n", 
d
->
domaš_id
, 
keyhªdËr_sü©ch
);

1145 
	`¥š_lock
(&
d
->
ev’t_lock
);

1147  
pÜt
 = 1;…Üˆ< 
	`MAX_EVTCHNS
(
d
); ++port )

1149 cÚ¡ 
evtchn
 *
chn
;

1151 iàĞ!
	`pÜt_is_v®id
(
d
, 
pÜt
) )

1153 
chn
 = 
	`evtchn_äom_pÜt
(
d
, 
pÜt
);

1154 iàĞ
chn
->
¡©e
 =ğ
ECS_FREE
 )

1157 
	`´štk
(" %4u [%d/%d]: s=%d‚=%d",

1158 
pÜt
,

1159 !!
	`‹¡_b™
(
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_³ndšg
)),

1160 !!
	`‹¡_b™
(
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_mask
)),

1161 
chn
->
¡©e
, chn->
nÙify_vıu_id
);

1162  
chn
->
¡©e
 )

1164 
ECS_UNBOUND
:

1165 
	`´štk
(" d=%d", 
chn
->
u
.
unbound
.
»mÙe_domid
);

1167 
ECS_INTERDOMAIN
:

1168 
	`´štk
(" d=%d…=%d",

1169 
chn
->
u
.
š‹rdomaš
.
»mÙe_dom
->
domaš_id
,

1170 
chn
->
u
.
š‹rdomaš
.
»mÙe_pÜt
);

1172 
ECS_PIRQ
:

1173 
	`´štk
("…=%d", 
chn
->
u
.
pœq
.
œq
);

1175 
ECS_VIRQ
:

1176 
	`´štk
(" v=%d", 
chn
->
u
.
vœq
);

1179 
	`´štk
(" x=%d\n", 
chn
->
cÚsum”_is_x’
);

1182 
	`¥š_uÆock
(&
d
->
ev’t_lock
);

1183 
	}
}

1185 
	$dump_evtchn_šfo
(
key
)

1187 
domaš
 *
d
;

1189 
	`´štk
("'%c'…»s£d -> dumpšgƒv’t-chªÃÈšfo\n", 
key
);

1191 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

1193 
	`fÜ_—ch_domaš
 ( 
d
 )

1194 
	`domaš_dump_evtchn_šfo
(
d
);

1196 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

1197 
	}
}

1199 
keyhªdËr
 
	gdump_evtchn_šfo_keyhªdËr
 = {

1200 .
dŸgno¡ic
 = 1,

1201 .
	gu
.
	gâ
 = 
dump_evtchn_šfo
,

1202 .
	gdesc
 = "dumpƒvtchn info"

1205 
__š™
 
	$dump_evtchn_šfo_key_š™
()

1207 
	`»gi¡”_keyhªdËr
('e', &
dump_evtchn_šfo_keyhªdËr
);

1209 
	}
}

1210 
__š™ÿÎ
(
dump_evtchn_šfo_key_š™
);

	@gdbstub.c

37 
	~<x’/lib.h
>

38 
	~<x’/¥šlock.h
>

39 
	~<x’/£rŸl.h
>

40 
	~<x’/œq.h
>

41 
	~<asm/debugg”.h
>

42 
	~<x’/š™.h
>

43 
	~<x’/smp.h
>

44 
	~<x’/cÚsŞe.h
>

45 
	~<x’/”ºo.h
>

46 
	~<x’/d–ay.h
>

47 
	~<x’/š™.h
>

48 
	~<asm/by‹Üd”.h
>

52 
	#dbg_´štk
(...)

	)

55 
	#GDB_RETRY_MAX
 10

	)

57 
	sgdb_ıu_šfo


59 
©omic_t
 
	m·u£d
;

60 
©omic_t
 
	mack
;

63 
gdb_ıu_šfo
 
	ggdb_ıu
[
NR_CPUS
];

64 
©omic_t
 
	ggdb_smp_·u£d_couÁ
;

66 
gdb_smp_·u£
();

67 
gdb_smp_»sume
();

69 
__š™d©a
 
	gİt_gdb
[30];

70 
¡ršg_·¿m
("gdb", 
İt_gdb
);

72 
gdb¡ub_cÚsŞe_puts
(cÚ¡ *
¡r
);

76 
	$hex2ch¬
(
x
)

78 cÚ¡ 
¬¿y
[] = "0123456789abcdef";

79  
¬¿y
[
x
 & 15];

80 
	}
}

83 
	$ch¬2hex
(
c
)

85 iàĞ(
c
 >= '0') && (c <= '9') )

86  
c
 - '0';

87 iàĞ(
c
 >= 'a') && (c <= 'f') )

88  
c
 - 'a' + 10;

89 iàĞ(
c
 >= 'A') && (c <= 'F') )

90  
c
 - 'A' + 10;

92 
	`BUG
();

94 
	}
}

97 
	$¡r2hex
(cÚ¡ *
¡r
)

99  (
	`ch¬2hex
(
¡r
[0]) << 4) | char2hex(str[1]);

100 
	}
}

103 
	$¡r2ulÚg
(cÚ¡ *
¡r
, 
by‹s
)

105 
x
 = 0;

106 
i
 = 0;

108  *
¡r
 && (
i
 < (
by‹s
 * 2)) )

110 
x
 <<= 4;

111 
x
 +ğ
	`ch¬2hex
(*
¡r
);

112 ++
¡r
;

113 ++
i
;

116  
x
;

117 
	}
}

120 
	$¡r_to_Çtive_ulÚg
(cÚ¡ *
¡r
)

122 
x
 = 0, 
i
 = 0;

124  *
¡r
 && (
i
 < 
BYTES_PER_LONG
) )

126 #ifdeà
__BIG_ENDIAN


127 
x
 <<= 8;

128 
x
 +ğ
	`¡r2hex
(
¡r
);

129 #–ià
	`defšed
(
__LITTLE_ENDIAN
)

130 
x
 +ğ()
	`¡r2hex
(
¡r
è<< (
i
*8);

132 #”rÜ 
unknown
 
’dŸn


134 
¡r
 += 2;

135 
i
++;

138  
x
;

139 
	}
}

143 
	$gdb_io_wr™e
(cÚ¡ *
buf
, 
Ën
, 
gdb_cÚ‹xt
 *
ùx
)

145 
i
;

146  
i
 = 0; i < 
Ën
; i++ )

147 
	`£rŸl_putc
(
ùx
->
£rhnd
, 
buf
[
i
]);

148  
i
;

149 
	}
}

152 
	$gdb_io_wr™e_ch¬
(
u8
 
d©a
, 
gdb_cÚ‹xt
 *
ùx
)

154  
	`gdb_io_wr™e
((*)&
d©a
, 1, 
ùx
);

155 
	}
}

158 
	$gdb_io_»ad
(
gdb_cÚ‹xt
 *
ùx
)

160  
	`£rŸl_g‘c
(
ùx
->
£rhnd
);

161 
	}
}

166 
	$©‹m±_»ûive_·ck‘
(
gdb_cÚ‹xt
 *
ùx
)

168 
u8
 
csum
;

169 
u8
 
»ûived_csum
;

170 
u8
 
ch
;

173  (
ch
 = 
	`gdb_io_»ad
(
ùx
)) != '$' )

176 
csum
 = 0;

177  
ùx
->
š_by‹s
 = 0;

178 
ùx
->
š_by‹s
 < (ùx->
š_buf
);

179 
ùx
->
š_by‹s
++ )

181 
ch
 = 
	`gdb_io_»ad
(
ùx
);

182 iàĞ
ch
 == '#' )

184 
ùx
->
š_buf
[ùx->
š_by‹s
] = 
ch
;

185 
csum
 +ğ
ch
;

188 iàĞ
ùx
->
š_by‹s
 =ğ(ùx->
š_buf
) )

190 
	`dbg_´štk
("WARNING: GDB sent‡ stupidly big…acket.\n");

194 
ùx
->
š_buf
[ùx->
š_by‹s
] = '\0';

195 
»ûived_csum
 = 
	`ch¬2hex
(
	`gdb_io_»ad
(
ùx
)) * 16 +

196 
	`ch¬2hex
(
	`gdb_io_»ad
(
ùx
));

198  (
»ûived_csum
 =ğ
csum
) ? 0 : -1;

199 
	}
}

204 
	$»ûive_commªd
(
gdb_cÚ‹xt
 *
ùx
)

206 
r
, 
couÁ
 = 0;

208 
couÁ
 = 0;

210 
r
 = 
	`©‹m±_»ûive_·ck‘
(
ùx
);

211 
	`gdb_io_wr™e_ch¬
((
r
 < 0è? '-' : '+', 
ùx
);

212 
couÁ
++;

213 }  (
r
 < 0è&& (
couÁ
 < 
GDB_RETRY_MAX
) );

215  
r
;

216 
	}
}

221 
	$gdb_¡¬t_·ck‘
(
gdb_cÚ‹xt
 *
ùx
)

223 
ùx
->
out_buf
[0] = '$';

224 
ùx
->
out_off£t
 = 1;

225 
ùx
->
out_csum
 = 0;

226 
	}
}

229 
	$gdb_wr™e_to_·ck‘_ch¬
(
u8
 
d©a
, 
gdb_cÚ‹xt
 *
ùx
)

231 
ùx
->
out_csum
 +ğ
d©a
;

232 
ùx
->
out_buf
[ùx->
out_off£t
] = 
d©a
;

233 
ùx
->
out_off£t
++;

234 
	}
}

237 
	$gdb_wr™e_to_·ck‘
(cÚ¡ *
buf
, 
couÁ
, 
gdb_cÚ‹xt
 *
ùx
)

239 
x
;

240  
x
 = 0; x < 
couÁ
; x++ )

241 
	`gdb_wr™e_to_·ck‘_ch¬
(
buf
[
x
], 
ùx
);

242 
	}
}

245 
	$gdb_wr™e_to_·ck‘_¡r
(cÚ¡ *
buf
, 
gdb_cÚ‹xt
 *
ùx
)

247 
	`gdb_wr™e_to_·ck‘
(
buf
, 
	`¡¾’
(buf), 
ùx
);

248 
	}
}

251 
	$gdb_wr™e_to_·ck‘_hex
(
x
, 
št_size
, 
gdb_cÚ‹xt
 *
ùx
)

253 
buf
[() * 2 + 1];

254 
i
, 
width
 = 
št_size
 * 2;

256 
buf
[() * 2] = 0;

258  
št_size
 )

260 (
u8
):

261 (
u16
):

262 (
u32
):

263 (
u64
):

266 
	`dbg_´štk
("WARNING: %s x: 0x%lx int_size: %d\n",

267 
__func__
, 
x
, 
št_size
);

271 #ifdeà
__BIG_ENDIAN


272 
i
 = () * 2

274 
buf
[--
i
] = 
	`hex2ch¬
(
x
 & 15);

275 
x
 >>= 4;

276 }  
x
 );

278  (
i
 + 
width
) > (() * 2) )

279 
buf
[--
i
] = '0';

281 
	`gdb_wr™e_to_·ck‘
(&
buf
[
i
], 
width
, 
ùx
);

282 #–ià
	`defšed
(
__LITTLE_ENDIAN
)

283 
i
 = 0;

284  
i
 < 
width
 )

286 
buf
[
i
++] = 
	`hex2ch¬
(
x
>>4);

287 
buf
[
i
++] = 
	`hex2ch¬
(
x
);

288 
x
 >>= 8;

290 
	`gdb_wr™e_to_·ck‘
(
buf
, 
width
, 
ùx
);

292 #”rÜ 
unknown
 
’dŸn


294 
	}
}

297 
	$gdb_check_ack
(
gdb_cÚ‹xt
 *
ùx
)

299 
u8
 
c
 = 
	`gdb_io_»ad
(
ùx
);

301  
c
 )

308 
	`´štk
("Bad‡ck: %c\n", 
c
);

311 
	}
}

315 
	$gdb_£nd_·ck‘
(
gdb_cÚ‹xt
 *
ùx
)

317 
buf
[3];

318 
couÁ
;

320 
	`¢´štf
(
buf
, (buf), "%.02x\n", 
ùx
->
out_csum
);

322 
	`gdb_wr™e_to_·ck‘_ch¬
('#', 
ùx
);

323 
	`gdb_wr™e_to_·ck‘
(
buf
, 2, 
ùx
);

325 
couÁ
 = 0;

327 
	`gdb_io_wr™e
(
ùx
->
out_buf
, ctx->
out_off£t
, ctx);

328 }  !
	`gdb_check_ack
(
ùx
è&& (
couÁ
++ < 
GDB_RETRY_MAX
) );

330 iàĞ
couÁ
 =ğ
GDB_RETRY_MAX
 )

331 
	`dbg_´štk
("WARNING: %s„eached max„etry %d\n",

332 
__func__
, 
GDB_RETRY_MAX
);

333 
	}
}

336 
	$gdb_£nd_»¶y
(cÚ¡ *
buf
, 
gdb_cÚ‹xt
 *
ùx
)

338 
	`gdb_¡¬t_·ck‘
(
ùx
);

339 
	`gdb_wr™e_to_·ck‘_¡r
(
buf
, 
ùx
);

340 
	`gdb_£nd_·ck‘
(
ùx
);

341 
	}
}

346 
	$gdb_cmd_signum
(
gdb_cÚ‹xt
 *
ùx
)

348 
	`gdb_wr™e_to_·ck‘_ch¬
('S', 
ùx
);

349 
	`gdb_wr™e_to_·ck‘_hex
(
ùx
->
signum
, (ctx->signum), ctx);

350 
	`gdb_£nd_·ck‘
(
ùx
);

351 
	}
}

354 
	$gdb_cmd_»ad_mem
(
addr
, 
Ëngth
,

355 
gdb_cÚ‹xt
 *
ùx
)

357 
x
, 
r
;

358 
v®
;

360 
	`dbg_´štk
("MemÜy„—d s¹šg‡ˆ%lx,†’gth %lx.\n", 
addr
,

361 
Ëngth
);

363  
x
 = 0; x < 
Ëngth
; x++ )

365 
r
 = 
	`gdb_¬ch_cİy_äom_u£r
(&
v®
, (*)(
addr
 + 
x
), 1);

366 iàĞ
r
 != 0 )

368 
	`dbg_´štk
("E¼Ü„—dšg from %lx.\n", 
addr
 + 
x
);

371 
	`gdb_wr™e_to_·ck‘_hex
(
v®
, (v®), 
ùx
);

374 iàĞ
x
 == 0 )

375 
	`gdb_wr™e_to_·ck‘_¡r
("E05", 
ùx
);

377 
	`dbg_´štk
("Read done.\n");

379 
	`gdb_£nd_·ck‘
(
ùx
);

380 
	}
}

383 
	$gdb_cmd_wr™e_mem
(
addr
, 
Ëngth
,

384 cÚ¡ *
buf
, 
gdb_cÚ‹xt
 *
ùx
)

386 
x
, 
r
;

387 
v®
;

389 
	`dbg_´štk
("MemÜy wr™¡¬tšg‡ˆ%lx,†’gth %lx.\n", 
addr
, 
Ëngth
);

391  
x
 = 0; x < 
Ëngth
; x++, 
addr
++, 
buf
 += 2 )

393 
v®
 = 
	`¡r2ulÚg
(
buf
, (val));

394 
r
 = 
	`gdb_¬ch_cİy_to_u£r
((*)
addr
, (*)&
v®
, 1);

395 iàĞ
r
 != 0 )

397 
	`dbg_´štk
("E¼Ü wr™šgØ%lx.\n", 
addr
);

402 ià(
x
 =ğ
Ëngth
)

403 
	`gdb_wr™e_to_·ck‘_¡r
("OK", 
ùx
);

405 
	`gdb_wr™e_to_·ck‘_¡r
("E11", 
ùx
);

407 
	`dbg_´štk
("Write done.\n");

409 
	`gdb_£nd_·ck‘
(
ùx
);

410 
	}
}

413 
	$gdb¡ub_©ch
(
gdb_cÚ‹xt
 *
ùx
)

415 iàĞ
ùx
->
cu¼’y_©ched
 )

417 
ùx
->
cu¼’y_©ched
 = 1;

418 
ùx
->
cÚsŞe_¡—l_id
 = 
	`cÚsŞe_¡—l
(ùx->
£rhnd
, 
gdb¡ub_cÚsŞe_puts
);

419 
	}
}

422 
	$gdb¡ub_d‘ach
(
gdb_cÚ‹xt
 *
ùx
)

424 iàĞ!
ùx
->
cu¼’y_©ched
 )

426 
ùx
->
cu¼’y_©ched
 = 0;

427 
	`cÚsŞe_giveback
(
ùx
->
cÚsŞe_¡—l_id
);

428 
	}
}

432 
	$´oûss_commªd
(
ıu_u£r_»gs
 *
»gs
, 
gdb_cÚ‹xt
 *
ùx
)

434 cÚ¡ *
±r
;

435 
addr
, 
Ëngth
, 
v®
;

436 
»sume
 = 0;

437 
ty³
 = 
GDB_CONTINUE
;

441 
	`gdb_¡¬t_·ck‘
(
ùx
);

442  
ùx
->
š_buf
[0] )

445 
	`gdb_cmd_signum
(
ùx
);

448 
	`gdb_£nd_»¶y
("OK", 
ùx
);

451 
	`gdb_¬ch_»ad_»g_¬¿y
(
»gs
, 
ùx
);

454 
	`gdb_¬ch_wr™e_»g_¬¿y
(
»gs
, 
ùx
->
š_buf
 + 1, ctx);

457 
addr
 = 
	`sim¶e_¡¹oul
(
ùx
->
š_buf
 + 1, &
±r
, 16);

458 iàĞ(
±r
 =ğ(
ùx
->
š_buf
 + 1)) || (ptr[0] != ',') )

460 
	`gdb_£nd_»¶y
("E03", 
ùx
);

463 
Ëngth
 = 
	`sim¶e_¡¹oul
(
±r
 + 1, &ptr, 16);

464 iàĞ
±r
[0] != 0 )

466 
	`gdb_£nd_»¶y
("E04", 
ùx
);

469 
	`gdb_cmd_»ad_mem
(
addr
, 
Ëngth
, 
ùx
);

472 
addr
 = 
	`sim¶e_¡¹oul
(
ùx
->
š_buf
 + 1, &
±r
, 16);

473 iàĞ(
±r
 =ğ(
ùx
->
š_buf
 + 1)) || (ptr[0] != ',') )

475 
	`gdb_£nd_»¶y
("E03", 
ùx
);

478 
Ëngth
 = 
	`sim¶e_¡¹oul
(
±r
 + 1, &ptr, 16);

479 iàĞ
±r
[0] != ':')

481 
	`gdb_£nd_»¶y
("E04", 
ùx
);

484 
	`gdb_cmd_wr™e_mem
(
addr
, 
Ëngth
, 
±r
 + 1, 
ùx
);

487 
addr
 = 
	`sim¶e_¡¹oul
(
ùx
->
š_buf
 + 1, &
±r
, 16);

488 iàĞ
±r
 =ğ(
ùx
->
š_buf
 + 1) )

490 
	`gdb_£nd_»¶y
("E03", 
ùx
);

493 iàĞ
±r
[0] != 0 )

495 
	`gdb_£nd_»¶y
("E04", 
ùx
);

498 
	`gdb_¬ch_»ad_»g
(
addr
, 
»gs
, 
ùx
);

501 
addr
 = 
	`sim¶e_¡¹oul
(
ùx
->
š_buf
 + 1, &
±r
, 16);

502 iàĞ
±r
 =ğ(
ùx
->
š_buf
 + 1) )

504 
	`gdb_£nd_»¶y
("E03", 
ùx
);

507 iàĞ
±r
[0] != '=' )

509 
	`gdb_£nd_»¶y
("E04", 
ùx
);

512 
±r
++;

513 
v®
 = 
	`¡r_to_Çtive_ulÚg
(
±r
);

514 
	`gdb_¬ch_wr™e_»g
(
addr
, 
v®
, 
»gs
, 
ùx
);

518 
	`gdb¡ub_d‘ach
(
ùx
);

519 
	`gdb_£nd_»¶y
("OK", 
ùx
);

520 
ùx
->
cÚÃùed
 = 0;

521 
»sume
 = 1;

524 
ty³
 = 
GDB_STEP
;

526 
addr
 = ~(()0);

528 iàĞ
ùx
->
š_buf
[1] )

529 
addr
 = 
	`¡r2ulÚg
(&
ùx
->
š_buf
[1], ());

530 
	`gdb¡ub_©ch
(
ùx
);

531 
»sume
 = 1;

532 
	`gdb_¬ch_»sume
(
»gs
, 
addr
, 
ty³
, 
ùx
);

535 
	`gdb_£nd_»¶y
("", 
ùx
);

538  
»sume
;

539 
	}
}

541 
gdb_cÚ‹xt


542 
	g__gdb_ùx
 = {

543 .
£rhnd
 = -1,

544 .
	gruÂšg
 = 
ATOMIC_INIT
(1),

545 .
	gsignum
 = 1

547 
gdb_cÚ‹xt
 *
	ggdb_ùx
 = &
__gdb_ùx
;

550 
	$gdb¡ub_cÚsŞe_puts
(cÚ¡ *
¡r
)

552 cÚ¡ *
p
;

554 
	`gdb_¡¬t_·ck‘
(
gdb_ùx
);

555 
	`gdb_wr™e_to_·ck‘_ch¬
('O', 
gdb_ùx
);

557  
p
 = 
¡r
; *p != '\0';…++ )

559 
	`gdb_wr™e_to_·ck‘_ch¬
(
	`hex2ch¬
((*
p
>>4è& 0x0f), 
gdb_ùx
 );

560 
	`gdb_wr™e_to_·ck‘_ch¬
(
	`hex2ch¬
((*
p
è& 0x0f), 
gdb_ùx
 );

563 
	`gdb_£nd_·ck‘
(
gdb_ùx
);

564 
	}
}

568 
	$__Œ­_to_gdb
(
ıu_u£r_»gs
 *
»gs
, 
cook›
)

570 
rc
 = 0;

571 
æags
;

573 iàĞ
gdb_ùx
->
£rhnd
 < 0 )

575 
	`´štk
("Debugging connection‚ot set up.\n");

576  -
EBUSY
;

591 iàĞ!
	`©omic_dec_ªd_‹¡
(&
gdb_ùx
->
ruÂšg
) )

593 
	`´štk
("WARNING WARNING WARNING: Avoiding„ecursive gdb.\n");

594 
	`©omic_šc
(&
gdb_ùx
->
ruÂšg
);

595  -
EBUSY
;

598 iàĞ!
gdb_ùx
->
cÚÃùed
 )

600 
	`´štk
("GDB connection‡ctivated.\n");

601 
	`gdb_¬ch_´št_¡©e
(
»gs
);

602 
gdb_ùx
->
cÚÃùed
 = 1;

605 
	`gdb_smp_·u£
();

607 
	`loÿl_œq_§ve
(
æags
);

609 
	`w©chdog_di§bË
();

610 
	`cÚsŞe_¡¬t_sync
();

612 
	`gdb_¬ch_’‹r
(
»gs
);

613 
gdb_ùx
->
signum
 = 
	`gdb_¬ch_sigÇl_num
(
»gs
, 
cook›
);

616 iàĞ
gdb_ùx
->
cu¼’y_©ched
 )

618 
	`gdb_¡¬t_·ck‘
(
gdb_ùx
);

619 
	`gdb_cmd_signum
(
gdb_ùx
);

623 iàĞ
	`»ûive_commªd
(
gdb_ùx
) < 0 )

625 
	`dbg_´štk
("Error in GDB session...\n");

626 
rc
 = -
EIO
;

629 }  
	`´oûss_commªd
(
»gs
, 
gdb_ùx
) == 0 );

631 
	`gdb_smp_»sume
();

633 
	`gdb_¬ch_ex™
(
»gs
);

634 
	`cÚsŞe_’d_sync
();

635 
	`w©chdog_’abË
();

636 
	`©omic_šc
(&
gdb_ùx
->
ruÂšg
);

638 
	`loÿl_œq_»¡Üe
(
æags
);

640  
rc
;

641 
	}
}

643 
__š™
 
	$š™Ÿli£_gdb
()

645 iàĞ*
İt_gdb
 == '\0' )

648 
gdb_ùx
->
£rhnd
 = 
	`£rŸl_·r£_hªdË
(
İt_gdb
);

649 iàĞ
gdb_ùx
->
£rhnd
 == -1 )

651 
	`´štk
("Bad gdbğİtiÚ '%s'\n", 
İt_gdb
);

655 
	`£rŸl_¡¬t_sync
(
gdb_ùx
->
£rhnd
);

657 
	`´štk
("GDB stub initialised.\n");

660 
	}
}

661 
´esmp_š™ÿÎ
(
š™Ÿli£_gdb
);

663 
	$gdb_·u£_this_ıu
(*
unu£d
)

665 
æags
;

667 
	`loÿl_œq_§ve
(
æags
);

669 
	`©omic_£t
(&
gdb_ıu
[
	`smp_´oûssÜ_id
()].
ack
, 1);

670 
	`©omic_šc
(&
gdb_smp_·u£d_couÁ
);

672  
	`©omic_»ad
(&
gdb_ıu
[
	`smp_´oûssÜ_id
()].
·u£d
) )

673 
	`md–ay
(1);

675 
	`©omic_dec
(&
gdb_smp_·u£d_couÁ
);

676 
	`©omic_£t
(&
gdb_ıu
[
	`smp_´oûssÜ_id
()].
ack
, 0);

679 
	`loÿl_œq_»¡Üe
(
æags
);

680 
	}
}

682 
	$gdb_smp_·u£
()

684 
timeout
 = 100;

685 
ıu
;

687 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

689 
	`©omic_£t
(&
gdb_ıu
[
ıu
].
ack
, 0);

690 
	`©omic_£t
(&
gdb_ıu
[
ıu
].
·u£d
, 1);

693 
	`©omic_£t
(&
gdb_smp_·u£d_couÁ
, 0);

695 
	`smp_ÿÎ_funùiÚ
(
gdb_·u£_this_ıu
, 
NULL
, 0);

698  (
	`©omic_»ad
(&
gdb_smp_·u£d_couÁ
è< (
	`num_Úlše_ıus
() - 1))

699 && (
timeout
-- > 0) )

700 
	`md–ay
(1);

702 iàĞ
	`©omic_»ad
(&
gdb_smp_·u£d_couÁ
è< (
	`num_Úlše_ıus
() - 1) )

704 
	`´štk
("GDB: Not‡ll CPUs have…aused, missing CPUs ");

705 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

707 iàĞ(
ıu
 !ğ
	`smp_´oûssÜ_id
()) &&

708 !
	`©omic_»ad
(&
gdb_ıu
[
ıu
].
ack
) )

709 
	`´štk
("%d ", 
ıu
);

711 
	`´štk
("\n");

713 
	}
}

715 
	$gdb_smp_»sume
()

717 
ıu
;

718 
timeout
 = 100;

720 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

721 
	`©omic_£t
(&
gdb_ıu
[
ıu
].
·u£d
, 0);

724  (
	`©omic_»ad
(&
gdb_smp_·u£d_couÁ
) > 0)

725 && (
timeout
-- > 0) )

726 
	`md–ay
(1);

728 iàĞ
	`©omic_»ad
(&
gdb_smp_·u£d_couÁ
) > 0 )

730 
	`´štk
("GDB: Not‡ll CPUs have„esumedƒxecution, missing CPUs ");

731 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

733 iàĞ(
ıu
 !ğ
	`smp_´oûssÜ_id
()) &&

734 
	`©omic_»ad
(&
gdb_ıu
[
ıu
].
ack
) )

735 
	`´štk
("%d ", 
ıu
);

737 
	`´štk
("\n");

739 
	}
}

	@grant_table.c

27 
	~<x’/cÚfig.h
>

28 
	~<x’/ioÿp.h
>

29 
	~<x’/lib.h
>

30 
	~<x’/sched.h
>

31 
	~<x’/mm.h
>

32 
	~<x’/ev’t.h
>

33 
	~<x’/Œaû.h
>

34 
	~<x’/gue¡_acûss.h
>

35 
	~<x’/domaš_·ge.h
>

36 
	~<x’/iommu.h
>

37 
	~<x’/·gšg.h
>

38 
	~<x’/keyhªdËr.h
>

39 
	~<xsm/xsm.h
>

41 #iâdeà
max_Ä_g¿Á_äames


42 
	gmax_Ä_g¿Á_äames
 = 
DEFAULT_MAX_NR_GRANT_FRAMES
;

43 
š‹g”_·¿m
("gÁb_max_Ä_äames", 
max_Ä_g¿Á_äames
);

50 
	#MAX_MAPTRACK_TO_GRANTS_RATIO
 8

	)

56 
	ug¿Á_combo
 {

57 
ušt32_t
 
	mwÜd
;

59 
ušt16_t
 
	mæags
;

60 
domid_t
 
	mdomid
;

61 } 
	mshÜts
;

65 
	sgÁb_unm­_commÚ
 {

67 
ušt64_t
 
	mho¡_addr
;

68 
ušt64_t
 
	mdev_bus_addr
;

69 
ušt64_t
 
	mÃw_addr
;

70 
g¿Á_hªdË_t
 
	mhªdË
;

73 
št16_t
 
	m¡©us
;

76 
u16
 
	mæags
;

77 
	mäame
;

78 
g¿Á_m­pšg
 *
	mm­
;

79 
domaš
 *
	mrd
;

83 
	#GNTTAB_UNMAP_BATCH_SIZE
 32

	)

86 
	#PIN_FAIL
(
_lbl
, 
_rc
, 
_f
, 
_a
...) \

88 
	`gd´štk
(
XENLOG_WARNING
, 
_f
, ## 
_a
 ); \

89 
rc
 = (
_rc
); \

90 
_lbl
; \

91 }  0 )

	)

93 
	#MAPTRACK_PER_PAGE
 (
PAGE_SIZE
 / (
g¿Á_m­pšg
))

	)

94 
	#m­Œack_’Œy
(
t
, 
e
) \

95 ((
t
)->
m­Œack
[(
e
)/
MAPTRACK_PER_PAGE
][Ó)%MAPTRACK_PER_PAGE])

	)

97 
šlše
 

98 
	$Ä_m­Œack_äames
(
g¿Á_bË
 *
t
)

100  
t
->
m­Œack_lim™
 / 
MAPTRACK_PER_PAGE
;

101 
	}
}

103 
šlše
 
	$max_Ä_m­Œack_äames
()

105  (
max_Ä_g¿Á_äames
 * 
MAX_MAPTRACK_TO_GRANTS_RATIO
);

106 
	}
}

108 #ifdeà
CONFIG_X86


109 
	#gâ_to_mâ_´iv©e
(
_d
, 
_gâ
) ({ \

110 
p2m_ty³_t
 
__p2mt
; \

111 
__x
; \

112 
__x
 = 
	`mâ_x
(
	`gâ_to_mâ_unsh¬e
(
	`p2m_g‘_ho¡p2m
(
_d
), 
_gâ
, &
__p2mt
, 1)); \

113 iàĞ!
	`p2m_is_v®id
(
__p2mt
) ) \

114 
__x
 = 
INVALID_MFN
; \

115 
__x
; })

	)

117 
	#gâ_to_mâ_´iv©e
(
_d
, 
_gâ
è
	`gmâ_to_mâ
(_d, _gâ)

	)

120 
	#SHGNT_PER_PAGE_V1
 (
PAGE_SIZE
 / (
g¿Á_’Œy_v1_t
))

	)

121 
	#sh¬ed_’Œy_v1
(
t
, 
e
) \

122 ((
t
)->
sh¬ed_v1
[(
e
)/
SHGNT_PER_PAGE_V1
][Ó)%SHGNT_PER_PAGE_V1])

	)

123 
	#SHGNT_PER_PAGE_V2
 (
PAGE_SIZE
 / (
g¿Á_’Œy_v2_t
))

	)

124 
	#sh¬ed_’Œy_v2
(
t
, 
e
) \

125 ((
t
)->
sh¬ed_v2
[(
e
)/
SHGNT_PER_PAGE_V2
][Ó)%SHGNT_PER_PAGE_V2])

	)

126 
	#STGNT_PER_PAGE
 (
PAGE_SIZE
 / (
g¿Á_¡©us_t
))

	)

127 
	#¡©us_’Œy
(
t
, 
e
) \

128 ((
t
)->
¡©us
[(
e
)/
STGNT_PER_PAGE
][Ó)%STGNT_PER_PAGE])

	)

129 
g¿Á_’Œy_h—d”_t
 *

130 
	$sh¬ed_’Œy_h—d”
(
g¿Á_bË
 *
t
, 
g¿Á_»f_t
 
»f
)

132 
	`ASSERT
(
t
->
gt_v”siÚ
 != 0);

133 ià(
t
->
gt_v”siÚ
 == 1)

134  (
g¿Á_’Œy_h—d”_t
*)&
	`sh¬ed_’Œy_v1
(
t
, 
»f
);

136  &
	`sh¬ed_’Œy_v2
(
t
, 
»f
).
hdr
;

137 
	}
}

138 
	#ACGNT_PER_PAGE
 (
PAGE_SIZE
 / (
aùive_g¿Á_’Œy
))

	)

139 
	#aùive_’Œy
(
t
, 
e
) \

140 ((
t
)->
aùive
[(
e
)/
ACGNT_PER_PAGE
][Ó)%ACGNT_PER_PAGE])

	)

143 
	$__g‘_·ged_äame
(
gâ
, *
äame
, 
»adÚly
, 
domaš
 *
rd
)

145 
rc
 = 
GNTST_okay
;

146 #ià
	`defšed
(
P2M_PAGED_TYPES
è|| defšed(
P2M_SHARED_TYPES
)

147 
p2m_domaš
 *
p2m
;

148 
p2m_ty³_t
 
p2mt
;

149 
mâ_t
 
mâ
;

151 
p2m
 = 
	`p2m_g‘_ho¡p2m
(
rd
);

152 iàĞ
»adÚly
 )

153 
mâ
 = 
	`gâ_to_mâ
(
p2m
, 
gâ
, &
p2mt
);

155 
mâ
 = 
	`gâ_to_mâ_unsh¬e
(
p2m
, 
gâ
, &
p2mt
, 1);

157 iàĞ
	`p2m_is_v®id
(
p2mt
) ) {

158 *
äame
 = 
	`mâ_x
(
mâ
);

159 iàĞ
	`p2m_is_·gšg
(
p2mt
) )

161 
	`p2m_mem_·gšg_pİuÏ‹
(
p2m
, 
gâ
);

162 
rc
 = 
GNTST_—gaš
;

165 *
äame
 = 
INVALID_MFN
;

166 
rc
 = 
GNTST_bad_·ge
;

169 *
äame
 = 
»adÚly
 ? 
	`gmâ_to_mâ
(
rd
, 
gâ
è: 
	`gâ_to_mâ_´iv©e
(rd, gfn);

172  
rc
;

173 
	}
}

175 
šlše
 

176 
	$__g‘_m­Œack_hªdË
(

177 
g¿Á_bË
 *
t
)

179 
h
;

180 iàĞ
	`uÆik–y
((
h
 = 
t
->
m­Œack_h—d
è=ğÑ->
m­Œack_lim™
 - 1)) )

182 
t
->
m­Œack_h—d
 = 
	`m­Œack_’Œy
Ñ, 
h
).
»f
;

183  
h
;

184 
	}
}

186 
šlše
 

187 
	$put_m­Œack_hªdË
(

188 
g¿Á_bË
 *
t
, 
hªdË
)

190 
	`m­Œack_’Œy
(
t
, 
hªdË
).
»f
 =->
m­Œack_h—d
;

191 
t
->
m­Œack_h—d
 = 
hªdË
;

192 
	}
}

194 
šlše
 

195 
	$g‘_m­Œack_hªdË
(

196 
g¿Á_bË
 *
lgt
)

198 
i
;

199 
g¿Á_hªdË_t
 
hªdË
;

200 
g¿Á_m­pšg
 *
Ãw_mt
;

201 
Ãw_mt_lim™
, 
Ä_äames
;

203 iàĞ
	`uÆik–y
((
hªdË
 = 
	`__g‘_m­Œack_hªdË
(
lgt
)) == -1) )

205 
	`¥š_lock
(&
lgt
->
lock
);

207 iàĞ
	`uÆik–y
((
hªdË
 = 
	`__g‘_m­Œack_hªdË
(
lgt
)) == -1) )

209 
Ä_äames
 = 
	`Ä_m­Œack_äames
(
lgt
);

210 iàĞ
Ä_äames
 >ğ
	`max_Ä_m­Œack_äames
() )

212 
	`¥š_uÆock
(&
lgt
->
lock
);

216 
Ãw_mt
 = 
	`®loc_x’h—p_·ge
();

217 iàĞ
Ãw_mt
 =ğ
NULL
 )

219 
	`¥š_uÆock
(&
lgt
->
lock
);

223 
	`ş—r_·ge
(
Ãw_mt
);

225 
Ãw_mt_lim™
 = 
lgt
->
m­Œack_lim™
 + 
MAPTRACK_PER_PAGE
;

227  
i
 = 
lgt
->
m­Œack_lim™
; i < 
Ãw_mt_lim™
; i++ )

229 
Ãw_mt
[
i
 % 
MAPTRACK_PER_PAGE
].
»f
 = i+1;

230 
Ãw_mt
[
i
 % 
MAPTRACK_PER_PAGE
].
æags
 = 0;

233 
lgt
->
m­Œack
[
Ä_äames
] = 
Ãw_mt
;

234 
lgt
->
m­Œack_lim™
 = 
Ãw_mt_lim™
;

236 
	`gd´štk
(
XENLOG_INFO
,

237 "Inü—£d m­Œack siztØ%u f¿mes.\n", 
Ä_äames
 + 1);

238 
hªdË
 = 
	`__g‘_m­Œack_hªdË
(
lgt
);

241 
	`¥š_uÆock
(&
lgt
->
lock
);

243  
hªdË
;

244 
	}
}

247 
	$Ä_g¿Á_’Œ›s
(
g¿Á_bË
 *
gt
)

249 
	`ASSERT
(
gt
->
gt_v”siÚ
 != 0);

250 ià(
gt
->
gt_v”siÚ
 == 1)

251  (
	`Ä_g¿Á_äames
(
gt
è<< 
PAGE_SHIFT
è/ (
g¿Á_’Œy_v1_t
);

253  (
	`Ä_g¿Á_äames
(
gt
è<< 
PAGE_SHIFT
è/ (
g¿Á_’Œy_v2_t
);

254 
	}
}

256 
	$_£t_¡©us_v1
(
domid_t
 
domid
,

257 
»adÚly
,

258 
m­æag
,

259 
g¿Á_’Œy_h—d”_t
 *
shah
,

260 
aùive_g¿Á_’Œy
 *
aù
)

262 
rc
 = 
GNTST_okay
;

263 
g¿Á_combo
 
scombo
, 
´ev_scombo
, 
Ãw_scombo
;

264 
ušt16_t
 
mask
 = 
GTF_ty³_mask
;

274 
»Œ›s
 = 0;

278 ià(
m­æag
)

279 
mask
 |ğ
GTF_sub_·ge
;

281 
scombo
.
wÜd
 = *(
u32
 *)
shah
;

292 iàĞ!
aù
->
pš
 &&

293 (((
scombo
.
shÜts
.
æags
 & 
mask
) !=

294 
GTF_³rm™_acûss
) ||

295 (
scombo
.
shÜts
.
domid
 != domid)) )

296 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

298 
scombo
.
shÜts
.
æags
, scombo.shÜts.
domid
,

299 
domid
);

301 
Ãw_scombo
 = 
scombo
;

302 
Ãw_scombo
.
shÜts
.
æags
 |ğ
GTF_»adšg
;

304 iàĞ!
»adÚly
 )

306 
Ãw_scombo
.
shÜts
.
æags
 |ğ
GTF_wr™šg
;

307 iàĞ
	`uÆik–y
(
scombo
.
shÜts
.
æags
 & 
GTF_»adÚly
) )

308 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

312 
´ev_scombo
.
wÜd
 = 
	`cmpxchg
((
u32
 *)
shah
,

313 
scombo
.
wÜd
, 
Ãw_scombo
.word);

314 iàĞ
	`lik–y
(
´ev_scombo
.
wÜd
 =ğ
scombo
.word) )

317 iàĞ
»Œ›s
++ == 4 )

318 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

321 
scombo
 = 
´ev_scombo
;

324 
dÚe
:

325  
rc
;

326 
	}
}

328 
	$_£t_¡©us_v2
(
domid_t
 
domid
,

329 
»adÚly
,

330 
m­æag
,

331 
g¿Á_’Œy_h—d”_t
 *
shah
,

332 
aùive_g¿Á_’Œy
 *
aù
,

333 
g¿Á_¡©us_t
 *
¡©us
)

335 
rc
 = 
GNTST_okay
;

336 
g¿Á_combo
 
scombo
;

337 
ušt16_t
 
æags
 = 
shah
->flags;

338 
domid_t
 
id
 = 
shah
->
domid
;

339 
ušt16_t
 
mask
 = 
GTF_ty³_mask
;

344 
scombo
.
wÜd
 = *(
u32
 *)
shah
;

345 
	`b¬r›r
();

347 
æags
 = 
scombo
.
shÜts
.flags;

348 
id
 = 
scombo
.
shÜts
.
domid
;

352 ià(
m­æag
)

353 
mask
 |ğ
GTF_sub_·ge
;

356 iàĞ!
aù
->
pš
 &&

357 Ğ(((
æags
 & 
mask
è!ğ
GTF_³rm™_acûss
) &&

358 ((
æags
 & 
mask
è!ğ
GTF_Œªs™ive
)) ||

359 (
id
 !ğ
domid
)) )

360 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

362 
æags
, 
id
, 
domid
, 
mask
);

364 iàĞ
»adÚly
 )

366 *
¡©us
 |ğ
GTF_»adšg
;

370 iàĞ
	`uÆik–y
(
æags
 & 
GTF_»adÚly
) )

371 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

373 *
¡©us
 |ğ
GTF_»adšg
 | 
GTF_wr™šg
;

378 
	`mb
();

380 
scombo
.
wÜd
 = *(
u32
 *)
shah
;

381 
	`b¬r›r
();

382 
æags
 = 
scombo
.
shÜts
.flags;

383 
id
 = 
scombo
.
shÜts
.
domid
;

385 iàĞ!
aù
->
pš
 )

387 iàĞ(((
æags
 & 
mask
è!ğ
GTF_³rm™_acûss
) &&

388 ((
æags
 & 
mask
è!ğ
GTF_Œªs™ive
)) ||

389 (
id
 !ğ
domid
) ||

390 (!
»adÚly
 && (
æags
 & 
GTF_»adÚly
)) )

392 
	`gÁb_ş—r_æag
(
_GTF_»adšg
 | 
_GTF_wr™šg
, 
¡©us
);

393 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

396 
æags
, 
id
, 
domid
, !
»adÚly
);

401 iàĞ
	`uÆik–y
(
æags
 & 
GTF_»adÚly
) )

403 
	`gÁb_ş—r_æag
(
_GTF_wr™šg
, 
¡©us
);

404 
	`PIN_FAIL
(
dÚe
, 
GNTST_g’”®_”rÜ
,

409 
dÚe
:

410  
rc
;

411 
	}
}

414 
	$_£t_¡©us
(
gt_v”siÚ
,

415 
domid_t
 
domid
,

416 
»adÚly
,

417 
m­æag
,

418 
g¿Á_’Œy_h—d”_t
 *
shah
,

419 
aùive_g¿Á_’Œy
 *
aù
,

420 
g¿Á_¡©us_t
 *
¡©us
)

423 ià(
gt_v”siÚ
 == 1)

424  
	`_£t_¡©us_v1
(
domid
, 
»adÚly
, 
m­æag
, 
shah
, 
aù
);

426  
	`_£t_¡©us_v2
(
domid
, 
»adÚly
, 
m­æag
, 
shah
, 
aù
, 
¡©us
);

427 
	}
}

429 
	$m­couÁ
(

430 
domaš
 *
ld
, 
mâ
,

431 *
wrc
, *
rdc
)

433 
g¿Á_bË
 *
gt
 = 
ld
->grant_table;

434 
g¿Á_m­pšg
 *
m­
;

435 
g¿Á_hªdË_t
 
hªdË
;

436 
domaš
 *
rd
;

438 *
wrc
 = *
rdc
 = 0;

440  
hªdË
 = 0; hªdË < 
gt
->
m­Œack_lim™
; handle++ )

442 
m­
 = &
	`m­Œack_’Œy
(
gt
, 
hªdË
);

443 iàĞ!(
m­
->
æags
 & (
GNTMAP_deviû_m­
|
GNTMAP_ho¡_m­
)) )

445 
rd
 = 
	`rcu_lock_domaš_by_id
(
m­
->
domid
);

446 iàĞ
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
m­
->
»f
).
äame
 =ğ
mâ
 )

447 (
m­
->
æags
 & 
GNTMAP_»adÚly
è? (*
rdc
)++ : (*
wrc
)++;

448 
	`rcu_uÆock_domaš
(
rd
);

450 
	}
}

460 
	$__gÁb_m­_g¿Á_»f
(

461 
gÁb_m­_g¿Á_»f
 *
İ
)

463 
domaš
 *
ld
, *
rd
, *
owÃr
;

464 
vıu
 *
Ëd
;

465 
hªdË
;

466 
äame
 = 0, 
Ä_g‘s
 = 0;

467 
·ge_šfo
 *
pg
;

468 
rc
 = 
GNTST_okay
;

469 
u32
 
Şd_pš
;

470 
u32
 
aù_pš
;

471 
ÿche_æags
;

472 
aùive_g¿Á_’Œy
 *
aù
;

473 
g¿Á_m­pšg
 *
mt
;

474 
g¿Á_’Œy_v1_t
 *
sha1
;

475 
g¿Á_’Œy_v2_t
 *
sha2
;

476 
g¿Á_’Œy_h—d”_t
 *
shah
;

477 
ušt16_t
 *
¡©us
;

479 
Ëd
 = 
cu¼’t
;

480 
ld
 = 
Ëd
->
domaš
;

482 iàĞ
	`uÆik–y
((
İ
->
æags
 & (
GNTMAP_deviû_m­
|
GNTMAP_ho¡_m­
)) == 0) )

484 
	`gd´štk
(
XENLOG_INFO
, "Bad fÏg š g¿Á m­ o°(%x).\n", 
İ
->
æags
);

485 
İ
->
¡©us
 = 
GNTST_bad_gÁ»f
;

489 iàĞ
	`uÆik–y
(
	`·gšg_mode_ex‹º®
(
ld
) &&

490 (
İ
->
æags
 & (
GNTMAP_deviû_m­
|
GNTMAP_­¶iÿtiÚ_m­
|

491 
GNTMAP_cÚšs_±e
))) )

493 
	`gd´štk
(
XENLOG_INFO
, "No device mapping in HVM domain.\n");

494 
İ
->
¡©us
 = 
GNTST_g’”®_”rÜ
;

498 iàĞ
	`uÆik–y
((
rd
 = 
	`rcu_lock_domaš_by_id
(
İ
->
dom
)è=ğ
NULL
) )

500 
	`gd´štk
(
XENLOG_INFO
, "Could‚Ù fšd domaš %d\n", 
İ
->
dom
);

501 
İ
->
¡©us
 = 
GNTST_bad_domaš
;

505 
rc
 = 
	`xsm_g¿Á_m­»f
(
ld
, 
rd
, 
İ
->
æags
);

506 iàĞ
rc
 )

508 
	`rcu_uÆock_domaš
(
rd
);

509 
İ
->
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

513 iàĞ
	`uÆik–y
((
hªdË
 = 
	`g‘_m­Œack_hªdË
(
ld
->
g¿Á_bË
)) == -1) )

515 
	`rcu_uÆock_domaš
(
rd
);

516 
	`gd´štk
(
XENLOG_INFO
, "Failedo obtain maptrack handle.\n");

517 
İ
->
¡©us
 = 
GNTST_no_deviû_¥aû
;

521 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

523 iàĞ
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 0 )

524 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

528 iàĞ
	`uÆik–y
(
İ
->
»f
 >ğ
	`Ä_g¿Á_’Œ›s
(
rd
->
g¿Á_bË
)))

529 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_bad_gÁ»f
, "Bad„eà(%d).\n", 
İ
->
»f
);

531 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

532 
shah
 = 
	`sh¬ed_’Œy_h—d”
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

533 ià(
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 1) {

534 
sha1
 = &
	`sh¬ed_’Œy_v1
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

535 
sha2
 = 
NULL
;

536 
¡©us
 = &
shah
->
æags
;

538 
sha2
 = &
	`sh¬ed_’Œy_v2
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

539 
sha1
 = 
NULL
;

540 
¡©us
 = &
	`¡©us_’Œy
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

544 iàĞ
aù
->
pš
 &&

545 ((
aù
->
domid
 !ğ
ld
->
domaš_id
) ||

546 (
aù
->
pš
 & 0x80808080U) != 0 ||

547 (
aù
->
is_sub_·ge
)) )

548 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

550 
aù
->
domid
, 
ld
->
domaš_id
,‡ù->
pš
,‡ù->
is_sub_·ge
);

552 iàĞ!
aù
->
pš
 ||

553 (!(
İ
->
æags
 & 
GNTMAP_»adÚly
) &&

554 !(
aù
->
pš
 & (
GNTPIN_h¡w_mask
|
GNTPIN_devw_mask
))) )

556 iàĞ(
rc
 = 
	`_£t_¡©us
(
rd
->
g¿Á_bË
->
gt_v”siÚ
,

557 
ld
->
domaš_id
, 
İ
->
æags
 & 
GNTMAP_»adÚly
,

558 1, 
shah
, 
aù
, 
¡©us
èè!ğ
GNTST_okay
 )

559 
uÆock_out
;

561 iàĞ!
aù
->
pš
 )

563 
gâ
;

564 
äame
;

566 
gâ
 = 
sha1
 ? sha1->
äame
 : 
sha2
->
fuÎ_·ge
.frame;

567 
rc
 = 
	`__g‘_·ged_äame
(
gâ
, &
äame
, !!(
İ
->
æags
 & 
GNTMAP_»adÚly
), 
rd
);

568 iàĞ
rc
 !ğ
GNTST_okay
 )

569 
uÆock_out
;

570 
aù
->
gâ
 = gfn;

571 
aù
->
domid
 = 
ld
->
domaš_id
;

572 
aù
->
äame
 = frame;

573 
aù
->
¡¬t
 = 0;

574 
aù
->
Ëngth
 = 
PAGE_SIZE
;

575 
aù
->
is_sub_·ge
 = 0;

579 
Şd_pš
 = 
aù
->
pš
;

580 iàĞ
İ
->
æags
 & 
GNTMAP_deviû_m­
 )

581 
aù
->
pš
 +ğ(
İ
->
æags
 & 
GNTMAP_»adÚly
) ?

582 
GNTPIN_devr_šc
 : 
GNTPIN_devw_šc
;

583 iàĞ
İ
->
æags
 & 
GNTMAP_ho¡_m­
 )

584 
aù
->
pš
 +ğ(
İ
->
æags
 & 
GNTMAP_»adÚly
) ?

585 
GNTPIN_h¡r_šc
 : 
GNTPIN_h¡w_šc
;

587 
äame
 = 
aù
->frame;

588 
aù_pš
 = 
aù
->
pš
;

590 
ÿche_æags
 = (
shah
->
æags
 & (
GTF_PAT
 | 
GTF_PWT
 | 
GTF_PCD
) );

592 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

594 
pg
 = 
	`mâ_v®id
(
äame
è? 
	`mâ_to_·ge
(äameè: 
NULL
;

596 iàĞ!
pg
 || (
owÃr
 = 
	`·ge_g‘_owÃr_ªd_»ã»nû
Õg)è=ğ
dom_io
 )

599 iàĞ
pg
 )

600 
	`put_·ge
(
pg
);

602 iàĞ
	`·gšg_mode_ex‹º®
(
ld
) )

604 
	`gd´štk
(
XENLOG_WARNING
, "HVM guests can't grant map iomem\n");

605 
rc
 = 
GNTST_g’”®_”rÜ
;

606 
undo_out
;

609 iàĞ!
	`iomem_acûss_³rm™‹d
(
rd
, 
äame
, frame) )

611 
	`gd´štk
(
XENLOG_WARNING
,

613 
äame
, 
rd
->
domaš_id
);

614 
rc
 = 
GNTST_g’”®_”rÜ
;

615 
undo_out
;

618 
rc
 = 
	`ü—‹_g¿Á_ho¡_m­pšg
(

619 
İ
->
ho¡_addr
, 
äame
, op->
æags
, 
ÿche_æags
);

620 iàĞ
rc
 !ğ
GNTST_okay
 )

621 
undo_out
;

623 iàĞ
owÃr
 =ğ
rd
 || owÃ¸=ğ
dom_cow
 )

625 iàĞ
	`gÁb_ho¡_m­pšg_g‘_·ge_ty³
(
İ
, 
ld
, 
rd
) &&

626 !
	`g‘_·ge_ty³
(
pg
, 
PGT_wr™abË_·ge
) )

627 
could_nÙ_pš
;

629 
Ä_g‘s
++;

630 iàĞ
İ
->
æags
 & 
GNTMAP_ho¡_m­
 )

632 
rc
 = 
	`ü—‹_g¿Á_ho¡_m­pšg
(
İ
->
ho¡_addr
, 
äame
, op->
æags
, 0);

633 iàĞ
rc
 !ğ
GNTST_okay
 )

634 
undo_out
;

636 iàĞ
İ
->
æags
 & 
GNTMAP_deviû_m­
 )

638 
Ä_g‘s
++;

639 ()
	`g‘_·ge
(
pg
, 
rd
);

640 iàĞ!(
İ
->
æags
 & 
GNTMAP_»adÚly
) )

641 
	`g‘_·ge_ty³
(
pg
, 
PGT_wr™abË_·ge
);

647 
could_nÙ_pš
:

648 iàĞ!
rd
->
is_dyšg
 )

649 
	`gd´štk
(
XENLOG_WARNING
, "Could‚ot…in grant frame %lx\n",

650 
äame
);

651 iàĞ
owÃr
 !ğ
NULL
 )

652 
	`put_·ge
(
pg
);

653 
rc
 = 
GNTST_g’”®_”rÜ
;

654 
undo_out
;

657 iàĞ!
	`is_hvm_domaš
(
ld
è&& 
	`Ãed_iommu
(ld) )

659 
wrc
, 
rdc
;

660 
”r
 = 0;

662 
	`BUG_ON
(
	`·gšg_mode_Œª¦©e
(
ld
));

665 
	`m­couÁ
(
ld
, 
äame
, &
wrc
, &
rdc
);

666 iàĞ(
aù_pš
 & (
GNTPIN_h¡w_mask
|
GNTPIN_devw_mask
)) &&

667 !(
Şd_pš
 & (
GNTPIN_h¡w_mask
|
GNTPIN_devw_mask
)) )

669 iàĞ
wrc
 == 0 )

670 
”r
 = 
	`iommu_m­_·ge
(
ld
, 
äame
, frame,

671 
IOMMUF_»adabË
|
IOMMUF_wr™abË
);

673 iàĞ
aù_pš
 && !
Şd_pš
 )

675 iàĞ(
wrc
 + 
rdc
) == 0 )

676 
”r
 = 
	`iommu_m­_·ge
(
ld
, 
äame
, f¿me, 
IOMMUF_»adabË
);

678 iàĞ
”r
 )

680 
rc
 = 
GNTST_g’”®_”rÜ
;

681 
undo_out
;

685 
	`TRACE_1D
(
TRC_MEM_PAGE_GRANT_MAP
, 
İ
->
dom
);

687 
mt
 = &
	`m­Œack_’Œy
(
ld
->
g¿Á_bË
, 
hªdË
);

688 
mt
->
domid
 = 
İ
->
dom
;

689 
mt
->
»f
 = 
İ
->ref;

690 
mt
->
æags
 = 
İ
->flags;

692 
İ
->
dev_bus_addr
 = (
u64
)
äame
 << 
PAGE_SHIFT
;

693 
İ
->
hªdË
 = handle;

694 
İ
->
¡©us
 = 
GNTST_okay
;

696 
	`rcu_uÆock_domaš
(
rd
);

699 
undo_out
:

700 iàĞ
Ä_g‘s
 > 1 )

702 iàĞ!(
İ
->
æags
 & 
GNTMAP_»adÚly
) )

703 
	`put_·ge_ty³
(
pg
);

704 
	`put_·ge
(
pg
);

706 iàĞ
Ä_g‘s
 > 0 )

708 iàĞ
	`gÁb_ho¡_m­pšg_g‘_·ge_ty³
(
İ
, 
ld
, 
rd
) )

709 
	`put_·ge_ty³
(
pg
);

710 
	`put_·ge
(
pg
);

713 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

715 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

716 
shah
 = 
	`sh¬ed_’Œy_h—d”
(
rd
->
g¿Á_bË
, 
İ
->
»f
);

718 iàĞ
İ
->
æags
 & 
GNTMAP_deviû_m­
 )

719 
aù
->
pš
 -ğ(
İ
->
æags
 & 
GNTMAP_»adÚly
) ?

720 
GNTPIN_devr_šc
 : 
GNTPIN_devw_šc
;

721 iàĞ
İ
->
æags
 & 
GNTMAP_ho¡_m­
 )

722 
aù
->
pš
 -ğ(
İ
->
æags
 & 
GNTMAP_»adÚly
) ?

723 
GNTPIN_h¡r_šc
 : 
GNTPIN_h¡w_šc
;

725 iàĞ!(
İ
->
æags
 & 
GNTMAP_»adÚly
) &&

726 !(
aù
->
pš
 & (
GNTPIN_h¡w_mask
|
GNTPIN_devw_mask
)) )

727 
	`gÁb_ş—r_æag
(
_GTF_wr™šg
, 
¡©us
);

729 iàĞ!
aù
->
pš
 )

730 
	`gÁb_ş—r_æag
(
_GTF_»adšg
, 
¡©us
);

732 
uÆock_out
:

733 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

734 
İ
->
¡©us
 = 
rc
;

735 
	`put_m­Œack_hªdË
(
ld
->
g¿Á_bË
, 
hªdË
);

736 
	`rcu_uÆock_domaš
(
rd
);

737 
	}
}

740 
gÁb_m­_g¿Á_»f
(

741 
	$XEN_GUEST_HANDLE
(
gÁb_m­_g¿Á_»f_t
è
uİ
, 
couÁ
)

743 
i
;

744 
gÁb_m­_g¿Á_»f
 
İ
;

746  
i
 = 0; i < 
couÁ
; i++ )

748 ià(
i
 && 
	`hy³rÿÎ_´“m±_check
())

749  
i
;

750 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
İ
, 
uİ
, 
i
, 1)) )

751  -
EFAULT
;

752 
	`__gÁb_m­_g¿Á_»f
(&
İ
);

753 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
uİ
, 
i
, &
İ
, 1)) )

754  -
EFAULT
;

758 
	}
}

761 
	$__gÁb_unm­_commÚ
(

762 
gÁb_unm­_commÚ
 *
İ
)

764 
domid_t
 
dom
;

765 
domaš
 *
ld
, *
rd
;

766 
aùive_g¿Á_’Œy
 *
aù
;

767 
s16
 
rc
 = 0;

768 
u32
 
Şd_pš
;

770 
ld
 = 
cu¼’t
->
domaš
;

772 
İ
->
äame
 = ()(İ->
dev_bus_addr
 >> 
PAGE_SHIFT
);

774 iàĞ
	`uÆik–y
(
İ
->
hªdË
 >ğ
ld
->
g¿Á_bË
->
m­Œack_lim™
) )

776 
	`gd´štk
(
XENLOG_INFO
, "Bad hªdË (%d).\n", 
İ
->
hªdË
);

777 
İ
->
¡©us
 = 
GNTST_bad_hªdË
;

781 
İ
->
m­
 = &
	`m­Œack_’Œy
(
ld
->
g¿Á_bË
, op->
hªdË
);

783 iàĞ
	`uÆik–y
(!
İ
->
m­
->
æags
) )

785 
	`gd´štk
(
XENLOG_INFO
, "Z”Øæag fÜ hªdË (%d).\n", 
İ
->
hªdË
);

786 
İ
->
¡©us
 = 
GNTST_bad_hªdË
;

790 
dom
 = 
İ
->
m­
->
domid
;

791 
İ
->
æags
 = op->
m­
->flags;

793 iàĞ
	`uÆik–y
((
İ
->
rd
 =„d = 
	`rcu_lock_domaš_by_id
(
dom
)è=ğ
NULL
) )

796 
	`gd´štk
(
XENLOG_INFO
, "Could‚Ù fšd domaš %d\n", 
dom
);

797 
	`domaš_üash
(
ld
);

801 
rc
 = 
	`xsm_g¿Á_unm­»f
(
ld
, 
rd
);

802 iàĞ
rc
 )

804 
	`rcu_uÆock_domaš
(
rd
);

805 
İ
->
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

809 
	`TRACE_1D
(
TRC_MEM_PAGE_GRANT_UNMAP
, 
dom
);

811 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

813 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
İ
->
m­
->
»f
);

814 
Şd_pš
 = 
aù
->
pš
;

816 iàĞ
İ
->
äame
 == 0 )

818 
İ
->
äame
 = 
aù
->frame;

822 iàĞ
	`uÆik–y
(
İ
->
äame
 !ğ
aù
->frame) )

823 
	`PIN_FAIL
(
unm­_out
, 
GNTST_g’”®_”rÜ
,

825 
İ
->
äame
, 
aù
->frame);

826 iàĞ
İ
->
æags
 & 
GNTMAP_deviû_m­
 )

828 
	`ASSERT
(
aù
->
pš
 & (
GNTPIN_devw_mask
 | 
GNTPIN_devr_mask
));

829 
İ
->
m­
->
æags
 &ğ~
GNTMAP_deviû_m­
;

830 iàĞ
İ
->
æags
 & 
GNTMAP_»adÚly
 )

831 
aù
->
pš
 -ğ
GNTPIN_devr_šc
;

833 
aù
->
pš
 -ğ
GNTPIN_devw_šc
;

837 iàĞ(
İ
->
ho¡_addr
 !ğ0è&& (İ->
æags
 & 
GNTMAP_ho¡_m­
) )

839 iàĞ(
rc
 = 
	`»¶aû_g¿Á_ho¡_m­pšg
(
İ
->
ho¡_addr
,

840 
İ
->
äame
, op->
Ãw_addr
,

841 
İ
->
æags
)) < 0 )

842 
unm­_out
;

844 
	`ASSERT
(
aù
->
pš
 & (
GNTPIN_h¡w_mask
 | 
GNTPIN_h¡r_mask
));

845 
İ
->
m­
->
æags
 &ğ~
GNTMAP_ho¡_m­
;

846 iàĞ
İ
->
æags
 & 
GNTMAP_»adÚly
 )

847 
aù
->
pš
 -ğ
GNTPIN_h¡r_šc
;

849 
aù
->
pš
 -ğ
GNTPIN_h¡w_šc
;

852 iàĞ!
	`is_hvm_domaš
(
ld
è&& 
	`Ãed_iommu
(ld) )

854 
wrc
, 
rdc
;

855 
”r
 = 0;

856 
	`BUG_ON
(
	`·gšg_mode_Œª¦©e
(
ld
));

857 
	`m­couÁ
(
ld
, 
İ
->
äame
, &
wrc
, &
rdc
);

858 iàĞ(
wrc
 + 
rdc
) == 0 )

859 
”r
 = 
	`iommu_unm­_·ge
(
ld
, 
İ
->
äame
);

860 iàĞ
wrc
 == 0 )

861 
”r
 = 
	`iommu_m­_·ge
(
ld
, 
İ
->
äame
, op->äame, 
IOMMUF_»adabË
);

862 iàĞ
”r
 )

864 
rc
 = 
GNTST_g’”®_”rÜ
;

865 
unm­_out
;

870 iàĞ!(
İ
->
æags
 & 
GNTMAP_»adÚly
) )

871 
	`gÁb_m¬k_dœty
(
rd
, 
İ
->
äame
);

873 
unm­_out
:

874 
İ
->
¡©us
 = 
rc
;

875 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

876 
	`rcu_uÆock_domaš
(
rd
);

877 
	}
}

880 
	$__gÁb_unm­_commÚ_com¶‘e
(
gÁb_unm­_commÚ
 *
İ
)

882 
domaš
 *
ld
, *
rd
;

883 
aùive_g¿Á_’Œy
 *
aù
;

884 
g¿Á_’Œy_h—d”_t
 *
sha
;

885 
·ge_šfo
 *
pg
;

886 
ušt16_t
 *
¡©us
;

888 
rd
 = 
İ
->rd;

890 iàĞ
rd
 =ğ
NULL
 )

900 
ld
 = 
cu¼’t
->
domaš
;

902 
	`rcu_lock_domaš
(
rd
);

903 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

905 iàĞ
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 0 )

906 
unm­_out
;

908 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
İ
->
m­
->
»f
);

909 
sha
 = 
	`sh¬ed_’Œy_h—d”
(
rd
->
g¿Á_bË
, 
İ
->
m­
->
»f
);

911 iàĞ
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 1 )

912 
¡©us
 = &
sha
->
æags
;

914 
¡©us
 = &
	`¡©us_’Œy
(
rd
->
g¿Á_bË
, 
İ
->
m­
->
»f
);

916 iàĞ
	`uÆik–y
(
İ
->
äame
 !ğ
aù
->frame) )

922 
unm­_out
;

925 
pg
 = 
	`mâ_to_·ge
(
İ
->
äame
);

927 iàĞ
İ
->
æags
 & 
GNTMAP_deviû_m­
 )

929 iàĞ!
	`is_iomem_·ge
(
aù
->
äame
) )

931 iàĞ
İ
->
æags
 & 
GNTMAP_»adÚly
 )

932 
	`put_·ge
(
pg
);

934 
	`put_·ge_ªd_ty³
(
pg
);

938 iàĞ(
İ
->
ho¡_addr
 !ğ0è&& (İ->
æags
 & 
GNTMAP_ho¡_m­
) )

940 iàĞ
İ
->
¡©us
 != 0 )

946 
unm­_out
;

949 iàĞ!
	`is_iomem_·ge
(
İ
->
äame
) )

951 iàĞ
	`gÁb_ho¡_m­pšg_g‘_·ge_ty³
(
İ
, 
ld
, 
rd
) )

952 
	`put_·ge_ty³
(
pg
);

953 
	`put_·ge
(
pg
);

957 iàĞ(
İ
->
m­
->
æags
 & (
GNTMAP_deviû_m­
|
GNTMAP_ho¡_m­
)) == 0 )

959 
İ
->
m­
->
æags
 = 0;

960 
	`put_m­Œack_hªdË
(
ld
->
g¿Á_bË
, 
İ
->
hªdË
);

963 iàĞ((
aù
->
pš
 & (
GNTPIN_devw_mask
|
GNTPIN_h¡w_mask
)) == 0) &&

964 !(
İ
->
æags
 & 
GNTMAP_»adÚly
) )

965 
	`gÁb_ş—r_æag
(
_GTF_wr™šg
, 
¡©us
);

967 iàĞ
aù
->
pš
 == 0 )

968 
	`gÁb_ş—r_æag
(
_GTF_»adšg
, 
¡©us
);

970 
unm­_out
:

971 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

972 
	`rcu_uÆock_domaš
(
rd
);

973 
	}
}

976 
	$__gÁb_unm­_g¿Á_»f
(

977 
gÁb_unm­_g¿Á_»f
 *
İ
,

978 
gÁb_unm­_commÚ
 *
commÚ
)

980 
commÚ
->
ho¡_addr
 = 
İ
->host_addr;

981 
commÚ
->
dev_bus_addr
 = 
İ
->dev_bus_addr;

982 
commÚ
->
hªdË
 = 
İ
->handle;

985 
commÚ
->
Ãw_addr
 = 0;

986 
commÚ
->
rd
 = 
NULL
;

988 
	`__gÁb_unm­_commÚ
(
commÚ
);

989 
İ
->
¡©us
 = 
commÚ
->status;

990 
	}
}

994 
gÁb_unm­_g¿Á_»f
(

995 
	$XEN_GUEST_HANDLE
(
gÁb_unm­_g¿Á_»f_t
è
uİ
, 
couÁ
)

997 
i
, 
c
, 
·¹Ÿl_dÚe
, 
dÚe
 = 0;

998 
gÁb_unm­_g¿Á_»f
 
İ
;

999 
gÁb_unm­_commÚ
 
commÚ
[
GNTTAB_UNMAP_BATCH_SIZE
];

1001  
couÁ
 != 0 )

1003 
c
 = 
	`mš
(
couÁ
, ()
GNTTAB_UNMAP_BATCH_SIZE
);

1004 
·¹Ÿl_dÚe
 = 0;

1006  
i
 = 0; i < 
c
; i++ )

1008 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
İ
, 
uİ
, 
dÚe
+
i
, 1)) )

1009 
çuÉ
;

1010 
	`__gÁb_unm­_g¿Á_»f
(&
İ
, &(
commÚ
[
i
]));

1011 ++
·¹Ÿl_dÚe
;

1012 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
uİ
, 
dÚe
+
i
, &
İ
, 1)) )

1013 
çuÉ
;

1016 
	`æush_b_mask
(&
cu¼’t
->
domaš
->
domaš_dœty_ıumask
);

1018  
i
 = 0; i < 
·¹Ÿl_dÚe
; i++ )

1019 
	`__gÁb_unm­_commÚ_com¶‘e
(&(
commÚ
[
i
]));

1021 
couÁ
 -ğ
c
;

1022 
dÚe
 +ğ
c
;

1024 ià(
couÁ
 && 
	`hy³rÿÎ_´“m±_check
())

1025  
dÚe
;

1030 
çuÉ
:

1031 
	`æush_b_mask
(&
cu¼’t
->
domaš
->
domaš_dœty_ıumask
);

1033  
i
 = 0; i < 
·¹Ÿl_dÚe
; i++ )

1034 
	`__gÁb_unm­_commÚ_com¶‘e
(&(
commÚ
[
i
]));

1035  -
EFAULT
;

1036 
	}
}

1039 
	$__gÁb_unm­_ªd_»¶aû
(

1040 
gÁb_unm­_ªd_»¶aû
 *
İ
,

1041 
gÁb_unm­_commÚ
 *
commÚ
)

1043 
commÚ
->
ho¡_addr
 = 
İ
->host_addr;

1044 
commÚ
->
Ãw_addr
 = 
İ
->new_addr;

1045 
commÚ
->
hªdË
 = 
İ
->handle;

1048 
commÚ
->
dev_bus_addr
 = 0;

1049 
commÚ
->
rd
 = 
NULL
;

1051 
	`__gÁb_unm­_commÚ
(
commÚ
);

1052 
İ
->
¡©us
 = 
commÚ
->status;

1053 
	}
}

1056 
gÁb_unm­_ªd_»¶aû
(

1057 
	$XEN_GUEST_HANDLE
(
gÁb_unm­_ªd_»¶aû_t
è
uİ
, 
couÁ
)

1059 
i
, 
c
, 
·¹Ÿl_dÚe
, 
dÚe
 = 0;

1060 
gÁb_unm­_ªd_»¶aû
 
İ
;

1061 
gÁb_unm­_commÚ
 
commÚ
[
GNTTAB_UNMAP_BATCH_SIZE
];

1063  
couÁ
 != 0 )

1065 
c
 = 
	`mš
(
couÁ
, ()
GNTTAB_UNMAP_BATCH_SIZE
);

1066 
·¹Ÿl_dÚe
 = 0;

1068  
i
 = 0; i < 
c
; i++ )

1070 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
İ
, 
uİ
, 
dÚe
+
i
, 1)) )

1071 
çuÉ
;

1072 
	`__gÁb_unm­_ªd_»¶aû
(&
İ
, &(
commÚ
[
i
]));

1073 ++
·¹Ÿl_dÚe
;

1074 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
uİ
, 
dÚe
+
i
, &
İ
, 1)) )

1075 
çuÉ
;

1078 
	`æush_b_mask
(&
cu¼’t
->
domaš
->
domaš_dœty_ıumask
);

1080  
i
 = 0; i < 
·¹Ÿl_dÚe
; i++ )

1081 
	`__gÁb_unm­_commÚ_com¶‘e
(&(
commÚ
[
i
]));

1083 
couÁ
 -ğ
c
;

1084 
dÚe
 +ğ
c
;

1086 ià(
couÁ
 && 
	`hy³rÿÎ_´“m±_check
())

1087  
dÚe
;

1092 
çuÉ
:

1093 
	`æush_b_mask
(&
cu¼’t
->
domaš
->
domaš_dœty_ıumask
);

1095  
i
 = 0; i < 
·¹Ÿl_dÚe
; i++ )

1096 
	`__gÁb_unm­_commÚ_com¶‘e
(&(
commÚ
[
i
]));

1097  -
EFAULT
;

1098 
	}
}

1101 
	$gÁb_pİuÏ‹_¡©us_äames
(
domaš
 *
d
, 
g¿Á_bË
 *
gt
)

1103 
i
;

1104 
»q_¡©us_äames
;

1106 
»q_¡©us_äames
 = 
	`g¿Á_to_¡©us_äames
(
gt
->
Ä_g¿Á_äames
);

1107  
i
 = 
	`Ä_¡©us_äames
(
gt
); i < 
»q_¡©us_äames
; i++ )

1109 iàĞ(
gt
->
¡©us
[
i
] = 
	`®loc_x’h—p_·ge
()è=ğ
NULL
 )

1110 
¡©us_®loc_çed
;

1111 
	`ş—r_·ge
(
gt
->
¡©us
[
i
]);

1114  
i
 = 
	`Ä_¡©us_äames
(
gt
); i < 
»q_¡©us_äames
; i++ )

1115 
	`gÁb_ü—‹_¡©us_·ge
(
d
, 
gt
, 
i
);

1117 
gt
->
Ä_¡©us_äames
 = 
»q_¡©us_äames
;

1121 
¡©us_®loc_çed
:

1122  
i
 = 
	`Ä_¡©us_äames
(
gt
); i < 
»q_¡©us_äames
; i++ )

1124 
	`ä“_x’h—p_·ge
(
gt
->
¡©us
[
i
]);

1125 
gt
->
¡©us
[
i
] = 
NULL
;

1127  -
ENOMEM
;

1128 
	}
}

1131 
	$gÁb_uÅİuÏ‹_¡©us_äames
(
domaš
 *
d
, 
g¿Á_bË
 *
gt
)

1133 
i
;

1135  
i
 = 0; i < 
	`Ä_¡©us_äames
(
gt
); i++ )

1137 
	`·ge_£t_owÃr
(
	`vœt_to_·ge
(
gt
->
¡©us
[
i
]), 
dom_x’
);

1138 
	`ä“_x’h—p_·ge
(
gt
->
¡©us
[
i
]);

1139 
gt
->
¡©us
[
i
] = 
NULL
;

1141 
gt
->
Ä_¡©us_äames
 = 0;

1142 
	}
}

1145 
	$gÁb_grow_bË
(
domaš
 *
d
, 
»q_Ä_äames
)

1149 
g¿Á_bË
 *
gt
 = 
d
->grant_table;

1150 
i
;

1152 
	`ASSERT
(
»q_Ä_äames
 <ğ
max_Ä_g¿Á_äames
);

1154 
	`gd´štk
(
XENLOG_INFO
,

1156 
d
->
domaš_id
, 
	`Ä_g¿Á_äames
(
gt
), 
»q_Ä_äames
);

1159  
i
 = 
	`Ä_aùive_g¿Á_äames
(
gt
);

1160 
i
 < 
	`num_aù_äames_äom_sha_äames
(
»q_Ä_äames
); i++ )

1162 iàĞ(
gt
->
aùive
[
i
] = 
	`®loc_x’h—p_·ge
()è=ğ
NULL
 )

1163 
aùive_®loc_çed
;

1164 
	`ş—r_·ge
(
gt
->
aùive
[
i
]);

1168  
i
 = 
	`Ä_g¿Á_äames
(
gt
); i < 
»q_Ä_äames
; i++ )

1170 iàĞ(
gt
->
sh¬ed_¿w
[
i
] = 
	`®loc_x’h—p_·ge
()è=ğ
NULL
 )

1171 
sh¬ed_®loc_çed
;

1172 
	`ş—r_·ge
(
gt
->
sh¬ed_¿w
[
i
]);

1176  
i
 = 
	`Ä_g¿Á_äames
(
gt
); i < 
»q_Ä_äames
; i++ )

1177 
	`gÁb_ü—‹_sh¬ed_·ge
(
d
, 
gt
, 
i
);

1179 
gt
->
Ä_g¿Á_äames
 = 
»q_Ä_äames
;

1182 ià(
gt
->
gt_v”siÚ
 > 1)

1184 iàĞ
	`gÁb_pİuÏ‹_¡©us_äames
(
d
, 
gt
) )

1185 
sh¬ed_®loc_çed
;

1190 
sh¬ed_®loc_çed
:

1191  
i
 = 
	`Ä_g¿Á_äames
(
gt
); i < 
»q_Ä_äames
; i++ )

1193 
	`ä“_x’h—p_·ge
(
gt
->
sh¬ed_¿w
[
i
]);

1194 
gt
->
sh¬ed_¿w
[
i
] = 
NULL
;

1196 
aùive_®loc_çed
:

1197  
i
 = 
	`Ä_aùive_g¿Á_äames
(
gt
);

1198 
i
 < 
	`num_aù_äames_äom_sha_äames
(
»q_Ä_äames
); i++ )

1200 
	`ä“_x’h—p_·ge
(
gt
->
aùive
[
i
]);

1201 
gt
->
aùive
[
i
] = 
NULL
;

1203 
	`gd´štk
(
XENLOG_INFO
, "Allocation failure whenƒxpanding grantable.\n");

1205 
	}
}

1208 
gÁb_£tup_bË
(

1209 
	$XEN_GUEST_HANDLE
(
gÁb_£tup_bË_t
è
uİ
, 
couÁ
)

1211 
gÁb_£tup_bË
 
İ
;

1212 
domaš
 *
d
;

1213 
i
;

1214 
gmâ
;

1215 
domid_t
 
dom
;

1217 iàĞ
couÁ
 != 1 )

1218  -
EINVAL
;

1220 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
İ
, 
uİ
, 1) != 0) )

1222 
	`gd´štk
(
XENLOG_INFO
, "Fault while„eading gnttab_setup_table_t.\n");

1223  -
EFAULT
;

1226 iàĞ
	`uÆik–y
(
İ
.
Ä_äames
 > 
max_Ä_g¿Á_äames
) )

1228 
	`gd´štk
(
XENLOG_INFO
, "Xen only supports upo %d grant-table frames"

1230 
max_Ä_g¿Á_äames
);

1231 
İ
.
¡©us
 = 
GNTST_g’”®_”rÜ
;

1232 
out1
;

1235 
dom
 = 
İ
.dom;

1236 iàĞ
dom
 =ğ
DOMID_SELF
 )

1238 
d
 = 
	`rcu_lock_cu¼’t_domaš
();

1242 iàĞ
	`uÆik–y
((
d
 = 
	`rcu_lock_domaš_by_id
(
dom
)è=ğ
NULL
) )

1244 
	`gd´štk
(
XENLOG_INFO
, "Bad domid %d.\n", 
dom
);

1245 
İ
.
¡©us
 = 
GNTST_bad_domaš
;

1246 
out1
;

1249 iàĞ
	`uÆik–y
(!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
)) )

1251 
İ
.
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

1252 
out2
;

1256 iàĞ
	`xsm_g¿Á_£tup
(
cu¼’t
->
domaš
, 
d
) )

1258 
İ
.
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

1259 
out2
;

1262 
	`¥š_lock
(&
d
->
g¿Á_bË
->
lock
);

1264 iàĞ
d
->
g¿Á_bË
->
gt_v”siÚ
 == 0 )

1265 
d
->
g¿Á_bË
->
gt_v”siÚ
 = 1;

1267 iàĞ(
İ
.
Ä_äames
 > 
	`Ä_g¿Á_äames
(
d
->
g¿Á_bË
) ||

1268 Ğ(
d
->
g¿Á_bË
->
gt_v”siÚ
 > 1 ) &&

1269 (
	`g¿Á_to_¡©us_äames
(
İ
.
Ä_äames
) >

1270 
	`Ä_¡©us_äames
(
d
->
g¿Á_bË
)) ) ) &&

1271 !
	`gÁb_grow_bË
(
d
, 
İ
.
Ä_äames
) )

1273 
	`gd´štk
(
XENLOG_INFO
,

1275 
İ
.
Ä_äames
,

1276 
	`Ä_g¿Á_äames
(
d
->
g¿Á_bË
),

1277 
max_Ä_g¿Á_äames
);

1278 
İ
.
¡©us
 = 
GNTST_g’”®_”rÜ
;

1279 
out3
;

1282 
İ
.
¡©us
 = 
GNTST_okay
;

1283  
i
 = 0; i < 
İ
.
Ä_äames
; i++ )

1285 
gmâ
 = 
	`gÁb_sh¬ed_gmâ
(
d
, d->
g¿Á_bË
, 
i
);

1287 
	`BUG_ON
(
	`SHARED_M2P
(
gmâ
));

1288 ()
	`cİy_to_gue¡_off£t
(
İ
.
äame_li¡
, 
i
, &
gmâ
, 1);

1291 
out3
:

1292 
	`¥š_uÆock
(&
d
->
g¿Á_bË
->
lock
);

1293 
out2
:

1294 
	`rcu_uÆock_domaš
(
d
);

1295 
out1
:

1296 iàĞ
	`uÆik–y
(
	`cİy_to_gue¡
(
uİ
, &
İ
, 1)) )

1297  -
EFAULT
;

1300 
	}
}

1303 
gÁb_qu”y_size
(

1304 
	$XEN_GUEST_HANDLE
(
gÁb_qu”y_size_t
è
uİ
, 
couÁ
)

1306 
gÁb_qu”y_size
 
İ
;

1307 
domaš
 *
d
;

1308 
domid_t
 
dom
;

1309 
rc
;

1311 iàĞ
couÁ
 != 1 )

1312  -
EINVAL
;

1314 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
İ
, 
uİ
, 1) != 0) )

1316 
	`gd´štk
(
XENLOG_INFO
, "Fault while„eading gnttab_query_size_t.\n");

1317  -
EFAULT
;

1320 
dom
 = 
İ
.dom;

1321 iàĞ
dom
 =ğ
DOMID_SELF
 )

1323 
d
 = 
	`rcu_lock_cu¼’t_domaš
();

1327 iàĞ
	`uÆik–y
((
d
 = 
	`rcu_lock_domaš_by_id
(
dom
)è=ğ
NULL
) )

1329 
	`gd´štk
(
XENLOG_INFO
, "Bad domid %d.\n", 
dom
);

1330 
İ
.
¡©us
 = 
GNTST_bad_domaš
;

1331 
qu”y_out
;

1334 iàĞ
	`uÆik–y
(!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
)) )

1336 
İ
.
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

1337 
qu”y_out_uÆock
;

1341 
rc
 = 
	`xsm_g¿Á_qu”y_size
(
cu¼’t
->
domaš
, 
d
);

1342 iàĞ
rc
 )

1344 
İ
.
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

1345 
qu”y_out_uÆock
;

1348 
	`¥š_lock
(&
d
->
g¿Á_bË
->
lock
);

1350 
İ
.
Ä_äames
 = 
	`Ä_g¿Á_äames
(
d
->
g¿Á_bË
);

1351 
İ
.
max_Ä_äames
 = 
max_Ä_g¿Á_äames
;

1352 
İ
.
¡©us
 = 
GNTST_okay
;

1354 
	`¥š_uÆock
(&
d
->
g¿Á_bË
->
lock
);

1357 
qu”y_out_uÆock
:

1358 
	`rcu_uÆock_domaš
(
d
);

1360 
qu”y_out
:

1361 iàĞ
	`uÆik–y
(
	`cİy_to_gue¡
(
uİ
, &
İ
, 1)) )

1362  -
EFAULT
;

1365 
	}
}

1372 
	$gÁb_´•¬e_fÜ_Œªsãr
(

1373 
domaš
 *
rd
, domaš *
ld
, 
g¿Á_»f_t
 
»f
)

1375 
g¿Á_bË
 *
rgt
;

1376 
g¿Á_’Œy_h—d”_t
 *
sha
;

1377 
g¿Á_combo
 
scombo
, 
´ev_scombo
, 
Ãw_scombo
;

1378 
»Œ›s
 = 0;

1380 iàĞ
	`uÆik–y
((
rgt
 = 
rd
->
g¿Á_bË
è=ğ
NULL
) )

1382 
	`gd´štk
(
XENLOG_INFO
, "Dom %d ha nØg¿ÁabË.\n", 
rd
->
domaš_id
);

1386 
	`¥š_lock
(&
rgt
->
lock
);

1388 iàĞ
rgt
->
gt_v”siÚ
 == 0 )

1390 
	`gd´štk
(
XENLOG_INFO
,

1392 
rd
->
domaš_id
);

1393 
ç
;

1396 iàĞ
	`uÆik–y
(
»f
 >ğ
	`Ä_g¿Á_’Œ›s
(
rd
->
g¿Á_bË
)) )

1398 
	`gd´štk
(
XENLOG_INFO
,

1400 
»f
, 
rd
->
domaš_id
);

1401 
ç
;

1404 
sha
 = 
	`sh¬ed_’Œy_h—d”
(
rgt
, 
»f
);

1406 
scombo
.
wÜd
 = *(
u32
 *)&
sha
->
æags
;

1410 iàĞ
	`uÆik–y
(
scombo
.
shÜts
.
æags
 !ğ
GTF_acû±_Œªsãr
) ||

1411 
	`uÆik–y
(
scombo
.
shÜts
.
domid
 !ğ
ld
->
domaš_id
) )

1413 
	`gd´štk
(
XENLOG_INFO
, "Bad flags (%x) or dom (%d). "

1415 
scombo
.
shÜts
.
æags
, scombo.shÜts.
domid
,

1416 
ld
->
domaš_id
);

1417 
ç
;

1420 
Ãw_scombo
 = 
scombo
;

1421 
Ãw_scombo
.
shÜts
.
æags
 |ğ
GTF_Œªsãr_comm™‹d
;

1423 
´ev_scombo
.
wÜd
 = 
	`cmpxchg
((
u32
 *)&
sha
->
æags
,

1424 
scombo
.
wÜd
, 
Ãw_scombo
.word);

1425 iàĞ
	`lik–y
(
´ev_scombo
.
wÜd
 =ğ
scombo
.word) )

1428 iàĞ
»Œ›s
++ == 4 )

1430 
	`gd´štk
(
XENLOG_WARNING
, "Shared grantƒntry is unstable.\n");

1431 
ç
;

1434 
scombo
 = 
´ev_scombo
;

1437 
	`¥š_uÆock
(&
rgt
->
lock
);

1440 
ç
:

1441 
	`¥š_uÆock
(&
rgt
->
lock
);

1443 
	}
}

1446 
gÁb_Œªsãr
(

1447 
	$XEN_GUEST_HANDLE
(
gÁb_Œªsãr_t
è
uİ
, 
couÁ
)

1449 
domaš
 *
d
 = 
cu¼’t
->domain;

1450 
domaš
 *
e
;

1451 
·ge_šfo
 *
·ge
;

1452 
i
;

1453 
gÁb_Œªsãr
 
gİ
;

1454 
mâ
;

1455 
max_b™size
;

1457  
i
 = 0; i < 
couÁ
; i++ )

1459 ià(
i
 && 
	`hy³rÿÎ_´“m±_check
())

1460  
i
;

1463 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
gİ
, 
uİ
, 
i
, 1)) )

1465 
	`gd´štk
(
XENLOG_INFO
, "gnttab_transfer:ƒrror„eading„eq %d/%d\n",

1466 
i
, 
couÁ
);

1467  -
EFAULT
;

1470 
mâ
 = 
	`gâ_to_mâ_´iv©e
(
d
, 
gİ
.mfn);

1473 iàĞ
	`uÆik–y
(!
	`mâ_v®id
(
mâ
)) )

1475 
	`gd´štk
(
XENLOG_INFO
, "gnttab_transfer: out-of-range %lx\n",

1476 ()
gİ
.
mâ
);

1477 
gİ
.
¡©us
 = 
GNTST_bad_·ge
;

1478 
cİyback
;

1481 
·ge
 = 
	`mâ_to_·ge
(
mâ
);

1482 iàĞ
	`uÆik–y
(
	`is_x’_h—p_·ge
(
·ge
)) )

1484 
	`gd´štk
(
XENLOG_INFO
, "gnttab_transfer: xen frame %lx\n",

1485 ()
gİ
.
mâ
);

1486 
gİ
.
¡©us
 = 
GNTST_bad_·ge
;

1487 
cİyback
;

1490 iàĞ
	`¡—l_·ge
(
d
, 
·ge
, 0) < 0 )

1492 
gİ
.
¡©us
 = 
GNTST_bad_·ge
;

1493 
cİyback
;

1496 #iâdeà
__Ÿ64__


1497 
	`gue¡_physm­_»move_·ge
(
d
, 
gİ
.
mâ
, mfn, 0);

1499 
	`æush_b_mask
(&
d
->
domaš_dœty_ıumask
);

1502 iàĞ
	`uÆik–y
((
e
 = 
	`rcu_lock_domaš_by_id
(
gİ
.
domid
)è=ğ
NULL
) )

1504 
	`gd´štk
(
XENLOG_INFO
, "gnttab_transfer: can't find domain %d\n",

1505 
gİ
.
domid
);

1506 
·ge
->
couÁ_šfo
 &ğ~(
PGC_couÁ_mask
|
PGC_®loÿ‹d
);

1507 
	`ä“_domh—p_·ge
(
·ge
);

1508 
gİ
.
¡©us
 = 
GNTST_bad_domaš
;

1509 
cİyback
;

1512 iàĞ
	`xsm_g¿Á_Œªsãr
(
d
, 
e
) )

1514 
gİ
.
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

1515 
uÆock_ªd_cİyback
:

1516 
	`rcu_uÆock_domaš
(
e
);

1517 
·ge
->
couÁ_šfo
 &ğ~(
PGC_couÁ_mask
|
PGC_®loÿ‹d
);

1518 
	`ä“_domh—p_·ge
(
·ge
);

1519 
cİyback
;

1522 
max_b™size
 = 
	`domaš_şamp_®loc_b™size
(

1523 
e
, 
BITS_PER_LONG
+
PAGE_SHIFT
-1);

1524 iàĞ(1UL << (
max_b™size
 - 
PAGE_SHIFT
)è<ğ
mâ
 )

1526 
·ge_šfo
 *
Ãw_·ge
;

1527 *
¥
, *
dp
;

1529 
Ãw_·ge
 = 
	`®loc_domh—p_·ge
(
NULL
, 
	`MEMF_b™s
(
max_b™size
));

1530 iàĞ
Ãw_·ge
 =ğ
NULL
 )

1532 
gİ
.
¡©us
 = 
GNTST_add»ss_too_big
;

1533 
uÆock_ªd_cİyback
;

1536 
¥
 = 
	`m­_domaš_·ge
(
mâ
);

1537 
dp
 = 
	`__m­_domaš_·ge
(
Ãw_·ge
);

1538 
	`memıy
(
dp
, 
¥
, 
PAGE_SIZE
);

1539 
	`unm­_domaš_·ge
(
dp
);

1540 
	`unm­_domaš_·ge
(
¥
);

1542 
·ge
->
couÁ_šfo
 &ğ~(
PGC_couÁ_mask
|
PGC_®loÿ‹d
);

1543 
	`ä“_domh—p_·ge
(
·ge
);

1544 
·ge
 = 
Ãw_·ge
;

1547 
	`¥š_lock
(&
e
->
·ge_®loc_lock
);

1554 iàĞ
	`uÆik–y
(
e
->
is_dyšg
) ||

1555 
	`uÆik–y
(
e
->
tÙ_·ges
 >ğe->
max_·ges
) ||

1556 
	`uÆik–y
(!
	`gÁb_´•¬e_fÜ_Œªsãr
(
e
, 
d
, 
gİ
.
»f
)) )

1558 iàĞ!
e
->
is_dyšg
 )

1559 
	`gd´štk
(
XENLOG_INFO
, "gnttab_transfer: "

1563 
e
->
tÙ_·ges
,ƒ->
max_·ges
, 
gİ
.
»f
,ƒ->
is_dyšg
);

1564 
	`¥š_uÆock
(&
e
->
·ge_®loc_lock
);

1565 
	`rcu_uÆock_domaš
(
e
);

1566 
·ge
->
couÁ_šfo
 &ğ~(
PGC_couÁ_mask
|
PGC_®loÿ‹d
);

1567 
	`ä“_domh—p_·ge
(
·ge
);

1568 
gİ
.
¡©us
 = 
GNTST_g’”®_”rÜ
;

1569 
cİyback
;

1573 iàĞ
	`uÆik–y
(
e
->
tÙ_·ges
++ == 0) )

1574 
	`g‘_knowÇlive_domaš
(
e
);

1575 
	`·ge_li¡_add_
(
·ge
, &
e
->
·ge_li¡
);

1576 
	`·ge_£t_owÃr
(
·ge
, 
e
);

1578 
	`¥š_uÆock
(&
e
->
·ge_®loc_lock
);

1580 
	`TRACE_1D
(
TRC_MEM_PAGE_GRANT_TRANSFER
, 
e
->
domaš_id
);

1583 
	`¥š_lock
(&
e
->
g¿Á_bË
->
lock
);

1585 iàĞ
e
->
g¿Á_bË
->
gt_v”siÚ
 == 1 )

1587 
g¿Á_’Œy_v1_t
 *
sha
 = &
	`sh¬ed_’Œy_v1
(
e
->
g¿Á_bË
, 
gİ
.
»f
);

1588 
	`gue¡_physm­_add_·ge
(
e
, 
sha
->
äame
, 
mâ
, 0);

1589 
sha
->
äame
 = 
mâ
;

1593 
g¿Á_’Œy_v2_t
 *
sha
 = &
	`sh¬ed_’Œy_v2
(
e
->
g¿Á_bË
, 
gİ
.
»f
);

1594 
	`gue¡_physm­_add_·ge
(
e
, 
sha
->
fuÎ_·ge
.
äame
, 
mâ
, 0);

1595 
sha
->
fuÎ_·ge
.
äame
 = 
mâ
;

1597 
	`wmb
();

1598 
	`sh¬ed_’Œy_h—d”
(
e
->
g¿Á_bË
, 
gİ
.
»f
)->
æags
 |=

1599 
GTF_Œªsãr_com¶‘ed
;

1601 
	`¥š_uÆock
(&
e
->
g¿Á_bË
->
lock
);

1603 
	`rcu_uÆock_domaš
(
e
);

1605 
gİ
.
¡©us
 = 
GNTST_okay
;

1607 
cİyback
:

1608 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
uİ
, 
i
, &
gİ
, 1)) )

1610 
	`gd´štk
(
XENLOG_INFO
, "gnttab_transfer:ƒrror writing„esp "

1611 "%d/%d\n", 
i
, 
couÁ
);

1612  -
EFAULT
;

1617 
	}
}

1622 
	$__»Ëa£_g¿Á_fÜ_cİy
(

1623 
domaš
 *
rd
, 
g»f
, 
»adÚly
)

1625 
g¿Á_’Œy_h—d”_t
 *
sha
;

1626 
aùive_g¿Á_’Œy
 *
aù
;

1627 
r_äame
;

1628 
ušt16_t
 *
¡©us
;

1629 
domid_t
 
Œªs_domid
;

1630 
g¿Á_»f_t
 
Œªs_g»f
;

1631 
»Ëa£d_»ad
;

1632 
»Ëa£d_wr™e
;

1633 
domaš
 *
Œªs_dom
;

1635 
»Ëa£d_»ad
 = 0;

1636 
»Ëa£d_wr™e
 = 0;

1638 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

1640 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
g»f
);

1641 
sha
 = 
	`sh¬ed_’Œy_h—d”
(
rd
->
g¿Á_bË
, 
g»f
);

1642 
r_äame
 = 
aù
->
äame
;

1644 ià(
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 1)

1646 
¡©us
 = &
sha
->
æags
;

1647 
Œªs_domid
 = 
rd
->
domaš_id
;

1650 
Œªs_g»f
 = 0x1234567;

1654 
¡©us
 = &
	`¡©us_’Œy
(
rd
->
g¿Á_bË
, 
g»f
);

1655 
Œªs_domid
 = 
aù
->
Œªs_dom
;

1656 
Œªs_g»f
 = 
aù
->trans_gref;

1659 iàĞ
»adÚly
 )

1661 
aù
->
pš
 -ğ
GNTPIN_h¡r_šc
;

1665 
	`gÁb_m¬k_dœty
(
rd
, 
r_äame
);

1667 
aù
->
pš
 -ğ
GNTPIN_h¡w_šc
;

1668 iàĞ!(
aù
->
pš
 & (
GNTPIN_devw_mask
|
GNTPIN_h¡w_mask
)) )

1670 
»Ëa£d_wr™e
 = 1;

1671 
	`gÁb_ş—r_æag
(
_GTF_wr™šg
, 
¡©us
);

1675 iàĞ!
aù
->
pš
 )

1677 
	`gÁb_ş—r_æag
(
_GTF_»adšg
, 
¡©us
);

1678 
»Ëa£d_»ad
 = 1;

1681 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

1683 iàĞ
Œªs_domid
 !ğ
rd
->
domaš_id
 )

1685 iàĞ
»Ëa£d_wr™e
 || 
»Ëa£d_»ad
 )

1687 
Œªs_dom
 = 
	`rcu_lock_domaš_by_id
(
Œªs_domid
);

1688 iàĞ
Œªs_dom
 !ğ
NULL
 )

1692 iàĞ
»Ëa£d_wr™e
 )

1693 
	`__»Ëa£_g¿Á_fÜ_cİy
(
Œªs_dom
, 
Œªs_g»f
, 0);

1694 iàĞ
»Ëa£d_»ad
 )

1695 
	`__»Ëa£_g¿Á_fÜ_cİy
(
Œªs_dom
, 
Œªs_g»f
, 1);

1699 
	}
}

1706 
	$__fixup_¡©us_fÜ_pš
(
aùive_g¿Á_’Œy
 *
aù
,

1707 
ušt16_t
 *
¡©us
)

1709 iàĞ!(
aù
->
pš
 & 
GNTPIN_h¡w_mask
) )

1710 *
¡©us
 &ğ~
_GTF_wr™šg
;

1712 iàĞ!(
aù
->
pš
 & 
GNTPIN_h¡r_mask
) )

1713 *
¡©us
 &ğ~
_GTF_»adšg
;

1714 
	}
}

1721 
	$__acquœe_g¿Á_fÜ_cİy
(

1722 
domaš
 *
rd
, 
g»f
, domaš *
ld
, 
»adÚly
,

1723 *
äame
, *
·ge_off
, *
Ëngth
,

1724 
®low_Œªs™ive
, 
domaš
 **
ownšg_domaš
)

1726 
g¿Á_’Œy_v1_t
 *
sha1
;

1727 
g¿Á_’Œy_v2_t
 *
sha2
;

1728 
g¿Á_’Œy_h—d”_t
 *
shah
;

1729 
aùive_g¿Á_’Œy
 *
aù
;

1730 
g¿Á_¡©us_t
 *
¡©us
;

1731 
ušt32_t
 
Şd_pš
;

1732 
domid_t
 
Œªs_domid
;

1733 
g¿Á_»f_t
 
Œªs_g»f
;

1734 
domaš
 *
¼d
;

1735 
gâ
;

1736 
g¿Á_äame
;

1737 
Œªs_·ge_off
;

1738 
Œªs_Ëngth
;

1739 
is_sub_·ge
;

1740 
domaš
 *
ignÜe
;

1741 
s16
 
rc
 = 
GNTST_okay
;

1743 *
ownšg_domaš
 = 
NULL
;

1745 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

1747 iàĞ
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 0 )

1748 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

1751 iàĞ
	`uÆik–y
(
g»f
 >ğ
	`Ä_g¿Á_’Œ›s
(
rd
->
g¿Á_bË
)) )

1752 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_bad_gÁ»f
,

1753 "Bad g¿Á„eã»nû %ld\n", 
g»f
);

1755 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
g»f
);

1756 
shah
 = 
	`sh¬ed_’Œy_h—d”
(
rd
->
g¿Á_bË
, 
g»f
);

1757 iàĞ
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 1 )

1759 
sha1
 = &
	`sh¬ed_’Œy_v1
(
rd
->
g¿Á_bË
, 
g»f
);

1760 
sha2
 = 
NULL
;

1761 
¡©us
 = &
shah
->
æags
;

1765 
sha1
 = 
NULL
;

1766 
sha2
 = &
	`sh¬ed_’Œy_v2
(
rd
->
g¿Á_bË
, 
g»f
);

1767 
¡©us
 = &
	`¡©us_’Œy
(
rd
->
g¿Á_bË
, 
g»f
);

1771 iàĞ
aù
->
pš
 &&

1772 ((
aù
->
domid
 !ğ
ld
->
domaš_id
) ||

1773 (
aù
->
pš
 & 0x80808080U) != 0) )

1774 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

1776 
aù
->
domid
, 
ld
->
domaš_id
,‡ù->
pš
);

1778 
Şd_pš
 = 
aù
->
pš
;

1779 iàĞ!
aù
->
pš
 ||

1780 (!
»adÚly
 && !(
aù
->
pš
 & (
GNTPIN_devw_mask
|
GNTPIN_h¡w_mask
))) )

1782 iàĞ(
rc
 = 
	`_£t_¡©us
(
rd
->
g¿Á_bË
->
gt_v”siÚ
,

1783 
ld
->
domaš_id
,

1784 
»adÚly
, 0, 
shah
, 
aù
,

1785 
¡©us
èè!ğ
GNTST_okay
 )

1786 
uÆock_out
;

1788 
Œªs_domid
 = 
ld
->
domaš_id
;

1789 
Œªs_g»f
 = 0;

1790 iàĞ
sha2
 && (
shah
->
æags
 & 
GTF_ty³_mask
è=ğ
GTF_Œªs™ive
 )

1792 iàĞ!
®low_Œªs™ive
 )

1793 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

1796 
Œªs_domid
 = 
sha2
->
Œªs™ive
.trans_domid;

1797 
Œªs_g»f
 = 
sha2
->
Œªs™ive
.
g»f
;

1798 
	`b¬r›r
();

1800 iàĞ
Œªs_domid
 =ğ
rd
->
domaš_id
 )

1801 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

1811 
¼d
 = 
	`rcu_lock_domaš_by_id
(
Œªs_domid
);

1812 iàĞ
¼d
 =ğ
NULL
 )

1813 
	`PIN_FAIL
(
uÆock_out
, 
GNTST_g’”®_”rÜ
,

1815 
Œªs_domid
);

1816 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

1818 
rc
 = 
	`__acquœe_g¿Á_fÜ_cİy
(
¼d
, 
Œªs_g»f
, 
rd
,

1819 
»adÚly
, &
g¿Á_äame
,

1820 &
Œªs_·ge_off
, &
Œªs_Ëngth
,

1821 0, &
ignÜe
);

1823 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

1824 iàĞ
rc
 !ğ
GNTST_okay
 ) {

1825 
	`__fixup_¡©us_fÜ_pš
(
aù
, 
¡©us
);

1826 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

1827  
rc
;

1834 iàĞ
aù
->
pš
 !ğ
Şd_pš
 )

1836 
	`__fixup_¡©us_fÜ_pš
(
aù
, 
¡©us
);

1837 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

1838  
	`__acquœe_g¿Á_fÜ_cİy
(
rd
, 
g»f
, 
ld
, 
»adÚly
,

1839 
äame
, 
·ge_off
, 
Ëngth
,

1840 
®low_Œªs™ive
,

1841 
ownšg_domaš
);

1847 
is_sub_·ge
 = 1;

1848 *
ownšg_domaš
 = 
¼d
;

1849 
aù
->
gâ
 = -1ul;

1851 iàĞ
sha1
 )

1853 
gâ
 = 
sha1
->
äame
;

1854 
rc
 = 
	`__g‘_·ged_äame
(
gâ
, &
g¿Á_äame
, 
»adÚly
, 
rd
);

1855 iàĞ
rc
 !ğ
GNTST_okay
 )

1856 
uÆock_out
;

1857 
aù
->
gâ
 = gfn;

1858 
is_sub_·ge
 = 0;

1859 
Œªs_·ge_off
 = 0;

1860 
Œªs_Ëngth
 = 
PAGE_SIZE
;

1861 *
ownšg_domaš
 = 
rd
;

1863 iàĞ!(
sha2
->
hdr
.
æags
 & 
GTF_sub_·ge
) )

1865 
gâ
 = 
sha2
->
fuÎ_·ge
.
äame
;

1866 
rc
 = 
	`__g‘_·ged_äame
(
gâ
, &
g¿Á_äame
, 
»adÚly
, 
rd
);

1867 iàĞ
rc
 !ğ
GNTST_okay
 )

1868 
uÆock_out
;

1869 
aù
->
gâ
 = gfn;

1870 
is_sub_·ge
 = 0;

1871 
Œªs_·ge_off
 = 0;

1872 
Œªs_Ëngth
 = 
PAGE_SIZE
;

1873 *
ownšg_domaš
 = 
rd
;

1877 
gâ
 = 
sha2
->
sub_·ge
.
äame
;

1878 
rc
 = 
	`__g‘_·ged_äame
(
gâ
, &
g¿Á_äame
, 
»adÚly
, 
rd
);

1879 iàĞ
rc
 !ğ
GNTST_okay
 )

1880 
uÆock_out
;

1881 
aù
->
gâ
 = gfn;

1882 
is_sub_·ge
 = 1;

1883 
Œªs_·ge_off
 = 
sha2
->
sub_·ge
.
·ge_off
;

1884 
Œªs_Ëngth
 = 
sha2
->
sub_·ge
.
Ëngth
;

1885 *
ownšg_domaš
 = 
rd
;

1888 iàĞ!
aù
->
pš
 )

1890 
aù
->
domid
 = 
ld
->
domaš_id
;

1891 
aù
->
is_sub_·ge
 = is_sub_page;

1892 
aù
->
¡¬t
 = 
Œªs_·ge_off
;

1893 
aù
->
Ëngth
 = 
Œªs_Ëngth
;

1894 
aù
->
Œªs_dom
 = 
Œªs_domid
;

1895 
aù
->
Œªs_g»f
 =rans_gref;

1896 
aù
->
äame
 = 
g¿Á_äame
;

1901 *
ownšg_domaš
 = 
rd
;

1904 
aù
->
pš
 +ğ
»adÚly
 ? 
GNTPIN_h¡r_šc
 : 
GNTPIN_h¡w_šc
;

1906 *
·ge_off
 = 
aù
->
¡¬t
;

1907 *
Ëngth
 = 
aù
->length;

1908 *
äame
 = 
aù
->frame;

1910 
uÆock_out
:

1911 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

1912  
rc
;

1913 
	}
}

1916 
	$__gÁb_cİy
(

1917 
gÁb_cİy
 *
İ
)

1919 
domaš
 *
sd
 = 
NULL
, *
dd
 = NULL;

1920 
domaš
 *
sourû_domaš
 = 
NULL
, *
de¡_domaš
 = NULL;

1921 
s_äame
, 
d_äame
;

1922 *
¥
, *
dp
;

1923 
s16
 
rc
 = 
GNTST_okay
;

1924 
have_d_g¿Á
 = 0, 
have_s_g¿Á
 = 0, 
have_s_»f
 = 0;

1925 
¤c_is_g»f
, 
de¡_is_g»f
;

1927 iàĞ((
İ
->
sourû
.
off£t
 + op->
Ën
è> 
PAGE_SIZE
) ||

1928 ((
İ
->
de¡
.
off£t
 + op->
Ën
è> 
PAGE_SIZE
) )

1929 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_bad_cİy_¬g
, "copy beyond…age‡rea.\n");

1931 
¤c_is_g»f
 = 
İ
->
æags
 & 
GNTCOPY_sourû_g»f
;

1932 
de¡_is_g»f
 = 
İ
->
æags
 & 
GNTCOPY_de¡_g»f
;

1934 iàĞ(
İ
->
sourû
.
domid
 !ğ
DOMID_SELF
 && !
¤c_is_g»f
 ) ||

1935 (
İ
->
de¡
.
domid
 !ğ
DOMID_SELF
 && !
de¡_is_g»f
) )

1936 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_³rmissiÚ_d’›d
,

1939 iàĞ
İ
->
sourû
.
domid
 =ğ
DOMID_SELF
 )

1940 
sd
 = 
	`rcu_lock_cu¼’t_domaš
();

1941 iàĞ(
sd
 = 
	`rcu_lock_domaš_by_id
(
İ
->
sourû
.
domid
)è=ğ
NULL
 )

1942 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_bad_domaš
,

1943 "couldn'ˆfšd %d\n", 
İ
->
sourû
.
domid
);

1945 iàĞ
İ
->
de¡
.
domid
 =ğ
DOMID_SELF
 )

1946 
dd
 = 
	`rcu_lock_cu¼’t_domaš
();

1947 iàĞ(
dd
 = 
	`rcu_lock_domaš_by_id
(
İ
->
de¡
.
domid
)è=ğ
NULL
 )

1948 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_bad_domaš
,

1949 "couldn'ˆfšd %d\n", 
İ
->
de¡
.
domid
);

1951 
rc
 = 
	`xsm_g¿Á_cİy
(
sd
, 
dd
);

1952 iàĞ
rc
 )

1954 
rc
 = 
GNTST_³rmissiÚ_d’›d
;

1955 
”rÜ_out
;

1958 iàĞ
¤c_is_g»f
 )

1960 
sourû_off
, 
sourû_Ën
;

1961 
rc
 = 
	`__acquœe_g¿Á_fÜ_cİy
(
sd
, 
İ
->
sourû
.
u
.
»f
, 
cu¼’t
->
domaš
, 1,

1962 &
s_äame
, &
sourû_off
, &
sourû_Ën
, 1,

1963 &
sourû_domaš
);

1964 iàĞ
rc
 !ğ
GNTST_okay
 )

1965 
”rÜ_out
;

1966 
have_s_g¿Á
 = 1;

1967 iàĞ
İ
->
sourû
.
off£t
 < 
sourû_off
 ||

1968 
İ
->
Ën
 > 
sourû_Ën
 )

1969 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_g’”®_”rÜ
,

1971 
İ
->
sourû
.
off£t
, 
sourû_off
,

1972 
İ
->
Ën
, 
sourû_Ën
);

1976 #ifdeà
CONFIG_X86


1977 
rc
 = 
	`__g‘_·ged_äame
(
İ
->
sourû
.
u
.
gmâ
, &
s_äame
, 1, 
sd
);

1978 iàĞ
rc
 !ğ
GNTST_okay
 )

1979 
”rÜ_out
;

1981 
s_äame
 = 
	`gmâ_to_mâ
(
sd
, 
İ
->
sourû
.
u
.
gmâ
);

1983 
sourû_domaš
 = 
sd
;

1985 iàĞ
	`uÆik–y
(!
	`mâ_v®id
(
s_äame
)) )

1986 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_g’”®_”rÜ
,

1987 "sourû f¿m%lx inv®id.\n", 
s_äame
);

1988 iàĞ!
	`g‘_·ge
(
	`mâ_to_·ge
(
s_äame
), 
sourû_domaš
) )

1990 iàĞ!
sd
->
is_dyšg
 )

1991 
	`gd´štk
(
XENLOG_WARNING
, "Could‚Ù g‘ srøäam%lx\n", 
s_äame
);

1992 
rc
 = 
GNTST_g’”®_”rÜ
;

1993 
”rÜ_out
;

1995 
have_s_»f
 = 1;

1997 iàĞ
de¡_is_g»f
 )

1999 
de¡_off
, 
de¡_Ën
;

2000 
rc
 = 
	`__acquœe_g¿Á_fÜ_cİy
(
dd
, 
İ
->
de¡
.
u
.
»f
, 
cu¼’t
->
domaš
, 0,

2001 &
d_äame
, &
de¡_off
, &
de¡_Ën
, 1,

2002 &
de¡_domaš
);

2003 iàĞ
rc
 !ğ
GNTST_okay
 )

2004 
”rÜ_out
;

2005 
have_d_g¿Á
 = 1;

2006 iàĞ
İ
->
de¡
.
off£t
 < 
de¡_off
 ||

2007 
İ
->
Ën
 > 
de¡_Ën
 )

2008 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_g’”®_”rÜ
,

2010 
İ
->
de¡
.
off£t
, 
de¡_off
,

2011 
İ
->
Ën
, 
de¡_Ën
);

2015 #ifdeà
CONFIG_X86


2016 
rc
 = 
	`__g‘_·ged_äame
(
İ
->
de¡
.
u
.
gmâ
, &
d_äame
, 0, 
dd
);

2017 iàĞ
rc
 !ğ
GNTST_okay
 )

2018 
”rÜ_out
;

2020 
d_äame
 = 
	`gmâ_to_mâ
(
dd
, 
İ
->
de¡
.
u
.
gmâ
);

2022 
de¡_domaš
 = 
dd
;

2024 iàĞ
	`uÆik–y
(!
	`mâ_v®id
(
d_äame
)) )

2025 
	`PIN_FAIL
(
”rÜ_out
, 
GNTST_g’”®_”rÜ
,

2026 "de¡š©iÚ f¿m%lx inv®id.\n", 
d_äame
);

2027 iàĞ!
	`g‘_·ge_ªd_ty³
(
	`mâ_to_·ge
(
d_äame
), 
de¡_domaš
,

2028 
PGT_wr™abË_·ge
) )

2030 iàĞ!
dd
->
is_dyšg
 )

2031 
	`gd´štk
(
XENLOG_WARNING
, "Could‚Ù g‘ d¡ f¿m%lx\n", 
d_äame
);

2032 
rc
 = 
GNTST_g’”®_”rÜ
;

2033 
”rÜ_out
;

2036 
¥
 = 
	`m­_domaš_·ge
(
s_äame
);

2037 
dp
 = 
	`m­_domaš_·ge
(
d_äame
);

2039 
	`memıy
(
dp
 + 
İ
->
de¡
.
off£t
, 
¥
 + op->
sourû
.off£t, op->
Ën
);

2041 
	`unm­_domaš_·ge
(
dp
);

2042 
	`unm­_domaš_·ge
(
¥
);

2044 
	`gÁb_m¬k_dœty
(
dd
, 
d_äame
);

2046 
	`put_·ge_ªd_ty³
(
	`mâ_to_·ge
(
d_äame
));

2047 
”rÜ_out
:

2048 iàĞ
have_s_»f
 )

2049 
	`put_·ge
(
	`mâ_to_·ge
(
s_äame
));

2050 iàĞ
have_s_g¿Á
 )

2051 
	`__»Ëa£_g¿Á_fÜ_cİy
(
sd
, 
İ
->
sourû
.
u
.
»f
, 1);

2052 iàĞ
have_d_g¿Á
 )

2053 
	`__»Ëa£_g¿Á_fÜ_cİy
(
dd
, 
İ
->
de¡
.
u
.
»f
, 0);

2054 iàĞ
sd
 )

2055 
	`rcu_uÆock_domaš
(
sd
);

2056 iàĞ
dd
 )

2057 
	`rcu_uÆock_domaš
(
dd
);

2058 
İ
->
¡©us
 = 
rc
;

2059 
	}
}

2062 
gÁb_cİy
(

2063 
	$XEN_GUEST_HANDLE
(
gÁb_cİy_t
è
uİ
, 
couÁ
)

2065 
i
;

2066 
gÁb_cİy
 
İ
;

2068  
i
 = 0; i < 
couÁ
; i++ )

2070 ià(
i
 && 
	`hy³rÿÎ_´“m±_check
())

2071  
i
;

2072 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
İ
, 
uİ
, 
i
, 1)) )

2073  -
EFAULT
;

2074 
	`__gÁb_cİy
(&
İ
);

2075 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
uİ
, 
i
, &
İ
, 1)) )

2076  -
EFAULT
;

2079 
	}
}

2082 
gÁb_£t_v”siÚ
(
	$XEN_GUEST_HANDLE
(
gÁb_£t_v”siÚ_t
 
uİ
))

2084 
gÁb_£t_v”siÚ_t
 
İ
;

2085 
domaš
 *
d
 = 
cu¼’t
->domain;

2086 
g¿Á_bË
 *
gt
 = 
d
->grant_table;

2087 
aùive_g¿Á_’Œy
 *
aù
;

2088 
»s
;

2089 
i
;

2091 ià(
	`cİy_äom_gue¡
(&
İ
, 
uİ
, 1))

2092  -
EFAULT
;

2094 
»s
 = -
EINVAL
;

2095 ià(
İ
.
v”siÚ
 != 1 && op.version != 2)

2096 
out
;

2098 
»s
 = 0;

2099 iàĞ
gt
->
gt_v”siÚ
 =ğ
İ
.
v”siÚ
 )

2100 
out
;

2102 
	`¥š_lock
(&
gt
->
lock
);

2106 iàĞ
gt
->
gt_v”siÚ
 != 0 )

2108  
i
 = 0; i < 
	`Ä_g¿Á_’Œ›s
(
gt
); i++ )

2110 
aù
 = &
	`aùive_’Œy
(
gt
, 
i
);

2111 iàĞ
aù
->
pš
 != 0 )

2113 
	`gd´štk
(
XENLOG_WARNING
,

2115 
gt
->
gt_v”siÚ
,

2116 
İ
.
v”siÚ
);

2117 
»s
 = -
EBUSY
;

2118 
out_uÆock
;

2126 iàĞ
İ
.
v”siÚ
 =ğ2 && 
gt
->
gt_v”siÚ
 < 2 )

2128 
»s
 = 
	`gÁb_pİuÏ‹_¡©us_äames
(
d
, 
gt
);

2129 iàĞ
»s
 < 0)

2130 
out_uÆock
;

2133 iàĞ
İ
.
v”siÚ
 < 2 && 
gt
->
gt_v”siÚ
 == 2 )

2134 
	`gÁb_uÅİuÏ‹_¡©us_äames
(
d
, 
gt
);

2136 iàĞ
İ
.
v”siÚ
 !ğ
gt
->
gt_v”siÚ
 )

2140  
i
 = 0; i < 
	`Ä_g¿Á_äames
(
gt
); i++ )

2141 
	`mem£t
(
gt
->
sh¬ed_¿w
[
i
], 0, 
PAGE_SIZE
);

2144 
gt
->
gt_v”siÚ
 = 
İ
.
v”siÚ
;

2146 
out_uÆock
:

2147 
	`¥š_uÆock
(&
gt
->
lock
);

2149 
out
:

2150 
İ
.
v”siÚ
 = 
gt
->
gt_v”siÚ
;

2152 ià(
	`cİy_to_gue¡
(
uİ
, &
İ
, 1))

2153 
»s
 = -
EFAULT
;

2155  
»s
;

2156 
	}
}

2159 
gÁb_g‘_¡©us_äames
(
	$XEN_GUEST_HANDLE
(
gÁb_g‘_¡©us_äames_t
è
uİ
,

2160 
couÁ
)

2162 
gÁb_g‘_¡©us_äames_t
 
İ
;

2163 
domaš
 *
d
;

2164 
g¿Á_bË
 *
gt
;

2165 
ušt64_t
 
gmâ
;

2166 
i
;

2167 
rc
;

2169 iàĞ
couÁ
 != 1 )

2170  -
EINVAL
;

2172 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
İ
, 
uİ
, 1) != 0) )

2174 
	`gd´štk
(
XENLOG_INFO
,

2176  -
EFAULT
;

2179 
rc
 = 
	`rcu_lock_rg‘_domaš_by_id
(
İ
.
dom
, &
d
);

2180 iàĞ
rc
 < 0 )

2182 iàĞ
rc
 =ğ-
ESRCH
 )

2183 
İ
.
¡©us
 = 
GNTST_bad_domaš
;

2184 iàĞ
rc
 =ğ-
EPERM
 )

2185 
İ
.
¡©us
 = 
GNTST_³rmissiÚ_d’›d
;

2187 
İ
.
¡©us
 = 
GNTST_g’”®_”rÜ
;

2188 
out1
;

2191 
gt
 = 
d
->
g¿Á_bË
;

2193 iàĞ
	`uÆik–y
(
İ
.
Ä_äames
 > 
	`Ä_¡©us_äames
(
gt
)) ) {

2194 
	`gd´štk
(
XENLOG_INFO
, "Guest„equested‡ddresses for %d grant status "

2196 
İ
.
Ä_äames
, 
	`Ä_¡©us_äames
(
gt
));

2197 
İ
.
¡©us
 = 
GNTST_g’”®_”rÜ
;

2198 
out2
;

2201 
İ
.
¡©us
 = 
GNTST_okay
;

2203 
	`¥š_lock
(&
gt
->
lock
);

2205  
i
 = 0; i < 
İ
.
Ä_äames
; i++ )

2207 
gmâ
 = 
	`gÁb_¡©us_gmâ
(
d
, d->
g¿Á_bË
, 
i
);

2208 ià(
	`cİy_to_gue¡_off£t
(
İ
.
äame_li¡
,

2209 
i
,

2210 &
gmâ
,

2212 
İ
.
¡©us
 = 
GNTST_bad_vœt_addr
;

2215 
	`¥š_uÆock
(&
gt
->
lock
);

2216 
out2
:

2217 
	`rcu_uÆock_domaš
(
d
);

2218 
out1
:

2219 iàĞ
	`uÆik–y
(
	`cİy_to_gue¡
(
uİ
, &
İ
, 1)) )

2220  -
EFAULT
;

2223 
	}
}

2226 
gÁb_g‘_v”siÚ
(
	$XEN_GUEST_HANDLE
(
gÁb_g‘_v”siÚ_t
 
uİ
))

2228 
gÁb_g‘_v”siÚ_t
 
İ
;

2229 
domaš
 *
d
;

2231 iàĞ
	`cİy_äom_gue¡
(&
İ
, 
uİ
, 1) )

2232  -
EFAULT
;

2233 
d
 = 
	`rcu_lock_domaš_by_id
(
İ
.
dom
);

2234 iàĞ
d
 =ğ
NULL
 )

2235  -
ESRCH
;

2236 iàĞ!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
) )

2238 
	`rcu_uÆock_domaš
(
d
);

2239  -
EPERM
;

2241 
	`¥š_lock
(&
d
->
g¿Á_bË
->
lock
);

2242 
İ
.
v”siÚ
 = 
d
->
g¿Á_bË
->
gt_v”siÚ
;

2243 
	`¥š_uÆock
(&
d
->
g¿Á_bË
->
lock
);

2245 iàĞ
	`cİy_to_gue¡
(
uİ
, &
İ
, 1) )

2246  -
EFAULT
;

2249 
	}
}

2252 
do_g¿Á_bË_İ
(

2253 
cmd
, 
	$XEN_GUEST_HANDLE
(è
uİ
, 
couÁ
)

2255 
rc
;

2256 
domaš
 *
d
 = 
cu¼’t
->domain;

2258 iàĞ()
couÁ
 < 0 )

2259  -
EINVAL
;

2261 
	`domaš_lock
(
d
);

2263 
rc
 = -
EFAULT
;

2264  
cmd
 )

2266 
GNTTABOP_m­_g¿Á_»f
:

2268 
	`XEN_GUEST_HANDLE
(
gÁb_m­_g¿Á_»f_t
è
m­
 =

2269 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_m­_g¿Á_»f_t
);

2270 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
m­
, 
couÁ
)) )

2271 
out
;

2272 
rc
 = 
	`gÁb_m­_g¿Á_»f
(
m­
, 
couÁ
);

2273 iàĞ
rc
 > 0 )

2275 
	`gue¡_hªdË_add_off£t
(
m­
, 
rc
);

2276 
uİ
 = 
	`gue¡_hªdË_ÿ¡
(
m­
, );

2280 
GNTTABOP_unm­_g¿Á_»f
:

2282 
	`XEN_GUEST_HANDLE
(
gÁb_unm­_g¿Á_»f_t
è
unm­
 =

2283 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_unm­_g¿Á_»f_t
);

2284 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
unm­
, 
couÁ
)) )

2285 
out
;

2286 
rc
 = 
	`gÁb_unm­_g¿Á_»f
(
unm­
, 
couÁ
);

2287 iàĞ
rc
 > 0 )

2289 
	`gue¡_hªdË_add_off£t
(
unm­
, 
rc
);

2290 
uİ
 = 
	`gue¡_hªdË_ÿ¡
(
unm­
, );

2294 
GNTTABOP_unm­_ªd_»¶aû
:

2296 
	`XEN_GUEST_HANDLE
(
gÁb_unm­_ªd_»¶aû_t
è
unm­
 =

2297 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_unm­_ªd_»¶aû_t
);

2298 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
unm­
, 
couÁ
)) )

2299 
out
;

2300 
rc
 = -
ENOSYS
;

2301 iàĞ
	`uÆik–y
(!
	`»¶aû_g¿Á_suµÜ‹d
()) )

2302 
out
;

2303 
rc
 = 
	`gÁb_unm­_ªd_»¶aû
(
unm­
, 
couÁ
);

2304 iàĞ
rc
 > 0 )

2306 
	`gue¡_hªdË_add_off£t
(
unm­
, 
rc
);

2307 
uİ
 = 
	`gue¡_hªdË_ÿ¡
(
unm­
, );

2311 
GNTTABOP_£tup_bË
:

2313 
rc
 = 
	`gÁb_£tup_bË
(

2314 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_£tup_bË_t
), 
couÁ
);

2315 
	`ASSERT
(
rc
 <= 0);

2318 
GNTTABOP_Œªsãr
:

2320 
	`XEN_GUEST_HANDLE
(
gÁb_Œªsãr_t
è
Œªsãr
 =

2321 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_Œªsãr_t
);

2322 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
Œªsãr
, 
couÁ
)) )

2323 
out
;

2324 
rc
 = 
	`gÁb_Œªsãr
(
Œªsãr
, 
couÁ
);

2325 iàĞ
rc
 > 0 )

2327 
	`gue¡_hªdË_add_off£t
(
Œªsãr
, 
rc
);

2328 
uİ
 = 
	`gue¡_hªdË_ÿ¡
(
Œªsãr
, );

2332 
GNTTABOP_cİy
:

2334 
	`XEN_GUEST_HANDLE
(
gÁb_cİy_t
è
cİy
 =

2335 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_cİy_t
);

2336 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
cİy
, 
couÁ
)) )

2337 
out
;

2338 
rc
 = 
	`gÁb_cİy
(
cİy
, 
couÁ
);

2339 iàĞ
rc
 > 0 )

2341 
	`gue¡_hªdË_add_off£t
(
cİy
, 
rc
);

2342 
uİ
 = 
	`gue¡_hªdË_ÿ¡
(
cİy
, );

2346 
GNTTABOP_qu”y_size
:

2348 
rc
 = 
	`gÁb_qu”y_size
(

2349 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_qu”y_size_t
), 
couÁ
);

2350 
	`ASSERT
(
rc
 <= 0);

2353 
GNTTABOP_£t_v”siÚ
:

2355 
rc
 = 
	`gÁb_£t_v”siÚ
(
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_£t_v”siÚ_t
));

2358 
GNTTABOP_g‘_¡©us_äames
:

2360 
rc
 = 
	`gÁb_g‘_¡©us_äames
(

2361 
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_g‘_¡©us_äames_t
), 
couÁ
);

2364 
GNTTABOP_g‘_v”siÚ
:

2366 
rc
 = 
	`gÁb_g‘_v”siÚ
(
	`gue¡_hªdË_ÿ¡
(
uİ
, 
gÁb_g‘_v”siÚ_t
));

2370 
rc
 = -
ENOSYS
;

2374 
out
:

2375 
	`domaš_uÆock
(
d
);

2377 iàĞ
rc
 > 0 )

2379 
	`ASSERT
(
rc
 < 
couÁ
);

2380 
rc
 = 
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(
__HYPERVISOR_g¿Á_bË_İ
,

2381 "ihi", 
cmd
, 
uİ
, 
couÁ
 - 
rc
);

2384  
rc
;

2385 
	}
}

2387 #ifdeà
CONFIG_COMPAT


2388 
	~"com·t/g¿Á_bË.c
"

2391 
	$max_Ä_aùive_g¿Á_äames
()

2393  (((
max_Ä_g¿Á_äames
 * (
PAGE_SIZE
 / (
g¿Á_’Œy_v1_t
))) +

2394 ((
PAGE_SIZE
 / (
aùive_g¿Á_’Œy
))-1))

2395 / (
PAGE_SIZE
 / (
aùive_g¿Á_’Œy
)));

2396 
	}
}

2399 
	$g¿Á_bË_ü—‹
(

2400 
domaš
 *
d
)

2402 
g¿Á_bË
 *
t
;

2403 
i
;

2405 iàĞ(
t
 = 
	`xm®loc
(
g¿Á_bË
)è=ğ
NULL
 )

2406 
no_mem_0
;

2409 
	`mem£t
(
t
, 0, (*t));

2410 
	`¥š_lock_š™
(&
t
->
lock
);

2411 
t
->
Ä_g¿Á_äames
 = 
INITIAL_NR_GRANT_FRAMES
;

2414 iàĞ(
t
->
aùive
 = 
	`xm®loc_¬¿y
(
aùive_g¿Á_’Œy
 *,

2415 
	`max_Ä_aùive_g¿Á_äames
())è=ğ
NULL
 )

2416 
no_mem_1
;

2417 
	`mem£t
(
t
->
aùive
, 0, 
	`max_Ä_aùive_g¿Á_äames
() * (t->active[0]));

2418  
i
 = 0;

2419 
i
 < 
	`num_aù_äames_äom_sha_äames
(
INITIAL_NR_GRANT_FRAMES
); i++ )

2421 iàĞ(
t
->
aùive
[
i
] = 
	`®loc_x’h—p_·ge
()è=ğ
NULL
 )

2422 
no_mem_2
;

2423 
	`ş—r_·ge
(
t
->
aùive
[
i
]);

2427 iàĞ(
t
->
m­Œack
 = 
	`xm®loc_¬¿y
(
g¿Á_m­pšg
 *,

2428 
	`max_Ä_m­Œack_äames
())è=ğ
NULL
 )

2429 
no_mem_2
;

2430 
	`mem£t
(
t
->
m­Œack
, 0, 
	`max_Ä_m­Œack_äames
() * (t->maptrack[0]));

2431 iàĞ(
t
->
m­Œack
[0] = 
	`®loc_x’h—p_·ge
()è=ğ
NULL
 )

2432 
no_mem_3
;

2433 
	`ş—r_·ge
(
t
->
m­Œack
[0]);

2434 
t
->
m­Œack_lim™
 = 
PAGE_SIZE
 / (
g¿Á_m­pšg
);

2435  
i
 = 0; i < 
t
->
m­Œack_lim™
; i++ )

2436 
t
->
m­Œack
[0][
i
].
»f
 = i+1;

2439 iàĞ(
t
->
sh¬ed_¿w
 = 
	`xm®loc_¬¿y
(*, 
max_Ä_g¿Á_äames
)è=ğ
NULL
 )

2440 
no_mem_3
;

2441 
	`mem£t
(
t
->
sh¬ed_¿w
, 0, 
max_Ä_g¿Á_äames
 * (t->shared_raw[0]));

2442  
i
 = 0; i < 
INITIAL_NR_GRANT_FRAMES
; i++ )

2444 iàĞ(
t
->
sh¬ed_¿w
[
i
] = 
	`®loc_x’h—p_·ge
()è=ğ
NULL
 )

2445 
no_mem_4
;

2446 
	`ş—r_·ge
(
t
->
sh¬ed_¿w
[
i
]);

2449  
i
 = 0; i < 
INITIAL_NR_GRANT_FRAMES
; i++ )

2450 
	`gÁb_ü—‹_sh¬ed_·ge
(
d
, 
t
, 
i
);

2453 
t
->
¡©us
 = 
	`xm®loc_¬¿y
(
g¿Á_¡©us_t
 *,

2454 
	`g¿Á_to_¡©us_äames
(
max_Ä_g¿Á_äames
));

2455 iàĞ
t
->
¡©us
 =ğ
NULL
 )

2456 
no_mem_4
;

2457 
	`mem£t
(
t
->
¡©us
, 0,

2458 
	`g¿Á_to_¡©us_äames
(
max_Ä_g¿Á_äames
è* (
t
->
¡©us
[0]));

2459 
t
->
Ä_¡©us_äames
 = 0;

2462 
d
->
g¿Á_bË
 = 
t
;

2465 
no_mem_4
:

2466  
i
 = 0; i < 
INITIAL_NR_GRANT_FRAMES
; i++ )

2467 
	`ä“_x’h—p_·ge
(
t
->
sh¬ed_¿w
[
i
]);

2468 
	`xä“
(
t
->
sh¬ed_¿w
);

2469 
no_mem_3
:

2470 
	`ä“_x’h—p_·ge
(
t
->
m­Œack
[0]);

2471 
	`xä“
(
t
->
m­Œack
);

2472 
no_mem_2
:

2473  
i
 = 0;

2474 
i
 < 
	`num_aù_äames_äom_sha_äames
(
INITIAL_NR_GRANT_FRAMES
); i++ )

2475 
	`ä“_x’h—p_·ge
(
t
->
aùive
[
i
]);

2476 
	`xä“
(
t
->
aùive
);

2477 
no_mem_1
:

2478 
	`xä“
(
t
);

2479 
no_mem_0
:

2480  -
ENOMEM
;

2481 
	}
}

2484 
	$gÁb_»Ëa£_m­pšgs
(

2485 
domaš
 *
d
)

2487 
g¿Á_bË
 *
gt
 = 
d
->grant_table;

2488 
g¿Á_m­pšg
 *
m­
;

2489 
g¿Á_»f_t
 
»f
;

2490 
g¿Á_hªdË_t
 
hªdË
;

2491 
domaš
 *
rd
;

2492 
aùive_g¿Á_’Œy
 *
aù
;

2493 
g¿Á_’Œy_h—d”_t
 *
sha
;

2494 
ušt16_t
 *
¡©us
;

2495 
·ge_šfo
 *
pg
;

2497 
	`BUG_ON
(!
d
->
is_dyšg
);

2499  
hªdË
 = 0; hªdË < 
gt
->
m­Œack_lim™
; handle++ )

2501 
m­
 = &
	`m­Œack_’Œy
(
gt
, 
hªdË
);

2502 iàĞ!(
m­
->
æags
 & (
GNTMAP_deviû_m­
|
GNTMAP_ho¡_m­
)) )

2505 
»f
 = 
m­
->ref;

2507 
	`gd´štk
(
XENLOG_INFO
, "Grant„elease (%hu)„ef:(%hu) "

2509 
hªdË
, 
»f
, 
m­
->
æags
, m­->
domid
);

2511 
rd
 = 
	`rcu_lock_domaš_by_id
(
m­
->
domid
);

2512 iàĞ
rd
 =ğ
NULL
 )

2515 
m­
->
æags
 = 0;

2519 
	`¥š_lock
(&
rd
->
g¿Á_bË
->
lock
);

2521 
aù
 = &
	`aùive_’Œy
(
rd
->
g¿Á_bË
, 
»f
);

2522 
sha
 = 
	`sh¬ed_’Œy_h—d”
(
rd
->
g¿Á_bË
, 
»f
);

2523 ià(
rd
->
g¿Á_bË
->
gt_v”siÚ
 == 1)

2524 
¡©us
 = &
sha
->
æags
;

2526 
¡©us
 = &
	`¡©us_’Œy
(
rd
->
g¿Á_bË
, 
»f
);

2528 
pg
 = 
	`mâ_to_·ge
(
aù
->
äame
);

2530 iàĞ
m­
->
æags
 & 
GNTMAP_»adÚly
 )

2532 iàĞ
m­
->
æags
 & 
GNTMAP_deviû_m­
 )

2534 
	`BUG_ON
(!(
aù
->
pš
 & 
GNTPIN_devr_mask
));

2535 
aù
->
pš
 -ğ
GNTPIN_devr_šc
;

2536 iàĞ!
	`is_iomem_·ge
(
aù
->
äame
) )

2537 
	`put_·ge
(
pg
);

2540 iàĞ
m­
->
æags
 & 
GNTMAP_ho¡_m­
 )

2542 
	`BUG_ON
(!(
aù
->
pš
 & 
GNTPIN_h¡r_mask
));

2543 
aù
->
pš
 -ğ
GNTPIN_h¡r_šc
;

2544 iàĞ
	`gÁb_»Ëa£_ho¡_m­pšgs
(
d
) &&

2545 !
	`is_iomem_·ge
(
aù
->
äame
) )

2546 
	`put_·ge
(
pg
);

2551 iàĞ
m­
->
æags
 & 
GNTMAP_deviû_m­
 )

2553 
	`BUG_ON
(!(
aù
->
pš
 & 
GNTPIN_devw_mask
));

2554 
aù
->
pš
 -ğ
GNTPIN_devw_šc
;

2555 iàĞ!
	`is_iomem_·ge
(
aù
->
äame
) )

2556 
	`put_·ge_ªd_ty³
(
pg
);

2559 iàĞ
m­
->
æags
 & 
GNTMAP_ho¡_m­
 )

2561 
	`BUG_ON
(!(
aù
->
pš
 & 
GNTPIN_h¡w_mask
));

2562 
aù
->
pš
 -ğ
GNTPIN_h¡w_šc
;

2563 iàĞ
	`gÁb_»Ëa£_ho¡_m­pšgs
(
d
) &&

2564 !
	`is_iomem_·ge
(
aù
->
äame
) )

2566 iàĞ
	`gÁb_ho¡_m­pšg_g‘_·ge_ty³
(
m­
, 
d
, 
rd
) )

2567 
	`put_·ge_ty³
(
pg
);

2568 
	`put_·ge
(
pg
);

2572 iàĞ(
aù
->
pš
 & (
GNTPIN_devw_mask
|
GNTPIN_h¡w_mask
)) == 0 )

2573 
	`gÁb_ş—r_æag
(
_GTF_wr™šg
, 
¡©us
);

2576 iàĞ
aù
->
pš
 == 0 )

2577 
	`gÁb_ş—r_æag
(
_GTF_»adšg
, 
¡©us
);

2579 
	`¥š_uÆock
(&
rd
->
g¿Á_bË
->
lock
);

2581 
	`rcu_uÆock_domaš
(
rd
);

2583 
m­
->
æags
 = 0;

2585 
	}
}

2589 
	$g¿Á_bË_de¡roy
(

2590 
domaš
 *
d
)

2592 
g¿Á_bË
 *
t
 = 
d
->grant_table;

2593 
i
;

2595 iàĞ
t
 =ğ
NULL
 )

2598  
i
 = 0; i < 
	`Ä_g¿Á_äames
(
t
); i++ )

2599 
	`ä“_x’h—p_·ge
(
t
->
sh¬ed_¿w
[
i
]);

2600 
	`xä“
(
t
->
sh¬ed_¿w
);

2602  
i
 = 0; i < 
	`Ä_m­Œack_äames
(
t
); i++ )

2603 
	`ä“_x’h—p_·ge
(
t
->
m­Œack
[
i
]);

2604 
	`xä“
(
t
->
m­Œack
);

2606  
i
 = 0; i < 
	`Ä_aùive_g¿Á_äames
(
t
); i++ )

2607 
	`ä“_x’h—p_·ge
(
t
->
aùive
[
i
]);

2608 
	`xä“
(
t
->
aùive
);

2610  
i
 = 0; i < 
	`Ä_¡©us_äames
(
t
); i++ )

2611 
	`ä“_x’h—p_·ge
(
t
->
¡©us
[
i
]);

2612 
	`xä“
(
t
->
¡©us
);

2614 
	`xä“
(
t
);

2615 
d
->
g¿Á_bË
 = 
NULL
;

2616 
	}
}

2618 
	$gÁb_u§ge_´št
(
domaš
 *
rd
)

2620 
fœ¡
 = 1;

2621 
g¿Á_»f_t
 
»f
;

2622 
g¿Á_bË
 *
gt
 = 
rd
->grant_table;

2624 
	`´štk
(" --------‡ctive -------- -------- shared --------\n");

2625 
	`´štk
("[ref]†ocaldom mfn…in†ocaldom gmfn flags\n");

2627 
	`¥š_lock
(&
gt
->
lock
);

2629 iàĞ
gt
->
gt_v”siÚ
 == 0 )

2630 
out
;

2632  
»f
 = 0;„eà!ğ
	`Ä_g¿Á_’Œ›s
(
gt
);„ef++ )

2634 
aùive_g¿Á_’Œy
 *
aù
;

2635 
g¿Á_’Œy_h—d”
 *
sha
;

2636 
g¿Á_’Œy_v1_t
 *
sha1
;

2637 
g¿Á_’Œy_v2_t
 *
sha2
;

2638 
ušt16_t
 
¡©us
;

2639 
ušt64_t
 
äame
;

2641 
aù
 = &
	`aùive_’Œy
(
gt
, 
»f
);

2642 iàĞ!
aù
->
pš
 )

2645 
sha
 = 
	`sh¬ed_’Œy_h—d”
(
gt
, 
»f
);

2647 iàĞ
gt
->
gt_v”siÚ
 == 1 )

2649 
sha1
 = &
	`sh¬ed_’Œy_v1
(
gt
, 
»f
);

2650 
sha2
 = 
NULL
;

2651 
¡©us
 = 
sha
->
æags
;

2652 
äame
 = 
sha1
->frame;

2656 
sha2
 = &
	`sh¬ed_’Œy_v2
(
gt
, 
»f
);

2657 
sha1
 = 
NULL
;

2658 
äame
 = 
sha2
->
fuÎ_·ge
.frame;

2659 
¡©us
 = 
	`¡©us_’Œy
(
gt
, 
»f
);

2662 iàĞ
fœ¡
 )

2664 
	`´štk
("grant-table for„emote domain:%5d (v%d)\n",

2665 
rd
->
domaš_id
, 
gt
->
gt_v”siÚ
);

2666 
fœ¡
 = 0;

2670 
	`´štk
("[%3d] %5d 0x%06lx 0x%08x %5d 0x%06"
PRIx64
" 0x%02x\n",

2671 
»f
, 
aù
->
domid
,‡ù->
äame
,‡ù->
pš
,

2672 
sha
->
domid
, 
äame
, 
¡©us
);

2675 
out
:

2676 
	`¥š_uÆock
(&
gt
->
lock
);

2678 iàĞ
fœ¡
 )

2679 
	`´štk
("grant-table for„emote domain:%5d ... "

2680 "nØaùivg¿ÁabËƒÁr›s\n", 
rd
->
domaš_id
);

2681 
	}
}

2683 
	$gÁb_u§ge_´št_®l
(
key
)

2685 
domaš
 *
d
;

2686 
	`´štk
("% [ key '%c'…»s£d\n", 
__FUNCTION__
, 
key
);

2687 
	`fÜ_—ch_domaš
 ( 
d
 )

2688 
	`gÁb_u§ge_´št
(
d
);

2689 
	`´štk
("% ] dÚe\n", 
__FUNCTION__
);

2690 
	}
}

2692 
keyhªdËr
 
	ggÁb_u§ge_´št_®l_keyhªdËr
 = {

2693 .
dŸgno¡ic
 = 1,

2694 .
	gu
.
	gâ
 = 
gÁb_u§ge_´št_®l
,

2695 .
	gdesc
 = "print grantable usage"

2698 
__š™
 
	$gÁb_u§ge_š™
()

2700 
	`»gi¡”_keyhªdËr
('g', &
gÁb_u§ge_´št_®l_keyhªdËr
);

2702 
	}
}

2703 
__š™ÿÎ
(
gÁb_u§ge_š™
);

	@heterovisor.c

1 
	~<x’/sched.h
>

2 
	~<x’/h‘”ovisÜ.h
>

3 
	~<x’/gue¡_acûss.h
>

4 
	$do_myhÿÎ_İ
(
¬g1
, 
¬g2
, 
¬g3
, 
¬g4
, 
¬g5
)

7 if(
¬g1
 == 1)

9 
	`chªge_h‘”o_cÚfig
(
¬g2
, 
¬g3
, 
¬g4
, 
¬g5
);

11 if(
¬g1
 == 2)

13 
	`csched_h‘”o_š™
(
¬g2
, 
¬g3
, 
¬g4
);

15 if(
¬g1
 == 3)

17 
	`chªge_debug_Ëv–
(
¬g2
);

19 if(
¬g1
 == 4)

21 
	`’abË_h‘”o_visÜ
(
¬g2
, 
¬g3
);

23 if(
¬g1
 == 5)

25 
	`chªge_dom_cÚfig
(
¬g2
, 
¬g3
, 
¬g4
, 
¬g5
);

27 if(
¬g1
 == 6)

32 
	}
}

34 
do_e¡©e_İ
(
»sourû
, 
¡©e
, 
	$XEN_GUEST_HANDLE
(è
eÿp
)

36 
»t
;

37 
»t
 = 
	`chªge_e¡©e
(
»sourû
, 
¡©e
, 
eÿp
);

38  
»t
;

39 
	}
}

41 
do_³rfùr_İ
(
İ
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

43 
	`»ad_³rfùr
(
¬g
);

45 
	}
}

	@hvm/save.c

24 
	~<x’/cÚfig.h
>

25 
	~<x’/lib.h
>

26 
	~<x’/v”siÚ.h
>

27 
	~<public/v”siÚ.h
>

28 
	~<x’/sched.h
>

29 
	~<x’/gue¡_acûss.h
>

31 
	~<asm/hvm/suµÜt.h
>

35 
hvm_§ve_hªdËr
 
	m§ve
;

36 
hvm_lßd_hªdËr
 
	mlßd
;

37 cÚ¡ *
	mÇme
;

38 
size_t
 
	msize
;

39 
	mkšd
;

40 } 
	ghvm_¤_hªdËrs
 [
HVM_SAVE_CODE_MAX
 + 1] = {{
NULL
, NULL, "<?>"},};

43 
	$hvm_»gi¡”_§vevm
(
ušt16_t
 
ty³code
,

44 cÚ¡ *
Çme
,

45 
hvm_§ve_hªdËr
 
§ve_¡©e
,

46 
hvm_lßd_hªdËr
 
lßd_¡©e
,

47 
size_t
 
size
, 
kšd
)

49 
	`ASSERT
(
ty³code
 <ğ
HVM_SAVE_CODE_MAX
);

50 
	`ASSERT
(
hvm_¤_hªdËrs
[
ty³code
].
§ve
 =ğ
NULL
);

51 
	`ASSERT
(
hvm_¤_hªdËrs
[
ty³code
].
lßd
 =ğ
NULL
);

52 
hvm_¤_hªdËrs
[
ty³code
].
§ve
 = 
§ve_¡©e
;

53 
hvm_¤_hªdËrs
[
ty³code
].
lßd
 = 
lßd_¡©e
;

54 
hvm_¤_hªdËrs
[
ty³code
].
Çme
 =‚ame;

55 
hvm_¤_hªdËrs
[
ty³code
].
size
 = size;

56 
hvm_¤_hªdËrs
[
ty³code
].
kšd
 = kind;

57 
	}
}

59 
size_t
 
	$hvm_§ve_size
(
domaš
 *
d
)

61 
vıu
 *
v
;

62 
size_t
 
sz
;

63 
i
;

66 
sz
 = (2 *  (
hvm_§ve_desütÜ
)è+ 
	`HVM_SAVE_LENGTH
(
HEADER
);

69  
i
 = 0; i <ğ
HVM_SAVE_CODE_MAX
; i++ )

70 iàĞ
hvm_¤_hªdËrs
[
i
].
kšd
 =ğ
HVMSR_PER_VCPU
 )

71 
	`fÜ_—ch_vıu
(
d
, 
v
)

72 
sz
 +ğ
hvm_¤_hªdËrs
[
i
].
size
;

74 
sz
 +ğ
hvm_¤_hªdËrs
[
i
].
size
;

76  
sz
;

77 
	}
}

81 
hvm_§ve_Úe
(
domaš
 *
d
, 
ušt16_t
 
ty³code
, ušt16_ˆ
š¡ªû
,

82 
	$XEN_GUEST_HANDLE_64
(
ušt8
è
hªdË
)

84 
rv
 = 0;

85 
size_t
 
sz
 = 0;

86 
vıu
 *
v
;

87 
hvm_domaš_cÚ‹xt_t
 
ùxt
 = { 0, };

89 iàĞ
d
->
is_dyšg


90 || 
ty³code
 > 
HVM_SAVE_CODE_MAX


91 || 
hvm_¤_hªdËrs
[
ty³code
].
size
 < (
hvm_§ve_desütÜ
)

92 || 
hvm_¤_hªdËrs
[
ty³code
].
§ve
 =ğ
NULL
 )

93  -
EINVAL
;

95 iàĞ
hvm_¤_hªdËrs
[
ty³code
].
kšd
 =ğ
HVMSR_PER_VCPU
 )

96 
	`fÜ_—ch_vıu
(
d
, 
v
)

97 
sz
 +ğ
hvm_¤_hªdËrs
[
ty³code
].
size
;

99 
sz
 = 
hvm_¤_hªdËrs
[
ty³code
].
size
;

101 iàĞ(
š¡ªû
 + 1è* 
hvm_¤_hªdËrs
[
ty³code
].
size
 > 
sz
 )

102  -
EINVAL
;

104 
ùxt
.
size
 = 
sz
;

105 
ùxt
.
d©a
 = 
	`xm®loc_by‹s
(
sz
);

106 iàĞ!
ùxt
.
d©a
 )

107  -
ENOMEM
;

109 iàĞ
hvm_¤_hªdËrs
[
ty³code
].
	`§ve
(
d
, &
ùxt
) != 0 )

111 
	`gd´štk
(
XENLOG_ERR
,

112 "HVM save: faedØ§vty³ %"
PRIu16
"\n", 
ty³code
);

113 
rv
 = -
EFAULT
;

115 iàĞ
	`cİy_to_gue¡
(
hªdË
,

116 
ùxt
.
d©a


117 + (
š¡ªû
 * 
hvm_¤_hªdËrs
[
ty³code
].
size
)

118 +  (
hvm_§ve_desütÜ
),

119 
hvm_¤_hªdËrs
[
ty³code
].
size


120 -  (
hvm_§ve_desütÜ
)) )

121 
rv
 = -
EFAULT
;

123 
	`xä“
(
ùxt
.
d©a
);

124  
rv
;

125 
	}
}

127 
	$hvm_§ve
(
domaš
 *
d
, 
hvm_domaš_cÚ‹xt_t
 *
h
)

129 *
c
;

130 
hvm_§ve_h—d”
 
hdr
;

131 
hvm_§ve_’d
 
’d
;

132 
hvm_§ve_hªdËr
 
hªdËr
;

133 
ušt16_t
 
i
;

135 iàĞ
d
->
is_dyšg
 )

136  -
EINVAL
;

138 
hdr
.
magic
 = 
HVM_FILE_MAGIC
;

139 
hdr
.
v”siÚ
 = 
HVM_FILE_VERSION
;

142 
c
 = 
	`¡¼chr
(
	`x’_chªge£t
(), ':');

143 iàĞ
c
 )

144 
hdr
.
chªge£t
 = 
	`sim¶e_¡¹Şl
(
c
, 
NULL
, 16);

146 
hdr
.
chªge£t
 = -1ULL;

148 
	`¬ch_hvm_§ve
(
d
, &
hdr
);

150 iàĞ
	`hvm_§ve_’Œy
(
HEADER
, 0, 
h
, &
hdr
) != 0 )

152 
	`gd´štk
(
XENLOG_ERR
, "HVM save: failedo write header\n");

153  -
EFAULT
;

157  
i
 = 0; i <ğ
HVM_SAVE_CODE_MAX
; i++ )

159 
hªdËr
 = 
hvm_¤_hªdËrs
[
i
].
§ve
;

160 iàĞ
hªdËr
 !ğ
NULL
 )

162 
	`gd´štk
(
XENLOG_INFO
, "HVM save: %s\n", 
hvm_¤_hªdËrs
[
i
].
Çme
);

163 iàĞ
	`hªdËr
(
d
, 
h
) != 0 )

165 
	`gd´štk
(
XENLOG_ERR
,

166 "HVM save: faedØ§vty³ %"
PRIu16
"\n", 
i
);

167  -
EFAULT
;

173 iàĞ
	`hvm_§ve_’Œy
(
END
, 0, 
h
, &
’d
) != 0 )

176 
	`gd´štk
(
XENLOG_ERR
, "HVM save:‚o„oom forƒnd marker.\n");

177  -
EFAULT
;

181 
	`ASSERT
(
h
->
cur
 <ğh->
size
);

183 
	}
}

185 
	$hvm_lßd
(
domaš
 *
d
, 
hvm_domaš_cÚ‹xt_t
 *
h
)

187 
hvm_§ve_h—d”
 
hdr
;

188 
hvm_§ve_desütÜ
 *
desc
;

189 
hvm_lßd_hªdËr
 
hªdËr
;

190 
vıu
 *
v
;

192 iàĞ
d
->
is_dyšg
 )

193  -
EINVAL
;

196 iàĞ
	`hvm_lßd_’Œy
(
HEADER
, 
h
, &
hdr
) != 0 )

199 iàĞ
	`¬ch_hvm_lßd
(
d
, &
hdr
) )

203 
	`fÜ_—ch_vıu
(
d
, 
v
)

204 iàĞ
	`‹¡_ªd_£t_b™
(
_VPF_down
, &
v
->
·u£_æags
) )

205 
	`vıu_¦“p_nosync
(
v
);

209 iàĞ
h
->
size
 - h->
cur
 < (
hvm_§ve_desütÜ
) )

212 
	`gd´štk
(
XENLOG_ERR
,

218 
desc
 = (
hvm_§ve_desütÜ
 *)(&
h
->
d©a
[h->
cur
]);

219 iàĞ
desc
->
ty³code
 == 0 )

223 iàĞ(
desc
->
ty³code
 > 
HVM_SAVE_CODE_MAX
) ||

224 ((
hªdËr
 = 
hvm_¤_hªdËrs
[
desc
->
ty³code
].
lßd
è=ğ
NULL
) )

226 
	`gd´štk
(
XENLOG_ERR
,

228 
desc
->
ty³code
);

233 
	`gd´štk
(
XENLOG_INFO
, "HVM„e¡Üe: % %"
PRIu16
"\n",

234 
hvm_¤_hªdËrs
[
desc
->
ty³code
].
Çme
, desc->
š¡ªû
);

235 iàĞ
	`hªdËr
(
d
, 
h
) != 0 )

237 
	`gd´štk
(
XENLOG_ERR
,

239 
desc
->
ty³code
, desc->
š¡ªû
);

245 
	}
}

247 
	$_hvm_š™_’Œy
(
hvm_domaš_cÚ‹xt
 *
h
,

248 
ušt16_t
 
tc
, ušt16_ˆ
š¡
, 
ušt32_t
 
Ën
)

250 
hvm_§ve_desütÜ
 *
d


251 ğ(
hvm_§ve_desütÜ
 *)&
h
->
d©a
[h->
cur
];

252 iàĞ
h
->
size
 - h->
cur
 < 
Ën
 +  (*
d
) )

254 
	`gd´štk
(
XENLOG_WARNING
,

255 "HVM save:‚Øroom fÜ %"
PRIu32
" + %u bytes "

256 "fÜy³cod%"
PRIu16
"\n",

257 
Ën
, (è (*
d
), 
tc
);

260 
d
->
ty³code
 = 
tc
;

261 
d
->
š¡ªû
 = 
š¡
;

262 
d
->
Ëngth
 = 
Ën
;

263 
h
->
cur
 +ğ(*
d
);

265 
	}
}

267 
	$_hvm_wr™e_’Œy
(
hvm_domaš_cÚ‹xt
 *
h
,

268 *
¤c
, 
ušt32_t
 
¤c_Ën
)

270 
	`memıy
(&
h
->
d©a
[h->
cur
], 
¤c
, 
¤c_Ën
);

271 
h
->
cur
 +ğ
¤c_Ën
;

272 
	}
}

274 
	$_hvm_check_’Œy
(
hvm_domaš_cÚ‹xt
 *
h
,

275 
ušt16_t
 
ty³
, 
ušt32_t
 
Ën
, 
boŞ_t
 
¡riù_Ëngth
)

277 
hvm_§ve_desütÜ
 *
d


278 ğ(
hvm_§ve_desütÜ
 *)&
h
->
d©a
[h->
cur
];

279 iàĞ
Ën
 +  (*
d
è> 
h
->
size
 - h->
cur
)

281 
	`gd´štk
(
XENLOG_WARNING
,

283 "fÜy³ %u\n", 
Ën
, 
ty³
);

286 iàĞ(
ty³
 !ğ
d
->
ty³code
è|| (
Ën
 < d->
Ëngth
) ||

287 (
¡riù_Ëngth
 && (
Ën
 !ğ
d
->
Ëngth
)) )

289 
	`gd´štk
(
XENLOG_WARNING
,

291 "§wy³ %u†’gth %u\n", 
ty³
, 
Ën
, 
d
->
ty³code
, d->
Ëngth
);

294 
h
->
cur
 +ğ(*
d
);

296 
	}
}

298 
	$_hvm_»ad_’Œy
(
hvm_domaš_cÚ‹xt
 *
h
,

299 *
de¡
, 
ušt32_t
 
de¡_Ën
)

301 
hvm_§ve_desütÜ
 *
d


302 ğ(
hvm_§ve_desütÜ
 *)&
h
->
d©a
[h->
cur
 - (*
d
)];

303 
	`BUG_ON
(
d
->
Ëngth
 > 
de¡_Ën
);

304 
	`memıy
(
de¡
, &
h
->
d©a
[h->
cur
], 
d
->
Ëngth
);

305 iàĞ
d
->
Ëngth
 < 
de¡_Ën
 )

306 
	`mem£t
((*)
de¡
 + 
d
->
Ëngth
, 0, 
de¡_Ën
 - d->length);

307 
h
->
cur
 +ğ
d
->
Ëngth
;

308 
	}
}

	@inflate.c

1 
	#DEBG
(
x
)

	)

2 
	#DEBG1
(
x
)

	)

106 #ifdeà
RCSID


107 
	grcsid
[] = "#Id: inflate.c,v 0.14 1993/06/10 13:27:04 jloup Exp #";

110 #iâdeà
STATIC


112 #ià
defšed
(
STDC_HEADERS
è|| defšed(
HAVE_STDLIB_H
)

113 
	~<sys/ty³s.h
>

114 
	~<¡dlib.h
>

117 
	~"gz.h
"

118 
	#STATIC


	)

121 #iâdeà
INIT


122 
	#INIT


	)

125 
	#¦ide
 
wšdow


	)

134 
	shuá
 {

135 
uch
 
	me
;

136 
uch
 
	mb
;

138 
ush
 
	mn
;

139 
huá
 *
	mt
;

140 } 
	mv
;

145 
STATIC
 
INIT
 
huá_bud
 
OF
((*, , ,

146 cÚ¡ 
ush
 *, cÚ¡ ush *, 
huá
 **, *));

147 
STATIC
 
INIT
 
huá_ä“
 
OF
((
huá
 *));

148 
STATIC
 
INIT
 
šæ©e_codes
 
OF
((
huá
 *, huft *, , ));

149 
STATIC
 
INIT
 
šæ©e_¡Üed
 
OF
(());

150 
STATIC
 
INIT
 
šæ©e_fixed
 
OF
(());

151 
STATIC
 
INIT
 
šæ©e_dyÇmic
 
OF
(());

152 
STATIC
 
INIT
 
šæ©e_block
 
OF
((*));

153 
STATIC
 
INIT
 
šæ©e
 
OF
(());

165 
	#wp
 
outút


	)

166 
	#æush_ouut
(
w
è(
wp
=(w),
	`æush_wšdow
())

	)

169 cÚ¡ 
	gbÜd”
[] = {

171 cÚ¡ 
ush
 
	gıËns
[] = {

175 cÚ¡ 
ush
 
	gıËxt
[] = {

178 cÚ¡ 
ush
 
	gıdi¡
[] = {

182 cÚ¡ 
ush
 
	gıdext
[] = {

219 
STATIC
 
ulg
 
	gbb
;

220 
STATIC
 
	gbk
;

222 
STATIC
 cÚ¡ 
ush
 
	gmask_b™s
[] = {

228 
	#NEXTBYTE
(è({ 
v
 = 
	`g‘_by‹
(); ià(v < 0è
und”run
; (
uch
)v; })

	)

229 
	#NEEDBITS
(
n
è{
k
<Ò)){
b
|=((
ulg
)
	`NEXTBYTE
())<<k;k+=8;}}

	)

230 
	#DUMPBITS
(
n
è{
b
>>=Ò);
k
-=Ò);}

	)

232 #iâdeà
NO_INFLATE_MALLOC


237 
	gm®loc_±r
;

238 
	gm®loc_couÁ
;

240 *
	$m®loc
(
size
)

242 *
p
;

244 ià(
size
 < 0)

245 
	`”rÜ
("Mallocƒrror");

246 ià(!
m®loc_±r
)

247 
m®loc_±r
 = 
ä“_mem_±r
;

249 
m®loc_±r
 = (malloc_ptr + 3) & ~3;

251 
p
 = (*)
m®loc_±r
;

252 
m®loc_±r
 +ğ
size
;

254 ià(
ä“_mem_’d_±r
 && 
m®loc_±r
 >= free_mem_end_ptr)

255 
	`”rÜ
("Out of memory");

257 
m®loc_couÁ
++;

258  
p
;

259 
	}
}

261 
	$ä“
(*
wh”e
)

263 
m®loc_couÁ
--;

264 ià(!
m®loc_couÁ
)

265 
m®loc_±r
 = 
ä“_mem_±r
;

266 
	}
}

268 
	#m®loc
(
a
è
	`km®loc
×, 
GFP_KERNEL
)

	)

269 
	#ä“
(
a
è
	`kä“
×)

	)

305 
STATIC
 cÚ¡ 
	glb™s
 = 9;

306 
STATIC
 cÚ¡ 
	gdb™s
 = 6;

310 
	#BMAX
 16

	)

311 
	#N_MAX
 288

	)

314 
STATIC
 
	ghuás
;

317 
STATIC
 
INIT
 
	$huá_bud
(

318 *
b
,

319 
n
,

320 
s
,

321 cÚ¡ 
ush
 *
d
,

322 cÚ¡ 
ush
 *
e
,

323 
huá
 **
t
,

324 *
m


332 
a
;

333 
f
;

334 
g
;

335 
h
;

336 
i
;

337 
j
;

338 
k
;

339 
l
;

340 *
p
;

341 
huá
 *
q
;

342 
huá
 
r
;

343 
w
;

344 *
xp
;

345 
y
;

346 
z
;

348 
c
[
BMAX
+1];

349 
huá
 *
u
[
BMAX
];

350 
v
[
N_MAX
];

351 
x
[
BMAX
+1];

352 } *
¡k
;

353 *
c
, *
v
, *
x
;

354 
huá
 **
u
;

355 
»t
;

357 
	`DEBG
("huft1 ");

359 
¡k
 = 
	`m®loc
((*stk));

360 ià(
¡k
 =ğ
NULL
)

363 
c
 = 
¡k
->c;

364 
v
 = 
¡k
->v;

365 
x
 = 
¡k
->x;

366 
u
 = 
¡k
->u;

369 
	`memz”o
(
¡k
->
c
, (stk->c));

370 
p
 = 
b
; 
i
 = 
n
;

372 
	`T¿ûcv
(*
p
, (
¡d”r
, (
n
-
i
 >= ' ' &&‚-i <= '~' ? "%c %d\n" : "0x%x %d\n"),

373 
n
-
i
, *
p
));

374 
c
[*
p
]++;

375 
p
++;

376 } --
i
);

377 ià(
c
[0] =ğ
n
)

379 *
t
 = (
huá
 *)
NULL
;

380 *
m
 = 0;

381 
»t
 = 2;

382 
out
;

385 
	`DEBG
("huft2 ");

388 
l
 = *
m
;

389 
j
 = 1; j <ğ
BMAX
; j++)

390 ià(
c
[
j
])

392 
k
 = 
j
;

393 ià(()
l
 < 
j
)

394 
l
 = 
j
;

395 
i
 = 
BMAX
; i; i--)

396 ià(
c
[
i
])

398 
g
 = 
i
;

399 ià(()
l
 > 
i
)

400 
l
 = 
i
;

401 *
m
 = 
l
;

403 
	`DEBG
("huft3 ");

406 
y
 = 1 << 
j
; j < 
i
; j++, y <<= 1)

407 ià((
y
 -ğ
c
[
j
]) < 0) {

408 
»t
 = 2;

409 
out
;

411 ià((
y
 -ğ
c
[
i
]) < 0) {

412 
»t
 = 2;

413 
out
;

415 
c
[
i
] +ğ
y
;

417 
	`DEBG
("huft4 ");

420 
x
[1] = 
j
 = 0;

421 
p
 = 
c
 + 1; 
xp
 = 
x
 + 2;

422 --
i
) {

423 *
xp
++ = (
j
 +ğ*
p
++);

426 
	`DEBG
("huft5 ");

429 
p
 = 
b
; 
i
 = 0;

431 ià((
j
 = *
p
++) != 0)

432 
v
[
x
[
j
]++] = 
i
;

433 } ++
i
 < 
n
);

434 
n
 = 
x
[
g
];

436 
	`DEBG
("h6 ");

439 
x
[0] = 
i
 = 0;

440 
p
 = 
v
;

441 
h
 = -1;

442 
w
 = -
l
;

443 
u
[0] = (
huá
 *)
NULL
;

444 
q
 = (
huá
 *)
NULL
;

445 
z
 = 0;

446 
	`DEBG
("h6a ");

449 ; 
k
 <ğ
g
; k++)

451 
	`DEBG
("h6b ");

452 
a
 = 
c
[
k
];

453 
a
--)

455 
	`DEBG
("h6b1 ");

458 
k
 > 
w
 + 
l
)

460 
	`DEBG1
("1 ");

461 
h
++;

462 
w
 +ğ
l
;

465 
z
 = (z = 
g
 - 
w
è> ()
l
 ?† : z;

466 ià((
f
 = 1 << (
j
 = 
k
 - 
w
)è> 
a
 + 1)

468 
	`DEBG1
("2 ");

469 
f
 -ğ
a
 + 1;

470 
xp
 = 
c
 + 
k
;

471 ià(
j
 < 
z
)

472 ++
j
 < 
z
)

474 ià((
f
 <<ğ1è<ğ*++
xp
)

476 
f
 -ğ*
xp
;

479 
	`DEBG1
("3 ");

480 
z
 = 1 << 
j
;

483 ià((
q
 = (
huá
 *)
	`m®loc
((
z
 + 1)*(huft))) ==

484 (
huá
 *)
NULL
)

486 ià(
h
)

487 
	`huá_ä“
(
u
[0]);

488 
»t
 = 3;

489 
out
;

491 
	`DEBG1
("4 ");

492 
huás
 +ğ
z
 + 1;

493 *
t
 = 
q
 + 1;

494 *(
t
 = &(
q
->
v
.t)èğ(
huá
 *)
NULL
;

495 
u
[
h
] = ++
q
;

497 
	`DEBG1
("5 ");

499 ià(
h
)

501 
x
[
h
] = 
i
;

502 
r
.
b
 = (
uch
)
l
;

503 
r
.
e
 = (
uch
)(16 + 
j
);

504 
r
.
v
.
t
 = 
q
;

505 
j
 = 
i
 >> (
w
 - 
l
);

506 
u
[
h
-1][
j
] = 
r
;

508 
	`DEBG1
("6 ");

510 
	`DEBG
("h6c ");

513 
r
.
b
 = (
uch
)(
k
 - 
w
);

514 ià(
p
 >ğ
v
 + 
n
)

515 
r
.
e
 = 99;

516 ià(*
p
 < 
s
)

518 
r
.
e
 = (
uch
)(*
p
 < 256 ? 16 : 15);

519 
r
.
v
.
n
 = (
ush
)(*
p
);

520 
p
++;

524 
r
.
e
 = (
uch
ë[*
p
 - 
s
];

525 
r
.
v
.
n
 = 
d
[*
p
++ - 
s
];

527 
	`DEBG
("h6d ");

530 
f
 = 1 << (
k
 - 
w
);

531 
j
 = 
i
 >> 
w
; j < 
z
; j +ğ
f
)

532 
q
[
j
] = 
r
;

535 
j
 = 1 << (
k
 - 1); 
i
 & j; j >>= 1)

536 
i
 ^ğ
j
;

537 
i
 ^ğ
j
;

540 (
i
 & ((1 << 
w
è- 1)è!ğ
x
[
h
])

542 
h
--;

543 
w
 -ğ
l
;

545 
	`DEBG
("h6e ");

547 
	`DEBG
("h6f ");

550 
	`DEBG
("huft7 ");

553 
»t
 = 
y
 !ğ0 && 
g
 != 1;

555 
out
:

556 
	`ä“
(
¡k
);

557  
»t
;

558 
	}
}

562 
STATIC
 
INIT
 
	$huá_ä“
(

563 
huá
 *
t


569 
huá
 *
p
, *
q
;

573 
p
 = 
t
;

574 
p
 !ğ(
huá
 *)
NULL
)

576 
q
 = (--
p
)->
v
.
t
;

577 
	`ä“
((*)
p
);

578 
p
 = 
q
;

581 
	}
}

584 
STATIC
 
INIT
 
	$šæ©e_codes
(

585 
huá
 *

,

586 
huá
 *
td
,

587 
bl
,

588 
bd


593 
e
;

594 
n
, 
d
;

595 
w
;

596 
huá
 *
t
;

597 
ml
, 
md
;

598 
ulg
 
b
;

599 
k
;

603 
b
 = 
bb
;

604 
k
 = 
bk
;

605 
w
 = 
wp
;

608 
ml
 = 
mask_b™s
[
bl
];

609 
md
 = 
mask_b™s
[
bd
];

612 
	`NEEDBITS
(()
bl
)

613 ià((
e
 = (
t
 = 

 + (()
b
 & 
ml
))->e) > 16)

615 ià(
e
 == 99)

617 
	`DUMPBITS
(
t
->
b
)

618 
e
 -= 16;

619 
	`NEEDBITS
(
e
)

620 } (
e
 = (
t
 =->
v
.ˆ+ (()
b
 & 
mask_b™s
[e]))->e) > 16);

621 
	`DUMPBITS
(
t
->
b
)

622 ià(
e
 == 16)

624 
¦ide
[
w
++] = (
uch
)
t
->
v
.
n
;

625 
	`T¿ûvv
((
¡d”r
, "%c", 
¦ide
[
w
-1]));

626 ià(
w
 =ğ
WSIZE
)

628 
	`æush_ouut
(
w
);

629 
w
 = 0;

635 ià(
e
 == 15)

639 
	`NEEDBITS
(
e
)

640 
n
 = 
t
->
v
.À+ (()
b
 & 
mask_b™s
[
e
]);

641 
	`DUMPBITS
(
e
);

644 
	`NEEDBITS
(()
bd
)

645 ià((
e
 = (
t
 = 
td
 + (()
b
 & 
md
))->e) > 16)

647 ià(
e
 == 99)

649 
	`DUMPBITS
(
t
->
b
)

650 
e
 -= 16;

651 
	`NEEDBITS
(
e
)

652 } (
e
 = (
t
 =->
v
.ˆ+ (()
b
 & 
mask_b™s
[e]))->e) > 16);

653 
	`DUMPBITS
(
t
->
b
)

654 
	`NEEDBITS
(
e
)

655 
d
 = 
w
 - 
t
->
v
.
n
 - (()
b
 & 
mask_b™s
[
e
]);

656 
	`DUMPBITS
(
e
)

657 
	`T¿ûvv
((
¡d”r
,"\\[%d,%d]", 
w
-
d
, 
n
));

661 
n
 -ğ(
e
 = (ğ
WSIZE
 - ((
d
 &ğWSIZE-1è> 
w
 ? d : w)) >‚ ?‚ :ƒ);

662 #ià!
	`defšed
(
NOMEMCPY
è&& !defšed(
DEBUG
)

663 ià(
w
 - 
d
 >ğ
e
)

665 
	`memıy
(
¦ide
 + 
w
, slid+ 
d
, 
e
);

666 
w
 +ğ
e
;

667 
d
 +ğ
e
;

672 
¦ide
[
w
++] = slide[
d
++];

673 
	`T¿ûvv
((
¡d”r
, "%c", 
¦ide
[
w
-1]));

674 } --
e
);

675 ià(
w
 =ğ
WSIZE
)

677 
	`æush_ouut
(
w
);

678 
w
 = 0;

680 } 
n
);

686 
wp
 = 
w
;

687 
bb
 = 
b
;

688 
bk
 = 
k
;

693 
und”run
:

695 
	}
}

699 
STATIC
 
INIT
 
	$šæ©e_¡Üed
()

702 
n
;

703 
w
;

704 
ulg
 
b
;

705 
k
;

707 
	`DEBG
("<stor");

710 
b
 = 
bb
;

711 
k
 = 
bk
;

712 
w
 = 
wp
;

716 
n
 = 
k
 & 7;

717 
	`DUMPBITS
(
n
);

721 
	`NEEDBITS
(16)

722 
n
 = (()
b
 & 0xffff);

723 
	`DUMPBITS
(16)

724 
	`NEEDBITS
(16)

725 ià(
n
 !ğ()((~
b
) & 0xffff))

727 
	`DUMPBITS
(16)

731 
n
--)

733 
	`NEEDBITS
(8)

734 
¦ide
[
w
++] = (
uch
)
b
;

735 ià(
w
 =ğ
WSIZE
)

737 
	`æush_ouut
(
w
);

738 
w
 = 0;

740 
	`DUMPBITS
(8)

745 
wp
 = 
w
;

746 
bb
 = 
b
;

747 
bk
 = 
k
;

749 
	`DEBG
(">");

752 
und”run
:

754 
	}
}

760 
STATIC
 
nošlše
 
INIT
 
	$šæ©e_fixed
()

765 
i
;

766 
huá
 *

;

767 
huá
 *
td
;

768 
bl
;

769 
bd
;

770 *
l
;

772 
	`DEBG
("<fix");

774 
l
 = 
	`m®loc
((*l) * 288);

775 ià(
l
 =ğ
NULL
)

779 
i
 = 0; i < 144; i++)

780 
l
[
i
] = 8;

781 ; 
i
 < 256; i++)

782 
l
[
i
] = 9;

783 ; 
i
 < 280; i++)

784 
l
[
i
] = 7;

785 ; 
i
 < 288; i++)

786 
l
[
i
] = 8;

787 
bl
 = 7;

788 ià((
i
 = 
	`huá_bud
(
l
, 288, 257, 
ıËns
, 
ıËxt
, &

, &
bl
)) != 0) {

789 
	`ä“
(
l
);

790  
i
;

794 
i
 = 0; i < 30; i++)

795 
l
[
i
] = 5;

796 
bd
 = 5;

797 ià((
i
 = 
	`huá_bud
(
l
, 30, 0, 
ıdi¡
, 
ıdext
, &
td
, &
bd
)) > 1)

799 
	`huá_ä“
(

);

800 
	`ä“
(
l
);

802 
	`DEBG
(">");

803  
i
;

808 ià(
	`šæ©e_codes
(

, 
td
, 
bl
, 
bd
)) {

809 
	`ä“
(
l
);

814 
	`ä“
(
l
);

815 
	`huá_ä“
(

);

816 
	`huá_ä“
(
td
);

818 
	}
}

824 
STATIC
 
nošlše
 
INIT
 
	$šæ©e_dyÇmic
()

827 
i
;

828 
j
;

829 
l
;

830 
m
;

831 
n
;

832 
huá
 *

;

833 
huá
 *
td
;

834 
bl
;

835 
bd
;

836 
nb
;

837 
Æ
;

838 
nd
;

839 *
Î
;

840 
ulg
 
b
;

841 
k
;

842 
»t
;

844 
	`DEBG
("<dyn");

846 #ifdeà
PKZIP_BUG_WORKAROUND


847 
Î
 = 
	`m®loc
((*ll) * (288+32));

849 
Î
 = 
	`m®loc
((*ll) * (286+30));

852 ià(
Î
 =ğ
NULL
)

856 
b
 = 
bb
;

857 
k
 = 
bk
;

861 
	`NEEDBITS
(5)

862 
Æ
 = 257 + (()
b
 & 0x1f);

863 
	`DUMPBITS
(5)

864 
	`NEEDBITS
(5)

865 
nd
 = 1 + (()
b
 & 0x1f);

866 
	`DUMPBITS
(5)

867 
	`NEEDBITS
(4)

868 
nb
 = 4 + (()
b
 & 0xf);

869 
	`DUMPBITS
(4)

870 #ifdeà
PKZIP_BUG_WORKAROUND


871 ià(
Æ
 > 288 || 
nd
 > 32)

873 ià(
Æ
 > 286 || 
nd
 > 30)

876 
»t
 = 1;

877 
out
;

880 
	`DEBG
("dyn1 ");

883 
j
 = 0; j < 
nb
; j++)

885 
	`NEEDBITS
(3)

886 
Î
[
bÜd”
[
j
]] = ()
b
 & 7;

887 
	`DUMPBITS
(3)

889 ; 
j
 < 19; j++)

890 
Î
[
bÜd”
[
j
]] = 0;

892 
	`DEBG
("dyn2 ");

895 
bl
 = 7;

896 ià((
i
 = 
	`huá_bud
(
Î
, 19, 19, 
NULL
, NULL, &

, &
bl
)) != 0)

898 ià(
i
 == 1)

899 
	`huá_ä“
(

);

900 
»t
 = 
i
;

901 
out
;

904 
	`DEBG
("dyn3 ");

907 
n
 = 
Æ
 + 
nd
;

908 
m
 = 
mask_b™s
[
bl
];

909 
i
 = 
l
 = 0;

910 ()
i
 < 
n
)

912 
	`NEEDBITS
(()
bl
)

913 
j
 = (
td
 = 

 + (()
b
 & 
m
))->b;

914 
	`DUMPBITS
(
j
)

915 
j
 = 
td
->
v
.
n
;

916 ià(
j
 < 16)

917 
Î
[
i
++] = 
l
 = 
j
;

918 ià(
j
 == 16)

920 
	`NEEDBITS
(2)

921 
j
 = 3 + (()
b
 & 3);

922 
	`DUMPBITS
(2)

923 ià(()
i
 + 
j
 > 
n
) {

924 
»t
 = 1;

925 
out
;

927 
j
--)

928 
Î
[
i
++] = 
l
;

930 ià(
j
 == 17)

932 
	`NEEDBITS
(3)

933 
j
 = 3 + (()
b
 & 7);

934 
	`DUMPBITS
(3)

935 ià(()
i
 + 
j
 > 
n
) {

936 
»t
 = 1;

937 
out
;

939 
j
--)

940 
Î
[
i
++] = 0;

941 
l
 = 0;

945 
	`NEEDBITS
(7)

946 
j
 = 11 + (()
b
 & 0x7f);

947 
	`DUMPBITS
(7)

948 ià(()
i
 + 
j
 > 
n
) {

949 
»t
 = 1;

950 
out
;

952 
j
--)

953 
Î
[
i
++] = 0;

954 
l
 = 0;

958 
	`DEBG
("dyn4 ");

961 
	`huá_ä“
(

);

963 
	`DEBG
("dyn5 ");

966 
bb
 = 
b
;

967 
bk
 = 
k
;

969 
	`DEBG
("dyn5a ");

972 
bl
 = 
lb™s
;

973 ià((
i
 = 
	`huá_bud
(
Î
, 
Æ
, 257, 
ıËns
, 
ıËxt
, &

, &
bl
)) != 0)

975 
	`DEBG
("dyn5b ");

976 ià(
i
 == 1) {

977 
	`”rÜ
("incomplete†iteralree");

978 
	`huá_ä“
(

);

980 
»t
 = 
i
;

981 
out
;

983 
	`DEBG
("dyn5c ");

984 
bd
 = 
db™s
;

985 ià((
i
 = 
	`huá_bud
(
Î
 + 
Æ
, 
nd
, 0, 
ıdi¡
, 
ıdext
, &
td
, &
bd
)) != 0)

987 
	`DEBG
("dyn5d ");

988 ià(
i
 == 1) {

989 
	`”rÜ
("incomplete distanceree");

990 #ifdeà
PKZIP_BUG_WORKAROUND


991 
i
 = 0;

994 
	`huá_ä“
(
td
);

996 
	`huá_ä“
(

);

997 
»t
 = 
i
;

998 
out
;

1002 
	`DEBG
("dyn6 ");

1005 ià(
	`šæ©e_codes
(

, 
td
, 
bl
, 
bd
)) {

1006 
»t
 = 1;

1007 
out
;

1010 
	`DEBG
("dyn7 ");

1013 
	`huá_ä“
(

);

1014 
	`huá_ä“
(
td
);

1016 
	`DEBG
(">");

1017 
»t
 = 0;

1018 
out
:

1019 
	`ä“
(
Î
);

1020  
»t
;

1022 
und”run
:

1023 
»t
 = 4;

1024 
out
;

1025 
	}
}

1029 
STATIC
 
INIT
 
	$šæ©e_block
(

1030 *
e


1034 
t
;

1035 
ulg
 
b
;

1036 
k
;

1038 
	`DEBG
("<blk");

1041 
b
 = 
bb
;

1042 
k
 = 
bk
;

1046 
	`NEEDBITS
(1)

1047 *
e
 = ()
b
 & 1;

1048 
	`DUMPBITS
(1)

1052 
	`NEEDBITS
(2)

1053 
t
 = ()
b
 & 3;

1054 
	`DUMPBITS
(2)

1058 
bb
 = 
b
;

1059 
bk
 = 
k
;

1062 ià(
t
 == 2)

1063  
	`šæ©e_dyÇmic
();

1064 ià(
t
 == 0)

1065  
	`šæ©e_¡Üed
();

1066 ià(
t
 == 1)

1067  
	`šæ©e_fixed
();

1069 
	`DEBG
(">");

1074 
und”run
:

1076 
	}
}

1080 
STATIC
 
INIT
 
	$šæ©e
()

1083 
e
;

1084 
r
;

1085 
h
;

1088 
wp
 = 0;

1089 
bk
 = 0;

1090 
bb
 = 0;

1094 
h
 = 0;

1096 
huás
 = 0;

1097 #ifdeà
ARCH_HAS_DECOMP_WDOG


1098 
	`¬ch_decomp_wdog
();

1100 
r
 = 
	`šæ©e_block
(&
e
);

1101 ià(
r
)

1102  
r
;

1103 ià(
huás
 > 
h
)

1104 
h
 = 
huás
;

1105 } !
e
);

1110 
bk
 >= 8) {

1111 
bk
 -= 8;

1112 
š±r
--;

1116 
	`æush_ouut
(
wp
);

1120 #ifdeà
DEBUG


1121 
	`årštf
(
¡d”r
, "<%u> ", 
h
);

1124 
	}
}

1132 
ulg
 
	güc_32_b
[256];

1133 
ulg
 
	güc
;

1134 
	#CRC_VALUE
 (
üc
 ^ 0xffffffffUL)

	)

1141 
INIT


1142 
	$makeüc
()

1146 
c
;

1147 
e
;

1148 
i
;

1149 
k
;

1152 cÚ¡ 
p
[] = {0,1,2,4,5,7,8,10,11,12,16,22,23,26};

1155 
e
 = 0;

1156 
i
 = 0; i < (
p
)/(); i++)

1157 
e
 |ğ1L << (31 - 
p
[
i
]);

1159 
üc_32_b
[0] = 0;

1161 
i
 = 1; i < 256; i++)

1163 
c
 = 0;

1164 
k
 = 
i
 | 256; k != 1; k >>= 1)

1166 
c
 = c & 1 ? (ø>> 1è^ 
e
 : c >> 1;

1167 ià(
k
 & 1)

1168 
c
 ^ğ
e
;

1170 
üc_32_b
[
i
] = 
c
;

1174 
üc
 = (
ulg
)0xffffffffUL;

1175 
	}
}

1178 
	#ASCII_FLAG
 0x01

	)

1179 
	#CONTINUATION
 0x02

	)

1180 
	#EXTRA_FIELD
 0x04

	)

1181 
	#ORIG_NAME
 0x08

	)

1182 
	#COMMENT
 0x10

	)

1183 
	#ENCRYPTED
 0x20

	)

1184 
	#RESERVED
 0xC0

	)

1189 
INIT
 
	$gunz
()

1191 
uch
 
æags
;

1192 
magic
[2];

1193 
m‘hod
;

1194 
ulg
 
Üig_üc
 = 0;

1195 
ulg
 
Üig_Ën
 = 0;

1196 
»s
;

1198 
magic
[0] = 
	`NEXTBYTE
();

1199 
magic
[1] = 
	`NEXTBYTE
();

1200 
m‘hod
 = 
	`NEXTBYTE
();

1202 ià(
magic
[0] != 037 ||

1203 ((
magic
[1] != 0213) && (magic[1] != 0236))) {

1204 
	`”rÜ
("bad gzip magic‚umbers");

1209 ià(
m‘hod
 != 8) {

1210 
	`”rÜ
("internalƒrror, invalid method");

1214 
æags
 = (
uch
)
	`g‘_by‹
();

1215 ià((
æags
 & 
ENCRYPTED
) != 0) {

1216 
	`”rÜ
("Input isƒncrypted");

1219 ià((
æags
 & 
CONTINUATION
) != 0) {

1220 
	`”rÜ
("Multi…art input");

1223 ià((
æags
 & 
RESERVED
) != 0) {

1224 
	`”rÜ
("Input has invalid flags");

1227 
	`NEXTBYTE
();

1228 
	`NEXTBYTE
();

1229 
	`NEXTBYTE
();

1230 
	`NEXTBYTE
();

1232 ()
	`NEXTBYTE
();

1233 ()
	`NEXTBYTE
();

1235 ià((
æags
 & 
EXTRA_FIELD
) != 0) {

1236 
Ën
 = ()
	`NEXTBYTE
();

1237 
Ën
 |ğ(()
	`NEXTBYTE
())<<8;

1238 
Ën
--è()
	`NEXTBYTE
();

1242 ià((
æags
 & 
ORIG_NAME
) != 0) {

1244 
	`NEXTBYTE
() != 0) ;

1248 ià((
æags
 & 
COMMENT
) != 0) {

1249 
	`NEXTBYTE
() != 0) ;

1253 ià((
»s
 = 
	`šæ©e
())) {

1254 
»s
) {

1258 
	`”rÜ
("invalid compressed format (err=1)");

1261 
	`”rÜ
("invalid compressed format (err=2)");

1264 
	`”rÜ
("out of memory");

1267 
	`”rÜ
("out of input data");

1270 
	`”rÜ
("invalid compressed format (other)");

1279 
Üig_üc
 = (
ulg
è
	`NEXTBYTE
();

1280 
Üig_üc
 |ğ(
ulg
è
	`NEXTBYTE
() << 8;

1281 
Üig_üc
 |ğ(
ulg
è
	`NEXTBYTE
() << 16;

1282 
Üig_üc
 |ğ(
ulg
è
	`NEXTBYTE
() << 24;

1284 
Üig_Ën
 = (
ulg
è
	`NEXTBYTE
();

1285 
Üig_Ën
 |ğ(
ulg
è
	`NEXTBYTE
() << 8;

1286 
Üig_Ën
 |ğ(
ulg
è
	`NEXTBYTE
() << 16;

1287 
Üig_Ën
 |ğ(
ulg
è
	`NEXTBYTE
() << 24;

1290 ià(
Üig_üc
 !ğ
CRC_VALUE
) {

1291 
	`”rÜ
("crcƒrror");

1294 ià(
Üig_Ën
 !ğ
by‹s_out
) {

1295 
	`”rÜ
("lengthƒrror");

1300 
und”run
:

1301 
	`”rÜ
("out of input data");

1303 
	}
}

	@kernel.c

7 
	~<x’/cÚfig.h
>

8 
	~<x’/š™.h
>

9 
	~<x’/lib.h
>

10 
	~<x’/”ºo.h
>

11 
	~<x’/v”siÚ.h
>

12 
	~<x’/sched.h
>

13 
	~<x’/·gšg.h
>

14 
	~<x’/nmi.h
>

15 
	~<x’/gue¡_acûss.h
>

16 
	~<asm/cu¼’t.h
>

17 
	~<public/nmi.h
>

18 
	~<public/v”siÚ.h
>

19 #ifdeà
CONFIG_X86


20 
	~<asm/sh¬ed.h
>

23 #iâdeà
COMPAT


25 
	gš‹d
;

27 
x’_commªdlše_t
 
	g§ved_cmdlše
;

29 
__š™
 
	$assign_š‹g”_·¿m
(

30 
k”Ãl_·¿m
 *
·¿m
, 
ušt64_t
 
v®
)

32  
·¿m
->
Ën
 )

34 (
ušt8_t
):

35 *(
ušt8_t
 *)
·¿m
->
v¬
 = 
v®
;

37 (
ušt16_t
):

38 *(
ušt16_t
 *)
·¿m
->
v¬
 = 
v®
;

40 (
ušt32_t
):

41 *(
ušt32_t
 *)
·¿m
->
v¬
 = 
v®
;

43 (
ušt64_t
):

44 *(
ušt64_t
 *)
·¿m
->
v¬
 = 
v®
;

47 
	`BUG
();

49 
	}
}

51 
__š™
 
	$cmdlše_·r£
(*
cmdlše
)

53 
İt
[100], *
İtv®
, *
İtkey
, *
q
;

54 cÚ¡ *
p
 = 
cmdlše
;

55 
k”Ãl_·¿m
 *
·¿m
;

56 
boŞ_as£¹
;

58 
	`§ã_¡rıy
(
§ved_cmdlše
, 
cmdlše
);

60 iàĞ
p
 =ğ
NULL
 )

66  *
p
 == ' ' )

67 
p
++;

68 iàĞ*
p
 == '\0' )

72 
q
 = 
İtkey
 = 
İt
;

73  (*
p
 != ' ') && (*p != '\0') )

75 iàĞ(
q
-
İt
) < ((opt)-1) )

76 *
q
++ = *
p
;

77 
p
++;

79 *
q
 = '\0';

82 
İtv®
 = 
	`¡rchr
(
İt
, '=');

83 iàĞ
İtv®
 !ğ
NULL
 )

84 *
İtv®
++ = '\0';

86 
İtv®
 = 
q
;

89 
boŞ_as£¹
 = !!
	`¡ºcmp
("no-", 
İtkey
, 3);

90 iàĞ!
boŞ_as£¹
 )

91 
İtkey
 += 3;

93  
·¿m
 = &
__£tup_¡¬t
;…¬am <ğ&
__£tup_’d
;…aram++ )

95 iàĞ
	`¡rcmp
(
·¿m
->
Çme
, 
İtkey
) )

98  
·¿m
->
ty³
 )

100 
OPT_STR
:

101 
	`¡¾ıy
(
·¿m
->
v¬
, 
İtv®
,…¬am->
Ën
);

103 
OPT_UINT
:

104 
	`assign_š‹g”_·¿m
(

105 
·¿m
,

106 
	`sim¶e_¡¹Şl
(
İtv®
, 
NULL
, 0));

108 
OPT_BOOL
:

109 
OPT_INVBOOL
:

110 iàĞ!
	`·r£_boŞ
(
İtv®
) )

111 
boŞ_as£¹
 = !bool_assert;

112 
	`assign_š‹g”_·¿m
(

113 
·¿m
,

114 (
·¿m
->
ty³
 =ğ
OPT_BOOL
è=ğ
boŞ_as£¹
);

116 
OPT_SIZE
:

117 
	`assign_š‹g”_·¿m
(

118 
·¿m
,

119 
	`·r£_size_ªd_un™
(
İtv®
, 
NULL
));

121 
OPT_CUSTOM
:

122 (((*)(cÚ¡ *))
·¿m
->
v¬
)(
İtv®
);

125 
	`BUG
();

130 
	}
}

132 
__š™
 
	$·r£_boŞ
(cÚ¡ *
s
)

134 iàĞ!
	`¡rcmp
("no", 
s
) ||

135 !
	`¡rcmp
("off", 
s
) ||

136 !
	`¡rcmp
("çl£", 
s
) ||

137 !
	`¡rcmp
("di§bË", 
s
) ||

138 !
	`¡rcmp
("0", 
s
) )

141 iàĞ!
	`¡rcmp
("yes", 
s
) ||

142 !
	`¡rcmp
("Ú", 
s
) ||

143 !
	`¡rcmp
("Œue", 
s
) ||

144 !
	`¡rcmp
("’abË", 
s
) ||

145 !
	`¡rcmp
("1", 
s
) )

149 
	}
}

160 *
	$´št_š‹d
(*
¡r
)

162 iàĞ
š‹d
 )

164 
	`¢´štf
(
¡r
, 
TAINT_STRING_MAX_LEN
, "Tainted: %c%c%c%c",

165 
š‹d
 & 
TAINT_UNSAFE_SMP
 ? 'S' : ' ',

166 
š‹d
 & 
TAINT_MACHINE_CHECK
 ? 'M' : ' ',

167 
š‹d
 & 
TAINT_BAD_PAGE
 ? 'B' : ' ',

168 
š‹d
 & 
TAINT_SYNC_CONSOLE
 ? 'C' : ' ');

172 
	`¢´štf
(
¡r
, 
TAINT_STRING_MAX_LEN
, "Notainted");

175  
¡r
;

176 
	}
}

178 
	$add_št
(
æag
)

180 
š‹d
 |ğ
æag
;

181 
	}
}

183 
š™ÿÎ_t
 
__š™ÿÎ_¡¬t
, 
__´esmp_š™ÿÎ_’d
, 
__š™ÿÎ_’d
;

185 
__š™
 
	$do_´esmp_š™ÿÎs
()

187 
š™ÿÎ_t
 *
ÿÎ
;

188  
ÿÎ
 = &
__š™ÿÎ_¡¬t
; c®È< &
__´esmp_š™ÿÎ_’d
; call++ )

189 (*
ÿÎ
)();

190 
	}
}

192 
__š™
 
	$do_š™ÿÎs
()

194 
š™ÿÎ_t
 *
ÿÎ
;

195  
ÿÎ
 = &
__´esmp_š™ÿÎ_’d
; c®È< &
__š™ÿÎ_’d
; call++ )

196 (*
ÿÎ
)();

197 
	}
}

199 
	#DO
(
â
è
do_
##
	)
fn

207 
	$DO
(
x’_v”siÚ
)(
cmd
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

209  
cmd
 )

211 
XENVER_v”siÚ
:

213  (
	`x’_majÜ_v”siÚ
(è<< 16è| 
	`x’_mšÜ_v”siÚ
();

216 
XENVER_exŒav”siÚ
:

218 
x’_exŒav”siÚ_t
 
exŒav”siÚ
;

219 
	`§ã_¡rıy
(
exŒav”siÚ
, 
	`x’_exŒa_v”siÚ
());

220 iàĞ
	`cİy_to_gue¡
(
¬g
, 
exŒav”siÚ
, 
	`ARRAY_SIZE
(extraversion)) )

221  -
EFAULT
;

225 
XENVER_compe_šfo
:

227 
x’_compe_šfo
 
šfo
;

228 
	`§ã_¡rıy
(
šfo
.
comp”
, 
	`x’_comp”
());

229 
	`§ã_¡rıy
(
šfo
.
compe_by
, 
	`x’_compe_by
());

230 
	`§ã_¡rıy
(
šfo
.
compe_domaš
, 
	`x’_compe_domaš
());

231 
	`§ã_¡rıy
(
šfo
.
compe_d©e
, 
	`x’_compe_d©e
());

232 iàĞ
	`cİy_to_gue¡
(
¬g
, &
šfo
, 1) )

233  -
EFAULT
;

237 
XENVER_ÿ·b™›s
:

239 
x’_ÿ·b™›s_šfo_t
 
šfo
;

240 
	`¬ch_g‘_x’_ÿps
(
x’_ÿ·b™›s_šfo_t
 *
šfo
);

242 
	`mem£t
(
šfo
, 0, (info));

243 
	`¬ch_g‘_x’_ÿps
(&
šfo
);

245 iàĞ
	`cİy_to_gue¡
(
¬g
, 
šfo
, 
	`ARRAY_SIZE
(info)) )

246  -
EFAULT
;

250 
XENVER_¶©fÜm_·¿m‘”s
:

252 
x’_¶©fÜm_·¿m‘”s_t
 
·¿ms
 = {

253 .
vœt_¡¬t
 = 
HYPERVISOR_VIRT_START


255 iàĞ
	`cİy_to_gue¡
(
¬g
, &
·¿ms
, 1) )

256  -
EFAULT
;

261 
XENVER_chªge£t
:

263 
x’_chªge£t_šfo_t
 
chg£t
;

264 
	`§ã_¡rıy
(
chg£t
, 
	`x’_chªge£t
());

265 iàĞ
	`cİy_to_gue¡
(
¬g
, 
chg£t
, 
	`ARRAY_SIZE
(chgset)) )

266  -
EFAULT
;

270 
XENVER_g‘_ã©u»s
:

272 
x’_ã©u»_šfo_t
 
fi
;

273 
domaš
 *
d
 = 
cu¼’t
->domain;

275 iàĞ
	`cİy_äom_gue¡
(&
fi
, 
¬g
, 1) )

276  -
EFAULT
;

278  
fi
.
subm­_idx
 )

281 
fi
.
subm­
 = 0;

282 iàĞ
	`VM_ASSIST
(
d
, 
VMASST_TYPE_·e_ex‹nded_ü3
) )

283 
fi
.
subm­
 |ğ(1U << 
XENFEAT_·e_pgdœ_above_4gb
);

284 iàĞ
	`·gšg_mode_Œª¦©e
(
cu¼’t
->
domaš
) )

285 
fi
.
subm­
 |=

286 (1U << 
XENFEAT_wr™abË_·ge_bËs
) |

287 (1U << 
XENFEAT_auto_Œª¦©ed_physm­
);

288 iàĞ
su³rvisÜ_mode_k”Ãl
 )

289 
fi
.
subm­
 |ğ1U << 
XENFEAT_su³rvisÜ_mode_k”Ãl
;

290 #ifdeà
CONFIG_X86


291 iàĞ!
	`is_hvm_vıu
(
cu¼’t
) )

292 
fi
.
subm­
 |ğ(1U << 
XENFEAT_mmu_±_upd©e_´e£rve_ad
) |

293 (1U << 
XENFEAT_highmem_assi¡
) |

294 (1U << 
XENFEAT_gÁb_m­_ava_b™s
);

296 
fi
.
subm­
 |ğ(1U << 
XENFEAT_hvm_§ã_pvşock
) |

297 (1U << 
XENFEAT_hvm_ÿÎback_veùÜ
) |

298 (1U << 
XENFEAT_hvm_pœqs
);

302  -
EINVAL
;

305 iàĞ
	`cİy_to_gue¡
(
¬g
, &
fi
, 1) )

306  -
EFAULT
;

310 
XENVER_·gesize
:

312  (!
	`gue¡_hªdË_is_nuÎ
(
¬g
è? -
EINVAL
 : 
PAGE_SIZE
);

315 
XENVER_gue¡_hªdË
:

317 iàĞ
	`cİy_to_gue¡
(
¬g
, 
cu¼’t
->
domaš
->
hªdË
,

318 
	`ARRAY_SIZE
(
cu¼’t
->
domaš
->
hªdË
)) )

319  -
EFAULT
;

323 
XENVER_commªdlše
:

325 iàĞ
	`cİy_to_gue¡
(
¬g
, 
§ved_cmdlše
, 
	`ARRAY_SIZE
(saved_cmdline)) )

326  -
EFAULT
;

331  -
ENOSYS
;

332 
	}
}

334 
	$DO
(
nmi_İ
)(
cmd
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

336 
x’nmi_ÿÎback
 
cb
;

337 
rc
 = 0;

339  
cmd
 )

341 
XENNMI_»gi¡”_ÿÎback
:

342 
rc
 = -
EFAULT
;

343 iàĞ
	`cİy_äom_gue¡
(&
cb
, 
¬g
, 1) )

345 
rc
 = 
	`»gi¡”_gue¡_nmi_ÿÎback
(
cb
.
hªdËr_add»ss
);

347 
XENNMI_uÄegi¡”_ÿÎback
:

348 
rc
 = 
	`uÄegi¡”_gue¡_nmi_ÿÎback
();

351 
rc
 = -
ENOSYS
;

355  
rc
;

356 
	}
}

358 
	$DO
(
vm_assi¡
)(
cmd
, 
ty³
)

360  
	`vm_assi¡
(
cu¼’t
->
domaš
, 
cmd
, 
ty³
);

361 
	}
}

363 
	$DO
(
ni_hy³rÿÎ
)()

366  -
ENOSYS
;

367 
	}
}

	@kexec.c

9 
	~<x’/š™.h
>

10 
	~<x’/lib.h
>

11 
	~<x’/aıi.h
>

12 
	~<x’/ùy³.h
>

13 
	~<x’/”ºo.h
>

14 
	~<x’/gue¡_acûss.h
>

15 
	~<x’/sched.h
>

16 
	~<x’/ty³s.h
>

17 
	~<x’/kexec.h
>

18 
	~<x’/keyhªdËr.h
>

19 
	~<public/kexec.h
>

20 
	~<x’/ıumask.h
>

21 
	~<asm/©omic.h
>

22 
	~<x’/¥šlock.h
>

23 
	~<x’/v”siÚ.h
>

24 
	~<x’/cÚsŞe.h
>

25 
	~<x’/kexec.h
>

26 
	~<public/–âÙe.h
>

27 
	~<xsm/xsm.h
>

28 #ifdeà
CONFIG_COMPAT


29 
	~<com·t/kexec.h
>

32 
DEFINE_PER_CPU_READ_MOSTLY
(*, 
üash_nÙes
);

34 
Elf_NÙe
 *
	gx’_üash_nÙe
;

36 
ıumask_t
 
	güash_§ved_ıus
;

38 
x’_kexec_image_t
 
	gkexec_image
[
KEXEC_IMAGE_NR
];

40 
	#KEXEC_FLAG_DEFAULT_POS
 (
KEXEC_IMAGE_NR
 + 0)

	)

41 
	#KEXEC_FLAG_CRASH_POS
 (
KEXEC_IMAGE_NR
 + 1)

	)

42 
	#KEXEC_FLAG_IN_PROGRESS
 (
KEXEC_IMAGE_NR
 + 2)

	)

44 
	gkexec_æags
 = 0;

46 
¥šlock_t
 
	gkexec_lock
 = 
SPIN_LOCK_UNLOCKED
;

48 
	gvmcÜešfo_d©a
[
VMCOREINFO_BYTES
];

49 
size_t
 
	gvmcÜešfo_size
 = 0;

51 
x’_kexec_»£rve_t
 
	gkexec_üash_¬—
;

53 
u64
 
	m¡¬t
, 
	m’d
;

54 
	msize
;

55 } 
	g¿nges
[16] 
	g__š™d©a
;

70 
__š™
 
	$·r£_üashk”Ãl
(cÚ¡ *
¡r
)

72 cÚ¡ *
cur
;

74 iàĞ
	`¡rchr
(
¡r
, ':' ) )

76 
idx
 = 0;

79 iàĞ
idx
 >ğ
	`ARRAY_SIZE
(
¿nges
) )

81 
	`´štk
(
XENLOG_WARNING
 "crashkernel:oo many„anges\n");

82 
cur
 = 
NULL
;

83 
¡r
 = 
	`¡rchr
(str, '@');

87 
¿nges
[
idx
].
¡¬t
 = 
	`·r£_size_ªd_un™
(
cur
 = 
¡r
 + !!idx, &str);

88 iàĞ
cur
 =ğ
¡r
 )

91 iàĞ*
¡r
 != '-' )

93 
	`´štk
(
XENLOG_WARNING
 "crashkernel: '-'ƒxpected\n");

97 iàĞ*++
¡r
 != ':' )

99 
¿nges
[
idx
].
’d
 = 
	`·r£_size_ªd_un™
(
cur
 = 
¡r
, &str);

100 iàĞ
cur
 =ğ
¡r
 )

102 iàĞ
¿nges
[
idx
].
’d
 <ğ¿nges[idx].
¡¬t
 )

104 
	`´štk
(
XENLOG_WARNING
 "crashkernel:ƒnd <= start\n");

109 
¿nges
[
idx
].
’d
 = -1;

111 iàĞ*
¡r
 != ':' )

113 
	`´štk
(
XENLOG_WARNING
 "crashkernel: ':'ƒxpected\n");

117 
¿nges
[
idx
].
size
 = 
	`·r£_size_ªd_un™
(
cur
 = 
¡r
 + 1, &str);

118 iàĞ
cur
 =ğ
¡r
 )

121 ++
idx
;

122 }  *
¡r
 == ',' );

123 iàĞ
idx
 < 
	`ARRAY_SIZE
(
¿nges
) )

124 
¿nges
[
idx
].
size
 = 0;

127 
kexec_üash_¬—
.
size
 = 
	`·r£_size_ªd_un™
(
cur
 = 
¡r
, &str);

128 iàĞ
cur
 !ğ
¡r
 && *str == '@' )

129 
kexec_üash_¬—
.
¡¬t
 = 
	`·r£_size_ªd_un™
(
cur
 = 
¡r
 + 1, &str);

130 iàĞ
cur
 =ğ
¡r
 )

131 
	`´štk
(
XENLOG_WARNING
 "crashkernel: memory valueƒxpected\n");

132 
	}
}

133 
cu¡om_·¿m
("üashk”Ãl", 
·r£_üashk”Ãl
);

135 
__š™
 
	$£t_kexec_üash_¬—_size
(
u64
 
sy¡em_¿m
)

137 
idx
;

139  
idx
 = 0; idx < 
	`ARRAY_SIZE
(
¿nges
è&& !
kexec_üash_¬—
.
size
; ++idx )

141 iàĞ!
¿nges
[
idx
].
size
 )

144 iàĞ
¿nges
[
idx
].
size
 >ğ
sy¡em_¿m
 )

146 
	`´štk
(
XENLOG_WARNING
 "crashkernel: invalid size\n");

150 iàĞ
¿nges
[
idx
].
¡¬t
 <ğ
sy¡em_¿m
 &&„ªges[idx].
’d
 > system_ram )

151 
kexec_üash_¬—
.
size
 = 
¿nges
[
idx
].size;

153 
	}
}

155 
	$Úe_ıu_Úly
()

158 iàĞ
	`‹¡_ªd_£t_b™
(
KEXEC_FLAG_IN_PROGRESS
, &
kexec_æags
) )

160 
	}
}

163 
	$kexec_üash_§ve_ıu
()

165 
ıu
 = 
	`smp_´oûssÜ_id
();

166 
Elf_NÙe
 *
nÙe
 = 
	`³r_ıu
(
üash_nÙes
, 
ıu
);

167 
ELF_Pr¡©us
 *
´¡©us
;

168 
üash_x’_cÜe_t
 *
x’cÜe
;

170 iàĞ
	`ıu_‹¡_ªd_£t
(
ıu
, 
üash_§ved_ıus
) )

173 
´¡©us
 = (
ELF_Pr¡©us
 *)
	`ELFNOTE_DESC
(
nÙe
);

175 
nÙe
 = 
	`ELFNOTE_NEXT
(note);

176 
x’cÜe
 = (
üash_x’_cÜe_t
 *)
	`ELFNOTE_DESC
(
nÙe
);

178 
	`–f_cÜe_§ve_»gs
(&
´¡©us
->
´_»g
, 
x’cÜe
);

179 
	}
}

182 
üash_x’_šfo_t
 *
	$kexec_üash_§ve_šfo
()

184 
ıu
 = 
	`smp_´oûssÜ_id
();

185 
üash_x’_šfo_t
 
šfo
;

186 
üash_x’_šfo_t
 *
out
 = (üash_x’_šfo_ˆ*)
	`ELFNOTE_DESC
(
x’_üash_nÙe
);

188 
	`BUG_ON
(!
	`ıu_‹¡_ªd_£t
(
ıu
, 
üash_§ved_ıus
));

190 
	`mem£t
(&
šfo
, 0, (info));

191 
šfo
.
x’_majÜ_v”siÚ
 = 
	`x’_majÜ_v”siÚ
();

192 
šfo
.
x’_mšÜ_v”siÚ
 = 
	`x’_mšÜ_v”siÚ
();

193 
šfo
.
x’_exŒa_v”siÚ
 = 
	`__·
(
	`x’_exŒa_v”siÚ
());

194 
šfo
.
x’_chªge£t
 = 
	`__·
(
	`x’_chªge£t
());

195 
šfo
.
x’_comp”
 = 
	`__·
(
	`x’_comp”
());

196 
šfo
.
x’_compe_d©e
 = 
	`__·
(
	`x’_compe_d©e
());

197 
šfo
.
x’_compe_time
 = 
	`__·
(
	`x’_compe_time
());

198 
šfo
.
š‹d
 =ainted;

201 
	`memıy
(
out
, &
šfo
, (info));

203  
out
;

204 
	}
}

206 
	$kexec_commÚ_shutdown
()

208 
	`w©chdog_di§bË
();

209 
	`cÚsŞe_¡¬t_sync
();

210 
	`¥š_debug_di§bË
();

211 
	`Úe_ıu_Úly
();

212 
	`aıi_dm¬_»š¡©e
();

213 
	}
}

215 
	$kexec_üash
()

217 
pos
;

219 
pos
 = (
	`‹¡_b™
(
KEXEC_FLAG_CRASH_POS
, &
kexec_æags
) != 0);

220 iàĞ!
	`‹¡_b™
(
KEXEC_IMAGE_CRASH_BASE
 + 
pos
, &
kexec_æags
) )

223 
	`kexec_commÚ_shutdown
();

224 
	`kexec_üash_§ve_ıu
();

225 
	`machše_üash_shutdown
();

226 
	`machše_kexec
(&
kexec_image
[
KEXEC_IMAGE_CRASH_BASE
 + 
pos
]);

228 
	`BUG
();

229 
	}
}

231 
	$kexec_»boÙ
(*
_image
)

233 
x’_kexec_image_t
 *
image
 = 
_image
;

235 
	`kexec_commÚ_shutdown
();

236 
	`machše_»boÙ_kexec
(
image
);

238 
	`BUG
();

240 
	}
}

242 
	$do_üashdump_Œigg”
(
key
)

244 
	`´štk
("'%c'…»s£d ->rigg”šg c¿shdump\n", 
key
);

245 
	`kexec_üash
();

246 
	`´štk
(" *‚o crash kernel†oaded!\n");

247 
	}
}

249 
keyhªdËr
 
	güashdump_Œigg”_keyhªdËr
 = {

250 .
u
.
â
 = 
do_üashdump_Œigg”
,

251 .
	gdesc
 = "trigger‡ crashdump"

254 
__š™
 
	$»gi¡”_üashdump_Œigg”
()

256 
	`»gi¡”_keyhªdËr
('C', &
üashdump_Œigg”_keyhªdËr
);

258 
	}
}

259 
__š™ÿÎ
(
»gi¡”_üashdump_Œigg”
);

261 
	$£tup_nÙe
(
Elf_NÙe
 *
n
, cÚ¡ *
Çme
, 
ty³
, 
descsz
)

263 
l
 = 
	`¡¾’
(
Çme
) + 1;

264 
	`¡¾ıy
(
	`ELFNOTE_NAME
(
n
), 
Çme
, 
l
);

265 
n
->
Çmesz
 = 
l
;

266 
n
->
descsz
 = descsz;

267 
n
->
ty³
 =ype;

268 
	}
}

270 
	$sizeof_nÙe
(cÚ¡ *
Çme
, 
descsz
)

272  ((
Elf_NÙe
) +

273 
	`ELFNOTE_ALIGN
(
	`¡¾’
(
Çme
)+1) +

274 
	`ELFNOTE_ALIGN
(
descsz
));

275 
	}
}

277 
	$kexec_g‘_»£rve
(
x’_kexec_¿nge_t
 *
¿nge
)

279 iàĞ
kexec_üash_¬—
.
size
 > 0 && kexec_üash_¬—.
¡¬t
 > 0) {

280 
¿nge
->
¡¬t
 = 
kexec_üash_¬—
.start;

281 
¿nge
->
size
 = 
kexec_üash_¬—
.size;

284 
¿nge
->
¡¬t
 =„ªge->
size
 = 0;

286 
	}
}

288 
	$kexec_g‘_ıu
(
x’_kexec_¿nge_t
 *
¿nge
)

290 
Ä
 = 
¿nge
->nr;

291 
Ä_by‹s
 = 0;

293 iàĞ
Ä
 < 0 ||‚¸>ğ
NR_CPUS
 || !
	`ıu_Úlše
(nr) )

294  -
EINVAL
;

296 
Ä_by‹s
 +ğ
	`sizeof_nÙe
("CORE", (
ELF_Pr¡©us
));

297 
Ä_by‹s
 +ğ
	`sizeof_nÙe
("X’", (
üash_x’_cÜe_t
));

300 iàĞ
Ä
 == 0 )

301 
Ä_by‹s
 +ğ
	`sizeof_nÙe
("X’", (
üash_x’_šfo_t
));

303 iàĞ
	`³r_ıu
(
üash_nÙes
, 
Ä
è=ğ
NULL
 )

305 
Elf_NÙe
 *
nÙe
;

307 
nÙe
 = 
	`³r_ıu
(
üash_nÙes
, 
Ä
èğ
	`xm®loc_by‹s
(
Ä_by‹s
);

309 iàĞ
nÙe
 =ğ
NULL
 )

310  -
ENOMEM
;

313 
	`£tup_nÙe
(
nÙe
, "CORE", 
NT_PRSTATUS
, (
ELF_Pr¡©us
));

316 
nÙe
 = 
	`ELFNOTE_NEXT
(note);

317 
	`£tup_nÙe
(
nÙe
, "X’", 
XEN_ELFNOTE_CRASH_REGS
, (
üash_x’_cÜe_t
));

319 ià(
Ä
 == 0)

322 
x’_üash_nÙe
 = 
nÙe
 = 
	`ELFNOTE_NEXT
(note);

323 
	`£tup_nÙe
(
nÙe
, "X’", 
XEN_ELFNOTE_CRASH_INFO
, (
üash_x’_šfo_t
));

327 
¿nge
->
¡¬t
 = 
	`__·
(()
	`³r_ıu
(
üash_nÙes
, 
Ä
));

328 
¿nge
->
size
 = 
Ä_by‹s
;

330 
	}
}

332 
	$kexec_g‘_vmcÜešfo
(
x’_kexec_¿nge_t
 *
¿nge
)

334 
¿nge
->
¡¬t
 = 
	`__·
(()
vmcÜešfo_d©a
);

335 
¿nge
->
size
 = 
VMCOREINFO_BYTES
;

337 
	}
}

339 
	$kexec_g‘_¿nge_š‹º®
(
x’_kexec_¿nge_t
 *
¿nge
)

341 
»t
 = -
EINVAL
;

343  
¿nge
->range )

345 
KEXEC_RANGE_MA_CRASH
:

346 
»t
 = 
	`kexec_g‘_»£rve
(
¿nge
);

348 
KEXEC_RANGE_MA_CPU
:

349 
»t
 = 
	`kexec_g‘_ıu
(
¿nge
);

351 
KEXEC_RANGE_MA_VMCOREINFO
:

352 
»t
 = 
	`kexec_g‘_vmcÜešfo
(
¿nge
);

355 
»t
 = 
	`machše_kexec_g‘
(
¿nge
);

359  
»t
;

360 
	}
}

362 
kexec_g‘_¿nge
(
	$XEN_GUEST_HANDLE
(è
u¬g
)

364 
x’_kexec_¿nge_t
 
¿nge
;

365 
»t
 = -
EINVAL
;

367 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
¿nge
, 
u¬g
, 1)) )

368  -
EFAULT
;

370 
»t
 = 
	`kexec_g‘_¿nge_š‹º®
(&
¿nge
);

372 iàĞ
»t
 =ğ0 && 
	`uÆik–y
(
	`cİy_to_gue¡
(
u¬g
, &
¿nge
, 1)) )

373  -
EFAULT
;

375  
»t
;

376 
	}
}

378 
kexec_g‘_¿nge_com·t
(
	$XEN_GUEST_HANDLE
(è
u¬g
)

380 #ifdeà
CONFIG_COMPAT


381 
x’_kexec_¿nge_t
 
¿nge
;

382 
com·t_kexec_¿nge_t
 
com·t_¿nge
;

383 
»t
 = -
EINVAL
;

385 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
com·t_¿nge
, 
u¬g
, 1)) )

386  -
EFAULT
;

388 
	`XLAT_kexec_¿nge
(&
¿nge
, &
com·t_¿nge
);

390 
»t
 = 
	`kexec_g‘_¿nge_š‹º®
(&
¿nge
);

392 iàĞ
»t
 == 0 ) {

393 
	`XLAT_kexec_¿nge
(&
com·t_¿nge
, &
¿nge
);

394 iàĞ
	`uÆik–y
(
	`cİy_to_gue¡
(
u¬g
, &
com·t_¿nge
, 1)) )

395  -
EFAULT
;

398  
»t
;

402 
	}
}

404 
	$kexec_lßd_g‘_b™s
(
ty³
, *
ba£
, *
b™
)

406  
ty³
 )

408 
KEXEC_TYPE_DEFAULT
:

409 *
ba£
 = 
KEXEC_IMAGE_DEFAULT_BASE
;

410 *
b™
 = 
KEXEC_FLAG_DEFAULT_POS
;

412 
KEXEC_TYPE_CRASH
:

413 *
ba£
 = 
KEXEC_IMAGE_CRASH_BASE
;

414 *
b™
 = 
KEXEC_FLAG_CRASH_POS
;

420 
	}
}

422 
	$vmcÜešfo_­³nd_¡r
(cÚ¡ *
fmt
, ...)

424 
va_li¡
 
¬gs
;

425 
buf
[0x50];

426 
r
;

427 
size_t
 
nÙe_size
 = (
Elf_NÙe
è+ 
	`ELFNOTE_ALIGN
(
	`¡¾’
(
VMCOREINFO_NOTE_NAME
) + 1);

429 ià(
vmcÜešfo_size
 + 
nÙe_size
 + (
buf
è> 
VMCOREINFO_BYTES
)

432 
	`va_¡¬t
(
¬gs
, 
fmt
);

433 
r
 = 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
¬gs
);

434 
	`va_’d
(
¬gs
);

436 
	`memıy
(&
vmcÜešfo_d©a
[
nÙe_size
 + 
vmcÜešfo_size
], 
buf
, 
r
);

438 
vmcÜešfo_size
 +ğ
r
;

439 
	}
}

441 
	$üash_§ve_vmcÜešfo
()

443 
size_t
 
d©a_size
;

445 ià(
vmcÜešfo_size
 > 0)

448 
d©a_size
 = 
VMCOREINFO_BYTES
 - ((
Elf_NÙe
è+ 
	`ELFNOTE_ALIGN
(
	`¡¾’
(
VMCOREINFO_NOTE_NAME
) + 1));

449 
	`£tup_nÙe
((
Elf_NÙe
 *)
vmcÜešfo_d©a
, 
VMCOREINFO_NOTE_NAME
, 0, 
d©a_size
);

451 
	`VMCOREINFO_PAGESIZE
(
PAGE_SIZE
);

453 
	`VMCOREINFO_SYMBOL
(
domaš_li¡
);

454 #iâdeà
äame_bË


455 
	`VMCOREINFO_SYMBOL
(
äame_bË
);

458 cÚ¡ *cÚ¡ 
_äame_bË
 = 
äame_bË
;

459 
	`VMCOREINFO_SYMBOL_ALIAS
(
äame_bË
, 
_äame_bË
);

462 
	`VMCOREINFO_SYMBOL
(
max_·ge
);

464 
	`VMCOREINFO_STRUCT_SIZE
(
·ge_šfo
);

465 
	`VMCOREINFO_STRUCT_SIZE
(
domaš
);

467 
	`VMCOREINFO_OFFSET
(
·ge_šfo
, 
couÁ_šfo
);

468 #ifdeà
__Ÿ64__


469 
	`VMCOREINFO_OFFSET_SUB
(
·ge_šfo
, 
u
.
šu£
, 
_domaš
);

471 
	`VMCOREINFO_OFFSET_SUB
(
·ge_šfo
, 
v
.
šu£
, 
_domaš
);

473 
	`VMCOREINFO_OFFSET
(
domaš
, 
domaš_id
);

474 
	`VMCOREINFO_OFFSET
(
domaš
, 
Ãxt_š_li¡
);

476 #ifdeà
ARCH_CRASH_SAVE_VMCOREINFO


477 
	`¬ch_üash_§ve_vmcÜešfo
();

479 
	}
}

481 
	$kexec_lßd_uÆßd_š‹º®
(
İ
, 
x’_kexec_lßd_t
 *
lßd
)

483 
x’_kexec_image_t
 *
image
;

484 
ba£
, 
b™
, 
pos
;

485 
»t
 = 0;

487 iàĞ
	`kexec_lßd_g‘_b™s
(
lßd
->
ty³
, &
ba£
, &
b™
) )

488  -
EINVAL
;

490 
pos
 = (
	`‹¡_b™
(
b™
, &
kexec_æags
) != 0);

493 iàĞ
İ
 =ğ
KEXEC_CMD_kexec_lßd
 )

495 
image
 = &
kexec_image
[
ba£
 + !
pos
];

497 
	`BUG_ON
(
	`‹¡_b™
((
ba£
 + !
pos
), &
kexec_æags
));

499 
	`memıy
(
image
, &
lßd
->image, (*image));

501 iàĞ!(
»t
 = 
	`machše_kexec_lßd
(
lßd
->
ty³
, 
ba£
 + !
pos
, 
image
)) )

504 
	`£t_b™
((
ba£
 + !
pos
), &
kexec_æags
);

507 
	`chªge_b™
(
b™
, &
kexec_æags
);

510 
	`üash_§ve_vmcÜešfo
();

514 iàĞ
»t
 =ğ0 && !
	`‹¡_b™
(
KEXEC_FLAG_IN_PROGRESS
, &
kexec_æags
) )

516 iàĞ
	`‹¡_ªd_ş—r_b™
((
ba£
 + 
pos
), &
kexec_æags
) )

518 
image
 = &
kexec_image
[
ba£
 + 
pos
];

519 
	`machše_kexec_uÆßd
(
lßd
->
ty³
, 
ba£
 + 
pos
, 
image
);

523  
»t
;

524 
	}
}

526 
kexec_lßd_uÆßd
(
İ
, 
	$XEN_GUEST_HANDLE
(è
u¬g
)

528 
x’_kexec_lßd_t
 
lßd
;

530 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
lßd
, 
u¬g
, 1)) )

531  -
EFAULT
;

533  
	`kexec_lßd_uÆßd_š‹º®
(
İ
, &
lßd
);

534 
	}
}

536 
kexec_lßd_uÆßd_com·t
(
İ
,

537 
	$XEN_GUEST_HANDLE
(è
u¬g
)

539 #ifdeà
CONFIG_COMPAT


540 
com·t_kexec_lßd_t
 
com·t_lßd
;

541 
x’_kexec_lßd_t
 
lßd
;

543 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
com·t_lßd
, 
u¬g
, 1)) )

544  -
EFAULT
;

553 
lßd
.
ty³
 = 
com·t_lßd
.type;

554 
	`XLAT_kexec_image
(&
lßd
.
image
, &
com·t_lßd
.image);

556  
	`kexec_lßd_uÆßd_š‹º®
(
İ
, &
lßd
);

560 
	}
}

562 
kexec_exec
(
	$XEN_GUEST_HANDLE
(è
u¬g
)

564 
x’_kexec_exec_t
 
exec
;

565 
x’_kexec_image_t
 *
image
;

566 
ba£
, 
b™
, 
pos
, 
»t
 = -
EINVAL
;

568 iàĞ
	`uÆik–y
(
	`cİy_äom_gue¡
(&
exec
, 
u¬g
, 1)) )

569  -
EFAULT
;

571 iàĞ
	`kexec_lßd_g‘_b™s
(
exec
.
ty³
, &
ba£
, &
b™
) )

572  -
EINVAL
;

574 
pos
 = (
	`‹¡_b™
(
b™
, &
kexec_æags
) != 0);

577 iàĞ!
	`‹¡_b™
(
ba£
 + 
pos
, &
kexec_æags
) )

578  -
ENOENT
;

580 
exec
.
ty³
)

582 
KEXEC_TYPE_DEFAULT
:

583 
image
 = &
kexec_image
[
ba£
 + 
pos
];

584 
»t
 = 
	`cÚtšue_hy³rÿÎ_Ú_ıu
(0, 
kexec_»boÙ
, 
image
);

586 
KEXEC_TYPE_CRASH
:

587 
	`kexec_üash
();

591  -
EINVAL
;

592 
	}
}

594 
do_kexec_İ_š‹º®
(
İ
, 
	$XEN_GUEST_HANDLE
(è
u¬g
,

595 
com·t
)

597 
æags
;

598 
»t
 = -
EINVAL
;

600 iàĞ!
	`IS_PRIV
(
cu¼’t
->
domaš
) )

601  -
EPERM
;

603 
»t
 = 
	`xsm_kexec
();

604 iàĞ
»t
 )

605  
»t
;

607  
İ
 )

609 
KEXEC_CMD_kexec_g‘_¿nge
:

610 ià(
com·t
)

611 
»t
 = 
	`kexec_g‘_¿nge_com·t
(
u¬g
);

613 
»t
 = 
	`kexec_g‘_¿nge
(
u¬g
);

615 
KEXEC_CMD_kexec_lßd
:

616 
KEXEC_CMD_kexec_uÆßd
:

617 
	`¥š_lock_œq§ve
(&
kexec_lock
, 
æags
);

618 ià(!
	`‹¡_b™
(
KEXEC_FLAG_IN_PROGRESS
, &
kexec_æags
))

620 ià(
com·t
)

621 
»t
 = 
	`kexec_lßd_uÆßd_com·t
(
İ
, 
u¬g
);

623 
»t
 = 
	`kexec_lßd_uÆßd
(
İ
, 
u¬g
);

625 
	`¥š_uÆock_œq»¡Üe
(&
kexec_lock
, 
æags
);

627 
KEXEC_CMD_kexec
:

628 
»t
 = 
	`kexec_exec
(
u¬g
);

632  
»t
;

633 
	}
}

635 
do_kexec_İ
(
İ
, 
	$XEN_GUEST_HANDLE
(è
u¬g
)

637  
	`do_kexec_İ_š‹º®
(
İ
, 
u¬g
, 0);

638 
	}
}

640 #ifdeà
CONFIG_COMPAT


641 
com·t_kexec_İ
(
İ
, 
	$XEN_GUEST_HANDLE
(è
u¬g
)

643  
	`do_kexec_İ_š‹º®
(
İ
, 
u¬g
, 1);

644 
	}
}

	@keyhandler.c

5 
	~<asm/»gs.h
>

6 
	~<x’/keyhªdËr.h
>

7 
	~<x’/shutdown.h
>

8 
	~<x’/ev’t.h
>

9 
	~<x’/cÚsŞe.h
>

10 
	~<x’/£rŸl.h
>

11 
	~<x’/sched.h
>

12 
	~<x’/skËt.h
>

13 
	~<x’/domaš.h
>

14 
	~<x’/¿nge£t.h
>

15 
	~<x’/com·t.h
>

16 
	~<x’/ùy³.h
>

17 
	~<asm/debugg”.h
>

18 
	~<asm/div64.h
>

20 
keyhªdËr
 *
	gkey_bË
[256];

21 
	gkey´ess_key
;

22 
boŞ_t
 
	g®t_key_hªdlšg
;

24 
	gkeyhªdËr_sü©ch
[1024];

26 
	$key´ess_aùiÚ
(
unu£d
)

28 
	`hªdË_key´ess
(
key´ess_key
, 
NULL
);

29 
	}
}

31 
DECLARE_TASKLET
(
key´ess_skËt
, 
key´ess_aùiÚ
, 0);

33 
	$hªdË_key´ess
(
key
, 
ıu_u£r_»gs
 *
»gs
)

35 
keyhªdËr
 *
h
;

37 iàĞ(
h
 = 
key_bË
[
key
]è=ğ
NULL
 )

40 iàĞ!
	`š_œq
(è|| 
h
->
œq_ÿÎback
 )

42 
	`cÚsŞe_¡¬t_log_ev”ythšg
();

43 
h
->
œq_ÿÎback
 ? (*h->
u
.
œq_â
)(
key
, 
»gs
è: (*h->u.
â
)(key);

44 
	`cÚsŞe_’d_log_ev”ythšg
();

48 
key´ess_key
 = 
key
;

49 
	`skËt_scheduË
(&
key´ess_skËt
);

51 
	}
}

53 
	$»gi¡”_keyhªdËr
(
key
, 
keyhªdËr
 *
hªdËr
)

55 
	`ASSERT
(
key_bË
[
key
] =ğ
NULL
);

56 
key_bË
[
key
] = 
hªdËr
;

57 
	}
}

59 
	$show_hªdËrs
(
key
)

61 
i
;

62 
	`´štk
("'%c'…»s£d -> showšg in¡®Ëd hªdËrs\n", 
key
);

63  
i
 = 0; i < 
	`ARRAY_SIZE
(
key_bË
); i++ )

64 iàĞ
key_bË
[
i
] !ğ
NULL
 )

65 
	`´štk
(" key '%c' (ascii '%02x') => %s\n",

66 
	`i¥ršt
(
i
è? i : ' ', i, 
key_bË
[i]->
desc
);

67 
	}
}

69 
keyhªdËr
 
	gshow_hªdËrs_keyhªdËr
 = {

70 .
u
.
â
 = 
show_hªdËrs
,

71 .
	gdesc
 = "showhis message"

74 
ıumask_t
 
	gdump_exec¡©e_mask
;

76 
	$dump_exec¡©e
(
ıu_u£r_»gs
 *
»gs
)

78 
ıu
 = 
	`smp_´oûssÜ_id
();

80 iàĞ!
	`gue¡_mode
(
»gs
) )

82 
	`´štk
("*** Dumpšg CPU%u ho¡ s‹: ***\n", 
ıu
);

83 
	`show_executiÚ_¡©e
(
»gs
);

86 iàĞ!
	`is_idË_vıu
(
cu¼’t
) )

88 
	`´štk
("*** Dumping CPU%u guest state (d%d:v%d): ***\n",

89 
	`smp_´oûssÜ_id
(), 
cu¼’t
->
domaš
->
domaš_id
,

90 
cu¼’t
->
vıu_id
);

91 
	`show_executiÚ_¡©e
(
	`gue¡_ıu_u£r_»gs
());

92 
	`´štk
("\n");

95 
	`ıu_ş—r
(
ıu
, 
dump_exec¡©e_mask
);

96 iàĞ!
®t_key_hªdlšg
 )

99 
ıu
 = 
	`cyşe_ıu
(ıu, 
dump_exec¡©e_mask
);

100 iàĞ
ıu
 < 
NR_CPUS
 )

102 
	`smp_£nd_¡©e_dump
(
ıu
);

106 
	`cÚsŞe_’d_sync
();

107 
	`w©chdog_’abË
();

108 
	}
}

110 
	$dump_»gi¡”s
(
key
, 
ıu_u£r_»gs
 *
»gs
)

112 
ıu
;

115 
	`w©chdog_di§bË
();

116 
	`cÚsŞe_¡¬t_sync
();

118 
	`´štk
("'%c'…»s£d -> dumpšg„egi¡”s\n\n", 
key
);

120 
dump_exec¡©e_mask
 = 
ıu_Úlše_m­
;

123 
	`dump_exec¡©e
(
»gs
);

126 iàĞ
®t_key_hªdlšg
 )

130 
	`fÜ_—ch_ıu_mask
 ( 
ıu
, 
dump_exec¡©e_mask
 )

132 
	`smp_£nd_¡©e_dump
(
ıu
);

133  
	`ıu_is£t
(
ıu
, 
dump_exec¡©e_mask
) )

134 
	`ıu_»Ïx
();

137 
	`cÚsŞe_’d_sync
();

138 
	`w©chdog_’abË
();

139 
	}
}

141 
keyhªdËr
 
	gdump_»gi¡”s_keyhªdËr
 = {

142 .
œq_ÿÎback
 = 1,

143 .
	gdŸgno¡ic
 = 1,

144 .
	gu
.
	gœq_â
 = 
dump_»gi¡”s
,

145 .
	gdesc
 = "dump„egisters"

148 
DECLARE_TASKLET
(
dump_dom0_skËt
, 
NULL
, 0);

150 
	$dump_dom0_aùiÚ
(
¬g
)

152 
vıu
 *
v
 = (*)
¬g
;

156 
	`vıu_show_executiÚ_¡©e
(
v
);

157 iàĞ(
v
 = v->
Ãxt_š_li¡
è=ğ
NULL
 )

159 iàĞ
	`soáœq_³ndšg
(
	`smp_´oûssÜ_id
()) )

161 
dump_dom0_skËt
.
d©a
 = ()
v
;

162 
	`skËt_scheduË_Ú_ıu
(&
dump_dom0_skËt
, 
v
->
´oûssÜ
);

166 
	}
}

168 
	$dump_dom0_»gi¡”s
(
key
)

170 
vıu
 *
v
;

172 iàĞ
dom0
 =ğ
NULL
 )

175 
	`´štk
("'%c'…»s£d -> dumpšg Dom0' »gi¡”s\n", 
key
);

177 
	`fÜ_—ch_vıu
 ( 
dom0
, 
v
 )

179 iàĞ
®t_key_hªdlšg
 && 
	`soáœq_³ndšg
(
	`smp_´oûssÜ_id
()) )

181 
	`skËt_kl
(&
dump_dom0_skËt
);

182 
	`skËt_š™
(&
dump_dom0_skËt
, 
dump_dom0_aùiÚ
,

183 ()
v
);

184 
	`skËt_scheduË_Ú_ıu
(&
dump_dom0_skËt
, 
v
->
´oûssÜ
);

187 
	`vıu_show_executiÚ_¡©e
(
v
);

189 
	}
}

191 
keyhªdËr
 
	gdump_dom0_»gi¡”s_keyhªdËr
 = {

192 .
dŸgno¡ic
 = 1,

193 .
	gu
.
	gâ
 = 
dump_dom0_»gi¡”s
,

194 .
	gdesc
 = "dump Dom0„egisters"

197 
	$»boÙ_machše
(
key
, 
ıu_u£r_»gs
 *
»gs
)

199 
	`´štk
("'%c'…»s£d ->„eboÙšg machše\n", 
key
);

200 
	`machše_»¡¬t
(0);

201 
	}
}

203 
keyhªdËr
 
	g»boÙ_machše_keyhªdËr
 = {

204 .
œq_ÿÎback
 = 1,

205 .
	gu
.
	gœq_â
 = 
»boÙ_machše
,

206 .
	gdesc
 = "reboot machine"

209 
	$ıu£t_´št
(*
£t
, 
size
, 
ıumask_t
 
mask
)

211 *
£t
++ = '{';

212 
£t
 +ğ
	`ıuli¡_sú´štf
(£t, 
size
-2, 
mask
);

213 *
£t
++ = '}';

214 *
£t
++ = '\0';

215 
	}
}

217 
	$³riodic_tim”_´št
(*
¡r
, 
size
, 
ušt64_t
 
³riod
)

219 iàĞ
³riod
 == 0 )

221 
	`¡¾ıy
(
¡r
, "NØ³riodiøtim”", 
size
);

225 
	`¢´štf
(
¡r
, 
size
,

227 1000000000/()
³riod
, ()period/1000000);

228 
	}
}

230 
	$dump_domašs
(
key
)

232 
domaš
 *
d
;

233 
vıu
 *
v
;

234 
s_time_t
 
now
 = 
	`NOW
();

235 
	#tmp¡r
 
keyhªdËr_sü©ch


	)

237 
	`´štk
("'%c'…»s£d -> dumpšg domaš infØÒow=0x%X:%08X)\n", 
key
,

238 (
u32
)(
now
>>32), (u32)now);

240 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

242 
	`fÜ_—ch_domaš
 ( 
d
 )

244 
i
;

245 
	`´štk
("G’”® infÜm©iÚ fÜ domaš %u:\n", 
d
->
domaš_id
);

246 
	`ıu£t_´št
(
tmp¡r
, Ñmp¡r), 
d
->
domaš_dœty_ıumask
);

247 
	`´štk
("„efcnt=%d dying=%d‚r_pages=%d xenheap_pages=%d "

249 
	`©omic_»ad
(&
d
->
»fút
), d->
is_dyšg
,

250 
d
->
tÙ_·ges
, d->
x’h—p_·ges
, 
tmp¡r
, d->
max_·ges
);

251 
	`´štk
(" handle=%02x%02x%02x%02x-%02x%02x-%02x%02x-"

253 
d
->
hªdË
[ 0], d->handle[ 1], d->handle[ 2], d->handle[ 3],

254 
d
->
hªdË
[ 4], d->handle[ 5], d->handle[ 6], d->handle[ 7],

255 
d
->
hªdË
[ 8], d->handle[ 9], d->handle[10], d->handle[11],

256 
d
->
hªdË
[12], d->handle[13], d->handle[14], d->handle[15],

257 
d
->
vm_assi¡
);

258  
i
 = 0 ; i < 
NR_DOMAIN_WATCHDOG_TIMERS
; i++ )

259 iàĞ
	`‹¡_b™
(
i
, &
d
->
w©chdog_šu£_m­
) )

260 
	`´štk
(" watchdog %dƒxpires in %d seconds\n",

261 
i
, (
u32
)((
d
->
w©chdog_tim”
[i].
expœes
 - 
	`NOW
()) >> 30));

263 
	`¬ch_dump_domaš_šfo
(
d
);

265 
	`¿nge£t_domaš_´štk
(
d
);

267 
	`dump_·geäame_šfo
(
d
);

269 
	`´štk
("VCPU information‡nd callbacks for domain %u:\n",

270 
d
->
domaš_id
);

271 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

273 
	`´štk
(" VCPU%d: CPU%d [has=%c] flags=%lx…oll=%d "

275 
v
->
vıu_id
, v->
´oûssÜ
,

276 
v
->
is_ruÂšg
 ? 'T':'F',

277 
v
->
·u£_æags
, v->
pŞl_evtchn
,

278 
	`vıu_šfo
(
v
, 
evtchn_upÿÎ_³ndšg
),

279 
	`vıu_šfo
(
v
, 
evtchn_upÿÎ_mask
));

280 
	`ıu£t_´št
(
tmp¡r
, Ñmp¡r), 
v
->
vıu_dœty_ıumask
);

281 
	`´štk
("dœty_ıus=% ", 
tmp¡r
);

282 
	`ıu£t_´št
(
tmp¡r
, Ñmp¡r), 
v
->
ıu_affš™y
);

283 
	`´štk
("ıu_affš™y=%s\n", 
tmp¡r
);

284 
	`¬ch_dump_vıu_šfo
(
v
);

285 
	`³riodic_tim”_´št
(
tmp¡r
, Ñmp¡r), 
v
->
³riodic_³riod
);

286 
	`´štk
(" %s\n", 
tmp¡r
);

290 
	`fÜ_—ch_domaš
 ( 
d
 )

292 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

294 
	`´štk
("Notifying guest %d:%d (virq %d,…ort %d, stat %d/%d/%d)\n",

295 
d
->
domaš_id
, 
v
->
vıu_id
,

296 
VIRQ_DEBUG
, 
v
->
vœq_to_evtchn
[VIRQ_DEBUG],

297 
	`‹¡_b™
(
v
->
vœq_to_evtchn
[
VIRQ_DEBUG
],

298 &
	`sh¬ed_šfo
(
d
, 
evtchn_³ndšg
)),

299 
	`‹¡_b™
(
v
->
vœq_to_evtchn
[
VIRQ_DEBUG
],

300 &
	`sh¬ed_šfo
(
d
, 
evtchn_mask
)),

301 
	`‹¡_b™
(
v
->
vœq_to_evtchn
[
VIRQ_DEBUG
] /

302 
	`BITS_PER_EVTCHN_WORD
(
d
),

303 &
	`vıu_šfo
(
v
, 
evtchn_³ndšg_£l
)));

304 
	`£nd_gue¡_vıu_vœq
(
v
, 
VIRQ_DEBUG
);

308 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

309 #undeà
tmp¡r


310 
	}
}

312 
keyhªdËr
 
	gdump_domašs_keyhªdËr
 = {

313 .
dŸgno¡ic
 = 1,

314 .
	gu
.
	gâ
 = 
dump_domašs
,

315 .
	gdesc
 = "dump domain (and guest debug) info"

318 
ıumask_t
 
	g»ad_şocks_ıumask
 = 
CPU_MASK_NONE
;

319 
DEFINE_PER_CPU
(
s_time_t
, 
»ad_şocks_time
);

320 
DEFINE_PER_CPU
(
u64
, 
»ad_cyşes_time
);

322 
	$»ad_şocks_¦ave
(*
unu£d
)

324 
ıu
 = 
	`smp_´oûssÜ_id
();

325 
	`loÿl_œq_di§bË
();

326  !
	`ıu_is£t
(
ıu
, 
»ad_şocks_ıumask
) )

327 
	`ıu_»Ïx
();

328 
	`³r_ıu
(
»ad_şocks_time
, 
ıu
èğ
	`NOW
();

329 
	`³r_ıu
(
»ad_cyşes_time
, 
ıu
èğ
	`g‘_cyşes
();

330 
	`ıu_ş—r
(
ıu
, 
»ad_şocks_ıumask
);

331 
	`loÿl_œq_’abË
();

332 
	}
}

334 
	$»ad_şocks
(
key
)

336 
ıu
 = 
	`smp_´oûssÜ_id
(), 
mš_¡ime_ıu
, 
max_¡ime_ıu
;

337 
mš_cyşes_ıu
, 
max_cyşes_ıu
;

338 
u64
 
mš_¡ime
, 
max_¡ime
, 
dif_¡ime
;

339 
u64
 
mš_cyşes
, 
max_cyşes
, 
dif_cyşes
;

340 
u64
 
sumdif_¡ime
 = 0, 
maxdif_¡ime
 = 0;

341 
u64
 
sumdif_cyşes
 = 0, 
maxdif_cyşes
 = 0;

342 
u32
 
couÁ
 = 0;

343 
	`DEFINE_SPINLOCK
(
lock
);

345 
	`¥š_lock
(&
lock
);

347 
	`smp_ÿÎ_funùiÚ
(
»ad_şocks_¦ave
, 
NULL
, 0);

349 
	`loÿl_œq_di§bË
();

350 
»ad_şocks_ıumask
 = 
ıu_Úlše_m­
;

351 
	`³r_ıu
(
»ad_şocks_time
, 
ıu
èğ
	`NOW
();

352 
	`³r_ıu
(
»ad_cyşes_time
, 
ıu
èğ
	`g‘_cyşes
();

353 
	`ıu_ş—r
(
ıu
, 
»ad_şocks_ıumask
);

354 
	`loÿl_œq_’abË
();

356  !
	`ıus_em±y
(
»ad_şocks_ıumask
) )

357 
	`ıu_»Ïx
();

359 
mš_¡ime_ıu
 = 
max_¡ime_ıu
 = 
mš_cyşes_ıu
 = 
max_cyşes_ıu
 = 
ıu
;

360 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

362 iàĞ
	`³r_ıu
(
»ad_şocks_time
, 
ıu
) <

363 
	`³r_ıu
(
»ad_şocks_time
, 
mš_¡ime_ıu
) )

364 
mš_¡ime_ıu
 = 
ıu
;

365 iàĞ
	`³r_ıu
(
»ad_şocks_time
, 
ıu
) >

366 
	`³r_ıu
(
»ad_şocks_time
, 
max_¡ime_ıu
) )

367 
max_¡ime_ıu
 = 
ıu
;

368 iàĞ
	`³r_ıu
(
»ad_cyşes_time
, 
ıu
) <

369 
	`³r_ıu
(
»ad_cyşes_time
, 
mš_cyşes_ıu
) )

370 
mš_cyşes_ıu
 = 
ıu
;

371 iàĞ
	`³r_ıu
(
»ad_cyşes_time
, 
ıu
) >

372 
	`³r_ıu
(
»ad_cyşes_time
, 
max_cyşes_ıu
) )

373 
max_cyşes_ıu
 = 
ıu
;

376 
mš_¡ime
 = 
	`³r_ıu
(
»ad_şocks_time
, 
mš_¡ime_ıu
);

377 
max_¡ime
 = 
	`³r_ıu
(
»ad_şocks_time
, 
max_¡ime_ıu
);

378 
mš_cyşes
 = 
	`³r_ıu
(
»ad_cyşes_time
, 
mš_cyşes_ıu
);

379 
max_cyşes
 = 
	`³r_ıu
(
»ad_cyşes_time
, 
max_cyşes_ıu
);

381 
	`¥š_uÆock
(&
lock
);

383 
dif_¡ime
 = 
max_¡ime
 - 
mš_¡ime
;

384 iàĞ
dif_¡ime
 > 
maxdif_¡ime
 )

385 
maxdif_¡ime
 = 
dif_¡ime
;

386 
sumdif_¡ime
 +ğ
dif_¡ime
;

387 
dif_cyşes
 = 
max_cyşes
 - 
mš_cyşes
;

388 iàĞ
dif_cyşes
 > 
maxdif_cyşes
 )

389 
maxdif_cyşes
 = 
dif_cyşes
;

390 
sumdif_cyşes
 +ğ
dif_cyşes
;

391 
couÁ
++;

392 
	`´štk
("Synûd stimskew: max=%"
PRIu64
"ns‡vg=%"PRIu64"ns "

393 "§m¶es=%"
PRIu32
" cu¼’t=%"
PRIu64
"ns\n",

394 
maxdif_¡ime
, 
sumdif_¡ime
/
couÁ
, couÁ, 
dif_¡ime
);

395 
	`´štk
("Synûd cyşe skew: max=%"
PRIu64
"‡vg=%"PRIu64" "

396 "§m¶es=%"
PRIu32
" cu¼’t=%"
PRIu64
"\n",

397 
maxdif_cyşes
, 
sumdif_cyşes
/
couÁ
, couÁ, 
dif_cyşes
);

398 
	}
}

400 
keyhªdËr
 
	g»ad_şocks_keyhªdËr
 = {

401 .
dŸgno¡ic
 = 1,

402 .
	gu
.
	gâ
 = 
»ad_şocks
,

403 .
	gdesc
 = "display multi-cpu clock info"

406 
dump_runq
(
key
);

407 
keyhªdËr
 
	gdump_runq_keyhªdËr
 = {

408 .
dŸgno¡ic
 = 1,

409 .
	gu
.
	gâ
 = 
dump_runq
,

410 .
	gdesc
 = "dump„un queues"

413 #ifdeà
PERF_COUNTERS


414 
³rfc_´šÎ
(
key
);

415 
keyhªdËr
 
	g³rfc_´šÎ_keyhªdËr
 = {

416 .
dŸgno¡ic
 = 1,

417 .
	gu
.
	gâ
 = 
³rfc_´šÎ
,

418 .
	gdesc
 = "print…erformance counters"

420 
³rfc_»£t
(
key
);

421 
keyhªdËr
 
	g³rfc_»£t_keyhªdËr
 = {

422 .
u
.
â
 = 
³rfc_»£t
,

423 .
	gdesc
 = "reset…erformance counters"

427 #ifdeà
LOCK_PROFILE


428 
¥šlock_´ofe_´šÎ
(
key
);

429 
keyhªdËr
 
	g¥šlock_´šÎ_keyhªdËr
 = {

430 .
dŸgno¡ic
 = 1,

431 .
	gu
.
	gâ
 = 
¥šlock_´ofe_´šÎ
,

432 .
	gdesc
 = "print†ock…rofile info"

434 
¥šlock_´ofe_»£t
(
key
);

435 
keyhªdËr
 
	g¥šlock_»£t_keyhªdËr
 = {

436 .
u
.
â
 = 
¥šlock_´ofe_»£t
,

437 .
	gdesc
 = "reset†ock…rofile info"

441 
	$run_®l_nÚœq_keyhªdËrs
(
unu£d
)

444 
keyhªdËr
 *
h
;

445 
k
;

447 
	`cÚsŞe_¡¬t_log_ev”ythšg
();

449  
k
 = 0; k < 
	`ARRAY_SIZE
(
key_bË
); k++ )

451 
	`´oûss_³ndšg_soáœqs
();

452 
h
 = 
key_bË
[
k
];

453 iàĞ(
h
 =ğ
NULL
è|| !h->
dŸgno¡ic
 || h->
œq_ÿÎback
 )

455 
	`´štk
("[%c: %s]\n", 
k
, 
h
->
desc
);

456 (*
h
->
u
.
â
)(
k
);

459 
	`cÚsŞe_’d_log_ev”ythšg
();

460 
	}
}

462 
DECLARE_TASKLET
(
run_®l_keyhªdËrs_skËt
,

463 
run_®l_nÚœq_keyhªdËrs
, 0);

465 
	$run_®l_keyhªdËrs
(
key
, 
ıu_u£r_»gs
 *
»gs
)

467 
keyhªdËr
 *
h
;

468 
k
;

470 
	`w©chdog_di§bË
();

472 
	`´štk
("'%c'…»s£d -> fœšg‡Î dŸgno¡iøkeyhªdËrs\n", 
key
);

475  
k
 = 0; k < 
	`ARRAY_SIZE
(
key_bË
); k++ )

477 
h
 = 
key_bË
[
k
];

478 iàĞ(
h
 =ğ
NULL
è|| !h->
dŸgno¡ic
 || !h->
œq_ÿÎback
 )

480 
	`´štk
("[%c: %s]\n", 
k
, 
h
->
desc
);

481 (*
h
->
u
.
œq_â
)(
k
, 
»gs
);

484 
	`w©chdog_’abË
();

487 
	`skËt_scheduË
(&
run_®l_keyhªdËrs_skËt
);

488 
	}
}

490 
keyhªdËr
 
	grun_®l_keyhªdËrs_keyhªdËr
 = {

491 .
œq_ÿÎback
 = 1,

492 .
	gu
.
	gœq_â
 = 
run_®l_keyhªdËrs
,

493 .
	gdesc
 = "print‡ll diagnostics"

496 
	$do_debug_key
(
key
, 
ıu_u£r_»gs
 *
»gs
)

498 
	`´štk
("'%c'…»s£d ->¿µšg iÁØdebugg”\n", 
key
);

499 ()
	`debugg”_Œ­_çl
(0xf001, 
»gs
);

500 
	`nİ
();

503 
	}
}

505 
keyhªdËr
 
	gdo_debug_key_keyhªdËr
 = {

506 .
œq_ÿÎback
 = 1,

507 .
	gu
.
	gœq_â
 = 
do_debug_key
,

508 .
	gdesc
 = "trapo xendbg"

511 
	$do_toggË_®t_key
(
key
, 
ıu_u£r_»gs
 *
»gs
)

513 
®t_key_hªdlšg
 = !alt_key_handling;

514 
	`´štk
("'%c'…»s£d -> usšg % key hªdlšg\n", 
key
,

515 
®t_key_hªdlšg
 ? "alternative" : "normal");

516 
	}
}

518 
keyhªdËr
 
	gtoggË_®t_keyhªdËr
 = {

519 .
œq_ÿÎback
 = 1,

520 .
	gu
.
	gœq_â
 = 
do_toggË_®t_key
,

521 .
	gdesc
 = "toggle‡lternative key handling"

524 
__š™
 
	$š™Ÿlize_keybË
()

526 iàĞ
	`num_´e£Á_ıus
() > 16 )

528 
®t_key_hªdlšg
 = 1;

529 
	`´štk
(
XENLOG_INFO
 "Defaultingo‡lternative key handling; "

532 
	`»gi¡”_keyhªdËr
('A', &
toggË_®t_keyhªdËr
);

533 
	`»gi¡”_keyhªdËr
('d', &
dump_»gi¡”s_keyhªdËr
);

534 
	`»gi¡”_keyhªdËr
('h', &
show_hªdËrs_keyhªdËr
);

535 
	`»gi¡”_keyhªdËr
('q', &
dump_domašs_keyhªdËr
);

536 
	`»gi¡”_keyhªdËr
('r', &
dump_runq_keyhªdËr
);

537 
	`»gi¡”_keyhªdËr
('R', &
»boÙ_machše_keyhªdËr
);

538 
	`»gi¡”_keyhªdËr
('t', &
»ad_şocks_keyhªdËr
);

539 
	`»gi¡”_keyhªdËr
('0', &
dump_dom0_»gi¡”s_keyhªdËr
);

540 
	`»gi¡”_keyhªdËr
('%', &
do_debug_key_keyhªdËr
);

541 
	`»gi¡”_keyhªdËr
('*', &
run_®l_keyhªdËrs_keyhªdËr
);

543 #ifdeà
PERF_COUNTERS


544 
	`»gi¡”_keyhªdËr
('p', &
³rfc_´šÎ_keyhªdËr
);

545 
	`»gi¡”_keyhªdËr
('P', &
³rfc_»£t_keyhªdËr
);

548 #ifdeà
LOCK_PROFILE


549 
	`»gi¡”_keyhªdËr
('l', &
¥šlock_´šÎ_keyhªdËr
);

550 
	`»gi¡”_keyhªdËr
('L', &
¥šlock_»£t_keyhªdËr
);

553 
	}
}

	@lib.c

2 
	~<x’/ùy³.h
>

3 
	~<x’/lib.h
>

4 
	~<x’/ty³s.h
>

5 
	~<asm/by‹Üd”.h
>

8 cÚ¡ 
	g_ùy³
[] = {

9 
_C
,_C,_C,_C,_C,_C,_C,_C,

10 
_C
,_C|
_S
,_C|_S,_C|_S,_C|_S,_C|_S,_C,_C,

11 
_C
,_C,_C,_C,_C,_C,_C,_C,

12 
_C
,_C,_C,_C,_C,_C,_C,_C,

13 
_S
|
_SP
,
_P
,_P,_P,_P,_P,_P,_P,

14 
_P
,_P,_P,_P,_P,_P,_P,_P,

15 
_D
,_D,_D,_D,_D,_D,_D,_D,

16 
_D
,_D,
_P
,_P,_P,_P,_P,_P,

17 
_P
,
_U
|
_X
,_U|_X,_U|_X,_U|_X,_U|_X,_U|_X,_U,

18 
_U
,_U,_U,_U,_U,_U,_U,_U,

19 
_U
,_U,_U,_U,_U,_U,_U,_U,

20 
_U
,_U,_U,
_P
,_P,_P,_P,_P,

21 
_P
,
_L
|
_X
,_L|_X,_L|_X,_L|_X,_L|_X,_L|_X,_L,

22 
_L
,_L,_L,_L,_L,_L,_L,_L,

23 
_L
,_L,_L,_L,_L,_L,_L,_L,

24 
_L
,_L,_L,
_P
,_P,_P,_P,
_C
,

27 
_S
|
_SP
,
_P
,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,

28 
_P
,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,_P,

29 
_U
,_U,_U,_U,_U,_U,_U,_U,_U,_U,_U,_U,_U,_U,_U,_U,

30 
_U
,_U,_U,_U,_U,_U,_U,
_P
,_U,_U,_U,_U,_U,_U,_U,
_L
,

31 
_L
,_L,_L,_L,_L,_L,_L,_L,_L,_L,_L,_L,_L,_L,_L,_L,

32 
_L
,_L,_L,_L,_L,_L,_L,
_P
,_L,_L,_L,_L,_L,_L,_L,_L};

72 #ià
BITS_PER_LONG
 == 32

78 
	uuu
 {

79 
s64
 
	mq
;

80 
s64
 
	muq
;

81 
	m¦
[2];

82 
	mul
[2];

85 #ifdeà
__BIG_ENDIAN


86 
	#_QUAD_HIGHWORD
 0

	)

87 
	#_QUAD_LOWWORD
 1

	)

89 
	#_QUAD_HIGHWORD
 1

	)

90 
	#_QUAD_LOWWORD
 0

	)

96 
	#H
 
_QUAD_HIGHWORD


	)

97 
	#L
 
_QUAD_LOWWORD


	)

104 
	#CHAR_BIT
 8

	)

105 
	#QUAD_BITS
 ((
s64
è* 
CHAR_BIT
)

	)

106 
	#LONG_BITS
 ((è* 
CHAR_BIT
)

	)

107 
	#HALF_BITS
 ((è* 
CHAR_BIT
 / 2)

	)

118 
	#HHALF
(
x
è((xè>> 
HALF_BITS
)

	)

119 
	#LHALF
(
x
è((xè& ((1 << 
HALF_BITS
è- 1))

	)

120 
	#LHUP
(
x
è((xè<< 
HALF_BITS
)

	)

126 
	#B
 (1 << 
HALF_BITS
è

	)

129 
	#COMBINE
(
a
, 
b
è(((
u_lÚg
)×è<< 
HALF_BITS
è| (b))

	)

132 
u_lÚg
 
	tdig™
;

139 
	$shl
(
dig™
 *
p
, 
Ën
, 
sh
)

141 
i
;

143 
i
 = 0; i < 
Ën
; i++)

144 
p
[
i
] = 
	`LHALF
Õ[i] << 
sh
è| (p[˜+ 1] >> (
HALF_BITS
 - sh));

145 
p
[
i
] = 
	`LHALF
Õ[i] << 
sh
);

146 
	}
}

156 
u64
 
	$__qdiv»m
(
u64
 
uq
, u64 
vq
, u64 *
¬q
)

158 
uu
 
tmp
;

159 
dig™
 *
u
, *
v
, *
q
;

160 
dig™
 
v1
, 
v2
;

161 
u_lÚg
 
qh©
, 
rh©
, 
t
;

162 
m
, 
n
, 
d
, 
j
, 
i
;

163 
dig™
 
u¥aû
[5], 
v¥aû
[5], 
q¥aû
[5];

168 ià(
vq
 == 0) {

170 vŞ©cÚ¡ 
z”o
 = 0;

172 
tmp
.
ul
[
H
] =mp.ul[
L
] = 1 / 
z”o
;

173 ià(
¬q
)

174 *
¬q
 = 
uq
;

175  (
tmp
.
q
);

177 ià(
uq
 < 
vq
) {

178 ià(
¬q
)

179 *
¬q
 = 
uq
;

182 
u
 = &
u¥aû
[0];

183 
v
 = &
v¥aû
[0];

184 
q
 = &
q¥aû
[0];

199 
tmp
.
uq
 = uq;

200 
u
[0] = 0;

201 
u
[1] = 
	`HHALF
(
tmp
.
ul
[
H
]);

202 
u
[2] = 
	`LHALF
(
tmp
.
ul
[
H
]);

203 
u
[3] = 
	`HHALF
(
tmp
.
ul
[
L
]);

204 
u
[4] = 
	`LHALF
(
tmp
.
ul
[
L
]);

205 
tmp
.
uq
 = 
vq
;

206 
v
[1] = 
	`HHALF
(
tmp
.
ul
[
H
]);

207 
v
[2] = 
	`LHALF
(
tmp
.
ul
[
H
]);

208 
v
[3] = 
	`HHALF
(
tmp
.
ul
[
L
]);

209 
v
[4] = 
	`LHALF
(
tmp
.
ul
[
L
]);

210 
n
 = 4; 
v
[1] == 0; v++) {

211 ià(--
n
 == 1) {

212 
u_lÚg
 
rbj
;

213 
dig™
 
q1
, 
q2
, 
q3
, 
q4
;

223 
t
 = 
v
[2];

224 
q1
 = 
u
[1] / 
t
;

225 
rbj
 = 
	`COMBINE
(
u
[1] % 
t
, u[2]);

226 
q2
 = 
rbj
 / 
t
;

227 
rbj
 = 
	`COMBINE
Ôbj % 
t
, 
u
[3]);

228 
q3
 = 
rbj
 / 
t
;

229 
rbj
 = 
	`COMBINE
Ôbj % 
t
, 
u
[4]);

230 
q4
 = 
rbj
 / 
t
;

231 ià(
¬q
)

232 *
¬q
 = 
rbj
 % 
t
;

233 
tmp
.
ul
[
H
] = 
	`COMBINE
(
q1
, 
q2
);

234 
tmp
.
ul
[
L
] = 
	`COMBINE
(
q3
, 
q4
);

235  (
tmp
.
q
);

244 
m
 = 4 - 
n
; 
u
[1] == 0; u++)

245 
m
--;

246 
i
 = 4 - 
m
; --i >= 0;)

247 
q
[
i
] = 0;

248 
q
 +ğ4 - 
m
;

256 
d
 = 0;

257 
t
 = 
v
[1]; < 
B
 / 2; <<= 1)

258 
d
++;

259 ià(
d
 > 0) {

260 
	`shl
(&
u
[0], 
m
 + 
n
, 
d
);

261 
	`shl
(&
v
[1], 
n
 - 1, 
d
);

266 
j
 = 0;

267 
v1
 = 
v
[1];

268 
v2
 = 
v
[2];

270 
dig™
 
uj0
, 
uj1
, 
uj2
;

280 
uj0
 = 
u
[
j
 + 0];

281 
uj1
 = 
u
[
j
 + 1];

282 
uj2
 = 
u
[
j
 + 2];

283 ià(
uj0
 =ğ
v1
) {

284 
qh©
 = 
B
;

285 
rh©
 = 
uj1
;

286 
qh©_too_big
;

288 
u_lÚg
 
Â
 = 
	`COMBINE
(
uj0
, 
uj1
);

289 
qh©
 = 
Â
 / 
v1
;

290 
rh©
 = 
Â
 % 
v1
;

292 
v2
 * 
qh©
 > 
	`COMBINE
(
rh©
, 
uj2
)) {

293 
qh©_too_big
:

294 
qh©
--;

295 ià((
rh©
 +ğ
v1
è>ğ
B
)

304 
t
 = 0, 
i
 = 
n
; i > 0; i--) {

305 
t
 = 
u
[
i
 + 
j
] - 
v
[i] * 
qh©
 -;

306 
u
[
i
 + 
j
] = 
	`LHALF
(
t
);

307 
t
 = (
B
 - 
	`HHALF
(t)) & (B - 1);

309 
t
 = 
u
[
j
] -;

310 
u
[
j
] = 
	`LHALF
(
t
);

317 ià(
	`HHALF
(
t
)) {

318 
qh©
--;

319 
t
 = 0, 
i
 = 
n
; i > 0; i--) {

320 
t
 +ğ
u
[
i
 + 
j
] + 
v
[i];

321 
u
[
i
 + 
j
] = 
	`LHALF
(
t
);

322 
t
 = 
	`HHALF
(t);

324 
u
[
j
] = 
	`LHALF
(u[j] + 
t
);

326 
q
[
j
] = 
qh©
;

327 } ++
j
 <ğ
m
);

334 ià(
¬q
) {

335 ià(
d
) {

336 
i
 = 
m
 + 
n
; i > m; --i)

337 
u
[
i
] = (u[i] >> 
d
) |

338 
	`LHALF
(
u
[
i
 - 1] << (
HALF_BITS
 - 
d
));

339 
u
[
i
] = 0;

341 
tmp
.
ul
[
H
] = 
	`COMBINE
(
u¥aû
[1], uspace[2]);

342 
tmp
.
ul
[
L
] = 
	`COMBINE
(
u¥aû
[3], uspace[4]);

343 *
¬q
 = 
tmp
.
q
;

346 
tmp
.
ul
[
H
] = 
	`COMBINE
(
q¥aû
[1], qspace[2]);

347 
tmp
.
ul
[
L
] = 
	`COMBINE
(
q¥aû
[3], qspace[4]);

348  (
tmp
.
q
);

349 
	}
}

355 
s64
 
	$__divdi3
(
s64
 
a
, s64 
b
)

357 
u64
 
ua
, 
ub
, 
uq
;

358 
Ãg
 = (
a
 < 0è^ (
b
 < 0);

359 
ua
 = (
a
 < 0è? -(
u64
)a :‡;

360 
ub
 = (
b
 < 0è? -(
u64
)b : b;

361 
uq
 = 
	`__qdiv»m
(
ua
, 
ub
, (
u64
 *)0);

362  (
Ãg
 ? -
uq
 : uq);

363 
	}
}

369 
u64
 
	$__udivdi3
(
u64
 
a
, u64 
b
)

371  
	`__qdiv»m
(
a
, 
b
, (
u64
 *)0);

372 
	}
}

377 
u64
 
	$__umoddi3
(
u64
 
a
, u64 
b
)

379 
u64
 
»m
;

380 
	`__qdiv»m
(
a
, 
b
, &
»m
);

381  
»m
;

382 
	}
}

392 
s64
 
	$__moddi3
(
s64
 
a
, s64 
b
)

394 
u64
 
ua
, 
ub
, 
u»m
;

395 
Ãg
 = (
a
 < 0);

396 
ua
 = 
Ãg
 ? -(
u64
)
a
 :‡;

397 
ub
 = (
b
 < 0è? -(
u64
)b : b;

398 
	`__qdiv»m
(
ua
, 
ub
, &
u»m
);

399  (
Ãg
 ? -
u»m
 : urem);

400 
	}
}

405 
ušt64_t
 
	$muldiv64
(
ušt64_t
 
a
, 
ušt32_t
 
b
, ušt32_ˆ
c
)

407 #ifdeà
__x86_64__


408 
	`asm
 ( "muÈ%%rdx; div %%rcx" : "÷" (
a
è: "0" (a), "d" (
b
), "c" (
c
) );

409  
a
;

412 
ušt64_t
 
Î
;

414 #ifdeà
WORDS_BIGENDIAN


415 
ušt32_t
 
high
, 
low
;

417 
ušt32_t
 
low
, 
high
;

419 } 
l
;

420 } 
u
, 
»s
;

421 
ušt64_t
 
¾
, 
rh
;

423 
u
.
Î
 = 
a
;

424 
¾
 = (
ušt64_t
)
u
.
l
.
low
 * (ušt64_t)
b
;

425 
rh
 = (
ušt64_t
)
u
.
l
.
high
 * (ušt64_t)
b
;

426 
rh
 +ğ(
¾
 >> 32);

427 
»s
.
l
.
high
 = 
rh
 / 
c
;

428 
»s
.
l
.
low
 = (((
rh
 % 
c
è<< 32è+ (
¾
 & 0xffffffff)) / c;

429  
»s
.
Î
;

431 
	}
}

433 
	$·r£_size_ªd_un™
(cÚ¡ *
s
, cÚ¡ **
ps
)

435 
»t
;

436 cÚ¡ *
s1
;

438 
»t
 = 
	`sim¶e_¡¹ouÎ
(
s
, &
s1
, 0);

440  *
s1
 )

443 
»t
 <<= 10;

445 
»t
 <<= 10;

447 
»t
 <<= 10;

449 
s1
++;

452 
»t
 <<= 10;

456 iàĞ
ps
 !ğ
NULL
 )

457 *
ps
 = 
s1
;

459  
»t
;

460 
	}
}

	@libelf/libelf-dominfo.c

19 
	~"lib–f-´iv©e.h
"

24 cÚ¡ *cÚ¡ 
	g–f_x’_ã©u»_Çmes
[] = {

25 [
XENFEAT_wr™abË_·ge_bËs
] = "writable_page_tables",

26 [
XENFEAT_wr™abË_desütÜ_bËs
] = "writable_descriptor_tables",

27 [
XENFEAT_auto_Œª¦©ed_physm­
] = "auto_translated_physmap",

28 [
XENFEAT_su³rvisÜ_mode_k”Ãl
] = "supervisor_mode_kernel",

29 [
XENFEAT_·e_pgdœ_above_4gb
] = "pae_pgdir_above_4gb"

31 cÚ¡ 
	g–f_x’_ã©u»s
 =

32 (
–f_x’_ã©u»_Çmes
) / (elf_xen_feature_names[0]);

34 
	$–f_x’_·r£_ã©u»s
(cÚ¡ *
ã©u»s
,

35 
ušt32_t
 *
suµÜ‹d
,

36 
ušt32_t
 *
»quœed
)

38 
ã©u»
[64];

39 
pos
, 
Ën
, 
i
;

41 iàĞ
ã©u»s
 =ğ
NULL
 )

44  
pos
 = 0; 
ã©u»s
[pos] !ğ'\0';…o +ğ
Ën
 )

46 
	`mem£t
(
ã©u»
, 0, (feature));

47  
Ën
 = 0;;†en++ )

49 iàĞ
Ën
 >ğ(
ã©u»
)-1 )

51 iàĞ
ã©u»s
[
pos
 + 
Ën
] == '\0' )

53 iàĞ
ã©u»s
[
pos
 + 
Ën
] == '|' )

55 
Ën
++;

58 
ã©u»
[
Ën
] = 
ã©u»s
[
pos
 +†en];

61  
i
 = 0; i < 
–f_x’_ã©u»s
; i++ )

63 iàĞ!
–f_x’_ã©u»_Çmes
[
i
] )

65 iàĞ(
»quœed
 !ğ
NULL
è&& (
ã©u»
[0] == '!') )

68 iàĞ!
	`¡rcmp
(
ã©u»
 + 1, 
–f_x’_ã©u»_Çmes
[
i
]) )

70 
	`–f_x’_ã©u»_£t
(
i
, 
suµÜ‹d
);

71 
	`–f_x’_ã©u»_£t
(
i
, 
»quœed
);

78 iàĞ!
	`¡rcmp
(
ã©u»
, 
–f_x’_ã©u»_Çmes
[
i
]) )

80 
	`–f_x’_ã©u»_£t
(
i
, 
suµÜ‹d
);

85 iàĞ
i
 =ğ
–f_x’_ã©u»s
 )

90 
	}
}

95 
	$–f_x’_·r£_nÙe
(
–f_bš¬y
 *
–f
,

96 
–f_dom_·rms
 *
·rms
,

97 cÚ¡ 
–f_nÙe
 *
nÙe
)

101 *
Çme
;

102 
¡r
;

103 } 
nÙe_desc
[] = {

104 [
XEN_ELFNOTE_ENTRY
] = { "ENTRY", 0},

105 [
XEN_ELFNOTE_HYPERCALL_PAGE
] = { "HYPERCALL_PAGE", 0},

106 [
XEN_ELFNOTE_VIRT_BASE
] = { "VIRT_BASE", 0},

107 [
XEN_ELFNOTE_INIT_P2M
] = { "INIT_P2M", 0},

108 [
XEN_ELFNOTE_PADDR_OFFSET
] = { "PADDR_OFFSET", 0},

109 [
XEN_ELFNOTE_HV_START_LOW
] = { "HV_START_LOW", 0},

110 [
XEN_ELFNOTE_XEN_VERSION
] = { "XEN_VERSION", 1},

111 [
XEN_ELFNOTE_GUEST_OS
] = { "GUEST_OS", 1},

112 [
XEN_ELFNOTE_GUEST_VERSION
] = { "GUEST_VERSION", 1},

113 [
XEN_ELFNOTE_LOADER
] = { "LOADER", 1},

114 [
XEN_ELFNOTE_PAE_MODE
] = { "PAE_MODE", 1},

115 [
XEN_ELFNOTE_FEATURES
] = { "FEATURES", 1},

116 [
XEN_ELFNOTE_BSD_SYMTAB
] = { "BSD_SYMTAB", 1},

117 [
XEN_ELFNOTE_SUSPEND_CANCEL
] = { "SUSPEND_CANCEL", 0 },

118 [
XEN_ELFNOTE_MOD_START_PFN
] = { "MOD_START_PFN", 0 },

122 cÚ¡ *
¡r
 = 
NULL
;

123 
ušt64_t
 
v®
 = 0;

124 
ty³
 = 
	`–f_uv®
(
–f
, 
nÙe
,ype);

126 iàĞ(
ty³
 >ğ(
nÙe_desc
) / (note_desc[0])) ||

127 (
nÙe_desc
[
ty³
].
Çme
 =ğ
NULL
) )

129 
	`–f_msg
(
–f
, "%s: unknown xenƒlf‚ote (0x%x)\n",

130 
__FUNCTION__
, 
ty³
);

134 iàĞ
nÙe_desc
[
ty³
].
¡r
 )

136 
¡r
 = 
	`–f_nÙe_desc
(
–f
, 
nÙe
);

137 
	`–f_msg
(
–f
, "%s: % ğ\"%s\"\n", 
__FUNCTION__
,

138 
nÙe_desc
[
ty³
].
Çme
, 
¡r
);

139 
·rms
->
–f_nÙes
[
ty³
].ty³ = 
XEN_ENT_STR
;

140 
·rms
->
–f_nÙes
[
ty³
].
d©a
.
¡r
 = str;

144 
v®
 = 
	`–f_nÙe_num”ic
(
–f
, 
nÙe
);

145 
	`–f_msg
(
–f
, "%s: % ğ0x%" 
PRIx64
 "\n", 
__FUNCTION__
,

146 
nÙe_desc
[
ty³
].
Çme
, 
v®
);

147 
·rms
->
–f_nÙes
[
ty³
].ty³ = 
XEN_ENT_LONG
;

148 
·rms
->
–f_nÙes
[
ty³
].
d©a
.
num
 = 
v®
;

150 
·rms
->
–f_nÙes
[
ty³
].
Çme
 = 
nÙe_desc
[type].name;

152  
ty³
 )

154 
XEN_ELFNOTE_LOADER
:

155 
	`§ã_¡rıy
(
·rms
->
lßd”
, 
¡r
);

157 
XEN_ELFNOTE_GUEST_OS
:

158 
	`§ã_¡rıy
(
·rms
->
gue¡_os
, 
¡r
);

160 
XEN_ELFNOTE_GUEST_VERSION
:

161 
	`§ã_¡rıy
(
·rms
->
gue¡_v”
, 
¡r
);

163 
XEN_ELFNOTE_XEN_VERSION
:

164 
	`§ã_¡rıy
(
·rms
->
x’_v”
, 
¡r
);

166 
XEN_ELFNOTE_PAE_MODE
:

167 iàĞ!
	`¡rcmp
(
¡r
, "yes") )

168 
·rms
->
·e
 = 2 ;

169 iàĞ
	`¡r¡r
(
¡r
, "bimodal") )

170 
·rms
->
·e
 = 3 ;

172 
XEN_ELFNOTE_BSD_SYMTAB
:

173 iàĞ!
	`¡rcmp
(
¡r
, "yes") )

174 
·rms
->
bsd_symb
 = 1;

177 
XEN_ELFNOTE_VIRT_BASE
:

178 
·rms
->
vœt_ba£
 = 
v®
;

180 
XEN_ELFNOTE_ENTRY
:

181 
·rms
->
vœt_’Œy
 = 
v®
;

183 
XEN_ELFNOTE_INIT_P2M
:

184 
·rms
->
p2m_ba£
 = 
v®
;

186 
XEN_ELFNOTE_PADDR_OFFSET
:

187 
·rms
->
–f_·ddr_off£t
 = 
v®
;

189 
XEN_ELFNOTE_HYPERCALL_PAGE
:

190 
·rms
->
vœt_hy³rÿÎ
 = 
v®
;

192 
XEN_ELFNOTE_HV_START_LOW
:

193 
·rms
->
vœt_hv_¡¬t_low
 = 
v®
;

196 
XEN_ELFNOTE_FEATURES
:

197 iàĞ
	`–f_x’_·r£_ã©u»s
(
¡r
, 
·rms
->
f_suµÜ‹d
,

198 
·rms
->
f_»quœed
) )

204 
	}
}

206 
	$–f_x’_·r£_nÙes
(
–f_bš¬y
 *
–f
,

207 
–f_dom_·rms
 *
·rms
,

208 cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

210 
x’_–âÙes
 = 0;

211 cÚ¡ 
–f_nÙe
 *
nÙe
;

213 
·rms
->
–f_nÙe_¡¬t
 = 
¡¬t
;

214 
·rms
->
–f_nÙe_’d
 = 
’d
;

215  
nÙe
 = 
·rms
->
–f_nÙe_¡¬t
;

216 (*)
nÙe
 < 
·rms
->
–f_nÙe_’d
;

217 
nÙe
 = 
	`–f_nÙe_Ãxt
(
–f
,‚ote) )

219 iàĞ
	`¡rcmp
(
	`–f_nÙe_Çme
(
–f
, 
nÙe
), "Xen") )

221 iàĞ
	`–f_x’_·r£_nÙe
(
–f
, 
·rms
, 
nÙe
) )

223 
x’_–âÙes
++;

225  
x’_–âÙes
;

226 
	}
}

231 
	$–f_x’_·r£_gue¡_šfo
(
–f_bš¬y
 *
–f
,

232 
–f_dom_·rms
 *
·rms
)

234 cÚ¡ *
h
;

235 
Çme
[32], 
v®ue
[128];

236 
Ën
;

238 
h
 = 
·rms
->
gue¡_šfo
;

239  *
h
 )

241 
	`mem£t
(
Çme
, 0, (name));

242 
	`mem£t
(
v®ue
, 0, (value));

243  
Ën
 = 0;;†’++, 
h
++ )

245 iàĞ
Ën
 >ğ(
Çme
)-1 )

247 iàĞ*
h
 == '\0' )

249 iàĞ*
h
 == ',' )

251 
h
++;

254 iàĞ*
h
 == '=' )

256 
h
++;

257  
Ën
 = 0;;†’++, 
h
++ )

259 iàĞ
Ën
 >ğ(
v®ue
)-1 )

261 iàĞ*
h
 == '\0' )

263 iàĞ*
h
 == ',' )

265 
h
++;

268 
v®ue
[
Ën
] = *
h
;

272 
Çme
[
Ën
] = *
h
;

274 
	`–f_msg
(
–f
, "%s: %s=\"%s\"\n", 
__FUNCTION__
, 
Çme
, 
v®ue
);

277 iàĞ!
	`¡rcmp
(
Çme
, "LOADER") )

278 
	`§ã_¡rıy
(
·rms
->
lßd”
, 
v®ue
);

279 iàĞ!
	`¡rcmp
(
Çme
, "GUEST_OS") )

280 
	`§ã_¡rıy
(
·rms
->
gue¡_os
, 
v®ue
);

281 iàĞ!
	`¡rcmp
(
Çme
, "GUEST_VER") )

282 
	`§ã_¡rıy
(
·rms
->
gue¡_v”
, 
v®ue
);

283 iàĞ!
	`¡rcmp
(
Çme
, "XEN_VER") )

284 
	`§ã_¡rıy
(
·rms
->
x’_v”
, 
v®ue
);

285 iàĞ!
	`¡rcmp
(
Çme
, "PAE") )

287 iàĞ!
	`¡rcmp
(
v®ue
, "yes[extended-cr3]") )

288 
·rms
->
·e
 = 2 ;

289 iàĞ!
	`¡ºcmp
(
v®ue
, "yes", 3) )

290 
·rms
->
·e
 = 1 ;

292 iàĞ!
	`¡rcmp
(
Çme
, "BSD_SYMTAB") )

293 
·rms
->
bsd_symb
 = 1;

296 iàĞ!
	`¡rcmp
(
Çme
, "VIRT_BASE") )

297 
·rms
->
vœt_ba£
 = 
	`¡¹ouÎ
(
v®ue
, 
NULL
, 0);

298 iàĞ!
	`¡rcmp
(
Çme
, "VIRT_ENTRY") )

299 
·rms
->
vœt_’Œy
 = 
	`¡¹ouÎ
(
v®ue
, 
NULL
, 0);

300 iàĞ!
	`¡rcmp
(
Çme
, "ELF_PADDR_OFFSET") )

301 
·rms
->
–f_·ddr_off£t
 = 
	`¡¹ouÎ
(
v®ue
, 
NULL
, 0);

302 iàĞ!
	`¡rcmp
(
Çme
, "HYPERCALL_PAGE") )

303 
·rms
->
vœt_hy³rÿÎ
 = (
	`¡¹ouÎ
(
v®ue
, 
NULL
, 0) << 12) +

304 
·rms
->
vœt_ba£
;

307 iàĞ!
	`¡rcmp
(
Çme
, "FEATURES") )

308 iàĞ
	`–f_x’_·r£_ã©u»s
(
v®ue
, 
·rms
->
f_suµÜ‹d
,

309 
·rms
->
f_»quœed
) )

313 
	}
}

318 
	$–f_x’_nÙe_check
(
–f_bš¬y
 *
–f
,

319 
–f_dom_·rms
 *
·rms
)

321 iàĞ(
·rms
->
–f_nÙe_¡¬t
 =ğ
NULL
è&& (·rms->
gue¡_šfo
 == NULL) )

323 
machše
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_machše
);

324 iàĞ(
machše
 =ğ
EM_386
è|| (machš=ğ
EM_X86_64
) )

326 
	`–f_”r
(
–f
, "%s: ERROR: Not‡ Xen-ELF image: "

328 
__FUNCTION__
);

335 iàĞ((
	`¡¾’
(
·rms
->
lßd”
) == 0) ||

336 
	`¡ºcmp
(
·rms
->
lßd”
, "generic", 7)) &&

337 ((
	`¡¾’
(
·rms
->
gue¡_os
) == 0) ||

338 
	`¡ºcmp
(
·rms
->
gue¡_os
, "linux", 5)) )

340 
	`–f_”r
(
–f
, "%s: ERROR: Will only†oad images built forhe generic "

341 "lßd” o¸Lšux images", 
__FUNCTION__
);

345 iàĞ(
	`¡¾’
(
·rms
->
x’_v”
) == 0) ||

346 
	`¡ºcmp
(
·rms
->
x’_v”
, "xen-3.0", 7) )

348 
	`–f_”r
(
–f
, "%s: ERROR: Xen will only†oad images built "

349 "fÜ X’ v3.0\n", 
__FUNCTION__
);

353 
	}
}

355 
	$–f_x’_addr_ÿlc_check
(
–f_bš¬y
 *
–f
,

356 
–f_dom_·rms
 *
·rms
)

358 iàĞ(
·rms
->
–f_·ddr_off£t
 !ğ
UNSET_ADDR
) &&

359 (
·rms
->
vœt_ba£
 =ğ
UNSET_ADDR
) )

361 
	`–f_”r
(
–f
, "%s: ERROR: ELF_PADDR_OFFSET set, VIRT_BASE unset\n",

362 
__FUNCTION__
);

367 iàĞ
·rms
->
vœt_ba£
 =ğ
UNSET_ADDR
 )

369 
·rms
->
vœt_ba£
 = 0;

370 
	`–f_msg
(
–f
, "%s: VIRT_BASE un£t, usšg 0x%" 
PRIx64
 "\n",

371 
__FUNCTION__
, 
·rms
->
vœt_ba£
);

383 iàĞ
·rms
->
–f_·ddr_off£t
 =ğ
UNSET_ADDR
 )

385 iàĞ
·rms
->
–f_nÙe_¡¬t
 )

386 
·rms
->
–f_·ddr_off£t
 = 0;

388 
·rms
->
–f_·ddr_off£t
 =…¬ms->
vœt_ba£
;

389 
	`–f_msg
(
–f
, "%s: ELF_PADDR_OFFSET un£t, usšg 0x%" 
PRIx64
 "\n",

390 
__FUNCTION__
, 
·rms
->
–f_·ddr_off£t
);

393 
·rms
->
vœt_off£t
 =…¬ms->
vœt_ba£
 -…¬ms->
–f_·ddr_off£t
;

394 
·rms
->
vœt_k¡¬t
 = 
–f
->
p¡¬t
 +…¬ms->
vœt_off£t
;

395 
·rms
->
vœt_k’d
 = 
–f
->
³nd
 +…¬ms->
vœt_off£t
;

397 iàĞ
·rms
->
vœt_’Œy
 =ğ
UNSET_ADDR
 )

398 
·rms
->
vœt_’Œy
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_’Œy
);

400 iàĞ
·rms
->
bsd_symb
 )

402 
	`–f_·r£_bsdsyms
(
–f
, 
·rms
->
vœt_k’d
);

403 iàĞ
–f
->
bsd_symb_³nd
 )

404 
·rms
->
vœt_k’d
 = 
–f
->
bsd_symb_³nd
 +…¬ms->
vœt_off£t
;

407 
	`–f_msg
(
–f
, "%s:‡dd»s£s:\n", 
__FUNCTION__
);

408 
	`–f_msg
(
–f
, " vœt_ba£ = 0x%" 
PRIx64
 "\n", 
·rms
->
vœt_ba£
);

409 
	`–f_msg
(
–f
, "ƒlf_·ddr_off£ˆğ0x%" 
PRIx64
 "\n", 
·rms
->
–f_·ddr_off£t
);

410 
	`–f_msg
(
–f
, " vœt_off£ˆ = 0x%" 
PRIx64
 "\n", 
·rms
->
vœt_off£t
);

411 
	`–f_msg
(
–f
, " vœt_k¡¬ˆ = 0x%" 
PRIx64
 "\n", 
·rms
->
vœt_k¡¬t
);

412 
	`–f_msg
(
–f
, " vœt_k’d = 0x%" 
PRIx64
 "\n", 
·rms
->
vœt_k’d
);

413 
	`–f_msg
(
–f
, " vœt_’Œy = 0x%" 
PRIx64
 "\n", 
·rms
->
vœt_’Œy
);

414 
	`–f_msg
(
–f
, "…2m_ba£ = 0x%" 
PRIx64
 "\n", 
·rms
->
p2m_ba£
);

416 iàĞ(
·rms
->
vœt_k¡¬t
 >…¬ms->
vœt_k’d
) ||

417 (
·rms
->
vœt_’Œy
 <…¬ms->
vœt_k¡¬t
) ||

418 (
·rms
->
vœt_’Œy
 >…¬ms->
vœt_k’d
) ||

419 (
·rms
->
vœt_ba£
 >…¬ms->
vœt_k¡¬t
) )

421 
	`–f_”r
(
–f
, "%s: ERROR: ELF start orƒntries‡re out of bounds.\n",

422 
__FUNCTION__
);

426 iàĞ(
·rms
->
p2m_ba£
 !ğ
UNSET_ADDR
) &&

427 (
·rms
->
p2m_ba£
 >ğ·rms->
vœt_k¡¬t
) &&

428 (
·rms
->
p2m_ba£
 <…¬ms->
vœt_k’d
) )

430 
	`–f_”r
(
–f
, "%s: ERROR: P->Mable base is out of bounds.\n",

431 
__FUNCTION__
);

436 
	}
}

441 
	$–f_x’_·r£
(
–f_bš¬y
 *
–f
,

442 
–f_dom_·rms
 *
·rms
)

444 cÚ¡ 
–f_shdr
 *
shdr
;

445 cÚ¡ 
–f_phdr
 *
phdr
;

446 
x’_–âÙes
 = 0;

447 
i
, 
couÁ
, 
rc
;

449 
	`mem£t
(
·rms
, 0, (*parms));

450 
·rms
->
vœt_ba£
 = 
UNSET_ADDR
;

451 
·rms
->
vœt_’Œy
 = 
UNSET_ADDR
;

452 
·rms
->
vœt_hy³rÿÎ
 = 
UNSET_ADDR
;

453 
·rms
->
vœt_hv_¡¬t_low
 = 
UNSET_ADDR
;

454 
·rms
->
p2m_ba£
 = 
UNSET_ADDR
;

455 
·rms
->
–f_·ddr_off£t
 = 
UNSET_ADDR
;

458 
couÁ
 = 
	`–f_phdr_couÁ
(
–f
);

459  
i
 = 0; i < 
couÁ
; i++ )

461 
phdr
 = 
	`–f_phdr_by_šdex
(
–f
, 
i
);

462 iàĞ
	`–f_uv®
(
–f
, 
phdr
, 
p_ty³
è!ğ
PT_NOTE
 )

469 ià(
	`–f_uv®
(
–f
, 
phdr
, 
p_off£t
) == 0)

472 
rc
 = 
	`–f_x’_·r£_nÙes
(
–f
, 
·rms
,

473 
	`–f_£gm’t_¡¬t
(
–f
, 
phdr
),

474 
	`–f_£gm’t_’d
(
–f
, 
phdr
));

475 iàĞ
rc
 == -1 )

478 
x’_–âÙes
 +ğ
rc
;

485 iàĞ
x’_–âÙes
 == 0 )

487 
couÁ
 = 
	`–f_shdr_couÁ
(
–f
);

488  
i
 = 0; i < 
couÁ
; i++ )

490 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
i
);

492 iàĞ
	`–f_uv®
(
–f
, 
shdr
, 
sh_ty³
è!ğ
SHT_NOTE
 )

495 
rc
 = 
	`–f_x’_·r£_nÙes
(
–f
, 
·rms
,

496 
	`–f_£ùiÚ_¡¬t
(
–f
, 
shdr
),

497 
	`–f_£ùiÚ_’d
(
–f
, 
shdr
));

499 iàĞ
rc
 == -1 )

502 iàĞ
x’_–âÙes
 =ğ0 && 
rc
 > 0 )

503 
	`–f_msg
(
–f
, "%s: usšg‚Ùe äom SHT_NOTE seùiÚ\n", 
__FUNCTION__
);

505 
x’_–âÙes
 +ğ
rc
;

513 iàĞ
x’_–âÙes
 == 0 )

515 
couÁ
 = 
	`–f_shdr_couÁ
(
–f
);

516  
i
 = 0; i < 
couÁ
; i++ )

518 
shdr
 = 
	`–f_shdr_by_Çme
(
–f
, "__xen_guest");

519 iàĞ
shdr
 )

521 
·rms
->
gue¡_šfo
 = 
	`–f_£ùiÚ_¡¬t
(
–f
, 
shdr
);

522 
·rms
->
–f_nÙe_¡¬t
 = 
NULL
;

523 
·rms
->
–f_nÙe_’d
 = 
NULL
;

524 
	`–f_msg
(
–f
, "%s: __x’_gue¡: \"%s\"\n", 
__FUNCTION__
,

525 
·rms
->
gue¡_šfo
);

526 
	`–f_x’_·r£_gue¡_šfo
(
–f
, 
·rms
);

532 iàĞ
	`–f_x’_nÙe_check
(
–f
, 
·rms
) != 0 )

534 iàĞ
	`–f_x’_addr_ÿlc_check
(
–f
, 
·rms
) != 0 )

537 
	}
}

	@libelf/libelf-loader.c

19 
	~"lib–f-´iv©e.h
"

23 
	$–f_š™
(
–f_bš¬y
 *
–f
, cÚ¡ *
image
, 
size_t
 
size
)

25 cÚ¡ 
–f_shdr
 *
shdr
;

26 
ušt64_t
 
i
, 
couÁ
, 
£ùiÚ
, 
off£t
;

28 iàĞ!
	`–f_is_–fbš¬y
(
image
) )

30 
	`–f_”r
(
–f
, "%s:‚Ù‡ÀELF bš¬y\n", 
__FUNCTION__
);

34 
	`mem£t
(
–f
, 0, (*elf));

35 
–f
->
image
 = image;

36 
–f
->
size
 = size;

37 
–f
->
ehdr
 = (
–f_ehdr
 *)
image
;

38 
–f
->
şass
 =ƒlf->
ehdr
->
e32
.
e_id’t
[
EI_CLASS
];

39 
–f
->
d©a
 =ƒlf->
ehdr
->
e32
.
e_id’t
[
EI_DATA
];

42 
off£t
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_phoff
) +

43 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_ph’tsize
è* 
	`–f_phdr_couÁ
(elf);

44 iàĞ
off£t
 > 
–f
->
size
 )

46 
	`–f_”r
(
–f
, "%s:…hd¸ov”æow (ofà%" 
PRIx64
 " > size %lx)\n",

47 
__FUNCTION__
, 
off£t
, ()
–f
->
size
);

52 
off£t
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_shoff
) +

53 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_sh’tsize
è* 
	`–f_shdr_couÁ
(elf);

54 iàĞ
off£t
 > 
–f
->
size
 )

56 
	`–f_”r
(
–f
, "%s: shd¸ov”æow (ofà%" 
PRIx64
 " > size %lx)\n",

57 
__FUNCTION__
, 
off£t
, ()
–f
->
size
);

62 
£ùiÚ
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_sh¡ºdx
);

63 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
£ùiÚ
);

64 iàĞ
shdr
 !ğ
NULL
 )

65 
–f
->
£c_¡¹ab
 = 
	`–f_£ùiÚ_¡¬t
Ólf, 
shdr
);

68 
couÁ
 = 
	`–f_shdr_couÁ
(
–f
);

69  
i
 = 0; i < 
couÁ
; i++ )

71 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
i
);

72 iàĞ
	`–f_uv®
(
–f
, 
shdr
, 
sh_ty³
è!ğ
SHT_SYMTAB
 )

74 
–f
->
sym_b
 = 
shdr
;

75 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
	`–f_uv®
Ólf, shdr, 
sh_lšk
));

76 iàĞ
shdr
 =ğ
NULL
 )

78 
–f
->
sym_b
 = 
NULL
;

81 
–f
->
sym_¡¹ab
 = 
	`–f_£ùiÚ_¡¬t
Ólf, 
shdr
);

86 
	}
}

88 #iâdeà
__XEN__


89 
	$–f_ÿÎ_log_ÿÎback
(
–f_bš¬y
 *
–f
, 
i£¼
,

90 cÚ¡ *
fmt
,...) {

91 
va_li¡
 
®
;

93 ià(!
–f
->
log_ÿÎback
)

95 ià(!(
i£¼
 || 
–f
->
v”bo£
))

98 
	`va_¡¬t
(
®
,
fmt
);

99 
–f
->
	`log_ÿÎback
Ólf,ƒlf->
log_ÿÎ”_d©a
, 
i£¼
, 
fmt
, 
®
);

100 
	`va_’d
(
®
);

101 
	}
}

103 
	$–f_£t_log
(
–f_bš¬y
 *
–f
, 
–f_log_ÿÎback
 *
log_ÿÎback
,

104 *
log_ÿÎ”_d©a
, 
v”bo£
)

106 
–f
->
log_ÿÎback
 =†og_callback;

107 
–f
->
log_ÿÎ”_d©a
 =†og_caller_data;

108 
–f
->
v”bo£
 = verbose;

109 
	}
}

111 
	$–f_£t_v”bo£
(
–f_bš¬y
 *
–f
)

113 
–f
->
v”bo£
 = 1;

114 
	}
}

118 
	$–f_·r£_bsdsyms
(
–f_bš¬y
 *
–f
, 
ušt64_t
 
p¡¬t
)

120 
ušt64_t
 
sz
;

121 cÚ¡ 
–f_shdr
 *
shdr
;

122 
i
, 
ty³
;

124 iàĞ!
–f
->
sym_b
 )

127 
p¡¬t
 = 
	`–f_round_up
(
–f
,…start);

130 
sz
 = (
ušt32_t
);

133 
sz
 +ğ(
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_ehsize
) +

134 
	`–f_shdr_couÁ
(
–f
è* 
	`–f_uv®
Ólf,ƒlf->
ehdr
, 
e_sh’tsize
));

135 
sz
 = 
	`–f_round_up
(
–f
, sz);

138  
i
 = 0; i < 
	`–f_shdr_couÁ
(
–f
); i++ )

140 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
i
);

141 
ty³
 = 
	`–f_uv®
(
–f
, (
–f_shdr
 *)
shdr
, 
sh_ty³
);

142 iàĞ(
ty³
 =ğ
SHT_STRTAB
è|| (ty³ =ğ
SHT_SYMTAB
) )

143 
sz
 = 
	`–f_round_up
(
–f
, sz + 
	`–f_uv®
Ólf, 
shdr
, 
sh_size
));

146 
–f
->
bsd_symb_p¡¬t
 = 
p¡¬t
;

147 
–f
->
bsd_symb_³nd
 = 
p¡¬t
 + 
sz
;

148 
	}
}

150 
	$–f_lßd_bsdsyms
(
–f_bš¬y
 *
–f
)

152 
–f_ehdr
 *
sym_ehdr
;

153 
sz
;

154 *
maxva
, *
symba£
, *
symb_addr
;

155 
–f_shdr
 *
shdr
;

156 
i
, 
ty³
;

158 iàĞ!
–f
->
bsd_symb_p¡¬t
 )

161 
	#–f_hdr_–m
(
_–f
, 
_hdr
, 
_–m
, 
_v®
) \

163 iàĞ
	`–f_64b™
(
_–f
) ) \

164 (
_hdr
)->
e64
.
_–m
 = 
_v®
; \

166 (
_hdr
)->
e32
.
_–m
 = 
_v®
; \

167 }  0 )

	)

169 
symba£
 = 
	`–f_g‘_±r
(
–f
,ƒlf->
bsd_symb_p¡¬t
);

170 
symb_addr
 = 
maxva
 = 
symba£
 + (
ušt32_t
);

173 
sym_ehdr
 = (
–f_ehdr
 *)
symb_addr
;

174 
sz
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_ehsize
);

175 
	`memıy
(
sym_ehdr
, 
–f
->
ehdr
, 
sz
);

176 
maxva
 +ğ
sz
;

178 
	`–f_hdr_–m
(
–f
, 
sym_ehdr
, 
e_phoff
, 0);

179 
	`–f_hdr_–m
(
–f
, 
sym_ehdr
, 
e_shoff
, 
	`–f_uv®
Ólf,ƒlf->
ehdr
, 
e_ehsize
));

180 
	`–f_hdr_–m
(
–f
, 
sym_ehdr
, 
e_ph’tsize
, 0);

181 
	`–f_hdr_–m
(
–f
, 
sym_ehdr
, 
e_phnum
, 0);

184 
shdr
 = (
–f_shdr
 *)
maxva
;

185 
sz
 = 
	`–f_shdr_couÁ
(
–f
è* 
	`–f_uv®
Ólf,ƒlf->
ehdr
, 
e_sh’tsize
);

186 
	`memıy
(
shdr
, 
–f
->
image
 + 
	`–f_uv®
Ólf,ƒlf->
ehdr
, 
e_shoff
), 
sz
);

187 
maxva
 = (*)()
	`–f_round_up
(
–f
, ()maxv¨+ 
sz
);

189  
i
 = 0; i < 
	`–f_shdr_couÁ
(
–f
); i++ )

191 
ty³
 = 
	`–f_uv®
(
–f
, 
shdr
, 
sh_ty³
);

192 iàĞ(
ty³
 =ğ
SHT_STRTAB
è|| (ty³ =ğ
SHT_SYMTAB
) )

194 
	`–f_msg
(
–f
, "%s: shd¸%˜© 0x%°-> 0x%p\n", 
__func__
, 
i
,

195 
	`–f_£ùiÚ_¡¬t
(
–f
, 
shdr
), 
maxva
);

196 
sz
 = 
	`–f_uv®
(
–f
, 
shdr
, 
sh_size
);

197 
	`memıy
(
maxva
, 
	`–f_£ùiÚ_¡¬t
(
–f
, 
shdr
), 
sz
);

199 
	`–f_hdr_–m
(
–f
, 
shdr
, 
sh_off£t
, 
maxva
 - 
symb_addr
);

200 
maxva
 = (*)()
	`–f_round_up
(
–f
, ()maxv¨+ 
sz
);

202 
shdr
 = (
–f_shdr
 *)(()shdr +

203 ()
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_sh’tsize
));

207 *(
ušt32_t
 *)
symba£
 = 
maxva
 - 
symb_addr
;

209 #undeà
–f_ehdr_–m


210 
	}
}

212 
	$–f_·r£_bš¬y
(
–f_bš¬y
 *
–f
)

214 cÚ¡ 
–f_phdr
 *
phdr
;

215 
ušt64_t
 
low
 = -1;

216 
ušt64_t
 
high
 = 0;

217 
ušt64_t
 
i
, 
couÁ
, 
·ddr
, 
memsz
;

219 
couÁ
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_phnum
);

220  
i
 = 0; i < 
couÁ
; i++ )

222 
phdr
 = 
	`–f_phdr_by_šdex
(
–f
, 
i
);

223 iàĞ!
	`–f_phdr_is_lßdabË
(
–f
, 
phdr
) )

225 
·ddr
 = 
	`–f_uv®
(
–f
, 
phdr
, 
p_·ddr
);

226 
memsz
 = 
	`–f_uv®
(
–f
, 
phdr
, 
p_memsz
);

227 
	`–f_msg
(
–f
, "%s:…hdr:…addr=0x%" 
PRIx64


228 " memsz=0x%" 
PRIx64
 "\n", 
__FUNCTION__
, 
·ddr
, 
memsz
);

229 iàĞ
low
 > 
·ddr
 )

230 
low
 = 
·ddr
;

231 iàĞ
high
 < 
·ddr
 + 
memsz
 )

232 
high
 = 
·ddr
 + 
memsz
;

234 
–f
->
p¡¬t
 = 
low
;

235 
–f
->
³nd
 = 
high
;

236 
	`–f_msg
(
–f
, "%s: memÜy: 0x%" 
PRIx64
 " -> 0x%" PRIx64 "\n",

237 
__FUNCTION__
, 
–f
->
p¡¬t
,ƒlf->
³nd
);

238 
	}
}

240 
	$–f_lßd_bš¬y
(
–f_bš¬y
 *
–f
)

242 cÚ¡ 
–f_phdr
 *
phdr
;

243 
ušt64_t
 
i
, 
couÁ
, 
·ddr
, 
off£t
, 
fesz
, 
memsz
;

244 *
de¡
;

246 
couÁ
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_phnum
);

247  
i
 = 0; i < 
couÁ
; i++ )

249 
phdr
 = 
	`–f_phdr_by_šdex
(
–f
, 
i
);

250 iàĞ!
	`–f_phdr_is_lßdabË
(
–f
, 
phdr
) )

252 
·ddr
 = 
	`–f_uv®
(
–f
, 
phdr
, 
p_·ddr
);

253 
off£t
 = 
	`–f_uv®
(
–f
, 
phdr
, 
p_off£t
);

254 
fesz
 = 
	`–f_uv®
(
–f
, 
phdr
, 
p_fesz
);

255 
memsz
 = 
	`–f_uv®
(
–f
, 
phdr
, 
p_memsz
);

256 
de¡
 = 
	`–f_g‘_±r
(
–f
, 
·ddr
);

257 
	`–f_msg
(
–f
, "%s:…hd¸%" 
PRIu64
 "‡t 0x%p -> 0x%p\n",

258 
__func__
, 
i
, 
de¡
, de¡ + 
fesz
);

259 
	`memıy
(
de¡
, 
–f
->
image
 + 
off£t
, 
fesz
);

260 
	`mem£t
(
de¡
 + 
fesz
, 0, 
memsz
 - filesz);

263 
	`–f_lßd_bsdsyms
(
–f
);

264 
	}
}

266 *
	$–f_g‘_±r
(
–f_bš¬y
 *
–f
, 
addr
)

268  
–f
->
de¡
 + 
addr
 -ƒlf->
p¡¬t
;

269 
	}
}

271 
ušt64_t
 
	$–f_lookup_addr
(
–f_bš¬y
 * 
–f
, cÚ¡ *
symbŞ
)

273 cÚ¡ 
–f_sym
 *
sym
;

274 
ušt64_t
 
v®ue
;

276 
sym
 = 
	`–f_sym_by_Çme
(
–f
, 
symbŞ
);

277 iàĞ
sym
 =ğ
NULL
 )

279 
	`–f_”r
(
–f
, "%s:‚Ù found: %s\n", 
__FUNCTION__
, 
symbŞ
);

283 
v®ue
 = 
	`–f_uv®
(
–f
, 
sym
, 
¡_v®ue
);

284 
	`–f_msg
(
–f
, "%s: symbŞ \"%s\"‡ˆ0x%" 
PRIx64
 "\n", 
__FUNCTION__
,

285 
symbŞ
, 
v®ue
);

286  
v®ue
;

287 
	}
}

	@libelf/libelf-private.h

16 #iâdeà
__LIBELF_PRIVATE_H__


17 
	#__LIBELF_PRIVATE_H_


	)

19 #ifdeà
__XEN__


21 
	~<x’/cÚfig.h
>

22 
	~<x’/ty³s.h
>

23 
	~<x’/¡ršg.h
>

24 
	~<x’/lib.h
>

25 
	~<x’/lib–f.h
>

26 
	~<asm/by‹Üd”.h
>

27 
	~<public/–âÙe.h
>

31 
	#–f_msg
(
–f
, 
fmt
, 
¬gs
 ... ) \

32 ià(
–f
->
v”bo£
è
	`´štk
(
fmt
, ## 
¬gs
 )

	)

33 
	#–f_”r
(
–f
, 
fmt
, 
¬gs
 ... ) \

34 
	`´štk
(
fmt
, ## 
¬gs
 )

	)

36 
	#¡¹ouÎ
(
¡r
, 
’d
, 
ba£
è
	`sim¶e_¡¹ouÎ
(¡r,ƒnd, ba£)

	)

37 
	#bsw­_16
(
x
è
	`swab16
(x)

	)

38 
	#bsw­_32
(
x
è
	`swab32
(x)

	)

39 
	#bsw­_64
(
x
è
	`swab64
(x)

	)

43 
	~<¡d¬g.h
>

44 
	~<¡dio.h
>

45 
	~<¡dlib.h
>

46 
	~<¡ršg.h
>

47 
	~<¡ddef.h
>

48 
	~<š‰y³s.h
>

49 #ifdeà
__sun__


50 
	~<sys/by‹Üd”.h
>

51 
	#bsw­_16
(
x
è
	`BSWAP_16
(x)

	)

52 
	#bsw­_32
(
x
è
	`BSWAP_32
(x)

	)

53 
	#bsw­_64
(
x
è
	`BSWAP_64
(x)

	)

54 #–ià
defšed
(
__N‘BSD__
)

55 
	~<sys/bsw­.h
>

56 
	#bsw­_16
(
x
è
	`bsw­16
(x)

	)

57 
	#bsw­_32
(
x
è
	`bsw­32
(x)

	)

58 
	#bsw­_64
(
x
è
	`bsw­64
(x)

	)

59 #–ià
defšed
(
__O³nBSD__
)

60 
	~<machše/’dŸn.h
>

61 
	#bsw­_16
(
x
è
	`sw­16
(x)

	)

62 
	#bsw­_32
(
x
è
	`sw­32
(x)

	)

63 
	#bsw­_64
(
x
è
	`sw­64
(x)

	)

64 #–ià
defšed
(
__lšux__
è|| defšed(
__Lšux__
è|| defšed(
__MINIOS__
)

65 
	~<by‹sw­.h
>

67 #”rÜ 
UnsuµÜ‹d
 
OS


69 
	~<x’/–âÙe.h
>

70 
	~<x’/lib–f/lib–f.h
>

72 
	~"x’ù¾.h
"

73 
	~"xc_´iv©e.h
"

75 
	#–f_msg
(
–f
, 
fmt
, 
¬gs
 ... ) \

76 
	`–f_ÿÎ_log_ÿÎback
(
–f
, 0, 
fmt
 , ## 
¬gs
 );

	)

77 
	#–f_”r
(
–f
, 
fmt
, 
¬gs
 ... ) \

78 
	`–f_ÿÎ_log_ÿÎback
(
–f
, 1, 
fmt
 , ## 
¬gs
 );

	)

80 
–f_ÿÎ_log_ÿÎback
(
–f_bš¬y
*, 
i£¼
, cÚ¡ *
fmt
,...);

82 
	#§ã_¡rıy
(
d
,
s
) \

83 dØ{ 
	`¡ºıy
((
d
),(
s
),((d))-1); \

84 (
d
)[((d))-1] = '\0'; \

85 } 0)

	)

	@libelf/libelf-relocate.c

19 
	~"lib–f-´iv©e.h
"

23 cÚ¡ *
	g»l_Çmes_i386
[] = {

62 
	$–f_»loc_i386
(
–f_bš¬y
 *
–f
, 
ty³
,

63 
ušt64_t
 
addr
, ušt64_ˆ
v®ue
)

65 *
±r
 = 
	`–f_g‘_±r
(
–f
, 
addr
);

66 
ušt32_t
 *
u32
;

68  
ty³
 )

71 
u32
 = 
±r
;

72 *
u32
 +ğ
–f
->
»loc_off£t
;

81 
	}
}

85 cÚ¡ *
	g»l_Çmes_x86_64
[] = {

112 
	$–f_»loc_x86_64
(
–f_bš¬y
 *
–f
, 
ty³
,

113 
ušt64_t
 
addr
, ušt64_ˆ
v®ue
)

115 *
±r
 = 
	`–f_g‘_±r
(
–f
, 
addr
);

116 
ušt64_t
 *
u64
;

117 
ušt32_t
 *
u32
;

118 
št32_t
 *
s32
;

120  
ty³
 )

123 
u64
 = 
±r
;

124 
v®ue
 +ğ
–f
->
»loc_off£t
;

125 *
u64
 = 
v®ue
;

128 
u32
 = 
±r
;

129 *
u32
 = 
v®ue
 - 
addr
;

130 iàĞ*
u32
 !ğ(
ušt32_t
)(
v®ue
 - 
addr
) )

132 
	`–f_”r
(
–f
, "R_X86_64_PC32 ov”æow: 0x%" 
PRIx32


133 " !ğ0x%" 
PRIx32
 "\n",

134 *
u32
, (
ušt32_t
è(
v®ue
 - 
addr
));

139 
u32
 = 
±r
;

140 
v®ue
 +ğ
–f
->
»loc_off£t
;

141 *
u32
 = 
v®ue
;

142 iàĞ*
u32
 !ğ
v®ue
 )

144 
	`–f_”r
(
–f
, "R_X86_64_32 ov”æow: 0x%" 
PRIx32


145 " !ğ0x%" 
PRIx64
 "\n",

146 *
u32
, 
v®ue
);

151 
s32
 = 
±r
;

152 
v®ue
 +ğ
–f
->
»loc_off£t
;

153 *
s32
 = 
v®ue
;

154 iàĞ*
s32
 !ğ(
št64_t
è
v®ue
 )

156 
	`–f_”r
(
–f
, "R_X86_64_32S ov”æow: 0x%" 
PRIx32


157 " !ğ0x%" 
PRIx64
 "\n",

158 *
s32
, (
št64_t
è
v®ue
);

166 
	}
}

170 
	s»locs
 {

171 cÚ¡ **
	mÇmes
;

172 
	mcouÁ
;

173 (*
	mfunc
è(
–f_bš¬y
 * 
	m–f
, 
	mty³
, 
ušt64_t
 
	maddr
,

174 
ušt64_t
 
	mv®ue
);

175 } 
	g»locs
[] =

178 [
EM_386
] = {

179 .
Çmes
 = 
»l_Çmes_i386
,

180 .
	gcouÁ
 = (
»l_Çmes_i386
) / (rel_names_i386[0]),

181 .
	gfunc
 = 
–f_»loc_i386
,

183 [
EM_X86_64
] = {

184 .
Çmes
 = 
»l_Çmes_x86_64
,

185 .
	gcouÁ
 = (
»l_Çmes_x86_64
) / (rel_names_x86_64[0]),

186 .
	gfunc
 = 
–f_»loc_x86_64
,

193 cÚ¡ *
	$»Ï_Çme
(
machše
, 
ty³
)

195 iàĞ
machše
 > (
»locs
) / (relocs[0]) )

197 iàĞ!
»locs
[
machše
].
Çmes
 )

199 iàĞ
ty³
 > 
»locs
[
machše
].
couÁ
 )

201  
»locs
[
machše
].
Çmes
[
ty³
];

202 
	}
}

204 
	$–f_»loc_£ùiÚ
(
–f_bš¬y
 *
–f
,

205 cÚ¡ 
–f_shdr
 * 
»ls
,

206 cÚ¡ 
–f_shdr
 * 
£ù
, cÚ¡ƒlf_shd¸* 
syms
)

208 cÚ¡ *
±r
, *
’d
;

209 cÚ¡ 
–f_shdr
 *
shdr
;

210 cÚ¡ 
–f_»Ï
 *
»Ï
;

211 cÚ¡ 
–f_»l
 *
»l
;

212 cÚ¡ 
–f_sym
 *
sym
;

213 
ušt64_t
 
s_ty³
;

214 
ušt64_t
 
r_off£t
;

215 
ušt64_t
 
r_šfo
;

216 
ušt64_t
 
r_add’d
;

217 
r_ty³
, 
r_sym
;

218 
size_t
 
rsize
;

219 
ušt64_t
 
shndx
, 
sba£
, 
addr
, 
v®ue
;

220 cÚ¡ *
¢ame
;

221 
machše
;

223 
machše
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_machše
);

224 iàĞ(
machše
 >ğ((
»locs
) / (relocs[0]))) ||

225 (
»locs
[
machše
].
func
 =ğ
NULL
) )

227 
	`–f_”r
(
–f
, "%s: can't handle machine %d\n",

228 
__FUNCTION__
, 
machše
);

231 iàĞ
	`–f_sw­
(
–f
) )

233 
	`–f_”r
(
–f
, "%s:‚on-native byte order,„elocation‚ot supported\n",

234 
__FUNCTION__
);

238 
s_ty³
 = 
	`–f_uv®
(
–f
, 
»ls
, 
sh_ty³
);

239 
rsize
 = (
SHT_REL
 =ğ
s_ty³
è? 
	`–f_size
(
–f
, 
»l
è:ƒlf_sizeÓlf, 
»Ï
);

240 
±r
 = 
	`–f_£ùiÚ_¡¬t
(
–f
, 
»ls
);

241 
’d
 = 
	`–f_£ùiÚ_’d
(
–f
, 
»ls
);

243  ; 
±r
 < 
’d
;…Œ +ğ
rsize
 )

245  
s_ty³
 )

247 
SHT_REL
:

248 
»l
 = 
±r
;

249 
r_off£t
 = 
	`–f_uv®
(
–f
, 
»l
,„_offset);

250 
r_šfo
 = 
	`–f_uv®
(
–f
, 
»l
,„_info);

251 
r_add’d
 = 0;

253 
SHT_RELA
:

254 
»Ï
 = 
±r
;

255 
r_off£t
 = 
	`–f_uv®
(
–f
, 
»Ï
,„_offset);

256 
r_šfo
 = 
	`–f_uv®
(
–f
, 
»Ï
,„_info);

257 
r_add’d
 = 
	`–f_uv®
(
–f
, 
»Ï
,„_addend);

263 iàĞ
	`–f_64b™
(
–f
) )

265 
r_ty³
 = 
	`ELF64_R_TYPE
(
r_šfo
);

266 
r_sym
 = 
	`ELF64_R_SYM
(
r_šfo
);

270 
r_ty³
 = 
	`ELF32_R_TYPE
(
r_šfo
);

271 
r_sym
 = 
	`ELF32_R_SYM
(
r_šfo
);

274 
sym
 = 
	`–f_sym_by_šdex
(
–f
, 
r_sym
);

275 
shndx
 = 
	`–f_uv®
(
–f
, 
sym
, 
¡_shndx
);

276  
shndx
 )

278 
SHN_UNDEF
:

279 
¢ame
 = "*UNDEF*";

280 
sba£
 = 0;

282 
SHN_COMMON
:

283 
	`–f_”r
(
–f
, "%s: inv®id seùiÚ: %" 
PRId64
 "\n",

284 
__FUNCTION__
, 
shndx
);

286 
SHN_ABS
:

287 
¢ame
 = "*ABS*";

288 
sba£
 = 0;

291 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
shndx
);

292 iàĞ
shdr
 =ğ
NULL
 )

294 
	`–f_”r
(
–f
, "%s: inv®id seùiÚ: %" 
PRId64
 "\n",

295 
__FUNCTION__
, 
shndx
);

298 
¢ame
 = 
	`–f_£ùiÚ_Çme
(
–f
, 
shdr
);

299 
sba£
 = 
	`–f_uv®
(
–f
, 
shdr
, 
sh_addr
);

302 
addr
 = 
r_off£t
;

303 
v®ue
 = 
	`–f_uv®
(
–f
, 
sym
, 
¡_v®ue
);

304 
v®ue
 +ğ
r_add’d
;

306 iàĞ
–f
->
log_ÿÎback
 && (–f->
v”bo£
 > 1) )

308 
ušt64_t
 
¡_Çme
 = 
	`–f_uv®
(
–f
, 
sym
, st_name);

309 cÚ¡ *
Çme
 = 
¡_Çme
 ? 
–f
->
sym_¡¹ab
 + st_name : "*NONE*";

311 
	`–f_msg
(
–f
,

312 "%s:y³ % [%d], ofà0x%" 
PRIx64
 ",‡dd 0x%" PRIx64 ","

313 " sym % [0x%" 
PRIx64
 "], sec %s [0x%" PRIx64 "]"

314 " ->‡dd¸0x%" 
PRIx64
 " value 0x%" PRIx64 "\n",

315 
__FUNCTION__
, 
	`»Ï_Çme
(
machše
, 
r_ty³
),„_ty³, 
r_off£t
,

316 
r_add’d
, 
Çme
, 
	`–f_uv®
(
–f
, 
sym
, 
¡_v®ue
), 
¢ame
, 
sba£
,

317 
addr
, 
v®ue
);

320 iàĞ
»locs
[
machše
].
	`func
(
–f
, 
r_ty³
, 
addr
, 
v®ue
) == -1 )

322 
	`–f_”r
(
–f
, "%s: unknown/unsupported„elocype %s [%d]\n",

323 
__FUNCTION__
, 
	`»Ï_Çme
(
machše
, 
r_ty³
),„_type);

328 
	}
}

330 
	$–f_»loc
(
–f_bš¬y
 *
–f
)

332 cÚ¡ 
–f_shdr
 *
»ls
, *
£ù
, *
syms
;

333 
ušt64_t
 
i
, 
couÁ
, 
ty³
;

335 
couÁ
 = 
	`–f_shdr_couÁ
(
–f
);

336  
i
 = 0; i < 
couÁ
; i++ )

338 
»ls
 = 
	`–f_shdr_by_šdex
(
–f
, 
i
);

339 
ty³
 = 
	`–f_uv®
(
–f
, 
»ls
, 
sh_ty³
);

340 iàĞ(
ty³
 !ğ
SHT_REL
è&& (ty³ !ğ
SHT_RELA
) )

343 
£ù
 = 
	`–f_shdr_by_šdex
(
–f
, 
	`–f_uv®
Ólf, 
»ls
, 
sh_šfo
));

344 
syms
 = 
	`–f_shdr_by_šdex
(
–f
, 
	`–f_uv®
Ólf, 
»ls
, 
sh_lšk
));

345 iàĞ
NULL
 =ğ
£ù
 || NULL =ğ
syms
 )

348 iàĞ!(
	`–f_uv®
(
–f
, 
£ù
, 
sh_æags
è& 
SHF_ALLOC
) )

350 
	`–f_msg
(
–f
, "%s:„elocations for %s, skipping\n",

351 
__FUNCTION__
, 
	`–f_£ùiÚ_Çme
(
–f
, 
£ù
));

355 
	`–f_msg
(
–f
, "%s:„–oÿtiÚ fÜ % @ 0x%" 
PRIx64
 "\n",

356 
__FUNCTION__
, 
	`–f_£ùiÚ_Çme
(
–f
, 
£ù
),

357 
	`–f_uv®
(
–f
, 
£ù
, 
sh_addr
));

358 iàĞ
	`–f_»loc_£ùiÚ
(
–f
, 
»ls
, 
£ù
, 
syms
) != 0 )

362 
	}
}

	@libelf/libelf-tools.c

19 
	~"lib–f-´iv©e.h
"

23 
ušt64_t
 
	$–f_acûss_unsigÃd
(
–f_bš¬y
 * 
–f
, cÚ¡ *
±r
,

24 
ušt64_t
 
off£t
, 
size_t
 
size
)

26 
Ãed_sw­
 = 
	`–f_sw­
(
–f
);

27 cÚ¡ 
ušt8_t
 *
u8
;

28 cÚ¡ 
ušt16_t
 *
u16
;

29 cÚ¡ 
ušt32_t
 *
u32
;

30 cÚ¡ 
ušt64_t
 *
u64
;

32  
size
 )

35 
u8
 = 
±r
 + 
off£t
;

36  *
u8
;

38 
u16
 = 
±r
 + 
off£t
;

39  
Ãed_sw­
 ? 
	`bsw­_16
(*
u16
) : *u16;

41 
u32
 = 
±r
 + 
off£t
;

42  
Ãed_sw­
 ? 
	`bsw­_32
(*
u32
) : *u32;

44 
u64
 = 
±r
 + 
off£t
;

45  
Ãed_sw­
 ? 
	`bsw­_64
(*
u64
) : *u64;

49 
	}
}

51 
št64_t
 
	$–f_acûss_sigÃd
(
–f_bš¬y
 *
–f
, cÚ¡ *
±r
,

52 
ušt64_t
 
off£t
, 
size_t
 
size
)

54 
Ãed_sw­
 = 
	`–f_sw­
(
–f
);

55 cÚ¡ 
št8_t
 *
s8
;

56 cÚ¡ 
št16_t
 *
s16
;

57 cÚ¡ 
št32_t
 *
s32
;

58 cÚ¡ 
št64_t
 *
s64
;

60  
size
 )

63 
s8
 = 
±r
 + 
off£t
;

64  *
s8
;

66 
s16
 = 
±r
 + 
off£t
;

67  
Ãed_sw­
 ? 
	`bsw­_16
(*
s16
) : *s16;

69 
s32
 = 
±r
 + 
off£t
;

70  
Ãed_sw­
 ? 
	`bsw­_32
(*
s32
) : *s32;

72 
s64
 = 
±r
 + 
off£t
;

73  
Ãed_sw­
 ? 
	`bsw­_64
(*
s64
) : *s64;

77 
	}
}

79 
ušt64_t
 
	$–f_round_up
(
–f_bš¬y
 *
–f
, 
ušt64_t
 
addr
)

81 
–f_round
 = (
	`–f_64b™
(
–f
) ? 8 : 4) - 1;

83  (
addr
 + 
–f_round
) & ~elf_round;

84 
	}
}

88 
	$–f_shdr_couÁ
(
–f_bš¬y
 *
–f
)

90  
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_shnum
);

91 
	}
}

93 
	$–f_phdr_couÁ
(
–f_bš¬y
 *
–f
)

95  
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_phnum
);

96 
	}
}

98 cÚ¡ 
–f_shdr
 *
	$–f_shdr_by_Çme
(
–f_bš¬y
 *
–f
, cÚ¡ *
Çme
)

100 
ušt64_t
 
couÁ
 = 
	`–f_shdr_couÁ
(
–f
);

101 cÚ¡ 
–f_shdr
 *
shdr
;

102 cÚ¡ *
¢ame
;

103 
i
;

105  
i
 = 0; i < 
couÁ
; i++ )

107 
shdr
 = 
	`–f_shdr_by_šdex
(
–f
, 
i
);

108 
¢ame
 = 
	`–f_£ùiÚ_Çme
(
–f
, 
shdr
);

109 iàĞ
¢ame
 && !
	`¡rcmp
(¢ame, 
Çme
) )

110  
shdr
;

112  
NULL
;

113 
	}
}

115 cÚ¡ 
–f_shdr
 *
	$–f_shdr_by_šdex
(
–f_bš¬y
 *
–f
, 
šdex
)

117 
ušt64_t
 
couÁ
 = 
	`–f_shdr_couÁ
(
–f
);

118 cÚ¡ *
±r
;

120 iàĞ
šdex
 >ğ
couÁ
 )

121  
NULL
;

123 
±r
 = (
–f
->
image


124 + 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_shoff
)

125 + 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_sh’tsize
è* 
šdex
);

126  
±r
;

127 
	}
}

129 cÚ¡ 
–f_phdr
 *
	$–f_phdr_by_šdex
(
–f_bš¬y
 *
–f
, 
šdex
)

131 
ušt64_t
 
couÁ
 = 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_phnum
);

132 cÚ¡ *
±r
;

134 iàĞ
šdex
 >ğ
couÁ
 )

135  
NULL
;

137 
±r
 = (
–f
->
image


138 + 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_phoff
)

139 + 
	`–f_uv®
(
–f
,ƒlf->
ehdr
, 
e_ph’tsize
è* 
šdex
);

140  
±r
;

141 
	}
}

143 cÚ¡ *
	$–f_£ùiÚ_Çme
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_shdr
 * 
shdr
)

145 iàĞ
–f
->
£c_¡¹ab
 =ğ
NULL
 )

147  
–f
->
£c_¡¹ab
 + 
	`–f_uv®
Ólf, 
shdr
, 
sh_Çme
);

148 
	}
}

150 cÚ¡ *
	$–f_£ùiÚ_¡¬t
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_shdr
 * 
shdr
)

152  
–f
->
image
 + 
	`–f_uv®
Ólf, 
shdr
, 
sh_off£t
);

153 
	}
}

155 cÚ¡ *
	$–f_£ùiÚ_’d
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_shdr
 * 
shdr
)

157  
–f
->
image


158 + 
	`–f_uv®
(
–f
, 
shdr
, 
sh_off£t
è+ƒlf_uv®Ólf, shdr, 
sh_size
);

159 
	}
}

161 cÚ¡ *
	$–f_£gm’t_¡¬t
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_phdr
 * 
phdr
)

163  
–f
->
image
 + 
	`–f_uv®
Ólf, 
phdr
, 
p_off£t
);

164 
	}
}

166 cÚ¡ *
	$–f_£gm’t_’d
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_phdr
 * 
phdr
)

168  
–f
->
image


169 + 
	`–f_uv®
(
–f
, 
phdr
, 
p_off£t
è+ƒlf_uv®Ólf,…hdr, 
p_fesz
);

170 
	}
}

172 cÚ¡ 
–f_sym
 *
	$–f_sym_by_Çme
(
–f_bš¬y
 *
–f
, cÚ¡ *
symbŞ
)

174 cÚ¡ *
±r
 = 
	`–f_£ùiÚ_¡¬t
(
–f
,ƒlf->
sym_b
);

175 cÚ¡ *
’d
 = 
	`–f_£ùiÚ_’d
(
–f
,ƒlf->
sym_b
);

176 cÚ¡ 
–f_sym
 *
sym
;

177 
ušt64_t
 
šfo
, 
Çme
;

179  ; 
±r
 < 
’d
;…Œ +ğ
	`–f_size
(
–f
, 
sym
) )

181 
sym
 = 
±r
;

182 
šfo
 = 
	`–f_uv®
(
–f
, 
sym
, 
¡_šfo
);

183 
Çme
 = 
	`–f_uv®
(
–f
, 
sym
, 
¡_Çme
);

184 iàĞ
	`ELF32_ST_BIND
(
šfo
è!ğ
STB_GLOBAL
 )

186 iàĞ
	`¡rcmp
(
–f
->
sym_¡¹ab
 + 
Çme
, 
symbŞ
) )

188  
sym
;

190  
NULL
;

191 
	}
}

193 cÚ¡ 
–f_sym
 *
	$–f_sym_by_šdex
(
–f_bš¬y
 *
–f
, 
šdex
)

195 cÚ¡ *
±r
 = 
	`–f_£ùiÚ_¡¬t
(
–f
,ƒlf->
sym_b
);

196 cÚ¡ 
–f_sym
 *
sym
;

198 
sym
 = 
±r
 + 
šdex
 * 
	`–f_size
(
–f
, sym);

199  
sym
;

200 
	}
}

202 cÚ¡ *
	$–f_nÙe_Çme
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_nÙe
 * 
nÙe
)

204  (*)
nÙe
 + 
	`–f_size
(
–f
,‚ote);

205 
	}
}

207 cÚ¡ *
	$–f_nÙe_desc
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_nÙe
 * 
nÙe
)

209 
Çmesz
 = (
	`–f_uv®
(
–f
, 
nÙe
,‚amesz) + 3) & ~3;

211  (*)
nÙe
 + 
	`–f_size
(
–f
,‚Ùeè+ 
Çmesz
;

212 
	}
}

214 
ušt64_t
 
	$–f_nÙe_num”ic
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_nÙe
 * 
nÙe
)

216 cÚ¡ *
desc
 = 
	`–f_nÙe_desc
(
–f
, 
nÙe
);

217 
descsz
 = 
	`–f_uv®
(
–f
, 
nÙe
, descsz);

219 
descsz
)

225  
	`–f_acûss_unsigÃd
(
–f
, 
desc
, 0, 
descsz
);

229 
	}
}

230 cÚ¡ 
–f_nÙe
 *
	$–f_nÙe_Ãxt
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_nÙe
 * 
nÙe
)

232 
Çmesz
 = (
	`–f_uv®
(
–f
, 
nÙe
,‚amesz) + 3) & ~3;

233 
descsz
 = (
	`–f_uv®
(
–f
, 
nÙe
, descsz) + 3) & ~3;

235  (*)
nÙe
 + 
	`–f_size
(
–f
,‚Ùeè+ 
Çmesz
 + 
descsz
;

236 
	}
}

240 
	$–f_is_–fbš¬y
(cÚ¡ *
image
)

242 cÚ¡ 
Elf32_Ehdr
 *
ehdr
 = 
image
;

244  
	`IS_ELF
(*
ehdr
);

245 
	}
}

247 
	$–f_phdr_is_lßdabË
(
–f_bš¬y
 *
–f
, cÚ¡ 
–f_phdr
 * 
phdr
)

249 
ušt64_t
 
p_ty³
 = 
	`–f_uv®
(
–f
, 
phdr
,…_type);

250 
ušt64_t
 
p_æags
 = 
	`–f_uv®
(
–f
, 
phdr
,…_flags);

252  ((
p_ty³
 =ğ
PT_LOAD
è&& (
p_æags
 & (
PF_R
 | 
PF_W
 | 
PF_X
)) != 0);

253 
	}
}

	@lzo.c

27 
	#LZO_VERSION
 0x2020

	)

28 
	#LZO_VERSION_STRING
 "2.02"

	)

29 
	#LZO_VERSION_DATE
 "Où 17 2005"

	)

31 
	#M1_MAX_OFFSET
 0x0400

	)

32 
	#M2_MAX_OFFSET
 0x0800

	)

33 
	#M3_MAX_OFFSET
 0x4000

	)

34 
	#M4_MAX_OFFSET
 0xbfff

	)

36 
	#M1_MIN_LEN
 2

	)

37 
	#M1_MAX_LEN
 2

	)

38 
	#M2_MIN_LEN
 3

	)

39 
	#M2_MAX_LEN
 8

	)

40 
	#M3_MIN_LEN
 3

	)

41 
	#M3_MAX_LEN
 33

	)

42 
	#M4_MIN_LEN
 3

	)

43 
	#M4_MAX_LEN
 9

	)

45 
	#M1_MARKER
 0

	)

46 
	#M2_MARKER
 64

	)

47 
	#M3_MARKER
 32

	)

48 
	#M4_MARKER
 16

	)

50 
	#D_BITS
 14

	)

51 
	#D_MASK
 ((1u << 
D_BITS
è- 1)

	)

52 
	#D_HIGH
 ((
D_MASK
 >> 1è+ 1)

	)

54 
	#DX2
(
p
, 
s1
, 
s2
è(((((
size_t
)((p)[2]) << (s2)) ^ (p)[1]) \

55 << (
s1
)è^ (
p
)[0])

	)

56 
	#DX3
(
p
, 
s1
, 
s2
, 
s3
è((
	`DX2
(Õ)+1, s2, s3è<< (s1)è^ (p)[0])

	)

71 
	~<x’/ty³s.h
>

72 
	~<x’/lzo.h
>

73 
	#g‘_uÇligÃd
(
_p
è(*(_p))

	)

74 
	#put_uÇligÃd
(
_v®
,
_p
è(*(_p)=_v®)

	)

75 
	#g‘_uÇligÃd_Ë16
(
_p
è(*(
u16
 *)(_p))

	)

77 
nošlše
 
size_t


78 
	$_lzo1x_1_do_com´ess
(cÚ¡ *
š
, 
size_t
 
š_Ën
,

79 *
out
, 
size_t
 *
out_Ën
, *
wrkmem
)

81 cÚ¡ * cÚ¡ 
š_’d
 = 
š
 + 
š_Ën
;

82 cÚ¡ * cÚ¡ 
_’d
 = 
š
 + 
š_Ën
 - 
M2_MAX_LEN
 - 5;

83 cÚ¡ ** cÚ¡ 
diù
 = 
wrkmem
;

84 cÚ¡ *

 = 
š
, *
ii
 = ip;

85 cÚ¡ *
’d
, *
m
, *
m_pos
;

86 
size_t
 
m_off
, 
m_Ën
, 
dšdex
;

87 *
İ
 = 
out
;

89 

 += 4;

92 
dšdex
 = ((
size_t
)(0x21 * 
	`DX3
(

, 5, 5, 6)è>> 5è& 
D_MASK
;

93 
m_pos
 = 
diù
[
dšdex
];

95 ià(
m_pos
 < 
š
)

96 
l™”®
;

98 ià(

 =ğ
m_pos
 || ((
size_t
)( - m_posè> 
M4_MAX_OFFSET
))

99 
l™”®
;

101 
m_off
 = 

 - 
m_pos
;

102 ià(
m_off
 <ğ
M2_MAX_OFFSET
 || 
m_pos
[3] =ğ

[3])

103 
Œy_m©ch
;

105 
dšdex
 = (dšdex & (
D_MASK
 & 0x7ff)è^ (
D_HIGH
 | 0x1f);

106 
m_pos
 = 
diù
[
dšdex
];

108 ià(
m_pos
 < 
š
)

109 
l™”®
;

111 ià(

 =ğ
m_pos
 || ((
size_t
)( - m_posè> 
M4_MAX_OFFSET
))

112 
l™”®
;

114 
m_off
 = 

 - 
m_pos
;

115 ià(
m_off
 <ğ
M2_MAX_OFFSET
 || 
m_pos
[3] =ğ

[3])

116 
Œy_m©ch
;

118 
l™”®
;

120 
Œy_m©ch
:

121 ià(
	`g‘_uÇligÃd
((cÚ¡ *)
m_pos
)

122 =ğ
	`g‘_uÇligÃd
((cÚ¡ *)

)) {

123 ià(
	`lik–y
(
m_pos
[2] =ğ

[2]))

124 
m©ch
;

127 
l™”®
:

128 
diù
[
dšdex
] = 

;

129 ++

;

130 ià(
	`uÆik–y
(

 >ğ
_’d
))

134 
m©ch
:

135 
diù
[
dšdex
] = 

;

136 ià(

 !ğ
ii
) {

137 
size_t
 
t
 = 

 - 
ii
;

139 ià(
t
 <= 3) {

140 
İ
[-2] |ğ
t
;

141 } ià(
t
 <= 18) {

142 *
İ
++ = (
t
 - 3);

144 
size_t
 
‰
 = 
t
 - 18;

146 *
İ
++ = 0;

147 
‰
 > 255) {

148 
‰
 -= 255;

149 *
İ
++ = 0;

151 *
İ
++ = 
‰
;

154 *
İ
++ = *
ii
++;

155 } --
t
 > 0);

158 

 += 3;

159 ià(
m_pos
[3] !ğ*

++ || m_pos[4] != *ip++

160 || 
m_pos
[5] !ğ*

++ || m_pos[6] != *ip++

161 || 
m_pos
[7] !ğ*

++ || m_pos[8] != *ip++) {

162 --

;

163 
m_Ën
 = 

 - 
ii
;

165 ià(
m_off
 <ğ
M2_MAX_OFFSET
) {

166 
m_off
 -= 1;

167 *
İ
++ = (((
m_Ën
 - 1) << 5)

168 | ((
m_off
 & 7) << 2));

169 *
İ
++ = (
m_off
 >> 3);

170 } ià(
m_off
 <ğ
M3_MAX_OFFSET
) {

171 
m_off
 -= 1;

172 *
İ
++ = (
M3_MARKER
 | (
m_Ën
 - 2));

173 
m3_m4_off£t
;

175 
m_off
 -= 0x4000;

177 *
İ
++ = (
M4_MARKER
 | ((
m_off
 & 0x4000) >> 11)

178 | (
m_Ën
 - 2));

179 
m3_m4_off£t
;

182 
’d
 = 
š_’d
;

183 
m
 = 
m_pos
 + 
M2_MAX_LEN
 + 1;

185 

 < 
’d
 && *
m
 == *ip) {

186 
m
++;

187 

++;

189 
m_Ën
 = 

 - 
ii
;

191 ià(
m_off
 <ğ
M3_MAX_OFFSET
) {

192 
m_off
 -= 1;

193 ià(
m_Ën
 <= 33) {

194 *
İ
++ = (
M3_MARKER
 | (
m_Ën
 - 2));

196 
m_Ën
 -= 33;

197 *
İ
++ = 
M3_MARKER
 | 0;

198 
m3_m4_Ën
;

201 
m_off
 -= 0x4000;

202 ià(
m_Ën
 <ğ
M4_MAX_LEN
) {

203 *
İ
++ = (
M4_MARKER


204 | ((
m_off
 & 0x4000) >> 11)

205 | (
m_Ën
 - 2));

207 
m_Ën
 -ğ
M4_MAX_LEN
;

208 *
İ
++ = (
M4_MARKER


209 | ((
m_off
 & 0x4000) >> 11));

210 
m3_m4_Ën
:

211 
m_Ën
 > 255) {

212 
m_Ën
 -= 255;

213 *
İ
++ = 0;

216 *
İ
++ = (
m_Ën
);

219 
m3_m4_off£t
:

220 *
İ
++ = ((
m_off
 & 63) << 2);

221 *
İ
++ = (
m_off
 >> 6);

224 
ii
 = 

;

225 ià(
	`uÆik–y
(

 >ğ
_’d
))

229 *
out_Ën
 = 
İ
 - 
out
;

230  
š_’d
 - 
ii
;

231 
	}
}

233 
	$lzo1x_1_com´ess
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
,

234 
size_t
 *
out_Ën
, *
wrkmem
)

236 cÚ¡ *
ii
;

237 *
İ
 = 
out
;

238 
size_t
 
t
;

240 ià(
	`uÆik–y
(
š_Ën
 <ğ
M2_MAX_LEN
 + 5)) {

241 
t
 = 
š_Ën
;

243 
t
 = 
	`_lzo1x_1_do_com´ess
(
š
, 
š_Ën
, 
İ
, 
out_Ën
, 
wrkmem
);

244 
İ
 +ğ*
out_Ën
;

247 ià(
t
 > 0) {

248 
ii
 = 
š
 + 
š_Ën
 - 
t
;

250 ià(
İ
 =ğ
out
 && 
t
 <= 238) {

251 *
İ
++ = (17 + 
t
);

252 } ià(
t
 <= 3) {

253 
İ
[-2] |ğ
t
;

254 } ià(
t
 <= 18) {

255 *
İ
++ = (
t
 - 3);

257 
size_t
 
‰
 = 
t
 - 18;

259 *
İ
++ = 0;

260 
‰
 > 255) {

261 
‰
 -= 255;

262 *
İ
++ = 0;

265 *
İ
++ = 
‰
;

268 *
İ
++ = *
ii
++;

269 } --
t
 > 0);

272 *
İ
++ = 
M4_MARKER
 | 1;

273 *
İ
++ = 0;

274 *
İ
++ = 0;

276 *
out_Ën
 = 
İ
 - 
out
;

277  
LZO_E_OK
;

278 
	}
}

293 
	#HAVE_IP
(
x
, 
_’d
, 

è((
size_t
)(_’d - ipè< (x))

	)

294 
	#HAVE_OP
(
x
, 
İ_’d
, 
İ
è((
size_t
)(İ_’d - opè< (x))

	)

295 
	#HAVE_LB
(
m_pos
, 
out
, 
İ
è(m_po < ouˆ|| m_po >ğİ)

	)

297 
	#COPY4
(
d¡
, 
¤c
) \

298 
	`put_uÇligÃd
(
	`g‘_uÇligÃd
((cÚ¡ 
u32
 *)(
¤c
)), (u32 *)(
d¡
))

	)

300 
	$lzo1x_decom´ess_§ã
(cÚ¡ *
š
, 
size_t
 
š_Ën
,

301 *
out
, 
size_t
 *
out_Ën
)

303 cÚ¡ * cÚ¡ 
_’d
 = 
š
 + 
š_Ën
;

304 * cÚ¡ 
İ_’d
 = 
out
 + *
out_Ën
;

305 cÚ¡ *

 = 
š
, *
m_pos
;

306 *
İ
 = 
out
;

307 
size_t
 
t
;

309 *
out_Ën
 = 0;

311 ià(*

 > 17) {

312 
t
 = *

++ - 17;

313 ià(
t
 < 4)

314 
m©ch_Ãxt
;

315 ià(
	`HAVE_OP
(
t
, 
İ_’d
, 
İ
))

316 
ouut_ov”run
;

317 ià(
	`HAVE_IP
(
t
 + 1, 
_’d
, 

))

318 
šput_ov”run
;

320 *
İ
++ = *

++;

321 } --
t
 > 0);

322 
fœ¡_l™”®_run
;

325 (

 < 
_’d
)) {

326 
t
 = *

++;

327 ià(
t
 >= 16)

328 
m©ch
;

329 ià(
t
 == 0) {

330 ià(
	`HAVE_IP
(1, 
_’d
, 

))

331 
šput_ov”run
;

332 *

 == 0) {

333 
t
 += 255;

334 

++;

335 ià(
	`HAVE_IP
(1, 
_’d
, 

))

336 
šput_ov”run
;

338 
t
 +ğ15 + *

++;

340 ià(
	`HAVE_OP
(
t
 + 3, 
İ_’d
, 
İ
))

341 
ouut_ov”run
;

342 ià(
	`HAVE_IP
(
t
 + 4, 
_’d
, 

))

343 
šput_ov”run
;

345 
	`COPY4
(
İ
, 

);

346 
İ
 += 4;

347 

 += 4;

348 ià(--
t
 > 0) {

349 ià(
t
 >= 4) {

351 
	`COPY4
(
İ
, 

);

352 
İ
 += 4;

353 

 += 4;

354 
t
 -= 4;

355 } 
t
 >= 4);

356 ià(
t
 > 0) {

358 *
İ
++ = *

++;

359 } --
t
 > 0);

363 *
İ
++ = *

++;

364 } --
t
 > 0);

368 
fœ¡_l™”®_run
:

369 
t
 = *

++;

370 ià(
t
 >= 16)

371 
m©ch
;

372 
m_pos
 = 
İ
 - (1 + 
M2_MAX_OFFSET
);

373 
m_pos
 -ğ
t
 >> 2;

374 
m_pos
 -ğ*

++ << 2;

376 ià(
	`HAVE_LB
(
m_pos
, 
out
, 
İ
))

377 
lookbehšd_ov”run
;

379 ià(
	`HAVE_OP
(3, 
İ_’d
, 
İ
))

380 
ouut_ov”run
;

381 *
İ
++ = *
m_pos
++;

382 *
İ
++ = *
m_pos
++;

383 *
İ
++ = *
m_pos
;

385 
m©ch_dÚe
;

388 
m©ch
:

389 ià(
t
 >= 64) {

390 
m_pos
 = 
İ
 - 1;

391 
m_pos
 -ğ(
t
 >> 2) & 7;

392 
m_pos
 -ğ*

++ << 3;

393 
t
 = (t >> 5) - 1;

394 ià(
	`HAVE_LB
(
m_pos
, 
out
, 
İ
))

395 
lookbehšd_ov”run
;

396 ià(
	`HAVE_OP
(
t
 + 3 - 1, 
İ_’d
, 
İ
))

397 
ouut_ov”run
;

398 
cİy_m©ch
;

399 } ià(
t
 >= 32) {

400 
t
 &= 31;

401 ià(
t
 == 0) {

402 ià(
	`HAVE_IP
(1, 
_’d
, 

))

403 
šput_ov”run
;

404 *

 == 0) {

405 
t
 += 255;

406 

++;

407 ià(
	`HAVE_IP
(1, 
_’d
, 

))

408 
šput_ov”run
;

410 
t
 +ğ31 + *

++;

412 
m_pos
 = 
İ
 - 1;

413 
m_pos
 -ğ
	`g‘_uÇligÃd_Ë16
(

) >> 2;

414 

 += 2;

415 } ià(
t
 >= 16) {

416 
m_pos
 = 
İ
;

417 
m_pos
 -ğ(
t
 & 8) << 11;

419 
t
 &= 7;

420 ià(
t
 == 0) {

421 ià(
	`HAVE_IP
(1, 
_’d
, 

))

422 
šput_ov”run
;

423 *

 == 0) {

424 
t
 += 255;

425 

++;

426 ià(
	`HAVE_IP
(1, 
_’d
, 

))

427 
šput_ov”run
;

429 
t
 +ğ7 + *

++;

431 
m_pos
 -ğ
	`g‘_uÇligÃd_Ë16
(

) >> 2;

432 

 += 2;

433 ià(
m_pos
 =ğ
İ
)

434 
eof_found
;

435 
m_pos
 -= 0x4000;

437 
m_pos
 = 
İ
 - 1;

438 
m_pos
 -ğ
t
 >> 2;

439 
m_pos
 -ğ*

++ << 2;

441 ià(
	`HAVE_LB
(
m_pos
, 
out
, 
İ
))

442 
lookbehšd_ov”run
;

443 ià(
	`HAVE_OP
(2, 
İ_’d
, 
İ
))

444 
ouut_ov”run
;

446 *
İ
++ = *
m_pos
++;

447 *
İ
++ = *
m_pos
;

448 
m©ch_dÚe
;

451 ià(
	`HAVE_LB
(
m_pos
, 
out
, 
İ
))

452 
lookbehšd_ov”run
;

453 ià(
	`HAVE_OP
(
t
 + 3 - 1, 
İ_’d
, 
İ
))

454 
ouut_ov”run
;

456 ià(
t
 >ğ2 * 4 - (3 - 1è&& (
İ
 - 
m_pos
) >= 4) {

457 
	`COPY4
(
İ
, 
m_pos
);

458 
İ
 += 4;

459 
m_pos
 += 4;

460 
t
 -= 4 - (3 - 1);

462 
	`COPY4
(
İ
, 
m_pos
);

463 
İ
 += 4;

464 
m_pos
 += 4;

465 
t
 -= 4;

466 } 
t
 >= 4);

467 ià(
t
 > 0)

469 *
İ
++ = *
m_pos
++;

470 } --
t
 > 0);

472 
cİy_m©ch
:

473 *
İ
++ = *
m_pos
++;

474 *
İ
++ = *
m_pos
++;

476 *
İ
++ = *
m_pos
++;

477 } --
t
 > 0);

479 
m©ch_dÚe
:

480 
t
 = 

[-2] & 3;

481 ià(
t
 == 0)

483 
m©ch_Ãxt
:

484 ià(
	`HAVE_OP
(
t
, 
İ_’d
, 
İ
))

485 
ouut_ov”run
;

486 ià(
	`HAVE_IP
(
t
 + 1, 
_’d
, 

))

487 
šput_ov”run
;

489 *
İ
++ = *

++;

490 ià(
t
 > 1) {

491 *
İ
++ = *

++;

492 ià(
t
 > 2)

493 *
İ
++ = *

++;

496 
t
 = *

++;

497 } 

 < 
_’d
);

500 *
out_Ën
 = 
İ
 - 
out
;

501  
LZO_E_EOF_NOT_FOUND
;

503 
eof_found
:

504 *
out_Ën
 = 
İ
 - 
out
;

505  (

 =ğ
_’d
 ? 
LZO_E_OK
 :

506 (

 < 
_’d
 ? 
LZO_E_INPUT_NOT_CONSUMED
 : 
LZO_E_INPUT_OVERRUN
));

507 
šput_ov”run
:

508 *
out_Ën
 = 
İ
 - 
out
;

509  
LZO_E_INPUT_OVERRUN
;

511 
ouut_ov”run
:

512 *
out_Ën
 = 
İ
 - 
out
;

513  
LZO_E_OUTPUT_OVERRUN
;

515 
lookbehšd_ov”run
:

516 *
out_Ën
 = 
İ
 - 
out
;

517  
LZO_E_LOOKBEHIND_OVERRUN
;

518 
	}
}

	@memory.c

10 
	~<x’/cÚfig.h
>

11 
	~<x’/ty³s.h
>

12 
	~<x’/lib.h
>

13 
	~<x’/mm.h
>

14 
	~<x’/³rfc.h
>

15 
	~<x’/sched.h
>

16 
	~<x’/ev’t.h
>

17 
	~<x’/·gšg.h
>

18 
	~<x’/ioÿp.h
>

19 
	~<x’/gue¡_acûss.h
>

20 
	~<x’/hy³rÿÎ.h
>

21 
	~<x’/”ºo.h
>

22 
	~<x’/tmem.h
>

23 
	~<x’/tmem_x’.h
>

24 
	~<asm/cu¼’t.h
>

25 
	~<asm/h¬dœq.h
>

26 #ifdeà
CONFIG_X86


27 
	~<asm/p2m.h
>

29 
	~<x’/numa.h
>

30 
	~<public/memÜy.h
>

31 
	~<xsm/xsm.h
>

32 
	~<x’/Œaû.h
>

34 
	smemİ_¬gs
 {

36 
domaš
 *
	mdomaš
;

37 
XEN_GUEST_HANDLE
(
x’_pâ_t
è
	mex‹Á_li¡
;

38 
	mÄ_ex‹Ás
;

39 
	mex‹Á_Üd”
;

40 
	mmemæags
;

43 
	mÄ_dÚe
;

44 
	m´“m±ed
;

47 
	$šü—£_»£rv©iÚ
(
memİ_¬gs
 *
a
)

49 
·ge_šfo
 *
·ge
;

50 
i
;

51 
x’_pâ_t
 
mâ
;

52 
domaš
 *
d
 = 
a
->domain;

54 iàĞ!
	`gue¡_hªdË_is_nuÎ
(
a
->
ex‹Á_li¡
) &&

55 !
	`gue¡_hªdË_sub¿nge_okay
(
a
->
ex‹Á_li¡
,‡->
Ä_dÚe
,

56 
a
->
Ä_ex‹Ás
-1) )

59 iàĞ!
	`muÉage_®loÿtiÚ_³rm™‹d
(
cu¼’t
->
domaš
, 
a
->
ex‹Á_Üd”
) )

62  
i
 = 
a
->
Ä_dÚe
; i <‡->
Ä_ex‹Ás
; i++ )

64 iàĞ
	`hy³rÿÎ_´“m±_check
() )

66 
a
->
´“m±ed
 = 1;

67 
out
;

70 
·ge
 = 
	`®loc_domh—p_·ges
(
d
, 
a
->
ex‹Á_Üd”
,‡->
memæags
);

71 iàĞ
	`uÆik–y
(
·ge
 =ğ
NULL
) )

73 
	`gd´štk
(
XENLOG_INFO
, "Could‚ot‡llocate order=%dƒxtent: "

75 
a
->
ex‹Á_Üd”
, 
d
->
domaš_id
,‡->
memæags
,

76 
i
, 
a
->
Ä_ex‹Ás
);

77 
out
;

81 iàĞ!
	`gue¡_hªdË_is_nuÎ
(
a
->
ex‹Á_li¡
) )

83 
mâ
 = 
	`·ge_to_mâ
(
·ge
);

84 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
a
->
ex‹Á_li¡
, 
i
, &
mâ
, 1)) )

85 
out
;

89 
out
:

90 
a
->
Ä_dÚe
 = 
i
;

91 
	}
}

93 
	$pİuÏ‹_physm­
(
memİ_¬gs
 *
a
)

95 
·ge_šfo
 *
·ge
;

96 
i
, 
j
;

97 
x’_pâ_t
 
gpâ
, 
mâ
;

98 
domaš
 *
d
 = 
a
->domain;

100 iàĞ!
	`gue¡_hªdË_sub¿nge_okay
(
a
->
ex‹Á_li¡
,‡->
Ä_dÚe
,

101 
a
->
Ä_ex‹Ás
-1) )

104 iàĞ!
	`muÉage_®loÿtiÚ_³rm™‹d
(
cu¼’t
->
domaš
, 
a
->
ex‹Á_Üd”
) )

108  
i
 = 
a
->
Ä_dÚe
; i <‡->
Ä_ex‹Ás
; i++ )

110 iàĞ
	`hy³rÿÎ_´“m±_check
() )

112 
a
->
´“m±ed
 = 1;

113 
out
;

116 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
gpâ
, 
a
->
ex‹Á_li¡
, 
i
, 1)) )

117 
out
;

119 iàĞ
a
->
memæags
 & 
MEMF_pİuÏ‹_Ú_demªd
 )

121 iàĞ
	`gue¡_physm­_m¬k_pİuÏ‹_Ú_demªd
(
d
, 
gpâ
,

122 
a
->
ex‹Á_Üd”
) < 0 )

123 
out
;

127 #ifdeà
ENABLE_MULTI_NODE


129 
·ge
 = 
	`®loc_domh—p_·ges
(
d
, 
a
->
ex‹Á_Üd”
, (a->
memæags
 | 
	`MEMF_node
(
SLOW_MEMORY_NODE
)));

131 
·ge
 = 
	`®loc_domh—p_·ges
(
d
, 
a
->
ex‹Á_Üd”
,‡->
memæags
);

133 iàĞ
	`uÆik–y
(
·ge
 =ğ
NULL
) )

135 iàĞ!
İt_tmem
 || (
a
->
ex‹Á_Üd”
 != 0) )

136 
	`gd´štk
(
XENLOG_INFO
, "Could‚ot‡llocate order=%dƒxtent:"

138 
a
->
ex‹Á_Üd”
, 
d
->
domaš_id
,‡->
memæags
,

139 
i
, 
a
->
Ä_ex‹Ás
);

140 
out
;

143 
mâ
 = 
	`·ge_to_mâ
(
·ge
);

144 
	`gue¡_physm­_add_·ge
(
d
, 
gpâ
, 
mâ
, 
a
->
ex‹Á_Üd”
);

146 iàĞ!
	`·gšg_mode_Œª¦©e
(
d
) )

148  
j
 = 0; j < (1 << 
a
->
ex‹Á_Üd”
); j++ )

149 
	`£t_gpâ_äom_mâ
(
mâ
 + 
j
, 
gpâ
 + j);

152 iàĞ
	`uÆik–y
(
	`__cİy_to_gue¡_off£t
(
a
->
ex‹Á_li¡
, 
i
, &
mâ
, 1)) )

153 
out
;

157 
	`´štk
("NUMA…ag®loc:%d\n",
i
);

159 
out
:

160 
a
->
Ä_dÚe
 = 
i
;

161 
	}
}

163 
	$gue¡_»move_·ge
(
domaš
 *
d
, 
gmâ
)

165 
·ge_šfo
 *
·ge
;

166 #ifdeà
CONFIG_X86


167 
p2m_ty³_t
 
p2mt
;

169 
mâ
;

171 #ifdeà
CONFIG_X86


172 
mâ
 = 
	`mâ_x
(
	`gâ_to_mâ
(
	`p2m_g‘_ho¡p2m
(
d
), 
gmâ
, &
p2mt
));

173 iàĞ
	`uÆik–y
(
	`p2m_is_·gšg
(
p2mt
)) )

175 
	`gue¡_physm­_»move_·ge
(
d
, 
gmâ
, 
mâ
, 0);

176 
	`p2m_mem_·gšg_drİ_·ge
(
	`p2m_g‘_ho¡p2m
(
d
), 
gmâ
);

180 
mâ
 = 
	`gmâ_to_mâ
(
d
, 
gmâ
);

182 iàĞ
	`uÆik–y
(!
	`mâ_v®id
(
mâ
)) )

184 
	`gd´štk
(
XENLOG_INFO
, "Domain %u…age‚umber %lx invalid\n",

185 
d
->
domaš_id
, 
gmâ
);

189 
·ge
 = 
	`mâ_to_·ge
(
mâ
);

190 #ifdeà
CONFIG_X86


193 if(
	`p2m_is_sh¬ed
(
p2mt
))

195 
	`put_·ge_ªd_ty³
(
·ge
);

196 
	`gue¡_physm­_»move_·ge
(
d
, 
gmâ
, 
mâ
, 0);

201 iàĞ
	`uÆik–y
(!
	`g‘_·ge
(
·ge
, 
d
)) )

203 
	`gd´štk
(
XENLOG_INFO
, "Bad…agä“ fÜ domaš %u\n", 
d
->
domaš_id
);

207 iàĞ
	`‹¡_ªd_ş—r_b™
(
_PGT_pšÃd
, &
·ge
->
u
.
šu£
.
ty³_šfo
) )

208 
	`put_·ge_ªd_ty³
(
·ge
);

210 iàĞ
	`‹¡_ªd_ş—r_b™
(
_PGC_®loÿ‹d
, &
·ge
->
couÁ_šfo
) )

211 
	`put_·ge
(
·ge
);

213 
	`gue¡_physm­_»move_·ge
(
d
, 
gmâ
, 
mâ
, 0);

215 
	`put_·ge
(
·ge
);

218 
	}
}

220 
	$deü—£_»£rv©iÚ
(
memİ_¬gs
 *
a
)

222 
i
, 
j
;

223 
x’_pâ_t
 
gmâ
;

225 iàĞ!
	`gue¡_hªdË_sub¿nge_okay
(
a
->
ex‹Á_li¡
,‡->
Ä_dÚe
,

226 
a
->
Ä_ex‹Ás
-1) )

229  
i
 = 
a
->
Ä_dÚe
; i <‡->
Ä_ex‹Ás
; i++ )

231 iàĞ
	`hy³rÿÎ_´“m±_check
() )

233 
a
->
´“m±ed
 = 1;

234 
out
;

237 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(&
gmâ
, 
a
->
ex‹Á_li¡
, 
i
, 1)) )

238 
out
;

240 iàĞ
tb_š™_dÚe
 )

243 
u64
 
gâ
;

244 
d
:16,
Üd”
:16;

245 } 
t
;

247 
t
.
gâ
 = 
gmâ
;

248 
t
.
d
 = 
a
->
domaš
->
domaš_id
;

249 
t
.
Üd”
 = 
a
->
ex‹Á_Üd”
;

251 
	`__Œaû_v¬
(
TRC_MEM_DECREASE_RESERVATION
, 0, (
t
), &t);

255 iàĞ
	`is_hvm_domaš
(
a
->
domaš
)

256 && 
	`p2m_pod_deü—£_»£rv©iÚ
(
a
->
domaš
, 
gmâ
,‡->
ex‹Á_Üd”
) )

259  
j
 = 0; j < (1 << 
a
->
ex‹Á_Üd”
); j++ )

260 iàĞ!
	`gue¡_»move_·ge
(
a
->
domaš
, 
gmâ
 + 
j
) )

261 
out
;

264 
out
:

265 
a
->
Ä_dÚe
 = 
i
;

266 
	}
}

268 
memÜy_exchªge
(
	$XEN_GUEST_HANDLE
(
x’_memÜy_exchªge_t
è
¬g
)

270 
x’_memÜy_exchªge
 
exch
;

271 
	`PAGE_LIST_HEAD
(
š_chunk_li¡
);

272 
	`PAGE_LIST_HEAD
(
out_chunk_li¡
);

273 
š_chunk_Üd”
, 
out_chunk_Üd”
;

274 
x’_pâ_t
 
gpâ
, 
gmâ
, 
mâ
;

275 
i
, 
j
, 
k
;

276 
memæags
 = 0;

277 
rc
 = 0;

278 
domaš
 *
d
;

279 
·ge_šfo
 *
·ge
;

281 iàĞ
	`cİy_äom_gue¡
(&
exch
, 
¬g
, 1) )

282  -
EFAULT
;

285 iàĞ(
exch
.
Ä_exchªged
 >ƒxch.
š
.
Ä_ex‹Ás
) ||

287 (
exch
.
š
.
domid
 !ğexch.
out
.domid) ||

289 ((~0UL >> 
exch
.
š
.
ex‹Á_Üd”
è<ƒxch.š.
Ä_ex‹Ás
) ||

290 ((~0UL >> 
exch
.
out
.
ex‹Á_Üd”
è<ƒxch.out.
Ä_ex‹Ás
) ||

292 ((
exch
.
š
.
Ä_ex‹Ás
 <<ƒxch.š.
ex‹Á_Üd”
) !=

293 (
exch
.
out
.
Ä_ex‹Ás
 <<ƒxch.out.
ex‹Á_Üd”
)) )

295 
rc
 = -
EINVAL
;

296 
ç_—¾y
;

300 iàĞ!
	`muÉage_®loÿtiÚ_³rm™‹d
(
cu¼’t
->
domaš
,

301 
exch
.
š
.
ex‹Á_Üd”
) ||

302 !
	`muÉage_®loÿtiÚ_³rm™‹d
(
cu¼’t
->
domaš
,

303 
exch
.
out
.
ex‹Á_Üd”
) )

305 
rc
 = -
EPERM
;

306 
ç_—¾y
;

309 iàĞ
exch
.
š
.
ex‹Á_Üd”
 <ğexch.
out
.extent_order )

311 
š_chunk_Üd”
 = 
exch
.
out
.
ex‹Á_Üd”
 -ƒxch.
š
.extent_order;

312 
out_chunk_Üd”
 = 0;

316 
š_chunk_Üd”
 = 0;

317 
out_chunk_Üd”
 = 
exch
.
š
.
ex‹Á_Üd”
 -ƒxch.
out
.extent_order;

320 iàĞ
	`lik–y
(
exch
.
š
.
domid
 =ğ
DOMID_SELF
) )

322 
d
 = 
	`rcu_lock_cu¼’t_domaš
();

326 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
exch
.
š
.
domid
)è=ğ
NULL
 )

327 
ç_—¾y
;

329 iàĞ!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
) )

331 
	`rcu_uÆock_domaš
(
d
);

332 
rc
 = -
EPERM
;

333 
ç_—¾y
;

337 
memæags
 |ğ
	`MEMF_b™s
(
	`domaš_şamp_®loc_b™size
(

338 
d
,

339 
	`XENMEMF_g‘_add»ss_b™s
(
exch
.
out
.
mem_æags
) ? :

340 (
BITS_PER_LONG
+
PAGE_SHIFT
)));

341 
memæags
 |ğ
	`MEMF_node
(
	`XENMEMF_g‘_node
(
exch
.
out
.
mem_æags
));

343  
i
 = (
exch
.
Ä_exchªged
 >> 
š_chunk_Üd”
);

344 
i
 < (
exch
.
š
.
Ä_ex‹Ás
 >> 
š_chunk_Üd”
);

345 
i
++ )

347 iàĞ
	`hy³rÿÎ_´“m±_check
() )

349 
exch
.
Ä_exchªged
 = 
i
 << 
š_chunk_Üd”
;

350 
	`rcu_uÆock_domaš
(
d
);

351 iàĞ
	`cİy_f›ld_to_gue¡
(
¬g
, &
exch
, 
Ä_exchªged
) )

352  -
EFAULT
;

353  
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(

354 
__HYPERVISOR_memÜy_İ
, "lh", 
XENMEM_exchªge
, 
¬g
);

358  
j
 = 0; j < (1UL << 
š_chunk_Üd”
); j++ )

360 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡_off£t
(

361 &
gmâ
, 
exch
.
š
.
ex‹Á_¡¬t
, (
i
<<
š_chunk_Üd”
)+
j
, 1)) )

363 
rc
 = -
EFAULT
;

364 
ç
;

367  
k
 = 0; k < (1UL << 
exch
.
š
.
ex‹Á_Üd”
); k++ )

369 #ifdeà
CONFIG_X86


370 
p2m_ty³_t
 
p2mt
;

373 
mâ
 = 
	`mâ_x
(
	`gâ_to_mâ_unsh¬e
(
	`p2m_g‘_ho¡p2m
(
d
), 
gmâ
 + 
k
, &
p2mt
, 0));

374 iàĞ
	`p2m_is_sh¬ed
(
p2mt
) )

376 
rc
 = -
ENOMEM
;

377 
ç
;

380 
mâ
 = 
	`gmâ_to_mâ
(
d
, 
gmâ
 + 
k
);

382 iàĞ
	`uÆik–y
(!
	`mâ_v®id
(
mâ
)) )

384 
rc
 = -
EINVAL
;

385 
ç
;

388 
·ge
 = 
	`mâ_to_·ge
(
mâ
);

390 iàĞ
	`uÆik–y
(
	`¡—l_·ge
(
d
, 
·ge
, 
MEMF_no_»fcouÁ
)) )

392 
rc
 = -
EINVAL
;

393 
ç
;

396 
	`·ge_li¡_add
(
·ge
, &
š_chunk_li¡
);

401  
j
 = 0; j < (1UL << 
out_chunk_Üd”
); j++ )

403 
·ge
 = 
	`®loc_domh—p_·ges
(
NULL
, 
exch
.
out
.
ex‹Á_Üd”
, 
memæags
);

404 iàĞ
	`uÆik–y
(
·ge
 =ğ
NULL
) )

406 
rc
 = -
ENOMEM
;

407 
ç
;

410 
	`·ge_li¡_add
(
·ge
, &
out_chunk_li¡
);

418  (
·ge
 = 
	`·ge_li¡_»move_h—d
(&
š_chunk_li¡
)) )

420 
gâ
;

422 iàĞ!
	`‹¡_ªd_ş—r_b™
(
_PGC_®loÿ‹d
, &
·ge
->
couÁ_šfo
) )

423 
	`BUG
();

424 
mâ
 = 
	`·ge_to_mâ
(
·ge
);

425 
gâ
 = 
	`mâ_to_gmâ
(
d
, 
mâ
);

427 
	`BUG_ON
(
	`SHARED_M2P
(
gâ
));

428 
	`gue¡_physm­_»move_·ge
(
d
, 
gâ
, 
mâ
, 0);

429 
	`put_·ge
(
·ge
);

433 
j
 = 0;

434  (
·ge
 = 
	`·ge_li¡_»move_h—d
(&
out_chunk_li¡
)) )

436 iàĞ
	`assign_·ges
(
d
, 
·ge
, 
exch
.
out
.
ex‹Á_Üd”
,

437 
MEMF_no_»fcouÁ
) )

439 
dec_couÁ
;

440 
boŞ_t
 
drİ_dom_»f
;

449 
dec_couÁ
 = (((1UL << 
exch
.
š
.
ex‹Á_Üd”
) *

450 (1UL << 
š_chunk_Üd”
)) -

451 (
j
 * (1UL << 
exch
.
out
.
ex‹Á_Üd”
)));

453 
	`¥š_lock
(&
d
->
·ge_®loc_lock
);

454 
d
->
tÙ_·ges
 -ğ
dec_couÁ
;

455 
drİ_dom_»f
 = (
dec_couÁ
 && !
d
->
tÙ_·ges
);

456 
	`¥š_uÆock
(&
d
->
·ge_®loc_lock
);

458 iàĞ
drİ_dom_»f
 )

459 
	`put_domaš
(
d
);

461 
	`ä“_domh—p_·ges
(
·ge
, 
exch
.
out
.
ex‹Á_Üd”
);

462 
dyšg
;

466 ()
	`__cİy_äom_gue¡_off£t
(

467 &
gpâ
, 
exch
.
out
.
ex‹Á_¡¬t
, (
i
<<
out_chunk_Üd”
)+
j
, 1);

469 
mâ
 = 
	`·ge_to_mâ
(
·ge
);

470 
	`gue¡_physm­_add_·ge
(
d
, 
gpâ
, 
mâ
, 
exch
.
out
.
ex‹Á_Üd”
);

472 iàĞ!
	`·gšg_mode_Œª¦©e
(
d
) )

474  
k
 = 0; k < (1UL << 
exch
.
out
.
ex‹Á_Üd”
); k++ )

475 
	`£t_gpâ_äom_mâ
(
mâ
 + 
k
, 
gpâ
 + k);

476 ()
	`__cİy_to_gue¡_off£t
(

477 
exch
.
out
.
ex‹Á_¡¬t
, (
i
<<
out_chunk_Üd”
)+
j
, &
mâ
, 1);

479 
j
++;

481 
	`BUG_ON
Ğ!(
d
->
is_dyšg
è&& (
j
 !ğ(1UL << 
out_chunk_Üd”
)) );

484 
exch
.
Ä_exchªged
 =ƒxch.
š
.
Ä_ex‹Ás
;

485 iàĞ
	`cİy_f›ld_to_gue¡
(
¬g
, &
exch
, 
Ä_exchªged
) )

486 
rc
 = -
EFAULT
;

487 
	`rcu_uÆock_domaš
(
d
);

488  
rc
;

494 
ç
:

496  (
·ge
 = 
	`·ge_li¡_»move_h—d
(&
š_chunk_li¡
)) )

497 iàĞ
	`assign_·ges
(
d
, 
·ge
, 0, 
MEMF_no_»fcouÁ
) )

498 
	`BUG
();

499 
dyšg
:

500 
	`rcu_uÆock_domaš
(
d
);

502  (
·ge
 = 
	`·ge_li¡_»move_h—d
(&
out_chunk_li¡
)) )

503 
	`ä“_domh—p_·ges
(
·ge
, 
exch
.
out
.
ex‹Á_Üd”
);

505 
exch
.
Ä_exchªged
 = 
i
 << 
š_chunk_Üd”
;

507 
ç_—¾y
:

508 iàĞ
	`cİy_f›ld_to_gue¡
(
¬g
, &
exch
, 
Ä_exchªged
) )

509 
rc
 = -
EFAULT
;

510  
rc
;

511 
	}
}

513 
do_memÜy_İ
(
cmd
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

515 
domaš
 *
d
;

516 
rc
, 
İ
;

517 
add»ss_b™s
;

518 
¡¬t_ex‹Á
;

519 
x’_memÜy_»£rv©iÚ
 
»£rv©iÚ
;

520 
memİ_¬gs
 
¬gs
;

521 
domid_t
 
domid
;

523 
İ
 = 
cmd
 & 
MEMOP_CMD_MASK
;

525  
İ
 )

527 
XENMEM_šü—£_»£rv©iÚ
:

528 
XENMEM_deü—£_»£rv©iÚ
:

529 
XENMEM_pİuÏ‹_physm­
:

530 
¡¬t_ex‹Á
 = 
cmd
 >> 
MEMOP_EXTENT_SHIFT
;

532 iàĞ
	`cİy_äom_gue¡
(&
»£rv©iÚ
, 
¬g
, 1) )

533  
¡¬t_ex‹Á
;

536 iàĞ
»£rv©iÚ
.
Ä_ex‹Ás
 > (
ULONG_MAX
 >> 
MEMOP_EXTENT_SHIFT
) )

537  
¡¬t_ex‹Á
;

539 iàĞ
	`uÆik–y
(
¡¬t_ex‹Á
 >ğ
»£rv©iÚ
.
Ä_ex‹Ás
) )

540  
¡¬t_ex‹Á
;

542 
¬gs
.
ex‹Á_li¡
 = 
»£rv©iÚ
.
ex‹Á_¡¬t
;

543 
¬gs
.
Ä_ex‹Ás
 = 
»£rv©iÚ
.nr_extents;

544 
¬gs
.
ex‹Á_Üd”
 = 
»£rv©iÚ
.extent_order;

545 
¬gs
.
Ä_dÚe
 = 
¡¬t_ex‹Á
;

546 
¬gs
.
´“m±ed
 = 0;

547 
¬gs
.
memæags
 = 0;

549 
add»ss_b™s
 = 
	`XENMEMF_g‘_add»ss_b™s
(
»£rv©iÚ
.
mem_æags
);

550 iàĞ(
add»ss_b™s
 != 0) &&

551 (
add»ss_b™s
 < (
	`g‘_Üd”_äom_·ges
(
max_·ge
è+ 
PAGE_SHIFT
)) )

553 iàĞ
add»ss_b™s
 <ğ
PAGE_SHIFT
 )

554  
¡¬t_ex‹Á
;

555 
¬gs
.
memæags
 = 
	`MEMF_b™s
(
add»ss_b™s
);

558 
¬gs
.
memæags
 |ğ
	`MEMF_node
(
	`XENMEMF_g‘_node
(
»£rv©iÚ
.
mem_æags
));

559 iàĞ
»£rv©iÚ
.
mem_æags
 & 
XENMEMF_exaù_node_»que¡
 )

560 
¬gs
.
memæags
 |ğ
MEMF_exaù_node
;

562 iàĞ
İ
 =ğ
XENMEM_pİuÏ‹_physm­


563 && (
»£rv©iÚ
.
mem_æags
 & 
XENMEMF_pİuÏ‹_Ú_demªd
) )

564 
¬gs
.
memæags
 |ğ
MEMF_pİuÏ‹_Ú_demªd
;

566 iàĞ
	`lik–y
(
»£rv©iÚ
.
domid
 =ğ
DOMID_SELF
) )

568 
d
 = 
	`rcu_lock_cu¼’t_domaš
();

572 iàĞ(
d
 = 
	`rcu_lock_domaš_by_id
(
»£rv©iÚ
.
domid
)è=ğ
NULL
 )

573  
¡¬t_ex‹Á
;

574 iàĞ!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
) )

576 
	`rcu_uÆock_domaš
(
d
);

577  
¡¬t_ex‹Á
;

580 
¬gs
.
domaš
 = 
d
;

582 
rc
 = 
	`xsm_memÜy_adju¡_»£rv©iÚ
(
cu¼’t
->
domaš
, 
d
);

583 iàĞ
rc
 )

585 
	`rcu_uÆock_domaš
(
d
);

586  
rc
;

589  
İ
 )

591 
XENMEM_šü—£_»£rv©iÚ
:

592 
	`šü—£_»£rv©iÚ
(&
¬gs
);

594 
XENMEM_deü—£_»£rv©iÚ
:

595 
	`deü—£_»£rv©iÚ
(&
¬gs
);

598 
	`pİuÏ‹_physm­
(&
¬gs
);

602 
	`rcu_uÆock_domaš
(
d
);

604 
rc
 = 
¬gs
.
Ä_dÚe
;

606 iàĞ
¬gs
.
´“m±ed
 )

607  
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(

608 
__HYPERVISOR_memÜy_İ
, "lh",

609 
İ
 | (
rc
 << 
MEMOP_EXTENT_SHIFT
), 
¬g
);

613 
XENMEM_exchªge
:

614 
rc
 = 
	`memÜy_exchªge
(
	`gue¡_hªdË_ÿ¡
(
¬g
, 
x’_memÜy_exchªge_t
));

617 
XENMEM_maximum_¿m_·ge
:

618 
rc
 = 
max_·ge
;

621 
XENMEM_cu¼’t_»£rv©iÚ
:

622 
XENMEM_maximum_»£rv©iÚ
:

623 
XENMEM_maximum_gpâ
:

624 iàĞ
	`cİy_äom_gue¡
(&
domid
, 
¬g
, 1) )

625  -
EFAULT
;

627 
rc
 = 
	`rcu_lock_rg‘_domaš_by_id
(
domid
, &
d
);

628 iàĞ
rc
 )

629  
rc
;

631 
rc
 = 
	`xsm_memÜy_¡©_»£rv©iÚ
(
cu¼’t
->
domaš
, 
d
);

632 iàĞ
rc
 )

634 
	`rcu_uÆock_domaš
(
d
);

635  
rc
;

638  
İ
 )

640 
XENMEM_cu¼’t_»£rv©iÚ
:

641 
rc
 = 
d
->
tÙ_·ges
;

643 
XENMEM_maximum_»£rv©iÚ
:

644 
rc
 = 
d
->
max_·ges
;

647 
	`ASSERT
(
İ
 =ğ
XENMEM_maximum_gpâ
);

648 
rc
 = 
	`domaš_g‘_maximum_gpâ
(
d
);

652 
	`rcu_uÆock_domaš
(
d
);

657 
rc
 = 
	`¬ch_memÜy_İ
(
İ
, 
¬g
);

661  
rc
;

662 
	}
}

	@multicall.c

5 
	~<x’/cÚfig.h
>

6 
	~<x’/ty³s.h
>

7 
	~<x’/lib.h
>

8 
	~<x’/mm.h
>

9 
	~<x’/sched.h
>

10 
	~<x’/ev’t.h
>

11 
	~<x’/muÉiÿÎ.h
>

12 
	~<x’/gue¡_acûss.h
>

13 
	~<x’/³rfc.h
>

14 
	~<asm/cu¼’t.h
>

15 
	~<asm/h¬dœq.h
>

17 #iâdeà
COMPAT


18 
	t»t_t
;

19 
	#xÏt_muÉiÿÎ_’Œy
(
mcs
)

	)

22 
»t_t


23 
do_muÉiÿÎ
(

24 
	$XEN_GUEST_HANDLE
(
muÉiÿÎ_’Œy_t
è
ÿÎ_li¡
, 
Ä_ÿÎs
)

26 
mc_¡©e
 *
mcs
 = &
cu¼’t
->mc_state;

27 
i
;

29 iàĞ
	`uÆik–y
(
	`__‹¡_ªd_£t_b™
(
_MCSF_š_muÉiÿÎ
, &
mcs
->
æags
)) )

31 
	`gd´štk
(
XENLOG_INFO
, "Multicall„eentry is disallowed.\n");

32  -
EINVAL
;

35 iàĞ
	`uÆik–y
(!
	`gue¡_hªdË_okay
(
ÿÎ_li¡
, 
Ä_ÿÎs
)) )

36 
çuÉ
;

38  
i
 = 0; i < 
Ä_ÿÎs
; i++ )

40 iàĞ
	`hy³rÿÎ_´“m±_check
() )

41 
´“m±ed
;

43 iàĞ
	`uÆik–y
(
	`__cİy_äom_gue¡
(&
mcs
->
ÿÎ
, 
ÿÎ_li¡
, 1)) )

44 
çuÉ
;

46 
	`do_muÉiÿÎ_ÿÎ
(&
mcs
->
ÿÎ
);

48 #iâdeà
NDEBUG


54 
muÉiÿÎ_’Œy
 
cÜru±
;

55 
	`mem£t
(&
cÜru±
, 0xAA, (corrupt));

56 ()
	`__cİy_to_gue¡
(
ÿÎ_li¡
, &
cÜru±
, 1);

60 iàĞ
	`uÆik–y
(
	`__cİy_f›ld_to_gue¡
(
ÿÎ_li¡
, &
mcs
->
ÿÎ
, 
»suÉ
)) )

61 
çuÉ
;

63 iàĞ
	`‹¡_b™
(
_MCSF_ÿÎ_´“m±ed
, &
mcs
->
æags
) )

66 
	`xÏt_muÉiÿÎ_’Œy
(
mcs
);

69 ()
	`__cİy_to_gue¡
(
ÿÎ_li¡
, &
mcs
->
ÿÎ
, 1);

70 
´“m±ed
;

73 
	`gue¡_hªdË_add_off£t
(
ÿÎ_li¡
, 1);

76 
	`³rfc_šü
(
ÿÎs_to_muÉiÿÎ
);

77 
	`³rfc_add
(
ÿÎs_äom_muÉiÿÎ
, 
Ä_ÿÎs
);

78 
mcs
->
æags
 = 0;

81 
çuÉ
:

82 
	`³rfc_šü
(
ÿÎs_to_muÉiÿÎ
);

83 
mcs
->
æags
 = 0;

84  -
EFAULT
;

86 
´“m±ed
:

87 
	`³rfc_add
(
ÿÎs_äom_muÉiÿÎ
, 
i
);

88 
mcs
->
æags
 = 0;

89  
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(

90 
__HYPERVISOR_muÉiÿÎ
, "hi", 
ÿÎ_li¡
, 
Ä_ÿÎs
-
i
);

91 
	}
}

	@myperfmon.c

4 
	~<x’/sched.h
>

7 
	~<x’/h‘”ovisÜ.h
>

9 
DEFINE_PER_CPU
(
boŞ_t
, 
£tup_³rfmÚ
) = 0;

11 
	#EVENT_LLC_MISS
 0x2E

	)

12 
	#UMASK_LLC_MISS
 (0x41 << 8è

	)

14 
	#EVENT_LLC_REF
 0x2E

	)

15 
	#UMASK_LLC_REF
 (0x4F << 8è

	)

20 
	#EVENT_L2_LINES_IN
 0x2E

	)

21 
	#UMASK_L2_LINES_IN
 (0x41 << 8è

	)

23 
	#EVENT_L2_RQSTS
 0x2E

	)

24 
	#UMASK_L2_RQSTS
 (0x7à<< 8è

	)

32 
	#EVENT_BRCH_RETIRED
 0xC4

	)

33 
	#UMASK_BRCH_RETIRED
 (0x00 << 8è

	)

35 
	#EVENT_BRCH_MISSP_RETIRED
 0xC5

	)

36 
	#UMASK_BRCH_MISSP_RETIRED
 (0x00 << 8è

	)

44 
	#EVENT_OFFCORE_RESP
 0xB7

	)

45 
	#UMASK_OFFCORE_RESP
 (0x01 << 8è

	)

47 
	#PERFMON_ALL_RINGS
 (3 << 16)

	)

48 
	#CCCR_ENABLE_P6_CTR
 ( 1 << 22 )

	)

50 
	#EVT_PCTR0
 
UMASK_LLC_MISS
 | 
EVENT_LLC_MISS
 | 
PERFMON_ALL_RINGS
 | 
CCCR_ENABLE_P6_CTR
;

	)

53 
	#EVT_PCTR1
 
UMASK_OFFCORE_RESP
 | 
EVENT_OFFCORE_RESP
 | 
PERFMON_ALL_RINGS
 | 
CCCR_ENABLE_P6_CTR
;

	)

59 
DEFINE_PER_CPU
(
u64
, 
tsc_´ev
);

60 
DEFINE_PER_CPU
(
u64
, 
m³rf_´ev
);

61 
DEFINE_PER_CPU
(
u64
, 
»tœed_´ev
);

62 
DEFINE_PER_CPU
(
u64
, 
unh®‹d_´ev
);

64 
DEFINE_PER_CPU
(
u64
, 
pùr1_´ev
);

65 
DEFINE_PER_CPU
(
u64
, 
pùr0_´ev
);

67 
DEFINE_PER_CPU
(
u64
, 
dm³rf
);

68 
DEFINE_PER_CPU
(
u64
, 
dtsc
);

69 
DEFINE_PER_CPU
(
u64
, 
dš¡
);

70 
DEFINE_PER_CPU
(
u64
, 
dcyşes
);

71 
DEFINE_PER_CPU
(
u64
, 
dlmis£s
);

72 
DEFINE_PER_CPU
(
u64
, 
drmis£s
);

74 
	#CTR_MASK
 0xfffffffffffffffà

	)

75 
	#CTR_EXTEND
 0xfffffffffffffffà

	)

78 
ušt16_t
 
	g³rf_®pha
[2] = {151,64 };

79 
ušt16_t
 
	g³rf_b‘a
[2] = { 88,105};

81 
	$š™_³rf_ùrs
()

83 
u64
 
fixed
, 
glob®
, 
evt_pùr0
, 
evt_pùr1
;

84 
u64
 
u
;

87 
	`´“m±_di§bË
();

89 
	`rdm¤l
(
MSR_CORE_PERF_FIXED_CTR_CTRL
, 
fixed
);

91 
fixed
 = fixed |3 | ((3<<4) | (3<<8));

92 
	`wrm¤l
(
MSR_CORE_PERF_FIXED_CTR_CTRL
, 
fixed
);

94 
	`rdm¤l
(
MSR_CORE_PERF_GLOBAL_CTRL
, 
glob®
);

95 
glob®
 = global | (7UL<<32);

96 
	`wrm¤l
(
MSR_CORE_PERF_GLOBAL_CTRL
, 
glob®
);

98 
evt_pùr0
 = 
EVT_PCTR0
;

99 
evt_pùr1
 = 
EVT_PCTR1
;

101 
	`wrm¤l
(
MSR_P6_EVNTSEL0
,
evt_pùr0
);

103 
	`rdm¤l
(
MSR_CORE_PERF_GLOBAL_CTRL
,
evt_pùr0
);

104 
evt_pùr0
 |= 1;

105 
	`wrm¤l
(
MSR_CORE_PERF_GLOBAL_CTRL
,
evt_pùr0
);

107 
	`wrm¤l
(
MSR_P6_EVNTSEL1
,
evt_pùr1
);

109 
	`rdm¤l
(
MSR_CORE_PERF_GLOBAL_CTRL
,
evt_pùr1
);

110 
evt_pùr1
 |= 2;

111 
	`wrm¤l
(
MSR_CORE_PERF_GLOBAL_CTRL
,
evt_pùr1
);

114 
	`rdtsşl
(
	`__g‘_ıu_v¬
(
tsc_´ev
));

116 
	`rdm¤l
(
MSR_IA32_MPERF
, 
u
);

117 
	`__g‘_ıu_v¬
(
m³rf_´ev
èğ
u
;

119 
	`rdm¤l
(
MSR_CORE_PERF_FIXED_CTR0
, 
u
);

120 
	`__g‘_ıu_v¬
(
»tœed_´ev
èğ
u
;

122 
	`rdm¤l
(
MSR_CORE_PERF_FIXED_CTR1
, 
u
);

123 
	`__g‘_ıu_v¬
(
unh®‹d_´ev
èğ
u
;

128 
	`rdm¤l
(
MSR_P6_PERFCTR0
, 
u
);

129 
	`__g‘_ıu_v¬
(
pùr0_´ev
èğ
u
;

131 
	`rdm¤l
(
MSR_P6_PERFCTR1
, 
u
);

132 
	`__g‘_ıu_v¬
(
pùr1_´ev
èğ
u
;

134 
	`__g‘_ıu_v¬
(
£tup_³rfmÚ
)=1;

135 
	`´“m±_’abË
();

136 
	}
}

138 
šlše
 
s64
 
	$»ad_»tœed
()

140 
u64
 
u
;

142 
	`rdm¤l
(
MSR_CORE_PERF_FIXED_CTR0
, 
u
);

143  
u
;

144 
	}
}

146 
šlše
 
s64
 
	$»ad_unh®‹d
()

148 
u64
 
u
;

150 
	`rdm¤l
(
MSR_CORE_PERF_FIXED_CTR1
, 
u
);

151  
u
;

152 
	}
}

154 
šlše
 
s64
 
	$»ad_unh®‹d_»f
()

156 
u64
 
u
;

158 
	`rdm¤l
(
MSR_CORE_PERF_FIXED_CTR2
, 
u
);

159  
u
;

160 
	}
}

162 
šlše
 
s64
 
	$»ad_tsc
()

164 
u64
 
u
;

165 
	`rdtsşl
(
u
);

166  
u
;

167 
	}
}

169 
šlše
 
s64
 
	$»ad_m³rf
()

171 
u64
 
u
;

172 
	`rdm¤l
(
MSR_IA32_MPERF
,
u
);

173  
u
;

174 
	}
}

176 
šlše
 
s64
 
	$»ad_pùr1
()

178 
s64
 
v
;

179 
	`rdm¤l
(
MSR_P6_PERFCTR1
,
v
);

180  
v
;

181 
	}
}

183 
šlše
 
s64
 
	$»ad_pùr0
()

185 
s64
 
v
;

186 
	`rdm¤l
(
MSR_P6_PERFCTR0
,
v
);

187  
v
;

188 
	}
}

190 
s64
 
	$subŒaù
(
s64
 
a
, s64 
b
)

192 ià(
a
>
b
)

193  
a
-
b
;

196 
	}
}

198 
s64
 
	$ÿlc_pù_m‘ric
(
s64
 
dtİ
, s64 
dbÙtom
)

200 ià(
dbÙtom
>10000)

201 
dbÙtom
 /= 100;

203 
dtİ
 *= 100;

205 ià(!
dbÙtom
)

206 
dbÙtom
=1;

207 
dtİ
 /ğ
dbÙtom
;

208  
dtİ
;

209 
	}
}

212 
	$upd©e_couÁ”s_ıu
(*
d©a
)

214 
u64
 
tsc
, 
unh®‹d
, 
»tœed
, 
pùr1
, 
pùr0
, 
m³rf
;

215 
s64
 
d_tsc
, 
d_unh®‹d
, 
d_»tœed
, 
d_pùr1
, 
d_pùr0
, 
d_m³rf
;

218 
ıu
 = 
	`smp_´oûssÜ_id
();

222 ià(!
	`__g‘_ıu_v¬
(
£tup_³rfmÚ
))

223 
	`š™_³rf_ùrs
();

225 
	`´“m±_di§bË
();

228 
tsc
 = 
	`»ad_tsc
();

229 
m³rf
 = 
	`»ad_m³rf
();

230 
»tœed
 = 
	`»ad_»tœed
();

231 
unh®‹d
 = 
	`»ad_unh®‹d
();

233 
pùr1
 = 
	`»ad_pùr1
();

234 
pùr0
 = 
	`»ad_pùr0
();

237 
d_tsc
 = 
tsc
 - 
	`__g‘_ıu_v¬
(
tsc_´ev
);

239 
d_m³rf
 = 
m³rf
 - 
	`__g‘_ıu_v¬
(
m³rf_´ev
);

241 
d_»tœed
 = 
»tœed
 - 
	`__g‘_ıu_v¬
(
»tœed_´ev
);

242 ià(
d_»tœed
 < 0)

243 
d_»tœed
 +ğ
CTR_EXTEND
;

245 
d_unh®‹d
 = 
unh®‹d
 - 
	`__g‘_ıu_v¬
(
unh®‹d_´ev
);

246 ià(
d_unh®‹d
 < 0)

247 
d_unh®‹d
 +ğ
CTR_EXTEND
;

249 
d_pùr1
 = 
pùr1
 - 
	`__g‘_ıu_v¬
(
pùr1_´ev
);

250 ià(
d_pùr1
 < 0)

251 
d_pùr1
 +ğ
CTR_EXTEND
;

253 
d_pùr0
 = 
pùr0
 - 
	`__g‘_ıu_v¬
(
pùr0_´ev
);

254 ià(
d_pùr0
 < 0)

255 
d_pùr0
 +ğ
CTR_EXTEND
;

258 
	`__g‘_ıu_v¬
(
tsc_´ev
èğ
tsc
;

259 
	`__g‘_ıu_v¬
(
m³rf_´ev
èğ
m³rf
;

260 
	`__g‘_ıu_v¬
(
»tœed_´ev
èğ
»tœed
;

261 
	`__g‘_ıu_v¬
(
unh®‹d_´ev
èğ
unh®‹d
;

263 
	`__g‘_ıu_v¬
(
pùr1_´ev
èğ
pùr1
;

264 
	`__g‘_ıu_v¬
(
pùr0_´ev
èğ
pùr0
;

266 
	`__g‘_ıu_v¬
(
dm³rf
èğ
d_m³rf
;

267 
	`__g‘_ıu_v¬
(
dtsc
èğ
d_tsc
;

268 
	`__g‘_ıu_v¬
(
dš¡
èğ
d_»tœed
;

269 
	`__g‘_ıu_v¬
(
dcyşes
èğ
d_unh®‹d
;

270 
	`__g‘_ıu_v¬
(
dlmis£s
èğ
d_pùr0
;

271 
	`__g‘_ıu_v¬
(
drmis£s
èğ
d_pùr1
;

273 if(
h‘”o_debug_Ëv–
 >= 3)

274 
	`´štk
("ıu %dsø%ld m³rà%ld in¡ %ld cyş%ld…ùr0 %ld…ùr1 %ld\n",
ıu
,
d_tsc
/1000,
d_m³rf
/1000,
d_»tœed
/1000,
d_unh®‹d
/1000,
d_pùr0
/1000,
d_pùr1
/1000);

275 
	`´“m±_’abË
();

276 
	}
}

	@notifier.c

10 
	~<x’/cÚfig.h
>

11 
	~<x’/š™.h
>

12 
	~<x’/nÙif›r.h
>

22 
	$nÙif›r_chaš_»gi¡”
(

23 
nÙif›r_h—d
 *
nh
, 
nÙif›r_block
 *
n
)

25 
li¡_h—d
 *
chaš
 = &
nh
->
h—d
.chain;

26 
nÙif›r_block
 *
nb
;

28  
chaš
->
Ãxt
 !ğ&
nh
->
h—d
.chain )

30 
nb
 = 
	`li¡_’Œy
(
chaš
->
Ãxt
, 
nÙif›r_block
, chain);

31 iàĞ
n
->
´iÜ™y
 > 
nb
->priority )

33 
chaš
 = chaš->
Ãxt
;

36 
	`li¡_add
(&
n
->
chaš
, chain);

37 
	}
}

47 
	$nÙif›r_chaš_uÄegi¡”
(

48 
nÙif›r_h—d
 *
nh
, 
nÙif›r_block
 *
n
)

50 
	`li¡_d–
(&
n
->
chaš
);

51 
	}
}

69 
	$nÙif›r_ÿÎ_chaš
(

70 
nÙif›r_h—d
 *
nh
, 
v®
, *
v
,

71 
nÙif›r_block
 **
pcursÜ
)

73 
»t
 = 
NOTIFY_DONE
;

74 
li¡_h—d
 *
cursÜ
;

75 
nÙif›r_block
 *
nb
;

76 
boŞ_t
 
»v”£
 = !!(
v®
 & 
NOTIFY_REVERSE
);

78 
cursÜ
 = &(
pcursÜ
 && *pcursÜ ? *pcursÜ : &
nh
->
h—d
)->
chaš
;

81 
cursÜ
 = 
»v”£
 ? cursÜ->
´ev
 : cursÜ->
Ãxt
;

82 
nb
 = 
	`li¡_’Œy
(
cursÜ
, 
nÙif›r_block
, 
chaš
);

83 iàĞ
cursÜ
 =ğ&
nh
->
h—d
.
chaš
 )

85 
»t
 = 
nb
->
	`nÙif›r_ÿÎ
Òb, 
v®
, 
v
);

86 }  !(
»t
 & 
NOTIFY_STOP_MASK
) );

88 iàĞ
pcursÜ
 )

89 *
pcursÜ
 = 
nb
;

91  
»t
;

92 
	}
}

	@page_alloc.c

24 
	~<x’/cÚfig.h
>

25 
	~<x’/š™.h
>

26 
	~<x’/ty³s.h
>

27 
	~<x’/lib.h
>

28 
	~<x’/sched.h
>

29 
	~<x’/¥šlock.h
>

30 
	~<x’/mm.h
>

31 
	~<x’/œq.h
>

32 
	~<x’/soáœq.h
>

33 
	~<x’/domaš_·ge.h
>

34 
	~<x’/keyhªdËr.h
>

35 
	~<x’/³rfc.h
>

36 
	~<x’/numa.h
>

37 
	~<x’/nodemask.h
>

38 
	~<x’/tmem.h
>

39 
	~<x’/tmem_x’.h
>

40 
	~<public/sysùl.h
>

41 
	~<asm/·ge.h
>

42 
	~<asm/numa.h
>

43 
	~<asm/æushb.h
>

44 
	~<asm/p2m.h
>

50 
__š™d©a
 
	gİt_bad·ge
[100] = "";

51 
¡ršg_·¿m
("bad·ge", 
İt_bad·ge
);

56 
boŞ_t
 
İt_boÙsüub
 
	g__š™d©a
 = 1;

57 
boŞ—n_·¿m
("boÙsüub", 
İt_boÙsüub
);

63 
	gdma_b™size
;

64 
š‹g”_·¿m
("dma_b™s", 
dma_b™size
);

66 
	#round_pgdown
(
_p
è((_p)&
PAGE_MASK
)

	)

67 
	#round_pgup
(
_p
è(((_p)+(
PAGE_SIZE
-1))&
PAGE_MASK
)

	)

70 
PAGE_LIST_HEAD
(
·ge_ofæšed_li¡
);

72 
PAGE_LIST_HEAD
(
·ge_brok’_li¡
);

78 
__š™d©a
 
	gfœ¡_v®id_mâ
 = ~0UL;

80 
	sboÙmem_»giÚ
 {

81 
	ms
, 
	me
;

82 } *
__š™d©a
 
	gboÙmem_»giÚ_li¡
;

83 
__š™d©a
 
	gÄ_boÙmem_»giÚs
;

85 
__š™
 
	$boÙ_bug
(
lše
)

87 
	`·nic
("BoÙ BUG‡ˆ%s:%d\n", 
__FILE__
, 
lše
);

88 
	}
}

89 
	#BOOT_BUG_ON
(
p
èiàĞ°è
	`boÙ_bug
(
__LINE__
);

	)

91 
__š™
 
	$boÙmem_»giÚ_add
(
s
, 
e
)

93 
i
;

95 iàĞ(
boÙmem_»giÚ_li¡
 =ğ
NULL
è&& (
s
 < 
e
) )

96 
boÙmem_»giÚ_li¡
 = 
	`mâ_to_vœt
(
s
++);

98 iàĞ
s
 >ğ
e
 )

101  
i
 = 0; i < 
Ä_boÙmem_»giÚs
; i++ )

102 iàĞ
s
 < 
boÙmem_»giÚ_li¡
[
i
].
e
 )

105 
	`BOOT_BUG_ON
((
i
 < 
Ä_boÙmem_»giÚs
è&& (
e
 > 
boÙmem_»giÚ_li¡
[i].
s
));

106 
	`BOOT_BUG_ON
(
Ä_boÙmem_»giÚs
 ==

107 (
PAGE_SIZE
 / (
boÙmem_»giÚ
)));

109 
	`memmove
(&
boÙmem_»giÚ_li¡
[
i
+1], &bootmem_region_list[i],

110 (
Ä_boÙmem_»giÚs
 - 
i
è* (*
boÙmem_»giÚ_li¡
));

111 
boÙmem_»giÚ_li¡
[
i
] = (
boÙmem_»giÚ
è{ 
s
, 
e
 };

112 
Ä_boÙmem_»giÚs
++;

113 
	}
}

115 
__š™
 
	$boÙmem_»giÚ_z­
(
s
, 
e
)

117 
i
;

119  
i
 = 0; i < 
Ä_boÙmem_»giÚs
; i++ )

121 
boÙmem_»giÚ
 *
r
 = &
boÙmem_»giÚ_li¡
[
i
];

122 iàĞ
e
 <ğ
r
->
s
 )

124 iàĞ
s
 >ğ
r
->
e
 )

126 iàĞ
s
 <ğ
r
->s )

128 
r
->
s
 = 
	`mš
(
e
,„->e);

130 iàĞ
e
 >ğ
r
->e )

132 
r
->
e
 = 
s
;

136 
_e
 = 
r
->
e
;

137 
r
->
e
 = 
s
;

138 
	`boÙmem_»giÚ_add
(
e
, 
_e
);

141 
	}
}

143 
__š™
 
	$š™_boÙ_·ges
(
·ddr_t
 
ps
,…addr_ˆ
³
)

145 
bad_¥â
, 
bad_•â
;

146 cÚ¡ *
p
;

148 
ps
 = 
	`round_pgup
(ps);

149 
³
 = 
	`round_pgdown
(pe);

150 iàĞ
³
 <ğ
ps
 )

153 
fœ¡_v®id_mâ
 = 
	`mš_t
(, 
ps
 >> 
PAGE_SHIFT
, first_valid_mfn);

155 
	`boÙmem_»giÚ_add
(
ps
 >> 
PAGE_SHIFT
, 
³
 >> PAGE_SHIFT);

158 
p
 = 
İt_bad·ge
;

159  *
p
 != '\0' )

161 
bad_¥â
 = 
	`sim¶e_¡¹oul
(
p
, &p, 0);

162 
bad_•â
 = 
bad_¥â
;

164 iàĞ*
p
 == '-' )

166 
p
++;

167 
bad_•â
 = 
	`sim¶e_¡¹oul
(
p
, &p, 0);

168 iàĞ
bad_•â
 < 
bad_¥â
 )

169 
bad_•â
 = 
bad_¥â
;

172 iàĞ*
p
 == ',' )

173 
p
++;

174 iàĞ*
p
 != '\0' )

177 iàĞ
bad_•â
 =ğ
bad_¥â
 )

178 
	`´štk
("M¬kšg…ag%lx‡ bad\n", 
bad_¥â
);

180 
	`´štk
("Marking…ages %lxhrough %lx‡s bad\n",

181 
bad_¥â
, 
bad_•â
);

183 
	`boÙmem_»giÚ_z­
(
bad_¥â
, 
bad_•â
+1);

185 
	}
}

187 
__š™
 
	$®loc_boÙ_·ges
(

188 
Ä_pâs
, 
pâ_®ign
)

190 
pg
, 
_e
;

191 
i
;

193  
i
 = 
Ä_boÙmem_»giÚs
 - 1; i >= 0; i-- )

195 
boÙmem_»giÚ
 *
r
 = &
boÙmem_»giÚ_li¡
[
i
];

196 
pg
 = (
r
->
e
 - 
Ä_pâs
è& ~(
pâ_®ign
 - 1);

197 iàĞ
pg
 < 
r
->
s
 )

199 
_e
 = 
r
->
e
;

200 
r
->
e
 = 
pg
;

201 
	`boÙmem_»giÚ_add
(
pg
 + 
Ä_pâs
, 
_e
);

202  
pg
;

205 
	`BOOT_BUG_ON
(1);

207 
	}
}

215 
	#MEMZONE_XEN
 0

	)

216 
	#NR_ZONES
 (
PADDR_BITS
 - 
PAGE_SHIFT
)

	)

218 
	#b™s_to_zÚe
(
b
è(((bè< (
PAGE_SHIFT
 + 1)è? 0 : ((bè- PAGE_SHIFT - 1))

	)

219 
	#·ge_to_zÚe
(
pg
è(
	`is_x’_h—p_·ge
Õgè? 
MEMZONE_XEN
 : \

220 (
	`æs
(
	`·ge_to_mâ
(
pg
)è- 1))

	)

222 
·ge_li¡_h—d
 
	th—p_by_zÚe_ªd_Üd”_t
[
NR_ZONES
][
MAX_ORDER
+1];

223 
h—p_by_zÚe_ªd_Üd”_t
 *
	g_h—p
[
MAX_NUMNODES
];

224 
	#h—p
(
node
, 
zÚe
, 
Üd”
è((*
_h—p
[node])[zÚe][Üd”])

	)

226 *
	gava
[
MAX_NUMNODES
];

227 
	gtÙ®_ava_·ges
;

230 
	gmidsize_®loc_zÚe_·ges
;

231 
	#MIDSIZE_ALLOC_FRAC
 128

	)

233 
DEFINE_SPINLOCK
(
h—p_lock
);

235 
	$š™_node_h—p
(
node
, 
mâ
,

236 
Ä
, 
boŞ_t
 *
u£_
)

239 
h—p_by_zÚe_ªd_Üd”_t
 
_h—p_¡©ic
;

240 
ava_¡©ic
[
NR_ZONES
];

241 
fœ¡_node_š™Ÿli£d
;

242 
Ãeded
 = ((**
_h—p
) +

243 (**
ava
è* 
NR_ZONES
 +

244 
PAGE_SIZE
 - 1è>> 
PAGE_SHIFT
;

245 
i
, 
j
;

247 iàĞ!
fœ¡_node_š™Ÿli£d
 )

249 
_h—p
[
node
] = &
_h—p_¡©ic
;

250 
ava
[
node
] = 
ava_¡©ic
;

251 
fœ¡_node_š™Ÿli£d
 = 1;

252 
Ãeded
 = 0;

254 #ifdeà
DIRECTMAP_VIRT_END


255 iàĞ*
u£_
 && 
Ä
 >ğ
Ãeded
 &&

256 (
mâ
 + 
Ä
è<ğ(
	`vœt_to_mâ
(
DIRECTMAP_VIRT_END
 - 1) + 1) )

258 
_h—p
[
node
] = 
	`mâ_to_vœt
(
mâ
 + 
Ä
 - 
Ãeded
);

259 
ava
[
node
] = 
	`mâ_to_vœt
(
mâ
 + 
Ä
 - 1) +

260 
PAGE_SIZE
 - (**
ava
è* 
NR_ZONES
;

262 iàĞ
Ä
 >ğ
Ãeded
 &&

263 (
mâ
 + 
Ãeded
è<ğ(
	`vœt_to_mâ
(
DIRECTMAP_VIRT_END
 - 1) + 1) )

265 
_h—p
[
node
] = 
	`mâ_to_vœt
(
mâ
);

266 
ava
[
node
] = 
	`mâ_to_vœt
(
mâ
 + 
Ãeded
 - 1) +

267 
PAGE_SIZE
 - (**
ava
è* 
NR_ZONES
;

268 *
u£_
 = 0;

271 iàĞ
	`g‘_Üd”_äom_by‹s
((**
_h—p
)) ==

272 
	`g‘_Üd”_äom_·ges
(
Ãeded
) )

274 
_h—p
[
node
] = 
	`®loc_x’h—p_·ges
(
	`g‘_Üd”_äom_·ges
(
Ãeded
), 0);

275 
	`BUG_ON
(!
_h—p
[
node
]);

276 
ava
[
node
] = (*)
_h—p
[node] + (
Ãeded
 << 
PAGE_SHIFT
) -

277 (**
ava
è* 
NR_ZONES
;

278 
Ãeded
 = 0;

282 
_h—p
[
node
] = 
	`xm®loc
(
h—p_by_zÚe_ªd_Üd”_t
);

283 
ava
[
node
] = 
	`xm®loc_¬¿y
(, 
NR_ZONES
);

284 
	`BUG_ON
(!
_h—p
[
node
] || !
ava
[node]);

285 
Ãeded
 = 0;

288 
	`mem£t
(
ava
[
node
], 0, 
NR_ZONES
 * ());

290  
i
 = 0; i < 
NR_ZONES
; i++ )

291  
j
 = 0; j <ğ
MAX_ORDER
; j++ )

292 
	`INIT_PAGE_LIST_HEAD
(&(*
_h—p
[
node
])[
i
][
j
]);

294  
Ãeded
;

295 
	}
}

298 
·ge_šfo
 *
	$®loc_h—p_·ges
(

299 
zÚe_lo
, 
zÚe_hi
,

300 
Üd”
, 
memæags
,

301 
domaš
 *
d
)

303 
fœ¡_node
, 
i
, 
j
, 
zÚe
 = 0, 
nodemask_»Œy
 = 0;

304 
node
 = (
ušt8_t
)((
memæags
 >> 
_MEMF_node
) - 1);

305 
»que¡
 = 1UL << 
Üd”
;

306 
ıumask_t
 
exŒa_ıus_mask
, 
mask
;

307 
·ge_šfo
 *
pg
;

308 
nodemask_t
 
nodemask
 = (
d
 !ğ
NULL
 ) ? d->
node_affš™y
 : 
node_Úlše_m­
;

310 iàĞ
node
 =ğ
NUMA_NO_NODE
 )

312 
memæags
 &ğ~
MEMF_exaù_node
;

313 iàĞ
d
 !ğ
NULL
 )

315 
node
 = 
	`Ãxt_node
(
d
->
Ï¡_®loc_node
, 
nodemask
);

316 iàĞ
node
 >ğ
MAX_NUMNODES
 )

317 
node
 = 
	`fœ¡_node
(
nodemask
);

319 iàĞ
node
 >ğ
MAX_NUMNODES
 )

320 
node
 = 
	`ıu_to_node
(
	`smp_´oûssÜ_id
());

322 
fœ¡_node
 = 
node
;

324 
	`ASSERT
(
node
 >= 0);

325 
	`ASSERT
(
zÚe_lo
 <ğ
zÚe_hi
);

326 
	`ASSERT
(
zÚe_hi
 < 
NR_ZONES
);

328 iàĞ
	`uÆik–y
(
Üd”
 > 
MAX_ORDER
) ) {

329 ià(
mši_aùiv©ed
)

330 
	`´štk
("Fa dutØÏrgÜd”%d > %d(MAXè\n", 
Üd”
, 
MAX_ORDER
);

331  
NULL
;

333 
	`¥š_lock
(&
h—p_lock
);

340 iàĞ
İt_tmem
 && ((
Üd”
 == 0) || (order >= 9)) &&

341 (
tÙ®_ava_·ges
 <ğ
midsize_®loc_zÚe_·ges
) &&

342 
	`tmem_ä“abË_·ges
() )

343 
Œy_tmem
;

352 
zÚe
 = 
zÚe_hi
;

355 iàĞ!
ava
[
node
] || (ava[node][
zÚe
] < 
»que¡
) )

359  
j
 = 
Üd”
; j <ğ
MAX_ORDER
; j++ )

360 iàĞ(
pg
 = 
	`·ge_li¡_»move_h—d
(&
	`h—p
(
node
, 
zÚe
, 
j
))) )

361 
found
;

362 }  
zÚe
-- > 
zÚe_lo
 );

364 iàĞ
memæags
 & 
MEMF_exaù_node
 )

365 
nÙ_found
;

368 iàĞ!
	`node_is£t
(
node
, 
nodemask
) )

371 
	`ASSERT
(!
nodemask_»Œy
);

372 
fœ¡_node
 = 
node
 = 
	`fœ¡_node
(
nodemask
);

373 iàĞ
node
 < 
MAX_NUMNODES
 )

376 iàĞ(
node
 = 
	`Ãxt_node
Òode, 
nodemask
)è>ğ
MAX_NUMNODES
 )

377 
node
 = 
	`fœ¡_node
(
nodemask
);

378 iàĞ
node
 =ğ
fœ¡_node
 )

381 iàĞ
nodemask_»Œy
++ )

382 
nÙ_found
;

383 
	`nodes_ªdnÙ
(
nodemask
, 
node_Úlše_m­
,‚odemask);

384 
fœ¡_node
 = 
node
 = 
	`fœ¡_node
(
nodemask
);

385 iàĞ
node
 >ğ
MAX_NUMNODES
 )

386 
nÙ_found
;

390 
Œy_tmem
:

392 iàĞ(
pg
 = 
	`tmem_»lšquish_·ges
(
Üd”
, 
memæags
)è!ğ
NULL
 )

395 
	`¥š_uÆock
(&
h—p_lock
);

396  
pg
;

399 
nÙ_found
:

401 
	`¥š_uÆock
(&
h—p_lock
);

402 ià(
mši_aùiv©ed
) {

403 
	`´štk
("Fail dueo‚o suitable memory blocks\n");

404 
	`my´št_x’h—p
();

405 
	`my´št_x’h—p
();

406 
	`memËak_»pÜt
();

407 
	`memËak_»pÜt
();

409  
NULL
;

411 
found
:

413  
j
 !ğ
Üd”
 )

415 
	`PFN_ORDER
(
pg
èğ--
j
;

416 
	`·ge_li¡_add_
(
pg
, &
	`h—p
(
node
, 
zÚe
, 
j
));

417 
pg
 +ğ1 << 
j
;

420 
	`ASSERT
(
ava
[
node
][
zÚe
] >ğ
»que¡
);

421 
ava
[
node
][
zÚe
] -ğ
»que¡
;

422 
tÙ®_ava_·ges
 -ğ
»que¡
;

423 
	`ASSERT
(
tÙ®_ava_·ges
 >= 0);

425 iàĞ
d
 !ğ
NULL
 )

426 
d
->
Ï¡_®loc_node
 = 
node
;

428 
	`ıus_ş—r
(
mask
);

430  
i
 = 0; i < (1 << 
Üd”
); i++ )

433 
	`BUG_ON
(
pg
[
i
].
couÁ_šfo
 !ğ
PGC_¡©e_ä“
);

434 
pg
[
i
].
couÁ_šfo
 = 
PGC_¡©e_šu£
;

436 iàĞ
pg
[
i
].
u
.
ä“
.
Ãed_bæush
 )

439 
	`ıus_ªdnÙ
(
exŒa_ıus_mask
, 
ıu_Úlše_m­
, 
mask
);

440 
	`bæush_f‹r
(
exŒa_ıus_mask
, 
pg
[
i
].
bæush_time¡amp
);

441 
	`ıus_Ü
(
mask
, mask, 
exŒa_ıus_mask
);

445 
pg
[
i
].
u
.
šu£
.
ty³_šfo
 = 0;

446 
	`·ge_£t_owÃr
(&
pg
[
i
], 
NULL
);

449 
	`¥š_uÆock
(&
h—p_lock
);

451 iàĞ
	`uÆik–y
(!
	`ıus_em±y
(
mask
)) )

453 
	`³rfc_šü
(
Ãed_æush_b_æush
);

454 
	`æush_b_mask
(&
mask
);

457  
pg
;

458 
	}
}

461 
	$»£rve_ofæšed_·ge
(
·ge_šfo
 *
h—d
)

463 
node
 = 
	`phys_to_nid
(
	`·ge_to_maddr
(
h—d
));

464 
zÚe
 = 
	`·ge_to_zÚe
(
h—d
), 
i
, 
h—d_Üd”
 = 
	`PFN_ORDER
(h—d), 
couÁ
 = 0;

465 
·ge_šfo
 *
cur_h—d
;

466 
cur_Üd”
;

468 
	`ASSERT
(
	`¥š_is_locked
(&
h—p_lock
));

470 
cur_h—d
 = 
h—d
;

472 
	`·ge_li¡_d–
(
h—d
, &
	`h—p
(
node
, 
zÚe
, 
h—d_Üd”
));

474  
cur_h—d
 < (
h—d
 + (1 << 
h—d_Üd”
)) )

476 
·ge_šfo
 *
pg
;

477 
Ãxt_Üd”
;

479 iàĞ
	`·ge_¡©e_is
(
cur_h—d
, 
ofæšed
) )

481 
cur_h—d
++;

485 
Ãxt_Üd”
 = 
cur_Üd”
 = 0;

487  
cur_Üd”
 < 
h—d_Üd”
 )

489 
Ãxt_Üd”
 = 
cur_Üd”
 + 1;

491 iàĞ(
cur_h—d
 + (1 << 
Ãxt_Üd”
)è>ğ(
h—d
 + ( 1 << 
h—d_Üd”
)) )

492 
m”ge
;

494  
i
 = (1 << 
cur_Üd”
), 
pg
 = 
cur_h—d
 + (1 << cur_order );

495 
i
 < (1 << 
Ãxt_Üd”
);

496 
i
++, 
pg
++ )

497 iàĞ
	`·ge_¡©e_is
(
pg
, 
ofæšed
) )

499 iàĞ
i
 =ğĞ1 << 
Ãxt_Üd”
) )

501 
cur_Üd”
 = 
Ãxt_Üd”
;

506 
m”ge
:

508 
	`·ge_li¡_add_
(
cur_h—d
, &
	`h—p
(
node
, 
zÚe
, 
cur_Üd”
));

509 
	`PFN_ORDER
(
cur_h—d
èğ
cur_Üd”
;

510 
cur_h—d
 +ğ(1 << 
cur_Üd”
);

516  
cur_h—d
 = 
h—d
; cur_h—d < h—d + ( 1UL << 
h—d_Üd”
); cur_head++ )

518 iàĞ!
	`·ge_¡©e_is
(
cur_h—d
, 
ofæšed
) )

521 
ava
[
node
][
zÚe
]--;

522 
tÙ®_ava_·ges
--;

523 
	`ASSERT
(
tÙ®_ava_·ges
 >= 0);

525 
	`·ge_li¡_add_
(
cur_h—d
,

526 
	`‹¡_b™
(
_PGC_brok’
, &
cur_h—d
->
couÁ_šfo
) ?

527 &
·ge_brok’_li¡
 : &
·ge_ofæšed_li¡
);

529 
couÁ
++;

532  
couÁ
;

533 
	}
}

536 
	$ä“_h—p_·ges
(

537 
·ge_šfo
 *
pg
, 
Üd”
)

539 
mask
;

540 
i
, 
node
 = 
	`phys_to_nid
(
	`·ge_to_maddr
(
pg
)), 
š‹d
 = 0;

541 
zÚe
 = 
	`·ge_to_zÚe
(
pg
);

543 
	`ASSERT
(
Üd”
 <ğ
MAX_ORDER
);

544 
	`ASSERT
(
node
 >= 0);

546 
	`¥š_lock
(&
h—p_lock
);

548  
i
 = 0; i < (1 << 
Üd”
); i++ )

561 
	`ASSERT
(!
	`·ge_¡©e_is
(&
pg
[
i
], 
ofæšed
));

562 
pg
[
i
].
couÁ_šfo
 =

563 ((
pg
[
i
].
couÁ_šfo
 & 
PGC_brok’
) |

564 (
	`·ge_¡©e_is
(&
pg
[
i
], 
ofæššg
)

565 ? 
PGC_¡©e_ofæšed
 : 
PGC_¡©e_ä“
));

566 iàĞ
	`·ge_¡©e_is
(&
pg
[
i
], 
ofæšed
) )

567 
š‹d
 = 1;

570 
pg
[
i
].
u
.
ä“
.
Ãed_bæush
 = (
	`·ge_g‘_owÃr
(&pg[i]è!ğ
NULL
);

571 iàĞ
pg
[
i
].
u
.
ä“
.
Ãed_bæush
 )

572 
pg
[
i
].
bæush_time¡amp
 = 
	`bæush_cu¼’t_time
();

575 
ava
[
node
][
zÚe
] +ğ1 << 
Üd”
;

576 
tÙ®_ava_·ges
 +ğ1 << 
Üd”
;

578 iàĞ
İt_tmem
 )

579 
midsize_®loc_zÚe_·ges
 = 
	`max
(

580 
midsize_®loc_zÚe_·ges
, 
tÙ®_ava_·ges
 / 
MIDSIZE_ALLOC_FRAC
);

583  
Üd”
 < 
MAX_ORDER
 )

585 
mask
 = 1UL << 
Üd”
;

587 iàĞ(
	`·ge_to_mâ
(
pg
è& 
mask
) )

590 iàĞ!
	`mâ_v®id
(
	`·ge_to_mâ
(
pg
-
mask
)) ||

591 !
	`·ge_¡©e_is
(
pg
-
mask
, 
ä“
) ||

592 (
	`PFN_ORDER
(
pg
-
mask
è!ğ
Üd”
) ||

593 (
	`phys_to_nid
(
	`·ge_to_maddr
(
pg
-
mask
)è!ğ
node
) )

595 
pg
 -ğ
mask
;

596 
	`·ge_li¡_d–
(
pg
, &
	`h—p
(
node
, 
zÚe
, 
Üd”
));

601 iàĞ!
	`mâ_v®id
(
	`·ge_to_mâ
(
pg
+
mask
)) ||

602 !
	`·ge_¡©e_is
(
pg
+
mask
, 
ä“
) ||

603 (
	`PFN_ORDER
(
pg
+
mask
è!ğ
Üd”
) ||

604 (
	`phys_to_nid
(
	`·ge_to_maddr
(
pg
+
mask
)è!ğ
node
) )

606 
	`·ge_li¡_d–
(
pg
 + 
mask
, &
	`h—p
(
node
, 
zÚe
, 
Üd”
));

609 
Üd”
++;

612 
	`PFN_ORDER
(
pg
èğ
Üd”
;

613 
	`·ge_li¡_add_
(
pg
, &
	`h—p
(
node
, 
zÚe
, 
Üd”
));

615 iàĞ
š‹d
 )

616 
	`»£rve_ofæšed_·ge
(
pg
);

618 
	`¥š_uÆock
(&
h—p_lock
);

619 
	}
}

628 
	$m¬k_·ge_ofæše
(
·ge_šfo
 *
pg
, 
brok’
)

630 
nx
, 
x
, 
y
 = 
pg
->
couÁ_šfo
;

632 
	`ASSERT
(
	`·ge_is_¿m_ty³
(
	`·ge_to_mâ
(
pg
), 
RAM_TYPE_CONVENTIONAL
));

633 
	`ASSERT
(
	`¥š_is_locked
(&
h—p_lock
));

636 
nx
 = 
x
 = 
y
;

638 iàĞ((
x
 & 
PGC_¡©e
è!ğ
PGC_¡©e_ofæšed
) &&

639 ((
x
 & 
PGC_¡©e
è!ğ
PGC_¡©e_ofæššg
) )

641 
nx
 &ğ~
PGC_¡©e
;

642 
nx
 |ğ(((
x
 & 
PGC_¡©e
è=ğ
PGC_¡©e_ä“
)

643 ? 
PGC_¡©e_ofæšed
 : 
PGC_¡©e_ofæššg
);

646 iàĞ
brok’
 )

647 
nx
 |ğ
PGC_brok’
;

649 iàĞ
x
 =ğ
nx
 )

651 }  (
y
 = 
	`cmpxchg
(&
pg
->
couÁ_šfo
, 
x
, 
nx
)) != x );

653  
y
;

654 
	}
}

656 
	$»£rve_h—p_·ge
(
·ge_šfo
 *
pg
)

658 
·ge_šfo
 *
h—d
 = 
NULL
;

659 
i
, 
node
 = 
	`phys_to_nid
(
	`·ge_to_maddr
(
pg
));

660 
zÚe
 = 
	`·ge_to_zÚe
(
pg
);

662  
i
 = 0; i <ğ
MAX_ORDER
; i++ )

664 
·ge_šfo
 *
tmp
;

666 iàĞ
	`·ge_li¡_em±y
(&
	`h—p
(
node
, 
zÚe
, 
i
)) )

669 
	`·ge_li¡_fÜ_—ch_§ã
 ( 
h—d
, 
tmp
, &
	`h—p
(
node
, 
zÚe
, 
i
) )

671 iàĞ(
h—d
 <ğ
pg
) &&

672 (
h—d
 + (1UL << 
i
è> 
pg
) )

673  
	`»£rve_ofæšed_·ge
(
h—d
);

677  -
EINVAL
;

679 
	}
}

681 
	$ofæše_·ge
(
mâ
, 
brok’
, 
ušt32_t
 *
¡©us
)

683 
Şd_šfo
 = 0;

684 
domaš
 *
owÃr
;

685 
»t
 = 0;

686 
·ge_šfo
 *
pg
;

688 iàĞ!
	`mâ_v®id
(
mâ
) )

690 
	`d´štk
(
XENLOG_WARNING
,

691 "ŒyØofæš·gouˆoà¿ng%lx\n", 
mâ
);

692  -
EINVAL
;

695 *
¡©us
 = 0;

696 
pg
 = 
	`mâ_to_·ge
(
mâ
);

698 iàĞ
	`is_x’_fixed_mâ
(
mâ
) )

700 *
¡©us
 = 
PG_OFFLINE_XENPAGE
 | 
PG_OFFLINE_FAILED
 |

701 (
DOMID_XEN
 << 
PG_OFFLINE_OWNER_SHIFT
);

702  -
EPERM
;

709 iàĞ!
	`·ge_is_¿m_ty³
(
mâ
, 
RAM_TYPE_CONVENTIONAL
) )

711 *
¡©us
 = 
PG_OFFLINE_FAILED
 | 
PG_OFFLINE_NOT_CONV_RAM
;

712  -
EINVAL
;

715 
	`¥š_lock
(&
h—p_lock
);

717 
Şd_šfo
 = 
	`m¬k_·ge_ofæše
(
pg
, 
brok’
);

719 iàĞ
	`·ge_¡©e_is
(
pg
, 
ofæšed
) )

721 
	`»£rve_h—p_·ge
(
pg
);

722 *
¡©us
 = 
PG_OFFLINE_OFFLINED
;

724 iàĞ(
owÃr
 = 
	`·ge_g‘_owÃr_ªd_»ã»nû
(
pg
)) )

726 iàĞ
	`p2m_pod_ofæše_Ü_brok’_h™
(
pg
) )

727 
pod_»¶aû
;

730 *
¡©us
 = 
PG_OFFLINE_OWNED
 | 
PG_OFFLINE_PENDING
 |

731 (
owÃr
->
domaš_id
 << 
PG_OFFLINE_OWNER_SHIFT
);

733 
	`put_·ge
(
pg
);

736 iàĞ
Şd_šfo
 & 
PGC_x’_h—p
 )

738 *
¡©us
 = 
PG_OFFLINE_XENPAGE
 | 
PG_OFFLINE_PENDING
 |

739 (
DOMID_XEN
 << 
PG_OFFLINE_OWNER_SHIFT
);

751 *
¡©us
 = 
PG_OFFLINE_ANONYMOUS
 | 
PG_OFFLINE_FAILED
 |

752 (
DOMID_INVALID
 << 
PG_OFFLINE_OWNER_SHIFT
 );

755 iàĞ
brok’
 )

756 *
¡©us
 |ğ
PG_OFFLINE_BROKEN
;

758 
	`¥š_uÆock
(&
h—p_lock
);

760  
»t
;

762 
pod_»¶aû
:

763 
	`put_·ge
(
pg
);

764 
	`¥š_uÆock
(&
h—p_lock
);

766 
	`p2m_pod_ofæše_Ü_brok’_»¶aû
(
pg
);

767 *
¡©us
 = 
PG_OFFLINE_OFFLINED
;

769 iàĞ
brok’
 )

770 *
¡©us
 |ğ
PG_OFFLINE_BROKEN
;

772  
»t
;

773 
	}
}

780 
	$Úlše_·ge
(
mâ
, 
ušt32_t
 *
¡©us
)

782 
x
, 
nx
, 
y
;

783 
·ge_šfo
 *
pg
;

784 
»t
;

786 iàĞ!
	`mâ_v®id
(
mâ
) )

788 
	`d´štk
(
XENLOG_WARNING
, "callƒxpand_pages() first\n");

789  -
EINVAL
;

792 
pg
 = 
	`mâ_to_·ge
(
mâ
);

794 
	`¥š_lock
(&
h—p_lock
);

796 
y
 = 
pg
->
couÁ_šfo
;

798 
»t
 = *
¡©us
 = 0;

800 iàĞ
y
 & 
PGC_brok’
 )

802 
»t
 = -
EINVAL
;

803 *
¡©us
 = 
PG_ONLINE_FAILED
 |
PG_ONLINE_BROKEN
;

807 iàĞ(
y
 & 
PGC_¡©e
è=ğ
PGC_¡©e_ofæšed
 )

809 
	`·ge_li¡_d–
(
pg
, &
·ge_ofæšed_li¡
);

810 *
¡©us
 = 
PG_ONLINE_ONLINED
;

812 iàĞ(
y
 & 
PGC_¡©e
è=ğ
PGC_¡©e_ofæššg
 )

814 *
¡©us
 = 
PG_ONLINE_ONLINED
;

821 
x
 = 
y
;

822 
nx
 = (
x
 & ~
PGC_¡©e
è| 
PGC_¡©e_šu£
;

823 }  (
y
 = 
	`cmpxchg
(&
pg
->
couÁ_šfo
, 
x
, 
nx
)) != x );

825 
	`¥š_uÆock
(&
h—p_lock
);

827 iàĞ(
y
 & 
PGC_¡©e
è=ğ
PGC_¡©e_ofæšed
 )

828 
	`ä“_h—p_·ges
(
pg
, 0);

830  
»t
;

831 
	}
}

833 
	$qu”y_·ge_ofæše
(
mâ
, 
ušt32_t
 *
¡©us
)

835 
·ge_šfo
 *
pg
;

837 iàĞ!
	`mâ_v®id
(
mâ
è|| !
	`·ge_is_¿m_ty³
(mâ, 
RAM_TYPE_CONVENTIONAL
) )

839 
	`d´štk
(
XENLOG_WARNING
, "callƒxpand_pages() first\n");

840  -
EINVAL
;

843 *
¡©us
 = 0;

844 
	`¥š_lock
(&
h—p_lock
);

846 
pg
 = 
	`mâ_to_·ge
(
mâ
);

848 iàĞ
	`·ge_¡©e_is
(
pg
, 
ofæššg
) )

849 *
¡©us
 |ğ
PG_OFFLINE_STATUS_OFFLINE_PENDING
;

850 iàĞ
pg
->
couÁ_šfo
 & 
PGC_brok’
 )

851 *
¡©us
 |ğ
PG_OFFLINE_STATUS_BROKEN
;

852 iàĞ
	`·ge_¡©e_is
(
pg
, 
ofæšed
) )

853 *
¡©us
 |ğ
PG_OFFLINE_STATUS_OFFLINED
;

855 
	`¥š_uÆock
(&
h—p_lock
);

858 
	}
}

866 
	$š™_h—p_·ges
(

867 
·ge_šfo
 *
pg
, 
Ä_·ges
)

869 
i
;

871  
i
 = 0; i < 
Ä_·ges
; i++ )

873 
nid
 = 
	`phys_to_nid
(
	`·ge_to_maddr
(
pg
+
i
));

875 iàĞ
	`uÆik–y
(!
ava
[
nid
]) )

877 
s
 = 
	`·ge_to_mâ
(
pg
 + 
i
);

878 
e
 = 
	`·ge_to_mâ
(
pg
 + 
Ä_·ges
 - 1) + 1;

879 
boŞ_t
 
u£_
 = (
nid
 =ğ
	`phys_to_nid
(
	`pâ_to_·ddr
(
e
 - 1))) &&

880 !(
s
 & ((1UL << 
MAX_ORDER
) - 1)) &&

881 (
	`fšd_fœ¡_£t_b™
(
e
è<ğfšd_fœ¡_£t_b™(
s
));

882 
n
;

884 
n
 = 
	`š™_node_h—p
(
nid
, 
	`·ge_to_mâ
(
pg
+
i
), 
Ä_·ges
 - i,

885 &
u£_
);

886 
	`BUG_ON
(
i
 + 
n
 > 
Ä_·ges
);

887 iàĞ
n
 && !
u£_
 )

889 
i
 +ğ
n
 - 1;

892 iàĞ
i
 + 
n
 =ğ
Ä_·ges
 )

894 
Ä_·ges
 -ğ
n
;

897 
	`ä“_h—p_·ges
(
pg
+
i
, 0);

899 
	}
}

901 
	$ava_h—p_·ges
(

902 
zÚe_lo
, 
zÚe_hi
, 
node
)

904 
i
, 
zÚe
;

905 
ä“_·ges
 = 0;

907 iàĞ
zÚe_hi
 >ğ
NR_ZONES
 )

908 
zÚe_hi
 = 
NR_ZONES
 - 1;

910 
	`fÜ_—ch_Úlše_node
(
i
)

912 iàĞ!
ava
[
i
] )

914  
zÚe
 = 
zÚe_lo
; zÚ<ğ
zÚe_hi
; zone++ )

915 iàĞ(
node
 =ğ-1è|| (nod=ğ
i
) )

916 
ä“_·ges
 +ğ
ava
[
i
][
zÚe
];

919  
ä“_·ges
;

920 
	}
}

922 
	$tÙ®_ä“_·ges
()

924  
tÙ®_ava_·ges
 - 
midsize_®loc_zÚe_·ges
;

925 
	}
}

927 
__š™
 
	$’d_boÙ_®loÿtÜ
()

929 
i
;

932  
i
 = 0; i < 
Ä_boÙmem_»giÚs
; i++ )

934 
boÙmem_»giÚ
 *
r
 = &
boÙmem_»giÚ_li¡
[
i
];

935 iàĞ(
r
->
s
 <„->
e
) &&

936 (
	`phys_to_nid
(
	`pâ_to_·ddr
(
r
->
s
)è=ğ
	`ıu_to_node
(0)) )

938 
	`š™_h—p_·ges
(
	`mâ_to_·ge
(
r
->
s
),„->
e
 -„->s);

939 
r
->
e
 =„->
s
;

943  
i
 = 
Ä_boÙmem_»giÚs
; i-- > 0; )

945 
boÙmem_»giÚ
 *
r
 = &
boÙmem_»giÚ_li¡
[
i
];

946 iàĞ
r
->
s
 <„->
e
 )

947 
	`š™_h—p_·ges
(
	`mâ_to_·ge
(
r
->
s
),„->
e
 -„->s);

949 
	`š™_h—p_·ges
(
	`vœt_to_·ge
(
boÙmem_»giÚ_li¡
), 1);

951 iàĞ!
dma_b™size
 && (
	`num_Úlše_nodes
() > 1) )

953 #ifdeà
CONFIG_X86


954 
dma_b™size
 = 
	`mš_t
(,

955 
	`æs
(
	`NODE_DATA
(0)->
node_¥ªÃd_·ges
) - 1

956 + 
PAGE_SHIFT
 - 2,

959 
dma_b™size
 = 32;

963 
	`´štk
("Domain heap initialised");

964 iàĞ
dma_b™size
 )

965 
	`´štk
(" DMA width %u b™s", 
dma_b™size
);

966 
	`´štk
("\n");

967 
	}
}

974 
__š™
 
	$süub_h—p_·ges
()

976 
mâ
;

977 
·ge_šfo
 *
pg
;

979 iàĞ!
İt_boÙsüub
 )

982 
	`´štk
("Scrubbing Free RAM: ");

984  
mâ
 = 
fœ¡_v®id_mâ
; mâ < 
max_·ge
; mfn++ )

986 
	`´oûss_³ndšg_soáœqs
();

988 
pg
 = 
	`mâ_to_·ge
(
mâ
);

991 iàĞ!
	`mâ_v®id
(
mâ
è|| !
	`·ge_¡©e_is
(
pg
, 
ä“
) )

995 iàĞ(
mâ
 % ((100*1024*1024)/
PAGE_SIZE
)) == 0 )

996 
	`´štk
(".");

998 
	`¥š_lock
(&
h—p_lock
);

1001 iàĞ
	`·ge_¡©e_is
(
pg
, 
ä“
) )

1002 
	`süub_Úe_·ge
(
pg
);

1004 
	`¥š_uÆock
(&
h—p_lock
);

1007 
	`´štk
("done.\n");

1008 
	}
}

1016 #ià!
defšed
(
__x86_64__
è&& !defšed(
__Ÿ64__
)

1018 
	$š™_x’h—p_·ges
(
·ddr_t
 
ps
,…addr_ˆ
³
)

1020 
ps
 = 
	`round_pgup
(ps);

1021 
³
 = 
	`round_pgdown
(pe);

1022 iàĞ
³
 <ğ
ps
 )

1029 iàĞ
ps
 && !
	`is_x’_h—p_mâ
(
	`·ddr_to_pâ
(ps)-1) )

1030 
ps
 +ğ
PAGE_SIZE
;

1031 iàĞ!
	`is_x’_h—p_mâ
(
	`·ddr_to_pâ
(
³
)) )

1032 
³
 -ğ
PAGE_SIZE
;

1034 
	`memgu¬d_gu¬d_¿nge
(
	`maddr_to_vœt
(
ps
), 
³
 -…s);

1036 
	`š™_h—p_·ges
(
	`maddr_to_·ge
(
ps
), (
³
 -…sè>> 
PAGE_SHIFT
);

1037 
	}
}

1040 *
	$®loc_x’h—p_·ges
(
Üd”
, 
memæags
)

1042 
·ge_šfo
 *
pg
;

1044 
	`ASSERT
(!
	`š_œq
());

1046 
pg
 = 
	`®loc_h—p_·ges
(
MEMZONE_XEN
, MEMZONE_XEN,

1047 
Üd”
, 
memæags
, 
NULL
);

1048 iàĞ
	`uÆik–y
(
pg
 =ğ
NULL
) )

1049  
NULL
;

1051 
	`memgu¬d_ungu¬d_¿nge
(
	`·ge_to_vœt
(
pg
), 1 << (
Üd”
 + 
PAGE_SHIFT
));

1053  
	`·ge_to_vœt
(
pg
);

1054 
	}
}

1057 
	$ä“_x’h—p_·ges
(*
v
, 
Üd”
)

1059 
	`ASSERT
(!
	`š_œq
());

1061 iàĞ
v
 =ğ
NULL
 )

1064 
	`memgu¬d_gu¬d_¿nge
(
v
, 1 << (
Üd”
 + 
PAGE_SHIFT
));

1066 
	`ä“_h—p_·ges
(
	`vœt_to_·ge
(
v
), 
Üd”
);

1067 
	}
}

1071 
	$š™_x’h—p_·ges
(
·ddr_t
 
ps
,…addr_ˆ
³
)

1073 
	`š™_domh—p_·ges
(
ps
, 
³
);

1074 
	}
}

1076 *
	$®loc_x’h—p_·ges
(
Üd”
, 
memæags
)

1078 
·ge_šfo
 *
pg
;

1079 
i
;

1081 
	`ASSERT
(!
	`š_œq
());

1083 
pg
 = 
	`®loc_domh—p_·ges
(
NULL
, 
Üd”
, 
memæags
);

1084 iàĞ
	`uÆik–y
(
pg
 =ğ
NULL
) )

1085  
NULL
;

1087  
i
 = 0; i < (1u << 
Üd”
); i++ )

1088 
pg
[
i
].
couÁ_šfo
 |ğ
PGC_x’_h—p
;

1090  
	`·ge_to_vœt
(
pg
);

1091 
	}
}

1093 
	$ä“_x’h—p_·ges
(*
v
, 
Üd”
)

1095 
·ge_šfo
 *
pg
;

1096 
i
;

1098 
	`ASSERT
(!
	`š_œq
());

1100 iàĞ
v
 =ğ
NULL
 )

1103 
pg
 = 
	`vœt_to_·ge
(
v
);

1105  
i
 = 0; i < (1u << 
Üd”
); i++ )

1106 
pg
[
i
].
couÁ_šfo
 &ğ~
PGC_x’_h—p
;

1108 
	`ä“_h—p_·ges
(
pg
, 
Üd”
);

1109 
	}
}

1119 
	$š™_domh—p_·ges
(
·ddr_t
 
ps
,…addr_ˆ
³
)

1121 
smâ
, 
emâ
;

1123 
	`ASSERT
(!
	`š_œq
());

1125 
smâ
 = 
	`round_pgup
(
ps
è>> 
PAGE_SHIFT
;

1126 
emâ
 = 
	`round_pgdown
(
³
è>> 
PAGE_SHIFT
;

1128 
	`š™_h—p_·ges
(
	`mâ_to_·ge
(
smâ
), 
emâ
 - smfn);

1129 
	}
}

1132 
	$assign_·ges
(

1133 
domaš
 *
d
,

1134 
·ge_šfo
 *
pg
,

1135 
Üd”
,

1136 
memæags
)

1138 
i
;

1140 
	`¥š_lock
(&
d
->
·ge_®loc_lock
);

1142 iàĞ
	`uÆik–y
(
d
->
is_dyšg
) )

1144 
	`gd´štk
(
XENLOG_INFO
, "Cannot‡ssign…ageo domain%d -- dying.\n",

1145 
d
->
domaš_id
);

1146 
ç
;

1149 iàĞ!(
memæags
 & 
MEMF_no_»fcouÁ
) )

1151 iàĞ
	`uÆik–y
((
d
->
tÙ_·ges
 + (1 << 
Üd”
)è> d->
max_·ges
) )

1153 iàĞ!
İt_tmem
 || 
Üd”
 !ğ0 || 
d
->
tÙ_·ges
 !ğd->
max_·ges
 )

1154 
	`gd´štk
(
XENLOG_INFO
, "Over-allocation for domain %u: "

1155 "%u > %u\n", 
d
->
domaš_id
,

1156 
d
->
tÙ_·ges
 + (1 << 
Üd”
), d->
max_·ges
);

1157 
ç
;

1160 iàĞ
	`uÆik–y
(
d
->
tÙ_·ges
 == 0) )

1161 
	`g‘_knowÇlive_domaš
(
d
);

1163 
d
->
tÙ_·ges
 +ğ1 << 
Üd”
;

1166  
i
 = 0; i < (1 << 
Üd”
); i++ )

1168 
	`ASSERT
(
	`·ge_g‘_owÃr
(&
pg
[
i
]è=ğ
NULL
);

1169 
	`ASSERT
((
pg
[
i
].
couÁ_šfo
 & ~(
PGC_®loÿ‹d
 | 1)) == 0);

1170 
	`·ge_£t_owÃr
(&
pg
[
i
], 
d
);

1171 
	`wmb
();

1172 
pg
[
i
].
couÁ_šfo
 = 
PGC_®loÿ‹d
 | 1;

1173 
	`·ge_li¡_add_
(&
pg
[
i
], &
d
->
·ge_li¡
);

1176 
	`¥š_uÆock
(&
d
->
·ge_®loc_lock
);

1179 
ç
:

1180 
	`¥š_uÆock
(&
d
->
·ge_®loc_lock
);

1182 
	}
}

1185 
·ge_šfo
 *
	$®loc_domh—p_·ges
(

1186 
domaš
 *
d
, 
Üd”
, 
memæags
)

1188 
·ge_šfo
 *
pg
 = 
NULL
;

1189 
b™s
 = 
memæags
 >> 
_MEMF_b™s
, 
zÚe_hi
 = 
NR_ZONES
 - 1;

1190 
dma_zÚe
;

1192 
	`ASSERT
(!
	`š_œq
());

1194 
b™s
 = 
	`domaš_şamp_®loc_b™size
(
d
, b™ ? : (
BITS_PER_LONG
+
PAGE_SHIFT
));

1195 iàĞ(
zÚe_hi
 = 
	`mš_t
(, 
	`b™s_to_zÚe
(
b™s
), zone_hi)) == 0 )

1196  
NULL
;

1198 iàĞ
dma_b™size
 && ((
dma_zÚe
 = 
	`b™s_to_zÚe
(dma_b™size)è< 
zÚe_hi
) )

1199 
pg
 = 
	`®loc_h—p_·ges
(
dma_zÚe
 + 1, 
zÚe_hi
, 
Üd”
, 
memæags
, 
d
);

1201 iàĞ(
pg
 =ğ
NULL
) &&

1202 ((
memæags
 & 
MEMF_no_dma
) ||

1203 ((
pg
 = 
	`®loc_h—p_·ges
(
MEMZONE_XEN
 + 1, 
zÚe_hi
, 
Üd”
,

1204 
memæags
, 
d
)è=ğ
NULL
)) )

1205  
NULL
;

1207 iàĞ(
d
 !ğ
NULL
è&& 
	`assign_·ges
(d, 
pg
, 
Üd”
, 
memæags
) )

1209 
	`ä“_h—p_·ges
(
pg
, 
Üd”
);

1210  
NULL
;

1213  
pg
;

1214 
	}
}

1216 
	$ä“_domh—p_·ges
(
·ge_šfo
 *
pg
, 
Üd”
)

1218 
i
, 
drİ_dom_»f
;

1219 
domaš
 *
d
 = 
	`·ge_g‘_owÃr
(
pg
);

1221 
	`ASSERT
(!
	`š_œq
());

1223 iàĞ
	`uÆik–y
(
	`is_x’_h—p_·ge
(
pg
)) )

1226 
	`¥š_lock_»cursive
(&
d
->
·ge_®loc_lock
);

1228  
i
 = 0; i < (1 << 
Üd”
); i++ )

1229 
	`·ge_li¡_d–2
(&
pg
[
i
], &
d
->
x’·ge_li¡
, &d->
¬ch
.
»lmem_li¡
);

1231 
d
->
x’h—p_·ges
 -ğ1 << 
Üd”
;

1232 
drİ_dom_»f
 = (
d
->
x’h—p_·ges
 == 0);

1234 
	`¥š_uÆock_»cursive
(&
d
->
·ge_®loc_lock
);

1236 iàĞ
	`lik–y
(
d
 !ğ
NULL
è&&†ik–y(d !ğ
dom_cow
) )

1239 
	`¥š_lock_»cursive
(&
d
->
·ge_®loc_lock
);

1241  
i
 = 0; i < (1 << 
Üd”
); i++ )

1243 
	`BUG_ON
((
pg
[
i
].
u
.
šu£
.
ty³_šfo
 & 
PGT_couÁ_mask
) != 0);

1244 
	`·ge_li¡_d–2
(&
pg
[
i
], &
d
->
·ge_li¡
, &d->
¬ch
.
»lmem_li¡
);

1247 
d
->
tÙ_·ges
 -ğ1 << 
Üd”
;

1248 
drİ_dom_»f
 = (
d
->
tÙ_·ges
 == 0);

1250 
	`¥š_uÆock_»cursive
(&
d
->
·ge_®loc_lock
);

1257 iàĞ
	`uÆik–y
(
d
->
is_dyšg
) )

1258  
i
 = 0; i < (1 << 
Üd”
); i++ )

1259 
	`süub_Úe_·ge
(&
pg
[
i
]);

1261 
	`ä“_h—p_·ges
(
pg
, 
Üd”
);

1263 iàĞ
	`uÆik–y
(
d
 =ğ
dom_cow
) )

1265 
	`ASSERT
(
Üd”
 == 0);

1266 
	`süub_Úe_·ge
(
pg
);

1267 
	`ä“_h—p_·ges
(
pg
, 0);

1268 
drİ_dom_»f
 = 0;

1273 
	`ä“_h—p_·ges
(
pg
, 
Üd”
);

1274 
drİ_dom_»f
 = 0;

1277 iàĞ
drİ_dom_»f
 )

1278 
	`put_domaš
(
d
);

1279 
	}
}

1281 
	$ava_domh—p_·ges_»giÚ
(

1282 
node
, 
mš_width
, 
max_width
)

1284 
zÚe_lo
, 
zÚe_hi
;

1286 
zÚe_lo
 = 
mš_width
 ? 
	`b™s_to_zÚe
(mš_widthè: (
MEMZONE_XEN
 + 1);

1287 
zÚe_lo
 = 
	`max_t
(, 
MEMZONE_XEN
 + 1, 
	`mš_t
(, 
NR_ZONES
 - 1, zone_lo));

1289 
zÚe_hi
 = 
max_width
 ? 
	`b™s_to_zÚe
(max_widthè: (
NR_ZONES
 - 1);

1290 
zÚe_hi
 = 
	`max_t
(, 
MEMZONE_XEN
 + 1, 
	`mš_t
(, 
NR_ZONES
 - 1, zone_hi));

1292  
	`ava_h—p_·ges
(
zÚe_lo
, 
zÚe_hi
, 
node
);

1293 
	}
}

1295 
	$ava_domh—p_·ges
()

1297  
	`ava_h—p_·ges
(
MEMZONE_XEN
 + 1,

1298 
NR_ZONES
 - 1,

1300 
	}
}

1302 
	$ava_node_h—p_·ges
(
nodeid
)

1304  
	`ava_h—p_·ges
(
MEMZONE_XEN
, 
NR_ZONES
 -1, 
nodeid
);

1305 
	}
}

1307 
	$·g—Îoc_šfo
(
key
)

1309 
zÚe
 = 
MEMZONE_XEN
;

1310 
n
, 
tÙ®
 = 0;

1312 
	`´štk
("Physical memory information:\n");

1313 
	`´štk
(" Xen heap: %lukB free\n",

1314 
	`ava_h—p_·ges
(
zÚe
, zÚe, -1è<< (
PAGE_SHIFT
-10));

1316  ++
zÚe
 < 
NR_ZONES
 )

1318 iàĞ(
zÚe
 + 
PAGE_SHIFT
è=ğ
dma_b™size
 )

1320 
	`´štk
(" DMA h—p: %lukB f»e\n", 
tÙ®
 << (
PAGE_SHIFT
-10));

1321 
tÙ®
 = 0;

1324 iàĞ(
n
 = 
	`ava_h—p_·ges
(
zÚe
, zone, -1)) != 0 )

1326 
tÙ®
 +ğ
n
;

1327 
	`´štk
(" h—p[%02u]: %lukB f»e\n", 
zÚe
, 
n
 << (
PAGE_SHIFT
-10));

1331 
	`´štk
(" Dom h—p: %lukB f»e\n", 
tÙ®
 << (
PAGE_SHIFT
-10));

1332 
	}
}

1335 
	$my´št_x’h—p
() {

1336 
	`·g—Îoc_šfo
('m');

1337 
	}
}

1340 
keyhªdËr
 
	g·g—Îoc_šfo_keyhªdËr
 = {

1341 .
dŸgno¡ic
 = 1,

1342 .
	gu
.
	gâ
 = 
·g—Îoc_šfo
,

1343 .
	gdesc
 = "memory info"

1346 
__š™
 
	$·g—Îoc_keyhªdËr_š™
()

1348 
	`»gi¡”_keyhªdËr
('m', &
·g—Îoc_šfo_keyhªdËr
);

1350 
	}
}

1351 
__š™ÿÎ
(
·g—Îoc_keyhªdËr_š™
);

1354 
	$_mykeyhªdËr1
(
key
)

1356 #ifdeà
VERBOSE_PAGE_FAULT


1357 
pf_couÁ
 = 100;

1360 
	}
}

1361 
keyhªdËr
 
	gmykeyhªdËr1
 = {

1362 .
dŸgno¡ic
 = 0,

1363 .
	gu
.
	gâ
 = 
_mykeyhªdËr1
,

1364 .
	gdesc
 = "pageouch verbose"

1366 
__š™
 
	$mykeyhªdËr1_š™
()

1368 
	`»gi¡”_keyhªdËr
('1', &
mykeyhªdËr1
);

1370 
	}
}

1371 
__š™ÿÎ
(
mykeyhªdËr1_š™
);

1373 
	$_mykeyhªdËr2
(
key
)

1375 ià(
mši_aùiv©ed
) {

1376 
usched_´št
 = 100;

1378 
	`my´štk
("Not‡ctivated\n");

1379 
	}
}

1380 
keyhªdËr
 
	gmykeyhªdËr2
 = {

1381 .
dŸgno¡ic
 = 0,

1382 .
	gu
.
	gâ
 = 
_mykeyhªdËr2
,

1383 .
	gdesc
 = "usched verbose"

1385 
__š™
 
	$mykeyhªdËr2_š™
()

1387 
	`»gi¡”_keyhªdËr
('2', &
mykeyhªdËr2
);

1389 
	}
}

1390 
__š™ÿÎ
(
mykeyhªdËr2_š™
);

1392 #ifdeà
ENABLE_SYSCALL_USCHED


1393 
	$_mykeyhªdËr3
(
key
)

1395 
sysÿÎ_usched
 = 1-syscall_usched;

1396 
	`my´štk
("sysÿÎ_usched=%d\n", 
sysÿÎ_usched
);

1397 
	}
}

1398 
keyhªdËr
 
	gmykeyhªdËr3
 = {

1399 .
dŸgno¡ic
 = 0,

1400 .
	gu
.
	gâ
 = 
_mykeyhªdËr3
,

1401 .
	gdesc
 = "syscall_uschedoggle"

1403 
__š™
 
	$mykeyhªdËr3_š™
()

1405 
	`»gi¡”_keyhªdËr
('3', &
mykeyhªdËr3
);

1407 
	}
}

1408 
__š™ÿÎ
(
mykeyhªdËr3_š™
);

1412 #ifdeà
ENABLE_MYPROF


1413 
	$_mykeyhªdËr4
(
key
)

1415 
»t
;

1416 ià(
mši_aùiv©ed
) {

1417 
	`my´of_İ_š™
();

1418 
	`my´of_İ_š™
();

1419 
	`nmi_»£rve_couÁ”s
();

1420 
	`my´of_couÁ”
();

1421 
	`nmi_£tup_ev’ts
();

1422 
	`nmi_’abË_vœq
();

1424 
	`my´štk
("Not‡ctivated\n");

1425 
	}
}

1426 
keyhªdËr
 
	gmykeyhªdËr4
 = {

1427 .
dŸgno¡ic
 = 0,

1428 .
	gu
.
	gâ
 = 
_mykeyhªdËr4
,

1429 .
	gdesc
 = "init myprof"

1431 
__š™
 
	$mykeyhªdËr4_š™
()

1433 
	`»gi¡”_keyhªdËr
('4', &
mykeyhªdËr4
);

1435 
	}
}

1436 
__š™ÿÎ
(
mykeyhªdËr4_š™
);

1440 
	$_mykeyhªdËr5
(
key
)

1442 
my´of_ruÂšg
 = 0;

1443 
»t
;

1444 ià(
mši_aùiv©ed
) {

1445 ià(
my´of_ruÂšg
) {

1446 
	`my´štk
("Stopping..\n");

1447 
	`nmi_¡İ
();

1449 
	`my´štk
("Starting..\n");

1450 
	`nmi_¡¬t
();

1452 
my´of_ruÂšg
 = 1-myprof_running;

1454 
	`my´štk
("Not‡ctivated\n");

1455 
	}
}

1456 
keyhªdËr
 
	gmykeyhªdËr5
 = {

1457 .
dŸgno¡ic
 = 0,

1458 .
	gu
.
	gâ
 = 
_mykeyhªdËr5
,

1459 .
	gdesc
 = "myprof start/end"

1461 
__š™
 
	$mykeyhªdËr5_š™
()

1463 
	`»gi¡”_keyhªdËr
('5', &
mykeyhªdËr5
);

1465 
	}
}

1466 
__š™ÿÎ
(
mykeyhªdËr5_š™
);

1471 
memËak_»pÜt
();

1472 
	$_mykeyhªdËr_¥aû
(
key
)

1474 
	`my´št_x’h—p
();

1475 
	`´št_cÚfig
();

1476 
	`´št_pgds
(0);

1477 
	`´št_®l_v»giÚs
();

1478 
	`memËak_»pÜt
();

1479 #ifdeà
ENABLE_GUEST_REGION


1480 
	`´št_g¹
();

1482 #ifdeà
ENABLE_TRACK_SPINLOCK


1483 
	`¥šlock_»pÜt
();

1485 #ifdeà
ENABLE_TIMESTAMP


1486 
	`´št_time¡amp
();

1488 ià(!
mši_aùiv©ed
) {

1489 
	`´štk
("Not‡ctivated\n");

1500 
	}
}

1501 
keyhªdËr
 
	gmykeyhªdËr_¥aû
 = {

1502 .
dŸgno¡ic
 = 0,

1503 .
	gu
.
	gâ
 = 
_mykeyhªdËr_¥aû
,

1504 .
	gdesc
 = "print info"

1506 
__š™
 
	$mykeyhªdËr_¥aû_š™
()

1508 
	`»gi¡”_keyhªdËr
(' ', &
mykeyhªdËr_¥aû
);

1510 
	}
}

1511 
__š™ÿÎ
(
mykeyhªdËr_¥aû_š™
);

1514 
	$_mykeyhªdËr9
(
key
)

1516 
»t
;

1517 ià(!
mši_aùiv©ed
)

1518 
»t
 = 
	`’abË_soá_ÿche
();

1520 
»t
 = 
	`di§bË_soá_ÿche
();

1521 
	}
}

1522 
keyhªdËr
 
	gmykeyhªdËr9
 = {

1523 .
dŸgno¡ic
 = 0,

1524 .
	gu
.
	gâ
 = 
_mykeyhªdËr9
,

1525 .
	gdesc
 = "Activate/deactivate"

1527 
__š™
 
	$mykeyhªdËr9_š™
()

1529 
	`»gi¡”_keyhªdËr
('9', &
mykeyhªdËr9
);

1531 
	}
}

1532 
__š™ÿÎ
(
mykeyhªdËr9_š™
);

1535 
	$süub_Úe_·ge
(
·ge_šfo
 *
pg
)

1537 *
p
 = 
	`__m­_domaš_·ge
(
pg
);

1539 iàĞ
	`uÆik–y
(
pg
->
couÁ_šfo
 & 
PGC_brok’
) )

1542 #iâdeà
NDEBUG


1544 
	`mem£t
(
p
, 0xc2, 
PAGE_SIZE
);

1547 
	`ş—r_·ge
(
p
);

1550 
	`unm­_domaš_·ge
(
p
);

1551 
	}
}

1553 
	$dump_h—p
(
key
)

1555 
s_time_t
 
now
 = 
	`NOW
();

1556 
i
, 
j
;

1558 
	`´štk
("'%c'…»s£d -> dumpšg h—°šfØÒow-0x%X:%08X)\n", 
key
,

1559 (
u32
)(
now
>>32), (u32)now);

1561  
i
 = 0; i < 
MAX_NUMNODES
; i++ )

1563 iàĞ!
ava
[
i
] )

1565  
j
 = 0; j < 
NR_ZONES
; j++ )

1566 
	`´štk
("heap[node=%d][zone=%d] -> %lu…ages\n",

1567 
i
, 
j
, 
ava
[i][j]);

1569 
	}
}

1571 
keyhªdËr
 
	gdump_h—p_keyhªdËr
 = {

1572 .
dŸgno¡ic
 = 1,

1573 .
	gu
.
	gâ
 = 
dump_h—p
,

1574 .
	gdesc
 = "dump heap info"

1577 
__š™
 
	$»gi¡”_h—p_Œigg”
()

1579 
	`»gi¡”_keyhªdËr
('H', &
dump_h—p_keyhªdËr
);

1581 
	}
}

1582 
__š™ÿÎ
(
»gi¡”_h—p_Œigg”
);

	@perfc.c

2 
	~<x’/lib.h
>

3 
	~<x’/smp.h
>

4 
	~<x’/time.h
>

5 
	~<x’/³rfc.h
>

6 
	~<x’/keyhªdËr.h
>

7 
	~<x’/¥šlock.h
>

8 
	~<x’/mm.h
>

9 
	~<x’/gue¡_acûss.h
>

10 
	~<public/sysùl.h
>

11 
	~<asm/³rfc.h
>

13 
	#PERFCOUNTER
Ğ
v¬
, 
Çme
 ) {‚ame, 
TYPE_SINGLE
, 0 },

	)

14 
	#PERFCOUNTER_ARRAY
Ğ
v¬
, 
Çme
, 
size
 ) {‚ame, 
TYPE_ARRAY
, siz},

	)

15 
	#PERFSTATUS
Ğ
v¬
, 
Çme
 ) {‚ame, 
TYPE_S_SINGLE
, 0 },

	)

16 
	#PERFSTATUS_ARRAY
Ğ
v¬
, 
Çme
, 
size
 ) {‚ame, 
TYPE_S_ARRAY
, siz},

	)

18 cÚ¡ *
	mÇme
;

19 ’um { 
	mTYPE_SINGLE
, 
	mTYPE_ARRAY
,

20 
	mTYPE_S_SINGLE
, 
	mTYPE_S_ARRAY


21 } 
	mty³
;

22 
	mÄ_–em’ts
;

23 } 
	g³rfc_šfo
[] = {

24 
	~<x’/³rfc_deâ.h
>

27 
	#NR_PERFCTRS
 ((
³rfc_šfo
è/ Õ”fc_šfo[0]))

	)

29 
DEFINE_PER_CPU
(
³rfc_t
[
NUM_PERFCOUNTERS
], 
³rfcouÁ”s
);

31 
	$³rfc_´šÎ
(
key
)

33 
i
, 
j
;

34 
s_time_t
 
now
 = 
	`NOW
();

36 
	`´štk
("Xen…erformance counters SHOW (now = 0x%08X:%08X)\n",

37 (
u32
)(
now
>>32), (u32)now);

39  
i
 = 
j
 = 0; i < 
NR_PERFCTRS
; i++ )

41 
k
, 
ıu
;

42 
sum
 = 0;

44 
	`´štk
("%-32  ", 
³rfc_šfo
[
i
].
Çme
);

45  
³rfc_šfo
[
i
].
ty³
 )

47 
TYPE_SINGLE
:

48 
TYPE_S_SINGLE
:

49 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

50 
sum
 +ğ
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
)[
j
];

51 iàĞ
³rfc_šfo
[
i
].
ty³
 =ğ
TYPE_S_SINGLE
 )

52 
sum
 = (
³rfc_t
) sum;

53 
	`´štk
("TOTAL[%12Lu]", 
sum
);

54 iàĞ
sum
 )

56 
k
 = 0;

57 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

59 iàĞ
k
 > 0 && (k % 4) == 0 )

60 
	`´štk
("\n%46s", "");

61 
	`´štk
(" CPU%02u[%10"
PRI³rfc
"u]", 
ıu
, 
	`³r_ıu
(
³rfcouÁ”s
, cpu)[
j
]);

62 ++
k
;

65 ++
j
;

67 
TYPE_ARRAY
:

68 
TYPE_S_ARRAY
:

69 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

71 
³rfc_t
 *
couÁ”s
 = 
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
è+ 
j
;

73  
k
 = 0; k < 
³rfc_šfo
[
i
].
Ä_–em’ts
; k++ )

74 
sum
 +ğ
couÁ”s
[
k
];

76 iàĞ
³rfc_šfo
[
i
].
ty³
 =ğ
TYPE_S_ARRAY
 )

77 
sum
 = (
³rfc_t
) sum;

78 
	`´štk
("TOTAL[%12Lu]", 
sum
);

79 ià(
sum
)

81 #ifdeà
PERF_ARRAYS


82  
k
 = 0; k < 
³rfc_šfo
[
i
].
Ä_–em’ts
; k++ )

84 
sum
 = 0;

85 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

86 
sum
 +ğ
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
)[
j
 + 
k
];

87 iàĞ
³rfc_šfo
[
i
].
ty³
 =ğ
TYPE_S_ARRAY
 )

88 
sum
 = (
³rfc_t
) sum;

89 iàĞ(
k
 % 4) == 0 )

90 
	`´štk
("\n%16s", "");

91 
	`´štk
(" ARR%02u[%10Lu]", 
k
, 
sum
);

94 
k
 = 0;

95 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

97 
³rfc_t
 *
couÁ”s
 = 
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
è+ 
j
;

98 
n
;

100 
sum
 = 0;

101  
n
 = 0;‚ < 
³rfc_šfo
[
i
].
Ä_–em’ts
;‚++ )

102 
sum
 +ğ
couÁ”s
[
n
];

103 iàĞ
³rfc_šfo
[
i
].
ty³
 =ğ
TYPE_S_ARRAY
 )

104 
sum
 = (
³rfc_t
) sum;

105 iàĞ
k
 > 0 && (k % 4) == 0 )

106 
	`´štk
("\n%46s", "");

107 
	`´štk
(" CPU%02u[%10Lu]", 
ıu
, 
sum
);

108 ++
k
;

112 
j
 +ğ
³rfc_šfo
[
i
].
Ä_–em’ts
;

115 
	`´štk
("\n");

117 
	}
}

119 
	$³rfc_»£t
(
key
)

121 
i
, 
j
;

122 
s_time_t
 
now
 = 
	`NOW
();

124 iàĞ
key
 != '\0' )

125 
	`´štk
("Xen…erformance counters RESET (now = 0x%08X:%08X)\n",

126 (
u32
)(
now
>>32), (u32)now);

130  
i
 = 
j
 = 0; i < 
NR_PERFCTRS
; i++ )

132 
ıu
;

134  
³rfc_šfo
[
i
].
ty³
 )

136 
TYPE_SINGLE
:

137 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

138 
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
)[
j
] = 0;

139 
TYPE_S_SINGLE
:

140 ++
j
;

142 
TYPE_ARRAY
:

143 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

144 
	`mem£t
(
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
è+ 
j
, 0,

145 
³rfc_šfo
[
i
].
Ä_–em’ts
 * (
³rfc_t
));

146 
TYPE_S_ARRAY
:

147 
j
 +ğ
³rfc_šfo
[
i
].
Ä_–em’ts
;

152 
	`¬ch_³rfc_»£t
();

153 
	}
}

155 
x’_sysùl_³rfc_desc_t
 
	g³rfc_d
[
NR_PERFCTRS
];

156 
x’_sysùl_³rfc_v®_t
 *
	g³rfc_v®s
;

157 
	g³rfc_nbr_v®s
;

158 
ıumask_t
 
	g³rfc_ıum­
;

160 
³rfc_cİy_šfo
(
	$XEN_GUEST_HANDLE_64
(
x’_sysùl_³rfc_desc_t
è
desc
,

161 
	$XEN_GUEST_HANDLE_64
(
x’_sysùl_³rfc_v®_t
è
v®
)

163 
i
, 
j
, 
v
;

166 iàĞ!
	`ıus_equ®
(
ıu_Úlše_m­
, 
³rfc_ıum­
) )

168 
Ä_ıus
;

169 
³rfc_ıum­
 = 
ıu_Úlše_m­
;

170 
Ä_ıus
 = 
	`ıus_weight
(
³rfc_ıum­
);

172 
³rfc_nbr_v®s
 = 0;

174  
i
 = 0; i < 
NR_PERFCTRS
; i++ )

176 
	`§ã_¡rıy
(
³rfc_d
[
i
].
Çme
, 
³rfc_šfo
[i].name);

178  
³rfc_šfo
[
i
].
ty³
 )

180 
TYPE_SINGLE
:

181 
TYPE_S_SINGLE
:

182 
³rfc_d
[
i
].
Ä_v®s
 = 
Ä_ıus
;

184 
TYPE_ARRAY
:

185 
TYPE_S_ARRAY
:

186 
³rfc_d
[
i
].
Ä_v®s
 = 
³rfc_šfo
[i].
Ä_–em’ts
;

189 
³rfc_nbr_v®s
 +ğ
³rfc_d
[
i
].
Ä_v®s
;

192 
	`xä“
(
³rfc_v®s
);

193 
³rfc_v®s
 = 
	`xm®loc_¬¿y
(
x’_sysùl_³rfc_v®_t
, 
³rfc_nbr_v®s
);

196 iàĞ
	`gue¡_hªdË_is_nuÎ
(
desc
) )

199 iàĞ
³rfc_v®s
 =ğ
NULL
 )

200  -
ENOMEM
;

203 
	`¬ch_³rfc_g©h”
();

206  
i
 = 
j
 = 
v
 = 0; i < 
NR_PERFCTRS
; i++ )

208 
ıu
;

210  
³rfc_šfo
[
i
].
ty³
 )

212 
TYPE_SINGLE
:

213 
TYPE_S_SINGLE
:

214 
	`fÜ_—ch_ıu_mask
 ( 
ıu
, 
³rfc_ıum­
 )

215 
³rfc_v®s
[
v
++] = 
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
)[
j
];

216 ++
j
;

218 
TYPE_ARRAY
:

219 
TYPE_S_ARRAY
:

220 
	`mem£t
(
³rfc_v®s
 + 
v
, 0, 
³rfc_d
[
i
].
Ä_v®s
 * (*perfc_vals));

221 
	`fÜ_—ch_ıu_mask
 ( 
ıu
, 
³rfc_ıum­
 )

223 
³rfc_t
 *
couÁ”s
 = 
	`³r_ıu
(
³rfcouÁ”s
, 
ıu
è+ 
j
;

224 
k
;

226  
k
 = 0; k < 
³rfc_d
[
i
].
Ä_v®s
; k++ )

227 
³rfc_v®s
[
v
 + 
k
] +ğ
couÁ”s
[k];

229 
v
 +ğ
³rfc_d
[
i
].
Ä_v®s
;

230 
j
 +ğ
³rfc_šfo
[
i
].
Ä_–em’ts
;

234 
	`BUG_ON
(
v
 !ğ
³rfc_nbr_v®s
);

236 iàĞ
	`cİy_to_gue¡
(
desc
, 
³rfc_d
, 
NR_PERFCTRS
) )

237  -
EFAULT
;

238 iàĞ
	`cİy_to_gue¡
(
v®
, 
³rfc_v®s
, 
³rfc_nbr_v®s
) )

239  -
EFAULT
;

241 
	}
}

244 
	$³rfc_cÚŒŞ
(
x’_sysùl_³rfc_İ_t
 *
pc
)

246 
	`DEFINE_SPINLOCK
(
lock
);

247 
rc
;

249 
	`¥š_lock
(&
lock
);

251  
pc
->
cmd
 )

253 
XEN_SYSCTL_PERFCOP_»£t
:

254 
rc
 = 
	`³rfc_cİy_šfo
(
pc
->
desc
,…c->
v®
);

255 
	`³rfc_»£t
(0);

258 
XEN_SYSCTL_PERFCOP_qu”y
:

259 
rc
 = 
	`³rfc_cİy_šfo
(
pc
->
desc
,…c->
v®
);

263 
rc
 = -
EINVAL
;

267 
	`¥š_uÆock
(&
lock
);

269 
pc
->
Ä_couÁ”s
 = 
NR_PERFCTRS
;

270 
pc
->
Ä_v®s
 = 
³rfc_nbr_v®s
;

272  
rc
;

273 
	}
}

	@preempt.c

23 
	~<x’/´“m±.h
>

25 
DEFINE_PER_CPU
(, 
__´“m±_couÁ
);

	@radix-tree.c

33 
	~<x’/cÚfig.h
>

34 
	~<x’/š™.h
>

35 
	~<x’/lib.h
>

36 
	~<x’/ty³s.h
>

37 
	~<x’/”ºo.h
>

38 
	~<x’/¿dix-Œ“.h
>

39 
	~<asm/ÿche.h
>

41 
	gheight_to_maxšdex
[
RADIX_TREE_MAX_PATH
 + 1] 
	g__»ad_mo¡ly
;

47 
šlše
 
	$¿dix_Œ“_maxšdex
(
height
)

49  
height_to_maxšdex
[
height
];

50 
	}
}

55 
¿dix_Œ“_ex‹nd
(
¿dix_Œ“_roÙ
 *
roÙ
, 
šdex
,

56 
¿dix_Œ“_node
 *(*
node_®loc
)(*), *
¬g
)

58 
¿dix_Œ“_node
 *
	gnode
;

59 
	gheight
;

62 
	gheight
 = 
roÙ
->
height
 + 1;

63 ià(
	gšdex
 > 
¿dix_Œ“_maxšdex
(
height
))

64 
	gšdex
 > 
¿dix_Œ“_maxšdex
(
height
))

65 
	gheight
++;

67 ià(
	groÙ
->
	gºode
 =ğ
NULL
) {

68 
roÙ
->
height
 = height;

69 
	gout
;

73 ià(!(
	gnode
 = 
node_®loc
(
¬g
)))

74  -
ENOMEM
;

77 
	gnode
->
	g¦Ùs
[0] = 
roÙ
->
ºode
;

79 
	gnode
->
	gcouÁ
 = 1;

80 
	groÙ
->
	gºode
 = 
node
;

81 
	groÙ
->
	gheight
++;

82 } 
	gheight
 > 
	groÙ
->height);

83 
	gout
:

95 
¿dix_Œ“_š£¹
(
¿dix_Œ“_roÙ
 *
roÙ
, 
šdex
,

96 *
™em
, 
¿dix_Œ“_node
 *(*
node_®loc
)(*), *
¬g
)

98 
¿dix_Œ“_node
 *
	gnode
 = 
NULL
, *
	g¦Ù
;

99 
	gheight
, 
	gshiá
;

100 
	goff£t
;

101 
	g”rÜ
;

104 ià(
	gšdex
 > 
¿dix_Œ“_maxšdex
(
roÙ
->
height
)) {

105 
	g”rÜ
 = 
¿dix_Œ“_ex‹nd
(
roÙ
, 
šdex
, 
node_®loc
, 
¬g
);

106 ià(
	g”rÜ
)

107  
	g”rÜ
;

110 
	g¦Ù
 = 
roÙ
->
ºode
;

111 
	gheight
 = 
roÙ
->
height
;

112 
	gshiá
 = (
height
-1è* 
RADIX_TREE_MAP_SHIFT
;

114 
	goff£t
 = 0;

115 
	gheight
 > 0) {

116 ià(
	g¦Ù
 =ğ
NULL
) {

118 ià(!(
¦Ù
 = 
node_®loc
(
¬g
)))

119  -
ENOMEM
;

120 ià(
	gnode
) {

122 
	gnode
->
	g¦Ùs
[
off£t
] = 
¦Ù
;

123 
	gnode
->
	gcouÁ
++;

125 
	groÙ
->
	gºode
 = 
¦Ù
;

129 
	goff£t
 = (
šdex
 >> 
shiá
è& 
RADIX_TREE_MAP_MASK
;

130 
	gnode
 = 
¦Ù
;

131 
	g¦Ù
 = 
node
->
¦Ùs
[
off£t
];

132 
	gshiá
 -ğ
RADIX_TREE_MAP_SHIFT
;

133 
	gheight
--;

136 ià(
	g¦Ù
 !ğ
NULL
)

137  -
EEXIST
;

139 ià(
	gnode
) {

140 
	gnode
->
	gcouÁ
++;

141 
	gnode
->
	g¦Ùs
[
off£t
] = 
™em
;

143 
	groÙ
->
	gºode
 = 
™em
;

148 
EXPORT_SYMBOL
(
¿dix_Œ“_š£¹
);

150 
šlše
 **
	$__lookup_¦Ù
(
¿dix_Œ“_roÙ
 *
roÙ
,

151 
šdex
)

153 
height
, 
shiá
;

154 
¿dix_Œ“_node
 **
¦Ù
;

156 
height
 = 
roÙ
->height;

158 ià(
šdex
 > 
	`¿dix_Œ“_maxšdex
(
height
))

159  
NULL
;

161 ià(
height
 =ğ0 && 
roÙ
->
ºode
)

162  (**)&
roÙ
->
ºode
;

164 
shiá
 = (
height
-1è* 
RADIX_TREE_MAP_SHIFT
;

165 
¦Ù
 = &
roÙ
->
ºode
;

167 
height
 > 0) {

168 ià(*
¦Ù
 =ğ
NULL
)

169  
NULL
;

171 
¦Ù
 = (
¿dix_Œ“_node
 **)

172 ((*
¦Ù
)->
¦Ùs
 +

173 ((
šdex
 >> 
shiá
è& 
RADIX_TREE_MAP_MASK
));

174 
shiá
 -ğ
RADIX_TREE_MAP_SHIFT
;

175 
height
--;

178  (**)
¦Ù
;

179 
	}
}

189 **
	$¿dix_Œ“_lookup_¦Ù
(
¿dix_Œ“_roÙ
 *
roÙ
, 
šdex
)

191  
	`__lookup_¦Ù
(
roÙ
, 
šdex
);

192 
	}
}

193 
EXPORT_SYMBOL
(
¿dix_Œ“_lookup_¦Ù
);

202 *
	$¿dix_Œ“_lookup
(
¿dix_Œ“_roÙ
 *
roÙ
, 
šdex
)

204 **
¦Ù
;

206 
¦Ù
 = 
	`__lookup_¦Ù
(
roÙ
, 
šdex
);

207  
¦Ù
 !ğ
NULL
 ? *slot : NULL;

208 
	}
}

209 
EXPORT_SYMBOL
(
¿dix_Œ“_lookup
);

212 
	$__lookup
(
¿dix_Œ“_roÙ
 *
roÙ
, **
»suÉs
, 
šdex
,

213 
max_™ems
, *
Ãxt_šdex
)

215 
Ä_found
 = 0;

216 
shiá
, 
height
;

217 
¿dix_Œ“_node
 *
¦Ù
;

218 
i
;

220 
height
 = 
roÙ
->height;

221 ià(
šdex
 > 
	`¿dix_Œ“_maxšdex
(
height
))

222 ià(
height
 == 0) {

223 ià(
roÙ
->
ºode
 && 
šdex
 == 0)

224 
»suÉs
[
Ä_found
++] = 
roÙ
->
ºode
;

225 
out
;

228 
shiá
 = (
height
-1è* 
RADIX_TREE_MAP_SHIFT
;

229 
¦Ù
 = 
roÙ
->
ºode
;

231  ; 
height
 > 1; height--) {

233 
i
 = (
šdex
 >> 
shiá
è& 
RADIX_TREE_MAP_MASK
 ;

234 
i
 < 
RADIX_TREE_MAP_SIZE
; i++) {

235 ià(
¦Ù
->
¦Ùs
[
i
] !ğ
NULL
)

237 
šdex
 &ğ~((1UL << 
shiá
) - 1);

238 
šdex
 +ğ1UL << 
shiá
;

239 ià(
šdex
 == 0)

240 
out
;

242 ià(
i
 =ğ
RADIX_TREE_MAP_SIZE
)

243 
out
;

245 
shiá
 -ğ
RADIX_TREE_MAP_SHIFT
;

246 
¦Ù
 = slÙ->
¦Ùs
[
i
];

250 
i
 = 
šdex
 & 
RADIX_TREE_MAP_MASK
; i < 
RADIX_TREE_MAP_SIZE
; i++) {

251 
šdex
++;

252 ià(
¦Ù
->
¦Ùs
[
i
]) {

253 
»suÉs
[
Ä_found
++] = 
¦Ù
->
¦Ùs
[
i
];

254 ià(
Ä_found
 =ğ
max_™ems
)

255 
out
;

258 
out
:

259 *
Ãxt_šdex
 = 
šdex
;

260  
Ä_found
;

261 
	}
}

277 
	$¿dix_Œ“_gªg_lookup
(
¿dix_Œ“_roÙ
 *
roÙ
, **
»suÉs
,

278 
fœ¡_šdex
, 
max_™ems
)

280 cÚ¡ 
max_šdex
 = 
	`¿dix_Œ“_maxšdex
(
roÙ
->
height
);

281 
cur_šdex
 = 
fœ¡_šdex
;

282 
»t
 = 0;

284 
»t
 < 
max_™ems
) {

285 
Ä_found
;

286 
Ãxt_šdex
;

288 ià(
cur_šdex
 > 
max_šdex
)

290 
Ä_found
 = 
	`__lookup
(
roÙ
, 
»suÉs
 + 
»t
, 
cur_šdex
,

291 
max_™ems
 - 
»t
, &
Ãxt_šdex
);

292 
»t
 +ğ
Ä_found
;

293 ià(
Ãxt_šdex
 == 0)

295 
cur_šdex
 = 
Ãxt_šdex
;

297  
»t
;

298 
	}
}

299 
EXPORT_SYMBOL
(
¿dix_Œ“_gªg_lookup
);

305 
šlše
 
¿dix_Œ“_shršk
(
¿dix_Œ“_roÙ
 *
roÙ
,

306 (*
node_ä“
)(
¿dix_Œ“_node
 *))

309 
roÙ
->
height
 > 0 &&

310 
roÙ
->
ºode
->
couÁ
 == 1 &&

311 
roÙ
->
ºode
->
¦Ùs
[0]) {

312 
¿dix_Œ“_node
 *
to_ä“
 = 
roÙ
->
ºode
;

314 
roÙ
->
ºode
 = 
to_ä“
->
¦Ùs
[0];

315 
roÙ
->
height
--;

316 
to_ä“
->
¦Ùs
[0] = 
NULL
;

317 
to_ä“
->
couÁ
 = 0;

318 
	`node_ä“
(
to_ä“
);

320 
	}
}

331 *
¿dix_Œ“_d–‘e
(
¿dix_Œ“_roÙ
 *
roÙ
, 
šdex
,

332 (*
node_ä“
)(
¿dix_Œ“_node
 *))

334 
¿dix_Œ“_·th
 
·th
[
RADIX_TREE_MAX_PATH
 + 1], *
·thp
 =…ath;

335 
¿dix_Œ“_node
 *
¦Ù
 = 
NULL
;

336 
height
, 
shiá
;

337 
off£t
;

339 
height
 = 
roÙ
->height;

340 ià(
šdex
 > 
	`¿dix_Œ“_maxšdex
(
height
))

341 
out
;

343 
¦Ù
 = 
roÙ
->
ºode
;

344 ià(
height
 =ğ0 && 
roÙ
->
ºode
) {

345 
roÙ
->
ºode
 = 
NULL
;

346 
out
;

349 
shiá
 = (
height
 - 1è* 
RADIX_TREE_MAP_SHIFT
;

350 
·thp
->
node
 = 
NULL
;

353 ià(
¦Ù
 =ğ
NULL
)

354 
out
;

356 
·thp
++;

357 
off£t
 = (
šdex
 >> 
shiá
è& 
RADIX_TREE_MAP_MASK
;

358 
·thp
->
off£t
 = offset;

359 
·thp
->
node
 = 
¦Ù
;

360 
¦Ù
 = slÙ->
¦Ùs
[
off£t
];

361 
shiá
 -ğ
RADIX_TREE_MAP_SHIFT
;

362 
height
--;

363 } 
height
 > 0);

365 ià(
¦Ù
 =ğ
NULL
)

366 
out
;

369 
·thp
->
node
) {

370 
·thp
->
node
->
¦Ùs
[·thp->
off£t
] = 
NULL
;

371 
·thp
->
node
->
couÁ
--;

373 ià(
·thp
->
node
->
couÁ
) {

374 ià(
·thp
->
node
 =ğ
roÙ
->
ºode
)

375 
	`¿dix_Œ“_shršk
(
roÙ
, 
node_ä“
);

376 
out
;

380 
	`node_ä“
(
·thp
->
node
);

382 
·thp
--;

384 
roÙ
->
height
 = 0;

385 
roÙ
->
ºode
 = 
NULL
;

387 
out
:

388  
¦Ù
;

389 
	}
}

390 
EXPORT_SYMBOL
(
¿dix_Œ“_d–‘e
);

393 
¿dix_Œ“_node_de¡roy
(
¿dix_Œ“_node
 *
node
, 
height
,

394 (*
¦Ù_ä“
)(*), (*
node_ä“
)(
¿dix_Œ“_node
 *))

396 
i
;

398 ià(
height
 == 0)

400 
i
 = 0; i < 
RADIX_TREE_MAP_SIZE
; i++) {

401 ià(
node
->
¦Ùs
[
i
]) {

402 ià(
height
 == 1) {

403 
	`¦Ù_ä“
(
node
->
¦Ùs
[
i
]);

404 
node
->
¦Ùs
[
i
] = 
NULL
;

407 
	`¿dix_Œ“_node_de¡roy
(
node
->
¦Ùs
[
i
], 
height
-1,

408 
¦Ù_ä“
, 
node_ä“
);

409 
	`node_ä“
(
node
->
¦Ùs
[
i
]);

410 
node
->
¦Ùs
[
i
] = 
NULL
;

413 
	}
}

415 
¿dix_Œ“_de¡roy
(
¿dix_Œ“_roÙ
 *
roÙ
,

416 (*
¦Ù_ä“
)(*), (*
node_ä“
)(
¿dix_Œ“_node
 *))

418 ià(
roÙ
->
ºode
 =ğ
NULL
)

420 ià(
roÙ
->
height
 == 0)

421 
	`¦Ù_ä“
(
roÙ
->
ºode
);

423 
	`¿dix_Œ“_node_de¡roy
(
roÙ
->
ºode
,„oÙ->
height
,

424 
¦Ù_ä“
, 
node_ä“
);

425 
	`node_ä“
(
roÙ
->
ºode
);

426 
roÙ
->
height
 = 0;

428 
roÙ
->
ºode
 = 
NULL
;

430 
	}
}

431 
EXPORT_SYMBOL
(
¿dix_Œ“_de¡roy
);

433 
__š™
 
	$__maxšdex
(
height
)

435 
tmp
 = 
height
 * 
RADIX_TREE_MAP_SHIFT
;

436 
šdex
 = (~0UL >> (
RADIX_TREE_INDEX_BITS
 - 
tmp
 - 1)) >> 1;

438 ià(
tmp
 >ğ
RADIX_TREE_INDEX_BITS
)

439 
šdex
 = ~0UL;

440  
šdex
;

441 
	}
}

443 
__š™
 
	$¿dix_Œ“_š™
()

445 
i
;

447 
i
 = 0; i < 
	`ARRAY_SIZE
(
height_to_maxšdex
); i++)

448 
height_to_maxšdex
[
i
] = 
	`__maxšdex
(i);

449 
	}
}

	@rangeset.c

10 
	~<x’/sched.h
>

11 
	~<x’/”ºo.h
>

12 
	~<x’/¿nge£t.h
>

13 
	~<xsm/xsm.h
>

16 
	s¿nge
 {

17 
li¡_h—d
 
	mli¡
;

18 
	ms
, 
	me
;

21 
	s¿nge£t
 {

23 
li¡_h—d
 
	m¿nge£t_li¡
;

24 
domaš
 *
	mdomaš
;

27 
li¡_h—d
 
	m¿nge_li¡
;

28 
¥šlock_t
 
	mlock
;

31 
	mÇme
[32];

34 
	mæags
;

42 
¿nge
 *
	$fšd_¿nge
(

43 
¿nge£t
 *
r
, 
s
)

45 
¿nge
 *
x
 = 
NULL
, *
y
;

47 
	`li¡_fÜ_—ch_’Œy
 ( 
y
, &
r
->
¿nge_li¡
, 
li¡
 )

49 iàĞ
y
->
s
 > s )

51 
x
 = 
y
;

54  
x
;

55 
	}
}

58 
¿nge
 *
	$fœ¡_¿nge
(

59 
¿nge£t
 *
r
)

61 iàĞ
	`li¡_em±y
(&
r
->
¿nge_li¡
) )

62  
NULL
;

63  
	`li¡_’Œy
(
r
->
¿nge_li¡
.
Ãxt
, 
¿nge
, 
li¡
);

64 
	}
}

67 
¿nge
 *
	$Ãxt_¿nge
(

68 
¿nge£t
 *
r
, 
¿nge
 *
x
)

70 iàĞ
x
->
li¡
.
Ãxt
 =ğ&
r
->
¿nge_li¡
 )

71  
NULL
;

72  
	`li¡_’Œy
(
x
->
li¡
.
Ãxt
, 
¿nge
,†ist);

73 
	}
}

76 
	$š£¹_¿nge
(

77 
¿nge£t
 *
r
, 
¿nge
 *
x
, ¿ng*
y
)

79 
	`li¡_add
(&
y
->
li¡
, (
x
 !ğ
NULL
è? &x->li¡ : &
r
->
¿nge_li¡
);

80 
	}
}

83 
	$de¡roy_¿nge
(

84 
¿nge
 *
x
)

86 
	`li¡_d–
(&
x
->
li¡
);

87 
	`xä“
(
x
);

88 
	}
}

94 
	$¿nge£t_add_¿nge
(

95 
¿nge£t
 *
r
, 
s
, 
e
)

97 
¿nge
 *
x
, *
y
;

98 
rc
 = 0;

100 
rc
 = 
	`xsm_add_¿nge
(
r
->
domaš
,„->
Çme
, 
s
, 
e
);

101 iàĞ
rc
 )

102  
rc
;

104 
	`ASSERT
(
s
 <ğ
e
);

106 
	`¥š_lock
(&
r
->
lock
);

108 
x
 = 
	`fšd_¿nge
(
r
, 
s
);

109 
y
 = 
	`fšd_¿nge
(
r
, 
e
);

111 iàĞ
x
 =ğ
y
 )

113 iàĞ(
x
 =ğ
NULL
è|| ((x->
e
 < 
s
) && ((x->e + 1) != s)) )

115 
x
 = 
	`xm®loc
(
¿nge
);

116 iàĞ
x
 =ğ
NULL
 )

118 
rc
 = -
ENOMEM
;

119 
out
;

122 
x
->
s
 = s;

123 
x
->
e
 =ƒ;

125 
	`š£¹_¿nge
(
r
, 
y
, 
x
);

127 iàĞ
x
->
e
 <ƒ )

128 
x
->
e
 =ƒ;

132 iàĞ
x
 =ğ
NULL
 )

134 
x
 = 
	`fœ¡_¿nge
(
r
);

135 
x
->
s
 = s;

137 iàĞ(
x
->
e
 < 
s
) && ((x->e + 1) != s) )

139 
x
 = 
	`Ãxt_¿nge
(
r
, x);

140 
x
->
s
 = s;

143 
x
->
e
 = (
y
->e >ƒ) ? y->e :ƒ;

147 
y
 = 
	`Ãxt_¿nge
(
r
, 
x
);

148 iàĞ(
y
 =ğ
NULL
è|| (y->
e
 > 
x
->e) )

150 
	`de¡roy_¿nge
(
y
);

154 
y
 = 
	`Ãxt_¿nge
(
r
, 
x
);

155 iàĞ(
y
 !ğ
NULL
è&& ((
x
->
e
 + 1è=ğy->
s
) )

157 
x
->
e
 = 
y
->e;

158 
	`de¡roy_¿nge
(
y
);

161 
out
:

162 
	`¥š_uÆock
(&
r
->
lock
);

163  
rc
;

164 
	}
}

166 
	$¿nge£t_»move_¿nge
(

167 
¿nge£t
 *
r
, 
s
, 
e
)

169 
¿nge
 *
x
, *
y
, *
t
;

170 
rc
 = 0;

172 
rc
 = 
	`xsm_»move_¿nge
(
r
->
domaš
,„->
Çme
, 
s
, 
e
);

173 iàĞ
rc
 )

174  
rc
;

176 
	`ASSERT
(
s
 <ğ
e
);

178 
	`¥š_lock
(&
r
->
lock
);

180 
x
 = 
	`fšd_¿nge
(
r
, 
s
);

181 
y
 = 
	`fšd_¿nge
(
r
, 
e
);

183 iàĞ
x
 =ğ
y
 )

185 iàĞ(
x
 =ğ
NULL
è|| (x->
e
 < 
s
) )

186 
out
;

188 iàĞ(
x
->
s
 < sè&& (x->
e
 >ƒ) )

190 
y
 = 
	`xm®loc
(
¿nge
);

191 iàĞ
y
 =ğ
NULL
 )

193 
rc
 = -
ENOMEM
;

194 
out
;

197 
y
->
s
 = 
e
 + 1;

198 
y
->
e
 = 
x
->e;

199 
x
->
e
 = 
s
 - 1;

201 
	`š£¹_¿nge
(
r
, 
x
, 
y
);

203 iàĞ(
x
->
s
 =ğsè&& (x->
e
 <=ƒ) )

204 
	`de¡roy_¿nge
(
x
);

205 iàĞ
x
->
s
 == s )

206 
x
->
s
 = 
e
 + 1;

207 iàĞ
x
->
e
 <=ƒ )

208 
x
->
e
 = 
s
 - 1;

212 iàĞ
x
 =ğ
NULL
 )

213 
x
 = 
	`fœ¡_¿nge
(
r
);

215 iàĞ
x
->
s
 < s )

217 
x
->
e
 = 
s
 - 1;

218 
x
 = 
	`Ãxt_¿nge
(
r
, x);

221  
x
 !ğ
y
 )

223 
t
 = 
x
;

224 
x
 = 
	`Ãxt_¿nge
(
r
, x);

225 
	`de¡roy_¿nge
(
t
);

228 
x
->
s
 = 
e
 + 1;

229 iàĞ
x
->
s
 > x->
e
 )

230 
	`de¡roy_¿nge
(
x
);

233 
out
:

234 
	`¥š_uÆock
(&
r
->
lock
);

235  
rc
;

236 
	}
}

238 
	$¿nge£t_cÚšs_¿nge
(

239 
¿nge£t
 *
r
, 
s
, 
e
)

241 
¿nge
 *
x
;

242 
cÚšs
;

244 
	`ASSERT
(
s
 <ğ
e
);

246 
	`¥š_lock
(&
r
->
lock
);

247 
x
 = 
	`fšd_¿nge
(
r
, 
s
);

248 
cÚšs
 = (
x
 && (x->
e
 >=ƒ));

249 
	`¥š_uÆock
(&
r
->
lock
);

251  
cÚšs
;

252 
	}
}

254 
	$¿nge£t_ov”Ïps_¿nge
(

255 
¿nge£t
 *
r
, 
s
, 
e
)

257 
¿nge
 *
x
;

258 
ov”Ïps
;

260 
	`ASSERT
(
s
 <ğ
e
);

262 
	`¥š_lock
(&
r
->
lock
);

263 
x
 = 
	`fšd_¿nge
(
r
, 
e
);

264 
ov”Ïps
 = (
x
 && (
s
 <ğx->
e
));

265 
	`¥š_uÆock
(&
r
->
lock
);

267  
ov”Ïps
;

268 
	}
}

270 
¿nge£t_»pÜt_¿nges
(

271 
¿nge£t
 *
r
, 
s
, 
e
,

272 (*
cb
)(
s
, 
e
, *), *
ùxt
)

274 
¿nge
 *
x
;

275 
rc
 = 0;

277 
	`¥š_lock
(&
r
->
lock
);

279  
x
 = 
	`fšd_¿nge
(
r
, 
s
); x && (x-> <ğ
e
è&& !
rc
; x = 
	`Ãxt_¿nge
(r, x) )

280 iàĞ
x
->
e
 >ğ
s
 )

281 
rc
 = 
	`cb
(
	`max
(
x
->
s
, s), 
	`mš
(x->
e
,ƒ), 
ùxt
);

283 
	`¥š_uÆock
(&
r
->
lock
);

285  
rc
;

286 
	}
}

288 
	$¿nge£t_add_sšgËtÚ
(

289 
¿nge£t
 *
r
, 
s
)

291  
	`¿nge£t_add_¿nge
(
r
, 
s
, s);

292 
	}
}

294 
	$¿nge£t_»move_sšgËtÚ
(

295 
¿nge£t
 *
r
, 
s
)

297  
	`¿nge£t_»move_¿nge
(
r
, 
s
, s);

298 
	}
}

300 
	$¿nge£t_cÚšs_sšgËtÚ
(

301 
¿nge£t
 *
r
, 
s
)

303  
	`¿nge£t_cÚšs_¿nge
(
r
, 
s
, s);

304 
	}
}

306 
	$¿nge£t_is_em±y
(

307 
¿nge£t
 *
r
)

309  ((
r
 =ğ
NULL
è|| 
	`li¡_em±y
(&r->
¿nge_li¡
));

310 
	}
}

312 
¿nge£t
 *
	$¿nge£t_Ãw
(

313 
domaš
 *
d
, *
Çme
, 
æags
)

315 
¿nge£t
 *
r
;

317 
r
 = 
	`xm®loc
(
¿nge£t
);

318 iàĞ
r
 =ğ
NULL
 )

319  
NULL
;

321 
	`¥š_lock_š™
(&
r
->
lock
);

322 
	`INIT_LIST_HEAD
(&
r
->
¿nge_li¡
);

324 
	`BUG_ON
(
æags
 & ~
RANGESETF_´‘ty´št_hex
);

325 
r
->
æags
 = flags;

327 iàĞ
Çme
 !ğ
NULL
 )

329 
	`§ã_¡rıy
(
r
->
Çme
,‚ame);

333 
	`¢´štf
(
r
->
Çme
, (r->name), "(no‚ame)");

336 iàĞ(
r
->
domaš
 = 
d
è!ğ
NULL
 )

338 
	`¥š_lock
(&
d
->
¿nge£ts_lock
);

339 
	`li¡_add
(&
r
->
¿nge£t_li¡
, &
d
->
¿nge£ts
);

340 
	`¥š_uÆock
(&
d
->
¿nge£ts_lock
);

343  
r
;

344 
	}
}

346 
	$¿nge£t_de¡roy
(

347 
¿nge£t
 *
r
)

349 
¿nge
 *
x
;

351 iàĞ
r
 =ğ
NULL
 )

354 iàĞ
r
->
domaš
 !ğ
NULL
 )

356 
	`¥š_lock
(&
r
->
domaš
->
¿nge£ts_lock
);

357 
	`li¡_d–
(&
r
->
¿nge£t_li¡
);

358 
	`¥š_uÆock
(&
r
->
domaš
->
¿nge£ts_lock
);

361  (
x
 = 
	`fœ¡_¿nge
(
r
)è!ğ
NULL
 )

362 
	`de¡roy_¿nge
(
x
);

364 
	`xä“
(
r
);

365 
	}
}

367 
	$¿nge£t_domaš_š™Ÿli£
(

368 
domaš
 *
d
)

370 
	`INIT_LIST_HEAD
(&
d
->
¿nge£ts
);

371 
	`¥š_lock_š™
(&
d
->
¿nge£ts_lock
);

372 
	}
}

374 
	$¿nge£t_domaš_de¡roy
(

375 
domaš
 *
d
)

377 
¿nge£t
 *
r
;

379  !
	`li¡_em±y
(&
d
->
¿nge£ts
) )

381 
r
 = 
	`li¡_’Œy
(
d
->
¿nge£ts
.
Ãxt
, 
¿nge£t
, 
¿nge£t_li¡
);

383 
	`BUG_ON
(
r
->
domaš
 !ğ
d
);

384 
r
->
domaš
 = 
NULL
;

385 
	`li¡_d–
(&
r
->
¿nge£t_li¡
);

387 
	`¿nge£t_de¡roy
(
r
);

389 
	}
}

395 
	$´št_lim™
(
¿nge£t
 *
r
, 
s
)

397 
	`´štk
((
r
->
æags
 & 
RANGESETF_´‘ty´št_hex
è? "%lx" : "%lu", 
s
);

398 
	}
}

400 
	$¿nge£t_´štk
(

401 
¿nge£t
 *
r
)

403 
Ä_´š‹d
 = 0;

404 
¿nge
 *
x
;

406 
	`¥š_lock
(&
r
->
lock
);

408 
	`´štk
("%-10 {", 
r
->
Çme
);

410  
x
 = 
	`fœ¡_¿nge
(
r
); x !ğ
NULL
; x = 
	`Ãxt_¿nge
(r, x) )

412 iàĞ
Ä_´š‹d
++ )

413 
	`´štk
(",");

414 
	`´štk
(" ");

415 
	`´št_lim™
(
r
, 
x
->
s
);

416 iàĞ
x
->
s
 !ğx->
e
 )

418 
	`´štk
("-");

419 
	`´št_lim™
(
r
, 
x
->
e
);

423 
	`´štk
(" }");

425 
	`¥š_uÆock
(&
r
->
lock
);

426 
	}
}

428 
	$¿nge£t_domaš_´štk
(

429 
domaš
 *
d
)

431 
¿nge£t
 *
r
;

433 
	`´štk
("Rªge£t b–ÚgšgØdomaš %u:\n", 
d
->
domaš_id
);

435 
	`¥š_lock
(&
d
->
¿nge£ts_lock
);

437 iàĞ
	`li¡_em±y
(&
d
->
¿nge£ts
) )

438 
	`´štk
(" None\n");

440 
	`li¡_fÜ_—ch_’Œy
 ( 
r
, &
d
->
¿nge£ts
, 
¿nge£t_li¡
 )

442 
	`´štk
(" ");

443 
	`¿nge£t_´štk
(
r
);

444 
	`´štk
("\n");

447 
	`¥š_uÆock
(&
d
->
¿nge£ts_lock
);

448 
	}
}

	@rbtree.c

23 
	~<x’/cÚfig.h
>

24 
	~<x’/ty³s.h
>

25 
	~<x’/rbŒ“.h
>

27 
	$__rb_rÙ©e_Ëá
(
rb_node
 *
node
, 
rb_roÙ
 *
roÙ
)

29 
rb_node
 *
right
 = 
node
->
rb_right
;

30 
rb_node
 *
·»Á
 = 
	`rb_·»Á
(
node
);

32 ià((
node
->
rb_right
 = 
right
->
rb_Ëá
))

33 
	`rb_£t_·»Á
(
right
->
rb_Ëá
, 
node
);

34 
right
->
rb_Ëá
 = 
node
;

36 
	`rb_£t_·»Á
(
right
, 
·»Á
);

38 ià(
·»Á
)

40 ià(
node
 =ğ
·»Á
->
rb_Ëá
)

41 
·»Á
->
rb_Ëá
 = 
right
;

43 
·»Á
->
rb_right
 = 
right
;

46 
roÙ
->
rb_node
 = 
right
;

47 
	`rb_£t_·»Á
(
node
, 
right
);

48 
	}
}

50 
	$__rb_rÙ©e_right
(
rb_node
 *
node
, 
rb_roÙ
 *
roÙ
)

52 
rb_node
 *
Ëá
 = 
node
->
rb_Ëá
;

53 
rb_node
 *
·»Á
 = 
	`rb_·»Á
(
node
);

55 ià((
node
->
rb_Ëá
 = 
Ëá
->
rb_right
))

56 
	`rb_£t_·»Á
(
Ëá
->
rb_right
, 
node
);

57 
Ëá
->
rb_right
 = 
node
;

59 
	`rb_£t_·»Á
(
Ëá
, 
·»Á
);

61 ià(
·»Á
)

63 ià(
node
 =ğ
·»Á
->
rb_right
)

64 
·»Á
->
rb_right
 = 
Ëá
;

66 
·»Á
->
rb_Ëá
 = 
Ëá
;

69 
roÙ
->
rb_node
 = 
Ëá
;

70 
	`rb_£t_·»Á
(
node
, 
Ëá
);

71 
	}
}

73 
	$rb_š£¹_cŞÜ
(
rb_node
 *
node
, 
rb_roÙ
 *
roÙ
)

75 
rb_node
 *
·»Á
, *
g·»Á
;

77 (
·»Á
 = 
	`rb_·»Á
(
node
)è&& 
	`rb_is_»d
(parent))

79 
g·»Á
 = 
	`rb_·»Á
(
·»Á
);

81 ià(
·»Á
 =ğ
g·»Á
->
rb_Ëá
)

84 
rb_node
 *
unşe
 = 
g·»Á
->
rb_right
;

85 ià(
unşe
 && 
	`rb_is_»d
(uncle))

87 
	`rb_£t_bÏck
(
unşe
);

88 
	`rb_£t_bÏck
(
·»Á
);

89 
	`rb_£t_»d
(
g·»Á
);

90 
node
 = 
g·»Á
;

95 ià(
·»Á
->
rb_right
 =ğ
node
)

97 
rb_node
 *
tmp
;

98 
	`__rb_rÙ©e_Ëá
(
·»Á
, 
roÙ
);

99 
tmp
 = 
·»Á
;

100 
·»Á
 = 
node
;

101 
node
 = 
tmp
;

104 
	`rb_£t_bÏck
(
·»Á
);

105 
	`rb_£t_»d
(
g·»Á
);

106 
	`__rb_rÙ©e_right
(
g·»Á
, 
roÙ
);

109 
rb_node
 *
unşe
 = 
g·»Á
->
rb_Ëá
;

110 ià(
unşe
 && 
	`rb_is_»d
(uncle))

112 
	`rb_£t_bÏck
(
unşe
);

113 
	`rb_£t_bÏck
(
·»Á
);

114 
	`rb_£t_»d
(
g·»Á
);

115 
node
 = 
g·»Á
;

120 ià(
·»Á
->
rb_Ëá
 =ğ
node
)

122 
rb_node
 *
tmp
;

123 
	`__rb_rÙ©e_right
(
·»Á
, 
roÙ
);

124 
tmp
 = 
·»Á
;

125 
·»Á
 = 
node
;

126 
node
 = 
tmp
;

129 
	`rb_£t_bÏck
(
·»Á
);

130 
	`rb_£t_»d
(
g·»Á
);

131 
	`__rb_rÙ©e_Ëá
(
g·»Á
, 
roÙ
);

135 
	`rb_£t_bÏck
(
roÙ
->
rb_node
);

136 
	}
}

137 
EXPORT_SYMBOL
(
rb_š£¹_cŞÜ
);

139 
	$__rb_”a£_cŞÜ
(
rb_node
 *
node
, rb_nod*
·»Á
,

140 
rb_roÙ
 *
roÙ
)

142 
rb_node
 *
Ùh”
;

144 (!
node
 || 
	`rb_is_bÏck
Òode)è&&‚od!ğ
roÙ
->
rb_node
)

146 ià(
·»Á
->
rb_Ëá
 =ğ
node
)

148 
Ùh”
 = 
·»Á
->
rb_right
;

149 ià(
	`rb_is_»d
(
Ùh”
))

151 
	`rb_£t_bÏck
(
Ùh”
);

152 
	`rb_£t_»d
(
·»Á
);

153 
	`__rb_rÙ©e_Ëá
(
·»Á
, 
roÙ
);

154 
Ùh”
 = 
·»Á
->
rb_right
;

156 ià((!
Ùh”
->
rb_Ëá
 || 
	`rb_is_bÏck
(other->rb_left)) &&

157 (!
Ùh”
->
rb_right
 || 
	`rb_is_bÏck
(other->rb_right)))

159 
	`rb_£t_»d
(
Ùh”
);

160 
node
 = 
·»Á
;

161 
·»Á
 = 
	`rb_·»Á
(
node
);

165 ià(!
Ùh”
->
rb_right
 || 
	`rb_is_bÏck
(other->rb_right))

167 
rb_node
 *
o_Ëá
;

168 ià((
o_Ëá
 = 
Ùh”
->
rb_Ëá
))

169 
	`rb_£t_bÏck
(
o_Ëá
);

170 
	`rb_£t_»d
(
Ùh”
);

171 
	`__rb_rÙ©e_right
(
Ùh”
, 
roÙ
);

172 
Ùh”
 = 
·»Á
->
rb_right
;

174 
	`rb_£t_cŞÜ
(
Ùh”
, 
	`rb_cŞÜ
(
·»Á
));

175 
	`rb_£t_bÏck
(
·»Á
);

176 ià(
Ùh”
->
rb_right
)

177 
	`rb_£t_bÏck
(
Ùh”
->
rb_right
);

178 
	`__rb_rÙ©e_Ëá
(
·»Á
, 
roÙ
);

179 
node
 = 
roÙ
->
rb_node
;

185 
Ùh”
 = 
·»Á
->
rb_Ëá
;

186 ià(
	`rb_is_»d
(
Ùh”
))

188 
	`rb_£t_bÏck
(
Ùh”
);

189 
	`rb_£t_»d
(
·»Á
);

190 
	`__rb_rÙ©e_right
(
·»Á
, 
roÙ
);

191 
Ùh”
 = 
·»Á
->
rb_Ëá
;

193 ià((!
Ùh”
->
rb_Ëá
 || 
	`rb_is_bÏck
(other->rb_left)) &&

194 (!
Ùh”
->
rb_right
 || 
	`rb_is_bÏck
(other->rb_right)))

196 
	`rb_£t_»d
(
Ùh”
);

197 
node
 = 
·»Á
;

198 
·»Á
 = 
	`rb_·»Á
(
node
);

202 ià(!
Ùh”
->
rb_Ëá
 || 
	`rb_is_bÏck
(other->rb_left))

204 
rb_node
 *
o_right
;

205 ià((
o_right
 = 
Ùh”
->
rb_right
))

206 
	`rb_£t_bÏck
(
o_right
);

207 
	`rb_£t_»d
(
Ùh”
);

208 
	`__rb_rÙ©e_Ëá
(
Ùh”
, 
roÙ
);

209 
Ùh”
 = 
·»Á
->
rb_Ëá
;

211 
	`rb_£t_cŞÜ
(
Ùh”
, 
	`rb_cŞÜ
(
·»Á
));

212 
	`rb_£t_bÏck
(
·»Á
);

213 ià(
Ùh”
->
rb_Ëá
)

214 
	`rb_£t_bÏck
(
Ùh”
->
rb_Ëá
);

215 
	`__rb_rÙ©e_right
(
·»Á
, 
roÙ
);

216 
node
 = 
roÙ
->
rb_node
;

221 ià(
node
)

222 
	`rb_£t_bÏck
(
node
);

223 
	}
}

225 
	$rb_”a£
(
rb_node
 *
node
, 
rb_roÙ
 *
roÙ
)

227 
rb_node
 *
chd
, *
·»Á
;

228 
cŞÜ
;

230 ià(!
node
->
rb_Ëá
)

231 
chd
 = 
node
->
rb_right
;

232 ià(!
node
->
rb_right
)

233 
chd
 = 
node
->
rb_Ëá
;

236 
rb_node
 *
Şd
 = 
node
, *
Ëá
;

238 
node
 =‚ode->
rb_right
;

239 (
Ëá
 = 
node
->
rb_Ëá
è!ğ
NULL
)

240 
node
 = 
Ëá
;

241 
chd
 = 
node
->
rb_right
;

242 
·»Á
 = 
	`rb_·»Á
(
node
);

243 
cŞÜ
 = 
	`rb_cŞÜ
(
node
);

245 ià(
chd
)

246 
	`rb_£t_·»Á
(
chd
, 
·»Á
);

247 ià(
·»Á
 =ğ
Şd
) {

248 
·»Á
->
rb_right
 = 
chd
;

249 
·»Á
 = 
node
;

251 
·»Á
->
rb_Ëá
 = 
chd
;

253 
node
->
rb_·»Á_cŞÜ
 = 
Şd
->rb_parent_color;

254 
node
->
rb_right
 = 
Şd
->rb_right;

255 
node
->
rb_Ëá
 = 
Şd
->rb_left;

257 ià(
	`rb_·»Á
(
Şd
))

259 ià(
	`rb_·»Á
(
Şd
)->
rb_Ëá
 == old)

260 
	`rb_·»Á
(
Şd
)->
rb_Ëá
 = 
node
;

262 
	`rb_·»Á
(
Şd
)->
rb_right
 = 
node
;

264 
roÙ
->
rb_node
 = 
node
;

266 
	`rb_£t_·»Á
(
Şd
->
rb_Ëá
, 
node
);

267 ià(
Şd
->
rb_right
)

268 
	`rb_£t_·»Á
(
Şd
->
rb_right
, 
node
);

269 
cŞÜ
;

272 
·»Á
 = 
	`rb_·»Á
(
node
);

273 
cŞÜ
 = 
	`rb_cŞÜ
(
node
);

275 ià(
chd
)

276 
	`rb_£t_·»Á
(
chd
, 
·»Á
);

277 ià(
·»Á
)

279 ià(
·»Á
->
rb_Ëá
 =ğ
node
)

280 
·»Á
->
rb_Ëá
 = 
chd
;

282 
·»Á
->
rb_right
 = 
chd
;

285 
roÙ
->
rb_node
 = 
chd
;

287 
cŞÜ
:

288 ià(
cŞÜ
 =ğ
RB_BLACK
)

289 
	`__rb_”a£_cŞÜ
(
chd
, 
·»Á
, 
roÙ
);

290 
	}
}

291 
EXPORT_SYMBOL
(
rb_”a£
);

296 
rb_node
 *
	$rb_fœ¡
(
rb_roÙ
 *
roÙ
)

298 
rb_node
 *
n
;

300 
n
 = 
roÙ
->
rb_node
;

301 ià(!
n
)

302  
NULL
;

303 
n
->
rb_Ëá
)

304 
n
 =‚->
rb_Ëá
;

305  
n
;

306 
	}
}

307 
EXPORT_SYMBOL
(
rb_fœ¡
);

309 
rb_node
 *
	$rb_Ï¡
(
rb_roÙ
 *
roÙ
)

311 
rb_node
 *
n
;

313 
n
 = 
roÙ
->
rb_node
;

314 ià(!
n
)

315  
NULL
;

316 
n
->
rb_right
)

317 
n
 =‚->
rb_right
;

318  
n
;

319 
	}
}

320 
EXPORT_SYMBOL
(
rb_Ï¡
);

322 
rb_node
 *
	$rb_Ãxt
(
rb_node
 *
node
)

324 
rb_node
 *
·»Á
;

326 ià(
	`rb_·»Á
(
node
) ==‚ode)

327  
NULL
;

331 ià(
node
->
rb_right
) {

332 
node
 =‚ode->
rb_right
;

333 
node
->
rb_Ëá
)

334 
node
òode->
rb_Ëá
;

335  
node
;

344 (
·»Á
 = 
	`rb_·»Á
(
node
)è&&‚od=ğ·»Á->
rb_right
)

345 
node
 = 
·»Á
;

347  
·»Á
;

348 
	}
}

349 
EXPORT_SYMBOL
(
rb_Ãxt
);

351 
rb_node
 *
	$rb_´ev
(
rb_node
 *
node
)

353 
rb_node
 *
·»Á
;

355 ià(
	`rb_·»Á
(
node
) ==‚ode)

356  
NULL
;

360 ià(
node
->
rb_Ëá
) {

361 
node
 =‚ode->
rb_Ëá
;

362 
node
->
rb_right
)

363 
node
òode->
rb_right
;

364  
node
;

369 (
·»Á
 = 
	`rb_·»Á
(
node
)è&&‚od=ğ·»Á->
rb_Ëá
)

370 
node
 = 
·»Á
;

372  
·»Á
;

373 
	}
}

374 
EXPORT_SYMBOL
(
rb_´ev
);

376 
	$rb_»¶aû_node
(
rb_node
 *
viùim
, rb_nod*
Ãw
,

377 
rb_roÙ
 *
roÙ
)

379 
rb_node
 *
·»Á
 = 
	`rb_·»Á
(
viùim
);

382 ià(
·»Á
) {

383 ià(
viùim
 =ğ
·»Á
->
rb_Ëá
)

384 
·»Á
->
rb_Ëá
 = 
Ãw
;

386 
·»Á
->
rb_right
 = 
Ãw
;

388 
roÙ
->
rb_node
 = 
Ãw
;

390 ià(
viùim
->
rb_Ëá
)

391 
	`rb_£t_·»Á
(
viùim
->
rb_Ëá
, 
Ãw
);

392 ià(
viùim
->
rb_right
)

393 
	`rb_£t_·»Á
(
viùim
->
rb_right
, 
Ãw
);

396 *
Ãw
 = *
viùim
;

397 
	}
}

398 
EXPORT_SYMBOL
(
rb_»¶aû_node
);

	@rcupdate.c

35 
	~<x’/ty³s.h
>

36 
	~<x’/k”Ãl.h
>

37 
	~<x’/š™.h
>

38 
	~<x’/¥šlock.h
>

39 
	~<x’/smp.h
>

40 
	~<x’/rcupd©e.h
>

41 
	~<x’/sched.h
>

42 
	~<asm/©omic.h
>

43 
	~<x’/b™İs.h
>

44 
	~<x’/³rıu.h
>

45 
	~<x’/soáœq.h
>

46 
	~<x’/ıu.h
>

47 
	~<x’/¡İ_machše.h
>

50 
rcu_ù¾blk
 
	grcu_ù¾blk
 = {

51 .
cur
 = -300,

52 .
	gcom¶‘ed
 = -300,

53 .
	glock
 = 
SPIN_LOCK_UNLOCKED
,

54 .
	gıumask
 = 
CPU_MASK_NONE
,

57 
DEFINE_PER_CPU
(
rcu_d©a
,„cu_data);

59 
	gblim™
 = 10;

60 
	gqhim¬k
 = 10000;

61 
	gqlowm¬k
 = 100;

62 
	grsš‹rv®
 = 1000;

64 
	srcu_b¬r›r_d©a
 {

65 
rcu_h—d
 
	mh—d
;

66 
©omic_t
 *
	mıu_couÁ
;

69 
	$rcu_b¬r›r_ÿÎback
(
rcu_h—d
 *
h—d
)

71 
rcu_b¬r›r_d©a
 *
d©a
 = 
	`cÚš”_of
(

72 
h—d
, 
rcu_b¬r›r_d©a
, head);

73 
	`©omic_šc
(
d©a
->
ıu_couÁ
);

74 
	}
}

76 
	$rcu_b¬r›r_aùiÚ
(*
_ıu_couÁ
)

78 
rcu_b¬r›r_d©a
 
d©a
 = { .
ıu_couÁ
 = 
_ıu_couÁ
 };

80 
	`ASSERT
(!
	`loÿl_œq_is_’abËd
());

81 
	`loÿl_œq_’abË
();

88 
	`ÿÎ_rcu
(&
d©a
.
h—d
, 
rcu_b¬r›r_ÿÎback
);

90  
	`©omic_»ad
(
d©a
.
ıu_couÁ
è!ğ
	`ıus_weight
(
ıu_Úlše_m­
) )

92 
	`´oûss_³ndšg_soáœqs
();

93 
	`ıu_»Ïx
();

96 
	`loÿl_œq_di§bË
();

99 
	}
}

101 
	$rcu_b¬r›r
()

103 
©omic_t
 
ıu_couÁ
 = 
	`ATOMIC_INIT
(0);

104  
	`¡İ_machše_run
(
rcu_b¬r›r_aùiÚ
, &
ıu_couÁ
, 
NR_CPUS
);

105 
	}
}

107 
	$fÜû_qu›sûÁ_¡©e
(
rcu_d©a
 *
rdp
,

108 
rcu_ù¾blk
 *
rı
)

110 
ıumask_t
 
ıumask
;

111 
	`¿i£_soáœq
(
SCHEDULE_SOFTIRQ
);

112 ià(
	`uÆik–y
(
rdp
->
qËn
 -„dp->
Ï¡_rs_qËn
 > 
rsš‹rv®
)) {

113 
rdp
->
Ï¡_rs_qËn
 =„dp->
qËn
;

118 
ıumask
 = 
rı
->cpumask;

119 
	`ıu_ş—r
(
rdp
->
ıu
, 
ıumask
);

120 
	`ıumask_¿i£_soáœq
(
ıumask
, 
SCHEDULE_SOFTIRQ
);

122 
	}
}

135 
ç¡ÿÎ
 
ÿÎ_rcu
(
rcu_h—d
 *
h—d
,

136 (*
func
)(
rcu_h—d
 *
rcu
))

138 
æags
;

139 
rcu_d©a
 *
rdp
;

141 
h—d
->
func
 = func;

142 
h—d
->
Ãxt
 = 
NULL
;

143 
	`loÿl_œq_§ve
(
æags
);

144 
rdp
 = &
	`__g‘_ıu_v¬
(
rcu_d©a
);

145 *
rdp
->
nx‰a
 = 
h—d
;

146 
rdp
->
nx‰a
 = &
h—d
->
Ãxt
;

147 ià(
	`uÆik–y
(++
rdp
->
qËn
 > 
qhim¬k
)) {

148 
rdp
->
blim™
 = 
INT_MAX
;

149 
	`fÜû_qu›sûÁ_¡©e
(
rdp
, &
rcu_ù¾blk
);

151 
	`loÿl_œq_»¡Üe
(
æags
);

152 
	}
}

158 
	$rcu_do_b©ch
(
rcu_d©a
 *
rdp
)

160 
rcu_h—d
 *
Ãxt
, *
li¡
;

161 
couÁ
 = 0;

163 
li¡
 = 
rdp
->
dÚ–i¡
;

164 
li¡
) {

165 
Ãxt
 = 
rdp
->
dÚ–i¡
 = 
li¡
->next;

166 
li¡
->
	`func
(list);

167 
li¡
 = 
Ãxt
;

168 
rdp
->
qËn
--;

169 ià(++
couÁ
 >ğ
rdp
->
blim™
)

172 ià(
rdp
->
blim™
 =ğ
INT_MAX
 &&„dp->
qËn
 <ğ
qlowm¬k
)

173 
rdp
->
blim™
 = blimit;

174 ià(!
rdp
->
dÚ–i¡
)

175 
rdp
->
dÚ‘a
 = &rdp->
dÚ–i¡
;

177 
	`¿i£_soáœq
(
RCU_SOFTIRQ
);

178 
	}
}

203 
	$rcu_¡¬t_b©ch
(
rcu_ù¾blk
 *
rı
)

205 ià(
rı
->
Ãxt_³ndšg
 &&

206 
rı
->
com¶‘ed
 =ğrı->
cur
) {

207 
rı
->
Ãxt_³ndšg
 = 0;

212 
	`smp_wmb
();

213 
rı
->
cur
++;

215 
rı
->
ıumask
 = 
ıu_Úlše_m­
;

217 
	}
}

224 
	$ıu_qu›t
(
ıu
, 
rcu_ù¾blk
 *
rı
)

226 
	`ıu_ş—r
(
ıu
, 
rı
->
ıumask
);

227 ià(
	`ıus_em±y
(
rı
->
ıumask
)) {

229 
rı
->
com¶‘ed
 =„ı->
cur
;

230 
	`rcu_¡¬t_b©ch
(
rı
);

232 
	}
}

239 
	$rcu_check_qu›sûÁ_¡©e
(
rcu_ù¾blk
 *
rı
,

240 
rcu_d©a
 *
rdp
)

242 ià(
rdp
->
qu›scb©ch
 !ğ
rı
->
cur
) {

244 
rdp
->
qs_³ndšg
 = 1;

245 
rdp
->
qu›scb©ch
 = 
rı
->
cur
;

253 ià(!
rdp
->
qs_³ndšg
)

256 
rdp
->
qs_³ndšg
 = 0;

258 
	`¥š_lock
(&
rı
->
lock
);

263 ià(
	`lik–y
(
rdp
->
qu›scb©ch
 =ğ
rı
->
cur
))

264 
	`ıu_qu›t
(
rdp
->
ıu
, 
rı
);

266 
	`¥š_uÆock
(&
rı
->
lock
);

267 
	}
}

273 
	$__rcu_´oûss_ÿÎbacks
(
rcu_ù¾blk
 *
rı
,

274 
rcu_d©a
 *
rdp
)

276 ià(
rdp
->
cu¾i¡
 && !
	`rcu_b©ch_befÜe
(
rı
->
com¶‘ed
,„dp->
b©ch
)) {

277 *
rdp
->
dÚ‘a
 =„dp->
cu¾i¡
;

278 
rdp
->
dÚ‘a
 =„dp->
cu¹a
;

279 
rdp
->
cu¾i¡
 = 
NULL
;

280 
rdp
->
cu¹a
 = &rdp->
cu¾i¡
;

283 
	`loÿl_œq_di§bË
();

284 ià(
rdp
->
nxi¡
 && !rdp->
cu¾i¡
) {

285 
rdp
->
cu¾i¡
 =„dp->
nxi¡
;

286 
rdp
->
cu¹a
 =„dp->
nx‰a
;

287 
rdp
->
nxi¡
 = 
NULL
;

288 
rdp
->
nx‰a
 = &rdp->
nxi¡
;

289 
	`loÿl_œq_’abË
();

296 
rdp
->
b©ch
 = 
rı
->
cur
 + 1;

300 
	`smp_rmb
();

302 ià(!
rı
->
Ãxt_³ndšg
) {

304 
	`¥š_lock
(&
rı
->
lock
);

305 
rı
->
Ãxt_³ndšg
 = 1;

306 
	`rcu_¡¬t_b©ch
(
rı
);

307 
	`¥š_uÆock
(&
rı
->
lock
);

310 
	`loÿl_œq_’abË
();

312 
	`rcu_check_qu›sûÁ_¡©e
(
rı
, 
rdp
);

313 ià(
rdp
->
dÚ–i¡
)

314 
	`rcu_do_b©ch
(
rdp
);

315 
	}
}

317 
	$rcu_´oûss_ÿÎbacks
()

319 
	`__rcu_´oûss_ÿÎbacks
(&
rcu_ù¾blk
, &
	`__g‘_ıu_v¬
(
rcu_d©a
));

320 
	}
}

322 
	$__rcu_³ndšg
(
rcu_ù¾blk
 *
rı
, 
rcu_d©a
 *
rdp
)

327 ià(
rdp
->
cu¾i¡
 && !
	`rcu_b©ch_befÜe
(
rı
->
com¶‘ed
,„dp->
b©ch
))

331 ià(!
rdp
->
cu¾i¡
 &&„dp->
nxi¡
)

335 ià(
rdp
->
dÚ–i¡
)

339 ià(
rdp
->
qu›scb©ch
 !ğ
rı
->
cur
 ||„dp->
qs_³ndšg
)

344 
	}
}

346 
	$rcu_³ndšg
(
ıu
)

348  
	`__rcu_³ndšg
(&
rcu_ù¾blk
, &
	`³r_ıu
(
rcu_d©a
, 
ıu
));

349 
	}
}

357 
	$rcu_Ãeds_ıu
(
ıu
)

359 
rcu_d©a
 *
rdp
 = &
	`³r_ıu
Ôcu_d©a, 
ıu
);

361  (!!
rdp
->
cu¾i¡
 || 
	`rcu_³ndšg
(
ıu
));

362 
	}
}

364 
	$rcu_check_ÿÎbacks
(
ıu
)

366 
	`¿i£_soáœq
(
RCU_SOFTIRQ
);

367 
	}
}

369 
	$rcu_move_b©ch
(
rcu_d©a
 *
this_rdp
, 
rcu_h—d
 *
li¡
,

370 
rcu_h—d
 **

)

372 
	`loÿl_œq_di§bË
();

373 *
this_rdp
->
nx‰a
 = 
li¡
;

374 ià(
li¡
)

375 
this_rdp
->
nx‰a
 = 

;

376 
	`loÿl_œq_’abË
();

377 
	}
}

379 
	$rcu_ofæše_ıu
(
rcu_d©a
 *
this_rdp
,

380 
rcu_ù¾blk
 *
rı
, 
rcu_d©a
 *
rdp
)

385 
	`¥š_lock
(&
rı
->
lock
);

386 ià(
rı
->
cur
 !ğrı->
com¶‘ed
)

387 
	`ıu_qu›t
(
rdp
->
ıu
, 
rı
);

388 
	`¥š_uÆock
(&
rı
->
lock
);

390 
	`rcu_move_b©ch
(
this_rdp
, 
rdp
->
dÚ–i¡
,„dp->
dÚ‘a
);

391 
	`rcu_move_b©ch
(
this_rdp
, 
rdp
->
cu¾i¡
,„dp->
cu¹a
);

392 
	`rcu_move_b©ch
(
this_rdp
, 
rdp
->
nxi¡
,„dp->
nx‰a
);

394 
	`loÿl_œq_di§bË
();

395 
this_rdp
->
qËn
 +ğ
rdp
->qlen;

396 
	`loÿl_œq_’abË
();

397 
	}
}

399 
	$rcu_š™_³rıu_d©a
(
ıu
, 
rcu_ù¾blk
 *
rı
,

400 
rcu_d©a
 *
rdp
)

402 
	`mem£t
(
rdp
, 0, (*rdp));

403 
rdp
->
cu¹a
 = &rdp->
cu¾i¡
;

404 
rdp
->
nx‰a
 = &rdp->
nxi¡
;

405 
rdp
->
dÚ‘a
 = &rdp->
dÚ–i¡
;

406 
rdp
->
qu›scb©ch
 = 
rı
->
com¶‘ed
;

407 
rdp
->
qs_³ndšg
 = 0;

408 
rdp
->
ıu
 = cpu;

409 
rdp
->
blim™
 = blimit;

410 
	}
}

412 
	$ıu_ÿÎback
(

413 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

415 
ıu
 = ()
hıu
;

416 
rcu_d©a
 *
rdp
 = &
	`³r_ıu
Ôcu_d©a, 
ıu
);

418  
aùiÚ
 )

420 
CPU_UP_PREPARE
:

421 
	`rcu_š™_³rıu_d©a
(
ıu
, &
rcu_ù¾blk
, 
rdp
);

423 
CPU_UP_CANCELED
:

424 
CPU_DEAD
:

425 
	`rcu_ofæše_ıu
(&
	`this_ıu
(
rcu_d©a
), &
rcu_ù¾blk
, 
rdp
);

431  
NOTIFY_DONE
;

432 
	}
}

434 
nÙif›r_block
 
	gıu_nfb
 = {

435 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback


438 
__š™
 
	$rcu_š™
()

440 *
ıu
 = (*)()
	`smp_´oûssÜ_id
();

441 
	`ıu_ÿÎback
(&
ıu_nfb
, 
CPU_UP_PREPARE
, 
ıu
);

442 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

443 
	`İ’_soáœq
(
RCU_SOFTIRQ
, 
rcu_´oûss_ÿÎbacks
);

444 
	}
}

	@sched_arinc653.c

27 
	~<x’/cÚfig.h
>

28 
	~<x’/lib.h
>

29 
	~<x’/sched.h
>

30 
	~<x’/sched-if.h
>

31 
	~<x’/tim”.h
>

32 
	~<x’/soáœq.h
>

33 
	~<x’/time.h
>

34 
	~<x’/”ºo.h
>

35 
	~<x’/li¡.h
>

36 
	~<x’/gue¡_acûss.h
>

37 
	~<public/sysùl.h
>

46 
	#IDLETASK
(
ıu
è(
idË_vıu
[ıu])

	)

52 
	#AVCPU
(
vc
è((
¬šc653_vıu_t
 *)(vc)->
sched_´iv
)

	)

57 
	#SCHED_PRIV
(
s
è((
a653sched_´iv_t
 *)((s)->
sched_d©a
))

	)

67 
	s¬šc653_vıu_s


71 
vıu
 * 
	mvc
;

73 
boŞ_t
 
	mawake
;

76 
li¡_h—d
 
	mli¡
;

77 } 
	t¬šc653_vıu_t
;

83 
	ssched_’Œy_s


87 
x’_domaš_hªdË_t
 
	mdom_hªdË
;

90 
	mvıu_id
;

93 
s_time_t
 
	mruÁime
;

95 
vıu
 * 
	mvc
;

96 } 
	tsched_’Œy_t
;

101 
	sa653sched_´iv_s


111 
sched_’Œy_t
 
	mscheduË
[
ARINC653_MAX_DOMAINS_PER_SCHEDULE
];

122 
	mnum_scheduË_’Œ›s
;

127 
s_time_t
 
	mmajÜ_äame
;

132 
s_time_t
 
	mÃxt_majÜ_äame
;

137 
li¡_h—d
 
	mvıu_li¡
;

138 } 
	ta653sched_´iv_t
;

156 
	$dom_hªdË_cmp
(cÚ¡ 
x’_domaš_hªdË_t
 
h1
,

157 cÚ¡ 
x’_domaš_hªdË_t
 
h2
)

159  
	`memcmp
(
h1
, 
h2
, (
x’_domaš_hªdË_t
));

160 
	}
}

175 
vıu
 *
	$fšd_vıu
(

176 cÚ¡ 
scheduËr
 *
İs
,

177 
x’_domaš_hªdË_t
 
hªdË
,

178 
vıu_id
)

180 
¬šc653_vıu_t
 *
avıu
;

183 
	`li¡_fÜ_—ch_’Œy
 ( 
avıu
, &
	`SCHED_PRIV
(
İs
)->
vıu_li¡
, 
li¡
 )

184 iàĞ(
	`dom_hªdË_cmp
(
avıu
->
vc
->
domaš
->
hªdË
, handle) == 0)

185 && (
vıu_id
 =ğ
avıu
->
vc
->vcpu_id) )

186  
avıu
->
vc
;

188  
NULL
;

189 
	}
}

198 
	$upd©e_scheduË_vıus
(cÚ¡ 
scheduËr
 *
İs
)

200 
i
, 
n_’Œ›s
 = 
	`SCHED_PRIV
(
İs
)->
num_scheduË_’Œ›s
;

202  
i
 = 0; i < 
n_’Œ›s
; i++ )

203 
	`SCHED_PRIV
(
İs
)->
scheduË
[
i
].
vc
 =

204 
	`fšd_vıu
(
İs
,

205 
	`SCHED_PRIV
(
İs
)->
scheduË
[
i
].
dom_hªdË
,

206 
	`SCHED_PRIV
(
İs
)->
scheduË
[
i
].
vıu_id
);

207 
	}
}

221 
	$¬šc653_sched_£t
(

222 cÚ¡ 
scheduËr
 *
İs
,

223 
x’_sysùl_¬šc653_scheduË
 *
scheduË
)

225 
a653sched_´iv_t
 *
sched_´iv
 = 
	`SCHED_PRIV
(
İs
);

226 
s_time_t
 
tÙ®_ruÁime
 = 0;

227 
boŞ_t
 
found_dom0
 = 0;

228 cÚ¡ 
x’_domaš_hªdË_t
 
dom0_hªdË
 = {0};

229 
i
;

232 iàĞ(
scheduË
->
majÜ_äame
 <= 0)

233 || (
scheduË
->
num_sched_’Œ›s
 < 1)

234 || (
scheduË
->
num_sched_’Œ›s
 > 
ARINC653_MAX_DOMAINS_PER_SCHEDULE
) )

235 
ç
;

237  
i
 = 0; i < 
scheduË
->
num_sched_’Œ›s
; i++ )

239 iàĞ
	`dom_hªdË_cmp
(
scheduË
->
sched_’Œ›s
[
i
].
dom_hªdË
,

240 
dom0_hªdË
) == 0 )

241 
found_dom0
 = 1;

244 iàĞ(
scheduË
->
sched_’Œ›s
[
i
].
vıu_id
 >ğ
MAX_VIRT_CPUS
)

245 || (
scheduË
->
sched_’Œ›s
[
i
].
ruÁime
 <= 0) )

246 
ç
;

249 
tÙ®_ruÁime
 +ğ
scheduË
->
sched_’Œ›s
[
i
].
ruÁime
;

253 iàĞ!
found_dom0
 )

254 
ç
;

260 iàĞ
tÙ®_ruÁime
 > 
scheduË
->
majÜ_äame
 )

261 
ç
;

264 
sched_´iv
->
num_scheduË_’Œ›s
 = 
scheduË
->
num_sched_’Œ›s
;

265 
sched_´iv
->
majÜ_äame
 = 
scheduË
->major_frame;

266  
i
 = 0; i < 
scheduË
->
num_sched_’Œ›s
; i++ )

268 
	`memıy
(
sched_´iv
->
scheduË
[
i
].
dom_hªdË
,

269 
scheduË
->
sched_’Œ›s
[
i
].
dom_hªdË
,

270 (
sched_´iv
->
scheduË
[
i
].
dom_hªdË
));

271 
sched_´iv
->
scheduË
[
i
].
vıu_id
 =

272 
scheduË
->
sched_’Œ›s
[
i
].
vıu_id
;

273 
sched_´iv
->
scheduË
[
i
].
ruÁime
 =

274 
scheduË
->
sched_’Œ›s
[
i
].
ruÁime
;

276 
	`upd©e_scheduË_vıus
(
İs
);

285 
sched_´iv
->
Ãxt_majÜ_äame
 = 
	`NOW
();

289 
ç
:

290  -
EINVAL
;

291 
	}
}

304 
	$¬šc653_sched_g‘
(

305 cÚ¡ 
scheduËr
 *
İs
,

306 
x’_sysùl_¬šc653_scheduË
 *
scheduË
)

308 
a653sched_´iv_t
 *
sched_´iv
 = 
	`SCHED_PRIV
(
İs
);

309 
i
;

311 
scheduË
->
num_sched_’Œ›s
 = 
sched_´iv
->
num_scheduË_’Œ›s
;

312 
scheduË
->
majÜ_äame
 = 
sched_´iv
->major_frame;

313  
i
 = 0; i < 
sched_´iv
->
num_scheduË_’Œ›s
; i++ )

315 
	`memıy
(
scheduË
->
sched_’Œ›s
[
i
].
dom_hªdË
,

316 
sched_´iv
->
scheduË
[
i
].
dom_hªdË
,

317 (
sched_´iv
->
scheduË
[
i
].
dom_hªdË
));

318 
scheduË
->
sched_’Œ›s
[
i
].
vıu_id
 = 
sched_´iv
->schedule[i].vcpu_id;

319 
scheduË
->
sched_’Œ›s
[
i
].
ruÁime
 = 
sched_´iv
->schedule[i].runtime;

323 
	}
}

340 
	$a653sched_š™
(
scheduËr
 *
İs
)

342 
a653sched_´iv_t
 *
´v
;

344 
´v
 = 
	`xm®loc
(
a653sched_´iv_t
);

345 iàĞ
´v
 =ğ
NULL
 )

346  -
ENOMEM
;

348 
	`mem£t
(
´v
, 0, (*prv));

349 
İs
->
sched_d©a
 = 
´v
;

351 
´v
->
scheduË
[0].
dom_hªdË
[0] = '\0';

352 
´v
->
scheduË
[0].
vıu_id
 = 0;

353 
´v
->
scheduË
[0].
ruÁime
 = 
	`MILLISECS
(10);

354 
´v
->
scheduË
[0].
vc
 = 
NULL
;

355 
´v
->
num_scheduË_’Œ›s
 = 1;

356 
´v
->
majÜ_äame
 = 
	`MILLISECS
(10);

357 
´v
->
Ãxt_majÜ_äame
 = 0;

358 
	`INIT_LIST_HEAD
(&
´v
->
vıu_li¡
);

361 
	}
}

369 
	$a653sched_deš™
(cÚ¡ 
scheduËr
 *
İs
)

371 
	`xä“
(
	`SCHED_PRIV
(
İs
));

372 
	}
}

382 
	$a653sched_®loc_vd©a
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
, *
dd
)

388 iàĞ(
vc
->
sched_´iv
 = 
	`xm®loc
(
¬šc653_vıu_t
)è=ğ
NULL
 )

389  
NULL
;

397 
	`AVCPU
(
vc
)->vc = vc;

398 
	`AVCPU
(
vc
)->
awake
 = 0;

399 iàĞ!
	`is_idË_vıu
(
vc
) )

400 
	`li¡_add
(&
	`AVCPU
(
vc
)->
li¡
, &
	`SCHED_PRIV
(
İs
)->
vıu_li¡
);

401 
	`upd©e_scheduË_vıus
(
İs
);

403  
	`AVCPU
(
vc
);

404 
	}
}

412 
	$a653sched_ä“_vd©a
(cÚ¡ 
scheduËr
 *
İs
, *
´iv
)

414 
¬šc653_vıu_t
 *
av
 = 
´iv
;

416 ià(
av
 =ğ
NULL
)

419 
	`li¡_d–
(&
av
->
li¡
);

420 
	`xä“
(
av
);

421 
	`upd©e_scheduË_vıus
(
İs
);

422 
	}
}

435 
	$a653sched_®loc_pd©a
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

438  
	`SCHED_PRIV
(
İs
);

439 
	}
}

447 
	$a653sched_ä“_pd©a
(cÚ¡ 
scheduËr
 *
İs
, *
pıu
, 
ıu
)

450 
	}
}

463 
	$a653sched_®loc_domd©a
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

466  
	`SCHED_PRIV
(
İs
);

467 
	}
}

475 
	$a653sched_ä“_domd©a
(cÚ¡ 
scheduËr
 *
İs
, *
d©a
)

478 
	}
}

487 
	$a653sched_vıu_¦“p
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

489 iàĞ
	`AVCPU
(
vc
è!ğ
NULL
 )

490 
	`AVCPU
(
vc
)->
awake
 = 0;

496 iàĞ
	`³r_ıu
(
scheduË_d©a
, 
vc
->
´oûssÜ
).
cu¼
 == vc )

497 
	`ıu_¿i£_soáœq
(
vc
->
´oûssÜ
, 
SCHEDULE_SOFTIRQ
);

498 
	}
}

507 
	$a653sched_vıu_wake
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

509 iàĞ
	`AVCPU
(
vc
è!ğ
NULL
 )

510 
	`AVCPU
(
vc
)->
awake
 = 1;

512 
	`ıu_¿i£_soáœq
(
vc
->
´oûssÜ
, 
SCHEDULE_SOFTIRQ
);

513 
	}
}

526 
sk_¦iû


527 
	$a653sched_do_scheduË
(

528 cÚ¡ 
scheduËr
 *
İs
,

529 
s_time_t
 
now
,

530 
boŞ_t
 
skËt_wÜk_scheduËd
)

532 
sk_¦iû
 
»t
;

533 
vıu
 * 
Ãw_sk
 = 
NULL
;

534 
sched_šdex
 = 0;

535 
s_time_t
 
Ãxt_sw™ch_time
;

536 
a653sched_´iv_t
 *
sched_´iv
 = 
	`SCHED_PRIV
(
İs
);

538 iàĞ
now
 >ğ
sched_´iv
->
Ãxt_majÜ_äame
 )

543 
sched_šdex
 = 0;

544 
sched_´iv
->
Ãxt_majÜ_äame
 = 
now
 + sched_´iv->
majÜ_äame
;

545 
Ãxt_sw™ch_time
 = 
now
 + 
sched_´iv
->
scheduË
[0].
ruÁime
;

549  (
now
 >ğ
Ãxt_sw™ch_time
)

550 && (
sched_šdex
 < 
sched_´iv
->
num_scheduË_’Œ›s
) )

553 
sched_šdex
++;

554 
Ãxt_sw™ch_time
 +ğ
sched_´iv
->
scheduË
[
sched_šdex
].
ruÁime
;

562 iàĞ
sched_šdex
 >ğ
sched_´iv
->
num_scheduË_’Œ›s
 )

563 
Ãxt_sw™ch_time
 = 
sched_´iv
->
Ãxt_majÜ_äame
;

571 
Ãw_sk
 = (
sched_šdex
 < 
sched_´iv
->
num_scheduË_’Œ›s
)

572 ? 
sched_´iv
->
scheduË
[
sched_šdex
].
vc


573 : 
	`IDLETASK
(0);

576 iàĞ!((
Ãw_sk
 !ğ
NULL
)

577 && (
	`AVCPU
(
Ãw_sk
è!ğ
NULL
)

578 && 
	`AVCPU
(
Ãw_sk
)->
awake


579 && 
	`vıu_ruÂabË
(
Ãw_sk
)) )

580 
Ãw_sk
 = 
	`IDLETASK
(0);

581 
	`BUG_ON
(
Ãw_sk
 =ğ
NULL
);

587 
	`BUG_ON
(
now
 >ğ
sched_´iv
->
Ãxt_majÜ_äame
);

590 iàĞ
skËt_wÜk_scheduËd
 )

591 
Ãw_sk
 = 
	`IDLETASK
(0);

597 
»t
.
time
 = 
Ãxt_sw™ch_time
 - 
now
;

598 
»t
.
sk
 = 
Ãw_sk
;

599 
»t
.
mig¿‹d
 = 0;

601 
	`BUG_ON
(
»t
.
time
 <= 0);

603  
»t
;

604 
	}
}

615 
	$a653sched_pick_ıu
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

619 
	}
}

630 
	$a653sched_adju¡_glob®
(cÚ¡ 
scheduËr
 *
İs
,

631 
x’_sysùl_scheduËr_İ
 *
sc
)

633 
x’_sysùl_¬šc653_scheduË_t
 
loÿl_sched
;

634 
rc
 = -
EINVAL
;

636  
sc
->
cmd
 )

638 
XEN_SYSCTL_SCHEDOP_putšfo
:

639 
	`cİy_äom_gue¡
(&
loÿl_sched
, 
sc
->
u
.
sched_¬šc653
.
scheduË
, 1);

640 
rc
 = 
	`¬šc653_sched_£t
(
İs
, &
loÿl_sched
);

642 
XEN_SYSCTL_SCHEDOP_g‘šfo
:

643 
rc
 = 
	`¬šc653_sched_g‘
(
İs
, &
loÿl_sched
);

644 
	`cİy_to_gue¡
(
sc
->
u
.
sched_¬šc653
.
scheduË
, &
loÿl_sched
, 1);

648  
rc
;

649 
	}
}

657 
scheduËr
 
	gsched_¬šc653_def
 = {

658 .
Çme
 = "ARINC 653 Scheduler",

659 .
	gİt_Çme
 = "arinc653",

660 .
	gsched_id
 = 
XEN_SCHEDULER_ARINC653
,

661 .
	gsched_d©a
 = 
NULL
,

663 .
	gš™
 = 
a653sched_š™
,

664 .
	gdeš™
 = 
a653sched_deš™
,

666 .
	gä“_vd©a
 = 
a653sched_ä“_vd©a
,

667 .
	g®loc_vd©a
 = 
a653sched_®loc_vd©a
,

669 .
	gä“_pd©a
 = 
a653sched_ä“_pd©a
,

670 .
	g®loc_pd©a
 = 
a653sched_®loc_pd©a
,

672 .
	gä“_domd©a
 = 
a653sched_ä“_domd©a
,

673 .
	g®loc_domd©a
 = 
a653sched_®loc_domd©a
,

675 .
	gš™_domaš
 = 
NULL
,

676 .
	gde¡roy_domaš
 = 
NULL
,

678 .
	gš£¹_vıu
 = 
NULL
,

679 .
	g»move_vıu
 = 
NULL
,

681 .
	g¦“p
 = 
a653sched_vıu_¦“p
,

682 .
	gwake
 = 
a653sched_vıu_wake
,

683 .
	gy›ld
 = 
NULL
,

684 .
	gcÚ‹xt_§ved
 = 
NULL
,

686 .
	gdo_scheduË
 = 
a653sched_do_scheduË
,

688 .
	gpick_ıu
 = 
a653sched_pick_ıu
,

690 .
	gadju¡
 = 
NULL
,

691 .
	gadju¡_glob®
 = 
a653sched_adju¡_glob®
,

693 .
	gdump_£‰šgs
 = 
NULL
,

694 .
	gdump_ıu_¡©e
 = 
NULL
,

696 .
	gtick_su¥’d
 = 
NULL
,

697 .
	gtick_»sume
 = 
NULL
,

	@sched_credit.c

11 
	~<x’/cÚfig.h
>

12 
	~<x’/š™.h
>

13 
	~<x’/lib.h
>

14 
	~<x’/sched.h
>

15 
	~<x’/domaš.h
>

16 
	~<x’/d–ay.h
>

17 
	~<x’/ev’t.h
>

18 
	~<x’/time.h
>

19 
	~<x’/³rfc.h
>

20 
	~<x’/sched-if.h
>

21 
	~<x’/soáœq.h
>

22 
	~<asm/©omic.h
>

23 
	~<x’/”ºo.h
>

24 
	~<x’/keyhªdËr.h
>

25 
	~<mši.h
>

26 
	~<x’/h‘”ovisÜ.h
>

27 
	~<x’/gue¡_acûss.h
>

37 #ifdeà
PERF_COUNTERS


38 
	#CSCHED_STATS


	)

45 
	#CSCHED_DEFAULT_WEIGHT
 256

	)

46 
	#CSCHED_TICKS_PER_TSLICE
 3

	)

47 
	#CSCHED_TICKS_PER_ACCT
 3

	)

48 
	#CSCHED_MSECS_PER_TICK
 10

	)

49 
	#CSCHED_MSECS_PER_TSLICE
 \

50 (
CSCHED_MSECS_PER_TICK
 * 
CSCHED_TICKS_PER_TSLICE
)

	)

51 
	#CSCHED_CREDITS_PER_MSEC
 10

	)

52 
	#CSCHED_CREDITS_PER_TSLICE
 \

53 (
CSCHED_CREDITS_PER_MSEC
 * 
CSCHED_MSECS_PER_TSLICE
)

	)

54 
	#CSCHED_CREDITS_PER_ACCT
 \

55 (
CSCHED_CREDITS_PER_MSEC
 * 
CSCHED_MSECS_PER_TICK
 * 
CSCHED_TICKS_PER_ACCT
)

	)

61 
	#CSCHED_PRI_TS_BOOST
 0

	)

62 
	#CSCHED_PRI_TS_UNDER
 -1

	)

63 
	#CSCHED_PRI_TS_OVER
 -2

	)

64 
	#CSCHED_PRI_IDLE
 -64

	)

70 
	#CSCHED_FLAG_VCPU_PARKED
 0x0001

	)

71 
	#CSCHED_FLAG_VCPU_YIELD
 0x0002

	)

77 
	#CSCHED_PRIV
(
_İs
) \

78 ((
csched_´iv©e
 *)((
_İs
)->
sched_d©a
))

	)

79 
	#CSCHED_PCPU
(
_c
) \

80 ((
csched_pıu
 *)
	`³r_ıu
(
scheduË_d©a
, 
_c
).
sched_´iv
)

	)

81 
	#CSCHED_VCPU
(
_vıu
è((
csched_vıu
 *è(_vıu)->
sched_´iv
)

	)

82 
	#CSCHED_DOM
(
_dom
è((
csched_dom
 *è(_dom)->
sched_´iv
)

	)

83 
	#RUNQ
(
_ıu
è(&(
	`CSCHED_PCPU
(_ıu)->
runq
))

	)

84 
	#CSCHED_CPUONLINE
(
_poŞ
) \

85 (((
_poŞ
è=ğ
NULL
è? &
ıupoŞ_ä“_ıus
 : &(_poŞ)->
ıu_v®id
)

	)

91 
	#CSCHED_STAT_CRANK
(
_X
è(
	`³rfc_šü
(_X))

	)

93 #ifdeà
CSCHED_STATS


95 
	#CSCHED_VCPU_STATS_RESET
(
_V
) \

98 
	`mem£t
(&(
_V
)->
¡©s
, 0, ((_V)->stats)); \

99 }  0 )

	)

101 
	#CSCHED_VCPU_STAT_CRANK
(
_V
, 
_X
è(((_V)->
¡©s
._X)++)

	)

103 
	#CSCHED_VCPU_STAT_SET
(
_V
, 
_X
, 
_Y
è(((_V)->
¡©s
._Xèğ(_Y))

	)

107 
	#CSCHED_VCPU_STATS_RESET
(
_V
èdØ{}  0 )

	)

108 
	#CSCHED_VCPU_STAT_CRANK
(
_V
, 
_X
èdØ{}  0 )

	)

109 
	#CSCHED_VCPU_STAT_SET
(
_V
, 
_X
, 
_Y
èdØ{}  0 )

	)

113 #ifdeà
HETERO_VISOR


114 
ıumask_t
 
	gbigcÜe_mask
, 
	gsm®lcÜe_mask
;

115 
ušt16_t
 
	gh‘”o_nb_cÜes
=0, 
	gh‘”o_ns_cÜes
=0;

116 
DEFINE_PER_CPU
(
boŞ_t
,
cÜe_ty³
) = 0;

117 
ušt16_t
 
	gbig_cÜe_couÁ
 = 0,
	gnum_aùive_ıus
=12;

118 
ušt16_t
 
	gnum_sock‘s
= 2;

119 
ušt16_t
 
	gh‘”o_¥“d_¿tio
 = 4;

120 
ušt16_t
 
	gTOTAL_SCREDITS
 = 100;

121 
ušt16_t
 
	gTOTAL_FCREDITS
 = 0;

123 
ušt16_t
 
	ge¥“d_¡•
 = 20;

124 
ušt16_t
 
	ge¥“d_mš
 = 20;

127 
boŞ_t
 
	gh‘”o_visÜ_aùive
 = 0;

128 
boŞ_t
 
	gh‘”o_š™
 = 0;

129 
boŞ_t
 
	gh‘”o_visÜ_mem
 = 1;

131 
boŞ_t
 
	gh‘”o_sched_aùive
 = 0;

132 
ušt16_t
 
	gh‘”o_sched_tick
 = 0;

133 
ušt16_t
 
	gh‘”o_debug_Ëv–
 = 0;

134 
ušt16_t
 
	gh‘”o_debug_tick
 = 0;

135 
ušt16_t
 
	gh‘”o_hüed™_pŞicy
 = 0;

136 
ušt16_t
 
	gh‘”o_hüed™_tick
 = 0;

144 
boŞ_t
 
__»ad_mo¡ly
 
	gsched_üed™_deçuÉ_y›ld
;

145 
boŞ—n_·¿m
("sched_üed™_deçuÉ_y›ld", 
sched_üed™_deçuÉ_y›ld
);

150 
	scsched_pıu
 {

151 
li¡_h—d
 
	mrunq
;

152 
ušt32_t
 
	mrunq_sÜt_Ï¡
;

153 
tim”
 
	mtick”
;

154 
	mtick
;

155 
	midË_bŸs
;

156 #ifdeà
ENABLE_PCPU_STAT


157 
s_time_t
 
	m¡¬t_time
;

158 
s_time_t
 
	msched_time
;

165 
	scsched_vıu
 {

166 
li¡_h—d
 
	mrunq_–em
;

167 
li¡_h—d
 
	maùive_vıu_–em
;

168 
csched_dom
 *
	msdom
;

169 
vıu
 *
	mvıu
;

170 
©omic_t
 
	müed™
;

171 #ifdeà
HETERO_VISOR


172 
©omic_t
 
	mfüed™
;

173 
©omic_t
 
	msüed™
;

174 
boŞ_t
 
	mcÜe_ty³
;

175 
li¡_h—d
 
	mç¡_vıu_–em
;

176 
li¡_h—d
 
	mh‘”o_vıu_–em
;

177 
³rf_ùrs
 * 
	mpùr
;

178 
couÁ”s
 * 
	mùr
;

180 
s_time_t
 
	m¡¬t_time
;

181 
ušt16_t
 
	mæags
;

182 
št16_t
 
	m´i
;

183 #ifdeà
CSCHED_STATS


185 
	müed™_Ï¡
;

186 
ušt32_t
 
	müed™_šü
;

187 
ušt32_t
 
	m¡©e_aùive
;

188 
ušt32_t
 
	m¡©e_idË
;

189 
ušt32_t
 
	mmig¿‹_q
;

190 
ušt32_t
 
	mmig¿‹_r
;

191 } 
	m¡©s
;

193 #ifdeà
ENABLE_BINPACKING


194 
s_time_t
 
	mÏ¡_·s£d
;

195 
	mdiff_·s£d
;

196 
	mcouÁ_·s£d
;

197 
	mcouÁ_cosched
;

199 #ifdeà
ENABLE_MEASURE_UNBALANCE


200 
	mmy´oûssÜ
;

204 #ifdeà
ENABLE_BINPACKING


205 
	$csched_šfo
(
vıu
 *
v
, 
¬¿y
[])

207 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
v
);

208 
¬¿y
[0] = (
svc
->
diff_·s£d
<0) ? 1:0;

209 
¬¿y
[1] = (
svc
->
diff_·s£d
<0) ? -svc->diff_passed:svc->diff_passed;

210 
¬¿y
[2] = 
svc
->
couÁ_·s£d
;

211 
¬¿y
[3] = 
svc
->
couÁ_cosched
;

212 
svc
->
diff_·s£d
 = 0;

213 
svc
->
couÁ_·s£d
 = 0;

214 
svc
->
couÁ_cosched
 = 0;

216 
	}
}

222 
	scsched_dom
 {

223 
li¡_h—d
 
	maùive_vıu
;

224 
li¡_h—d
 
	maùive_sdom_–em
;

225 
domaš
 *
	mdom
;

226 
ušt16_t
 
	maùive_vıu_couÁ
;

227 
ušt16_t
 
	mweight
;

228 
ušt16_t
 
	mÿp
;

229 #ifdeà
HETERO_VISOR


230 
	msÿp
;

231 
	mfÿp
;

232 
li¡_h—d
 
	mdom_´iÜ™y_–em
;

233 
li¡_h—d
 
	mç¡_vıu
;

234 
li¡_h—d
 
	mh‘”o_vıu
;

235 
ušt16_t
 
	mvıu_couÁ
;

236 
boŞ_t
 
	mh‘”o_sched_dÚe
;

237 
ušt16_t
 
	mç¡_vıu_couÁ
;

238 
ušt16_t
 
	me¡©e
;

239 
ušt16_t
 
	meweight
;

240 
ušt16_t
 
	m–a¡ic_¥“d
;

241 
ušt16_t
 
	mgue¡_¥“d
;

242 
ušt16_t
 
	m•riÜ™y
;

249 
	scsched_´iv©e
 {

250 
¥šlock_t
 
	mlock
;

251 
li¡_h—d
 
	maùive_sdom
;

252 
ušt32_t
 
	mnıus
;

253 
tim”
 
	mma¡”_tick”
;

254 
	mma¡”
;

255 
ıumask_t
 
	midËrs
;

256 
ıumask_t
 
	mıus
;

257 
ušt32_t
 
	mweight
;

258 
ušt32_t
 
	müed™
;

259 
	müed™_b®ªû
;

260 
ušt32_t
 
	mrunq_sÜt
;

261 #ifdeà
HETERO_VISOR


262 
li¡_h—d
 
	mdom_´iÜ™y_li¡
;

263 
ušt32_t
 
	meweight
;

267 
csched_tick
(*
_ıu
);

268 
csched_acù
(*
dummy
);

270 
šlše
 

271 
	$__vıu_Ú_runq
(
csched_vıu
 *
svc
)

273  !
	`li¡_em±y
(&
svc
->
runq_–em
);

274 
	}
}

276 
šlše
 
csched_vıu
 *

277 
	$__runq_–em
(
li¡_h—d
 *
–em
)

279  
	`li¡_’Œy
(
–em
, 
csched_vıu
, 
runq_–em
);

280 
	}
}

282 
šlše
 

283 
	$__runq_š£¹
(
ıu
, 
csched_vıu
 *
svc
)

285 cÚ¡ 
li¡_h—d
 * cÚ¡ 
runq
 = 
	`RUNQ
(
ıu
);

286 
li¡_h—d
 *
™”
;

288 
	`BUG_ON
Ğ
	`__vıu_Ú_runq
(
svc
) );

289 
	`BUG_ON
Ğ
ıu
 !ğ
svc
->
vıu
->
´oûssÜ
 );

291 
	`li¡_fÜ_—ch
Ğ
™”
, 
runq
 )

293 cÚ¡ 
csched_vıu
 * cÚ¡ 
™”_svc
 = 
	`__runq_–em
(
™”
);

294 iàĞ
svc
->
´i
 > 
™”_svc
->pri )

301 iàĞ
svc
->
æags
 & 
CSCHED_FLAG_VCPU_YIELD


302 && 
	`__runq_–em
(
™”
)->
´i
 > 
CSCHED_PRI_IDLE
 )

304 
™”
=™”->
Ãxt
;

307 
	`BUG_ON
(
™”
 =ğ
runq
);

310 
	`li¡_add_
(&
svc
->
runq_–em
, 
™”
);

311 #ifdeà
ENABLE_MEASURE_UNBALANCE


312 #ifdeà
VERBOSE_MEASURE_UNBALANCE


314 
f
 = -1,
t
 = -1;

315 ià(
mši_aùiv©ed
) {

316 
	`has_cÜe_unb®ªû
(&
f
, &
t
);

319 
	`MYASSERT
(
svc
->
my´oûssÜ
 == -1);

320 
svc
->
my´oûssÜ
 = 
ıu
;

323 ià(
	`©omic_»ad
(&
ÿchemª
[
´oc2štÿche
[
ıu
]].
vıu_couÁ
)<0) {

324 
	`my´štk
("BUG?? was‚egative ?\n");

326 ià(
	`©omic_šc_ªd_‹¡
(&
ÿchemª
[
´oc2štÿche
[
ıu
]].
vıu_couÁ
)) {

329 #ifdeà
VERBOSE_MEASURE_UNBALANCE


330 ià(
mši_aùiv©ed
) {

331 
a
 = -1,
b
 = -1;

332 
	`has_cÜe_unb®ªû
(&
a
, &
b
);

333 ià((
f
==-1 && 
a
!=-1))

334 
	`´štk
("Unbal:");

335 ià((
f
!=-1 && 
a
==-1))

336 
	`´štk
("Bal:");

340 
	}
}

342 
šlše
 

343 
	$__runq_»move
(
csched_vıu
 *
svc
)

345 
	`BUG_ON
Ğ!
	`__vıu_Ú_runq
(
svc
) );

346 
	`li¡_d–_š™
(&
svc
->
runq_–em
);

347 #ifdeà
ENABLE_MEASURE_UNBALANCE


348 #ifdeà
VERBOSE_MEASURE_UNBALANCE


349 
f
 = -1,
t
 = -1;

350 ià(
mši_aùiv©ed
) {

351 
	`has_cÜe_unb®ªû
(&
f
, &
t
);

355 
	`BUG_ON
(
max_´oc
==0);

356 
	`BUG_ON
(!(
svc
->
my´oûssÜ
 >=0 && svc->my´oûssÜ < 
max_´oc
 ));

357 ià(
svc
->
my´oûssÜ
 !ğsvc->
vıu
->
´oûssÜ
)

358 
	`my´štk
("They differ sometimes\n");

359 ià(
	`©omic_»ad
(&
ÿchemª
[
´oc2štÿche
[
svc
->
my´oûssÜ
]].
vıu_couÁ
)<=0) {

360 
	`my´štk
("BUG??? was <=0?? \n");

362 
	`©omic_dec
(&
ÿchemª
[
´oc2štÿche
[
svc
->
my´oûssÜ
]].
vıu_couÁ
);

363 
svc
->
my´oûssÜ
 = -1;

364 #ifdeà
VERBOSE_MEASURE_UNBALANCE


365 ià(
mši_aùiv©ed
) {

366 
a
 = -1,
b
 = -1;

367 
	`has_cÜe_unb®ªû
(&
a
, &
b
);

368 ià((
f
==-1 && 
a
!=-1))

369 
	`´štk
("Unbal:");

370 ià((
f
!=-1 && 
a
==-1))

371 
	`´štk
("Bal:");

375 
	}
}

377 
	$buº_üed™s
(
csched_vıu
 *
svc
, 
s_time_t
 
now
)

379 
s_time_t
 
d–
;

380 
üed™s
;

382 #ifdeà
HETERO_VISOR


383 
ušt64_t
 
mytime
, 
my£c
;

384 
	`rdtsşl
(
mytime
);

385 
my£c
 = 
	`tsc_ticks2ns
(
mytime
)/1000000;

388 
	`ASSERT
(
svc
==
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, svc->
vıu
->
´oûssÜ
).
cu¼
));

390 iàĞ(
d–
 = 
now
 - 
svc
->
¡¬t_time
) <= 0 )

393 
üed™s
 = (
d–
*
CSCHED_CREDITS_PER_MSEC
 + 
	`MILLISECS
(1)/2) / MILLISECS(1);

394 
	`©omic_sub
(
üed™s
, &
svc
->
üed™
);

395 
svc
->
¡¬t_time
 +ğ(
üed™s
 * 
	`MILLISECS
(1)è/ 
CSCHED_CREDITS_PER_MSEC
;

396 #ifdeà
HETERO_VISOR


397 if(
h‘”o_visÜ_aùive
)

399 ifĞ
svc
->
cÜe_ty³
 =ğ
SMALL
)

400 
	`©omic_sub
(
üed™s
, &
svc
->
süed™
);

402 
	`©omic_sub
(
üed™s
, &
svc
->
füed™
);

404 if(
h‘”o_debug_Ëv–
 >= 2)

405 
	`´štk
("%lu [buº_üed™s] vıu:%d %d %d %d %d %d\n",
my£c
,
svc
->
vıu
->
vıu_id
,svc->vıu->
domaš
->
domaš_id
,svc->vıu->
´oûssÜ
,
üed™s
,
	`©omic_»ad
(&svc->
süed™
),©omic_»ad(&svc->
füed™
));

408 
	}
}

410 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_tickË_Úe_idË
 = 1;

411 
boŞ—n_·¿m
("tickË_Úe_idË_ıu", 
İt_tickË_Úe_idË
);

413 
DEFINE_PER_CPU
(, 
Ï¡_tickË_ıu
);

415 
šlše
 

416 
	$__runq_tickË
(
ıu
, 
csched_vıu
 *
Ãw
)

418 
csched_vıu
 * cÚ¡ 
cur
 =

419 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
);

420 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
	`³r_ıu
(
scheduËr
, 
ıu
));

421 
ıumask_t
 
mask
;

423 
	`ASSERT
(
cur
);

424 
	`ıus_ş—r
(
mask
);

427 iàĞ
Ãw
->
´i
 > 
cur
->pri )

429 iàĞ
cur
->
´i
 =ğ
CSCHED_PRI_IDLE
 )

430 
	`CSCHED_STAT_CRANK
(
tickË_loÿl_idËr
);

431 iàĞ
cur
->
´i
 =ğ
CSCHED_PRI_TS_OVER
 )

432 
	`CSCHED_STAT_CRANK
(
tickË_loÿl_ov”
);

433 iàĞ
cur
->
´i
 =ğ
CSCHED_PRI_TS_UNDER
 )

434 
	`CSCHED_STAT_CRANK
(
tickË_loÿl_und”
);

436 
	`CSCHED_STAT_CRANK
(
tickË_loÿl_Ùh”
);

438 
	`ıu_£t
(
ıu
, 
mask
);

445 iàĞ
cur
->
´i
 > 
CSCHED_PRI_IDLE
 )

447 iàĞ
	`ıus_em±y
(
´v
->
idËrs
) )

449 
	`CSCHED_STAT_CRANK
(
tickË_idËrs_nÚe
);

453 
ıumask_t
 
idË_mask
;

455 
	`ıus_ªd
(
idË_mask
, 
´v
->
idËrs
, 
Ãw
->
vıu
->
ıu_affš™y
);

456 iàĞ!
	`ıus_em±y
(
idË_mask
) )

458 
	`CSCHED_STAT_CRANK
(
tickË_idËrs_some
);

459 iàĞ
İt_tickË_Úe_idË
 )

461 
	`this_ıu
(
Ï¡_tickË_ıu
) =

462 
	`cyşe_ıu
(
	`this_ıu
(
Ï¡_tickË_ıu
), 
idË_mask
);

463 
	`ıu_£t
(
	`this_ıu
(
Ï¡_tickË_ıu
), 
mask
);

466 
	`ıus_Ü
(
mask
, mask, 
idË_mask
);

468 
	`ıus_ªd
(
mask
, mask, 
Ãw
->
vıu
->
ıu_affš™y
);

473 iàĞ!
	`ıus_em±y
(
mask
) )

474 
	`ıumask_¿i£_soáœq
(
mask
, 
SCHEDULE_SOFTIRQ
);

475 
	}
}

478 
	$csched_ä“_pd©a
(cÚ¡ 
scheduËr
 *
İs
, *
pıu
, 
ıu
)

480 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

481 
csched_pıu
 *
¥c
 = 
pıu
;

482 
æags
;

484 iàĞ
¥c
 =ğ
NULL
 )

487 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

489 
´v
->
üed™
 -ğ
CSCHED_CREDITS_PER_ACCT
;

490 
´v
->
nıus
--;

491 
	`ıu_ş—r
(
ıu
, 
´v
->
idËrs
);

492 
	`ıu_ş—r
(
ıu
, 
´v
->
ıus
);

493 iàĞ(
´v
->
ma¡”
 =ğ
ıu
è&& (´v->
nıus
 > 0) )

495 
´v
->
ma¡”
 = 
	`fœ¡_ıu
Õrv->
ıus
);

496 
	`mig¿‹_tim”
(&
´v
->
ma¡”_tick”
,…rv->
ma¡”
);

498 
	`kl_tim”
(&
¥c
->
tick”
);

499 iàĞ
´v
->
nıus
 == 0 )

500 
	`kl_tim”
(&
´v
->
ma¡”_tick”
);

502 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

504 
	`xä“
(
¥c
);

505 
	}
}

508 
	$csched_®loc_pd©a
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

510 
csched_pıu
 *
¥c
;

511 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

512 
æags
;

515 
¥c
 = 
	`xm®loc
(
csched_pıu
);

516 iàĞ
¥c
 =ğ
NULL
 )

517  
NULL
;

518 
	`mem£t
(
¥c
, 0, (*spc));

520 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

523 
´v
->
üed™
 +ğ
CSCHED_CREDITS_PER_ACCT
;

524 
´v
->
nıus
++;

525 
	`ıu_£t
(
ıu
, 
´v
->
ıus
);

526 iàĞ
´v
->
nıus
 == 1 )

528 
´v
->
ma¡”
 = 
ıu
;

529 
	`š™_tim”
(&
´v
->
ma¡”_tick”
, 
csched_acù
,…rv, 
ıu
);

530 
	`£t_tim”
(&
´v
->
ma¡”_tick”
, 
	`NOW
() +

531 
	`MILLISECS
(
CSCHED_MSECS_PER_TICK
è* 
CSCHED_TICKS_PER_ACCT
);

534 
	`š™_tim”
(&
¥c
->
tick”
, 
csched_tick
, (*)()
ıu
, cpu);

535 
	`£t_tim”
(&
¥c
->
tick”
, 
	`NOW
(è+ 
	`MILLISECS
(
CSCHED_MSECS_PER_TICK
));

537 
	`INIT_LIST_HEAD
(&
¥c
->
runq
);

538 
¥c
->
runq_sÜt_Ï¡
 = 
´v
->
runq_sÜt
;

539 
¥c
->
idË_bŸs
 = 
NR_CPUS
 - 1;

540 iàĞ
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
sched_´iv
 =ğ
NULL
 )

541 
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
sched_´iv
 = 
¥c
;

543 #ifdeà
ENABLE_PCPU_STAT


544 
¥c
->
¡¬t_time
 = 0;

545 
¥c
->
sched_time
 = 0;

549 
	`BUG_ON
(!
	`is_idË_vıu
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
));

550 
	`ıu_£t
(
ıu
, 
´v
->
idËrs
);

552 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

554  
¥c
;

555 
	}
}

557 #iâdeà
NDEBUG


558 
šlše
 

559 
	$__csched_vıu_check
(
vıu
 *
vc
)

561 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

562 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

564 
	`BUG_ON
Ğ
svc
->
vıu
 !ğ
vc
 );

565 
	`BUG_ON
Ğ
sdom
 !ğ
	`CSCHED_DOM
(
vc
->
domaš
) );

566 iàĞ
sdom
 )

568 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

569 
	`BUG_ON
Ğ
sdom
->
dom
 !ğ
vc
->
domaš
 );

573 
	`BUG_ON
Ğ!
	`is_idË_vıu
(
vc
) );

576 
	`CSCHED_STAT_CRANK
(
vıu_check
);

577 
	}
}

578 
	#CSCHED_VCPU_CHECK
(
_vc
è(
	`__csched_vıu_check
(_vc))

	)

580 
	#CSCHED_VCPU_CHECK
(
_vc
)

	)

589 
	gvıu_mig¿tiÚ_d–ay
;

590 
š‹g”_·¿m
("vıu_mig¿tiÚ_d–ay", 
vıu_mig¿tiÚ_d–ay
);

592 
	$£t_vıu_mig¿tiÚ_d–ay
(
d–ay
)

594 
vıu_mig¿tiÚ_d–ay
 = 
d–ay
;

595 
	}
}

597 
	$g‘_vıu_mig¿tiÚ_d–ay
()

599  
vıu_mig¿tiÚ_d–ay
;

600 
	}
}

602 
šlše
 

603 
	$__csched_vıu_is_ÿche_hÙ
(
vıu
 *
v
)

605 
hÙ
 = ((
	`NOW
(è- 
v
->
Ï¡_run_time
) <

606 ((
ušt64_t
)
vıu_mig¿tiÚ_d–ay
 * 1000u));

608 iàĞ
hÙ
 )

609 
	`CSCHED_STAT_CRANK
(
vıu_hÙ
);

611  
hÙ
;

612 
	}
}

614 
šlše
 

615 
	$__csched_vıu_is_mig¿‹abË
(
vıu
 *
vc
, 
de¡_ıu
)

621  !
vc
->
is_ruÂšg
 &&

622 !
	`__csched_vıu_is_ÿche_hÙ
(
vc
) &&

623 
	`ıu_is£t
(
de¡_ıu
, 
vc
->
ıu_affš™y
);

624 
	}
}

627 
	$_csched_ıu_pick
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
, 
boŞ_t
 
comm™
)

629 
ıumask_t
 
ıus
;

630 
ıumask_t
 
idËrs
;

631 
ıumask_t
 *
Úlše
;

632 
ıu
;

638 
Úlše
 = 
	`CSCHED_CPUONLINE
(
vc
->
domaš
->
ıupoŞ
);

639 
	`ıus_ªd
(
ıus
, *
Úlše
, 
vc
->
ıu_affš™y
);

640 #ifdeà
ENABLE_PAGE_TOUCH


642 
·ge_dœ
 *
pgd
 = 
vc
->
cu¼’t_pgd
;

643 
ÿche
 = 
vc
->
de¡_ÿche
;

645 ià(
ÿche
 != -1) {

646 
	`MYASSERT
(
pgd
);

647 
	`ASSERT
(
ÿche
 >=0 && cach< 
MAX_CACHE
 );

650 
	`ıus_ªd
(
ıus
, cpus, 
ÿche2ıumask
[
ÿche
] );

654 
ıu
 = 
	`ıu_is£t
(
vc
->
´oûssÜ
, 
ıus
)

655 ? 
vc
->
´oûssÜ


656 : 
	`cyşe_ıu
(
vc
->
´oûssÜ
, 
ıus
);

657 
	`ASSERT
Ğ!
	`ıus_em±y
(
ıus
è&& 
	`ıu_is£t
(
ıu
, cpus) );

671 
	`ıus_ªd
(
idËrs
, 
ıu_Úlše_m­
, 
	`CSCHED_PRIV
(
İs
)->idlers);

673 #ifdeà
ENABLE_PAGE_TOUCH


674 ià(
ÿche
 != -1) {

675 
	`ıus_ªd
(
ıus
, cpus, 
idËrs
);

676 ià(!
	`ıus_em±y
(
ıus
)) {

677 
ıu
 = 
	`ıu_is£t
(
vc
->
´oûssÜ
, 
ıus
)

678 ? 
vc
->
´oûssÜ


679 : 
	`cyşe_ıu
(
vc
->
´oûssÜ
, 
ıus
);

680 
	`ıu_ş—r
(
ıu
, 
ıus
);

684 
	`ıu_£t
(
ıu
, 
idËrs
);

685 
	`ıus_ªd
(
ıus
, cpus, 
idËrs
);

686 
	`ıu_ş—r
(
ıu
, 
ıus
);

687 #ifdeà
ENABLE_PAGE_TOUCH


692 ià(!
	`ıus_em±y
(
ıus
))

693 
ıu
 = 
	`cyşe_ıu
(ıu, 
ıus
);

694  
ıu
;

696  !
	`ıus_em±y
(
ıus
) )

698 
ıumask_t
 
ıu_idËrs
;

699 
ıumask_t
 
nxt_idËrs
;

700 
nxt
, 
weight_ıu
, 
weight_nxt
;

701 
mig¿‹_çùÜ
;

703 
nxt
 = 
	`cyşe_ıu
(
ıu
, 
ıus
);

705 iàĞ
	`ıu_is£t
(
ıu
, 
	`³r_ıu
(
ıu_cÜe_m­
, 
nxt
)) )

709 
	`ASSERT
Ğ
	`ıu_is£t
(
nxt
, 
	`³r_ıu
(
ıu_cÜe_m­
, 
ıu
)) );

710 
mig¿‹_çùÜ
 = 1;

711 
	`ıus_ªd
(
ıu_idËrs
, 
idËrs
, 
	`³r_ıu
(
ıu_siblšg_m­
, 
ıu
));

712 
	`ıus_ªd
(
nxt_idËrs
, 
idËrs
, 
	`³r_ıu
(
ıu_siblšg_m­
, 
nxt
));

718 
	`ASSERT
Ğ!
	`ıu_is£t
(
nxt
, 
	`³r_ıu
(
ıu_cÜe_m­
, 
ıu
)) );

719 
mig¿‹_çùÜ
 = 2;

720 
	`ıus_ªd
(
ıu_idËrs
, 
idËrs
, 
	`³r_ıu
(
ıu_cÜe_m­
, 
ıu
));

721 
	`ıus_ªd
(
nxt_idËrs
, 
idËrs
, 
	`³r_ıu
(
ıu_cÜe_m­
, 
nxt
));

724 
weight_ıu
 = 
	`ıus_weight
(
ıu_idËrs
);

725 
weight_nxt
 = 
	`ıus_weight
(
nxt_idËrs
);

727 iàĞĞ
sched_smt_pow”_§všgs


728 && (
weight_ıu
 > 
weight_nxt
) )

729 || ( !
sched_smt_pow”_§všgs


730 && (
weight_ıu
 * 
mig¿‹_çùÜ
 < 
weight_nxt
) ) )

732 
	`ıus_ªd
(
nxt_idËrs
, 
ıus
,‚xt_idlers);

733 
ıu
 = 
	`cyşe_ıu
(
	`CSCHED_PCPU
(
nxt
)->
idË_bŸs
, 
nxt_idËrs
);

734 iàĞ
comm™
 )

735 
	`CSCHED_PCPU
(
nxt
)->
idË_bŸs
 = 
ıu
;

736 
	`ıus_ªdnÙ
(
ıus
, cpus, 
	`³r_ıu
(
ıu_siblšg_m­
, 
ıu
));

740 
	`ıus_ªdnÙ
(
ıus
, cpus, 
nxt_idËrs
);

743  
ıu
;

747 
	`csched_ıu_pick
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

749  
	`_csched_ıu_pick
(
İs
, 
vc
, 1);

752 
šlše
 

753 
	`__csched_vıu_acù_¡¬t
(
csched_´iv©e
 *
´v
, 
csched_vıu
 *
svc
)

755 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

756 
æags
;

758 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

760 iàĞ
	`li¡_em±y
(&
svc
->
aùive_vıu_–em
) )

762 
	`CSCHED_VCPU_STAT_CRANK
(
svc
, 
¡©e_aùive
);

763 
	`CSCHED_STAT_CRANK
(
acù_vıu_aùive
);

765 
sdom
->
aùive_vıu_couÁ
++;

766 
	`li¡_add
(&
svc
->
aùive_vıu_–em
, &
sdom
->
aùive_vıu
);

768 
´v
->
weight
 +ğ
sdom
->weight;

769 iàĞ
	`li¡_em±y
(&
sdom
->
aùive_sdom_–em
) )

771 
	`li¡_add
(&
sdom
->
aùive_sdom_–em
, &
´v
->
aùive_sdom
);

775 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

778 
šlše
 

779 
	`__csched_vıu_acù_¡İ_locked
(
csched_´iv©e
 *
´v
,

780 
csched_vıu
 *
svc
)

782 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

784 
	`BUG_ON
Ğ
	`li¡_em±y
(&
svc
->
aùive_vıu_–em
) );

786 
	`CSCHED_VCPU_STAT_CRANK
(
svc
, 
¡©e_idË
);

787 
	`CSCHED_STAT_CRANK
(
acù_vıu_idË
);

789 
	`BUG_ON
Ğ
´v
->
weight
 < 
sdom
->weight );

790 
sdom
->
aùive_vıu_couÁ
--;

791 
	`li¡_d–_š™
(&
svc
->
aùive_vıu_–em
);

792 
´v
->
weight
 -ğ
sdom
->weight;

793 iàĞ
	`li¡_em±y
(&
sdom
->
aùive_vıu
) )

795 
	`li¡_d–_š™
(&
sdom
->
aùive_sdom_–em
);

800 
	`csched_vıu_acù
(
csched_´iv©e
 *
´v
, 
ıu
)

802 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
cu¼’t
);

803 cÚ¡ 
scheduËr
 *
İs
 = 
	`³r_ıu
(scheduËr, 
ıu
);

805 
	`ASSERT
Ğ
cu¼’t
->
´oûssÜ
 =ğ
ıu
 );

806 
	`ASSERT
Ğ
svc
->
sdom
 !ğ
NULL
 );

813 iàĞ
svc
->
´i
 =ğ
CSCHED_PRI_TS_BOOST
 )

814 
svc
->
´i
 = 
CSCHED_PRI_TS_UNDER
;

819 iàĞ!
	`is_idË_vıu
(
svc
->
vıu
) )

820 
	`buº_üed™s
(
svc
, 
	`NOW
());

830 iàĞ
	`li¡_em±y
(&
svc
->
aùive_vıu_–em
) )

832 
	`__csched_vıu_acù_¡¬t
(
´v
, 
svc
);

834 iàĞ
	`_csched_ıu_pick
(
İs
, 
cu¼’t
, 0è!ğ
ıu
 )

836 
	`CSCHED_VCPU_STAT_CRANK
(
svc
, 
mig¿‹_r
);

837 
	`CSCHED_STAT_CRANK
(
mig¿‹_ruÂšg
);

838 
	`£t_b™
(
_VPF_mig¿tšg
, &
cu¼’t
->
·u£_æags
);

839 
	`ıu_¿i£_soáœq
(
ıu
, 
SCHEDULE_SOFTIRQ
);

844 
	`csched_®loc_vd©a
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
, *
dd
)

846 
csched_vıu
 *
svc
;

849 
svc
 = 
	`xm®loc
(
csched_vıu
);

850 iàĞ
svc
 =ğ
NULL
 )

851  
NULL
;

852 
	`mem£t
(
svc
, 0, (*svc));

854 #ifdeà
ENABLE_BINPACKING


855 
svc
->
Ï¡_·s£d
 = 1;

856 
svc
->
diff_·s£d
 = 0;

857 
svc
->
couÁ_·s£d
 = 0;

858 
svc
->
couÁ_cosched
 = 0;

860 #ifdeà
ENABLE_MEASURE_UNBALANCE


861 
svc
->
my´oûssÜ
 = -1;

863 
	`INIT_LIST_HEAD
(&
svc
->
runq_–em
);

864 
	`INIT_LIST_HEAD
(&
svc
->
aùive_vıu_–em
);

865 
svc
->
sdom
 = 
dd
;

866 
svc
->
vıu
 = 
vc
;

867 
	`©omic_£t
(&
svc
->
üed™
, 0);

868 #ifdeà
HETERO_VISOR


869 
	`©omic_£t
(&
svc
->
süed™
, 0);

870 
	`©omic_£t
(&
svc
->
füed™
, 0);

871 
svc
->
cÜe_ty³
 = 0;

872 
svc
->
ùr
 = 
	`xm®loc
(
couÁ”s
);

873 
svc
->
pùr
 = 
	`xm®loc
(
³rf_ùrs
);

874 
svc
->
ùr
->
Ï¡_upd©e
 = 0;

875 
	`INIT_LIST_HEAD
(&
svc
->
ç¡_vıu_–em
);

876 
	`INIT_LIST_HEAD
(&
svc
->
h‘”o_vıu_–em
);

878 
svc
->
æags
 = 0U;

879 
svc
->
´i
 = 
	`is_idË_domaš
(
vc
->
domaš
) ?

880 
CSCHED_PRI_IDLE
 : 
CSCHED_PRI_TS_UNDER
;

881 
	`CSCHED_VCPU_STATS_RESET
(
svc
);

882 
	`CSCHED_STAT_CRANK
(
vıu_š™
);

883  
svc
;

887 
	`csched_vıu_š£¹
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

889 
csched_vıu
 *
svc
 = 
vc
->
sched_´iv
;

891 iàĞ!
	`__vıu_Ú_runq
(
svc
è&& 
	`vıu_ruÂabË
(
vc
è&& !vc->
is_ruÂšg
 )

892 
	`__runq_š£¹
(
vc
->
´oûssÜ
, 
svc
);

896 
	`csched_ä“_vd©a
(cÚ¡ 
scheduËr
 *
İs
, *
´iv
)

898 
csched_vıu
 *
svc
 = 
´iv
;

900 
	`BUG_ON
Ğ!
	`li¡_em±y
(&
svc
->
runq_–em
) );

902 
	`xä“
(
svc
);

906 
	`csched_vıu_»move
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

908 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

909 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

910 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

911 
æags
;

913 
	`CSCHED_STAT_CRANK
(
vıu_de¡roy
);

915 iàĞ
	`__vıu_Ú_runq
(
svc
) )

916 
	`__runq_»move
(
svc
);

918 
	`¥š_lock_œq§ve
(&(
´v
->
lock
), 
æags
);

920 iàĞ!
	`li¡_em±y
(&
svc
->
aùive_vıu_–em
) )

921 
	`__csched_vıu_acù_¡İ_locked
(
´v
, 
svc
);

923 
	`¥š_uÆock_œq»¡Üe
(&(
´v
->
lock
), 
æags
);

925 
	`BUG_ON
Ğ
sdom
 =ğ
NULL
 );

926 
	`BUG_ON
Ğ!
	`li¡_em±y
(&
svc
->
runq_–em
) );

930 
	`csched_vıu_¦“p
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

932 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

934 
	`CSCHED_STAT_CRANK
(
vıu_¦“p
);

936 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

937 #ifdeà
VERBOSE_USCHED_DETAIL


938 ià(
vc
->
de¡_ÿche
 != -1) {

940 
	`MYASSERT
Ğ
	`³r_ıu
(
scheduË_d©a
, 
vc
->
´oûssÜ
).
cu¼
 == vc );

944 iàĞ
	`³r_ıu
(
scheduË_d©a
, 
vc
->
´oûssÜ
).
cu¼
 == vc )

945 
	`ıu_¿i£_soáœq
(
vc
->
´oûssÜ
, 
SCHEDULE_SOFTIRQ
);

946 iàĞ
	`__vıu_Ú_runq
(
svc
) )

947 
	`__runq_»move
(
svc
);

951 
	`csched_vıu_wake
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

953 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

954 cÚ¡ 
ıu
 = 
vc
->
´oûssÜ
;

956 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

958 iàĞ
	`uÆik–y
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
 =ğ
vc
) )

960 
	`CSCHED_STAT_CRANK
(
vıu_wake_ruÂšg
);

963 iàĞ
	`uÆik–y
(
	`__vıu_Ú_runq
(
svc
)) )

965 
	`CSCHED_STAT_CRANK
(
vıu_wake_Úrunq
);

969 iàĞ
	`lik–y
(
	`vıu_ruÂabË
(
vc
)) )

970 
	`CSCHED_STAT_CRANK
(
vıu_wake_ruÂabË
);

972 
	`CSCHED_STAT_CRANK
(
vıu_wake_nÙ_ruÂabË
);

995 iàĞ
svc
->
´i
 =ğ
CSCHED_PRI_TS_UNDER
 &&

996 !(
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
) )

998 
svc
->
´i
 = 
CSCHED_PRI_TS_BOOST
;

1003 
	`__runq_š£¹
(
ıu
, 
svc
);

1004 
	`__runq_tickË
(
ıu
, 
svc
);

1008 
	`csched_vıu_y›ld
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

1010 
csched_vıu
 * cÚ¡ 
sv
 = 
	`CSCHED_VCPU
(
vc
);

1012 iàĞ!
sched_üed™_deçuÉ_y›ld
 )

1015 
sv
->
æags
 |ğ
CSCHED_FLAG_VCPU_YIELD
;

1020 
	`csched_dom_ú
(

1021 cÚ¡ 
scheduËr
 *
İs
,

1022 
domaš
 *
d
,

1023 
x’_domùl_scheduËr_İ
 *
İ
)

1025 
csched_dom
 * cÚ¡ 
sdom
 = 
	`CSCHED_DOM
(
d
);

1026 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1027 
æags
;

1029 iàĞ
İ
->
cmd
 =ğ
XEN_DOMCTL_SCHEDOP_g‘šfo
 )

1031 
İ
->
u
.
üed™
.
weight
 = 
sdom
->weight;

1032 
İ
->
u
.
üed™
.
ÿp
 = 
sdom
->cap;

1036 
	`ASSERT
(
İ
->
cmd
 =ğ
XEN_DOMCTL_SCHEDOP_putšfo
);

1038 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

1040 iàĞ
İ
->
u
.
üed™
.
weight
 != 0 )

1042 iàĞ!
	`li¡_em±y
(&
sdom
->
aùive_sdom_–em
) )

1044 
´v
->
weight
 -ğ
sdom
->weighˆ* sdom->
aùive_vıu_couÁ
;

1045 
´v
->
weight
 +ğ
İ
->
u
.
üed™
.weighˆ* 
sdom
->
aùive_vıu_couÁ
;

1047 
sdom
->
weight
 = 
İ
->
u
.
üed™
.weight;

1050 iàĞ
İ
->
u
.
üed™
.
ÿp
 !ğ(
ušt16_t
)~0U )

1051 
sdom
->
ÿp
 = 
İ
->
u
.
üed™
.cap;

1053 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1060 
	`csched_®loc_domd©a
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

1062 
csched_dom
 *
sdom
;

1064 
sdom
 = 
	`xm®loc
(
csched_dom
);

1065 iàĞ
sdom
 =ğ
NULL
 )

1066  
NULL
;

1067 
	`mem£t
(
sdom
, 0, (*sdom));

1070 
	`INIT_LIST_HEAD
(&
sdom
->
aùive_vıu
);

1071 
sdom
->
aùive_vıu_couÁ
 = 0;

1072 
	`INIT_LIST_HEAD
(&
sdom
->
aùive_sdom_–em
);

1073 
sdom
->
dom
 = dom;

1074 
sdom
->
weight
 = 
CSCHED_DEFAULT_WEIGHT
;

1075 
sdom
->
ÿp
 = 0U;

1076 #ifdeà
HETERO_VISOR


1077 
sdom
->
sÿp
 = 0U;

1078 
sdom
->
fÿp
 = 0U;

1079 
sdom
->
ç¡_vıu_couÁ
 = 0;

1080 
sdom
->
h‘”o_sched_dÚe
 = 0;

1081 
sdom
->
e¡©e
 = 0;

1082 
sdom
->
eweight
 = sdom->
weight
;

1083 
sdom
->
–a¡ic_¥“d
=100;

1084 
sdom
->
gue¡_¥“d
=100;

1085 
sdom
->
•riÜ™y
 = 1;

1086 
sdom
->
vıu_couÁ
 = 1;

1087 
	`INIT_LIST_HEAD
(&
sdom
->
ç¡_vıu
);

1088 
	`INIT_LIST_HEAD
(&
sdom
->
h‘”o_vıu
);

1091  (*)
sdom
;

1095 
	`csched_dom_š™
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

1097 
csched_dom
 *
sdom
;

1099 
	`CSCHED_STAT_CRANK
(
dom_š™
);

1101 iàĞ
	`is_idË_domaš
(
dom
) )

1104 
sdom
 = 
	`csched_®loc_domd©a
(
İs
, 
dom
);

1105 iàĞ
sdom
 =ğ
NULL
 )

1106  -
ENOMEM
;

1108 
dom
->
sched_´iv
 = 
sdom
;

1114 
	`csched_ä“_domd©a
(cÚ¡ 
scheduËr
 *
İs
, *
d©a
)

1116 
	`xä“
(
d©a
);

1120 
	`csched_dom_de¡roy
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

1122 
	`CSCHED_STAT_CRANK
(
dom_de¡roy
);

1123 
	`csched_ä“_domd©a
(
İs
, 
	`CSCHED_DOM
(
dom
));

1134 
	`csched_runq_sÜt
(
csched_´iv©e
 *
´v
, 
ıu
)

1136 
csched_pıu
 * cÚ¡ 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

1137 
li¡_h—d
 *
runq
, *
–em
, *
Ãxt
, *
Ï¡_und”
;

1138 
csched_vıu
 *
svc_–em
;

1139 
æags
;

1140 
sÜt_•och
;

1142 
sÜt_•och
 = 
´v
->
runq_sÜt
;

1143 iàĞ
sÜt_•och
 =ğ
¥c
->
runq_sÜt_Ï¡
 )

1146 
¥c
->
runq_sÜt_Ï¡
 = 
sÜt_•och
;

1148 
	`pıu_scheduË_lock_œq§ve
(
ıu
, 
æags
);

1150 
runq
 = &
¥c
->runq;

1151 
–em
 = 
runq
->
Ãxt
;

1152 
Ï¡_und”
 = 
runq
;

1154  
–em
 !ğ
runq
 )

1156 
Ãxt
 = 
–em
->next;

1157 
svc_–em
 = 
	`__runq_–em
(
–em
);

1159 iàĞ
svc_–em
->
´i
 >ğ
CSCHED_PRI_TS_UNDER
 )

1162 iàĞ
–em
->
´ev
 !ğ
Ï¡_und”
 )

1164 
	`li¡_d–
(
–em
);

1165 
	`li¡_add
(
–em
, 
Ï¡_und”
);

1167 
Ï¡_und”
 = 
–em
;

1170 
–em
 = 
Ãxt
;

1173 
	`pıu_scheduË_uÆock_œq»¡Üe
(
ıu
, 
æags
);

1176 #ifdeà
HETERO_VISOR


1177 
šlše
 
	`li¡_rÙ©e_Ëá
(
li¡_h—d
 *
h—d
)

1179 
li¡_h—d
 *
fœ¡
;

1181 ià(!
	`li¡_em±y
(
h—d
)) {

1182 
fœ¡
 = 
h—d
->
Ãxt
;

1183 
	`li¡_move_
(
fœ¡
, 
h—d
);

1187 
	`h‘”o_sched_b®ªû
(){

1188 
domaš
 *
d
;

1190 
csched_vıu
 *
svc
 = 
NULL
;

1191 
csched_dom
 *
sdom
;

1192 
ušt64_t
 
mytime
, 
my£c
;

1193 
ıumask_t
 
cÜemask
;

1195 
li¡_h—d
 *
™”_vıu
;

1197 
	`rdtsşl
(
mytime
);

1198 
my£c
 = 
	`tsc_ticks2ns
(
mytime
)/1000000;

1200 if(
h‘”o_sched_aùive
){

1201 
	`fÜ_—ch_domaš
Ğ
d
 )

1203 
sdom
 = 
	`CSCHED_DOM
(
d
);

1204 ià(
d
->
domaš_id
 > 0)

1207 if(!
sdom
->
h‘”o_sched_dÚe
)

1208 
	`ç¡_vıu_li¡
(
d
,1,0);

1211 if(
sdom
->
ç¡_vıu_couÁ
 < sdom->
vıu_couÁ
)

1213 
	`li¡_fÜ_—ch
Ğ
™”_vıu
, &
sdom
->
h‘”o_vıu
)

1215 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
,
h‘”o_vıu_–em
);

1218 if(!
	`li¡_em±y
(&
svc
->
ç¡_vıu_–em
))

1219 
	`´štk
("BUG % %d\n",
__FILE__
,
__LINE__
);

1220 
	`BUG_ON
(!
	`li¡_em±y
(&
svc
->
ç¡_vıu_–em
));

1223 if(
svc
){

1224 
cÜemask
 = 
bigcÜe_mask
;

1225 
svc
->
cÜe_ty³
 = 
BIG
;

1226 
	`h‘”o_vıu_mig¿‹
(
svc
->
vıu
, &
cÜemask
);

1227 
	`li¡_add_
(&
svc
->
ç¡_vıu_–em
, &
sdom
->
ç¡_vıu
);

1230 
	`li¡_rÙ©e_Ëá
(&
sdom
->
h‘”o_vıu
);

1236 
	`li¡_fÜ_—ch
Ğ
™”_vıu
, &
sdom
->
ç¡_vıu
)

1238 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
, 
ç¡_vıu_–em
);

1242 if(
svc
){

1243 
cÜemask
 = 
sm®lcÜe_mask
;

1244 
svc
->
cÜe_ty³
 = 
SMALL
;

1245 
	`h‘”o_vıu_mig¿‹
(
svc
->
vıu
, &
cÜemask
);

1246 
	`li¡_d–_š™
(&
svc
->
ç¡_vıu_–em
);

1252 if(
h‘”o_debug_Ëv–
 >= 1){

1253 
	`´štk
("%lu fa¡ vıu†i¡:",
my£c
);

1254 
	`li¡_fÜ_—ch
Ğ
™”_vıu
,&
sdom
->
ç¡_vıu
)

1256 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
,
ç¡_vıu_–em
);

1257 
	`´štk
("%d ",
svc
->
vıu
->
vıu_id
);

1259 
	`´štk
("\n");

1266 
	`upd©e_´iÜ™y_li¡
(){

1267 
ıu
 = 0;

1268 
domaš
 *
d
;

1269 
csched_dom
 *
sdom
;

1270 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
	`³r_ıu
(
scheduËr
, 
ıu
));

1271 
csched_dom
 *
qsdom
;

1272 
li¡_h—d
 *
™”_sdom
;

1274 
	`INIT_LIST_HEAD
(&
´v
->
dom_´iÜ™y_li¡
);

1276 
	`fÜ_—ch_domaš
Ğ
d
 )

1278 if(
d
->
domaš_id
 > 0){

1279 
sdom
 = 
	`CSCHED_DOM
(
d
);

1280 
	`INIT_LIST_HEAD
(&
sdom
->
dom_´iÜ™y_–em
);

1282 if(!
	`li¡_em±y
(&
´v
->
dom_´iÜ™y_li¡
)){

1283 
	`li¡_fÜ_—ch
Ğ
™”_sdom
, &
´v
->
dom_´iÜ™y_li¡
)

1285 
qsdom
 = 
	`li¡_’Œy
(
™”_sdom
, 
csched_dom
, 
dom_´iÜ™y_–em
);

1286 if(
sdom
->
•riÜ™y
 >ğ
qsdom
->epriority){

1290 
	`li¡_add_
(&
sdom
->
dom_´iÜ™y_–em
, 
™”_sdom
);

1295 
	`li¡_add
(&
sdom
->
dom_´iÜ™y_–em
, &
´v
->
dom_´iÜ™y_li¡
);

1300 if(
h‘”o_debug_Ëv–
 >= 0){

1301 
	`´štk
("Priority dom†ist:");

1302 
	`li¡_fÜ_—ch
Ğ
™”_sdom
, &
´v
->
dom_´iÜ™y_li¡
)

1304 
sdom
 = 
	`li¡_’Œy
(
™”_sdom
, 
csched_dom
, 
dom_´iÜ™y_–em
);

1305 
	`´štk
(" %d",
sdom
->
dom
->
domaš_id
);

1307 
	`´štk
("\n");

1312 
	`»di¡_hüed™s
(){

1313 
domaš
 *
d
;

1316 
csched_dom
 *
sdom
;

1317 
ušt64_t
 
mytime
, 
my£c
;

1318 
süed™s_Ëá
 = 
TOTAL_SCREDITS
;

1319 
füed™s_Ëá
 = 
TOTAL_FCREDITS
;

1320 
ıu
 = 0;

1321 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
	`³r_ıu
(
scheduËr
, 
ıu
));

1322 
li¡_h—d
 *
™”_sdom
;

1323 
ušt32_t
 
p¥“d
 = 0;

1324 
ušt16_t
 
fcouÁ
 = 0;

1325 
ušt16_t
 
num_sm®l_cÜes
 = 
num_aùive_ıus
 - 
big_cÜe_couÁ
;

1327 
	`rdtsşl
(
mytime
);

1328 
my£c
 = 
	`tsc_ticks2ns
(
mytime
)/1000000;

1330 if(
h‘”o_hüed™_pŞicy
 == 1){

1331 
´v
->
eweight
 = 0;

1332 
	`li¡_fÜ_—ch
Ğ
™”_sdom
, &
´v
->
dom_´iÜ™y_li¡
)

1334 
sdom
 = 
	`li¡_’Œy
(
™”_sdom
, 
csched_dom
, 
dom_´iÜ™y_–em
);

1336 if(
sdom
->
dom
->
domaš_id
 > 0)

1338 
fcouÁ
 = 
sdom
->
ç¡_vıu_couÁ
;

1340 if(
num_sm®l_cÜes
 >ğ
sdom
->
vıu_couÁ
){

1342 if(
sdom
->
gue¡_¥“d
 <= 100)

1344 
sdom
->
fÿp
 = 0U;

1345 
sdom
->
sÿp
 = sdom->
gue¡_¥“d
;

1346 
sdom
->
sÿp
 = sdom->
vıu_couÁ
 *sdom->
gue¡_¥“d
;

1347 
sdom
->
ç¡_vıu_couÁ
 = 0;

1354 
	`BUG_ON
(
big_cÜe_couÁ
 == 0);

1357 
p¥“d
 = ((
sdom
->
vıu_couÁ
 * (sdom->
gue¡_¥“d
 - 100))+(100*(
h‘”o_¥“d_¿tio
-1)-1));

1358 
sdom
->
ç¡_vıu_couÁ
 = 
p¥“d
/(100*(
h‘”o_¥“d_¿tio
-1));

1360 
	`WARN_ON
(
sdom
->
ç¡_vıu_couÁ
 > 
big_cÜe_couÁ
);

1362 if(
sdom
->
ç¡_vıu_couÁ
 > 
big_cÜe_couÁ
)

1364 
sdom
->
ç¡_vıu_couÁ
 = 
big_cÜe_couÁ
;

1368 
sdom
->
fÿp
 = ((sdom->
vıu_couÁ
 * (sdom->
gue¡_¥“d
 - 100))+100*sdom->
ç¡_vıu_couÁ
)/(
h‘”o_¥“d_¿tio
*sdom->fast_vcpu_count);

1369 
sdom
->
fÿp
 = sdom->fÿp*sdom->
ç¡_vıu_couÁ
;

1371 
sdom
->
sÿp
 = 100;

1372 
sdom
->
sÿp
 = 100*(sdom->
vıu_couÁ
 - sdom->
ç¡_vıu_couÁ
);

1376 if(
sdom
->
gue¡_¥“d
 <ğ(100*
num_sm®l_cÜes
)/sdom->
vıu_couÁ
)

1378 
sdom
->
fÿp
 = 0U;

1379 
sdom
->
sÿp
 = (sdom->
gue¡_¥“d
*sdom->
vıu_couÁ
)/
num_sm®l_cÜes
;

1380 
sdom
->
sÿp
 = sdom->
vıu_couÁ
 *sdom->
gue¡_¥“d
;

1381 
sdom
->
ç¡_vıu_couÁ
 = 0;

1385 
	`BUG_ON
(
big_cÜe_couÁ
 == 0);

1387 
sdom
->
ç¡_vıu_couÁ
 = sdom->
vıu_couÁ
 - 
num_sm®l_cÜes
;

1389 
p¥“d
 = ((
sdom
->
vıu_couÁ
 * sdom->
gue¡_¥“d
 - 100*
num_sm®l_cÜes
))+(100*(
h‘”o_¥“d_¿tio
)-1);

1390 
sdom
->
ç¡_vıu_couÁ
 = 
p¥“d
/(100*(
h‘”o_¥“d_¿tio
));

1393 
	`WARN_ON
(
sdom
->
ç¡_vıu_couÁ
 > 
big_cÜe_couÁ
);

1395 if(
sdom
->
ç¡_vıu_couÁ
 > 
big_cÜe_couÁ
)

1397 
sdom
->
ç¡_vıu_couÁ
 = 
big_cÜe_couÁ
;

1402 
p¥“d
 = ((
sdom
->
vıu_couÁ
 * sdom->
gue¡_¥“d
 - 100*
num_sm®l_cÜes
));

1403 
sdom
->
fÿp
 = 
p¥“d
/(
h‘”o_¥“d_¿tio
);

1408 
sdom
->
sÿp
 = (
num_sm®l_cÜes
*100);

1412 
sdom
->
sÿp
 = 
	`mš
(
süed™s_Ëá
, sdom->scap);

1413 
sdom
->
fÿp
 = 
	`mš
(
füed™s_Ëá
, sdom->fcap);

1414 
süed™s_Ëá
 -ğ
sdom
->
sÿp
;

1415 
füed™s_Ëá
 -ğ
sdom
->
fÿp
;

1416 
sdom
->
–a¡ic_¥“d
 = sdom->
gue¡_¥“d
;

1420 if(
fcouÁ
 !ğ
sdom
->
ç¡_vıu_couÁ
)

1421 
	`ç¡_vıu_li¡
(
sdom
->
dom
,0,
fcouÁ
);

1423 
´v
->
eweight
 +ğ
sdom
->eweight;

1428 if(
h‘”o_debug_Ëv–
 >= 1)

1430 
	`´štk
("%lu [»di¡_hüed™]:",
my£c
);

1431 
	`fÜ_—ch_domaš
Ğ
d
 )

1433 
sdom
 = 
	`CSCHED_DOM
(
d
);

1434 
	`´štk
("Dom:%d %d %d %d %d ",
sdom
->
dom
->
domaš_id
,sdom->
–a¡ic_¥“d
,sdom->
ç¡_vıu_couÁ
,sdom->
sÿp
,sdom->
fÿp
);

1436 
	`´štk
("\n");

1440 
ušt64_t
 
³rfùr_upd©e
 = 0;

1442 
	`»£t_³rf_couÁ”s
(){

1443 
domaš
 *
d
;

1444 
vıu
 *
v
;

1445 
csched_vıu
 * 
svc
;

1446 
ušt64_t
 
mytime
, 
diff_tsc
;

1448 
	`rdtsşl
(
mytime
);

1449 
diff_tsc
 = 
mytime
 - 
³rfùr_upd©e
;

1452 
	`fÜ_—ch_domaš
Ğ
d
 )

1454 if(
d
->
domaš_id
 > 0){

1455 
	`fÜ_—ch_vıu
Ğ
d
, 
v
 )

1457 
svc
 = 
	`CSCHED_VCPU
(
v
);

1460 
svc
->
pùr
->
š¡ns
 = svc->
ùr
->
dš¡
;

1462 
svc
->
pùr
->
aùive
 = svc->
ùr
->
dm³rf
;

1463 
svc
->
pùr
->
lmis£s
 = svc->
ùr
->
dlmis£s
*1000;

1464 
svc
->
pùr
->
rmis£s
 = svc->
ùr
->
drmis£s
;

1465 
svc
->
pùr
->
cyşes
 = 
diff_tsc
;

1468 
svc
->
pùr
->
cÜe_ty³
 = svc->core_type;

1472 
svc
->
ùr
->
dš¡
 = 0;

1473 
svc
->
ùr
->
dcyşes
 = 0;

1474 
svc
->
ùr
->
dlmis£s
 = 0;

1475 
svc
->
ùr
->
drmis£s
 = 0;

1476 
svc
->
ùr
->
dm³rf
 = 0;

1477 
svc
->
ùr
->
dtsc
 = 0;

1478 
	`rdtsşl
(
³rfùr_upd©e
);

1485 
	`´št_h—¹b—t_msg
(){

1486 
csched_dom
 * 
sdom
;

1487 
csched_vıu
 * 
svc
;

1488 
domaš
 *
d
;

1489 
vıu
 *
v
;

1491 
ušt64_t
 
mytime
, 
my£c
;

1492 
	`rdtsşl
(
mytime
);

1493 
my£c
 = 
	`tsc_ticks2ns
(
mytime
)/1000000;

1495 if(
h‘”o_debug_Ëv–
 >= 0)

1496 
	`´štk
("%lu [h‘_vis] ",
my£c
);

1498 if(
h‘”o_debug_Ëv–
 >= 0)

1500 
	`fÜ_—ch_domaš
Ğ
d
 )

1502 if(
d
->
domaš_id
 > 0)

1504 
sdom
 = 
	`CSCHED_DOM
(
d
);

1505 
	`´štk
("Dom:%d %d %d %d %d %d %d ",
d
->
domaš_id
,
sdom
->
gue¡_¥“d
,sdom->
–a¡ic_¥“d
,sdom->
sÿp
, sdom->
fÿp
,sdom->
vıu_couÁ
,sdom->
ç¡_vıu_couÁ
);

1509 
	`´štk
("\n");

1511 if(
h‘”o_debug_Ëv–
 >= 1)

1513 
	`fÜ_—ch_domaš
Ğ
d
 )

1515 if(
d
->
domaš_id
 > 0)

1517 
sdom
 = 
	`CSCHED_DOM
(
d
);

1519 
	`´štk
("%lu DOM %d ",
my£c
,
d
->
domaš_id
);

1520 
	`fÜ_—ch_vıu
Ğ
d
, 
v
 )

1522 
svc
 = 
	`CSCHED_VCPU
(
v
);

1524 
	`´štk
("id:%d %lu %lu %lu %lu ",
v
->
vıu_id
,
svc
->
pùr
->
š¡ns
, svc->pùr->
aùive
,svc->pùr->
lmis£s
,svc->pùr->
cyşes
);

1526 
	`´štk
("\n");

1540 
	`upd©e_³rf_ùrs
(
csched_vıu
 *
scu¼
)

1542 
ušt64_t
 
mytime
, 
diff_tsc
;

1544 if(!
	`is_idË_vıu
(
scu¼
->
vıu
))

1547 
	`upd©e_couÁ”s_ıu
(
NULL
);

1550 if(
	`__g‘_ıu_v¬
(
cÜe_ty³
) == 0)

1551 
scu¼
->
ùr
->
dm³rf
 +ğ
	`__g‘_ıu_v¬
(dm³rfè* 
h‘”o_¥“d_¿tio
;

1553 
scu¼
->
ùr
->
dm³rf
 +ğ
	`__g‘_ıu_v¬
(dmperf);

1555 
scu¼
->
ùr
->
dtsc
 +ğ
	`__g‘_ıu_v¬
(dtsc);

1556 
scu¼
->
ùr
->
dš¡
 +ğ
	`__g‘_ıu_v¬
(dinst);

1557 
scu¼
->
ùr
->
dcyşes
 +ğ
	`__g‘_ıu_v¬
(dcycles);

1558 
scu¼
->
ùr
->
dlmis£s
 +ğ
	`__g‘_ıu_v¬
(dlmisses);

1559 
scu¼
->
ùr
->
drmis£s
 +ğ
	`__g‘_ıu_v¬
(drmisses);

1564 
	`csched_acù
(* 
dummy
)

1566 
csched_´iv©e
 *
´v
 = 
dummy
;

1567 
æags
;

1568 
li¡_h—d
 *
™”_vıu
, *
Ãxt_vıu
;

1569 
li¡_h—d
 *
™”_sdom
, *
Ãxt_sdom
;

1570 
csched_vıu
 *
svc
;

1571 
csched_dom
 *
sdom
;

1572 
ušt32_t
 
üed™_tÙ®
;

1573 
ušt32_t
 
weight_tÙ®
;

1574 
ušt32_t
 
weight_Ëá
;

1575 
ušt32_t
 
üed™_çœ
;

1576 
ušt32_t
 
üed™_³ak
;

1577 
ušt32_t
 
üed™_ÿp
;

1578 
üed™_b®ªû
;

1579 
üed™_xŒa
;

1580 
üed™
;

1582 #ifdeà
HETERO_VISOR


1585 
ušt32_t
 
süed™_çœ
 = 0, 
füed™_çœ
 = 0;

1586 
ušt32_t
 
süed™_ÿp
 = 0, 
füed™_ÿp
 = 0;

1587 
süed™
 = 0, 
füed™
 = 0;

1588 
ušt16_t
 
ç¡_vıu_couÁ
 = 0, 
¦ow_vıu_couÁ
 = 0;

1590 
ušt64_t
 
mytime
, 
my£c
;

1591 
	`rdtsşl
(
mytime
);

1592 
my£c
 = 
	`tsc_ticks2ns
(
mytime
)/1000000;

1594 
h‘”o_hüed™_tick
++;

1595 
h‘”o_sched_tick
++;

1596 
h‘”o_debug_tick
++;

1598 if(
h‘”o_hüed™_tick
 >ğ
HCREDIT_TICK_COUNT
 && 
h‘”o_visÜ_aùive
){

1599 
	`»di¡_hüed™s
();

1600 
h‘”o_hüed™_tick
 = 0;

1603 if(
h‘”o_sched_tick
 >ğ
SCHED_TICK_COUNT
 && 
h‘”o_visÜ_aùive
){

1604 
	`»£t_³rf_couÁ”s
();

1605 
	`h‘”o_sched_b®ªû
();

1606 
h‘”o_sched_tick
 = 0 ;

1609 if(
h‘”o_debug_tick
 >ğ
DEBUG_TICK_COUNT
 && 
h‘”o_visÜ_aùive
){

1610 
	`´št_h—¹b—t_msg
();

1611 
h‘”o_debug_tick
 = 0 ;

1616 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

1618 
weight_tÙ®
 = 
´v
->
weight
;

1619 
üed™_tÙ®
 = 
´v
->
üed™
;

1622 iàĞ
´v
->
üed™_b®ªû
 < 0 )

1624 
üed™_tÙ®
 -ğ
´v
->
üed™_b®ªû
;

1625 
	`CSCHED_STAT_CRANK
(
acù_b®ªû
);

1628 iàĞ
	`uÆik–y
(
weight_tÙ®
 == 0) )

1630 
´v
->
üed™_b®ªû
 = 0;

1631 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1632 
	`CSCHED_STAT_CRANK
(
acù_no_wÜk
);

1633 
out
;

1636 
	`CSCHED_STAT_CRANK
(
acù_run
);

1638 
weight_Ëá
 = 
weight_tÙ®
;

1639 
üed™_b®ªû
 = 0;

1640 
üed™_xŒa
 = 0;

1641 
üed™_ÿp
 = 0U;

1643 
	`li¡_fÜ_—ch_§ã
Ğ
™”_sdom
, 
Ãxt_sdom
, &
´v
->
aùive_sdom
 )

1645 
sdom
 = 
	`li¡_’Œy
(
™”_sdom
, 
csched_dom
, 
aùive_sdom_–em
);

1647 
	`BUG_ON
Ğ
	`is_idË_domaš
(
sdom
->
dom
) );

1648 
	`BUG_ON
Ğ
sdom
->
aùive_vıu_couÁ
 == 0 );

1649 
	`BUG_ON
Ğ
sdom
->
weight
 == 0 );

1650 
	`BUG_ON
Ğ(
sdom
->
weight
 * sdom->
aùive_vıu_couÁ
è> 
weight_Ëá
 );

1652 
weight_Ëá
 -ğĞ
sdom
->
weight
 * sdom->
aùive_vıu_couÁ
 );

1662 
üed™_³ak
 = 
sdom
->
aùive_vıu_couÁ
 * 
CSCHED_CREDITS_PER_ACCT
;

1663 iàĞ
´v
->
üed™_b®ªû
 < 0 )

1665 
üed™_³ak
 +ğĞĞ-
´v
->
üed™_b®ªû


1666 * 
sdom
->
weight


1667 * 
sdom
->
aùive_vıu_couÁ
) +

1668 (
weight_tÙ®
 - 1)

1669 è/ 
weight_tÙ®
;

1672 iàĞ
sdom
->
ÿp
 != 0U )

1674 
üed™_ÿp
 = ((
sdom
->
ÿp
 * 
CSCHED_CREDITS_PER_ACCT
) + 99) / 100;

1675 iàĞ
üed™_ÿp
 < 
üed™_³ak
 )

1676 
üed™_³ak
 = 
üed™_ÿp
;

1679 
üed™_ÿp
 = ( c»d™_ÿ°+ ( 
sdom
->
aùive_vıu_couÁ
 - 1 )

1680 è/ 
sdom
->
aùive_vıu_couÁ
;

1683 
üed™_çœ
 = ( ( 
üed™_tÙ®


1684 * 
sdom
->
weight


1685 * 
sdom
->
aùive_vıu_couÁ
 )

1686 + (
weight_tÙ®
 - 1)

1687 è/ 
weight_tÙ®
;

1689 iàĞ
üed™_çœ
 < 
üed™_³ak
 )

1691 
üed™_xŒa
 = 1;

1695 iàĞ
weight_Ëá
 != 0U )

1698 
üed™_tÙ®
 +ğĞĞĞ
üed™_çœ
 - 
üed™_³ak


1699 è* 
weight_tÙ®


1700 è+ ( 
weight_Ëá
 - 1 )

1701 è/ 
weight_Ëá
;

1704 iàĞ
üed™_xŒa
 )

1711 
	`CSCHED_STAT_CRANK
(
acù_»Üd”
);

1712 
	`li¡_d–
(&
sdom
->
aùive_sdom_–em
);

1713 
	`li¡_add
(&
sdom
->
aùive_sdom_–em
, &
´v
->
aùive_sdom
);

1716 
üed™_çœ
 = 
üed™_³ak
;

1720 
üed™_çœ
 = ( c»d™_çœ + ( 
sdom
->
aùive_vıu_couÁ
 - 1 )

1721 è/ 
sdom
->
aùive_vıu_couÁ
;

1723 #ifdeà
HETERO_VISOR


1724 if(
h‘”o_visÜ_aùive
){

1725 
ç¡_vıu_couÁ
 = 
sdom
->fast_vcpu_count;

1726 
¦ow_vıu_couÁ
 = 
sdom
->
vıu_couÁ
 - 
ç¡_vıu_couÁ
;

1728 iàĞ
sdom
->
sÿp
 !ğ0U && 
¦ow_vıu_couÁ
 > 0) {

1729 
süed™_ÿp
 = ((
sdom
->
sÿp
 * 
CSCHED_CREDITS_PER_ACCT
) + 99) / 100;

1730 
süed™_çœ
 = ( 
süed™_ÿp
 + ( 
¦ow_vıu_couÁ
 - 1 )

1731 è/ 
¦ow_vıu_couÁ
;

1732 
süed™_ÿp
 = ( süed™_ÿ°+ ( 
¦ow_vıu_couÁ
 - 1 )

1733 è/ 
¦ow_vıu_couÁ
;

1736 
süed™_ÿp
 = 0;

1737 
süed™_çœ
 = 0;

1739 iàĞ
sdom
->
fÿp
 !ğ0U && 
ç¡_vıu_couÁ
 > 0) {

1740 
füed™_ÿp
 = ((
sdom
->
fÿp
 * 
CSCHED_CREDITS_PER_ACCT
) + 99) / 100;

1741 
füed™_çœ
 = ( 
füed™_ÿp
 + ( 
ç¡_vıu_couÁ
 - 1 )

1742 è/ 
ç¡_vıu_couÁ
;

1743 
füed™_ÿp
 = ( füed™_ÿ°+ ( 
ç¡_vıu_couÁ
 - 1 )

1744 è/ 
ç¡_vıu_couÁ
;

1747 
füed™_ÿp
 = 0;

1748 
füed™_çœ
 = 0;

1751 if(
h‘”o_debug_Ëv–
 >= 2)

1752 
	`´štk
("%lu [domaš_acù]: %d %d %d\n",
my£c
,
sdom
->
dom
->
domaš_id
,
süed™_çœ
,
füed™_çœ
);

1756 
	`li¡_fÜ_—ch_§ã
Ğ
™”_vıu
, 
Ãxt_vıu
, &
sdom
->
aùive_vıu
 )

1758 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
, 
aùive_vıu_–em
);

1759 
	`BUG_ON
Ğ
sdom
 !ğ
svc
->sdom );

1762 
	`©omic_add
(
üed™_çœ
, &
svc
->
üed™
);

1763 
üed™
 = 
	`©omic_»ad
(&
svc
->credit);

1765 #ifdeà
HETERO_VISOR


1766 if(
h‘”o_visÜ_aùive
 && 
sdom
->
dom
->
domaš_id
 > 0){

1768 if(
svc
->
cÜe_ty³
 =ğ
SMALL
 && 
süed™_ÿp
 > 0 ){

1769 
	`©omic_add
(
süed™_çœ
, &
svc
->
süed™
);

1770 
süed™
 = 
	`©omic_»ad
(&
svc
->scredit);

1771 if(
süed™
 < 0)

1773 
svc
->
´i
 = 
CSCHED_PRI_TS_OVER
;

1776 iàĞ
sdom
->
sÿp
 != 0U &&

1777 
süed™
 < -
süed™_ÿp
 &&

1778 !(
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
) )

1780 
	`CSCHED_STAT_CRANK
(
vıu_·rk
);

1781 
	`vıu_·u£_nosync
(
svc
->
vıu
);

1782 
svc
->
æags
 |ğ
CSCHED_FLAG_VCPU_PARKED
;

1783 if(
h‘”o_debug_Ëv–
 >= 2)

1784 
	`´štk
("%lu Pausšg SML vıu id:%d %d c­:%d %d\n",
my£c
,
sdom
->
dom
->
domaš_id
,
svc
->
vıu
->
vıu_id
,
süed™
,
füed™
);

1788 iàĞ
süed™
 < -
CSCHED_CREDITS_PER_TSLICE
 )

1790 
	`CSCHED_STAT_CRANK
(
acù_mš_üed™
);

1791 
süed™
 = -
CSCHED_CREDITS_PER_TSLICE
;

1792 
	`©omic_£t
(&
svc
->
süed™
, scredit);

1797 
svc
->
´i
 = 
CSCHED_PRI_TS_UNDER
;

1800 iàĞ
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
)

1807 
	`CSCHED_STAT_CRANK
(
vıu_uÅ¬k
);

1808 
	`vıu_uÅau£
(
svc
->
vıu
);

1809 
svc
->
æags
 &ğ~
CSCHED_FLAG_VCPU_PARKED
;

1810 if(
h‘”o_debug_Ëv–
 >= 2)

1811 
	`´štk
("%lu UÅausšg SML vıu id:%d %d c­:%d %d\n",
my£c
,
sdom
->
dom
->
domaš_id
,
svc
->
vıu
->
vıu_id
,
süed™
,
füed™
);

1815 iàĞ
süed™
 > 
CSCHED_CREDITS_PER_TSLICE
 )

1817 
	`__csched_vıu_acù_¡İ_locked
(
´v
, 
svc
);

1820 
süed™
 /= 2;

1821 
	`©omic_£t
(&
svc
->
süed™
, scredit);

1826 if(
svc
->
cÜe_ty³
 =ğ
BIG
 && 
füed™_ÿp
 > 0 ){

1827 
	`©omic_add
(
füed™_çœ
, &
svc
->
füed™
);

1828 
füed™
 = 
	`©omic_»ad
(&
svc
->fcredit);

1829 if(
füed™
 < 0)

1831 
svc
->
´i
 = 
CSCHED_PRI_TS_OVER
;

1834 iàĞ
sdom
->
fÿp
 != 0U &&

1835 
füed™
 < -
füed™_ÿp
 &&

1836 !(
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
) )

1838 
	`CSCHED_STAT_CRANK
(
vıu_·rk
);

1839 
	`vıu_·u£_nosync
(
svc
->
vıu
);

1840 
svc
->
æags
 |ğ
CSCHED_FLAG_VCPU_PARKED
;

1841 if(
h‘”o_debug_Ëv–
 >= 2)

1842 
	`´štk
("%lu Pausšg BIG vıu id:%d %d c­:%d %d\n",
my£c
,
sdom
->
dom
->
domaš_id
,
svc
->
vıu
->
vıu_id
,
süed™
,
füed™
);

1846 iàĞ
füed™
 < -
CSCHED_CREDITS_PER_TSLICE
 )

1848 
	`CSCHED_STAT_CRANK
(
acù_mš_üed™
);

1849 
füed™
 = -
CSCHED_CREDITS_PER_TSLICE
;

1850 
	`©omic_£t
(&
svc
->
füed™
, fcredit);

1855 
svc
->
´i
 = 
CSCHED_PRI_TS_UNDER
;

1858 iàĞ
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
)

1865 
	`CSCHED_STAT_CRANK
(
vıu_uÅ¬k
);

1866 
	`vıu_uÅau£
(
svc
->
vıu
);

1867 
svc
->
æags
 &ğ~
CSCHED_FLAG_VCPU_PARKED
;

1868 if(
h‘”o_debug_Ëv–
 >= 2)

1869 
	`´štk
("%lu UÅausšg BIG vıu id:%d %d c­:%d %d\n",
my£c
,
sdom
->
dom
->
domaš_id
,
svc
->
vıu
->
vıu_id
,
süed™
,
füed™
);

1873 iàĞ
füed™
 > 
CSCHED_CREDITS_PER_TSLICE
 )

1875 
	`__csched_vıu_acù_¡İ_locked
(
´v
, 
svc
);

1878 
füed™
 /= 2;

1879 
	`©omic_£t
(&
svc
->
füed™
, fcredit);

1892 iàĞ
üed™
 < 0 )

1894 
svc
->
´i
 = 
CSCHED_PRI_TS_OVER
;

1897 iàĞ
sdom
->
ÿp
 != 0U &&

1898 
üed™
 < -
üed™_ÿp
 &&

1899 !(
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
) )

1901 
	`CSCHED_STAT_CRANK
(
vıu_·rk
);

1902 
	`vıu_·u£_nosync
(
svc
->
vıu
);

1903 
svc
->
æags
 |ğ
CSCHED_FLAG_VCPU_PARKED
;

1907 iàĞ
üed™
 < -
CSCHED_CREDITS_PER_TSLICE
 )

1909 
	`CSCHED_STAT_CRANK
(
acù_mš_üed™
);

1910 
üed™
 = -
CSCHED_CREDITS_PER_TSLICE
;

1911 
	`©omic_£t
(&
svc
->
üed™
, credit);

1916 
svc
->
´i
 = 
CSCHED_PRI_TS_UNDER
;

1919 iàĞ
svc
->
æags
 & 
CSCHED_FLAG_VCPU_PARKED
)

1926 
	`CSCHED_STAT_CRANK
(
vıu_uÅ¬k
);

1927 
	`vıu_uÅau£
(
svc
->
vıu
);

1928 
svc
->
æags
 &ğ~
CSCHED_FLAG_VCPU_PARKED
;

1932 iàĞ
üed™
 > 
CSCHED_CREDITS_PER_TSLICE
 )

1934 
	`__csched_vıu_acù_¡İ_locked
(
´v
, 
svc
);

1937 
üed™
 /= 2;

1938 
	`©omic_£t
(&
svc
->
üed™
, credit);

1942 #ifdeà
HETERO_VISOR


1945 
	`CSCHED_VCPU_STAT_SET
(
svc
, 
üed™_Ï¡
, 
üed™
);

1946 
	`CSCHED_VCPU_STAT_SET
(
svc
, 
üed™_šü
, 
üed™_çœ
);

1947 
üed™_b®ªû
 +ğ
üed™
;

1951 
´v
->
üed™_b®ªû
 = credit_balance;

1953 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1956 
´v
->
runq_sÜt
++;

1958 
out
:

1959 
	`£t_tim”
Ğ&
´v
->
ma¡”_tick”
, 
	`NOW
() +

1960 
	`MILLISECS
(
CSCHED_MSECS_PER_TICK
è* 
CSCHED_TICKS_PER_ACCT
 );

1963 #ifdeà
ENABLE_PCPU_STAT


1964 
	`pıu_¡©
()

1966 
csched_pıu
 *
¥c
;

1967 
s_time_t
 
t
;

1968 
ıu
;

1969 
	`my´štk
("[ ");

1970 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

1973 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

1974 
t
 = 
¥c
->
sched_time
;

1975 
¥c
->
sched_time
 = 0;

1976 
	`´štk
("%Îd ", 
t
/1000000ULL);

1978 
	`´štk
("ms]\n");

1981 
	`pıu_¡©
() {}

1984 #ifdeà
ENABLE_BINPACKING


1986 
	`¡¿‹gy_pošt
(
s_time_t
 
now
, 
num
)

1988 
s_time_t
 
cosched
 = 
	`this_ıu
(
cosched_æagtime
);

1989 ià(!
cosched
)

1991 ià(!
mši_aùiv©ed
) {

1992 
	`ş—r_æagtime
();

1995 
s_time_t
 
diff
 = 
now
 - 
cosched
;

1996 ià(
diff
 > 
	`MILLISECS
(100)) {

1998 
diff
 = 1;

2001 ià(
num
 == 1)

2007 
	`ş—r_æagtime
()

2009 #ifdeà
DEBUG_WARN


2010 ià(
	`this_ıu
(
cosched_æagtime
) == 0)

2011 
	`my´štk
("WARN!‡lready zero\n");

2013 
	`this_ıu
(
cosched_æagtime
) = 0;

2017 
	`csched_tick
(*
_ıu
)

2019 
ıu
 = ()
_ıu
;

2020 
csched_pıu
 *
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

2021 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
	`³r_ıu
(
scheduËr
, 
ıu
));

2023 
¥c
->
tick
++;

2028 iàĞ!
	`is_idË_vıu
(
cu¼’t
) )

2029 
	`csched_vıu_acù
(
´v
, 
ıu
);

2031 
	#MY_MASTER
 1

	)

2033 iàĞ(
¥c
->
tick
 % 100) == 0 ) {

2034 #ifdeà
ENABLE_PCPU_STAT


2035 
s_time_t
 
now
 = 
	`NOW
();

2036 
s_time_t
 
·s£d
 = 
now
 - 
¥c
->
¡¬t_time
;

2037 
¥c
->
¡¬t_time
 = 
now
;

2038 iàĞ!
	`is_idË_vıu
(
cu¼’t
) ) {

2039 
¥c
->
sched_time
 +ğ
·s£d
;

2041 if(
h‘”o_visÜ_mem
){

2042 ià(
MY_MASTER
 =ğ
ıu
) {

2043 
	`pıu_¡©
();

2047 if(
h‘”o_visÜ_mem
){

2048 ià(
MY_MASTER
 =ğ
ıu
) {

2049 
	`h—¹b—t
();

2055 #ifdeà
ENABLE_PGD


2056 iàĞ(
MY_MASTER
 =ğ
ıu
è&& 
mši_aùiv©ed
 ) {

2057 
	`©omic_šc
(&
mši_couÁ
);

2058 
	`©omic_šc
(&
mši_¶aû
[9]);

2059 iàĞ(
¥c
->
tick
 % 100) == 0 ) {

2064 #ifdeà
ENABLE_HOT_PAGES


2065 iàĞ(
¥c
->
tick
 % 10 ) == 0 ) {

2066 
s_time_t
 
now
 = 
	`NOW
();

2067 
	`shršk_hÙ_·ges
(
now
);

2070 #ifdeà
ENABLE_CACHE_BALANCE


2071 iàĞ(
¥c
->
tick
 % 10 ) == 0 ) {

2072 
	`do_b®ªû
(0);

2075 #ifdeà
ENABLE_BINPACKING_PRINTX


2076 iàĞ(
¥c
->
tick
 % 3 ) == 0 ) {

2077 
	`´štx_pıu
(
	`NOW
());

2080 
	`©omic_dec
(&
mši_¶aû
[9]);

2081 
	`©omic_dec
(&
mši_couÁ
);

2084 #ifdeà
ENABLE_CACHEMAN1


2085 ià(
mši_aùiv©ed
 && (
¥c
->
tick
 % 10 ) == 0 ) {

2090 #ifdeà
ENABLE_CLOCK


2091 ià(
mši_aùiv©ed
 && 
cu¼’t
->
cu¼’t_pgd
) {

2092 
	`©omic_šc
(&
mši_couÁ
);

2093 
	`©omic_šc
(&
mši_¶aû
[10]);

2094 
	`do_şock
(
CLOCK_EVENT_TIMER
, 
cu¼’t
->
cu¼’t_pgd
, 
	`NOW
());

2095 
	`©omic_dec
(&
mši_¶aû
[10]);

2096 
	`©omic_dec
(&
mši_couÁ
);

2100 #ifdeà
ENABLE_BINPACKING


2102 ià(
	`¡¿‹gy_pošt
(
	`NOW
(), 2))

2103 
	`ş—r_æagtime
();

2106 #ifdeà
ENABLE_PER_CACHE_PT


2107 ià(
mši_aùiv©ed
 && 
cu¼’t
->
cu¼’t_pgd
) {

2108 
	`MYASSERT
(
	`ü3_is_shadow
(0));

2122 
	`csched_runq_sÜt
(
´v
, 
ıu
);

2124 
	`£t_tim”
(&
¥c
->
tick”
, 
	`NOW
(è+ 
	`MILLISECS
(
CSCHED_MSECS_PER_TICK
));

2127 
csched_vıu
 *

2128 
	`csched_runq_¡—l
(
³”_ıu
, 
ıu
, 
´i
)

2130 cÚ¡ 
csched_pıu
 * cÚ¡ 
³”_pıu
 = 
	`CSCHED_PCPU
(
³”_ıu
);

2131 cÚ¡ 
vıu
 * cÚ¡ 
³”_vıu
 = 
	`³r_ıu
(
scheduË_d©a
, 
³”_ıu
).
cu¼
;

2132 
csched_vıu
 *
¥“r
;

2133 
li¡_h—d
 *
™”
;

2134 
vıu
 *
vc
;

2136 ià(
´oc2štÿche
[
³”_ıu
] !ğ´oc2štÿche[
ıu
]) {

2138  
NULL
;

2145 iàĞ
³”_pıu
 !ğ
NULL
 && !
	`is_idË_vıu
(
³”_vıu
) )

2147 
	`li¡_fÜ_—ch
Ğ
™”
, &
³”_pıu
->
runq
 )

2149 
¥“r
 = 
	`__runq_–em
(
™”
);

2155 iàĞ
¥“r
->
´i
 <=…ri )

2159 
vc
 = 
¥“r
->
vıu
;

2160 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

2162 ià(
	`__csched_vıu_is_mig¿‹abË
(
vc
, 
ıu
))

2163 #ifdeà
ENABLE_PAGE_TOUCH


2166 Ğ!
vc
->
run_couÁ
 || 
´oc2štÿche
[
ıu
]==vc->
run_ÿche
 )

2171 
	`CSCHED_VCPU_STAT_CRANK
(
¥“r
, 
mig¿‹_q
);

2172 
	`CSCHED_STAT_CRANK
(
mig¿‹_queued
);

2173 
	`WARN_ON
(
vc
->
is_urg’t
);

2174 
	`__runq_»move
(
¥“r
);

2175 
vc
->
´oûssÜ
 = 
ıu
;

2176  
¥“r
;

2181 
	`CSCHED_STAT_CRANK
(
¡—l_³”_idË
);

2182  
NULL
;

2185 
csched_vıu
 *

2186 
	`csched_lßd_b®ªû
(
csched_´iv©e
 *
´v
, 
ıu
,

2187 
csched_vıu
 *
¢ext
, 
boŞ_t
 *
¡Ş’
)

2189 
csched_vıu
 *
¥“r
;

2190 
ıumask_t
 
wÜk”s
;

2191 
ıumask_t
 *
Úlše
;

2192 
³”_ıu
;

2194 
	`BUG_ON
Ğ
ıu
 !ğ
¢ext
->
vıu
->
´oûssÜ
 );

2195 
Úlše
 = 
	`CSCHED_CPUONLINE
(
	`³r_ıu
(
ıupoŞ
, 
ıu
));

2198 iàĞ
	`uÆik–y
(!
	`ıu_is£t
(
ıu
, *
Úlše
)) )

2199 
out
;

2201 iàĞ
¢ext
->
´i
 =ğ
CSCHED_PRI_IDLE
 )

2202 
	`CSCHED_STAT_CRANK
(
lßd_b®ªû_idË
);

2203 iàĞ
¢ext
->
´i
 =ğ
CSCHED_PRI_TS_OVER
 )

2204 
	`CSCHED_STAT_CRANK
(
lßd_b®ªû_ov”
);

2206 
	`CSCHED_STAT_CRANK
(
lßd_b®ªû_Ùh”
);

2212 
	`ıus_ªdnÙ
(
wÜk”s
, *
Úlše
, 
´v
->
idËrs
);

2213 
	`ıu_ş—r
(
ıu
, 
wÜk”s
);

2214 
³”_ıu
 = 
ıu
;

2216  !
	`ıus_em±y
(
wÜk”s
) )

2218 
³”_ıu
 = 
	`cyşe_ıu
Õ“r_ıu, 
wÜk”s
);

2219 
	`ıu_ş—r
(
³”_ıu
, 
wÜk”s
);

2228 iàĞ!
	`pıu_scheduË_Œylock
(
³”_ıu
) )

2230 
	`CSCHED_STAT_CRANK
(
¡—l_Œylock_çed
);

2237 
¥“r
 = 
	`ıu_is£t
(
³”_ıu
, *
Úlše
) ?

2238 
	`csched_runq_¡—l
(
³”_ıu
, 
ıu
, 
¢ext
->
´i
è: 
NULL
;

2239 
	`pıu_scheduË_uÆock
(
³”_ıu
);

2240 iàĞ
¥“r
 !ğ
NULL
 )

2242 *
¡Ş’
 = 1;

2243  
¥“r
;

2247 
out
:

2249 
	`__runq_»move
(
¢ext
);

2250  
¢ext
;

2255 
	#MYARRAY_SIZE
 32

	)

2256 
	`´št_pıu
(
s_time_t
 
now
)

2258 
¬¿y
[
MYARRAY_SIZE
];

2259 
couÁ
, 
i
, 
aùive
;

2260 
ıu
;

2261 
csched_vıu
 *
svc
;

2262 
i
=0;i<
MAX_CACHE
;i++) {

2263 
¬¿y
[
i
] = 0;

2265 
¬¿y
[
i
++] = 
now
/1000000ULL;

2266 
couÁ
 = 
i
;

2267 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

2270 
svc
 = 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
);

2271 ià(!
svc
) {

2272 
	`´štk
("svc == NULL??\n");

2274 #ifdeà
ENABLE_PGD


2275 ià(
	`is_idË_vıu
(
svc
->
vıu
è|| !svc->vıu->
cu¼’t_pgd
) {

2282 
aùive
 = 0;

2285 
¬¿y
[
´oc2štÿche
[
ıu
]]+=
aùive
;

2289 ià(
couÁ
 >ğ
MYARRAY_SIZE
) {

2290 
	`my·nic
("BUG!!!");

2292 
	`my´štk
("binpacking: ");

2293 
i
=0;i<
couÁ
;i++)

2294 
	`´štk
("%d ", 
¬¿y
[
i
]);

2295 
	`´štk
("\n");

2297 
	`´štx_pıu
(
s_time_t
 
now
)

2299 ià((
TRC_MIN_BINPACKING
 & 
TRC_ALL
è!ğ
TRC_MIN
) {

2302 
¬¿y
[
MYARRAY_SIZE
];

2303 
couÁ
, 
i
, 
aùive
;

2304 
ıu
;

2305 
csched_vıu
 *
svc
;

2306 
i
=0;i<
MAX_CACHE
;i++) {

2307 
¬¿y
[
i
] = 0;

2309 
¬¿y
[
i
++] = 
now
/1000000ULL;

2310 
couÁ
 = 
i
;

2311 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

2314 
svc
 = 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
);

2315 ià(!
svc
) {

2316 
	`´štk
("svc == NULL??\n");

2318 #ifdeà
ENABLE_PGD


2319 ià(
	`is_idË_vıu
(
svc
->
vıu
è|| !svc->vıu->
cu¼’t_pgd
) {

2326 
aùive
 = 0;

2329 
¬¿y
[
´oc2štÿche
[
ıu
]]+=
aùive
;

2333 ià(
couÁ
 >ğ
MYARRAY_SIZE
) {

2334 
	`my·nic
("BUG!!!");

2336 
	`MYXTRACE
(
TRC_MIN_BINPACKING
, 
couÁ
, 
¬¿y
);

2339 #ifdeà
ENABLE_BINPACKING


2340 
cosched_vıu
 *

2341 
	`cosched_sim¶e
(
ıu
, 
csched_vıu
 *
scu¼
, 
aùive
)

2343 cÚ¡ 
csched_pıu
 * cÚ¡ 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

2344 
csched_vıu
 *
svc
, *
svc_ÿndid©e
 = 
NULL
;

2345 
li¡_h—d
 *
™”
;

2346 
diff_ÿndid©e
 = 
INT_MAX
;

2347 
	`BUG_ON
Ğ
ıu
 !ğ
scu¼
->
vıu
->
´oûssÜ
 );

2349 
	`li¡_fÜ_—ch
Ğ
™”
, &
¥c
->
runq
 )

2351 
svc
 = 
	`__runq_–em
(
™”
);

2353 ià(
svc
->
´i
 < 
scu¼
->´˜|| svc->´˜=ğ
CSCHED_PRI_IDLE
 )

2355 ià(
svc
 && svc->
vıu
->
cu¼’t_pgd
 ) {

2356 
diff
 = 
ÿchemª
[
´oc2štÿche
[
ıu
]].
size
/4 - (
aùive
 + 
	`ACTIVE_FRAMES_PGD
(
svc
->
vıu
->
cu¼’t_pgd
, 0));

2357 ià(
diff
 < 0)

2358 
diff
 = -diff;

2359 ià(
diff
 < 
diff_ÿndid©e
) {

2360 
svc_ÿndid©e
 = 
svc
;

2361 
diff_ÿndid©e
 = 
diff
;

2365 ià(
svc_ÿndid©e
) {

2366 
	`´štk
("diffc:%d ", 
diff_ÿndid©e
);

2367 
	`__runq_»move
(
svc_ÿndid©e
);

2368 iàĞ
svc_ÿndid©e
->
´i
 =ğ
CSCHED_PRI_IDLE
 )

2369 
	`my·nic
("_simple!! idle ??\n");

2371 
	`´štk
("Nodiffc ");

2373  
svc_ÿndid©e
;

2378 
cosched_vıu
 *

2379 
	`cosched_runq_¡—l
(
³”_ıu
, 
ıu
, 
´i
, 
aùive
, 
rg‘
)

2381 cÚ¡ 
csched_pıu
 * cÚ¡ 
³”_pıu
 = 
	`CSCHED_PCPU
(
³”_ıu
);

2382 cÚ¡ 
vıu
 * cÚ¡ 
³”_vıu
 = 
	`³r_ıu
(
scheduË_d©a
, 
³”_ıu
).
cu¼
;

2383 
csched_vıu
 *
¥“r
 = 
NULL
;

2384 
li¡_h—d
 *
™”
;

2385 
vıu
 *
vc
;

2391 iàĞ
³”_pıu
 !ğ
NULL
 && !
	`is_idË_vıu
(
³”_vıu
) )

2393 
	`li¡_fÜ_—ch
Ğ
™”
, &
³”_pıu
->
runq
 )

2395 
¥“r
 = 
	`__runq_–em
(
™”
);

2396 #ifdeà
VERBOSE_BINPACKING


2397 
	`my´štk
("³”' ıu:%d…ri:%d\n", 
³”_ıu
, 
¥“r
->
´i
);

2399 iàĞ
¥“r
->
´i
 <…r˜|| s³”->´˜=ğ
CSCHED_PRI_IDLE
 )

2402 
vc
 = 
¥“r
->
vıu
;

2403 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

2405 ià(
	`__csched_vıu_is_mig¿‹abË
(
vc
, 
ıu
è&& vc->
cu¼’t_pgd
)

2407 
diff
 = 
ÿchemª
[
´oc2štÿche
[
ıu
]].
size
/4 - (
aùive
 + 
	`ACTIVE_FRAMES_PGD
(
vc
->
cu¼’t_pgd
, 0));

2408 ià(
diff
 < 0)

2409 
diff
 = -diff;

2410 ià(
diff
 <ğ
rg‘
) {

2411 
	`__runq_»move
(
¥“r
);

2412 
vc
->
´oûssÜ
 = 
ıu
;

2414  
¥“r
;

2419  
NULL
;

2421 
csched_vıu
 *

2422 
	`cosched_lßd_b®ªû
(
ıu
, 
csched_vıu
 *
scu¼
, 
aùive
)

2424 
csched_vıu
 *
¥“r
;

2425 
ıumask_t
 
wÜk”s
;

2426 
³”_ıu
, 
³”_ıu_ÿndid©e
;

2428 
	`BUG_ON
Ğ
ıu
 !ğ
scu¼
->
vıu
->
´oûssÜ
 );

2433 
	`ıus_ªdnÙ
(
wÜk”s
, 
ıu_Úlše_m­
, 
csched_´iv
.
idËrs
);

2434 
³”_ıu
 = 
ıu
;

2436  !
	`ıus_em±y
(
wÜk”s
) )

2438 
³”_ıu
 = 
	`__cyşe_ıu
Õ“r_ıu, &
wÜk”s
);

2439 
	`ıu_ş—r
(
³”_ıu
, 
wÜk”s
);

2448 iàĞ
³”_ıu
!=
ıu
 && !
	`¥š_Œylock
(&
	`³r_ıu
(
scheduË_d©a
,…“r_ıu).
scheduË_lock
) )

2450 #ifdeà
VERBOSE_BINPACKING


2451 
	`my´štk
("me:%d…“r:%d (skè\n", 
ıu
, 
³”_ıu
);

2456 #ifdeà
VERBOSE_BINPACKING


2457 
	`my´štk
("me:%d…“r:%d \n", 
ıu
, 
³”_ıu
);

2462 
¥“r
 = 
	`cosched_runq_¡—l
(
³”_ıu
, 
ıu
, 
scu¼
->
´i
, 
aùive
, 
ÿchemª
[
´oc2štÿche
[ıu]].
size
/4/8);

2463 ià(
³”_ıu
!=
ıu
)

2464 
	`¥š_uÆock
(&
	`³r_ıu
(
scheduË_d©a
, 
³”_ıu
).
scheduË_lock
);

2465 ià(
¥“r
)

2466  
¥“r
;

2468  
NULL
;

2470 
csched_vıu
 *

2471 
	`do_cosched
(
ıu
, 
csched_vıu
 *
scu¼
)

2474 
i
;

2475 
aùive
 = 0;

2476 
·ge_dœ
 *
ex³ùed
;

2477 
sched_vıu
 *
¢ext
;

2479 
ıumask_t
 
®»ady
, 
check
;

2480 
	`ıus_ş—r
(
®»ady
);

2481 
	`fÜ_—ch_ıu_mask
(
i
, 
ÿche2ıumask
[
´oc2štÿche
[
ıu
]]) {

2482 ià(
	`³r_ıu
(
cosched_æagtime
, 
i
))

2484 
	`ıu_£t
(
i
, 
®»ady
);

2485 
ex³ùed
 = 
	`³r_ıu
(
cosched_ex³ùed
,
i
);

2486 ià(
ex³ùed
) {

2488 
aùive
 +ğ
	`ACTIVE_FRAMES_PGD
Ğ
ex³ùed
 , 0 );

2490 
	`my´štk
("expected==0 ?\n");

2493 #ifdeà
VERBOSE_BINPACKING


2494 
	`my´štk
("®»ady mask0x%x,‡ùive:%d\n", 
®»ady
.
b™s
[0], 
aùive
);

2496 
¢ext
 = 
	`cosched_lßd_b®ªû
(
ıu
, 
scu¼
, 
aùive
);

2498 
	`ıus_ş—r
(
check
);

2499 
	`fÜ_—ch_ıu_mask
(
i
, 
ÿche2ıumask
[
´oc2štÿche
[
ıu
]]) {

2500 ià(!
	`³r_ıu
(
cosched_æagtime
, 
i
)) {

2501 
	`ıu_£t
(
i
, 
check
);

2504 ià(!
	`ıus_equ®
(
check
, 
®»ady
))

2505 
	`my´štk
("TODO: check !=‡lready\n");

2506  
¢ext
;

2509 #ifdeà
ENABLE_MEASURE_UNBALANCE


2510 
	`would_be_idË
(
äom
 , 
to
)

2512 
	`MYASSERT
(
äom
 !ğ
to
);

2513  (
	`©omic_»ad
(&
ÿchemª
[
to
].
vıu_couÁ
è>ğ
CPU_PER_CACHE
 &&‡tomic_»ad(&ÿchemª[
äom
].vcpu_count) <= CPU_PER_CACHE );

2516 
	`has_cÜe_unb®ªû
(*
f
, *
t
)

2519 
c1
, 
c2
, 
v1
, 
v2
;

2520 
c1
 = 0;

2521 
c2
 = 1;

2522 iàĞ(
v1
=
	`©omic_»ad
(&
ÿchemª
[
c1
].
vıu_couÁ
)è> 
CPU_PER_CACHE
 && (
v2
÷tomic_»ad(&ÿchemª[
c2
].vcpu_count)) < CPU_PER_CACHE) {

2523 *
f
 = 
c1
;

2524 *
t
 = 
c2
;

2528 
c1
 = 1;

2529 
c2
 = 0;

2530 iàĞ(
v1
=
	`©omic_»ad
(&
ÿchemª
[
c1
].
vıu_couÁ
)è> 
CPU_PER_CACHE
 && (
v2
÷tomic_»ad(&ÿchemª[
c2
].vcpu_count)) < CPU_PER_CACHE) {

2531 *
f
 = 
c1
;

2532 *
t
 = 
c2
;

2545 
sk_¦iû


2546 
	`csched_scheduË
(

2547 cÚ¡ 
scheduËr
 *
İs
, 
s_time_t
 
now
, 
boŞ_t
 
skËt_wÜk_scheduËd
)

2549 cÚ¡ 
ıu
 = 
	`smp_´oûssÜ_id
();

2550 
li¡_h—d
 * cÚ¡ 
runq
 = 
	`RUNQ
(
ıu
);

2551 
csched_vıu
 * cÚ¡ 
scu¼
 = 
	`CSCHED_VCPU
(
cu¼’t
);

2552 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

2553 
csched_vıu
 *
¢ext
;

2554 
sk_¦iû
 
»t
;

2556 #ifdeà
ENABLE_PCPU_STAT


2557 
csched_pıu
 * cÚ¡ 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

2558 
s_time_t
 
·s£d
 = 
now
 - 
¥c
->
¡¬t_time
;

2559 
¥c
->
¡¬t_time
 = 
now
;

2560 iàĞ!
	`is_idË_vıu
(
scu¼
->
vıu
) ) {

2561 
¥c
->
sched_time
 +ğ
·s£d
;

2566 
	`CSCHED_STAT_CRANK
(
scheduË
);

2567 
	`CSCHED_VCPU_CHECK
(
cu¼’t
);

2569 iàĞ!
	`is_idË_vıu
(
scu¼
->
vıu
) )

2572 
	`buº_üed™s
(
scu¼
, 
now
);

2573 
scu¼
->
¡¬t_time
 -ğ
now
;

2578 
scu¼
->
´i
 = 
CSCHED_PRI_IDLE
;

2581 #ifdeà
ENABLE_BINPACKING


2582 
scu¼
->
diff_·s£d
 +ğ
·s£d
 - scu¼->
Ï¡_·s£d
;

2583 
scu¼
->
couÁ_·s£d
++;

2584 
scu¼
->
Ï¡_·s£d
 = 
·s£d
;

2585 
cosched_agaš
:

2587 
is_cosched
 = 
	`¡¿‹gy_pošt
(
now
, 1);

2598 iàĞ
	`vıu_ruÂabË
(
cu¼’t
) )

2599 
	`__runq_š£¹
(
ıu
, 
scu¼
);

2601 
	`BUG_ON
Ğ
	`is_idË_vıu
(
cu¼’t
è|| 
	`li¡_em±y
(
runq
) );

2603 
¢ext
 = 
	`__runq_–em
(
runq
->
Ãxt
);

2604 
»t
.
mig¿‹d
 = 0;

2607 iàĞ
skËt_wÜk_scheduËd
 )

2609 
¢ext
 = 
	`CSCHED_VCPU
(
idË_vıu
[
ıu
]);

2610 
¢ext
->
´i
 = 
CSCHED_PRI_TS_BOOST
;

2616 iàĞ
scu¼
->
æags
 & 
CSCHED_FLAG_VCPU_YIELD
 )

2617 
scu¼
->
æags
 &ğ~(
CSCHED_FLAG_VCPU_YIELD
);

2627 #ifdeà
ENABLE_BINPACKING


2628 ià(!
is_cosched
)

2629 
çÎback
;

2630 
csched_vıu
 *
myÃxt
;

2631 ià(!
mši_aùiv©ed
)

2632 
	`my´štk
("WARN! cosched with‚o‡ctivation\n");

2634 
myÃxt
 = 
	`do_cosched
(
ıu
, 
scu¼
);

2635 ià(
myÃxt
) {

2636 
¢ext
 = 
myÃxt
;

2639 
çÎback
;

2641 
sk_çÎback
;

2642 
çÎback
:

2645 iàĞ
¢ext
->
´i
 > 
CSCHED_PRI_TS_OVER
 )

2646 
	`__runq_»move
(
¢ext
);

2648 
¢ext
 = 
	`csched_lßd_b®ªû
(
´v
, 
ıu
, sÃxt, &
»t
.
mig¿‹d
);

2650 #ifdeà
ENABLE_BINPACKING


2651 
sk_çÎback
:

2652 ià(
is_cosched
) {

2653 
	`this_ıu
(
cosched_ex³ùed
èğ
¢ext
->
vıu
->
cu¼’t_pgd
;

2654 
	`ş—r_æagtime
();

2669 iàĞ
¢ext
->
´i
 =ğ
CSCHED_PRI_IDLE
 )

2671 iàĞ!
	`ıu_is£t
(
ıu
, 
´v
->
idËrs
) )

2672 
	`ıu_£t
(
ıu
, 
´v
->
idËrs
);

2674 iàĞ
	`ıu_is£t
(
ıu
, 
´v
->
idËrs
) )

2676 
	`ıu_ş—r
(
ıu
, 
´v
->
idËrs
);

2679 iàĞ!
	`is_idË_vıu
(
¢ext
->
vıu
) )

2680 
¢ext
->
¡¬t_time
 +ğ
now
;

2682 #ifdeà
HETERO_VISOR


2683 if(
h‘”o_visÜ_aùive
)

2684 
	`upd©e_³rf_ùrs
(
scu¼
);

2689 
»t
.
time
 = (
	`is_idË_vıu
(
¢ext
->
vıu
) ?

2690 -1 : 
	`MILLISECS
(
CSCHED_MSECS_PER_TSLICE
));

2691 
»t
.
sk
 = 
¢ext
->
vıu
;

2693 #ifdeà
ENABLE_BINPACKING


2695 ià(
¢ext
->
Ï¡_·s£d
 > 
	`MILLISECS
(5è&& !
is_cosched
 && sÃxt->
´i
 !ğ
CSCHED_PRI_IDLE
 && 
mši_aùiv©ed
) {

2696 ià(
	`this_ıu
(
cosched_æagtime
)) {

2697 
	`´štk
("again„eceived cosched signal?\n");

2700 
	`this_ıu
(
cosched_ex³ùed
èğ
»t
.
sk
->
cu¼’t_pgd
;

2701 #ifdeà
DEBUG_WARN


2702 ià(!
»t
.
sk
->
cu¼’t_pgd
)

2703 
	`´štk
("null-expected ? ");

2705 
¢ext
->
couÁ_cosched
++;

2706 
ıumask_t
 
³”s
 = 
ÿche2ıumask
[
´oc2štÿche
[
ıu
]];

2707 
	`ıu_ş—r
(
ıu
, 
³”s
);

2708 
i
;

2709 #ifdeà
VERBOSE_BINPACKING


2710 
	`my´štk
("£nd coschedØmask0x%x\n", 
³”s
.
b™s
[0]);

2712 
	`fÜ_—ch_ıu_mask
(
i
, 
³”s
) {

2713 
	`³r_ıu
(
cosched_æagtime
, 
i
èğ
now
;

2715 
	`ıumask_¿i£_soáœq
(
³”s
, 
SCHEDULE_SOFTIRQ
);

2718 #ifdeà
ENABLE_CLOCK


2719 ià(
mši_aùiv©ed
 && 
»t
.
sk
 !ğ
cu¼’t
) {

2720 
·ge_dœ
 *
pgd
 = 
cu¼’t
->
cu¼’t_pgd
;

2721 
	`©omic_šc
(&
mši_couÁ
);

2722 ià(
pgd
) {

2723 
pgd
->
şock_»sidue
 +ğ
now
 -…gd->
şock_´ev_now
;

2724 
pgd
->
şock_´ev_now
 = 
now
;

2725 
	`do_şock
(
CLOCK_EVENT_SCHEDULE
, 
pgd
, 
now
);

2727 ià(
»t
.
sk
->
cu¼’t_pgd
) {

2728 
»t
.
sk
->
cu¼’t_pgd
->
şock_´ev_now
 = 
now
;

2729 #ifdeà
ENABLE_REGIONING2


2730 
	`»giÚšg_»sume
(
»t
.
sk
->
cu¼’t_pgd
, 
CLOCK_EVENT_SCHEDULE
);

2733 
	`©omic_dec
(&
mši_couÁ
);

2738 ià(
¢ext
->
vıu
->
run_couÁ
) {

2739 
run_ÿche
 = 
¢ext
->
vıu
->run_cache;

2740 
¢ext
->
vıu
->
run_couÁ
--;

2741 ià(!
¢ext
->
vıu
->
run_couÁ
)

2742 
¢ext
->
vıu
->
run_ÿche
 = -1;

2743 ià(
run_ÿche
 =ğ
´oc2štÿche
[
ıu
]) {

2744 #ifdeà
VERBOSE_USCHED_DETAIL


2745 ià(
usched_´št
-- > 0)

2746 
	`my´štk
("aùu®ly scheduËd oÀ%d$%d (%d„emaš)\n", 
ıu
, 
run_ÿche
, 
¢ext
->
vıu
->
run_couÁ
);

2749 
	`my´štk
("WARN!!„un_ÿche:%d buˆscheduËdØıu:%d$%d)\n", 
run_ÿche
, 
ıu
, 
´oc2štÿche
[cpu]);

2750 
	`my·nic
("usched failed?\n");

2754 
	`CSCHED_VCPU_CHECK
(
»t
.
sk
);

2755  
»t
;

2759 
	`csched_dump_vıu
(
csched_vıu
 *
svc
)

2761 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

2763 
	`´štk
("[%i.%i]…ri=%i flags=%x cpu=%i",

2764 
svc
->
vıu
->
domaš
->
domaš_id
,

2765 
svc
->
vıu
->
vıu_id
,

2766 
svc
->
´i
,

2767 
svc
->
æags
,

2768 
svc
->
vıu
->
´oûssÜ
);

2770 iàĞ
sdom
 )

2772 
	`´štk
(" c»d™=%˜[w=%u]", 
	`©omic_»ad
(&
svc
->
üed™
), 
sdom
->
weight
);

2773 #ifdeà
CSCHED_STATS


2774 
	`´štk
(" (%d+%u) {a/i=%u/%u m=%u+%u}",

2775 
svc
->
¡©s
.
üed™_Ï¡
,

2776 
svc
->
¡©s
.
üed™_šü
,

2777 
svc
->
¡©s
.
¡©e_aùive
,

2778 
svc
->
¡©s
.
¡©e_idË
,

2779 
svc
->
¡©s
.
mig¿‹_q
,

2780 
svc
->
¡©s
.
mig¿‹_r
);

2784 
	`´štk
("\n");

2788 
	`csched_dump_pıu
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

2790 
li¡_h—d
 *
runq
, *
™”
;

2791 
csched_pıu
 *
¥c
;

2792 
csched_vıu
 *
svc
;

2793 
loİ
;

2794 
	#ıu¡r
 
keyhªdËr_sü©ch


	)

2796 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

2797 
runq
 = &
¥c
->runq;

2799 
	`ıumask_sú´štf
(
ıu¡r
, (ıu¡r), 
	`³r_ıu
(
ıu_siblšg_m­
, 
ıu
));

2800 
	`´štk
(" sÜt=%d, siblšg=%s, ", 
¥c
->
runq_sÜt_Ï¡
, 
ıu¡r
);

2801 
	`ıumask_sú´štf
(
ıu¡r
, (ıu¡r), 
	`³r_ıu
(
ıu_cÜe_m­
, 
ıu
));

2802 
	`´štk
("cÜe=%s\n", 
ıu¡r
);

2805 
svc
 = 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
);

2806 iàĞ
svc
 )

2808 
	`´štk
("\trun: ");

2809 
	`csched_dump_vıu
(
svc
);

2812 
loİ
 = 0;

2813 
	`li¡_fÜ_—ch
Ğ
™”
, 
runq
 )

2815 
svc
 = 
	`__runq_–em
(
™”
);

2816 iàĞ
svc
 )

2818 
	`´štk
("\t%3d: ", ++
loİ
);

2819 
	`csched_dump_vıu
(
svc
);

2822 #undeà
ıu¡r


2826 
	`csched_dump
(cÚ¡ 
scheduËr
 *
İs
)

2828 
li¡_h—d
 *
™”_sdom
, *
™”_svc
;

2829 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

2830 
loİ
;

2831 
	#idËrs_buf
 
keyhªdËr_sü©ch


	)

2833 
	`´štk
("info:\n"

2846 
´v
->
nıus
,

2847 
´v
->
ma¡”
,

2848 
´v
->
üed™
,

2849 
´v
->
üed™_b®ªû
,

2850 
´v
->
weight
,

2851 
´v
->
runq_sÜt
,

2852 
CSCHED_DEFAULT_WEIGHT
,

2853 
CSCHED_MSECS_PER_TICK
,

2854 
CSCHED_CREDITS_PER_MSEC
,

2855 
CSCHED_TICKS_PER_TSLICE
,

2856 
CSCHED_TICKS_PER_ACCT
,

2857 
vıu_mig¿tiÚ_d–ay
);

2859 
	`ıumask_sú´štf
(
idËrs_buf
, (idËrs_buf), 
´v
->
idËrs
);

2860 
	`´štk
("idËrs: %s\n", 
idËrs_buf
);

2862 
	`´štk
("active vcpus:\n");

2863 
loİ
 = 0;

2864 
	`li¡_fÜ_—ch
Ğ
™”_sdom
, &
´v
->
aùive_sdom
 )

2866 
csched_dom
 *
sdom
;

2867 
sdom
 = 
	`li¡_’Œy
(
™”_sdom
, 
csched_dom
, 
aùive_sdom_–em
);

2869 
	`li¡_fÜ_—ch
Ğ
™”_svc
, &
sdom
->
aùive_vıu
 )

2871 
csched_vıu
 *
svc
;

2872 
svc
 = 
	`li¡_’Œy
(
™”_svc
, 
csched_vıu
, 
aùive_vıu_–em
);

2874 
	`´štk
("\t%3d: ", ++
loİ
);

2875 
	`csched_dump_vıu
(
svc
);

2878 #undeà
idËrs_buf


2880 #ifdeà
HETERO_VISOR


2882 
	`h‘”o_vıu_li¡
(){

2883 
domaš
 *
d
;

2884 
csched_dom
 *
sdom
;

2885 
vıu
 *
v
;

2886 
csched_vıu
 *
svc
;

2887 
ıumask_t
 
cÜemask
;

2889 
	`fÜ_—ch_domaš
Ğ
d
 )

2891 if(
d
->
domaš_id
 > 0){

2892 
sdom
 = 
	`CSCHED_DOM
(
d
);

2893 
	`INIT_LIST_HEAD
(&
sdom
->
h‘”o_vıu
);

2894 
sdom
->
vıu_couÁ
 = 0;

2895 
	`fÜ_—ch_vıu
(
d
, 
v
){

2896 
svc
 = 
	`CSCHED_VCPU
(
v
);

2897 
	`INIT_LIST_HEAD
(&
svc
->
h‘”o_vıu_–em
);

2898 
	`li¡_add_
(&(
svc
->
h‘”o_vıu_–em
), &
sdom
->
h‘”o_vıu
);

2899 
sdom
->
vıu_couÁ
++;

2900 
cÜemask
 = 
sm®lcÜe_mask
;

2901 
	`h‘”o_vıu_mig¿‹
(
svc
->
vıu
, &
cÜemask
);

2902 
svc
->
cÜe_ty³
 = 
SMALL
;

2904 
sdom
->
h‘”o_sched_dÚe
 = 0;

2910 
	`£tup_h‘”o_cÜes
(){

2911 
csched_pıu
 *
¥c
;

2912 
ıu
 = 0, 
sock‘
 =0, 
i
;

2913 
ıumask_big_buf
[16], 
ıumask_sm®l_buf
[16];

2914 
ušt16_t
 
num_sm®l_cÜes
 = 
num_aùive_ıus
 - 
big_cÜe_couÁ
;

2915 
ušt16_t
 
cÜes_³r_sock‘
 = 
num_aùive_ıus
/
num_sock‘s
;

2916 
ušt16_t
 
big_cÜes_³r_sock‘
 = 
big_cÜe_couÁ
/
num_sock‘s
;

2917 
ušt16_t
 
sm®l_cÜes_³r_sock‘
 = 
cÜes_³r_sock‘
 - 
big_cÜes_³r_sock‘
;

2918 
big_cÜe_couÁ
 = 
big_cÜes_³r_sock‘
 * 
num_sock‘s
;

2920 
	`WARN_ON
(
big_cÜe_couÁ
 < 0);

2923 
TOTAL_FCREDITS
 = 
big_cÜe_couÁ
 * 
HCREDITS_PER_TICK
;

2924 
TOTAL_SCREDITS
 = 
num_sm®l_cÜes
 * 
HCREDITS_PER_TICK
;

2925 
	`ıus_ş—r
(
bigcÜe_mask
);

2926 
	`ıus_ş—r
(
sm®lcÜe_mask
);

2928 
sock‘
=0;sock‘<
num_sock‘s
;socket++){

2929 
i
=0;i<
cÜes_³r_sock‘
;i++)

2931 
ıu
 = 
sock‘
*
cÜes_³r_sock‘
 + 
i
;

2933 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

2935 if(
i
 >ğ
sm®l_cÜes_³r_sock‘
){

2936 
	`³r_ıu
(
cÜe_ty³
,
ıu
èğ
BIG
;

2937 
	`ıu_£t
(
ıu
,
bigcÜe_mask
);

2938 
h‘”o_nb_cÜes
++;

2941 
	`³r_ıu
(
cÜe_ty³
,
ıu
èğ
SMALL
;

2942 
	`ıu_£t
(
ıu
,
sm®lcÜe_mask
);

2943 
h‘”o_ns_cÜes
++;

2948 
	`ıuli¡_sú´štf
(
ıumask_sm®l_buf
, 16, 
sm®lcÜe_mask
);

2949 
	`ıuli¡_sú´štf
(
ıumask_big_buf
, 16, 
bigcÜe_mask
);

2951 if(
h‘”o_debug_Ëv–
 >= 0)

2952 
	`´štk
("H‘”ØCÜM­: BIG:% SML:%s\n",
ıumask_big_buf
,
ıumask_sm®l_buf
);

2954 
	`h‘”o_vıu_li¡
();

2958 
	`ç¡_vıu_li¡
(
domaš
 *
d
, 
em±y
, 
Şd_couÁ
){

2959 
csched_dom
 *
sdom
;

2960 
csched_vıu
 *
svc
 = 
NULL
;

2961 
li¡_h—d
 *
™”_vıu
;

2962 
št16_t
 
fcouÁ
 ;

2963 
ıumask_t
 
cÜemask
;

2964 
sdom
 = 
	`CSCHED_DOM
(
d
);

2966 
fcouÁ
 = 
sdom
->
ç¡_vıu_couÁ
 - 
Şd_couÁ
;

2968 if(
em±y
)

2970 
	`INIT_LIST_HEAD
(&
sdom
->
ç¡_vıu
);

2971 
	`li¡_fÜ_—ch
Ğ
™”_vıu
, &
sdom
->
h‘”o_vıu
)

2973 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
, 
h‘”o_vıu_–em
);

2974 if(
svc
)

2975 
	`INIT_LIST_HEAD
(&
svc
->
ç¡_vıu_–em
);

2981 if(
fcouÁ
 > 0)

2983 
	`li¡_fÜ_—ch
Ğ
™”_vıu
, &
sdom
->
h‘”o_vıu
)

2985 if(
fcouÁ
 == 0)

2987 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
, 
h‘”o_vıu_–em
);

2989 if(
svc
){

2991 
cÜemask
 = 
bigcÜe_mask
;

2992 
	`li¡_add_
(&(
svc
->
ç¡_vıu_–em
), &
sdom
->
ç¡_vıu
);

2994 
	`h‘”o_vıu_mig¿‹
(
svc
->
vıu
, &
cÜemask
);

2995 
svc
->
cÜe_ty³
 = 
BIG
;

2996 
fcouÁ
--;

3001 
fcouÁ
 = 
sdom
->
ç¡_vıu_couÁ
 - 
Şd_couÁ
;

3002 
fcouÁ
 != 0){

3003 
	`li¡_rÙ©e_Ëá
(&
sdom
->
h‘”o_vıu
);

3004 
fcouÁ
--;

3007 if(
fcouÁ
 < 0)

3009 
fcouÁ
 != 0)

3011 
	`li¡_fÜ_—ch
Ğ
™”_vıu
, &
sdom
->
ç¡_vıu
)

3013 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
, 
ç¡_vıu_–em
);

3016 if(
svc
){

3017 
cÜemask
 = 
sm®lcÜe_mask
;

3018 
	`h‘”o_vıu_mig¿‹
(
svc
->
vıu
, &
cÜemask
);

3019 
svc
->
cÜe_ty³
 = 
SMALL
;

3021 
	`li¡_d–_š™
(&
svc
->
ç¡_vıu_–em
);

3022 
fcouÁ
++;

3028 if(
h‘”o_debug_Ëv–
 >= 1){

3029 
	`´štk
("fvıu†i¡:%d %d ",
Şd_couÁ
,
sdom
->
ç¡_vıu_couÁ
);

3030 
	`li¡_fÜ_—ch
Ğ
™”_vıu
,&
sdom
->
ç¡_vıu
)

3032 
svc
 = 
	`li¡_’Œy
(
™”_vıu
, 
csched_vıu
,
ç¡_vıu_–em
);

3033 
	`´štk
("%d ",
svc
->
vıu
->
vıu_id
);

3035 
	`´štk
("\n");

3037 
sdom
->
h‘”o_sched_dÚe
 = 1;

3041 
	`»£t_hüed™s
(){

3042 
domaš
 *
d
;

3043 
vıu
 *
v
;

3044 
csched_vıu
 *
svc
;

3045 
csched_dom
 *
sdom
;

3047 
	`fÜ_—ch_domaš
Ğ
d
 )

3049 
sdom
 = 
	`CSCHED_DOM
(
d
);

3051 
	`fÜ_—ch_vıu
(
d
, 
v
){

3052 
svc
 = 
	`CSCHED_VCPU
(
v
);

3053 
	`©omic_£t
(&
svc
->
süed™
,0);

3054 
	`©omic_£t
(&
svc
->
füed™
,0);

3057 
sdom
->
sÿp
 = 0U;

3058 
sdom
->
fÿp
 = 0U;

3063 
	`chªge_dom_cÚfig
(
dom
, 
cÚfig
, 
v®
, 
v®2
)

3065 
domaš
 *
d
;

3066 
csched_dom
 *
sdom
;

3067 
ıu
 = 0;

3068 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
	`³r_ıu
(
scheduËr
, 
ıu
));

3070 
	`fÜ_—ch_domaš
Ğ
d
 )

3072 
sdom
 = 
	`CSCHED_DOM
(
d
);

3073 if(
d
->
domaš_id
 =ğ
dom
){

3074 if(
cÚfig
 == 1){

3075 
´v
->
eweight
 -ğ
sdom
->eweight;

3076 
sdom
->
eweight
 = 
v®
;

3077 
´v
->
eweight
 +ğ
sdom
->eweight;

3079 if(
cÚfig
 == 2){

3081 
sdom
->
•riÜ™y
 = 
v®
;

3082 
	`upd©e_´iÜ™y_li¡
();

3084 if(
cÚfig
 == 3){

3085 
sdom
->
sÿp
ğ
v®
;

3086 
sdom
->
fÿp
ğ
v®2
;

3088 if(
cÚfig
 == 4){

3089 
e¥“d_¡•
 = 
v®
;

3090 
e¥“d_mš
 = 
v®
;

3092 ià(
h‘”o_visÜ_aùive
){

3093 if(
h‘”o_debug_Ëv–
 >= 0)

3094 
	`´štk
(
KERN_INFO
 "cÚfig chªg%d %d %d\n",
dom
,
v®
,
v®2
);

3101 
	`chªge_h‘”o_cÚfig
(
cÚfig
, 
¬g
, 
¬g2
, 
¬g3
)

3103 if(
cÚfig
 == 1){

3104 if(
¬g
 >ğ0 && 
¬g3
 > 0 && 
¬g2
 > 0){

3105 
num_aùive_ıus
 = 
¬g3
;

3106 
big_cÜe_couÁ
 = 
¬g
;

3107 
num_sock‘s
 = 
¬g2
;

3108 
	`£tup_h‘”o_cÜes
();

3110 
	`WARN_ON
(
¬g
 < 0 || 
¬g3
 <ğ0 || 
¬g2
 <= 0);

3112 if(
cÚfig
 == 2){

3113 
h‘”o_sched_aùive
 = 
¬g
;

3114 
h‘”o_hüed™_pŞicy
 = 
¬g2
;

3116 if(
cÚfig
 == 3){

3117 
h‘”o_¥“d_¿tio
 = 
¬g
;

3120 if(
h‘”o_debug_Ëv–
 >= 0)

3121 
	`´štk
(
KERN_INFO
 "h‘”ØcÚfig chªg%d %d %d\n",
cÚfig
,
¬g
,
¬g2
);

3125 
ušt16_t
 
	`chªge_e¡©e
(
»sourû
, 
¡©e
, 
	`XEN_GUEST_HANDLE
(è
ÿp
)

3127 
vıu
 *
v
 = 
cu¼’t
;

3128 
csched_dom
 *
sdom
 = 
	`CSCHED_DOM
(
v
->
domaš
);

3129 
ušt64_t
 
mytime
, 
my£c
;

3130 
eÿp
 
ÿps
;

3131 
ušt16_t
 
num_sm®l_cÜes
 = 
num_aùive_ıus
 - 
big_cÜe_couÁ
;

3132 
max_¥“d
 = 100;

3133 
	`rdtsşl
(
mytime
);

3134 
my£c
 = 
	`tsc_ticks2ns
(
mytime
)/1000000;

3136 if(
h‘”o_visÜ_aùive
){

3137 
sdom
->
e¡©e
 = 
¡©e
;

3139 if(
»sourû
 == 0)

3141 if(
sdom
->
vıu_couÁ
 > 0)

3142 
max_¥“d
 = (100*(
big_cÜe_couÁ
 * 
h‘”o_¥“d_¿tio
 + 
	`mš
(
num_sm®l_cÜes
,
	`max
(0, 
sdom
->
vıu_couÁ
 - big_core_count))))/sdom->vcpu_count;

3144 
max_¥“d
 = 100;

3146 if(
¡©e
 =ğ
EUP
)

3148 
sdom
->
gue¡_¥“d
 +ğ
e¥“d_¡•
;

3149 if(
sdom
->
gue¡_¥“d
 > 
max_¥“d
)

3150 
sdom
->
gue¡_¥“d
 = 
max_¥“d
;

3152 if(
¡©e
 =ğ
EDN
)

3154 
sdom
->
gue¡_¥“d
 -ğ
e¥“d_¡•
;

3155 if(
sdom
->
gue¡_¥“d
 < 
e¥“d_mš
)

3156 
sdom
->
gue¡_¥“d
 = 
e¥“d_mš
;

3158 if(
¡©e
 =ğ
ENC
)

3161 if(
h‘”o_debug_Ëv–
 >= 1)

3162 
	`´štk
(
KERN_INFO
 "%luƒ¡©%d %d %d\n",
my£c
,
v
->
domaš
->
domaš_id
,
¡©e
,
sdom
->
gue¡_¥“d
);

3164 
ÿps
.
sÿp
 = 
sdom
->scap;

3165 
ÿps
.
fÿp
 = 
sdom
->fcap;

3166 
	`__cİy_to_gue¡
(
ÿp
,&
ÿps
,1);

3167  
sdom
->
–a¡ic_¥“d
;

3170 if(
h‘”o_visÜ_mem
){

3171 if(
¡©e
 =ğ
EUP
)

3173 
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
] +ğ
EMEM_STEP
;

3174 if(
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
] > 
EMEM_MAX
)

3175 
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
] = 
EMEM_MAX
;

3177 if(
¡©e
 =ğ
EDN
)

3179 
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
] -ğ
EMEM_STEP
;

3180 if(
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
] < 
EMEM_MIN
)

3181 
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
] = 
EMEM_MIN
;

3183 if(
¡©e
 =ğ
ENC
)

3186 if(
h‘”o_debug_Ëv–
 >= 1)

3187 
	`´štk
(
KERN_INFO
 "%luƒ¡©%d %d %d\n",
my£c
,
v
->
domaš
->
domaš_id
,
¡©e
);

3189 
	`__cİy_to_gue¡
(
ÿp
,&
ÿps
,1);

3190  
h‘”o_·ges_vm_lim™
[
sdom
->
dom
->
domaš_id
];

3195 
	`»ad_³rfùr
(
	`XEN_GUEST_HANDLE
(è
¬g
){

3196 
vıu
 * 
v
 = 
cu¼’t
;

3197 
domaš
 *
d
 = 
cu¼’t
->domain;

3198 
³rf_ùrs
 
p
[
MAX_VCPUS
];

3199 
id
 = 0;

3200 
csched_vıu
 *
svc
;

3202 
	`fÜ_—ch_vıu
Ğ
d
, 
v
 )

3204 if(
id
 < 
MAX_VCPUS
){

3205 
svc
 = 
	`CSCHED_VCPU
(
v
);

3207 
p
[
id
] = *(
svc
->
pùr
);

3208 
id
++;

3211 
	`´štk
("MAX_VCPUS violation\n");

3219 
	`__cİy_to_gue¡
(
¬g
,
p
,
MAX_VCPUS
);

3224 
	`chªge_debug_Ëv–
(
¬g
){

3225 
h‘”o_debug_Ëv–
 = 
¬g
;

3229 
	`’abË_h‘”o_visÜ
(
¬g
, 
¬g2
){

3231 
	`csched_h‘”o_š™
(0, 0 , 0);

3232 
h‘”o_visÜ_aùive
 = 
¬g
;

3233 
h‘”o_visÜ_mem
 = 
¬g2
;

3237 
	`csched_h‘”o_š™
(
¬g1
, 
¬g2
, 
¬g3
) {

3242 
	`£tup_h‘”o_cÜes
();

3243 
	`upd©e_´iÜ™y_li¡
();

3246 
h‘”o_š™
 = 1;

3248 
	`´štk
(
KERN_INFO
 "Initialized setup\n");

3253 
	`csched_š™
(
scheduËr
 *
İs
)

3255 
csched_´iv©e
 *
´v
;

3257 
´v
 = 
	`xm®loc
(
csched_´iv©e
);

3258 iàĞ
´v
 =ğ
NULL
 )

3259  -
ENOMEM
;

3261 
	`mem£t
(
´v
, 0, (*prv));

3262 
İs
->
sched_d©a
 = 
´v
;

3263 
	`¥š_lock_š™
(&
´v
->
lock
);

3264 
	`INIT_LIST_HEAD
(&
´v
->
aùive_sdom
);

3265 
´v
->
ma¡”
 = 
UINT_MAX
;

3271 
	`csched_deš™
(cÚ¡ 
scheduËr
 *
İs
)

3273 
csched_´iv©e
 *
´v
;

3275 
´v
 = 
	`CSCHED_PRIV
(
İs
);

3276 iàĞ
´v
 !ğ
NULL
 )

3277 
	`xä“
(
´v
);

3280 
	`csched_tick_su¥’d
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

3282 
csched_pıu
 *
¥c
;

3284 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

3286 
	`¡İ_tim”
(&
¥c
->
tick”
);

3289 
	`csched_tick_»sume
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

3291 
csched_pıu
 *
¥c
;

3292 
ušt64_t
 
now
 = 
	`NOW
();

3294 
¥c
 = 
	`CSCHED_PCPU
(
ıu
);

3296 
	`£t_tim”
(&
¥c
->
tick”
, 
now
 + 
	`MILLISECS
(
CSCHED_MSECS_PER_TICK
)

3297 - 
now
 % 
	`MILLISECS
(
CSCHED_MSECS_PER_TICK
) );

3300 
csched_´iv©e
 
_csched_´iv
;

3302 cÚ¡ 
scheduËr
 
sched_üed™_def
 = {

3303 .
Çme
 = "SMP Credit Scheduler",

3304 .
İt_Çme
 = "credit",

3305 .
sched_id
 = 
XEN_SCHEDULER_CREDIT
,

3306 .
sched_d©a
 = &
_csched_´iv
,

3308 .
š™_domaš
 = 
csched_dom_š™
,

3309 .
de¡roy_domaš
 = 
csched_dom_de¡roy
,

3311 .
š£¹_vıu
 = 
csched_vıu_š£¹
,

3312 .
»move_vıu
 = 
csched_vıu_»move
,

3314 .
¦“p
 = 
csched_vıu_¦“p
,

3315 .
wake
 = 
csched_vıu_wake
,

3316 .
y›ld
 = 
csched_vıu_y›ld
,

3318 .
adju¡
 = 
csched_dom_ú
,

3320 .
pick_ıu
 = 
csched_ıu_pick
,

3321 .
do_scheduË
 = 
csched_scheduË
,

3323 .
dump_ıu_¡©e
 = 
csched_dump_pıu
,

3324 .
dump_£‰šgs
 = 
csched_dump
,

3325 .
š™
 = 
csched_š™
,

3326 .
deš™
 = 
csched_deš™
,

3327 .
®loc_vd©a
 = 
csched_®loc_vd©a
,

3328 .
ä“_vd©a
 = 
csched_ä“_vd©a
,

3329 .
®loc_pd©a
 = 
csched_®loc_pd©a
,

3330 .
ä“_pd©a
 = 
csched_ä“_pd©a
,

3331 .
®loc_domd©a
 = 
csched_®loc_domd©a
,

3332 .
ä“_domd©a
 = 
csched_ä“_domd©a
,

3334 .
tick_su¥’d
 = 
csched_tick_su¥’d
,

3335 .
tick_»sume
 = 
csched_tick_»sume
,

	@sched_credit2.c

13 
	~<x’/cÚfig.h
>

14 
	~<x’/š™.h
>

15 
	~<x’/lib.h
>

16 
	~<x’/sched.h
>

17 
	~<x’/domaš.h
>

18 
	~<x’/d–ay.h
>

19 
	~<x’/ev’t.h
>

20 
	~<x’/time.h
>

21 
	~<x’/³rfc.h
>

22 
	~<x’/sched-if.h
>

23 
	~<x’/soáœq.h
>

24 
	~<asm/©omic.h
>

25 
	~<x’/”ºo.h
>

26 
	~<x’/Œaû.h
>

27 
	~<x’/ıu.h
>

29 #ià
__i386__


30 
	#PRI_¡ime
 "Îd"

	)

32 
	#PRI_¡ime
 "ld"

	)

35 
	#d2´štk
(
x
...)

	)

38 
	#TRC_CSCHED2_TICK
 
TRC_SCHED_CLASS
 + 1

	)

39 
	#TRC_CSCHED2_RUNQ_POS
 
TRC_SCHED_CLASS
 + 2

	)

40 
	#TRC_CSCHED2_CREDIT_BURN
 
TRC_SCHED_CLASS
 + 3

	)

41 
	#TRC_CSCHED2_CREDIT_ADD
 
TRC_SCHED_CLASS
 + 4

	)

42 
	#TRC_CSCHED2_TICKLE_CHECK
 
TRC_SCHED_CLASS
 + 5

	)

43 
	#TRC_CSCHED2_TICKLE
 
TRC_SCHED_CLASS
 + 6

	)

44 
	#TRC_CSCHED2_CREDIT_RESET
 
TRC_SCHED_CLASS
 + 7

	)

45 
	#TRC_CSCHED2_SCHED_TASKLET
 
TRC_SCHED_CLASS
 + 8

	)

46 
	#TRC_CSCHED2_UPDATE_LOAD
 
TRC_SCHED_CLASS
 + 9

	)

47 
	#TRC_CSCHED2_RUNQ_ASSIGN
 
TRC_SCHED_CLASS
 + 10

	)

48 
	#TRC_CSCHED2_UPDATE_VCPU_LOAD
 
TRC_SCHED_CLASS
 + 11

	)

49 
	#TRC_CSCHED2_UPDATE_RUNQ_LOAD
 
TRC_SCHED_CLASS
 + 12

	)

113 
	#CSCHED_DEFAULT_WEIGHT
 256

	)

116 
	#CSCHED_MIN_TIMER
 
	`MICROSECS
(500)

	)

120 
	#CSCHED_CREDIT_INIT
 
	`MILLISECS
(10)

	)

123 
	#CSCHED_CARRYOVER_MAX
 
CSCHED_MIN_TIMER


	)

126 
	#CSCHED_MIGRATE_RESIST
 ((
İt_mig¿‹_»si¡
)*
	`MICROSECS
(1))

	)

128 
	#CSCHED_MIGRATE_COMPENSATION
 
	`MICROSECS
(50)

	)

130 
	#CSCHED_CREDIT_RESET
 0

	)

132 
	#CSCHED_MAX_TIMER
 
	`MILLISECS
(2)

	)

135 
	#CSCHED_IDLE_CREDIT
 (-(1<<30))

	)

149 
	#__CSFLAG_scheduËd
 1

	)

150 
	#CSFLAG_scheduËd
 (1<<
__CSFLAG_scheduËd
)

	)

158 
	#__CSFLAG_d–ayed_runq_add
 2

	)

159 
	#CSFLAG_d–ayed_runq_add
 (1<<
__CSFLAG_d–ayed_runq_add
)

	)

164 
	#__CSFLAG_runq_mig¿‹_»que¡
 3

	)

165 
	#CSFLAG_runq_mig¿‹_»que¡
 (1<<
__CSFLAG_runq_mig¿‹_»que¡
)

	)

168 
	gİt_mig¿‹_»si¡
=500;

169 
š‹g”_·¿m
("sched_üed™2_mig¿‹_»si¡", 
İt_mig¿‹_»si¡
);

174 
	#CSCHED_PRIV
(
_İs
) \

175 ((
csched_´iv©e
 *)((
_İs
)->
sched_d©a
))

	)

176 
	#CSCHED_VCPU
(
_vıu
è((
csched_vıu
 *è(_vıu)->
sched_´iv
)

	)

177 
	#CSCHED_DOM
(
_dom
è((
csched_dom
 *è(_dom)->
sched_´iv
)

	)

178 
	#CSCHED_CPUONLINE
(
_poŞ
) \

179 (((
_poŞ
è=ğ
NULL
è? &
ıupoŞ_ä“_ıus
 : &(_poŞ)->
ıu_v®id
)

	)

181 
	#c2r
(
_İs
, 
_ıu
è(
	`CSCHED_PRIV
(_İs)->
runq_m­
[(_ıu)])

	)

183 
	#RQD
(
_İs
, 
_ıu
è(&
	`CSCHED_PRIV
(_İs)->
rqd
[
	`c2r
(_İs, _ıu)])

	)

192 
	#LOADAVG_GRANULARITY_SHIFT
 (10)

	)

193 
	gİt_lßd_wšdow_shiá
=18;

194 
	#LOADAVG_WINDOW_SHIFT_MIN
 4

	)

195 
š‹g”_·¿m
("üed™2_lßd_wšdow_shiá", 
İt_lßd_wšdow_shiá
);

196 
	gİt_und”lßd_b®ªû_tŞ”ªû
=0;

197 
š‹g”_·¿m
("üed™2_b®ªû_und”", 
İt_und”lßd_b®ªû_tŞ”ªû
);

198 
	gİt_ov”lßd_b®ªû_tŞ”ªû
=-3;

199 
š‹g”_·¿m
("üed™2_b®ªû_ov”", 
İt_ov”lßd_b®ªû_tŞ”ªû
);

204 
	scsched_runqueue_d©a
 {

205 
	mid
;

207 
¥šlock_t
 
	mlock
;

208 
ıumask_t
 
	maùive
;

210 
li¡_h—d
 
	mrunq
;

211 
li¡_h—d
 
	msvc
;

212 
	mmax_weight
;

214 
ıumask_t
 
	midË
,

215 
	mtickËd
;

216 
	mlßd
;

217 
s_time_t
 
	mlßd_Ï¡_upd©e
;

218 
s_time_t
 
	mavglßd
;

219 
s_time_t
 
	mb_avglßd
;

225 
	scsched_´iv©e
 {

226 
¥šlock_t
 
	mlock
;

227 
ıumask_t
 
	mš™Ÿlized
;

229 
li¡_h—d
 
	msdom
;

231 
	mrunq_m­
[
NR_CPUS
];

232 
ıumask_t
 
	maùive_queues
;

233 
csched_runqueue_d©a
 
	mrqd
[
NR_CPUS
];

235 
	mlßd_wšdow_shiá
;

241 
	scsched_vıu
 {

242 
li¡_h—d
 
	mrqd_–em
;

243 
li¡_h—d
 
	msdom_–em
;

244 
li¡_h—d
 
	mrunq_–em
;

245 
csched_runqueue_d©a
 *
	mrqd
;

248 
csched_dom
 *
	msdom
;

249 
vıu
 *
	mvıu
;

251 
	mweight
;

253 
	müed™
;

254 
s_time_t
 
	m¡¬t_time
;

255 
	mæags
;

258 
s_time_t
 
	mlßd_Ï¡_upd©e
;

259 
s_time_t
 
	mavglßd
;

261 
csched_runqueue_d©a
 *
	mmig¿‹_rqd
;

267 
	scsched_dom
 {

268 
li¡_h—d
 
	mvıu
;

269 
li¡_h—d
 
	msdom_–em
;

270 
domaš
 *
	mdom
;

271 
ušt16_t
 
	mweight
;

272 
ušt16_t
 
	mÄ_vıus
;

280 
s_time_t
 
	$t2c
(
csched_runqueue_d©a
 *
rqd
, 
s_time_t
 
time
, 
csched_vıu
 *
svc
)

282  
time
 * 
rqd
->
max_weight
 / 
svc
->
weight
;

283 
	}
}

285 
s_time_t
 
	$c2t
(
csched_runqueue_d©a
 *
rqd
, 
s_time_t
 
üed™
, 
csched_vıu
 *
svc
)

287  
üed™
 * 
svc
->
weight
 / 
rqd
->
max_weight
;

288 
	}
}

295 
	$__vıu_Ú_runq
(
csched_vıu
 *
svc
)

297  !
	`li¡_em±y
(&
svc
->
runq_–em
);

298 
	}
}

300 
csched_vıu
 *

301 
	$__runq_–em
(
li¡_h—d
 *
–em
)

303  
	`li¡_’Œy
(
–em
, 
csched_vıu
, 
runq_–em
);

304 
	}
}

307 
	$__upd©e_runq_lßd
(cÚ¡ 
scheduËr
 *
İs
,

308 
csched_runqueue_d©a
 *
rqd
, 
chªge
, 
s_time_t
 
now
)

310 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

311 
s_time_t
 
d–
=-1;

313 
now
 >>ğ
LOADAVG_GRANULARITY_SHIFT
;

315 iàĞ
rqd
->
lßd_Ï¡_upd©e
 + (1ULL<<
´v
->
lßd_wšdow_shiá
è< 
now
 )

317 
rqd
->
avglßd
 = (ìqd->
lßd
 << 
´v
->
lßd_wšdow_shiá
;

318 
rqd
->
b_avglßd
 = (ìqd->
lßd
 << 
´v
->
lßd_wšdow_shiá
;

322 
d–
 = 
now
 - 
rqd
->
lßd_Ï¡_upd©e
;

324 
rqd
->
avglßd
 =

325 ĞĞ
d–
 * ( ()
rqd
->
lßd
 << 
´v
->
lßd_wšdow_shiá
 ) )

326 + ( ((1ULL<<
´v
->
lßd_wšdow_shiá
è- 
d–
è* 
rqd
->
avglßd
 ) ) >>…rv->load_window_shift;

328 
rqd
->
b_avglßd
 =

329 ĞĞ
d–
 * ( ()
rqd
->
lßd
 << 
´v
->
lßd_wšdow_shiá
 ) )

330 + ( ((1ULL<<
´v
->
lßd_wšdow_shiá
è- 
d–
è* 
rqd
->
b_avglßd
 ) ) >>…rv->load_window_shift;

332 
rqd
->
lßd
 +ğ
chªge
;

333 
rqd
->
lßd_Ï¡_upd©e
 = 
now
;

337 
rq_lßd
:4, 
rq_avglßd
:28;

338 
rq_id
:4, 
b_avglßd
:28;

339 } 
d
;

340 
d
.
rq_id
=
rqd
->
id
;

341 
d
.
rq_lßd
 = 
rqd
->
lßd
;

342 
d
.
rq_avglßd
 = 
rqd
->
avglßd
;

343 
d
.
b_avglßd
 = 
rqd
->b_avgload;

344 
	`Œaû_v¬
(
TRC_CSCHED2_UPDATE_RUNQ_LOAD
, 1,

345 (
d
),

346 (*)&
d
);

348 
	}
}

351 
	$__upd©e_svc_lßd
(cÚ¡ 
scheduËr
 *
İs
,

352 
csched_vıu
 *
svc
, 
chªge
, 
s_time_t
 
now
)

354 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

355 
s_time_t
 
d–
=-1;

356 
vıu_lßd
;

358 iàĞ
chªge
 == -1 )

359 
vıu_lßd
 = 1;

360 iàĞ
chªge
 == 1 )

361 
vıu_lßd
 = 0;

363 
vıu_lßd
 = 
	`vıu_ruÂabË
(
svc
->
vıu
);

365 
now
 >>ğ
LOADAVG_GRANULARITY_SHIFT
;

367 iàĞ
svc
->
lßd_Ï¡_upd©e
 + (1ULL<<
´v
->
lßd_wšdow_shiá
è< 
now
 )

369 
svc
->
avglßd
 = ()
vıu_lßd
 << 
´v
->
lßd_wšdow_shiá
;

373 
d–
 = 
now
 - 
svc
->
lßd_Ï¡_upd©e
;

375 
svc
->
avglßd
 =

376 ĞĞ
d–
 * ( ()
vıu_lßd
 << 
´v
->
lßd_wšdow_shiá
 ) )

377 + ( ((1ULL<<
´v
->
lßd_wšdow_shiá
è- 
d–
è* 
svc
->
avglßd
 ) ) >>…rv->load_window_shift;

379 
svc
->
lßd_Ï¡_upd©e
 = 
now
;

383 
dom
:16,
vıu
:16;

384 
v_avglßd
:32;

385 } 
d
;

386 
d
.
dom
 = 
svc
->
vıu
->
domaš
->
domaš_id
;

387 
d
.
vıu
 = 
svc
->vıu->
vıu_id
;

388 
d
.
v_avglßd
 = 
svc
->
avglßd
;

389 
	`Œaû_v¬
(
TRC_CSCHED2_UPDATE_VCPU_LOAD
, 1,

390 (
d
),

391 (*)&
d
);

393 
	}
}

396 
	$upd©e_lßd
(cÚ¡ 
scheduËr
 *
İs
,

397 
csched_runqueue_d©a
 *
rqd
,

398 
csched_vıu
 *
svc
, 
chªge
, 
s_time_t
 
now
)

400 
	`__upd©e_runq_lßd
(
İs
, 
rqd
, 
chªge
, 
now
);

401 iàĞ
svc
 )

402 
	`__upd©e_svc_lßd
(
İs
, 
svc
, 
chªge
, 
now
);

403 
	}
}

406 
	$__runq_š£¹
(
li¡_h—d
 *
runq
, 
csched_vıu
 *
svc
)

408 
li¡_h—d
 *
™”
;

409 
pos
 = 0;

411 
	`d2´štk
("rqi d%dv%d\n",

412 
svc
->
vıu
->
domaš
->
domaš_id
,

413 
svc
->
vıu
->
vıu_id
);

415 
	`BUG_ON
(&
svc
->
rqd
->
runq
 !=„unq);

417 
	`BUG_ON
(
	`is_idË_vıu
(
svc
->
vıu
));

418 
	`BUG_ON
(
svc
->
vıu
->
is_ruÂšg
);

419 
	`BUG_ON
(
	`‹¡_b™
(
__CSFLAG_scheduËd
, &
svc
->
æags
));

421 
	`li¡_fÜ_—ch
Ğ
™”
, 
runq
 )

423 
csched_vıu
 * 
™”_svc
 = 
	`__runq_–em
(
™”
);

425 iàĞ
svc
->
üed™
 > 
™”_svc
->credit )

427 
	`d2´štk
("…%d d%dv%d\n",

428 
pos
,

429 
™”_svc
->
vıu
->
domaš
->
domaš_id
,

430 
™”_svc
->
vıu
->
vıu_id
);

433 
pos
++;

436 
	`li¡_add_
(&
svc
->
runq_–em
, 
™”
);

438  
pos
;

439 
	}
}

442 
	$runq_š£¹
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
, 
csched_vıu
 *
svc
)

444 
li¡_h—d
 * 
runq
 = &
	`RQD
(
İs
, 
ıu
)->runq;

445 
pos
 = 0;

447 
	`ASSERT
Ğ
	`¥š_is_locked
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
scheduË_lock
) );

449 
	`BUG_ON
Ğ
	`__vıu_Ú_runq
(
svc
) );

450 
	`BUG_ON
Ğ
	`c2r
(
İs
, 
ıu
è!ğc2r(İs, 
svc
->
vıu
->
´oûssÜ
) );

452 
pos
 = 
	`__runq_š£¹
(
runq
, 
svc
);

456 
dom
:16,
vıu
:16;

457 
pos
;

458 } 
d
;

459 
d
.
dom
 = 
svc
->
vıu
->
domaš
->
domaš_id
;

460 
d
.
vıu
 = 
svc
->vıu->
vıu_id
;

461 
d
.
pos
 =…os;

462 
	`Œaû_v¬
(
TRC_CSCHED2_RUNQ_POS
, 0,

463 (
d
),

464 (*)&
d
);

468 
	}
}

470 
šlše
 

471 
	$__runq_»move
(
csched_vıu
 *
svc
)

473 
	`BUG_ON
Ğ!
	`__vıu_Ú_runq
(
svc
) );

474 
	`li¡_d–_š™
(&
svc
->
runq_–em
);

475 
	}
}

477 
buº_üed™s
(
csched_runqueue_d©a
 *
rqd
, 
csched_vıu
 *, 
s_time_t
);

482 
	$runq_tickË
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
, 
csched_vıu
 *
Ãw
, 
s_time_t
 
now
)

484 
i
, 
id
=-1;

485 
s_time_t
 
lowe¡
=(1<<30);

486 
csched_runqueue_d©a
 *
rqd
 = 
	`RQD
(
İs
, 
ıu
);

487 
ıumask_t
 
mask
;

488 
csched_vıu
 * 
cur
;

490 
	`d2´štk
("rqt d%dv%d cd%dv%d\n",

491 
Ãw
->
vıu
->
domaš
->
domaš_id
,

492 
Ãw
->
vıu
->
vıu_id
,

493 
cu¼’t
->
domaš
->
domaš_id
,

494 
cu¼’t
->
vıu_id
);

496 
	`BUG_ON
(
Ãw
->
vıu
->
´oûssÜ
 !ğ
ıu
);

497 
	`BUG_ON
(
Ãw
->
rqd
 !=„qd);

500 
cur
 = 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
);

501 
	`buº_üed™s
(
rqd
, 
cur
, 
now
);

503 iàĞ
cur
->
üed™
 < 
Ãw
->credit )

505 
id
 = 
ıu
;

506 
tickË
;

510 
	`ıus_ªdnÙ
(
mask
, 
rqd
->
idË
,„qd->
tickËd
);

513 iàĞ!
	`ıus_em±y
(
mask
) )

515 
id
=
	`fœ¡_ıu
(
mask
);

516 
tickË
;

521 
	`ıus_ªdnÙ
(
mask
, 
rqd
->
aùive
,„qd->
idË
);

522 
	`ıus_ªdnÙ
(
mask
, mask, 
rqd
->
tickËd
);

524 
	`fÜ_—ch_ıu_mask
(
i
, 
mask
)

526 
csched_vıu
 * 
cur
;

529 iàĞ
i
 =ğ
ıu
 )

532 
cur
 = 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
i
).
cu¼
);

534 
	`BUG_ON
(
	`is_idË_vıu
(
cur
->
vıu
));

537 
	`buº_üed™s
(
rqd
, 
cur
, 
now
);

539 iàĞ
cur
->
üed™
 < 
lowe¡
 )

541 
id
 = 
i
;

542 
lowe¡
 = 
cur
->
üed™
;

547 
dom
:16,
vıu
:16;

548 
üed™
;

549 } 
d
;

550 
d
.
dom
 = 
cur
->
vıu
->
domaš
->
domaš_id
;

551 
d
.
vıu
 = 
cur
->vıu->
vıu_id
;

552 
d
.
üed™
 = 
cur
->credit;

553 
	`Œaû_v¬
(
TRC_CSCHED2_TICKLE_CHECK
, 1,

554 (
d
),

555 (*)&
d
);

561 iàĞ
id
 =ğ-1 || 
lowe¡
 + 
CSCHED_MIGRATE_RESIST
 > 
Ãw
->
üed™
 )

562 
no_tickË
;

564 
tickË
:

565 
	`BUG_ON
(
id
 == -1);

569 
ıu
:8;

570 } 
d
;

571 
d
.
ıu
 = 
id
;

572 
	`Œaû_v¬
(
TRC_CSCHED2_TICKLE
, 0,

573 (
d
),

574 (*)&
d
);

576 
	`ıu_£t
(
id
, 
rqd
->
tickËd
);

577 
	`ıu_¿i£_soáœq
(
id
, 
SCHEDULE_SOFTIRQ
);

579 
no_tickË
:

581 
	}
}

586 
	$»£t_üed™
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
, 
s_time_t
 
now
)

588 
csched_runqueue_d©a
 *
rqd
 = 
	`RQD
(
İs
, 
ıu
);

589 
li¡_h—d
 *
™”
;

591 
	`li¡_fÜ_—ch
Ğ
™”
, &
rqd
->
svc
 )

593 
csched_vıu
 * 
svc
 = 
	`li¡_’Œy
(
™”
, csched_vıu, 
rqd_–em
);

595 
¡¬t_üed™
;

597 
	`BUG_ON
Ğ
	`is_idË_vıu
(
svc
->
vıu
) );

598 
	`BUG_ON
Ğ
svc
->
rqd
 !=„qd );

600 
¡¬t_üed™
 = 
svc
->
üed™
;

603 iàĞ
svc
->
üed™
 > 
CSCHED_CARRYOVER_MAX
 )

604 
svc
->
üed™
 = 
CSCHED_CARRYOVER_MAX
;

606 
svc
->
üed™
 +ğ
CSCHED_CREDIT_INIT
;

607 
svc
->
¡¬t_time
 = 
now
;

611 
dom
:16,
vıu
:16;

612 
üed™_¡¬t
, 
üed™_’d
;

613 } 
d
;

614 
d
.
dom
 = 
svc
->
vıu
->
domaš
->
domaš_id
;

615 
d
.
vıu
 = 
svc
->vıu->
vıu_id
;

616 
d
.
üed™_¡¬t
 = 
¡¬t_üed™
;

617 
d
.
üed™_’d
 = 
svc
->
üed™
;

618 
	`Œaû_v¬
(
TRC_CSCHED2_CREDIT_RESET
, 1,

619 (
d
),

620 (*)&
d
);

625 
	}
}

627 
	$buº_üed™s
(
csched_runqueue_d©a
 *
rqd
, 
csched_vıu
 *
svc
, 
s_time_t
 
now
)

629 
s_time_t
 
d–
;

632 
	`ASSERT
(
svc
==
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, svc->
vıu
->
´oûssÜ
).
cu¼
));

634 iàĞ
	`is_idË_vıu
(
svc
->
vıu
) )

636 
	`BUG_ON
(
svc
->
üed™
 !ğ
CSCHED_IDLE_CREDIT
);

640 
d–
 = 
now
 - 
svc
->
¡¬t_time
;

642 iàĞ
d–
 > 0 ) {

644 
svc
->
üed™
 -ğ
	`t2c
(
rqd
, 
d–
, svc);

645 
svc
->
¡¬t_time
 = 
now
;

647 
	`d2´štk
("b d%dv%d c%d\n",

648 
svc
->
vıu
->
domaš
->
domaš_id
,

649 
svc
->
vıu
->
vıu_id
,

650 
svc
->
üed™
);

652 
	`d2´štk
("%s: Timw’ˆbackw¬ds?‚ow %"
PRI_¡ime
" start %"PRI_stime"\n",

653 
__func__
, 
now
, 
svc
->
¡¬t_time
);

659 
dom
:16,
vıu
:16;

660 
üed™
;

661 
d–
;

662 } 
d
;

663 
d
.
dom
 = 
svc
->
vıu
->
domaš
->
domaš_id
;

664 
d
.
vıu
 = 
svc
->vıu->
vıu_id
;

665 
d
.
üed™
 = 
svc
->credit;

666 
d
.
d–
 = delta;

667 
	`Œaû_v¬
(
TRC_CSCHED2_CREDIT_BURN
, 1,

668 (
d
),

669 (*)&
d
);

671 
	}
}

674 
	$upd©e_max_weight
(
csched_runqueue_d©a
 *
rqd
, 
Ãw_weight
, 
Şd_weight
)

682 iàĞ
Ãw_weight
 > 
rqd
->
max_weight
 )

684 
rqd
->
max_weight
 = 
Ãw_weight
;

685 
	`d2´štk
("%s: Runqueuid %d max weighˆ%d\n", 
__func__
, 
rqd
->
id
,„qd->
max_weight
);

687 iàĞ
Şd_weight
 =ğ
rqd
->
max_weight
 )

689 
li¡_h—d
 *
™”
;

690 
max_weight
 = 1;

692 
	`li¡_fÜ_—ch
Ğ
™”
, &
rqd
->
svc
 )

694 
csched_vıu
 * 
svc
 = 
	`li¡_’Œy
(
™”
, csched_vıu, 
rqd_–em
);

696 iàĞ
svc
->
weight
 > 
max_weight
 )

697 
max_weight
 = 
svc
->
weight
;

700 
rqd
->
max_weight
 = max_weight;

701 
	`d2´štk
("%s: Runqueu%d max weighˆ%d\n", 
__func__
, 
rqd
->
id
,„qd->
max_weight
);

703 
	}
}

705 #iâdeà
NDEBUG


707 
	$__csched_vıu_check
(
vıu
 *
vc
)

709 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

710 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

712 
	`BUG_ON
Ğ
svc
->
vıu
 !ğ
vc
 );

713 
	`BUG_ON
Ğ
sdom
 !ğ
	`CSCHED_DOM
(
vc
->
domaš
) );

714 iàĞ
sdom
 )

716 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

717 
	`BUG_ON
Ğ
sdom
->
dom
 !ğ
vc
->
domaš
 );

721 
	`BUG_ON
Ğ!
	`is_idË_vıu
(
vc
) );

723 
	}
}

724 
	#CSCHED_VCPU_CHECK
(
_vc
è(
	`__csched_vıu_check
(_vc))

	)

726 
	#CSCHED_VCPU_CHECK
(
_vc
)

	)

730 
	$csched_®loc_vd©a
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
, *
dd
)

732 
csched_vıu
 *
svc
;

735 
svc
 = 
	`xm®loc
(
csched_vıu
);

736 iàĞ
svc
 =ğ
NULL
 )

737  
NULL
;

738 
	`mem£t
(
svc
, 0, (*svc));

740 
	`INIT_LIST_HEAD
(&
svc
->
rqd_–em
);

741 
	`INIT_LIST_HEAD
(&
svc
->
sdom_–em
);

742 
	`INIT_LIST_HEAD
(&
svc
->
runq_–em
);

744 
svc
->
sdom
 = 
dd
;

745 
svc
->
vıu
 = 
vc
;

746 
svc
->
æags
 = 0U;

748 iàĞ! 
	`is_idË_vıu
(
vc
) )

750 
	`BUG_ON
Ğ
svc
->
sdom
 =ğ
NULL
 );

752 
svc
->
üed™
 = 
CSCHED_CREDIT_INIT
;

753 
svc
->
weight
 = svc->
sdom
->weight;

755 
svc
->
avglßd
 = 1ULL << (
	`CSCHED_PRIV
(
İs
)->
lßd_wšdow_shiá
 - 1);

756 
svc
->
lßd_Ï¡_upd©e
 = 
	`NOW
();

760 
	`BUG_ON
Ğ
svc
->
sdom
 !ğ
NULL
 );

761 
svc
->
üed™
 = 
CSCHED_IDLE_CREDIT
;

762 
svc
->
weight
 = 0;

765  
svc
;

766 
	}
}

770 
	$__runq_assign
(
csched_vıu
 *
svc
, 
csched_runqueue_d©a
 *
rqd
)

773 
svc
->
rqd
 =„qd;

774 
	`li¡_add_
(&
svc
->
rqd_–em
, &svc->
rqd
->svc);

776 
	`upd©e_max_weight
(
svc
->
rqd
, svc->
weight
, 0);

779 
rqd
->
b_avglßd
 +ğ
svc
->
avglßd
;

784 
dom
:16,
vıu
:16;

785 
rqi
:16;

786 } 
d
;

787 
d
.
dom
 = 
svc
->
vıu
->
domaš
->
domaš_id
;

788 
d
.
vıu
 = 
svc
->vıu->
vıu_id
;

789 
d
.
rqi
=
rqd
->
id
;

790 
	`Œaû_v¬
(
TRC_CSCHED2_RUNQ_ASSIGN
, 1,

791 (
d
),

792 (*)&
d
);

795 
	}
}

798 
	$runq_assign
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

800 
csched_vıu
 *
svc
 = 
vc
->
sched_´iv
;

802 
	`BUG_ON
(
svc
->
rqd
 !ğ
NULL
);

804 
	`__runq_assign
(
svc
, 
	`RQD
(
İs
, 
vc
->
´oûssÜ
));

805 
	}
}

808 
	$__runq_d—ssign
(
csched_vıu
 *
svc
)

810 
	`BUG_ON
(
	`__vıu_Ú_runq
(
svc
));

812 
	`li¡_d–_š™
(&
svc
->
rqd_–em
);

813 
	`upd©e_max_weight
(
svc
->
rqd
, 0, svc->
weight
);

816 
svc
->
rqd
->
b_avglßd
 -ğsvc->
avglßd
;

818 
svc
->
rqd
 = 
NULL
;

819 
	}
}

822 
	$runq_d—ssign
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

824 
csched_vıu
 *
svc
 = 
vc
->
sched_´iv
;

826 
	`BUG_ON
(
svc
->
rqd
 !ğ
	`RQD
(
İs
, 
vc
->
´oûssÜ
));

828 
	`__runq_d—ssign
(
svc
);

829 
	}
}

832 
	$csched_vıu_š£¹
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

834 
csched_vıu
 *
svc
 = 
vc
->
sched_´iv
;

835 
domaš
 * cÚ¡ 
dom
 = 
vc
->domain;

836 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

838 
	`´štk
("%s: Inserting d%dv%d\n",

839 
__func__
, 
dom
->
domaš_id
, 
vc
->
vıu_id
);

844 iàĞ! 
	`is_idË_vıu
(
vc
) )

847 
	`li¡_add_
(&
svc
->
sdom_–em
, &svc->
sdom
->
vıu
);

850 
	`vıu_scheduË_lock_œq
(
vc
);

852 
	`runq_assign
(
İs
, 
vc
);

854 
	`vıu_scheduË_uÆock_œq
(
vc
);

856 
sdom
->
Ä_vıus
++;

859 
	`CSCHED_VCPU_CHECK
(
vc
);

860 
	}
}

863 
	$csched_ä“_vd©a
(cÚ¡ 
scheduËr
 *
İs
, *
´iv
)

865 
csched_vıu
 *
svc
 = 
´iv
;

867 
	`xä“
(
svc
);

868 
	}
}

871 
	$csched_vıu_»move
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

873 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

874 
csched_dom
 * cÚ¡ 
sdom
 = 
svc
->sdom;

876 
	`BUG_ON
Ğ
sdom
 =ğ
NULL
 );

877 
	`BUG_ON
Ğ!
	`li¡_em±y
(&
svc
->
runq_–em
) );

879 iàĞ! 
	`is_idË_vıu
(
vc
) )

882 
	`vıu_scheduË_lock_œq
(
vc
);

884 
	`runq_d—ssign
(
İs
, 
vc
);

886 
	`vıu_scheduË_uÆock_œq
(
vc
);

890 
	`li¡_d–_š™
(&
svc
->
sdom_–em
);

892 
svc
->
sdom
->
Ä_vıus
--;

894 
	}
}

897 
	$csched_vıu_¦“p
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

899 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

901 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

903 iàĞ
	`³r_ıu
(
scheduË_d©a
, 
vc
->
´oûssÜ
).
cu¼
 == vc )

904 
	`ıu_¿i£_soáœq
(
vc
->
´oûssÜ
, 
SCHEDULE_SOFTIRQ
);

905 iàĞ
	`__vıu_Ú_runq
(
svc
) )

907 
	`BUG_ON
(
svc
->
rqd
 !ğ
	`RQD
(
İs
, 
vc
->
´oûssÜ
));

908 
	`upd©e_lßd
(
İs
, 
svc
->
rqd
, svc, -1, 
	`NOW
());

909 
	`__runq_»move
(
svc
);

911 iàĞ
	`‹¡_b™
(
__CSFLAG_d–ayed_runq_add
, &
svc
->
æags
) )

912 
	`ş—r_b™
(
__CSFLAG_d–ayed_runq_add
, &
svc
->
æags
);

913 
	}
}

916 
	$csched_vıu_wake
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

918 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

919 
s_time_t
 
now
 = 0;

923 
	`d2´štk
("w d%dv%d\n", 
vc
->
domaš
->
domaš_id
, vc->
vıu_id
);

925 
	`BUG_ON
Ğ
	`is_idË_vıu
(
vc
) );

928 iàĞ
	`uÆik–y
(
	`³r_ıu
(
scheduË_d©a
, 
vc
->
´oûssÜ
).
cu¼
 == vc) )

930 
out
;

933 iàĞ
	`uÆik–y
(
	`__vıu_Ú_runq
(
svc
)) )

937 
out
;

943 iàĞ
	`uÆik–y
 (
	`‹¡_b™
(
__CSFLAG_scheduËd
, &
svc
->
æags
) ) )

945 
	`£t_b™
(
__CSFLAG_d–ayed_runq_add
, &
svc
->
æags
);

946 
out
;

950 iàĞ
svc
->
rqd
 =ğ
NULL
 )

951 
	`runq_assign
(
İs
, 
vc
);

953 
	`BUG_ON
(
	`RQD
(
İs
, 
vc
->
´oûssÜ
è!ğ
svc
->
rqd
 );

955 
now
 = 
	`NOW
();

957 
	`upd©e_lßd
(
İs
, 
svc
->
rqd
, svc, 1, 
now
);

960 
	`runq_š£¹
(
İs
, 
vc
->
´oûssÜ
, 
svc
);

961 
	`runq_tickË
(
İs
, 
vc
->
´oûssÜ
, 
svc
, 
now
);

963 
out
:

964 
	`d2´štk
("w-\n");

966 
	}
}

969 
	$csched_cÚ‹xt_§ved
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

971 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

972 
s_time_t
 
now
 = 
	`NOW
();

974 
	`vıu_scheduË_lock_œq
(
vc
);

976 
	`BUG_ON
Ğ!
	`is_idË_vıu
(
vc
è&& 
svc
->
rqd
 !ğ
	`RQD
(
İs
, vc->
´oûssÜ
));

979 
	`ş—r_b™
(
__CSFLAG_scheduËd
, &
svc
->
æags
);

989 iàĞ
	`‹¡_ªd_ş—r_b™
(
__CSFLAG_d–ayed_runq_add
, &
svc
->
æags
)

990 && 
	`lik–y
(
	`vıu_ruÂabË
(
vc
)) )

992 
	`BUG_ON
(
	`__vıu_Ú_runq
(
svc
));

994 
	`runq_š£¹
(
İs
, 
vc
->
´oûssÜ
, 
svc
);

995 
	`runq_tickË
(
İs
, 
vc
->
´oûssÜ
, 
svc
, 
now
);

997 iàĞ!
	`is_idË_vıu
(
vc
) )

998 
	`upd©e_lßd
(
İs
, 
svc
->
rqd
, svc, -1, 
now
);

1000 
	`vıu_scheduË_uÆock_œq
(
vc
);

1001 
	}
}

1003 
	#MAX_LOAD
 (1ULL<<60);

	)

1005 
	$choo£_ıu
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

1007 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1008 
i
, 
mš_rqi
 = -1, 
Ãw_ıu
;

1009 
csched_vıu
 *
svc
 = 
	`CSCHED_VCPU
(
vc
);

1010 
s_time_t
 
mš_avglßd
;

1012 
	`BUG_ON
(
	`ıus_em±y
(
´v
->
aùive_queues
));

1029 iàĞ!
	`¥š_Œylock
(&
´v
->
lock
) )

1031 iàĞ
	`‹¡_ªd_ş—r_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
svc
->
æags
) )

1033 
	`d2´štk
("d%dv%d -\n", 
svc
->
vıu
->
domaš
->
domaš_id
, svc->vıu->
vıu_id
);

1034 
	`ş—r_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
svc
->
æags
);

1038  
vc
->
´oûssÜ
;

1043 iàĞ
	`‹¡_ªd_ş—r_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
svc
->
æags
) )

1045 iàĞ
	`uÆik–y
(
svc
->
mig¿‹_rqd
->
id
 < 0) )

1047 
	`´štk
("%s: Runqueue migrate‡borted becausearget„unqueue disappeared!\n",

1048 
__func__
);

1053 
	`d2´štk
("d%dv%d +\n", 
svc
->
vıu
->
domaš
->
domaš_id
, svc->vıu->
vıu_id
);

1054 
Ãw_ıu
 = 
	`fœ¡_ıu
(
svc
->
mig¿‹_rqd
->
aùive
);

1055 
out_up
;

1061 
mš_avglßd
 = 
MAX_LOAD
;

1064 
	`fÜ_—ch_ıu_mask
(
i
, 
´v
->
aùive_queues
)

1066 
csched_runqueue_d©a
 *
rqd
;

1067 
s_time_t
 
rqd_avglßd
;

1069 
rqd
 = 
´v
->rqd + 
i
;

1077 iàĞ
rqd
 =ğ
svc
->rqd )

1079 
rqd_avglßd
 = 
rqd
->
b_avglßd
 - 
svc
->
avglßd
;

1081 iàĞ
	`¥š_Œylock
(&
rqd
->
lock
) )

1083 
rqd_avglßd
 = 
rqd
->
b_avglßd
;

1084 
	`¥š_uÆock
(&
rqd
->
lock
);

1089 iàĞ
rqd_avglßd
 < 
mš_avglßd
 )

1091 
mš_avglßd
 = 
rqd_avglßd
;

1092 
mš_rqi
=
i
;

1097 iàĞ
mš_rqi
 == -1 )

1098 
Ãw_ıu
 = 
vc
->
´oûssÜ
;

1101 
	`BUG_ON
(
	`ıus_em±y
(
´v
->
rqd
[
mš_rqi
].
aùive
));

1102 
Ãw_ıu
 = 
	`fœ¡_ıu
(
´v
->
rqd
[
mš_rqi
].
aùive
);

1105 
out_up
:

1106 
	`¥š_uÆock
(&
´v
->
lock
);

1108  
Ãw_ıu
;

1109 
	}
}

1114 
s_time_t
 
	mlßd_d–
;

1115 
csched_vıu
 * 
	mbe¡_push_svc
, *
	mbe¡_puÎ_svc
;

1117 
csched_runqueue_d©a
 *
	mÌqd
;

1118 
csched_runqueue_d©a
 *
	mÜqd
;

1119 } 
	tb®ªû_¡©e_t
;

1121 
	$cÚsid”
(
b®ªû_¡©e_t
 *
¡
,

1122 
csched_vıu
 *
push_svc
,

1123 
csched_vıu
 *
puÎ_svc
)

1125 
s_time_t
 
l_lßd
, 
o_lßd
, 
d–
;

1127 
l_lßd
 = 
¡
->
Ìqd
->
b_avglßd
;

1128 
o_lßd
 = 
¡
->
Üqd
->
b_avglßd
;

1129 iàĞ
push_svc
 )

1132 
l_lßd
 -ğ
push_svc
->
avglßd
;

1133 
o_lßd
 +ğ
push_svc
->
avglßd
;

1135 iàĞ
puÎ_svc
 )

1138 
l_lßd
 +ğ
puÎ_svc
->
avglßd
;

1139 
o_lßd
 -ğ
puÎ_svc
->
avglßd
;

1142 
d–
 = 
l_lßd
 - 
o_lßd
;

1143 iàĞ
d–
 < 0 )

1144 
d–
 = -delta;

1146 iàĞ
d–
 < 
¡
->
lßd_d–
 )

1148 
¡
->
lßd_d–
 = 
d–
;

1149 
¡
->
be¡_push_svc
=
push_svc
;

1150 
¡
->
be¡_puÎ_svc
=
puÎ_svc
;

1152 
	}
}

1155 
	$mig¿‹
(cÚ¡ 
scheduËr
 *
İs
,

1156 
csched_vıu
 *
svc
,

1157 
csched_runqueue_d©a
 *
Œqd
,

1158 
s_time_t
 
now
)

1160 iàĞ
	`‹¡_b™
(
__CSFLAG_scheduËd
, &
svc
->
æags
) )

1162 
	`d2´štk
("d%dv%d %d-%d‡\n", 
svc
->
vıu
->
domaš
->
domaš_id
, svc->vıu->
vıu_id
,

1163 
svc
->
rqd
->
id
, 
Œqd
->id);

1165 
svc
->
mig¿‹_rqd
 = 
Œqd
;

1166 
	`£t_b™
(
_VPF_mig¿tšg
, &
svc
->
vıu
->
·u£_æags
);

1167 
	`£t_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
svc
->
æags
);

1171 
Ú_runq
=0;

1173 
	`d2´štk
("d%dv%d %d-%d i\n", 
svc
->
vıu
->
domaš
->
domaš_id
, svc->vıu->
vıu_id
,

1174 
svc
->
rqd
->
id
, 
Œqd
->id);

1175 iàĞ
	`__vıu_Ú_runq
(
svc
) )

1177 
	`__runq_»move
(
svc
);

1178 
	`upd©e_lßd
(
İs
, 
svc
->
rqd
, svc, -1, 
now
);

1179 
Ú_runq
=1;

1181 
	`__runq_d—ssign
(
svc
);

1182 
svc
->
vıu
->
´oûssÜ
 = 
	`fœ¡_ıu
(
Œqd
->
aùive
);

1183 
	`__runq_assign
(
svc
, 
Œqd
);

1184 iàĞ
Ú_runq
 )

1186 
	`upd©e_lßd
(
İs
, 
svc
->
rqd
, svc, 1, 
now
);

1187 
	`runq_š£¹
(
İs
, 
svc
->
vıu
->
´oûssÜ
, svc);

1188 
	`runq_tickË
(
İs
, 
svc
->
vıu
->
´oûssÜ
, svc, 
now
);

1191 
	}
}

1194 
	$b®ªû_lßd
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
, 
s_time_t
 
now
)

1196 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1197 
i
, 
max_d–_rqi
 = -1;

1198 
li¡_h—d
 *
push_™”
, *
puÎ_™”
;

1200 
b®ªû_¡©e_t
 
¡
 = { .
be¡_push_svc
 = 
NULL
, .
be¡_puÎ_svc
 = NULL };

1212 
¡
.
Ìqd
 = 
	`RQD
(
İs
, 
ıu
);

1214 
	`__upd©e_runq_lßd
(
İs
, 
¡
.
Ìqd
, 0, 
now
);

1216 
»Œy
:

1217 iàĞ!
	`¥š_Œylock
(&
´v
->
lock
) )

1220 
¡
.
lßd_d–
 = 0;

1222 
	`fÜ_—ch_ıu_mask
(
i
, 
´v
->
aùive_queues
)

1224 
s_time_t
 
d–
;

1226 
¡
.
Üqd
 = 
´v
->
rqd
 + 
i
;

1228 iàĞ
¡
.
Üqd
 =ğ¡.
Ìqd


1229 || !
	`¥š_Œylock
(&
¡
.
Üqd
->
lock
) )

1232 
	`__upd©e_runq_lßd
(
İs
, 
¡
.
Üqd
, 0, 
now
);

1234 
d–
 = 
¡
.
Ìqd
->
b_avglßd
 - st.
Üqd
->b_avgload;

1235 iàĞ
d–
 < 0 )

1236 
d–
 = -delta;

1238 iàĞ
d–
 > 
¡
.
lßd_d–
 )

1240 
¡
.
lßd_d–
 = 
d–
;

1241 
max_d–_rqi
 = 
i
;

1244 
	`¥š_uÆock
(&
¡
.
Üqd
->
lock
);

1248 
	`¥š_uÆock
(&
´v
->
lock
);

1249 iàĞ
max_d–_rqi
 == -1 )

1250 
out
;

1253 
s_time_t
 
lßd_max
;

1254 
ıus_max
;

1257 
lßd_max
 = 
¡
.
Ìqd
->
b_avglßd
;

1258 iàĞ
¡
.
Üqd
->
b_avglßd
 > 
lßd_max
 )

1259 
lßd_max
 = 
¡
.
Üqd
->
b_avglßd
;

1261 
ıus_max
=
	`ıus_weight
(
¡
.
Ìqd
->
aùive
);

1262 iàĞ
	`ıus_weight
(
¡
.
Üqd
->
aùive
è> 
ıus_max
 )

1263 
ıus_max
 = 
	`ıus_weight
(
¡
.
Üqd
->
aùive
);

1267 iàĞ
lßd_max
 < (1ULL<<(
´v
->
lßd_wšdow_shiá
))*
ıus_max
 )

1269 iàĞ
¡
.
lßd_d–
 < (1ULL<<(
´v
->
lßd_wšdow_shiá
+
İt_und”lßd_b®ªû_tŞ”ªû
) ) )

1270 
out
;

1273 iàĞ
¡
.
lßd_d–
 < (1ULL<<(
´v
->
lßd_wšdow_shiá
+
İt_ov”lßd_b®ªû_tŞ”ªû
)) )

1274 
out
;

1281 
¡
.
Üqd
 = 
´v
->
rqd
 + 
max_d–_rqi
;

1282 iàĞ!
	`¥š_Œylock
(&
¡
.
Üqd
->
lock
) )

1283 
»Œy
;

1286 iàĞ
	`uÆik–y
(
¡
.
Üqd
->
id
 < 0) )

1287 
out_up
;

1293 
	`li¡_fÜ_—ch
Ğ
push_™”
, &
¡
.
Ìqd
->
svc
 )

1295 
šÃr_lßd_upd©ed
 = 0;

1296 
csched_vıu
 * 
push_svc
 = 
	`li¡_’Œy
(
push_™”
, csched_vıu, 
rqd_–em
);

1298 
	`__upd©e_svc_lßd
(
İs
, 
push_svc
, 0, 
now
);

1301 iàĞ
	`‹¡_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
push_svc
->
æags
) )

1304 
	`li¡_fÜ_—ch
Ğ
puÎ_™”
, &
¡
.
Üqd
->
svc
 )

1306 
csched_vıu
 * 
puÎ_svc
 = 
	`li¡_’Œy
(
puÎ_™”
, csched_vıu, 
rqd_–em
);

1308 iàĞ! 
šÃr_lßd_upd©ed
 )

1310 
	`__upd©e_svc_lßd
(
İs
, 
puÎ_svc
, 0, 
now
);

1314 iàĞ
	`‹¡_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
puÎ_svc
->
æags
) )

1317 
	`cÚsid”
(&
¡
, 
push_svc
, 
puÎ_svc
);

1320 
šÃr_lßd_upd©ed
 = 1;

1323 
	`cÚsid”
(&
¡
, 
push_svc
, 
NULL
);

1326 
	`li¡_fÜ_—ch
Ğ
puÎ_™”
, &
¡
.
Üqd
->
svc
 )

1328 
csched_vıu
 * 
puÎ_svc
 = 
	`li¡_’Œy
(
puÎ_™”
, csched_vıu, 
rqd_–em
);

1331 iàĞ
	`‹¡_b™
(
__CSFLAG_runq_mig¿‹_»que¡
, &
puÎ_svc
->
æags
) )

1335 
	`cÚsid”
(&
¡
, 
NULL
, 
puÎ_svc
);

1339 iàĞ
¡
.
be¡_push_svc
 )

1340 
	`mig¿‹
(
İs
, 
¡
.
be¡_push_svc
, st.
Üqd
, 
now
);

1341 iàĞ
¡
.
be¡_puÎ_svc
 )

1342 
	`mig¿‹
(
İs
, 
¡
.
be¡_puÎ_svc
, st.
Ìqd
, 
now
);

1344 
out_up
:

1345 
	`¥š_uÆock
(&
¡
.
Üqd
->
lock
);

1347 
out
:

1349 
	}
}

1352 
	$csched_ıu_pick
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
)

1354 
Ãw_ıu
;

1356 
Ãw_ıu
 = 
	`choo£_ıu
(
İs
, 
vc
);

1358  
Ãw_ıu
;

1359 
	}
}

1362 
	$csched_vıu_mig¿‹
(

1363 cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
vc
, 
Ãw_ıu
)

1365 
csched_vıu
 * cÚ¡ 
svc
 = 
	`CSCHED_VCPU
(
vc
);

1366 
csched_runqueue_d©a
 *
Œqd
;

1369 
	`BUG_ON
(!
	`ıu_is£t
(
Ãw_ıu
, 
	`CSCHED_PRIV
(
İs
)->
š™Ÿlized
));

1371 
Œqd
 = 
	`RQD
(
İs
, 
Ãw_ıu
);

1373 iàĞ
Œqd
 !ğ
svc
->
rqd
 )

1374 
	`mig¿‹
(
İs
, 
svc
, 
Œqd
, 
	`NOW
());

1375 
	}
}

1378 
	$csched_dom_ú
(

1379 cÚ¡ 
scheduËr
 *
İs
,

1380 
domaš
 *
d
,

1381 
x’_domùl_scheduËr_İ
 *
İ
)

1383 
csched_dom
 * cÚ¡ 
sdom
 = 
	`CSCHED_DOM
(
d
);

1384 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1385 
æags
;

1387 iàĞ
İ
->
cmd
 =ğ
XEN_DOMCTL_SCHEDOP_g‘šfo
 )

1389 
İ
->
u
.
üed™2
.
weight
 = 
sdom
->weight;

1393 
	`ASSERT
(
İ
->
cmd
 =ğ
XEN_DOMCTL_SCHEDOP_putšfo
);

1395 iàĞ
İ
->
u
.
üed™2
.
weight
 != 0 )

1397 
li¡_h—d
 *
™”
;

1398 
Şd_weight
;

1402 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

1404 
Şd_weight
 = 
sdom
->
weight
;

1406 
sdom
->
weight
 = 
İ
->
u
.
üed™2
.weight;

1409 
	`li¡_fÜ_—ch
 ( 
™”
, &
sdom
->
vıu
 )

1411 
csched_vıu
 *
svc
 = 
	`li¡_’Œy
(
™”
, csched_vıu, 
sdom_–em
);

1416 
	`vıu_scheduË_lock_œq
(
svc
->
vıu
);

1418 
	`BUG_ON
(
svc
->
rqd
 !ğ
	`RQD
(
İs
, svc->
vıu
->
´oûssÜ
));

1420 
svc
->
weight
 = 
sdom
->weight;

1421 
	`upd©e_max_weight
(
svc
->
rqd
, svc->
weight
, 
Şd_weight
);

1423 
	`vıu_scheduË_uÆock_œq
(
svc
->
vıu
);

1426 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1431 
	}
}

1434 
	$csched_®loc_domd©a
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

1436 
csched_dom
 *
sdom
;

1437 
æags
;

1439 
sdom
 = 
	`xm®loc
(
csched_dom
);

1440 iàĞ
sdom
 =ğ
NULL
 )

1441  
NULL
;

1442 
	`mem£t
(
sdom
, 0, (*sdom));

1445 
	`INIT_LIST_HEAD
(&
sdom
->
vıu
);

1446 
	`INIT_LIST_HEAD
(&
sdom
->
sdom_–em
);

1447 
sdom
->
dom
 = dom;

1448 
sdom
->
weight
 = 
CSCHED_DEFAULT_WEIGHT
;

1449 
sdom
->
Ä_vıus
 = 0;

1451 
	`¥š_lock_œq§ve
(&
	`CSCHED_PRIV
(
İs
)->
lock
, 
æags
);

1453 
	`li¡_add_
(&
sdom
->
sdom_–em
, &
	`CSCHED_PRIV
(
İs
)->sdom);

1455 
	`¥š_uÆock_œq»¡Üe
(&
	`CSCHED_PRIV
(
İs
)->
lock
, 
æags
);

1457  (*)
sdom
;

1458 
	}
}

1461 
	$csched_dom_š™
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

1463 
csched_dom
 *
sdom
;

1465 
	`´štk
("%s: In™Ÿlizšg domaš %d\n", 
__func__
, 
dom
->
domaš_id
);

1467 iàĞ
	`is_idË_domaš
(
dom
) )

1470 
sdom
 = 
	`csched_®loc_domd©a
(
İs
, 
dom
);

1471 iàĞ
sdom
 =ğ
NULL
 )

1472  -
ENOMEM
;

1474 
dom
->
sched_´iv
 = 
sdom
;

1477 
	}
}

1480 
	$csched_ä“_domd©a
(cÚ¡ 
scheduËr
 *
İs
, *
d©a
)

1482 
æags
;

1483 
csched_dom
 *
sdom
 = 
d©a
;

1485 
	`¥š_lock_œq§ve
(&
	`CSCHED_PRIV
(
İs
)->
lock
, 
æags
);

1487 
	`li¡_d–_š™
(&
sdom
->
sdom_–em
);

1489 
	`¥š_uÆock_œq»¡Üe
(&
	`CSCHED_PRIV
(
İs
)->
lock
, 
æags
);

1491 
	`xä“
(
d©a
);

1492 
	}
}

1495 
	$csched_dom_de¡roy
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
dom
)

1497 
csched_dom
 *
sdom
 = 
	`CSCHED_DOM
(
dom
);

1499 
	`BUG_ON
(!
	`li¡_em±y
(&
sdom
->
vıu
));

1501 
	`csched_ä“_domd©a
(
İs
, 
	`CSCHED_DOM
(
dom
));

1502 
	}
}

1505 
s_time_t


1506 
	$csched_ruÁime
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
, 
csched_vıu
 *
¢ext
)

1508 
s_time_t
 
time
 = 
CSCHED_MAX_TIMER
;

1509 
csched_runqueue_d©a
 *
rqd
 = 
	`RQD
(
İs
, 
ıu
);

1510 
li¡_h—d
 *
runq
 = &
rqd
->runq;

1512 iàĞ
	`is_idË_vıu
(
¢ext
->
vıu
) )

1513  
CSCHED_MAX_TIMER
;

1516 
time
 = 
	`c2t
(
rqd
, 
¢ext
->
üed™
, snext);

1519 iàĞ! 
	`li¡_em±y
(
runq
) )

1521 
csched_vıu
 *
svc
 = 
	`__runq_–em
(
runq
->
Ãxt
);

1522 
s_time_t
 
Áime
;

1524 iàĞ! 
	`is_idË_vıu
(
svc
->
vıu
) )

1526 
Áime
 = 
	`c2t
(
rqd
, 
¢ext
->
üed™
 - 
svc
->credit, snext);

1528 iàĞ
time
 > 
Áime
 )

1529 
time
 = 
Áime
;

1534 iàĞ
time
 < 
CSCHED_MIN_TIMER
 )

1535 
time
 = 
CSCHED_MIN_TIMER
;

1536 iàĞ
time
 > 
CSCHED_MAX_TIMER
 )

1537 
time
 = 
CSCHED_MAX_TIMER
;

1539  
time
;

1540 
	}
}

1542 
__dump_exec¡©e
(*
unu£d
);

1547 
csched_vıu
 *

1548 
	$runq_ÿndid©e
(
csched_runqueue_d©a
 *
rqd
,

1549 
csched_vıu
 *
scu¼
,

1550 
ıu
, 
s_time_t
 
now
)

1552 
li¡_h—d
 *
™”
;

1553 
csched_vıu
 *
¢ext
 = 
NULL
;

1556 iàĞ
	`vıu_ruÂabË
(
scu¼
->
vıu
) )

1557 
¢ext
 = 
scu¼
;

1559 
¢ext
 = 
	`CSCHED_VCPU
(
idË_vıu
[
ıu
]);

1561 
	`li¡_fÜ_—ch
Ğ
™”
, &
rqd
->
runq
 )

1563 
csched_vıu
 * 
svc
 = 
	`li¡_’Œy
(
™”
, csched_vıu, 
runq_–em
);

1567 iàĞ
svc
->
vıu
->
´oûssÜ
 !ğ
ıu


1568 && 
¢ext
->
üed™
 + 
CSCHED_MIGRATE_RESIST
 > 
svc
->credit )

1573 iàĞ
svc
->
üed™
 > 
¢ext
->credit )

1574 
¢ext
 = 
svc
;

1581  
¢ext
;

1582 
	}
}

1588 
sk_¦iû


1589 
	$csched_scheduË
(

1590 cÚ¡ 
scheduËr
 *
İs
, 
s_time_t
 
now
, 
boŞ_t
 
skËt_wÜk_scheduËd
)

1592 cÚ¡ 
ıu
 = 
	`smp_´oûssÜ_id
();

1593 
csched_runqueue_d©a
 *
rqd
;

1594 
csched_vıu
 * cÚ¡ 
scu¼
 = 
	`CSCHED_VCPU
(
cu¼’t
);

1595 
csched_vıu
 *
¢ext
 = 
NULL
;

1596 
sk_¦iû
 
»t
;

1598 
	`CSCHED_VCPU_CHECK
(
cu¼’t
);

1600 
	`d2´štk
("søp%d c d%dv%d‚ow %"
PRI_¡ime
"\n",

1601 
ıu
,

1602 
scu¼
->
vıu
->
domaš
->
domaš_id
,

1603 
scu¼
->
vıu
->
vıu_id
,

1604 
now
);

1606 
	`BUG_ON
(!
	`ıu_is£t
(
ıu
, 
	`CSCHED_PRIV
(
İs
)->
š™Ÿlized
));

1608 
rqd
 = 
	`RQD
(
İs
, 
ıu
);

1609 
	`BUG_ON
(!
	`ıu_is£t
(
ıu
, 
rqd
->
aùive
));

1613 
	`BUG_ON
(!
	`is_idË_vıu
(
scu¼
->
vıu
è&& scu¼->
rqd
 !=„qd);

1616 iàĞ
	`ıu_is£t
(
ıu
, 
rqd
->
tickËd
) )

1617 
	`ıu_ş—r
(
ıu
, 
rqd
->
tickËd
);

1620 
	`buº_üed™s
(
rqd
, 
scu¼
, 
now
);

1640 iàĞ
skËt_wÜk_scheduËd
 )

1642 
	`Œaû_v¬
(
TRC_CSCHED2_SCHED_TASKLET
, 0, 0, 
NULL
);

1643 
¢ext
 = 
	`CSCHED_VCPU
(
idË_vıu
[
ıu
]);

1646 
¢ext
=
	`runq_ÿndid©e
(
rqd
, 
scu¼
, 
ıu
, 
now
);

1650 iàĞ
¢ext
 !ğ
scu¼


1651 && !
	`is_idË_vıu
(
scu¼
->
vıu
)

1652 && 
	`vıu_ruÂabË
(
cu¼’t
) )

1653 
	`£t_b™
(
__CSFLAG_d–ayed_runq_add
, &
scu¼
->
æags
);

1655 
»t
.
mig¿‹d
 = 0;

1658 iàĞ!
	`is_idË_vıu
(
¢ext
->
vıu
) )

1661 iàĞ
¢ext
 !ğ
scu¼
 )

1663 
	`BUG_ON
(
¢ext
->
rqd
 !=„qd);

1665 
	`__runq_»move
(
¢ext
);

1666 iàĞ
¢ext
->
vıu
->
is_ruÂšg
 )

1668 
	`´štk
("p%d: snext d%dv%d„unning on…%d! scurr d%dv%d\n",

1669 
ıu
,

1670 
¢ext
->
vıu
->
domaš
->
domaš_id
, sÃxt->vıu->
vıu_id
,

1671 
¢ext
->
vıu
->
´oûssÜ
,

1672 
scu¼
->
vıu
->
domaš
->
domaš_id
,

1673 
scu¼
->
vıu
->
vıu_id
);

1674 
	`BUG
();

1676 
	`£t_b™
(
__CSFLAG_scheduËd
, &
¢ext
->
æags
);

1680 iàĞ
¢ext
->
üed™
 <ğ
CSCHED_CREDIT_RESET
 )

1682 
	`»£t_üed™
(
İs
, 
ıu
, 
now
);

1683 
	`b®ªû_lßd
(
İs
, 
ıu
, 
now
);

1687 iàĞ
	`ıu_is£t
(
ıu
, 
rqd
->
idË
) )

1688 
	`ıu_ş—r
(
ıu
, 
rqd
->
idË
);

1690 
¢ext
->
¡¬t_time
 = 
now
;

1693 iàĞ
¢ext
->
vıu
->
´oûssÜ
 !ğ
ıu
 )

1695 
¢ext
->
üed™
 +ğ
CSCHED_MIGRATE_COMPENSATION
;

1696 
¢ext
->
vıu
->
´oûssÜ
 = 
ıu
;

1697 
»t
.
mig¿‹d
 = 1;

1703 iàĞ!
	`ıu_is£t
(
ıu
, 
rqd
->
idË
) )

1704 
	`ıu_£t
(
ıu
, 
rqd
->
idË
);

1707 
	`upd©e_lßd
(
İs
, 
rqd
, 
NULL
, 0, 
now
);

1713 
»t
.
time
 = 
	`csched_ruÁime
(
İs
, 
ıu
, 
¢ext
);

1714 
»t
.
sk
 = 
¢ext
->
vıu
;

1716 
	`CSCHED_VCPU_CHECK
(
»t
.
sk
);

1717  
»t
;

1718 
	}
}

1721 
	$csched_dump_vıu
(
csched_vıu
 *
svc
)

1723 
	`´štk
("[%i.%i] flags=%x cpu=%i",

1724 
svc
->
vıu
->
domaš
->
domaš_id
,

1725 
svc
->
vıu
->
vıu_id
,

1726 
svc
->
æags
,

1727 
svc
->
vıu
->
´oûssÜ
);

1729 
	`´štk
(" c»d™=%" 
PRIi32
" [w=%u]", 
svc
->
üed™
, svc->
weight
);

1731 
	`´štk
("\n");

1732 
	}
}

1735 
	$csched_dump_pıu
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

1737 
li¡_h—d
 *
runq
, *
™”
;

1738 
csched_vıu
 *
svc
;

1739 
loİ
;

1740 
ıu¡r
[100];

1744 
runq
 = &
	`RQD
(
İs
, 
ıu
)->runq;

1746 
	`ıumask_sú´štf
(
ıu¡r
, (ıu¡r), 
	`³r_ıu
(
ıu_siblšg_m­
,
ıu
));

1747 
	`´štk
(" siblšg=%s, ", 
ıu¡r
);

1748 
	`ıumask_sú´štf
(
ıu¡r
, (ıu¡r), 
	`³r_ıu
(
ıu_cÜe_m­
,
ıu
));

1749 
	`´štk
("cÜe=%s\n", 
ıu¡r
);

1752 
svc
 = 
	`CSCHED_VCPU
(
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
cu¼
);

1753 iàĞ
svc
 )

1755 
	`´štk
("\trun: ");

1756 
	`csched_dump_vıu
(
svc
);

1759 
loİ
 = 0;

1760 
	`li¡_fÜ_—ch
Ğ
™”
, 
runq
 )

1762 
svc
 = 
	`__runq_–em
(
™”
);

1763 iàĞ
svc
 )

1765 
	`´štk
("\t%3d: ", ++
loİ
);

1766 
	`csched_dump_vıu
(
svc
);

1769 
	}
}

1772 
	$csched_dump
(cÚ¡ 
scheduËr
 *
İs
)

1774 
li¡_h—d
 *
™”_sdom
, *
™”_svc
;

1775 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1776 
i
, 
loİ
;

1778 
	`´štk
("Active queues: %d\n"

1780 
	`ıus_weight
(
´v
->
aùive_queues
),

1781 
CSCHED_DEFAULT_WEIGHT
);

1782 
	`fÜ_—ch_ıu_mask
(
i
, 
´v
->
aùive_queues
)

1784 
s_time_t
 
äaùiÚ
;

1786 
äaùiÚ
 = 
´v
->
rqd
[
i
].
avglßd
 * 100 / (1ULL<<´v->
lßd_wšdow_shiá
);

1788 
	`´štk
("Runqueue %d:\n"

1792 "\v–ßd = %3"
PRI_¡ime
"\n",

1793 
i
,

1794 
	`ıus_weight
(
´v
->
rqd
[
i
].
aùive
),

1795 
´v
->
rqd
[
i
].
max_weight
,

1796 
´v
->
rqd
[
i
].
lßd
,

1797 
äaùiÚ
);

1802 
	`´štk
("Domain info:\n");

1803 
loİ
 = 0;

1804 
	`li¡_fÜ_—ch
Ğ
™”_sdom
, &
´v
->
sdom
 )

1806 
csched_dom
 *
sdom
;

1807 
sdom
 = 
	`li¡_’Œy
(
™”_sdom
, 
csched_dom
, 
sdom_–em
);

1809 
	`´štk
("\tDomain: %d w %d v %d\n\t",

1810 
sdom
->
dom
->
domaš_id
,

1811 
sdom
->
weight
,

1812 
sdom
->
Ä_vıus
);

1814 
	`li¡_fÜ_—ch
Ğ
™”_svc
, &
sdom
->
vıu
 )

1816 
csched_vıu
 *
svc
;

1817 
svc
 = 
	`li¡_’Œy
(
™”_svc
, 
csched_vıu
, 
sdom_–em
);

1819 
	`´štk
("\t%3d: ", ++
loİ
);

1820 
	`csched_dump_vıu
(
svc
);

1823 
	}
}

1825 
	$aùiv©e_runqueue
(
csched_´iv©e
 *
´v
, 
rqi
)

1827 
csched_runqueue_d©a
 *
rqd
;

1829 
rqd
 = 
´v
->rqd + 
rqi
;

1831 
	`BUG_ON
(!
	`ıus_em±y
(
rqd
->
aùive
));

1833 
rqd
->
max_weight
 = 1;

1834 
rqd
->
id
 = 
rqi
;

1835 
	`INIT_LIST_HEAD
(&
rqd
->
svc
);

1836 
	`INIT_LIST_HEAD
(&
rqd
->
runq
);

1837 
	`¥š_lock_š™
(&
rqd
->
lock
);

1839 
	`ıu_£t
(
rqi
, 
´v
->
aùive_queues
);

1840 
	}
}

1842 
	$d—ùiv©e_runqueue
(
csched_´iv©e
 *
´v
, 
rqi
)

1844 
csched_runqueue_d©a
 *
rqd
;

1846 
rqd
 = 
´v
->rqd + 
rqi
;

1848 
	`BUG_ON
(!
	`ıus_em±y
(
rqd
->
aùive
));

1850 
rqd
->
id
 = -1;

1852 
	`ıu_ş—r
(
rqi
, 
´v
->
aùive_queues
);

1853 
	}
}

1855 
	$š™_pıu
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

1857 
rqi
, 
Şd_rqi
, 
æags
;

1858 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1859 
csched_runqueue_d©a
 *
rqd
;

1860 
¥šlock_t
 *
Şd_lock
;

1862 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

1864 iàĞ
	`ıu_is£t
(
ıu
, 
´v
->
š™Ÿlized
) )

1866 
	`´štk
("%s: SŒªge, cpu %d‡Ì—dy in™Ÿlized!\n", 
__func__
, 
ıu
);

1867 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1871 
Şd_rqi
 = 
´v
->
runq_m­
[
ıu
];

1874 
rqi
 = 0;

1878 iàĞ
ıu
 == 0 )

1879 
rqi
 = 0;

1881 
rqi
 = 
	`ıu_to_sock‘
(
ıu
);

1883 iàĞ
rqi
 < 0 )

1885 
	`´štk
("%s: cpu_to_socket(%d)„eturned %d!\n",

1886 
__func__
, 
ıu
, 
rqi
);

1887 
	`BUG
();

1890 
rqd
=
´v
->rqd + 
rqi
;

1892 
	`´štk
("Addšg cpu %dØrunqueu%d\n", 
ıu
, 
rqi
);

1893 iàĞ! 
	`ıu_is£t
(
rqi
, 
´v
->
aùive_queues
) )

1895 
	`´štk
(" First cpu on„unqueue,‡ctivating\n");

1896 
	`aùiv©e_runqueue
(
´v
, 
rqi
);

1900 
Şd_lock
=
	`pıu_scheduË_lock
(
ıu
);

1903 
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
scheduË_lock
 = &
rqd
->
lock
;

1906 
´v
->
runq_m­
[
ıu
]=
rqi
;

1908 
	`ıu_£t
(
ıu
, 
rqd
->
idË
);

1909 
	`ıu_£t
(
ıu
, 
rqd
->
aùive
);

1911 
	`¥š_uÆock
(
Şd_lock
);

1913 
	`ıu_£t
(
ıu
, 
´v
->
š™Ÿlized
);

1915 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1918 
	}
}

1921 
	$csched_®loc_pd©a
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

1925 iàĞ
ıu
 =ğ0 || 
	`ıu_to_sock‘
(cpu) >= 0 )

1926 
	`š™_pıu
(
İs
, 
ıu
);

1928 
	`´štk
("%s: cpu %d‚ot online yet, deferring initializatgion\n",

1929 
__func__
, 
ıu
);

1932 
	}
}

1935 
	$csched_ä“_pd©a
(cÚ¡ 
scheduËr
 *
İs
, *
pıu
, 
ıu
)

1937 
æags
;

1938 
csched_´iv©e
 *
´v
 = 
	`CSCHED_PRIV
(
İs
);

1939 
csched_runqueue_d©a
 *
rqd
;

1940 
rqi
;

1942 
	`¥š_lock_œq§ve
(&
´v
->
lock
, 
æags
);

1944 
	`BUG_ON
Ğ!
	`ıu_is£t
(
ıu
, 
´v
->
š™Ÿlized
));

1947 
rqi
 = 
´v
->
runq_m­
[
ıu
];

1949 
rqd
 = 
´v
->rqd + 
rqi
;

1952 
	`¥š_lock
(&
rqd
->
lock
);

1954 
	`BUG_ON
(!
	`ıu_is£t
(
ıu
, 
rqd
->
idË
));

1956 
	`´štk
("Removšg cpu %d from„unqueu%d\n", 
ıu
, 
rqi
);

1958 
	`ıu_ş—r
(
ıu
, 
rqd
->
idË
);

1959 
	`ıu_ş—r
(
ıu
, 
rqd
->
aùive
);

1961 iàĞ
	`ıus_em±y
(
rqd
->
aùive
) )

1963 
	`´štk
(" No cpus†eft on„unqueue, disabling\n");

1964 
	`d—ùiv©e_runqueue
(
´v
, 
rqi
);

1967 
	`¥š_uÆock
(&
rqd
->
lock
);

1969 
	`ıu_ş—r
(
ıu
, 
´v
->
š™Ÿlized
);

1971 
	`¥š_uÆock_œq»¡Üe
(&
´v
->
lock
, 
æags
);

1974 
	}
}

1977 
	$csched_ıu_¡¬tšg
(
ıu
)

1979 
scheduËr
 *
İs
;

1982 
İs
 = 
	`³r_ıu
(
scheduËr
, 
ıu
);

1984 
	`š™_pıu
(
İs
, 
ıu
);

1986  
NOTIFY_DONE
;

1987 
	}
}

1989 
	$ıu_üed™2_ÿÎback
(

1990 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

1992 
ıu
 = ()
hıu
;

1993 
rc
 = 0;

1995  
aùiÚ
 )

1997 
CPU_STARTING
:

1998 
	`csched_ıu_¡¬tšg
(
ıu
);

2004  !
rc
 ? 
NOTIFY_DONE
 : 
	`nÙif›r_äom_”ºo
(rc);

2005 
	}
}

2007 
nÙif›r_block
 
	gıu_üed™2_nfb
 = {

2008 .
nÙif›r_ÿÎ
 = 
ıu_üed™2_ÿÎback


2012 
	$csched_š™
(
scheduËr
 *
İs
)

2014 
i
;

2015 
csched_´iv©e
 *
´v
;

2017 
	`´štk
("Initializing Credit2 scheduler\n" \

2021 
	`´štk
("†ßd_wšdow_shiá: %d\n", 
İt_lßd_wšdow_shiá
);

2022 
	`´štk
(" und”lßd_b®ªû_tŞ”ªû: %d\n", 
İt_und”lßd_b®ªû_tŞ”ªû
);

2023 
	`´štk
(" ov”lßd_b®ªû_tŞ”ªû: %d\n", 
İt_ov”lßd_b®ªû_tŞ”ªû
);

2025 iàĞ
İt_lßd_wšdow_shiá
 < 
LOADAVG_WINDOW_SHIFT_MIN
 )

2027 
	`´štk
("%s: opt_load_window_shift %d below min %d,„esetting\n",

2028 
__func__
, 
İt_lßd_wšdow_shiá
, 
LOADAVG_WINDOW_SHIFT_MIN
);

2029 
İt_lßd_wšdow_shiá
 = 
LOADAVG_WINDOW_SHIFT_MIN
;

2036 
´v
 = 
	`xm®loc
(
csched_´iv©e
);

2037 iàĞ
´v
 =ğ
NULL
 )

2038  -
ENOMEM
;

2039 
	`mem£t
(
´v
, 0, (*prv));

2040 
İs
->
sched_d©a
 = 
´v
;

2041 
	`¥š_lock_š™
(&
´v
->
lock
);

2042 
	`INIT_LIST_HEAD
(&
´v
->
sdom
);

2044 
	`»gi¡”_ıu_nÙif›r
(&
ıu_üed™2_nfb
);

2047  
i
=0; i<
NR_CPUS
; i++)

2049 
´v
->
runq_m­
[
i
] = -1;

2050 
´v
->
rqd
[
i
].
id
 = -1;

2053 
´v
->
lßd_wšdow_shiá
 = 
İt_lßd_wšdow_shiá
;

2056 
	}
}

2059 
	$csched_deš™
(cÚ¡ 
scheduËr
 *
İs
)

2061 
csched_´iv©e
 *
´v
;

2063 
´v
 = 
	`CSCHED_PRIV
(
İs
);

2064 iàĞ
´v
 !ğ
NULL
 )

2065 
	`xä“
(
´v
);

2066 
	}
}

2069 
csched_´iv©e
 
	g_csched_´iv
;

2071 cÚ¡ 
scheduËr
 
	gsched_üed™2_def
 = {

2072 .
Çme
 = "SMP Credit Scheduler„ev2",

2073 .
	gİt_Çme
 = "credit2",

2074 .
	gsched_id
 = 
XEN_SCHEDULER_CREDIT2
,

2075 .
	gsched_d©a
 = &
_csched_´iv
,

2077 .
	gš™_domaš
 = 
csched_dom_š™
,

2078 .
	gde¡roy_domaš
 = 
csched_dom_de¡roy
,

2080 .
	gš£¹_vıu
 = 
csched_vıu_š£¹
,

2081 .
	g»move_vıu
 = 
csched_vıu_»move
,

2083 .
	g¦“p
 = 
csched_vıu_¦“p
,

2084 .
	gwake
 = 
csched_vıu_wake
,

2086 .
	gadju¡
 = 
csched_dom_ú
,

2088 .
	gpick_ıu
 = 
csched_ıu_pick
,

2089 .
	gmig¿‹
 = 
csched_vıu_mig¿‹
,

2090 .
	gdo_scheduË
 = 
csched_scheduË
,

2091 .
	gcÚ‹xt_§ved
 = 
csched_cÚ‹xt_§ved
,

2093 .
	gdump_ıu_¡©e
 = 
csched_dump_pıu
,

2094 .
	gdump_£‰šgs
 = 
csched_dump
,

2095 .
	gš™
 = 
csched_š™
,

2096 .
	gdeš™
 = 
csched_deš™
,

2097 .
	g®loc_vd©a
 = 
csched_®loc_vd©a
,

2098 .
	gä“_vd©a
 = 
csched_ä“_vd©a
,

2099 .
	g®loc_pd©a
 = 
csched_®loc_pd©a
,

2100 .
	gä“_pd©a
 = 
csched_ä“_pd©a
,

2101 .
	g®loc_domd©a
 = 
csched_®loc_domd©a
,

2102 .
	gä“_domd©a
 = 
csched_ä“_domd©a
,

	@sched_sedf.c

8 
	~<x’/lib.h
>

9 
	~<x’/sched.h
>

10 
	~<x’/sched-if.h
>

11 
	~<x’/tim”.h
>

12 
	~<x’/soáœq.h
>

13 
	~<x’/time.h
>

14 
	~<x’/”ºo.h
>

17 
	#SEDFLEVEL
 0

	)

18 
	#PRINT
(
_f
, 
_a
...) \

20 iàĞ(
_f
è<ğ
SEDFLEVEL
 ) \

21 
	`´štk
(
_a
 ); \

22 }  0 )

	)

24 
	#SEDF_CPUONLINE
(
_poŞ
) \

25 (((
_poŞ
è=ğ
NULL
è? &
ıupoŞ_ä“_ıus
 : &(_poŞ)->
ıu_v®id
)

	)

27 #iâdeà
NDEBUG


28 
	#SEDF_STATS


	)

29 
	#CHECK
(
_p
) \

31 iàĞ!(
_p
) ) \

32 
	`´štk
("Check '%s' failed,†ine %d, file %s\n", \

33 #_°, 
__LINE__
, 
__FILE__
); \

34 }  0 )

	)

36 
	#CHECK
(
_p
è(()0)

	)

39 
	#EXTRA_NONE
 (0)

	)

40 
	#EXTRA_AWARE
 (1)

	)

41 
	#EXTRA_RUN_PEN
 (2)

	)

42 
	#EXTRA_RUN_UTIL
 (4)

	)

43 
	#EXTRA_WANT_PEN_Q
 (8)

	)

44 
	#EXTRA_PEN_Q
 (0)

	)

45 
	#EXTRA_UTIL_Q
 (1)

	)

46 
	#SEDF_ASLEEP
 (16)

	)

48 
	#EXTRA_QUANTUM
 (
	`MICROSECS
(500))

	)

49 
	#WEIGHT_PERIOD
 (
	`MILLISECS
(100))

	)

50 
	#WEIGHT_SAFETY
 (
	`MILLISECS
(5))

	)

52 
	#PERIOD_MAX
 
	`MILLISECS
(10000è

	)

53 
	#PERIOD_MIN
 (
	`MICROSECS
(10)è

	)

54 
	#SLICE_MIN
 (
	`MICROSECS
(5)è

	)

56 
	#IMPLY
(
a
, 
b
è(!×è|| (b))

	)

57 
	#EQ
(
a
, 
b
è((!!×)è=ğ(!!(b)))

	)

60 
	s£df_dom_šfo
 {

61 
domaš
 *
	mdomaš
;

64 
	s£df_vıu_šfo
 {

65 
vıu
 *
	mvıu
;

66 
li¡_h—d
 
	mli¡
;

67 
li¡_h—d
 
	mexŒ®i¡
[2];

70 
s_time_t
 
	m³riod
;

71 
s_time_t
 
	m¦iû
;

75 
s_time_t
 
	m³riod_Üig
;

76 
s_time_t
 
	m¦iû_Üig
;

77 
s_time_t
 
	mÏ‹ncy
;

80 
	m¡©us
;

82 
	mweight
;

83 
	mexŒaweight
;

85 
s_time_t
 
	md—dl_abs
;

86 
s_time_t
 
	msched_¡¬t_abs
;

87 
s_time_t
 
	mıutime
;

89 
s_time_t
 
	mblock_abs
;

90 
s_time_t
 
	munblock_abs
;

93 
	mscÜe
[2];

94 
s_time_t
 
	mshÜt_block_lo¡_tÙ
;

97 
s_time_t
 
	mexŒa_time_tÙ
;

99 #ifdeà
SEDF_STATS


100 
s_time_t
 
	mblock_time_tÙ
;

101 
s_time_t
 
	m³ÇÉy_time_tÙ
;

102 
	mblock_tÙ
;

103 
	mshÜt_block_tÙ
;

104 
	mlÚg_block_tÙ
;

105 
	mshÜt_cÚt
;

106 
	m³n_exŒa_blocks
;

107 
	m³n_exŒa_¦iûs
;

111 
	s£df_ıu_šfo
 {

112 
li¡_h—d
 
	mruÂabËq
;

113 
li¡_h—d
 
	mwa™q
;

114 
li¡_h—d
 
	mexŒaq
[2];

115 
s_time_t
 
	mcu¼’t_¦iû_expœes
;

118 
	#EDOM_INFO
(
d
è((
£df_vıu_šfo
 *)((d)->
sched_´iv
))

	)

119 
	#CPU_INFO
(
ıu
) \

120 ((
£df_ıu_šfo
 *)
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
sched_´iv
)

	)

121 
	#LIST
(
d
è(&
	`EDOM_INFO
(d)->
li¡
)

	)

122 
	#EXTRALIST
(
d
,
i
è(&(
	`EDOM_INFO
(d)->
exŒ®i¡
[i]))

	)

123 
	#RUNQ
(
ıu
è(&
	`CPU_INFO
(ıu)->
ruÂabËq
)

	)

124 
	#WAITQ
(
ıu
è(&
	`CPU_INFO
(ıu)->
wa™q
)

	)

125 
	#EXTRAQ
(
ıu
,
i
è(&(
	`CPU_INFO
(ıu)->
exŒaq
[i]))

	)

126 
	#IDLETASK
(
ıu
è(
idË_vıu
[ıu])

	)

128 
	#PERIOD_BEGIN
(
šf
è((šf)->
d—dl_abs
 - (šf)->
³riod
)

	)

130 
	#DIV_UP
(
x
,
y
è(((xè+ (yè- 1è/ y)

	)

132 
	#exŒa_runs
(
šf
è((šf->
¡©us
è& 6)

	)

133 
	#exŒa_g‘_cur_q
(
šf
è(((šf->
¡©us
 & 6è>> 1)-1)

	)

134 
	#£df_ruÂabË
(
edom
è(!(
	`EDOM_INFO
Ódom)->
¡©us
 & 
SEDF_ASLEEP
))

	)

137 
£df_dump_ıu_¡©e
(cÚ¡ 
scheduËr
 *
İs
, 
i
);

139 
šlše
 
	$exŒaq_Ú
(
vıu
 *
d
, 
i
)

141  ((
	`EXTRALIST
(
d
,
i
)->
Ãxt
 !ğ
NULL
) &&

142 (
	`EXTRALIST
(
d
,
i
)->
Ãxt
 != EXTRALIST(d,i)));

143 
	}
}

145 
šlše
 
	$exŒaq_add_h—d
(
vıu
 *
d
, 
i
)

147 
	`li¡_add
(
	`EXTRALIST
(
d
,
i
), 
	`EXTRAQ
(d->
´oûssÜ
,i));

148 
	`ASSERT
(
	`exŒaq_Ú
(
d
, 
i
));

149 
	}
}

151 
šlše
 
	$exŒaq_add_
(
vıu
 *
d
, 
i
)

153 
	`li¡_add_
(
	`EXTRALIST
(
d
,
i
), 
	`EXTRAQ
(d->
´oûssÜ
,i));

154 
	`ASSERT
(
	`exŒaq_Ú
(
d
, 
i
));

155 
	}
}

157 
šlše
 
	$exŒaq_d–
(
vıu
 *
d
, 
i
)

159 
li¡_h—d
 *
li¡
 = 
	`EXTRALIST
(
d
,
i
);

160 
	`ASSERT
(
	`exŒaq_Ú
(
d
,
i
));

161 
	`PRINT
(3, "Removing domain %i.%i from L%iƒxtraq\n",

162 
d
->
domaš
->
domaš_id
, d->
vıu_id
, 
i
);

163 
	`li¡_d–
(
li¡
);

164 
li¡
->
Ãxt
 = 
NULL
;

165 
	`ASSERT
(!
	`exŒaq_Ú
(
d
, 
i
));

166 
	}
}

174 
šlše
 
	$exŒaq_add_sÜt_upd©e
(
vıu
 *
d
, 
i
, 
sub
)

176 
li¡_h—d
 *
cur
;

177 
£df_vıu_šfo
 *
curšf
;

179 
	`ASSERT
(!
	`exŒaq_Ú
(
d
,
i
));

181 
	`PRINT
(3, "Addšg domaš %i.%˜(scÜeğ%i, shÜt_³nğ%"
PRIi64
")"

183 
d
->
domaš
->
domaš_id
, d->
vıu_id
, 
	`EDOM_INFO
(d)->
scÜe
[
i
],

184 
	`EDOM_INFO
(
d
)->
shÜt_block_lo¡_tÙ
, 
i
);

190 
	`li¡_fÜ_—ch
 ( 
cur
, 
	`EXTRAQ
(
d
->
´oûssÜ
, 
i
) )

192 
curšf
 = 
	`li¡_’Œy
(
cur
,
£df_vıu_šfo
,
exŒ®i¡
[
i
]);

193 
curšf
->
scÜe
[
i
] -ğ
sub
;

194 iàĞ
	`EDOM_INFO
(
d
)->
scÜe
[
i
] < 
curšf
->score[i] )

196 
	`PRINT
(4,"\tbehind domain %i.%i (score= %i)\n",

197 
curšf
->
vıu
->
domaš
->
domaš_id
,

198 
curšf
->
vıu
->
vıu_id
, curšf->
scÜe
[
i
]);

202 
	`PRINT
(3, "\i¡_addØ%p\n", 
cur
->
´ev
);

203 
	`li¡_add
(
	`EXTRALIST
(
d
,
i
),
cur
->
´ev
);

206 iàĞ(
cur
 !ğ
	`EXTRAQ
(
d
->
´oûssÜ
,
i
)è&& 
sub
 )

208  
cur
 = cur->
Ãxt
; cu¸!ğ
	`EXTRAQ
(
d
->
´oûssÜ
,
i
); cur = cur->next )

210 
curšf
 = 
	`li¡_’Œy
(
cur
,
£df_vıu_šfo
, 
exŒ®i¡
[
i
]);

211 
curšf
->
scÜe
[
i
] -ğ
sub
;

212 
	`PRINT
(4, "\tupdating domain %i.%i (score= %u)\n",

213 
curšf
->
vıu
->
domaš
->
domaš_id
,

214 
curšf
->
vıu
->
vıu_id
, curšf->
scÜe
[
i
]);

218 
	`ASSERT
(
	`exŒaq_Ú
(
d
,
i
));

219 
	}
}

220 
šlše
 
	$exŒaq_check
(
vıu
 *
d
)

222 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
) )

224 
	`PRINT
(2,"Dom %i.%i is on L1ƒxtraQ\n",

225 
d
->
domaš
->
domaš_id
, d->
vıu_id
);

227 iàĞ!(
	`EDOM_INFO
(
d
)->
¡©us
 & 
EXTRA_AWARE
) &&

228 !
	`exŒa_runs
(
	`EDOM_INFO
(
d
)) )

230 
	`exŒaq_d–
(
d
, 
EXTRA_UTIL_Q
);

231 
	`PRINT
(2,"Removed dom %i.%i from L1ƒxtraQ\n",

232 
d
->
domaš
->
domaš_id
, d->
vıu_id
);

237 
	`PRINT
(2, "Dom %i.%i is NOT on L1ƒxtraQ\n",

238 
d
->
domaš
->
domaš_id
,

239 
d
->
vıu_id
);

241 iàĞ(
	`EDOM_INFO
(
d
)->
¡©us
 & 
EXTRA_AWARE
è&& 
	`£df_ruÂabË
(d) )

243 
	`exŒaq_add_sÜt_upd©e
(
d
, 
EXTRA_UTIL_Q
, 0);

244 
	`PRINT
(2,"Added dom %i.%io L1ƒxtraQ\n",

245 
d
->
domaš
->
domaš_id
, d->
vıu_id
);

248 
	}
}

250 
šlše
 
	$exŒaq_check_add_unblocked
(
vıu
 *
d
, 
´iÜ™y
)

252 
£df_vıu_šfo
 *
šf
 = 
	`EDOM_INFO
(
d
);

254 iàĞ
šf
->
¡©us
 & 
EXTRA_AWARE
 )

256 
	`exŒaq_add_sÜt_upd©e
(
d
, 
EXTRA_UTIL_Q
, 0);

257 
	}
}

259 
šlše
 
	$__sk_Ú_queue
(
vıu
 *
d
)

261  (((
	`LIST
(
d
))->
Ãxt
 !ğ
NULL
) && (LIST(d)->next != LIST(d)));

262 
	}
}

264 
šlše
 
	$__d–_äom_queue
(
vıu
 *
d
)

266 
li¡_h—d
 *
li¡
 = 
	`LIST
(
d
);

267 
	`ASSERT
(
	`__sk_Ú_queue
(
d
));

268 
	`PRINT
(3,"Removšg domaš %i.%˜(bİğ%"
PRIu64
") from„unq/waitq\n",

269 
d
->
domaš
->
domaš_id
, d->
vıu_id
, 
	`PERIOD_BEGIN
(
	`EDOM_INFO
(d)));

270 
	`li¡_d–
(
li¡
);

271 
li¡
->
Ãxt
 = 
NULL
;

272 
	`ASSERT
(!
	`__sk_Ú_queue
(
d
));

273 
	}
}

275 (*
	tli¡_com·»r
)(
	tli¡_h—d
* 
	t–1
, li¡_h—d* 
	t–2
);

277 
šlše
 
	$li¡_š£¹_sÜt
(

278 
li¡_h—d
 *
li¡
, li¡_h—d *
–em’t
, 
li¡_com·»r
 
comp
)

280 
li¡_h—d
 *
cur
;

283 
	`li¡_fÜ_—ch
Ğ
cur
, 
li¡
 )

284 iàĞ
	`comp
(
–em’t
, 
cur
) < 0 )

288 
	`PRINT
(3,"\i¡_addØ%p\n",
cur
->
´ev
);

289 
	`li¡_add
(
–em’t
, 
cur
->
´ev
);

290 
	}
}

292 
	#DOMAIN_COMPARER
(
Çme
, 
f›ld
, 
comp1
, 
comp2
) \

293 
Çme
##
	`_comp
(
li¡_h—d
* 
–1
, li¡_h—d* 
–2
) \

295 
£df_vıu_šfo
 *
d1
, *
d2
; \

296 
d1
 = 
	`li¡_’Œy
(
–1
,
£df_vıu_šfo
, 
f›ld
); \

297 
d2
 = 
	`li¡_’Œy
(
–2
,
£df_vıu_šfo
, 
f›ld
); \

298 iàĞ(
comp1
è=ğ(
comp2
) ) \

300 iàĞ(
comp1
è< (
comp2
) ) \

304 }

	)

310 
DOMAIN_COMPARER
(
wa™q
, 
li¡
, 
PERIOD_BEGIN
(
d1
), PERIOD_BEGIN(
d2
));

311 
šlše
 
	$__add_to_wa™queue_sÜt
(
vıu
 *
v
)

313 
	`ASSERT
(!
	`__sk_Ú_queue
(
v
));

314 
	`PRINT
(3,"Addšg domaš %i.%˜(bİğ%"
PRIu64
")o waitq\n",

315 
v
->
domaš
->
domaš_id
, v->
vıu_id
, 
	`PERIOD_BEGIN
(
	`EDOM_INFO
(v)));

316 
	`li¡_š£¹_sÜt
(
	`WAITQ
(
v
->
´oûssÜ
), 
	`LIST
(v), 
wa™q_comp
);

317 
	`ASSERT
(
	`__sk_Ú_queue
(
v
));

318 
	}
}

325 
DOMAIN_COMPARER
(
runq
, 
li¡
, 
d1
->
d—dl_abs
, 
d2
->deadl_abs);

326 
šlše
 
	$__add_to_runqueue_sÜt
(
vıu
 *
v
)

328 
	`PRINT
(3,"Addšg domaš %i.%˜(d—dlğ%"
PRIu64
")o„unq\n",

329 
v
->
domaš
->
domaš_id
, v->
vıu_id
, 
	`EDOM_INFO
(v)->
d—dl_abs
);

330 
	`li¡_š£¹_sÜt
(
	`RUNQ
(
v
->
´oûssÜ
), 
	`LIST
(v), 
runq_comp
);

331 
	}
}

334 *
	$£df_®loc_vd©a
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
v
, *
dd
)

336 
£df_vıu_šfo
 *
šf
;

338 
šf
 = 
	`xm®loc
(
£df_vıu_šfo
);

339 iàĞ
šf
 =ğ
NULL
 )

340  
NULL
;

342 
	`mem£t
(
šf
, 0, (
£df_vıu_šfo
));

343 
šf
->
vıu
 = 
v
;

346 
šf
->
d—dl_abs
 = 0;

347 
šf
->
Ï‹ncy
 = 0;

348 
šf
->
¡©us
 = 
EXTRA_AWARE
 | 
SEDF_ASLEEP
;

349 
šf
->
exŒaweight
 = 1;

351 iàĞ
v
->
domaš
->
domaš_id
 == 0 )

354 
šf
->
³riod
 = 
	`MILLISECS
(20);

355 
šf
->
¦iû
 = 
	`MILLISECS
(15);

360 
šf
->
³riod
 = 
WEIGHT_PERIOD
;

361 
šf
->
¦iû
 = 0;

364 
šf
->
³riod_Üig
 = inf->
³riod
; inf->
¦iû_Üig
 = inf->
¦iû
;

365 
	`INIT_LIST_HEAD
(&(
šf
->
li¡
));

366 
	`INIT_LIST_HEAD
(&(
šf
->
exŒ®i¡
[
EXTRA_PEN_Q
]));

367 
	`INIT_LIST_HEAD
(&(
šf
->
exŒ®i¡
[
EXTRA_UTIL_Q
]));

369 iàĞ!
	`is_idË_vıu
(
v
) )

371 
	`exŒaq_check
(
v
);

375 
šf
->
d—dl_abs
 = 0;

376 
šf
->
¡©us
 &ğ~
SEDF_ASLEEP
;

379  
šf
;

380 
	}
}

383 
	$£df_®loc_pd©a
(cÚ¡ 
scheduËr
 *
İs
, 
ıu
)

385 
£df_ıu_šfo
 *
¥c
;

387 
¥c
 = 
	`xm®loc
(
£df_ıu_šfo
);

388 
	`BUG_ON
(
¥c
 =ğ
NULL
);

389 
	`mem£t
(
¥c
, 0, (*spc));

390 
	`INIT_LIST_HEAD
(&
¥c
->
wa™q
);

391 
	`INIT_LIST_HEAD
(&
¥c
->
ruÂabËq
);

392 
	`INIT_LIST_HEAD
(&
¥c
->
exŒaq
[
EXTRA_PEN_Q
]);

393 
	`INIT_LIST_HEAD
(&
¥c
->
exŒaq
[
EXTRA_UTIL_Q
]);

395  (*)
¥c
;

396 
	}
}

399 
	$£df_ä“_pd©a
(cÚ¡ 
scheduËr
 *
İs
, *
¥c
, 
ıu
)

401 iàĞ
¥c
 =ğ
NULL
 )

404 
	`xä“
(
¥c
);

405 
	}
}

407 
	$£df_ä“_vd©a
(cÚ¡ 
scheduËr
 *
İs
, *
´iv
)

409 
	`xä“
(
´iv
);

410 
	}
}

413 
	$£df_®loc_domd©a
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
d
)

415 *
mem
;

417 
mem
 = 
	`xm®loc
(
£df_dom_šfo
);

418 iàĞ
mem
 =ğ
NULL
 )

419  
NULL
;

421 
	`mem£t
(
mem
, 0, (
£df_dom_šfo
));

423  
mem
;

424 
	}
}

426 
	$£df_š™_domaš
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
d
)

428 
d
->
sched_´iv
 = 
	`£df_®loc_domd©a
(
İs
, d);

429 iàĞ
d
->
sched_´iv
 =ğ
NULL
 )

430  -
ENOMEM
;

433 
	}
}

435 
	$£df_ä“_domd©a
(cÚ¡ 
scheduËr
 *
İs
, *
d©a
)

437 
	`xä“
(
d©a
);

438 
	}
}

440 
	$£df_de¡roy_domaš
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
d
)

442 
	`£df_ä“_domd©a
(
İs
, 
d
->
sched_´iv
);

443 
	}
}

445 
	$£df_pick_ıu
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
v
)

447 
ıumask_t
 
Úlše_affš™y
;

448 
ıumask_t
 *
Úlše
;

450 
Úlše
 = 
	`SEDF_CPUONLINE
(
v
->
domaš
->
ıupoŞ
);

451 
	`ıus_ªd
(
Úlše_affš™y
, 
v
->
ıu_affš™y
, *
Úlše
);

452  
	`fœ¡_ıu
(
Úlše_affš™y
);

453 
	}
}

459 
	$desched_edf_dom
(
s_time_t
 
now
, 
vıu
* 
d
)

461 
£df_vıu_šfo
* 
šf
 = 
	`EDOM_INFO
(
d
);

464 
	`ASSERT
(
	`__sk_Ú_queue
(
d
));

467 
šf
->
ıutime
 +ğ
now
 - inf->
sched_¡¬t_abs
;

473 iàĞ(
šf
->
ıutime
 < inf->
¦iû
è&& 
	`£df_ruÂabË
(
d
) )

476 
	`__d–_äom_queue
(
d
);

482 iàĞ
šf
->
ıutime
 >ğšf->
¦iû
 )

484 
šf
->
ıutime
 -ğšf->
¦iû
;

486 iàĞ
šf
->
³riod
 < inf->
³riod_Üig
 )

489 
šf
->
³riod
 *= 2;

490 
šf
->
¦iû
 *= 2;

491 iàĞ(
šf
->
³riod
 > inf->
³riod_Üig
) ||

492 (
šf
->
¦iû
 > inf->
¦iû_Üig
) )

495 
šf
->
³riod
 = inf->
³riod_Üig
;

496 
šf
->
¦iû
 = inf->
¦iû_Üig
;

501 
šf
->
d—dl_abs
 +ğšf->
³riod
;

505 iàĞ
	`£df_ruÂabË
(
d
) )

507 
	`__add_to_wa™queue_sÜt
(
d
);

512 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_PEN_Q
) )

513 
	`exŒaq_d–
(
d
, 
EXTRA_PEN_Q
);

514 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
) )

515 
	`exŒaq_d–
(
d
, 
EXTRA_UTIL_Q
);

518 
	`ASSERT
(
	`EQ
(
	`£df_ruÂabË
(
d
), 
	`__sk_Ú_queue
(d)));

519 
	`ASSERT
(
	`IMPLY
(
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
è||ƒxŒaq_Ú(d, 
EXTRA_PEN_Q
),

520 
	`£df_ruÂabË
(
d
)));

521 
	}
}

525 
	$upd©e_queues
(

526 
s_time_t
 
now
, 
li¡_h—d
 *
runq
, li¡_h—d *
wa™q
)

528 
li¡_h—d
 *
cur
, *
tmp
;

529 
£df_vıu_šfo
 *
curšf
;

531 
	`PRINT
(3,"Updating waitq..\n");

537 
	`li¡_fÜ_—ch_§ã
 ( 
cur
, 
tmp
, 
wa™q
 )

539 
curšf
 = 
	`li¡_’Œy
(
cur
, 
£df_vıu_šfo
, 
li¡
);

540 
	`PRINT
(4,"\tLooking @ dom %i.%i\n",

541 
curšf
->
vıu
->
domaš
->
domaš_id
, curšf->vıu->
vıu_id
);

542 iàĞ
	`PERIOD_BEGIN
(
curšf
è> 
now
 )

544 
	`__d–_äom_queue
(
curšf
->
vıu
);

545 
	`__add_to_runqueue_sÜt
(
curšf
->
vıu
);

548 
	`PRINT
(3,"Updating„unq..\n");

551 
	`li¡_fÜ_—ch_§ã
 ( 
cur
, 
tmp
, 
runq
 )

553 
curšf
 = 
	`li¡_’Œy
(
cur
,
£df_vıu_šfo
,
li¡
);

554 
	`PRINT
(4,"\tLooking @ dom %i.%i\n",

555 
curšf
->
vıu
->
domaš
->
domaš_id
, curšf->vıu->
vıu_id
);

557 iàĞ
	`uÆik–y
(
curšf
->
¦iû
 == 0) )

560 
	`PRINT
(4,"\tUpdating zero-slice domain %i.%i\n",

561 
curšf
->
vıu
->
domaš
->
domaš_id
,

562 
curšf
->
vıu
->
vıu_id
);

563 
	`__d–_äom_queue
(
curšf
->
vıu
);

566 
curšf
->
d—dl_abs
 +ğcuršf->
³riod
;

569 iàĞ
	`uÆik–y
(
	`PERIOD_BEGIN
(
curšf
è< 
now
) )

570 
curšf
->
d—dl_abs
 +=

571 (
	`DIV_UP
(
now
 - 
	`PERIOD_BEGIN
(
curšf
),

572 
curšf
->
³riod
)) * curinf->period;

575 
	`__add_to_wa™queue_sÜt
(
curšf
->
vıu
);

577 iàĞ
	`uÆik–y
((
curšf
->
d—dl_abs
 < 
now
) ||

578 (
curšf
->
ıutime
 > curšf->
¦iû
)) )

584 
	`PRINT
(4,"\tDomain %i.%iƒxceeded it's deadline/"

585 "¦iû (%"
PRIu64
" / %"PRIu64")‚ow: %"PRIu64

586 " cputime: %"
PRIu64
"\n",

587 
curšf
->
vıu
->
domaš
->
domaš_id
,

588 
curšf
->
vıu
->
vıu_id
,

589 
curšf
->
d—dl_abs
, curšf->
¦iû
, 
now
,

590 
curšf
->
ıutime
);

591 
	`__d–_äom_queue
(
curšf
->
vıu
);

594 
curšf
->
d—dl_abs
 +ğcuršf->
³riod
;

600 iàĞ
	`uÆik–y
(
curšf
->
d—dl_abs
 < 
now
) )

601 
curšf
->
d—dl_abs
 +=

602 
	`DIV_UP
(
now
 - 
curšf
->
d—dl_abs
,

603 
curšf
->
³riod
) * curinf->period;

604 
	`ASSERT
(
curšf
->
d—dl_abs
 >ğ
now
);

607 
curšf
->
ıutime
 = 0;

608 iàĞ
	`PERIOD_BEGIN
(
curšf
è> 
now
 )

609 
	`__add_to_wa™queue_sÜt
(
curšf
->
vıu
);

611 
	`__add_to_runqueue_sÜt
(
curšf
->
vıu
);

617 
	`PRINT
(3,"done updatinghe queues\n");

618 
	}
}

627 
	$desched_exŒa_dom
(
s_time_t
 
now
, 
vıu
 *
d
)

629 
£df_vıu_šfo
 *
šf
 = 
	`EDOM_INFO
(
d
);

630 
i
 = 
	`exŒa_g‘_cur_q
(
šf
);

631 
ŞdscÜe
;

633 
	`ASSERT
(
	`exŒaq_Ú
(
d
, 
i
));

636 
šf
->
¡©us
 &ğ~(
EXTRA_RUN_PEN
 | 
EXTRA_RUN_UTIL
);

638 
šf
->
ıutime
 = 0;

640 
šf
->
exŒa_time_tÙ
 +ğ
now
 - inf->
sched_¡¬t_abs
;

642 
	`exŒaq_d–
(
d
, 
i
);

645 
ŞdscÜe
 = 
šf
->
scÜe
[
i
];

646 iàĞ
i
 =ğ
EXTRA_PEN_Q
 )

651 
šf
->
shÜt_block_lo¡_tÙ
 -ğ
now
 - inf->
sched_¡¬t_abs
;

652 
	`PRINT
(3,"Domaš %i.%i: ShÜt_block_loss: %"
PRIi64
"\n",

653 
šf
->
vıu
->
domaš
->
domaš_id
, inf->vıu->
vıu_id
,

654 
šf
->
shÜt_block_lo¡_tÙ
);

663 iàĞ
šf
->
shÜt_block_lo¡_tÙ
 <= 0 )

666 
	`PRINT
(4,"Domain %i.%i compensated short block†oss!\n",

667 
šf
->
vıu
->
domaš
->
domaš_id
, inf->vıu->
vıu_id
);

669 
šf
->
shÜt_block_lo¡_tÙ
 = 0;

671 
šf
->
¡©us
 &ğ~
EXTRA_WANT_PEN_Q
;

672 
check_exŒa_queues
;

678 
šf
->
scÜe
[
EXTRA_PEN_Q
] = (šf->
³riod
 << 10) /

679 
šf
->
shÜt_block_lo¡_tÙ
;

680 
ŞdscÜe
 = 0;

686 iàĞ!
šf
->
exŒaweight
 )

688 
šf
->
scÜe
[
EXTRA_UTIL_Q
] = (šf->
³riod
 << 10) /

689 
šf
->
¦iû
;

693 
šf
->
scÜe
[
EXTRA_UTIL_Q
] = (1<<17è/ inf->
exŒaweight
;

696 
check_exŒa_queues
:

698 iàĞ
	`£df_ruÂabË
(
d
) )

701 ià(((
šf
->
¡©us
 & 
EXTRA_AWARE
è&& (
i
 =ğ
EXTRA_UTIL_Q
)) ||

702 ((
šf
->
¡©us
 & 
EXTRA_WANT_PEN_Q
è&& (
i
 =ğ
EXTRA_PEN_Q
)))

703 
	`exŒaq_add_sÜt_upd©e
(
d
, 
i
, 
ŞdscÜe
);

708 
	`__d–_äom_queue
(
d
);

711 iàĞ
i
 =ğ
EXTRA_PEN_Q
 )

713 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
) )

714 
	`exŒaq_d–
(
d
, 
EXTRA_UTIL_Q
);

718 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_PEN_Q
) )

719 
	`exŒaq_d–
(
d
, 
EXTRA_PEN_Q
);

723 
	`ASSERT
(
	`EQ
(
	`£df_ruÂabË
(
d
), 
	`__sk_Ú_queue
(d)));

724 
	`ASSERT
(
	`IMPLY
(
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
è||ƒxŒaq_Ú(d, 
EXTRA_PEN_Q
),

725 
	`£df_ruÂabË
(
d
)));

726 
	}
}

729 
sk_¦iû
 
	$£df_do_exŒa_scheduË
(

730 
s_time_t
 
now
, s_time_ˆ
’d_xt
, 
li¡_h—d
 *
exŒaq
[], 
ıu
)

732 
sk_¦iû
 
»t
;

733 
£df_vıu_šfo
 *
runšf
;

734 
	`ASSERT
(
’d_xt
 > 
now
);

737 iàĞ
’d_xt
 - 
now
 < 
EXTRA_QUANTUM
 )

738 
»tuº_idË
;

740 iàĞ!
	`li¡_em±y
(
exŒaq
[
EXTRA_PEN_Q
]) )

744 
runšf
 = 
	`li¡_’Œy
(
exŒaq
[
EXTRA_PEN_Q
]->
Ãxt
,

745 
£df_vıu_šfo
, 
exŒ®i¡
[
EXTRA_PEN_Q
]);

746 
runšf
->
¡©us
 |ğ
EXTRA_RUN_PEN
;

747 
»t
.
sk
 = 
runšf
->
vıu
;

748 
»t
.
time
 = 
EXTRA_QUANTUM
;

749 #ifdeà
SEDF_STATS


750 
runšf
->
³n_exŒa_¦iûs
++;

755 iàĞ!
	`li¡_em±y
(
exŒaq
[
EXTRA_UTIL_Q
]) )

758 
runšf
 = 
	`li¡_’Œy
(
exŒaq
[
EXTRA_UTIL_Q
]->
Ãxt
,

759 
£df_vıu_šfo
,

760 
exŒ®i¡
[
EXTRA_UTIL_Q
]);

761 
runšf
->
¡©us
 |ğ
EXTRA_RUN_UTIL
;

762 
»t
.
sk
 = 
runšf
->
vıu
;

763 
»t
.
time
 = 
EXTRA_QUANTUM
;

766 
»tuº_idË
;

769 
	`ASSERT
(
»t
.
time
 > 0);

770 
	`ASSERT
(
	`£df_ruÂabË
(
»t
.
sk
));

771  
»t
;

773 
»tuº_idË
:

774 
»t
.
sk
 = 
	`IDLETASK
(
ıu
);

775 
»t
.
time
 = 
’d_xt
 - 
now
;

776 
	`ASSERT
(
»t
.
time
 > 0);

777 
	`ASSERT
(
	`£df_ruÂabË
(
»t
.
sk
));

778  
»t
;

779 
	}
}

787 
sk_¦iû
 
	$£df_do_scheduË
(

788 cÚ¡ 
scheduËr
 *
İs
, 
s_time_t
 
now
, 
boŞ_t
 
skËt_wÜk_scheduËd
)

790 
ıu
 = 
	`smp_´oûssÜ_id
();

791 
li¡_h—d
 *
runq
 = 
	`RUNQ
(
ıu
);

792 
li¡_h—d
 *
wa™q
 = 
	`WAITQ
(
ıu
);

793 
£df_vıu_šfo
 *
šf
 = 
	`EDOM_INFO
(
cu¼’t
);

794 
li¡_h—d
 *
exŒaq
[] = {

795 
	`EXTRAQ
(
ıu
, 
EXTRA_PEN_Q
), EXTRAQ(ıu, 
EXTRA_UTIL_Q
)};

796 
£df_vıu_šfo
 *
runšf
, *
wa™šf
;

797 
sk_¦iû
 
»t
;

800 iàĞ
	`is_idË_vıu
(
cu¼’t
) )

801 
check_wa™q
;

806 iàĞ!
	`vıu_ruÂabË
(
cu¼’t
) )

807 
šf
->
¡©us
 |ğ
SEDF_ASLEEP
;

809 iàĞ
šf
->
¡©us
 & 
SEDF_ASLEEP
 )

810 
šf
->
block_abs
 = 
now
;

812 iàĞ
	`uÆik–y
(
	`exŒa_runs
(
šf
)) )

815 
	`desched_exŒa_dom
(
now
, 
cu¼’t
);

819 
	`desched_edf_dom
(
now
, 
cu¼’t
);

821 
check_wa™q
:

822 
	`upd©e_queues
(
now
, 
runq
, 
wa™q
);

828 iàĞ
skËt_wÜk_scheduËd
 ||

829 (
	`li¡_em±y
(
runq
è&&†i¡_em±y(
wa™q
)) ||

830 
	`uÆik–y
(!
	`ıu_is£t
(
ıu
, *
	`SEDF_CPUONLINE
(
	`³r_ıu
(
ıupoŞ
, cpu)))) )

832 
»t
.
sk
 = 
	`IDLETASK
(
ıu
);

833 
»t
.
time
 = 
	`SECONDS
(1);

835 iàĞ!
	`li¡_em±y
(
runq
) )

837 
runšf
 = 
	`li¡_’Œy
(
runq
->
Ãxt
,
£df_vıu_šfo
,
li¡
);

838 
»t
.
sk
 = 
runšf
->
vıu
;

839 iàĞ!
	`li¡_em±y
(
wa™q
) )

841 
wa™šf
 = 
	`li¡_’Œy
(
wa™q
->
Ãxt
,

842 
£df_vıu_šfo
,
li¡
);

846 
»t
.
time
 = 
	`MIN
(
now
 + 
runšf
->
¦iû
 -„unšf->
ıutime
,

847 
	`PERIOD_BEGIN
(
wa™šf
)è- 
now
;

851 
»t
.
time
 = 
runšf
->
¦iû
 -„unšf->
ıutime
;

856 
wa™šf
 = 
	`li¡_’Œy
(
wa™q
->
Ãxt
,
£df_vıu_šfo
, 
li¡
);

859 
»t
 = 
	`£df_do_exŒa_scheduË
(
now
, 
	`PERIOD_BEGIN
(
wa™šf
),

860 
exŒaq
, 
ıu
);

865 iàĞ
»t
.
time
 < 0)

867 
	`´štk
("Ouch! W¬£riou¦y BEHIND scheduË! %"
PRIi64
"\n",

868 
»t
.
time
);

869 
»t
.
time
 = 
EXTRA_QUANTUM
;

872 
»t
.
mig¿‹d
 = 0;

874 
	`EDOM_INFO
(
»t
.
sk
)->
sched_¡¬t_abs
 = 
now
;

875 
	`CHECK
(
»t
.
time
 > 0);

876 
	`ASSERT
(
	`£df_ruÂabË
(
»t
.
sk
));

877 
	`CPU_INFO
(
ıu
)->
cu¼’t_¦iû_expœes
 = 
now
 + 
»t
.
time
;

878  
»t
;

879 
	}
}

882 
	$£df_¦“p
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
d
)

884 
	`PRINT
(2,"sedf_sleep was called, domain-id %i.%i\n",

885 
d
->
domaš
->
domaš_id
, d->
vıu_id
);

887 iàĞ
	`is_idË_vıu
(
d
) )

890 
	`EDOM_INFO
(
d
)->
¡©us
 |ğ
SEDF_ASLEEP
;

892 iàĞ
	`³r_ıu
(
scheduË_d©a
, 
d
->
´oûssÜ
).
cu¼
 == d )

894 
	`ıu_¿i£_soáœq
(
d
->
´oûssÜ
, 
SCHEDULE_SOFTIRQ
);

898 iàĞ
	`__sk_Ú_queue
(
d
) )

899 
	`__d–_äom_queue
(
d
);

900 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
) )

901 
	`exŒaq_d–
(
d
, 
EXTRA_UTIL_Q
);

902 iàĞ
	`exŒaq_Ú
(
d
, 
EXTRA_PEN_Q
) )

903 
	`exŒaq_d–
(
d
, 
EXTRA_PEN_Q
);

905 
	}
}

979 
	$unblock_shÜt_exŒa_suµÜt
(

980 
£df_vıu_šfo
* 
šf
, 
s_time_t
 
now
)

985 
s_time_t
 
³n
;

988 
šf
->
d—dl_abs
 +ğšf->
³riod
;

989 iàĞ
	`lik–y
(
šf
->
block_abs
) )

995 
³n
 = (
šf
->
¦iû
 - inf->
ıutime
);

996 iàĞ
³n
 < 0 )

997 
³n
 = 0;

1001 
šf
->
shÜt_block_lo¡_tÙ
 = 
³n
;

1004 iàĞ
šf
->
shÜt_block_lo¡_tÙ
 )

1006 
šf
->
scÜe
[0] = (šf->
³riod
 << 10) /

1007 
šf
->
shÜt_block_lo¡_tÙ
;

1008 #ifdeà
SEDF_STATS


1009 
šf
->
³n_exŒa_blocks
++;

1011 iàĞ
	`exŒaq_Ú
(
šf
->
vıu
, 
EXTRA_PEN_Q
) )

1013 
	`exŒaq_d–
(
šf
->
vıu
, 
EXTRA_PEN_Q
);

1018 
šf
->
¡©us
 |ğ
EXTRA_WANT_PEN_Q
;

1021 
	`exŒaq_add_sÜt_upd©e
(
šf
->
vıu
, 
EXTRA_PEN_Q
, 0);

1026 
šf
->
ıutime
 = 0;

1027 
	}
}

1030 
	$unblock_lÚg_cÚs_b
(
£df_vıu_šfo
* 
šf
,
s_time_t
 
now
)

1034 
šf
->
d—dl_abs
 = 
now
 + inf->
³riod
;

1035 
šf
->
ıutime
 = 0;

1036 
	}
}

1039 
	#DOMAIN_EDF
 1

	)

1040 
	#DOMAIN_EXTRA_PEN
 2

	)

1041 
	#DOMAIN_EXTRA_UTIL
 3

	)

1042 
	#DOMAIN_IDLE
 4

	)

1043 
šlše
 
	$g‘_run_ty³
(
vıu
* 
d
)

1045 
£df_vıu_šfo
* 
šf
 = 
	`EDOM_INFO
(
d
);

1046 ià(
	`is_idË_vıu
(
d
))

1047  
DOMAIN_IDLE
;

1048 ià(
šf
->
¡©us
 & 
EXTRA_RUN_PEN
)

1049  
DOMAIN_EXTRA_PEN
;

1050 ià(
šf
->
¡©us
 & 
EXTRA_RUN_UTIL
)

1051  
DOMAIN_EXTRA_UTIL
;

1052  
DOMAIN_EDF
;

1053 
	}
}

1065 
šlše
 
	$should_sw™ch
(
vıu
 *
cur
,

1066 
vıu
 *
Ùh”
,

1067 
s_time_t
 
now
)

1069 
£df_vıu_šfo
 *
cur_šf
, *
Ùh”_šf
;

1070 
cur_šf
 = 
	`EDOM_INFO
(
cur
);

1071 
Ùh”_šf
 = 
	`EDOM_INFO
(
Ùh”
);

1074 iàĞ
	`PERIOD_BEGIN
(
Ùh”_šf
) <

1075 
	`CPU_INFO
(
Ùh”
->
´oûssÜ
)->
cu¼’t_¦iû_expœes
 )

1079  
	`g‘_run_ty³
(
cur
) )

1081 
DOMAIN_EDF
:

1084 
DOMAIN_EXTRA_PEN
:

1086  ((
Ùh”_šf
->
¡©us
 & 
EXTRA_WANT_PEN_Q
) &&

1087 (
Ùh”_šf
->
scÜe
[
EXTRA_PEN_Q
] <

1088 
cur_šf
->
scÜe
[
EXTRA_PEN_Q
]));

1089 
DOMAIN_EXTRA_UTIL
:

1093  !!(
Ùh”_šf
->
¡©us
 & 
EXTRA_WANT_PEN_Q
);

1094 
DOMAIN_IDLE
:

1099 
	}
}

1101 
	$£df_wake
(cÚ¡ 
scheduËr
 *
İs
, 
vıu
 *
d
)

1103 
s_time_t
 
now
 = 
	`NOW
();

1104 
£df_vıu_šfo
* 
šf
 = 
	`EDOM_INFO
(
d
);

1106 
	`PRINT
(3, "£df_wakwa ÿÎed, domaš-id %i.%i\n",
d
->
domaš
->
domaš_id
,

1107 
d
->
vıu_id
);

1109 iàĞ
	`uÆik–y
(
	`is_idË_vıu
(
d
)) )

1112 iàĞ
	`uÆik–y
(
	`__sk_Ú_queue
(
d
)) )

1114 
	`PRINT
(3,"\tdomain %i.%i is‡lready in some queue\n",

1115 
d
->
domaš
->
domaš_id
, d->
vıu_id
);

1119 
	`ASSERT
(!
	`£df_ruÂabË
(
d
));

1120 
šf
->
¡©us
 &ğ~
SEDF_ASLEEP
;

1121 
	`ASSERT
(!
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
));

1122 
	`ASSERT
(!
	`exŒaq_Ú
(
d
, 
EXTRA_PEN_Q
));

1124 iàĞ
	`uÆik–y
(
šf
->
d—dl_abs
 == 0) )

1127 
šf
->
d—dl_abs
 = 
now
 + inf->
¦iû
;

1130 
	`PRINT
(3, "wakšg u°domaš %i.%˜(d—dlğ%"
PRIu64
"…eriod= %"PRIu64

1131 "nowğ%"
PRIu64
")\n",

1132 
d
->
domaš
->
domaš_id
, d->
vıu_id
, 
šf
->
d—dl_abs
, inf->
³riod
, 
now
);

1134 #ifdeà
SEDF_STATS


1135 
šf
->
block_tÙ
++;

1138 iàĞ
	`uÆik–y
(
now
 < 
	`PERIOD_BEGIN
(
šf
)) )

1140 
	`PRINT
(4,"extratime unblock\n");

1142 iàĞ
šf
->
¡©us
 & 
EXTRA_WANT_PEN_Q
 )

1148 
	`exŒaq_add_sÜt_upd©e
(
d
, 
EXTRA_PEN_Q
, 0);

1150 
	`exŒaq_check_add_unblocked
(
d
, 0);

1154 iàĞ
now
 < 
šf
->
d—dl_abs
 )

1156 
	`PRINT
(4,"short unblocking\n");

1158 #ifdeà
SEDF_STATS


1159 
šf
->
shÜt_block_tÙ
++;

1161 
	`unblock_shÜt_exŒa_suµÜt
(
šf
, 
now
);

1163 
	`exŒaq_check_add_unblocked
(
d
, 1);

1167 
	`PRINT
(4,"long unblocking\n");

1169 #ifdeà
SEDF_STATS


1170 
šf
->
lÚg_block_tÙ
++;

1172 
	`unblock_lÚg_cÚs_b
(
šf
, 
now
);

1174 
	`exŒaq_check_add_unblocked
(
d
, 1);

1178 
	`PRINT
(3, "woku°domaš %i.%˜(d—dlğ%"
PRIu64
"…eriod= %"PRIu64

1179 "nowğ%"
PRIu64
")\n",

1180 
d
->
domaš
->
domaš_id
, d->
vıu_id
, 
šf
->
d—dl_abs
,

1181 
šf
->
³riod
, 
now
);

1183 iàĞ
	`PERIOD_BEGIN
(
šf
è> 
now
 )

1185 
	`__add_to_wa™queue_sÜt
(
d
);

1186 
	`PRINT
(3,"addedo waitq\n");

1190 
	`__add_to_runqueue_sÜt
(
d
);

1191 
	`PRINT
(3,"addedo„unq\n");

1194 #ifdeà
SEDF_STATS


1196 iàĞ
šf
->
block_abs
 != 0 )

1198 
šf
->
block_time_tÙ
 +ğ
now
 - inf->
block_abs
;

1199 
šf
->
³ÇÉy_time_tÙ
 +=

1200 
	`PERIOD_BEGIN
(
šf
è+ inf->
ıutime
 - inf->
block_abs
;

1205 
	`ASSERT
(
	`IMPLY
(
šf
->
¡©us
 & 
EXTRA_AWARE
, 
	`exŒaq_Ú
(
d
, 
EXTRA_UTIL_Q
)));

1206 
	`ASSERT
(
	`__sk_Ú_queue
(
d
));

1210 
	`ASSERT
(
d
->
´oûssÜ
 >= 0);

1211 
	`ASSERT
(
d
->
´oûssÜ
 < 
NR_CPUS
);

1212 
	`ASSERT
(
	`³r_ıu
(
scheduË_d©a
, 
d
->
´oûssÜ
).
cu¼
);

1214 iàĞ
	`should_sw™ch
(
	`³r_ıu
(
scheduË_d©a
, 
d
->
´oûssÜ
).
cu¼
, d, 
now
) )

1215 
	`ıu_¿i£_soáœq
(
d
->
´oûssÜ
, 
SCHEDULE_SOFTIRQ
);

1216 
	}
}

1220 
	$£df_dump_domaš
(
vıu
 *
d
)

1222 
	`´štk
("%i.%˜has=%ø", 
d
->
domaš
->
domaš_id
, d->
vıu_id
,

1223 
d
->
is_ruÂšg
 ? 'T':'F');

1224 
	`´štk
("p=%"
PRIu64
" sl=%"PRIu64" ddl=%"PRIu64" w=%hu"

1225 " sc=%˜xŒ(%s)=%"
PRIu64
"ƒw=%hu",

1226 
	`EDOM_INFO
(
d
)->
³riod
, EDOM_INFO(d)->
¦iû
, EDOM_INFO(d)->
d—dl_abs
,

1227 
	`EDOM_INFO
(
d
)->
weight
,

1228 
	`EDOM_INFO
(
d
)->
scÜe
[
EXTRA_UTIL_Q
],

1229 (
	`EDOM_INFO
(
d
)->
¡©us
 & 
EXTRA_AWARE
) ? "yes" : "no",

1230 
	`EDOM_INFO
(
d
)->
exŒa_time_tÙ
, EDOM_INFO(d)->
exŒaweight
);

1232 #ifdeà
SEDF_STATS


1233 iàĞ
	`EDOM_INFO
(
d
)->
block_time_tÙ
 != 0 )

1234 
	`´štk
("…’=%"
PRIu64
"%%", (
	`EDOM_INFO
(
d
)->
³ÇÉy_time_tÙ
 * 100) /

1235 
	`EDOM_INFO
(
d
)->
block_time_tÙ
);

1236 iàĞ
	`EDOM_INFO
(
d
)->
block_tÙ
 != 0 )

1237 
	`´štk
("\n blks=%u sh=%u (%u%%) (shc=%u (%u%%) shex=%i "\

1238 "shex¦=%ièl=%u (%u%%èavg: b=%"
PRIu64
"…=%"PRIu64"",

1239 
	`EDOM_INFO
(
d
)->
block_tÙ
, EDOM_INFO(d)->
shÜt_block_tÙ
,

1240 (
	`EDOM_INFO
(
d
)->
shÜt_block_tÙ
 * 100)

1241 / 
	`EDOM_INFO
(
d
)->
block_tÙ
, EDOM_INFO(d)->
shÜt_cÚt
,

1242 (
	`EDOM_INFO
(
d
)->
shÜt_cÚt
 * 100è/ EDOM_INFO(d)->
block_tÙ
,

1243 
	`EDOM_INFO
(
d
)->
³n_exŒa_blocks
,

1244 
	`EDOM_INFO
(
d
)->
³n_exŒa_¦iûs
,

1245 
	`EDOM_INFO
(
d
)->
lÚg_block_tÙ
,

1246 (
	`EDOM_INFO
(
d
)->
lÚg_block_tÙ
 * 100è/ EDOM_INFO(d)->
block_tÙ
,

1247 (
	`EDOM_INFO
(
d
)->
block_time_tÙ
è/ EDOM_INFO(d)->
block_tÙ
,

1248 (
	`EDOM_INFO
(
d
)->
³ÇÉy_time_tÙ
è/ EDOM_INFO(d)->
block_tÙ
);

1250 
	`´štk
("\n");

1251 
	}
}

1255 
	$£df_dump_ıu_¡©e
(cÚ¡ 
scheduËr
 *
İs
, 
i
)

1257 
li¡_h—d
 *
li¡
, *
queue
, *
tmp
;

1258 
£df_vıu_šfo
 *
d_šf
;

1259 
domaš
 *
d
;

1260 
vıu
 *
ed
;

1261 
loİ
 = 0;

1263 
	`´štk
("now=%"
PRIu64
"\n",
	`NOW
());

1264 
queue
 = 
	`RUNQ
(
i
);

1265 
	`´štk
("RUNQ„q %lx‚: %lx,…: %lx\n", ()
queue
,

1266 (è
queue
->
Ãxt
, (èqueue->
´ev
);

1267 
	`li¡_fÜ_—ch_§ã
 ( 
li¡
, 
tmp
, 
queue
 )

1269 
	`´štk
("%3d: ",
loİ
++);

1270 
d_šf
 = 
	`li¡_’Œy
(
li¡
, 
£df_vıu_šfo
,†ist);

1271 
	`£df_dump_domaš
(
d_šf
->
vıu
);

1274 
queue
 = 
	`WAITQ
(
i
); 
loİ
 = 0;

1275 
	`´štk
("\nWAITQ„q %lx‚: %lx,…: %lx\n", ()
queue
,

1276 (è
queue
->
Ãxt
, (èqueue->
´ev
);

1277 
	`li¡_fÜ_—ch_§ã
 ( 
li¡
, 
tmp
, 
queue
 )

1279 
	`´štk
("%3d: ",
loİ
++);

1280 
d_šf
 = 
	`li¡_’Œy
(
li¡
, 
£df_vıu_šfo
,†ist);

1281 
	`£df_dump_domaš
(
d_šf
->
vıu
);

1284 
queue
 = 
	`EXTRAQ
(
i
,
EXTRA_PEN_Q
); 
loİ
 = 0;

1285 
	`´štk
("\nEXTRAQ (penalty)„q %lx‚: %lx,…: %lx\n",

1286 ()
queue
, (èqueue->
Ãxt
,

1287 (è
queue
->
´ev
);

1288 
	`li¡_fÜ_—ch_§ã
 ( 
li¡
, 
tmp
, 
queue
 )

1290 
d_šf
 = 
	`li¡_’Œy
(
li¡
, 
£df_vıu_šfo
,

1291 
exŒ®i¡
[
EXTRA_PEN_Q
]);

1292 
	`´štk
("%3d: ",
loİ
++);

1293 
	`£df_dump_domaš
(
d_šf
->
vıu
);

1296 
queue
 = 
	`EXTRAQ
(
i
,
EXTRA_UTIL_Q
); 
loİ
 = 0;

1297 
	`´štk
("\nEXTRAQ (utilization)„q %lx‚: %lx,…: %lx\n",

1298 ()
queue
, (èqueue->
Ãxt
,

1299 (è
queue
->
´ev
);

1300 
	`li¡_fÜ_—ch_§ã
 ( 
li¡
, 
tmp
, 
queue
 )

1302 
d_šf
 = 
	`li¡_’Œy
(
li¡
, 
£df_vıu_šfo
,

1303 
exŒ®i¡
[
EXTRA_UTIL_Q
]);

1304 
	`´štk
("%3d: ",
loİ
++);

1305 
	`£df_dump_domaš
(
d_šf
->
vıu
);

1308 
loİ
 = 0;

1309 
	`´štk
("\nnot on Q\n");

1311 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

1312 
	`fÜ_—ch_domaš
 ( 
d
 )

1314 
	`fÜ_—ch_vıu
(
d
, 
ed
)

1316 iàĞ!
	`__sk_Ú_queue
(
ed
è&& (ed->
´oûssÜ
 =ğ
i
) )

1318 
	`´štk
("%3d: ",
loİ
++);

1319 
	`£df_dump_domaš
(
ed
);

1323 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

1324 
	}
}

1328 
	$£df_adju¡_weights
(
ıupoŞ
 *
c
, 
x’_domùl_scheduËr_İ
 *
cmd
)

1330 
vıu
 *
p
;

1331 
domaš
 *
d
;

1332 
ıu
, 
Ä_ıus
 = 
	`Ï¡_ıu
(
ıu_Úlše_m­
) + 1;

1333 *
sumw
 = 
	`xm®loc_¬¿y
(, 
Ä_ıus
);

1334 
s_time_t
 *
sumt
 = 
	`xm®loc_¬¿y
(s_time_t, 
Ä_ıus
);

1336 iàĞ!
sumw
 || !
sumt
 )

1338 
	`xä“
(
sumt
);

1339 
	`xä“
(
sumw
);

1340  -
ENOMEM
;

1342 
	`mem£t
(
sumw
, 0, 
Ä_ıus
 * (*sumw));

1343 
	`mem£t
(
sumt
, 0, 
Ä_ıus
 * (*sumt));

1346 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

1347 
	`fÜ_—ch_domaš
Ğ
d
 )

1349 iàĞ
c
 !ğ
d
->
ıupoŞ
 )

1351 
	`fÜ_—ch_vıu
Ğ
d
, 
p
 )

1353 iàĞ(
ıu
 = 
p
->
´oûssÜ
è>ğ
Ä_ıus
 )

1356 iàĞ
	`EDOM_INFO
(
p
)->
weight
 )

1358 
sumw
[
ıu
] +ğ
	`EDOM_INFO
(
p
)->
weight
;

1367 
	`ASSERT
((
WEIGHT_PERIOD
 < 
ULONG_MAX
)

1368 && (
	`EDOM_INFO
(
p
)->
¦iû_Üig
 < 
ULONG_MAX
));

1369 
sumt
[
ıu
] +=

1370 (
WEIGHT_PERIOD
 * 
	`EDOM_INFO
(
p
)->
¦iû_Üig
) /

1371 
	`EDOM_INFO
(
p
)->
³riod_Üig
;

1375 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

1378 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

1379 
	`fÜ_—ch_domaš
Ğ
d
 )

1381 
	`fÜ_—ch_vıu
 ( 
d
, 
p
 )

1383 iàĞ(
ıu
 = 
p
->
´oûssÜ
è>ğ
Ä_ıus
 )

1385 iàĞ
	`EDOM_INFO
(
p
)->
weight
 )

1387 
	`EDOM_INFO
(
p
)->
³riod_Üig
 =

1388 
	`EDOM_INFO
(
p
)->
³riod
 = 
WEIGHT_PERIOD
;

1389 
	`EDOM_INFO
(
p
)->
¦iû_Üig
 =

1390 
	`EDOM_INFO
(
p
)->
¦iû
 =

1391 (
	`EDOM_INFO
(
p
)->
weight
 *

1392 (
WEIGHT_PERIOD
 - 
WEIGHT_SAFETY
 - 
sumt
[
ıu
])è/ 
sumw
[cpu];

1396 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

1398 
	`xä“
(
sumt
);

1399 
	`xä“
(
sumw
);

1402 
	}
}

1406 
	$£df_adju¡
(cÚ¡ 
scheduËr
 *
İs
, 
domaš
 *
p
, 
x’_domùl_scheduËr_İ
 *
İ
)

1408 
vıu
 *
v
;

1409 
rc
;

1411 
	`PRINT
(2,"£df_adju¡ wa ÿÎed, domaš-id %˜Ãw…”iod %"
PRIu64
" "

1412 "Ãw sliû %"
PRIu64
"\nlatency %"PRIu64"ƒxtra:%s\n",

1413 
p
->
domaš_id
, 
İ
->
u
.
£df
.
³riod
, op->u.£df.
¦iû
,

1414 
İ
->
u
.
£df
.
Ï‹ncy
, (İ->u.£df.
exŒ©ime
)?"yes":"no");

1416 iàĞ
İ
->
cmd
 =ğ
XEN_DOMCTL_SCHEDOP_putšfo
 )

1419 iàĞ!
İ
->
u
.
£df
.
³riod
 && !İ->u.£df.
weight
 )

1420  -
EINVAL
;

1421 iàĞ
İ
->
u
.
£df
.
weight
 )

1423 iàĞ(
İ
->
u
.
£df
.
exŒ©ime
 & 
EXTRA_AWARE
) &&

1424 (!
İ
->
u
.
£df
.
³riod
) )

1427 
	`fÜ_—ch_vıu
 ( 
p
, 
v
 )

1429 
	`EDOM_INFO
(
v
)->
exŒaweight
 = 
İ
->
u
.
£df
.
weight
;

1430 
	`EDOM_INFO
(
v
)->
weight
 = 0;

1431 
	`EDOM_INFO
(
v
)->
¦iû
 = 0;

1432 
	`EDOM_INFO
(
v
)->
³riod
 = 
WEIGHT_PERIOD
;

1438 
	`fÜ_—ch_vıu
 ( 
p
, 
v
 )

1439 
	`EDOM_INFO
(
v
)->
weight
 = 
İ
->
u
.
£df
.weight;

1445 
	`fÜ_—ch_vıu
 ( 
p
, 
v
 )

1451 iàĞ(
İ
->
u
.
£df
.
³riod
 > 
PERIOD_MAX
) ||

1452 (
İ
->
u
.
£df
.
³riod
 < 
PERIOD_MIN
) ||

1453 (
İ
->
u
.
£df
.
¦iû
 > op->u.£df.
³riod
) ||

1454 (
İ
->
u
.
£df
.
¦iû
 < 
SLICE_MIN
) )

1455  -
EINVAL
;

1456 
	`EDOM_INFO
(
v
)->
weight
 = 0;

1457 
	`EDOM_INFO
(
v
)->
exŒaweight
 = 0;

1458 
	`EDOM_INFO
(
v
)->
³riod_Üig
 =

1459 
	`EDOM_INFO
(
v
)->
³riod
 = 
İ
->
u
.
£df
.period;

1460 
	`EDOM_INFO
(
v
)->
¦iû_Üig
 =

1461 
	`EDOM_INFO
(
v
)->
¦iû
 = 
İ
->
u
.
£df
.slice;

1465 
rc
 = 
	`£df_adju¡_weights
(
p
->
ıupoŞ
, 
İ
);

1466 iàĞ
rc
 )

1467  
rc
;

1469 
	`fÜ_—ch_vıu
 ( 
p
, 
v
 )

1471 
	`EDOM_INFO
(
v
)->
¡©us
 =

1472 (
	`EDOM_INFO
(
v
)->
¡©us
 &

1473 ~
EXTRA_AWARE
è| (
İ
->
u
.
£df
.
exŒ©ime
 & EXTRA_AWARE);

1474 
	`EDOM_INFO
(
v
)->
Ï‹ncy
 = 
İ
->
u
.
£df
.latency;

1475 
	`exŒaq_check
(
v
);

1478 iàĞ
İ
->
cmd
 =ğ
XEN_DOMCTL_SCHEDOP_g‘šfo
 )

1480 iàĞ
p
->
vıu
[0] =ğ
NULL
 )

1481  -
EINVAL
;

1482 
İ
->
u
.
£df
.
³riod
 = 
	`EDOM_INFO
(
p
->
vıu
[0])->period;

1483 
İ
->
u
.
£df
.
¦iû
 = 
	`EDOM_INFO
(
p
->
vıu
[0])->slice;

1484 
İ
->
u
.
£df
.
exŒ©ime
 = 
	`EDOM_INFO
(
p
->
vıu
[0])->
¡©us
 & 
EXTRA_AWARE
;

1485 
İ
->
u
.
£df
.
Ï‹ncy
 = 
	`EDOM_INFO
(
p
->
vıu
[0])->latency;

1486 
İ
->
u
.
£df
.
weight
 = 
	`EDOM_INFO
(
p
->
vıu
[0])->weight;

1489 
	`PRINT
(2,"sedf_adjust_finished\n");

1491 
	}
}

1493 cÚ¡ 
scheduËr
 
	gsched_£df_def
 = {

1494 .
Çme
 = "Simple EDF Scheduler",

1495 .
	gİt_Çme
 = "sedf",

1496 .
	gsched_id
 = 
XEN_SCHEDULER_SEDF
,

1498 .
	gš™_domaš
 = 
£df_š™_domaš
,

1499 .
	gde¡roy_domaš
 = 
£df_de¡roy_domaš
,

1501 .
	g®loc_vd©a
 = 
£df_®loc_vd©a
,

1502 .
	gä“_vd©a
 = 
£df_ä“_vd©a
,

1503 .
	g®loc_pd©a
 = 
£df_®loc_pd©a
,

1504 .
	gä“_pd©a
 = 
£df_ä“_pd©a
,

1505 .
	g®loc_domd©a
 = 
£df_®loc_domd©a
,

1506 .
	gä“_domd©a
 = 
£df_ä“_domd©a
,

1508 .
	gdo_scheduË
 = 
£df_do_scheduË
,

1509 .
	gpick_ıu
 = 
£df_pick_ıu
,

1510 .
	gdump_ıu_¡©e
 = 
£df_dump_ıu_¡©e
,

1511 .
	g¦“p
 = 
£df_¦“p
,

1512 .
	gwake
 = 
£df_wake
,

1513 .
	gadju¡
 = 
£df_adju¡
,

	@schedule.c

16 #iâdeà
COMPAT


17 
	~<x’/cÚfig.h
>

18 
	~<x’/š™.h
>

19 
	~<x’/lib.h
>

20 
	~<x’/sched.h
>

21 
	~<x’/domaš.h
>

22 
	~<x’/d–ay.h
>

23 
	~<x’/ev’t.h
>

24 
	~<x’/time.h
>

25 
	~<x’/tim”.h
>

26 
	~<x’/³rfc.h
>

27 
	~<x’/sched-if.h
>

28 
	~<x’/soáœq.h
>

29 
	~<x’/Œaû.h
>

30 
	~<x’/mm.h
>

31 
	~<x’/”ºo.h
>

32 
	~<x’/gue¡_acûss.h
>

33 
	~<x’/muÉiÿÎ.h
>

34 
	~<x’/ıu.h
>

35 
	~<x’/´“m±.h
>

36 
	~<public/sched.h
>

37 
	~<xsm/xsm.h
>

38 
	~<mši.h
>

39 
	~<x’/h‘”ovisÜ.h
>

42 
__š™d©a
 
	gİt_sched
[10] = "credit";

43 
¡ršg_·¿m
("sched", 
İt_sched
);

49 
boŞ_t
 
	gsched_smt_pow”_§všgs
 = 0;

50 
boŞ—n_·¿m
("sched_smt_pow”_§všgs", 
sched_smt_pow”_§všgs
);

53 
s_tim”_â
(*
unu£d
);

54 
vıu_³riodic_tim”_â
(*
d©a
);

55 
vıu_sšgËshÙ_tim”_â
(*
d©a
);

56 
pŞl_tim”_â
(*
d©a
);

59 
DEFINE_PER_CPU
(
scheduË_d©a
, schedule_data);

60 
DEFINE_PER_CPU
(
scheduËr
 *, scheduler);

62 cÚ¡ 
scheduËr
 
sched_£df_def
;

63 cÚ¡ 
scheduËr
 
sched_üed™_def
;

64 cÚ¡ 
scheduËr
 
sched_üed™2_def
;

65 cÚ¡ 
scheduËr
 
sched_¬šc653_def
;

66 cÚ¡ 
scheduËr
 *
	gscheduËrs
[] = {

67 &
sched_£df_def
,

68 &
sched_üed™_def
,

69 &
sched_üed™2_def
,

70 &
sched_¬šc653_def
,

71 
NULL


74 
scheduËr
 
__»ad_mo¡ly
 
	gİs
;

76 
	#SCHED_OP
(
İ¥Œ
, 
â
, ...) \

77 (Ğ(
İ¥Œ
)->
â
 !ğ
NULL
 ) ? (İ¥Œ)->
	`â
(İ¥Œ, ##
__VA_ARGS__
 ) \

78 : (
	`ty³of
((
İ¥Œ
)->
	`â
(İ¥Œ, ##
__VA_ARGS__
)))0 )

	)

80 
	#DOM2OP
(
_d
è(((_d)->
ıupoŞ
 =ğ
NULL
è? &
İs
 : ((_d)->ıupoŞ->
sched
))

	)

81 
	#VCPU2OP
(
_v
è(
	`DOM2OP
((_v)->
domaš
))

	)

82 
	#VCPU2ONLINE
(
_v
) \

83 (((
_v
)->
domaš
->
ıupoŞ
 =ğ
NULL
è? &
ıu_Úlše_m­
 \

84 : &(
_v
)->
domaš
->
ıupoŞ
->
ıu_v®id
)

	)

86 
šlše
 
	$Œaû_run¡©e_chªge
(
vıu
 *
v
, 
Ãw_¡©e
)

88 ¡ruù { 
ušt32_t
 
vıu
:16, 
domaš
:16; } 
d
;

89 
ušt32_t
 
ev’t
;

91 iàĞ
	`lik–y
(!
tb_š™_dÚe
) )

94 
d
.
vıu
 = 
v
->
vıu_id
;

95 
d
.
domaš
 = 
v
->domaš->
domaš_id
;

97 
ev’t
 = 
TRC_SCHED_RUNSTATE_CHANGE
;

98 
ev’t
 |ğĞ
v
->
run¡©e
.
¡©e
 & 0x3 ) << 8;

99 
ev’t
 |ğĞ
Ãw_¡©e
 & 0x3 ) << 4;

101 
	`__Œaû_v¬
(
ev’t
, 1 , (
d
), &d);

102 
	}
}

104 
šlše
 
	$Œaû_cÚtšue_ruÂšg
(
vıu
 *
v
)

106 ¡ruù { 
ušt32_t
 
vıu
:16, 
domaš
:16; } 
d
;

108 iàĞ
	`lik–y
(!
tb_š™_dÚe
) )

111 
d
.
vıu
 = 
v
->
vıu_id
;

112 
d
.
domaš
 = 
v
->domaš->
domaš_id
;

114 
	`__Œaû_v¬
(
TRC_SCHED_CONTINUE_RUNNING
, 1 , (
d
), &d);

115 
	}
}

117 
šlše
 
	$vıu_urg’t_couÁ_upd©e
(
vıu
 *
v
)

119 iàĞ
	`is_idË_vıu
(
v
) )

122 iàĞ
	`uÆik–y
(
v
->
is_urg’t
) )

124 iàĞ!
	`‹¡_b™
(
_VPF_blocked
, &
v
->
·u£_æags
) ||

125 !
	`‹¡_b™
(
v
->
vıu_id
, v->
domaš
->
pŞl_mask
) )

127 
v
->
is_urg’t
 = 0;

128 
	`©omic_dec
(&
	`³r_ıu
(
scheduË_d©a
,
v
->
´oûssÜ
).
urg’t_couÁ
);

133 iàĞ
	`uÆik–y
(
	`‹¡_b™
(
_VPF_blocked
, &
v
->
·u£_æags
) &&

134 
	`‹¡_b™
(
v
->
vıu_id
, v->
domaš
->
pŞl_mask
)) )

136 
v
->
is_urg’t
 = 1;

137 
	`©omic_šc
(&
	`³r_ıu
(
scheduË_d©a
,
v
->
´oûssÜ
).
urg’t_couÁ
);

140 
	}
}

142 
šlše
 
	$vıu_run¡©e_chªge
(

143 
vıu
 *
v
, 
Ãw_¡©e
, 
s_time_t
 
Ãw_’Œy_time
)

145 
s_time_t
 
d–
;

147 
	`ASSERT
(
v
->
run¡©e
.
¡©e
 !ğ
Ãw_¡©e
);

148 
	`ASSERT
(
	`¥š_is_locked
(
	`³r_ıu
(
scheduË_d©a
,
v
->
´oûssÜ
).
scheduË_lock
));

150 
	`vıu_urg’t_couÁ_upd©e
(
v
);

152 
	`Œaû_run¡©e_chªge
(
v
, 
Ãw_¡©e
);

154 
d–
 = 
Ãw_’Œy_time
 - 
v
->
run¡©e
.
¡©e_’Œy_time
;

155 iàĞ
d–
 > 0 )

157 
v
->
run¡©e
.
time
[v->run¡©e.
¡©e
] +ğ
d–
;

158 
v
->
run¡©e
.
¡©e_’Œy_time
 = 
Ãw_’Œy_time
;

161 
v
->
run¡©e
.
¡©e
 = 
Ãw_¡©e
;

162 
	}
}

164 
	$vıu_run¡©e_g‘
(
vıu
 *
v
, 
vıu_run¡©e_šfo
 *
run¡©e
)

166 
s_time_t
 
d–
;

168 iàĞ
	`uÆik–y
(
v
 !ğ
cu¼’t
) )

169 
	`vıu_scheduË_lock_œq
(
v
);

171 
	`memıy
(
run¡©e
, &
v
->runstate, (*runstate));

172 
d–
 = 
	`NOW
(è- 
run¡©e
->
¡©e_’Œy_time
;

173 iàĞ
d–
 > 0 )

174 
run¡©e
->
time
[run¡©e->
¡©e
] +ğ
d–
;

176 iàĞ
	`uÆik–y
(
v
 !ğ
cu¼’t
) )

177 
	`vıu_scheduË_uÆock_œq
(
v
);

178 
	}
}

180 
ušt64_t
 
	$g‘_ıu_idË_time
(
ıu
)

182 
vıu_run¡©e_šfo
 
¡©e
;

183 
vıu
 *
v
;

185 iàĞ(
v
 = 
idË_vıu
[
ıu
]è=ğ
NULL
 )

188 
	`vıu_run¡©e_g‘
(
v
, &
¡©e
);

189  
¡©e
.
time
[
RUNSTATE_ruÂšg
];

190 
	}
}

192 
	$sched_š™_vıu
(
vıu
 *
v
, 
´oûssÜ
)

194 
domaš
 *
d
 = 
v
->domain;

200 
v
->
´oûssÜ
 =…rocessor;

201 iàĞ
	`is_idË_domaš
(
d
è|| d->
is_pšÃd
 )

202 
v
->
ıu_affš™y
 = 
	`ıumask_of_ıu
(
´oûssÜ
);

204 
	`ıus_£Î
(
v
->
ıu_affš™y
);

207 
	`š™_tim”
(&
v
->
³riodic_tim”
, 
vıu_³riodic_tim”_â
,

208 
v
, v->
´oûssÜ
);

209 
	`š™_tim”
(&
v
->
sšgËshÙ_tim”
, 
vıu_sšgËshÙ_tim”_â
,

210 
v
, v->
´oûssÜ
);

211 
	`š™_tim”
(&
v
->
pŞl_tim”
, 
pŞl_tim”_â
,

212 
v
, v->
´oûssÜ
);

215 iàĞ
	`is_idË_domaš
(
d
) )

217 
	`³r_ıu
(
scheduË_d©a
, 
v
->
´oûssÜ
).
cu¼
 = v;

218 
v
->
is_ruÂšg
 = 1;

221 
	`TRACE_2D
(
TRC_SCHED_DOM_ADD
, 
v
->
domaš
->
domaš_id
, v->
vıu_id
);

223 
v
->
sched_´iv
 = 
	`SCHED_OP
(
	`DOM2OP
(
d
), 
®loc_vd©a
, v, d->sched_priv);

224 iàĞ
v
->
sched_´iv
 =ğ
NULL
 )

227 
v
->
myæag
 = 0;

228 #ifdeà
ENABLE_PGD


229 
v
->
cu¼’t_pgd
 = 
NULL
;

230 
v
->
cu¼’t_k¡ack
 = 
NULL
;

232 
v
->
Ï¡_e
 = 0;

233 
v
->
§me_e_couÁ
 = 0;

234 
v
->
de¡_ÿche
 = -1;

235 
v
->
run_couÁ
 = 0;

236 
v
->
run_ÿche
 = -1;

237 
v
->
´št_couÁdown
 = 80;

238 #ifdeà
ENABLE_GLOBALIZE2


239 
v
->
ui_šdex
 = 0;

240 
v
->
ui
 = &v->
ui_body
[0];

241 
	`š™_ui
(
v
->
ui
);

243 #ifdeà
DEBUG_STAT


244 
	`mem£t
(
v
->
vcouÁ
, 0, (v->vcount));

246 #ifdeà
ENABLE_TIMESTAMP


247 
	`š™_time¡amp
(&
v
->
time¡amp
);

250 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
š£¹_vıu
, v);

253 
	}
}

255 
	$sched_move_domaš
(
domaš
 *
d
, 
ıupoŞ
 *
c
)

257 
vıu
 *
v
;

258 
Ãw_p
;

259 **
vıu_´iv
;

260 *
domd©a
;

262 
domd©a
 = 
	`SCHED_OP
(
c
->
sched
, 
®loc_domd©a
, 
d
);

263 iàĞ
domd©a
 =ğ
NULL
 )

264  -
ENOMEM
;

266 
vıu_´iv
 = 
	`xm®loc_¬¿y
(*, 
d
->
max_vıus
);

267 iàĞ
vıu_´iv
 =ğ
NULL
 )

269 
	`SCHED_OP
(
c
->
sched
, 
ä“_domd©a
, 
domd©a
);

270  -
ENOMEM
;

273 
	`mem£t
(
vıu_´iv
, 0, 
d
->
max_vıus
 * (*));

274 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

276 
vıu_´iv
[
v
->
vıu_id
] = 
	`SCHED_OP
(
c
->
sched
, 
®loc_vd©a
, v, 
domd©a
);

277 iàĞ
vıu_´iv
[
v
->
vıu_id
] =ğ
NULL
 )

279 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

281 iàĞ
vıu_´iv
[
v
->
vıu_id
] !ğ
NULL
 )

282 
	`xä“
(
vıu_´iv
[
v
->
vıu_id
]);

284 
	`xä“
(
vıu_´iv
);

285 
	`SCHED_OP
(
c
->
sched
, 
ä“_domd©a
, 
domd©a
);

286  -
ENOMEM
;

290 
	`domaš_·u£
(
d
);

292 
Ãw_p
 = 
	`fœ¡_ıu
(
c
->
ıu_v®id
);

293 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

295 
	`mig¿‹_tim”
(&
v
->
³riodic_tim”
, 
Ãw_p
);

296 
	`mig¿‹_tim”
(&
v
->
sšgËshÙ_tim”
, 
Ãw_p
);

297 
	`mig¿‹_tim”
(&
v
->
pŞl_tim”
, 
Ãw_p
);

299 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
»move_vıu
, v);

300 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
ä“_vd©a
, v->
sched_´iv
);

302 
	`ıus_£Î
(
v
->
ıu_affš™y
);

303 
v
->
´oûssÜ
 = 
Ãw_p
;

304 
v
->
sched_´iv
 = 
vıu_´iv
[v->
vıu_id
];

305 
	`evtchn_move_pœqs
(
v
);

307 
Ãw_p
 = 
	`cyşe_ıu
Òew_p, 
c
->
ıu_v®id
);

309 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
š£¹_vıu
, v);

311 
	`domaš_upd©e_node_affš™y
(
d
);

313 
d
->
ıupoŞ
 = 
c
;

314 
	`SCHED_OP
(
	`DOM2OP
(
d
), 
ä“_domd©a
, d->
sched_´iv
);

315 
d
->
sched_´iv
 = 
domd©a
;

317 
	`domaš_uÅau£
(
d
);

319 
	`xä“
(
vıu_´iv
);

322 
	}
}

324 
	$sched_de¡roy_vıu
(
vıu
 *
v
)

326 
	`kl_tim”
(&
v
->
³riodic_tim”
);

327 
	`kl_tim”
(&
v
->
sšgËshÙ_tim”
);

328 
	`kl_tim”
(&
v
->
pŞl_tim”
);

329 iàĞ
	`‹¡_ªd_ş—r_boŞ
(
v
->
is_urg’t
) )

330 
	`©omic_dec
(&
	`³r_ıu
(
scheduË_d©a
, 
v
->
´oûssÜ
).
urg’t_couÁ
);

331 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
»move_vıu
, v);

332 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
ä“_vd©a
, v->
sched_´iv
);

333 
	}
}

335 
	$sched_š™_domaš
(
domaš
 *
d
)

337 #ifdeà
ENABLE_PGD


338 
d
->
k”Ãl_pgd
 = 
NULL
;

339 
	`¥š_lock_š™
(&
d
->
k”Ãl_pgd_lock
);

341 #ifdeà
ENABLE_GUEST_REGION


342 
	`š™_g¹
(
d
);

344  
	`SCHED_OP
(
	`DOM2OP
(
d
), 
š™_domaš
, d);

345 
	}
}

347 
	$sched_de¡roy_domaš
(
domaš
 *
d
)

349 #ifdeà
ENABLE_GUEST_REGION


350 
	`de¡roy_g¹
(
d
);

352 
	`SCHED_OP
(
	`DOM2OP
(
d
), 
de¡roy_domaš
, d);

353 
	}
}

355 
	$vıu_¦“p_nosync
(
vıu
 *
v
)

357 
æags
;

359 
	`vıu_scheduË_lock_œq§ve
(
v
, 
æags
);

361 iàĞ
	`lik–y
(!
	`vıu_ruÂabË
(
v
)) )

363 iàĞ
v
->
run¡©e
.
¡©e
 =ğ
RUNSTATE_ruÂabË
 )

364 
	`vıu_run¡©e_chªge
(
v
, 
RUNSTATE_ofæše
, 
	`NOW
());

366 #ifdeà
VERBOSE_USCHED_DETAIL


370 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
¦“p
, v);

373 
	`vıu_scheduË_uÆock_œq»¡Üe
(
v
, 
æags
);

375 
	`TRACE_2D
(
TRC_SCHED_SLEEP
, 
v
->
domaš
->
domaš_id
, v->
vıu_id
);

376 
	}
}

378 
	$vıu_¦“p_sync
(
vıu
 *
v
)

380 
	`vıu_¦“p_nosync
(
v
);

382  !
	`vıu_ruÂabË
(
v
è&& v->
is_ruÂšg
 )

383 
	`ıu_»Ïx
();

385 
	`sync_vıu_exec¡©e
(
v
);

386 
	}
}

388 
	$vıu_wake
(
vıu
 *
v
)

390 
æags
;

392 
	`vıu_scheduË_lock_œq§ve
(
v
, 
æags
);

394 iàĞ
	`lik–y
(
	`vıu_ruÂabË
(
v
)) )

396 iàĞ
v
->
run¡©e
.
¡©e
 >ğ
RUNSTATE_blocked
 )

397 
	`vıu_run¡©e_chªge
(
v
, 
RUNSTATE_ruÂabË
, 
	`NOW
());

398 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
wake
, v);

400 iàĞ!
	`‹¡_b™
(
_VPF_blocked
, &
v
->
·u£_æags
) )

402 iàĞ
v
->
run¡©e
.
¡©e
 =ğ
RUNSTATE_blocked
 )

403 
	`vıu_run¡©e_chªge
(
v
, 
RUNSTATE_ofæše
, 
	`NOW
());

406 
	`vıu_scheduË_uÆock_œq»¡Üe
(
v
, 
æags
);

408 
	`TRACE_2D
(
TRC_SCHED_WAKE
, 
v
->
domaš
->
domaš_id
, v->
vıu_id
);

409 
	}
}

411 
	$vıu_unblock
(
vıu
 *
v
)

413 iàĞ!
	`‹¡_ªd_ş—r_b™
(
_VPF_blocked
, &
v
->
·u£_æags
) )

417 iàĞ
	`uÆik–y
(
v
->
pŞl_evtchn
 != 0) )

419 
v
->
pŞl_evtchn
 = 0;

425 iàĞ
	`‹¡_ªd_ş—r_b™
(
v
->
vıu_id
, v->
domaš
->
pŞl_mask
) )

426 
	`ş—r_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

429 
	`vıu_wake
(
v
);

430 
	}
}

432 
	$vıu_mig¿‹
(
vıu
 *
v
)

434 
æags
;

435 
Şd_ıu
, 
Ãw_ıu
;

436 
¥šlock_t
 *
Şd_lock
, *
Ãw_lock
;

437 
boŞ_t
 
pick_ÿÎed
 = 0;

439 
Şd_ıu
 = 
Ãw_ıu
 = 
v
->
´oûssÜ
;

451 
Şd_lock
 = 
	`³r_ıu
(
scheduË_d©a
, 
Şd_ıu
).
scheduË_lock
;

452 
Ãw_lock
 = 
	`³r_ıu
(
scheduË_d©a
, 
Ãw_ıu
).
scheduË_lock
;

454 iàĞ
Şd_lock
 =ğ
Ãw_lock
 )

456 
	`¥š_lock_œq§ve
(
Şd_lock
, 
æags
);

458 iàĞ
Şd_lock
 < 
Ãw_lock
 )

460 
	`¥š_lock_œq§ve
(
Şd_lock
, 
æags
);

461 
	`¥š_lock
(
Ãw_lock
);

465 
	`¥š_lock_œq§ve
(
Ãw_lock
, 
æags
);

466 
	`¥š_lock
(
Şd_lock
);

469 
Şd_ıu
 = 
v
->
´oûssÜ
;

470 iàĞ
Şd_lock
 =ğ
	`³r_ıu
(
scheduË_d©a
, 
Şd_ıu
).
scheduË_lock
 )

476 iàĞ
pick_ÿÎed
 &&

477 (
Ãw_lock
 =ğ
	`³r_ıu
(
scheduË_d©a
, 
Ãw_ıu
).
scheduË_lock
) &&

478 
	`ıu_is£t
(
Ãw_ıu
, 
v
->
ıu_affš™y
) &&

479 
	`ıu_is£t
(
Ãw_ıu
, 
v
->
domaš
->
ıupoŞ
->
ıu_v®id
) )

483 
Ãw_ıu
 = 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
pick_ıu
, v);

484 iàĞ(
Ãw_lock
 =ğ
	`³r_ıu
(
scheduË_d©a
, 
Ãw_ıu
).
scheduË_lock
) &&

485 
	`ıu_is£t
(
Ãw_ıu
, 
v
->
domaš
->
ıupoŞ
->
ıu_v®id
) )

487 
pick_ÿÎed
 = 1;

495 
pick_ÿÎed
 = 0;

498 iàĞ
Şd_lock
 !ğ
Ãw_lock
 )

499 
	`¥š_uÆock
(
Ãw_lock
);

500 
	`¥š_uÆock_œq»¡Üe
(
Şd_lock
, 
æags
);

508 iàĞ
v
->
is_ruÂšg
 ||

509 !
	`‹¡_ªd_ş—r_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
) )

512 
	`MYASSERT
(
v
->
de¡_ÿche
 == -1);

514 iàĞ
Şd_lock
 !ğ
Ãw_lock
 )

515 
	`¥š_uÆock
(
Ãw_lock
);

516 
	`¥š_uÆock_œq»¡Üe
(
Şd_lock
, 
æags
);

520 #ifdeà
ENABLE_PAGE_TOUCH


521 ià(
v
->
de¡_ÿche
 != -1) {

522 
	`MYASSERT
(
Ãw_ıu
 !ğ
Şd_ıu
);

524 #ifdeà
VERBOSE_USCHED_DETAIL


525 ià(
usched_´št
-- > 0) {

526 
	`my´štk
("ıu_pick„‘uºed cpu %d\n", 
Ãw_ıu
);

531 
	`MYASSERT
(
v
->
run_couÁ
 =ğ0 && v->
run_ÿche
 == -1);

532 
v
->
run_couÁ
 = 1;

533 
v
->
run_ÿche
 = v->
de¡_ÿche
;

534 
v
->
de¡_ÿche
 = -1;

543 iàĞ
	`uÆik–y
(
v
->
is_urg’t
è&& (
Şd_ıu
 !ğ
Ãw_ıu
) )

545 
	`©omic_šc
(&
	`³r_ıu
(
scheduË_d©a
, 
Ãw_ıu
).
urg’t_couÁ
);

546 
	`©omic_dec
(&
	`³r_ıu
(
scheduË_d©a
, 
Şd_ıu
).
urg’t_couÁ
);

553 iàĞ
	`VCPU2OP
(
v
)->
mig¿‹
 )

554 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
mig¿‹
, v, 
Ãw_ıu
);

556 
v
->
´oûssÜ
 = 
Ãw_ıu
;

559 iàĞ
Şd_lock
 !ğ
Ãw_lock
 )

560 
	`¥š_uÆock
(
Ãw_lock
);

561 
	`¥š_uÆock_œq»¡Üe
(
Şd_lock
, 
æags
);

563 iàĞ
Şd_ıu
 !ğ
Ãw_ıu
 )

564 
	`evtchn_move_pœqs
(
v
);

567 
	`vıu_wake
(
v
);

568 
	}
}

576 
	$vıu_fÜû_»scheduË
(
vıu
 *
v
)

578 
	`vıu_scheduË_lock_œq
(
v
);

579 iàĞ
v
->
is_ruÂšg
 )

580 
	`£t_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
);

581 
	`vıu_scheduË_uÆock_œq
(
v
);

583 iàĞ
	`‹¡_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
) )

585 
	`vıu_¦“p_nosync
(
v
);

586 
	`vıu_mig¿‹
(
v
);

588 
	}
}

594 
	$ıu_di§bË_scheduËr
(
ıu
)

596 
domaš
 *
d
;

597 
vıu
 *
v
;

598 
ıupoŞ
 *
c
;

599 
ıumask_t
 
Úlše_affš™y
;

600 
»t
 = 0;

601 
boŞ_t
 
affš™y_brok’
;

603 
c
 = 
	`³r_ıu
(
ıupoŞ
, 
ıu
);

604 iàĞ
c
 =ğ
NULL
 )

605  
»t
;

607 
	`fÜ_—ch_domaš
 ( 
d
 )

609 iàĞ
d
->
ıupoŞ
 !ğ
c
 )

612 
affš™y_brok’
 = 0;

614 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

616 
	`vıu_scheduË_lock_œq
(
v
);

618 
	`ıus_ªd
(
Úlše_affš™y
, 
v
->
ıu_affš™y
, 
c
->
ıu_v®id
);

619 iàĞ
	`ıus_em±y
(
Úlše_affš™y
) &&

620 
	`ıu_is£t
(
ıu
, 
v
->
ıu_affš™y
) )

622 
	`´štk
("Breaking vcpu‡ffinity for domain %d vcpu %d\n",

623 
v
->
domaš
->
domaš_id
, v->
vıu_id
);

624 
	`ıus_£Î
(
v
->
ıu_affš™y
);

625 
affš™y_brok’
 = 1;

628 iàĞ
v
->
´oûssÜ
 =ğ
ıu
 )

630 
	`£t_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
);

631 
	`vıu_scheduË_uÆock_œq
(
v
);

632 
	`vıu_¦“p_nosync
(
v
);

633 
	`vıu_mig¿‹
(
v
);

637 
	`vıu_scheduË_uÆock_œq
(
v
);

645 iàĞ
v
->
´oûssÜ
 =ğ
ıu
 )

646 
»t
 = -
EAGAIN
;

649 iàĞ
affš™y_brok’
 )

650 
	`domaš_upd©e_node_affš™y
(
d
);

653  
»t
;

654 
	}
}

656 #ifdeà
HETERO_VISOR


657 
	$h‘”o_vıu_mig¿‹
(
vıu
 *
v
, 
ıumask_t
 *
affš™y
)

661 
	`WARN_ON
(
	`ıus_em±y
(*
affš™y
));

662 if(
	`ıumask_equ®
Ğ
affš™y
, &(
v
->
ıu_affš™y
)))

663 
	`´štk
("vcpu migrationo current mask\n");

665 iàĞ
	`ıus_em±y
(*
affš™y
))

666  -
EINVAL
;

668 
	`vıu_scheduË_lock_œq
(
v
);

669 
v
->
ıu_affš™y
 = *
affš™y
;

670 
	`£t_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
);

671 
	`vıu_scheduË_uÆock_œq
(
v
);

673 
	`vıu_¦“p_nosync
(
v
);

674 
	`vıu_mig¿‹
(
v
);

677 
	}
}

680 #ifdeà
ENABLE_PAGE_TOUCH


682 
	$mymig¿‹
(
ıumask_t
 
de¡_ıumask
) {

683 
vıu
 *
v
 = 
cu¼’t
;

684 iàĞ
v
->
domaš
->
is_pšÃd
 ) {

685 
	`my·nic
("TODO: what case ishis?");

687 
	`MYASSERT
(!
	`ıu_is£t
(
cu¼’t
->
´oûssÜ
, 
de¡_ıumask
));

689 
	`MYASSERT
Ğ!
	`ıus_em±y
(
de¡_ıumask
) );

690 
	`vıu_scheduË_lock_œq
(
v
);

691 
	`£t_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
);

692 
	`vıu_scheduË_uÆock_œq
(
v
);

695 
	`vıu_¦“p_nosync
(
v
);

699 
	}
}

702 
	$vıu_£t_affš™y
(
vıu
 *
v
, 
ıumask_t
 *
affš™y
)

704 
ıumask_t
 
Úlše_affš™y
, 
Şd_affš™y
;

705 
ıumask_t
 *
Úlše
;

707 iàĞ
v
->
domaš
->
is_pšÃd
 )

708  -
EINVAL
;

709 
Úlše
 = 
	`VCPU2ONLINE
(
v
);

710 
	`ıus_ªd
(
Úlše_affš™y
, *
affš™y
, *
Úlše
);

711 iàĞ
	`ıus_em±y
(
Úlše_affš™y
) )

712  -
EINVAL
;

714 
	`vıu_scheduË_lock_œq
(
v
);

716 
Şd_affš™y
 = 
v
->
ıu_affš™y
;

717 
v
->
ıu_affš™y
 = *
affš™y
;

718 *
affš™y
 = 
Şd_affš™y
;

719 iàĞ!
	`ıu_is£t
(
v
->
´oûssÜ
, v->
ıu_affš™y
) )

720 
	`£t_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
);

722 
	`vıu_scheduË_uÆock_œq
(
v
);

724 
	`domaš_upd©e_node_affš™y
(
v
->
domaš
);

726 iàĞ
	`‹¡_b™
(
_VPF_mig¿tšg
, &
v
->
·u£_æags
) )

728 
	`vıu_¦“p_nosync
(
v
);

729 
	`vıu_mig¿‹
(
v
);

733 
	}
}

736 
	$do_block
()

738 
vıu
 *
v
 = 
cu¼’t
;

740 
	`loÿl_ev’t_d–iv”y_’abË
();

741 
	`£t_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

744 iàĞ
	`loÿl_ev’ts_Ãed_d–iv”y
() )

746 
	`ş—r_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

750 
	`TRACE_2D
(
TRC_SCHED_BLOCK
, 
v
->
domaš
->
domaš_id
, v->
vıu_id
);

751 
	`¿i£_soáœq
(
SCHEDULE_SOFTIRQ
);

755 
	}
}

757 
	$do_pŞl
(
sched_pŞl
 *sched_poll)

759 
vıu
 *
v
 = 
cu¼’t
;

760 
domaš
 *
d
 = 
v
->domain;

761 
evtchn_pÜt_t
 
pÜt
;

762 
rc
;

763 
i
;

766 iàĞ
sched_pŞl
->
Ä_pÜts
 > 128 )

767  -
EINVAL
;

769 iàĞ!
	`gue¡_hªdË_okay
(
sched_pŞl
->
pÜts
, sched_pŞl->
Ä_pÜts
) )

770  -
EFAULT
;

772 
	`£t_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

773 
v
->
pŞl_evtchn
 = -1;

774 
	`£t_b™
(
v
->
vıu_id
, 
d
->
pŞl_mask
);

776 #iâdeà
CONFIG_X86


778 
	`smp_mb
();

785 
rc
 = 0;

786 iàĞ(
v
->
pŞl_evtchn
 == 0) ||

787 !
	`‹¡_b™
(
_VPF_blocked
, &
v
->
·u£_æags
) ||

788 !
	`‹¡_b™
(
v
->
vıu_id
, 
d
->
pŞl_mask
) )

789 
out
;

792 
rc
 = 0;

793 iàĞ
	`loÿl_ev’ts_Ãed_d–iv”y
() )

794 
out
;

796  
i
 = 0; i < 
sched_pŞl
->
Ä_pÜts
; i++ )

798 
rc
 = -
EFAULT
;

799 iàĞ
	`__cİy_äom_gue¡_off£t
(&
pÜt
, 
sched_pŞl
->
pÜts
, 
i
, 1) )

800 
out
;

802 
rc
 = -
EINVAL
;

803 iàĞ
pÜt
 >ğ
	`MAX_EVTCHNS
(
d
) )

804 
out
;

806 
rc
 = 0;

807 iàĞ
	`‹¡_b™
(
pÜt
, &
	`sh¬ed_šfo
(
d
, 
evtchn_³ndšg
)) )

808 
out
;

811 iàĞ
sched_pŞl
->
Ä_pÜts
 == 1 )

812 
v
->
pŞl_evtchn
 = 
pÜt
;

814 iàĞ
sched_pŞl
->
timeout
 != 0 )

815 
	`£t_tim”
(&
v
->
pŞl_tim”
, 
sched_pŞl
->
timeout
);

817 
	`TRACE_2D
(
TRC_SCHED_BLOCK
, 
d
->
domaš_id
, 
v
->
vıu_id
);

818 
	`¿i£_soáœq
(
SCHEDULE_SOFTIRQ
);

822 
out
:

823 
v
->
pŞl_evtchn
 = 0;

824 
	`ş—r_b™
(
v
->
vıu_id
, 
d
->
pŞl_mask
);

825 
	`ş—r_b™
(
_VPF_blocked
, &
v
->
·u£_æags
);

826  
rc
;

827 
	}
}

830 
	$do_y›ld
()

832 
vıu
 * 
v
=
cu¼’t
;

834 
	`vıu_scheduË_lock_œq
(
v
);

835 
	`SCHED_OP
(
	`VCPU2OP
(
v
), 
y›ld
, v);

836 
	`vıu_scheduË_uÆock_œq
(
v
);

838 
	`TRACE_2D
(
TRC_SCHED_YIELD
, 
cu¼’t
->
domaš
->
domaš_id
, cu¼’t->
vıu_id
);

839 
	`¿i£_soáœq
(
SCHEDULE_SOFTIRQ
);

841 
	}
}

843 
	$domaš_w©chdog_timeout
(*
d©a
)

845 
domaš
 *
d
 = 
d©a
;

847 iàĞ
d
->
is_shu‰šg_down
 || d->
is_dyšg
 )

850 
	`´štk
("W©chdogim” fœed fÜ domaš %u\n", 
d
->
domaš_id
);

851 
	`domaš_shutdown
(
d
, 
SHUTDOWN_w©chdog
);

852 
	}
}

854 
	$domaš_w©chdog
(
domaš
 *
d
, 
ušt32_t
 
id
, ušt32_ˆ
timeout
)

856 iàĞ
id
 > 
NR_DOMAIN_WATCHDOG_TIMERS
 )

857  -
EINVAL
;

859 
	`¥š_lock
(&
d
->
w©chdog_lock
);

861 iàĞ
id
 == 0 )

863  
id
 = 0; id < 
NR_DOMAIN_WATCHDOG_TIMERS
; id++ )

865 iàĞ
	`‹¡_ªd_£t_b™
(
id
, &
d
->
w©chdog_šu£_m­
) )

867 
	`£t_tim”
(&
d
->
w©chdog_tim”
[
id
], 
	`NOW
(è+ 
	`SECONDS
(
timeout
));

870 
	`¥š_uÆock
(&
d
->
w©chdog_lock
);

871  
id
 =ğ
NR_DOMAIN_WATCHDOG_TIMERS
 ? -
EEXIST
 : id + 1;

874 
id
 -= 1;

875 iàĞ!
	`‹¡_b™
(
id
, &
d
->
w©chdog_šu£_m­
) )

877 
	`¥š_uÆock
(&
d
->
w©chdog_lock
);

878  -
EEXIST
;

881 iàĞ
timeout
 == 0 )

883 
	`¡İ_tim”
(&
d
->
w©chdog_tim”
[
id
]);

884 
	`ş—r_b™
(
id
, &
d
->
w©chdog_šu£_m­
);

888 
	`£t_tim”
(&
d
->
w©chdog_tim”
[
id
], 
	`NOW
(è+ 
	`SECONDS
(
timeout
));

891 
	`¥š_uÆock
(&
d
->
w©chdog_lock
);

893 
	}
}

895 
	$w©chdog_domaš_š™
(
domaš
 *
d
)

897 
i
;

899 
	`¥š_lock_š™
(&
d
->
w©chdog_lock
);

901 
d
->
w©chdog_šu£_m­
 = 0;

903  
i
 = 0; i < 
NR_DOMAIN_WATCHDOG_TIMERS
; i++ )

904 
	`š™_tim”
(&
d
->
w©chdog_tim”
[
i
], 
domaš_w©chdog_timeout
, d, 0);

905 
	}
}

907 
	$w©chdog_domaš_de¡roy
(
domaš
 *
d
)

909 
i
;

911  
i
 = 0; i < 
NR_DOMAIN_WATCHDOG_TIMERS
; i++ )

912 
	`kl_tim”
(&
d
->
w©chdog_tim”
[
i
]);

913 
	}
}

915 
	$do_sched_İ_com·t
(
cmd
, 
¬g
)

917 
»t
 = 0;

919  
cmd
 )

921 
SCHEDOP_y›ld
:

923 
»t
 = 
	`do_y›ld
();

927 
SCHEDOP_block
:

929 
»t
 = 
	`do_block
();

933 
SCHEDOP_shutdown
:

935 
	`TRACE_3D
(
TRC_SCHED_SHUTDOWN
,

936 
cu¼’t
->
domaš
->
domaš_id
, cu¼’t->
vıu_id
, 
¬g
);

937 
	`domaš_shutdown
(
cu¼’t
->
domaš
, (
u8
)
¬g
);

942 
»t
 = -
ENOSYS
;

945  
»t
;

946 
	}
}

948 
	t»t_t
;

952 
»t_t
 
do_sched_İ
(
cmd
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

954 
»t_t
 
»t
 = 0;

956  
cmd
 )

958 
SCHEDOP_y›ld
:

960 
»t
 = 
	`do_y›ld
();

964 
SCHEDOP_block
:

966 
»t
 = 
	`do_block
();

970 
SCHEDOP_shutdown
:

972 
sched_shutdown
 sched_shutdown;

974 
»t
 = -
EFAULT
;

975 iàĞ
	`cİy_äom_gue¡
(&
sched_shutdown
, 
¬g
, 1) )

978 
»t
 = 0;

979 
	`TRACE_3D
(
TRC_SCHED_SHUTDOWN
,

980 
cu¼’t
->
domaš
->
domaš_id
, cu¼’t->
vıu_id
,

981 
sched_shutdown
.
»asÚ
);

982 
	`domaš_shutdown
(
cu¼’t
->
domaš
, (
u8
)
sched_shutdown
.
»asÚ
);

987 
SCHEDOP_shutdown_code
:

989 
sched_shutdown
 sched_shutdown;

990 
domaš
 *
d
 = 
cu¼’t
->domain;

992 
»t
 = -
EFAULT
;

993 iàĞ
	`cİy_äom_gue¡
(&
sched_shutdown
, 
¬g
, 1) )

996 
	`TRACE_3D
(
TRC_SCHED_SHUTDOWN_CODE
,

997 
d
->
domaš_id
, 
cu¼’t
->
vıu_id
, 
sched_shutdown
.
»asÚ
);

999 
	`¥š_lock
(&
d
->
shutdown_lock
);

1000 iàĞ
d
->
shutdown_code
 == -1 )

1001 
d
->
shutdown_code
 = (
u8
)
sched_shutdown
.
»asÚ
;

1002 
	`¥š_uÆock
(&
d
->
shutdown_lock
);

1004 
»t
 = 0;

1008 
SCHEDOP_pŞl
:

1010 
sched_pŞl
 sched_poll;

1012 
»t
 = -
EFAULT
;

1013 iàĞ
	`cİy_äom_gue¡
(&
sched_pŞl
, 
¬g
, 1) )

1016 
»t
 = 
	`do_pŞl
(&
sched_pŞl
);

1021 
SCHEDOP_»mÙe_shutdown
:

1023 
domaš
 *
d
;

1024 
sched_»mÙe_shutdown
 sched_remote_shutdown;

1026 
»t
 = -
EFAULT
;

1027 iàĞ
	`cİy_äom_gue¡
(&
sched_»mÙe_shutdown
, 
¬g
, 1) )

1030 
»t
 = -
ESRCH
;

1031 
d
 = 
	`rcu_lock_domaš_by_id
(
sched_»mÙe_shutdown
.
domaš_id
);

1032 iàĞ
d
 =ğ
NULL
 )

1035 iàĞ!
	`IS_PRIV_FOR
(
cu¼’t
->
domaš
, 
d
) )

1037 
	`rcu_uÆock_domaš
(
d
);

1038  -
EPERM
;

1041 
»t
 = 
	`xsm_schedİ_shutdown
(
cu¼’t
->
domaš
, 
d
);

1042 iàĞ
»t
 )

1044 
	`rcu_uÆock_domaš
(
d
);

1045  
»t
;

1048 
	`domaš_shutdown
(
d
, (
u8
)
sched_»mÙe_shutdown
.
»asÚ
);

1050 
	`rcu_uÆock_domaš
(
d
);

1051 
»t
 = 0;

1056 
SCHEDOP_w©chdog
:

1058 
sched_w©chdog
 sched_watchdog;

1060 
»t
 = -
EFAULT
;

1061 iàĞ
	`cİy_äom_gue¡
(&
sched_w©chdog
, 
¬g
, 1) )

1064 
»t
 = 
	`domaš_w©chdog
(

1065 
cu¼’t
->
domaš
, 
sched_w©chdog
.
id
, sched_w©chdog.
timeout
);

1070 
»t
 = -
ENOSYS
;

1073  
»t
;

1074 
	}
}

1076 #iâdeà
COMPAT


1079 
	$do_£t_tim”_İ
(
s_time_t
 
timeout
)

1081 
vıu
 *
v
 = 
cu¼’t
;

1082 
s_time_t
 
off£t
 = 
timeout
 - 
	`NOW
();

1084 iàĞ
timeout
 == 0 )

1086 
	`¡İ_tim”
(&
v
->
sšgËshÙ_tim”
);

1088 iàĞ
	`uÆik–y
(
timeout
 < 0) ||

1089 
	`uÆik–y
((
off£t
 > 0è&& ((
ušt32_t
)(offset >> 50) != 0)) )

1102 
	`gd´štk
(
XENLOG_INFO
,

1103 "W¬nšg: hugtimeouˆ£ˆby vıu %d: %"
PRIx64
"\n",

1104 
v
->
vıu_id
, (
ušt64_t
)
timeout
);

1105 
	`£t_tim”
(&
v
->
sšgËshÙ_tim”
, 
	`NOW
(è+ 
	`MILLISECS
(100));

1109 
	`mig¿‹_tim”
(&
v
->
sšgËshÙ_tim”
, 
	`smp_´oûssÜ_id
());

1110 
	`£t_tim”
(&
v
->
sšgËshÙ_tim”
, 
timeout
);

1114 
	}
}

1117 
	$sched_id
()

1119  
İs
.
sched_id
;

1120 
	}
}

1123 
	$sched_adju¡
(
domaš
 *
d
, 
x’_domùl_scheduËr_İ
 *
İ
)

1125 
vıu
 *
v
;

1126 
»t
;

1128 iàĞ(
İ
->
sched_id
 !ğ
	`DOM2OP
(
d
)->sched_id) ||

1129 ((
İ
->
cmd
 !ğ
XEN_DOMCTL_SCHEDOP_putšfo
) &&

1130 (
İ
->
cmd
 !ğ
XEN_DOMCTL_SCHEDOP_g‘šfo
)) )

1131  -
EINVAL
;

1146 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

1148 iàĞ
v
 !ğ
cu¼’t
 )

1149 
	`vıu_·u£
(
v
);

1152 iàĞ
d
 =ğ
cu¼’t
->
domaš
 )

1153 
	`vıu_scheduË_lock_œq
(
cu¼’t
);

1155 iàĞ(
»t
 = 
	`SCHED_OP
(
	`DOM2OP
(
d
), 
adju¡
, d, 
İ
)) == 0 )

1156 
	`TRACE_1D
(
TRC_SCHED_ADJDOM
, 
d
->
domaš_id
);

1158 iàĞ
d
 =ğ
cu¼’t
->
domaš
 )

1159 
	`vıu_scheduË_uÆock_œq
(
cu¼’t
);

1161 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

1163 iàĞ
v
 !ğ
cu¼’t
 )

1164 
	`vıu_uÅau£
(
v
);

1167  
»t
;

1168 
	}
}

1170 
	$sched_adju¡_glob®
(
x’_sysùl_scheduËr_İ
 *
İ
)

1172 
ıupoŞ
 *
poŞ
;

1173 
rc
;

1175 iàĞ(
İ
->
cmd
 !ğ
XEN_DOMCTL_SCHEDOP_putšfo
) &&

1176 (
İ
->
cmd
 !ğ
XEN_DOMCTL_SCHEDOP_g‘šfo
) )

1177  -
EINVAL
;

1179 
poŞ
 = 
	`ıupoŞ_g‘_by_id
(
İ
->
ıupoŞ_id
);

1180 iàĞ
poŞ
 =ğ
NULL
 )

1181  -
ESRCH
;

1183 
rc
 = ((
İ
->
sched_id
 =ğ
poŞ
->
sched
->sched_id)

1184 ? 
	`SCHED_OP
(
poŞ
->
sched
, 
adju¡_glob®
, 
İ
è: -
EINVAL
);

1186 
	`ıupoŞ_put
(
poŞ
);

1188  
rc
;

1189 
	}
}

1191 
	$vıu_³riodic_tim”_wÜk
(
vıu
 *
v
)

1193 
s_time_t
 
now
 = 
	`NOW
();

1194 
s_time_t
 
³riodic_Ãxt_ev’t
;

1196 iàĞ
v
->
³riodic_³riod
 == 0 )

1199 
³riodic_Ãxt_ev’t
 = 
v
->
³riodic_Ï¡_ev’t
 + v->
³riodic_³riod
;

1201 iàĞ
now
 >ğ
³riodic_Ãxt_ev’t
 )

1203 
	`£nd_tim”_ev’t
(
v
);

1204 
v
->
³riodic_Ï¡_ev’t
 = 
now
;

1205 
³riodic_Ãxt_ev’t
 = 
now
 + 
v
->
³riodic_³riod
;

1208 
	`mig¿‹_tim”
(&
v
->
³riodic_tim”
, 
	`smp_´oûssÜ_id
());

1209 
	`£t_tim”
(&
v
->
³riodic_tim”
, 
³riodic_Ãxt_ev’t
);

1210 
	}
}

1217 
	$scheduË
()

1219 
vıu
 *
´ev
 = 
cu¼’t
, *
Ãxt
 = 
NULL
;

1220 
s_time_t
 
now
 = 
	`NOW
();

1221 
scheduËr
 *
sched
 = 
	`this_ıu
(scheduler);

1222 *
skËt_wÜk
 = &
	`this_ıu
(
skËt_wÜk_to_do
);

1223 
boŞ_t
 
skËt_wÜk_scheduËd
 = 0;

1224 
scheduË_d©a
 *
sd
;

1225 
sk_¦iû
 
Ãxt_¦iû
;

1227 
	`ASSERT
(!
	`š_©omic
());

1229 
	`³rfc_šü
(
sched_run
);

1231 
sd
 = &
	`this_ıu
(
scheduË_d©a
);

1234  *
skËt_wÜk
 )

1236 
TASKLET_’queued
:

1237 
	`£t_b™
(
_TASKLET_scheduËd
, 
skËt_wÜk
);

1238 
TASKLET_’queued
|
TASKLET_scheduËd
:

1239 
skËt_wÜk_scheduËd
 = 1;

1241 
TASKLET_scheduËd
:

1242 
	`ş—r_b™
(
_TASKLET_scheduËd
, 
skËt_wÜk
);

1247 
	`BUG
();

1250 
	`¥š_lock_œq
(
sd
->
scheduË_lock
);

1252 
	`¡İ_tim”
(&
sd
->
s_tim”
);

1255 
Ãxt_¦iû
 = 
sched
->
	`do_scheduË
(sched, 
now
, 
skËt_wÜk_scheduËd
);

1257 
Ãxt
 = 
Ãxt_¦iû
.
sk
;

1259 
sd
->
cu¼
 = 
Ãxt
;

1261 iàĞ
Ãxt_¦iû
.
time
 >= 0 )

1262 
	`£t_tim”
(&
sd
->
s_tim”
, 
now
 + 
Ãxt_¦iû
.
time
);

1264 iàĞ
	`uÆik–y
(
´ev
 =ğ
Ãxt
) )

1266 
	`¥š_uÆock_œq
(
sd
->
scheduË_lock
);

1267 
	`Œaû_cÚtšue_ruÂšg
(
Ãxt
);

1268  
	`cÚtšue_ruÂšg
(
´ev
);

1271 
	`TRACE_2D
(
TRC_SCHED_SWITCH_INFPREV
,

1272 
´ev
->
domaš
->
domaš_id
,

1273 
now
 - 
´ev
->
run¡©e
.
¡©e_’Œy_time
);

1274 
	`TRACE_3D
(
TRC_SCHED_SWITCH_INFNEXT
,

1275 
Ãxt
->
domaš
->
domaš_id
,

1276 (
Ãxt
->
run¡©e
.
¡©e
 =ğ
RUNSTATE_ruÂabË
) ?

1277 (
now
 - 
Ãxt
->
run¡©e
.
¡©e_’Œy_time
) : 0,

1278 
Ãxt_¦iû
.
time
);

1280 
	`ASSERT
(
´ev
->
run¡©e
.
¡©e
 =ğ
RUNSTATE_ruÂšg
);

1282 
	`TRACE_4D
(
TRC_SCHED_SWITCH
,

1283 
´ev
->
domaš
->
domaš_id
,…»v->
vıu_id
,

1284 
Ãxt
->
domaš
->
domaš_id
,‚ext->
vıu_id
);

1286 
	`vıu_run¡©e_chªge
(

1287 
´ev
,

1288 (
	`‹¡_b™
(
_VPF_blocked
, &
´ev
->
·u£_æags
è? 
RUNSTATE_blocked
 :

1289 (
	`vıu_ruÂabË
(
´ev
è? 
RUNSTATE_ruÂabË
 : 
RUNSTATE_ofæše
)),

1290 
now
);

1291 
´ev
->
Ï¡_run_time
 = 
now
;

1293 
	`ASSERT
(
Ãxt
->
run¡©e
.
¡©e
 !ğ
RUNSTATE_ruÂšg
);

1294 
	`vıu_run¡©e_chªge
(
Ãxt
, 
RUNSTATE_ruÂšg
, 
now
);

1301 
	`ASSERT
(!
Ãxt
->
is_ruÂšg
);

1302 
Ãxt
->
is_ruÂšg
 = 1;

1304 
	`¥š_uÆock_œq
(
sd
->
scheduË_lock
);

1306 
	`³rfc_šü
(
sched_ùx
);

1308 
	`¡İ_tim”
(&
´ev
->
³riodic_tim”
);

1310 iàĞ
Ãxt_¦iû
.
mig¿‹d
 )

1311 
	`evtchn_move_pœqs
(
Ãxt
);

1314 
	`upd©e_vıu_sy¡em_time
(
Ãxt
);

1315 
	`vıu_³riodic_tim”_wÜk
(
Ãxt
);

1317 
	`cÚ‹xt_sw™ch
(
´ev
, 
Ãxt
);

1318 
	}
}

1320 
	$cÚ‹xt_§ved
(
vıu
 *
´ev
)

1323 
	`smp_wmb
();

1325 #ifdeà
VERBOSE_USCHED_DETAIL


1329 
´ev
->
is_ruÂšg
 = 0;

1332 
	`smp_mb
();

1334 
	`SCHED_OP
(
	`VCPU2OP
(
´ev
), 
cÚ‹xt_§ved
,…rev);

1336 iàĞ
	`uÆik–y
(
	`‹¡_b™
(
_VPF_mig¿tšg
, &
´ev
->
·u£_æags
)) )

1337 
	`vıu_mig¿‹
(
´ev
);

1338 
	}
}

1341 
	$s_tim”_â
(*
unu£d
)

1343 
	`¿i£_soáœq
(
SCHEDULE_SOFTIRQ
);

1344 
	`³rfc_šü
(
sched_œq
);

1345 
	}
}

1348 
	$vıu_³riodic_tim”_â
(*
d©a
)

1350 
vıu
 *
v
 = 
d©a
;

1351 
	`vıu_³riodic_tim”_wÜk
(
v
);

1352 
	}
}

1355 
	$vıu_sšgËshÙ_tim”_â
(*
d©a
)

1357 
vıu
 *
v
 = 
d©a
;

1358 
	`£nd_tim”_ev’t
(
v
);

1359 
	}
}

1362 
	$pŞl_tim”_â
(*
d©a
)

1364 
vıu
 *
v
 = 
d©a
;

1366 iàĞ
	`‹¡_ªd_ş—r_b™
(
v
->
vıu_id
, v->
domaš
->
pŞl_mask
) )

1367 
	`vıu_unblock
(
v
);

1368 
	}
}

1370 
	$ıu_scheduË_up
(
ıu
)

1372 
scheduË_d©a
 *
sd
 = &
	`³r_ıu
(scheduË_d©a, 
ıu
);

1374 
	`³r_ıu
(
scheduËr
, 
ıu
èğ&
İs
;

1375 
	`¥š_lock_š™
(&
sd
->
_lock
);

1376 
sd
->
scheduË_lock
 = &sd->
_lock
;

1377 
sd
->
cu¼
 = 
idË_vıu
[
ıu
];

1378 
	`š™_tim”
(&
sd
->
s_tim”
, 
s_tim”_â
, 
NULL
, 
ıu
);

1379 
	`©omic_£t
(&
sd
->
urg’t_couÁ
, 0);

1382 iàĞ
ıu
 == 0 )

1385 iàĞ
idË_vıu
[
ıu
] =ğ
NULL
 )

1386 
	`®loc_vıu
(
idË_vıu
[0]->
domaš
, 
ıu
, cpu);

1387 iàĞ
idË_vıu
[
ıu
] =ğ
NULL
 )

1388  -
ENOMEM
;

1390 iàĞ(
İs
.
®loc_pd©a
 !ğ
NULL
) &&

1391 ((
sd
->
sched_´iv
 = 
İs
.
	`®loc_pd©a
(&İs, 
ıu
)è=ğ
NULL
) )

1392  -
ENOMEM
;

1395 
	}
}

1397 
	$ıu_scheduË_down
(
ıu
)

1399 
scheduË_d©a
 *
sd
 = &
	`³r_ıu
(scheduË_d©a, 
ıu
);

1401 iàĞ
sd
->
sched_´iv
 !ğ
NULL
 )

1402 
	`SCHED_OP
(&
İs
, 
ä“_pd©a
, 
sd
->
sched_´iv
, 
ıu
);

1404 
	`kl_tim”
(&
sd
->
s_tim”
);

1405 
	}
}

1407 
	$ıu_scheduË_ÿÎback
(

1408 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

1410 
ıu
 = ()
hıu
;

1411 
rc
 = 0;

1413  
aùiÚ
 )

1415 
CPU_UP_PREPARE
:

1416 
rc
 = 
	`ıu_scheduË_up
(
ıu
);

1418 
CPU_UP_CANCELED
:

1419 
CPU_DEAD
:

1420 
	`ıu_scheduË_down
(
ıu
);

1426  !
rc
 ? 
NOTIFY_DONE
 : 
	`nÙif›r_äom_”ºo
(rc);

1427 
	}
}

1429 
nÙif›r_block
 
	gıu_scheduË_nfb
 = {

1430 .
nÙif›r_ÿÎ
 = 
ıu_scheduË_ÿÎback


1434 
__š™
 
	$scheduËr_š™
()

1436 
domaš
 *
idË_domaš
;

1437 
i
;

1439 
	`İ’_soáœq
(
SCHEDULE_SOFTIRQ
, 
scheduË
);

1441  
i
 = 0; 
scheduËrs
[i] !ğ
NULL
; i++ )

1443 
İs
 = *
scheduËrs
[
i
];

1444 iàĞ
	`¡rcmp
(
İs
.
İt_Çme
, 
İt_sched
) == 0 )

1448 iàĞ
scheduËrs
[
i
] =ğ
NULL
 )

1450 
	`´štk
("Could‚Ù fšd scheduËr: %s\n", 
İt_sched
);

1451 
İs
 = *
scheduËrs
[0];

1454 iàĞ
	`ıu_scheduË_up
(0) )

1455 
	`BUG
();

1456 
	`»gi¡”_ıu_nÙif›r
(&
ıu_scheduË_nfb
);

1458 
	`´štk
("Usšg scheduËr: % (%s)\n", 
İs
.
Çme
, ops.
İt_Çme
);

1459 iàĞ
	`SCHED_OP
(&
İs
, 
š™
) )

1460 
	`·nic
("scheduler„eturnedƒrror on init\n");

1462 
idË_domaš
 = 
	`domaš_ü—‹
(
DOMID_IDLE
, 0, 0);

1463 
	`BUG_ON
(
idË_domaš
 =ğ
NULL
);

1464 
idË_domaš
->
vıu
 = 
idË_vıu
;

1465 
idË_domaš
->
max_vıus
 = 
NR_CPUS
;

1466 iàĞ
	`®loc_vıu
(
idË_domaš
, 0, 0è=ğ
NULL
 )

1467 
	`BUG
();

1468 iàĞ
İs
.
®loc_pd©a
 &&

1469 !(
	`this_ıu
(
scheduË_d©a
).
sched_´iv
 = 
İs
.
	`®loc_pd©a
(&ops, 0)) )

1470 
	`BUG
();

1471 
	}
}

1473 
	$scheduË_ıu_sw™ch
(
ıu
, 
ıupoŞ
 *
c
)

1475 
æags
;

1476 
vıu
 *
idË
;

1477 *
µriv
, *
µriv_Şd
, *
v´iv
, *
v´iv_Şd
;

1478 
scheduËr
 *
Şd_İs
 = 
	`³r_ıu
(scheduËr, 
ıu
);

1479 
scheduËr
 *
Ãw_İs
 = (
c
 =ğ
NULL
è? &
İs
 : c->
sched
;

1481 iàĞ
Şd_İs
 =ğ
Ãw_İs
 )

1484 
idË
 = 
idË_vıu
[
ıu
];

1485 
µriv
 = 
	`SCHED_OP
(
Ãw_İs
, 
®loc_pd©a
, 
ıu
);

1486 iàĞ
µriv
 =ğ
NULL
 )

1487  -
ENOMEM
;

1488 
v´iv
 = 
	`SCHED_OP
(
Ãw_İs
, 
®loc_vd©a
, 
idË
, idË->
domaš
->
sched_´iv
);

1489 iàĞ
v´iv
 =ğ
NULL
 )

1491 
	`SCHED_OP
(
Ãw_İs
, 
ä“_pd©a
, 
µriv
, 
ıu
);

1492  -
ENOMEM
;

1495 
	`pıu_scheduË_lock_œq§ve
(
ıu
, 
æags
);

1497 
	`SCHED_OP
(
Şd_İs
, 
tick_su¥’d
, 
ıu
);

1498 
v´iv_Şd
 = 
idË
->
sched_´iv
;

1499 
idË
->
sched_´iv
 = 
v´iv
;

1500 
	`³r_ıu
(
scheduËr
, 
ıu
èğ
Ãw_İs
;

1501 
µriv_Şd
 = 
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
sched_´iv
;

1502 
	`³r_ıu
(
scheduË_d©a
, 
ıu
).
sched_´iv
 = 
µriv
;

1503 
	`SCHED_OP
(
Ãw_İs
, 
tick_»sume
, 
ıu
);

1504 
	`SCHED_OP
(
Ãw_İs
, 
š£¹_vıu
, 
idË
);

1506 
	`pıu_scheduË_uÆock_œq»¡Üe
(
ıu
, 
æags
);

1508 
	`SCHED_OP
(
Şd_İs
, 
ä“_vd©a
, 
v´iv_Şd
);

1509 
	`SCHED_OP
(
Şd_İs
, 
ä“_pd©a
, 
µriv_Şd
, 
ıu
);

1512 
	}
}

1514 
scheduËr
 *
	$scheduËr_g‘_deçuÉ
()

1516  &
İs
;

1517 
	}
}

1519 
scheduËr
 *
	$scheduËr_®loc
(
sched_id
, *
³¼
)

1521 
i
;

1522 
scheduËr
 *
sched
;

1524  
i
 = 0; 
scheduËrs
[i] !ğ
NULL
; i++ )

1525 iàĞ
scheduËrs
[
i
]->
sched_id
 == sched_id )

1526 
found
;

1527 *
³¼
 = -
ENOENT
;

1528  
NULL
;

1530 
found
:

1531 *
³¼
 = -
ENOMEM
;

1532 iàĞ(
sched
 = 
	`xm®loc
(
scheduËr
)è=ğ
NULL
 )

1533  
NULL
;

1534 
	`memıy
(
sched
, 
scheduËrs
[
i
], (*sched));

1535 iàĞ(*
³¼
 = 
	`SCHED_OP
(
sched
, 
š™
)) != 0 )

1537 
	`xä“
(
sched
);

1538 
sched
 = 
NULL
;

1541  
sched
;

1542 
	}
}

1544 
	$scheduËr_ä“
(
scheduËr
 *
sched
)

1546 
	`BUG_ON
(
sched
 =ğ&
İs
);

1547 
	`SCHED_OP
(
sched
, 
deš™
);

1548 
	`xä“
(
sched
);

1549 
	}
}

1551 
	$scheduË_dump
(
ıupoŞ
 *
c
)

1553 
i
;

1554 
scheduËr
 *
sched
;

1555 
ıumask_t
 *
ıus
;

1557 
sched
 = (
c
 =ğ
NULL
è? &
İs
 : c->sched;

1558 
ıus
 = (
c
 =ğ
NULL
è? &
ıupoŞ_ä“_ıus
 : &c->
ıu_v®id
;

1559 
	`´štk
("ScheduËr: % (%s)\n", 
sched
->
Çme
, sched->
İt_Çme
);

1560 
	`SCHED_OP
(
sched
, 
dump_£‰šgs
);

1562 
	`fÜ_—ch_ıu_mask
 (
i
, *
ıus
)

1564 
	`pıu_scheduË_lock
(
i
);

1565 
	`´štk
("CPU[%02d] ", 
i
);

1566 
	`SCHED_OP
(
sched
, 
dump_ıu_¡©e
, 
i
);

1567 
	`pıu_scheduË_uÆock
(
i
);

1569 
	}
}

1571 
	$sched_tick_su¥’d
()

1573 
scheduËr
 *
sched
;

1574 
ıu
 = 
	`smp_´oûssÜ_id
();

1576 
sched
 = 
	`³r_ıu
(
scheduËr
, 
ıu
);

1577 
	`SCHED_OP
(
sched
, 
tick_su¥’d
, 
ıu
);

1578 
	}
}

1580 
	$sched_tick_»sume
()

1582 
scheduËr
 *
sched
;

1583 
ıu
 = 
	`smp_´oûssÜ_id
();

1585 
sched
 = 
	`³r_ıu
(
scheduËr
, 
ıu
);

1586 
	`SCHED_OP
(
sched
, 
tick_»sume
, 
ıu
);

1587 
	}
}

1589 
	$wa™
()

1591 
	`scheduË
();

1592 
	}
}

1594 #ifdeà
CONFIG_COMPAT


1595 
	~"com·t/scheduË.c
"

	@shutdown.c

1 
	~<x’/cÚfig.h
>

2 
	~<x’/š™.h
>

3 
	~<x’/lib.h
>

4 
	~<x’/sched.h
>

5 
	~<x’/domaš.h
>

6 
	~<x’/d–ay.h
>

7 
	~<x’/shutdown.h
>

8 
	~<x’/cÚsŞe.h
>

9 
	~<x’/kexec.h
>

10 
	~<asm/debugg”.h
>

11 
	~<public/sched.h
>

14 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_nÜeboÙ
;

15 
boŞ—n_·¿m
("nÜeboÙ", 
İt_nÜeboÙ
);

17 
	$maybe_»boÙ
()

19 iàĞ
İt_nÜeboÙ
 )

21 
	`´štk
("'noreboot' set -‚ot„ebooting.\n");

22 
	`machše_h®t
();

26 
	`´štk
("rebooting machine in 5 seconds.\n");

27 
	`w©chdog_di§bË
();

28 
	`machše_»¡¬t
(5000);

30 
	}
}

32 
	$dom0_shutdown
(
u8
 
»asÚ
)

35 ià(
mši_aùiv©ed
) {

36 
	`di§bË_soá_ÿche
();

38 
	`sy¡em_wide_de¡roy
();

40  
»asÚ
 )

42 
SHUTDOWN_pow”off
:

44 
	`´štk
("Domain 0 halted: halting machine.\n");

45 
	`machše_h®t
();

49 
SHUTDOWN_üash
:

51 
	`debugg”_Œ­_immedŸ‹
();

52 
	`´štk
("Domain 0 crashed: ");

53 
	`maybe_»boÙ
();

57 
SHUTDOWN_»boÙ
:

59 
	`´štk
("Domain 0 shutdown:„ebooting machine.\n");

60 
	`machše_»¡¬t
(0);

64 
SHUTDOWN_w©chdog
:

66 
	`´štk
("Domain 0 shutdown: watchdog„ebooting machine.\n");

67 
	`kexec_üash
();

68 
	`machše_»¡¬t
(0);

74 
	`´štk
("Domaš 0 shutdowÀ(unknowÀ»asÚ %u): ", 
»asÚ
);

75 
	`maybe_»boÙ
();

79 
	}
}

	@softirq.c

12 
	~<x’/cÚfig.h
>

13 
	~<x’/š™.h
>

14 
	~<x’/mm.h
>

15 
	~<x’/´“m±.h
>

16 
	~<x’/sched.h
>

17 
	~<x’/rcupd©e.h
>

18 
	~<x’/soáœq.h
>

20 #iâdeà
__ARCH_IRQ_STAT


21 
œq_ıu¡©_t
 
	gœq_¡©
[
NR_CPUS
];

24 
soáœq_hªdËr
 
	gsoáœq_hªdËrs
[
NR_SOFTIRQS
];

26 
	$__do_soáœq
(
ignÜe_mask
)

28 
i
, 
ıu
;

29 
³ndšg
;

37 
ıu
 = 
	`smp_´oûssÜ_id
();

39 iàĞ
	`rcu_³ndšg
(
ıu
) )

40 
	`rcu_check_ÿÎbacks
(
ıu
);

42 iàĞ((
³ndšg
 = (
	`soáœq_³ndšg
(
ıu
è& ~
ignÜe_mask
)) == 0)

43 || 
	`ıu_is_ofæše
(
ıu
) )

46 
i
 = 
	`fšd_fœ¡_£t_b™
(
³ndšg
);

47 
	`ş—r_b™
(
i
, &
	`soáœq_³ndšg
(
ıu
));

48 (*
soáœq_hªdËrs
[
i
])();

50 
	}
}

52 
	$´oûss_³ndšg_soáœqs
()

54 
	`ASSERT
(!
	`š_œq
(è&& 
	`loÿl_œq_is_’abËd
());

56 
	`__do_soáœq
(1ul<<
SCHEDULE_SOFTIRQ
);

57 
	}
}

59 
asmlškage
 
	$do_soáœq
()

61 
	`ASSERT
(!
	`š_©omic
());

62 
	`__do_soáœq
(0);

63 
	}
}

65 
	$İ’_soáœq
(
Ä
, 
soáœq_hªdËr
 
hªdËr
)

67 
	`ASSERT
(
Ä
 < 
NR_SOFTIRQS
);

68 
soáœq_hªdËrs
[
Ä
] = 
hªdËr
;

69 
	}
}

71 
	$ıumask_¿i£_soáœq
(
ıumask_t
 
mask
, 
Ä
)

73 
ıu
;

75 
	`fÜ_—ch_ıu_mask
(
ıu
, 
mask
)

76 iàĞ
	`‹¡_ªd_£t_b™
(
Ä
, &
	`soáœq_³ndšg
(
ıu
)) )

77 
	`ıu_ş—r
(
ıu
, 
mask
);

79 
	`smp_£nd_ev’t_check_mask
(&
mask
);

80 
	}
}

82 
	$ıu_¿i£_soáœq
(
ıu
, 
Ä
)

84 iàĞ!
	`‹¡_ªd_£t_b™
(
Ä
, &
	`soáœq_³ndšg
(
ıu
))

85 && (
ıu
 !ğ
	`smp_´oûssÜ_id
()) )

86 
	`smp_£nd_ev’t_check_ıu
(
ıu
);

87 
	}
}

89 
	$¿i£_soáœq
(
Ä
)

91 
	`£t_b™
(
Ä
, &
	`soáœq_³ndšg
(
	`smp_´oûssÜ_id
()));

92 
	}
}

94 
__š™
 
	$soáœq_š™
()

96 
	}
}

	@sort.c

7 
	~<x’/ty³s.h
>

9 
	$u32_sw­
(*
a
, *
b
, 
size
)

11 
u32
 
t
 = *(u32 *)
a
;

12 *(
u32
 *)
a
 = *(u32 *)
b
;

13 *(
u32
 *)
b
 = 
t
;

14 
	}
}

16 
	$g’”ic_sw­
(*
a
, *
b
, 
size
)

18 
t
;

21 
t
 = *(*)
a
;

22 *(*)
a
++ = *(*)
b
;

23 *(*)
b
++ = 
t
;

24 }  --
size
 > 0 );

25 
	}
}

44 
sÜt
(*
ba£
, 
size_t
 
num
, size_ˆ
size
,

45 (*
cmp
)(const *, const *),

46 (*
sw­
)(*, *, 
size
))

49 
i
 = (
num
/2è* 
size
, 
n
 =‚um * size, 
c
, 
r
;

51 ià(!
sw­
)

52 
sw­
 = (
size
 =ğ4 ? 
u32_sw­
 : 
g’”ic_sw­
);

55  ; 
i
 >ğ0; i -ğ
size
 )

57  
r
 = 
i
;„ * 2 < 
n
;„ = 
c
 )

59 
c
 = 
r
 * 2;

60 iàĞ(
c
 < 
n
 - 
size
è&& (
	`cmp
(
ba£
 + c, base + c + size) < 0) )

61 
c
 +ğ
size
;

62 iàĞ
	`cmp
(
ba£
 + 
r
, ba£ + 
c
) >= 0 )

64 
	`sw­
(
ba£
 + 
r
, ba£ + 
c
, 
size
);

69  
i
 = 
n
 - 
size
; i >= 0; i -= size )

71 
	`sw­
(
ba£
, ba£ + 
i
, 
size
);

72  
r
 = 0;„ * 2 < 
i
;„ = 
c
 )

74 
c
 = 
r
 * 2;

75 iàĞ(
c
 < 
i
 - 
size
è&& (
	`cmp
(
ba£
 + c, base + c + size) < 0) )

76 
c
 +ğ
size
;

77 iàĞ
	`cmp
(
ba£
 + 
r
, ba£ + 
c
) >= 0 )

79 
	`sw­
(
ba£
 + 
r
, ba£ + 
c
, 
size
);

82 
	}
}

	@spinlock.c

1 
	~<x’/lib.h
>

2 
	~<x’/cÚfig.h
>

3 
	~<x’/œq.h
>

4 
	~<x’/smp.h
>

5 
	~<x’/time.h
>

6 
	~<x’/¥šlock.h
>

7 
	~<x’/gue¡_acûss.h
>

8 
	~<x’/´“m±.h
>

9 
	~<public/sysùl.h
>

10 
	~<asm/´oûssÜ.h
>

12 #iâdeà
NDEBUG


14 
©omic_t
 
¥š_debug
 
	g__»ad_mo¡ly
 = 
ATOMIC_INIT
(0);

16 
	$check_lock
(
lock_debug
 *
debug
)

18 
œq_§ã
 = !
	`loÿl_œq_is_’abËd
();

20 iàĞ
	`uÆik–y
(
	`©omic_»ad
(&
¥š_debug
) <= 0) )

26 iàĞ
	`uÆik–y
(
debug
->
œq_§ã
 != irq_safe) )

28 
£’
 = 
	`cmpxchg
(&
debug
->
œq_§ã
, -1, irq_safe);

29 
	`BUG_ON
(
£’
 =ğ!
œq_§ã
);

31 
	}
}

33 
	$¥š_debug_’abË
()

35 
	`©omic_šc
(&
¥š_debug
);

36 
	}
}

38 
	$¥š_debug_di§bË
()

40 
	`©omic_dec
(&
¥š_debug
);

41 
	}
}

45 
	#check_lock
(
l
è(()0)

	)

49 #ifdeà
LOCK_PROFILE


51 
	#LOCK_PROFILE_REL
 \

52 
lock
->
´ofe
.
time_hŞd
 +ğ
	`NOW
(è-†ock->´ofe.
time_locked
; \

53 
lock
->
´ofe
.
lock_út
++;

	)

54 
	#LOCK_PROFILE_VAR
 
s_time_t
 
block
 = 0

	)

55 
	#LOCK_PROFILE_BLOCK
 
block
 = block ? : 
	`NOW
();

	)

56 
	#LOCK_PROFILE_GOT
 \

57 
lock
->
´ofe
.
time_locked
 = 
	`NOW
(); \

58 ià(
block
) \

60 
lock
->
´ofe
.
time_block
 +ğlock->´ofe.
time_locked
 - 
block
; \

61 
lock
->
´ofe
.
block_út
++; \

62 }

	)

66 
	#LOCK_PROFILE_REL


	)

67 
	#LOCK_PROFILE_VAR


	)

68 
	#LOCK_PROFILE_BLOCK


	)

69 
	#LOCK_PROFILE_GOT


	)

73 
	$_¥š_lock
(
¥šlock_t
 *
lock
)

75 
LOCK_PROFILE_VAR
;

77 
	`check_lock
(&
lock
->
debug
);

78  
	`uÆik–y
(!
	`_¿w_¥š_Œylock
(&
lock
->
¿w
)) )

80 
LOCK_PROFILE_BLOCK
;

81  
	`lik–y
(
	`_¿w_¥š_is_locked
(&
lock
->
¿w
)) )

82 
	`ıu_»Ïx
();

84 
LOCK_PROFILE_GOT
;

85 
	`´“m±_di§bË
();

86 
	}
}

88 
	$_¥š_lock_œq
(
¥šlock_t
 *
lock
)

90 
LOCK_PROFILE_VAR
;

92 
	`ASSERT
(
	`loÿl_œq_is_’abËd
());

93 
	`loÿl_œq_di§bË
();

94 
	`check_lock
(&
lock
->
debug
);

95  
	`uÆik–y
(!
	`_¿w_¥š_Œylock
(&
lock
->
¿w
)) )

97 
LOCK_PROFILE_BLOCK
;

98 
	`loÿl_œq_’abË
();

99  
	`lik–y
(
	`_¿w_¥š_is_locked
(&
lock
->
¿w
)) )

100 
	`ıu_»Ïx
();

101 
	`loÿl_œq_di§bË
();

103 
LOCK_PROFILE_GOT
;

104 
	`´“m±_di§bË
();

105 
	}
}

107 
	$_¥š_lock_œq§ve
(
¥šlock_t
 *
lock
)

109 
æags
;

110 
LOCK_PROFILE_VAR
;

112 
	`loÿl_œq_§ve
(
æags
);

113 
	`check_lock
(&
lock
->
debug
);

114  
	`uÆik–y
(!
	`_¿w_¥š_Œylock
(&
lock
->
¿w
)) )

116 
LOCK_PROFILE_BLOCK
;

117 
	`loÿl_œq_»¡Üe
(
æags
);

118  
	`lik–y
(
	`_¿w_¥š_is_locked
(&
lock
->
¿w
)) )

119 
	`ıu_»Ïx
();

120 
	`loÿl_œq_§ve
(
æags
);

122 
LOCK_PROFILE_GOT
;

123 
	`´“m±_di§bË
();

124  
æags
;

125 
	}
}

127 
	$_¥š_uÆock
(
¥šlock_t
 *
lock
)

129 
	`´“m±_’abË
();

130 
LOCK_PROFILE_REL
;

131 #ifdeà
MYSPIN_LOCK_DEBUG


132 
lock
->
loÿtiÚ
 = 10000;

133 
lock
->
´oc
 = 20000;

135 
	`_¿w_¥š_uÆock
(&
lock
->
¿w
);

136 
	}
}

138 
	$_¥š_uÆock_œq
(
¥šlock_t
 *
lock
)

140 
	`´“m±_’abË
();

141 
LOCK_PROFILE_REL
;

142 
	`_¿w_¥š_uÆock
(&
lock
->
¿w
);

143 
	`loÿl_œq_’abË
();

144 
	}
}

146 
	$_¥š_uÆock_œq»¡Üe
(
¥šlock_t
 *
lock
, 
æags
)

148 
	`´“m±_’abË
();

149 
LOCK_PROFILE_REL
;

150 
	`_¿w_¥š_uÆock
(&
lock
->
¿w
);

151 
	`loÿl_œq_»¡Üe
(
æags
);

152 
	}
}

154 
	$_¥š_is_locked
(
¥šlock_t
 *
lock
)

156 
	`check_lock
(&
lock
->
debug
);

157  
	`_¿w_¥š_is_locked
(&
lock
->
¿w
);

158 
	}
}

160 
	$_¥š_Œylock
(
¥šlock_t
 *
lock
)

162 
	`check_lock
(&
lock
->
debug
);

163 iàĞ!
	`_¿w_¥š_Œylock
(&
lock
->
¿w
) )

165 #ifdeà
LOCK_PROFILE


166 
lock
->
´ofe
.
time_locked
 = 
	`NOW
();

168 
	`´“m±_di§bË
();

170 
	}
}

172 
	$_¥š_b¬r›r
(
¥šlock_t
 *
lock
)

174 #ifdeà
LOCK_PROFILE


175 
s_time_t
 
block
 = 
	`NOW
();

176 
u64
 
loİ
 = 0;

178 
	`check_lock
(&
lock
->
debug
);

179 dØ{ 
	`mb
(); 
loİ
++;}  
	`_¿w_¥š_is_locked
(&
lock
->
¿w
) );

180 ià(
loİ
 > 1)

182 
lock
->
´ofe
.
time_block
 +ğ
	`NOW
(è- 
block
;

183 
lock
->
´ofe
.
block_út
++;

186 
	`check_lock
(&
lock
->
debug
);

187 dØ{ 
	`mb
(); }  
	`_¿w_¥š_is_locked
(&
lock
->
¿w
) );

189 
	`mb
();

190 
	}
}

192 
	$_¥š_b¬r›r_œq
(
¥šlock_t
 *
lock
)

194 
æags
;

195 
	`loÿl_œq_§ve
(
æags
);

196 
	`_¥š_b¬r›r
(
lock
);

197 
	`loÿl_œq_»¡Üe
(
æags
);

198 
	}
}

200 
	$_¥š_Œylock_»cursive
(
¥šlock_t
 *
lock
)

202 
ıu
 = 
	`smp_´oûssÜ_id
();

205 
	`BUILD_BUG_ON
(
NR_CPUS
 > 0xfffu);

207 
	`check_lock
(&
lock
->
debug
);

209 iàĞ
	`lik–y
(
lock
->
»cur£_ıu
 !ğ
ıu
) )

211 iàĞ!
	`¥š_Œylock
(
lock
) )

213 
lock
->
»cur£_ıu
 = 
ıu
;

217 
	`ASSERT
(
lock
->
»cur£_út
 < 0xfu);

218 
lock
->
»cur£_út
++;

221 
	}
}

223 
	$_¥š_lock_»cursive
(
¥šlock_t
 *
lock
)

225  !
	`¥š_Œylock_»cursive
(
lock
) )

226 
	`ıu_»Ïx
();

227 
	}
}

229 
	$_¥š_uÆock_»cursive
(
¥šlock_t
 *
lock
)

231 iàĞ
	`lik–y
(--
lock
->
»cur£_út
 == 0) )

233 
lock
->
»cur£_ıu
 = 0xfffu;

234 
	`¥š_uÆock
(
lock
);

236 
	}
}

238 
	$_»ad_lock
(
rwlock_t
 *
lock
)

240 
	`check_lock
(&
lock
->
debug
);

241 
	`_¿w_»ad_lock
(&
lock
->
¿w
);

242 
	`´“m±_di§bË
();

243 
	}
}

245 
	$_»ad_lock_œq
(
rwlock_t
 *
lock
)

247 
	`ASSERT
(
	`loÿl_œq_is_’abËd
());

248 
	`loÿl_œq_di§bË
();

249 
	`check_lock
(&
lock
->
debug
);

250 
	`_¿w_»ad_lock
(&
lock
->
¿w
);

251 
	`´“m±_di§bË
();

252 
	}
}

254 
	$_»ad_lock_œq§ve
(
rwlock_t
 *
lock
)

256 
æags
;

257 
	`loÿl_œq_§ve
(
æags
);

258 
	`check_lock
(&
lock
->
debug
);

259 
	`_¿w_»ad_lock
(&
lock
->
¿w
);

260 
	`´“m±_di§bË
();

261  
æags
;

262 
	}
}

264 
	$_»ad_uÆock
(
rwlock_t
 *
lock
)

266 
	`´“m±_’abË
();

267 
	`_¿w_»ad_uÆock
(&
lock
->
¿w
);

268 
	}
}

270 
	$_»ad_uÆock_œq
(
rwlock_t
 *
lock
)

272 
	`´“m±_’abË
();

273 
	`_¿w_»ad_uÆock
(&
lock
->
¿w
);

274 
	`loÿl_œq_’abË
();

275 
	}
}

277 
	$_»ad_uÆock_œq»¡Üe
(
rwlock_t
 *
lock
, 
æags
)

279 
	`´“m±_’abË
();

280 
	`_¿w_»ad_uÆock
(&
lock
->
¿w
);

281 
	`loÿl_œq_»¡Üe
(
æags
);

282 
	}
}

284 
	$_wr™e_lock
(
rwlock_t
 *
lock
)

286 
	`check_lock
(&
lock
->
debug
);

287 
	`_¿w_wr™e_lock
(&
lock
->
¿w
);

288 
	`´“m±_di§bË
();

289 
	}
}

291 
	$_wr™e_lock_œq
(
rwlock_t
 *
lock
)

293 
	`ASSERT
(
	`loÿl_œq_is_’abËd
());

294 
	`loÿl_œq_di§bË
();

295 
	`check_lock
(&
lock
->
debug
);

296 
	`_¿w_wr™e_lock
(&
lock
->
¿w
);

297 
	`´“m±_di§bË
();

298 
	}
}

300 
	$_wr™e_lock_œq§ve
(
rwlock_t
 *
lock
)

302 
æags
;

303 
	`loÿl_œq_§ve
(
æags
);

304 
	`check_lock
(&
lock
->
debug
);

305 
	`_¿w_wr™e_lock
(&
lock
->
¿w
);

306 
	`´“m±_di§bË
();

307  
æags
;

308 
	}
}

310 
	$_wr™e_Œylock
(
rwlock_t
 *
lock
)

312 
	`check_lock
(&
lock
->
debug
);

313 iàĞ!
	`_¿w_wr™e_Œylock
(&
lock
->
¿w
) )

315 
	`´“m±_di§bË
();

317 
	}
}

319 
	$_wr™e_uÆock
(
rwlock_t
 *
lock
)

321 
	`´“m±_’abË
();

322 
	`_¿w_wr™e_uÆock
(&
lock
->
¿w
);

323 
	}
}

325 
	$_wr™e_uÆock_œq
(
rwlock_t
 *
lock
)

327 
	`´“m±_’abË
();

328 
	`_¿w_wr™e_uÆock
(&
lock
->
¿w
);

329 
	`loÿl_œq_’abË
();

330 
	}
}

332 
	$_wr™e_uÆock_œq»¡Üe
(
rwlock_t
 *
lock
, 
æags
)

334 
	`´“m±_’abË
();

335 
	`_¿w_wr™e_uÆock
(&
lock
->
¿w
);

336 
	`loÿl_œq_»¡Üe
(
æags
);

337 
	}
}

339 
	$_rw_is_locked
(
rwlock_t
 *
lock
)

341 
	`check_lock
(&
lock
->
debug
);

342  
	`_¿w_rw_is_locked
(&
lock
->
¿w
);

343 
	}
}

345 
	$_rw_is_wr™e_locked
(
rwlock_t
 *
lock
)

347 
	`check_lock
(&
lock
->
debug
);

348  
	`_¿w_rw_is_wr™e_locked
(&
lock
->
¿w
);

349 
	}
}

351 #ifdeà
LOCK_PROFILE


353 
	slock_´ofe_ªc
 {

354 
lock_´ofe_qh—d
 *
	mh—d_q
;

355 *
	mÇme
;

358 
	tlock_´ofe_subfunc
(

359 
	tlock_´ofe
 *, 
	tšt32_t
, int32_t, *);

361 
lock_´ofe
 *
__lock_´ofe_¡¬t
;

362 
lock_´ofe
 *
__lock_´ofe_’d
;

364 
s_time_t
 
	glock_´ofe_¡¬t
;

365 
lock_´ofe_ªc
 
	glock_´ofe_ªcs
[
LOCKPROF_TYPE_N
];

366 
lock_´ofe_qh—d
 
	glock_´ofe_glb_q
;

367 
¥šlock_t
 
	glock_´ofe_lock
 = 
SPIN_LOCK_UNLOCKED
;

369 
	$¥šlock_´ofe_™”©e
(
lock_´ofe_subfunc
 *
sub
, *
·r
)

371 
i
;

372 
lock_´ofe_qh—d
 *
hq
;

373 
lock_´ofe
 *
eq
;

375 
	`¥š_lock
(&
lock_´ofe_lock
);

376  
i
 = 0; i < 
LOCKPROF_TYPE_N
; i++ )

377  
hq
 = 
lock_´ofe_ªcs
[
i
].
h—d_q
; hq; hq = hq->head_q )

378  
eq
 = 
hq
->
–em_q
;ƒq;ƒq =ƒq->
Ãxt
 )

379 
	`sub
(
eq
, 
i
, 
hq
->
idx
, 
·r
);

380 
	`¥š_uÆock
(&
lock_´ofe_lock
);

381 
	}
}

383 
	$¥šlock_´ofe_´št_–em
(
lock_´ofe
 *
d©a
,

384 
št32_t
 
ty³
, iÁ32_ˆ
idx
, *
·r
)

386 iàĞ
ty³
 =ğ
LOCKPROF_TYPE_GLOBAL
 )

387 
	`´štk
("% %s:\n", 
lock_´ofe_ªcs
[
idx
].
Çme
, 
d©a
->name);

389 
	`´štk
("% %d %s:\n", 
lock_´ofe_ªcs
[
idx
].
Çme
, idx, 
d©a
->name);

390 
	`´štk
("†ock:%12"
PRId64
"(%08X:%08X), block:%12"PRId64"(%08X:%08X)\n",

391 
d©a
->
lock_út
, (
u32
)(d©a->
time_hŞd
 >> 32), (u32)data->time_hold,

392 
d©a
->
block_út
, (
u32
)(d©a->
time_block
 >> 32),

393 (
u32
)
d©a
->
time_block
);

394 
	}
}

396 
	$¥šlock_´ofe_´šÎ
(
key
)

398 
s_time_t
 
now
 = 
	`NOW
();

399 
s_time_t
 
diff
;

401 
diff
 = 
now
 - 
lock_´ofe_¡¬t
;

402 
	`´štk
("Xen†ock…rofile info SHOW (now = %08X:%08X, "

403 "tÙ® = %08X:%08X)\n", (
u32
)(
now
>>32), (u32)now,

404 (
u32
)(
diff
>>32), (u32)diff);

405 
	`¥šlock_´ofe_™”©e
(
¥šlock_´ofe_´št_–em
, 
NULL
);

406 
	}
}

408 
	$¥šlock_´ofe_»£t_–em
(
lock_´ofe
 *
d©a
,

409 
št32_t
 
ty³
, iÁ32_ˆ
idx
, *
·r
)

411 
d©a
->
lock_út
 = 0;

412 
d©a
->
block_út
 = 0;

413 
d©a
->
time_hŞd
 = 0;

414 
d©a
->
time_block
 = 0;

415 
	}
}

417 
	$¥šlock_´ofe_»£t
(
key
)

419 
s_time_t
 
now
 = 
	`NOW
();

421 iàĞ
key
 != '\0' )

422 
	`´štk
("Xen†ock…rofile info RESET (now = %08X:%08X)\n",

423 (
u32
)(
now
>>32), (u32)now);

424 
lock_´ofe_¡¬t
 = 
now
;

425 
	`¥šlock_´ofe_™”©e
(
¥šlock_´ofe_»£t_–em
, 
NULL
);

426 
	}
}

429 
x’_sysùl_lock´of_İ_t
 *
	mpc
;

430 
	mrc
;

431 } 
	t¥šlock_´ofe_ucİy_t
;

433 
	$¥šlock_´ofe_ucİy_–em
(
lock_´ofe
 *
d©a
,

434 
št32_t
 
ty³
, iÁ32_ˆ
idx
, *
·r
)

436 
¥šlock_´ofe_ucİy_t
 *
p
 = 
·r
;

437 
x’_sysùl_lock´of_d©a_t
 
–em
;

439 iàĞ
p
->
rc
 )

442 iàĞ
p
->
pc
->
Ä_–em
 <…->pc->
max_–em
 )

444 
	`§ã_¡rıy
(
–em
.
Çme
, 
d©a
->name);

445 
–em
.
ty³
 =ype;

446 
–em
.
idx
 = idx;

447 
–em
.
lock_út
 = 
d©a
->lock_cnt;

448 
–em
.
block_út
 = 
d©a
->block_cnt;

449 
–em
.
lock_time
 = 
d©a
->
time_hŞd
;

450 
–em
.
block_time
 = 
d©a
->
time_block
;

451 iàĞ
	`cİy_to_gue¡_off£t
(
p
->
pc
->
d©a
,…->pc->
Ä_–em
, &
–em
, 1) )

452 
p
->
rc
 = -
EFAULT
;

455 iàĞ!
p
->
rc
 )

456 
p
->
pc
->
Ä_–em
++;

457 
	}
}

460 
	$¥šlock_´ofe_cÚŒŞ
(
x’_sysùl_lock´of_İ_t
 *
pc
)

462 
rc
 = 0;

463 
¥šlock_´ofe_ucİy_t
 
·r
;

465  
pc
->
cmd
 )

467 
XEN_SYSCTL_LOCKPROF_»£t
:

468 
	`¥šlock_´ofe_»£t
('\0');

470 
XEN_SYSCTL_LOCKPROF_qu”y
:

471 
pc
->
Ä_–em
 = 0;

472 
·r
.
rc
 = 0;

473 
·r
.
pc
 =…c;

474 
	`¥šlock_´ofe_™”©e
(
¥šlock_´ofe_ucİy_–em
, &
·r
);

475 
pc
->
time
 = 
	`NOW
(è- 
lock_´ofe_¡¬t
;

476 
rc
 = 
·r
.rc;

479 
rc
 = -
EINVAL
;

483  
rc
;

484 
	}
}

486 
	$_lock_´ofe_»gi¡”_¡ruù
(

487 
št32_t
 
ty³
, 
lock_´ofe_qh—d
 *
qh—d
, iÁ32_ˆ
idx
, *
Çme
)

489 
qh—d
->
idx
 = idx;

490 
	`¥š_lock
(&
lock_´ofe_lock
);

491 
qh—d
->
h—d_q
 = 
lock_´ofe_ªcs
[
ty³
].head_q;

492 
lock_´ofe_ªcs
[
ty³
].
h—d_q
 = 
qh—d
;

493 
lock_´ofe_ªcs
[
ty³
].
Çme
 =‚ame;

494 
	`¥š_uÆock
(&
lock_´ofe_lock
);

495 
	}
}

497 
	$_lock_´ofe_d”egi¡”_¡ruù
(

498 
št32_t
 
ty³
, 
lock_´ofe_qh—d
 *
qh—d
)

500 
lock_´ofe_qh—d
 **
q
;

502 
	`¥š_lock
(&
lock_´ofe_lock
);

503  
q
 = &
lock_´ofe_ªcs
[
ty³
].
h—d_q
; *q; q = &(*q)->head_q )

505 iàĞ*
q
 =ğ
qh—d
 )

507 *
q
 = 
qh—d
->
h—d_q
;

511 
	`¥š_uÆock
(&
lock_´ofe_lock
);

512 
	}
}

514 
__š™
 
	$lock_´of_š™
()

516 
lock_´ofe
 **
q
;

518  
q
 = &
__lock_´ofe_¡¬t
; q < &
__lock_´ofe_’d
; q++ )

520 (*
q
)->
Ãxt
 = 
lock_´ofe_glb_q
.
–em_q
;

521 
lock_´ofe_glb_q
.
–em_q
 = *
q
;

524 
	`_lock_´ofe_»gi¡”_¡ruù
(

525 
LOCKPROF_TYPE_GLOBAL
, &
lock_´ofe_glb_q
,

529 
	}
}

530 
__š™ÿÎ
(
lock_´of_š™
);

	@stop_machine.c

23 
	~<x’/cÚfig.h
>

24 
	~<x’/š™.h
>

25 
	~<x’/sched.h
>

26 
	~<x’/¥šlock.h
>

27 
	~<x’/skËt.h
>

28 
	~<x’/¡İ_machše.h
>

29 
	~<x’/”ºo.h
>

30 
	~<x’/smp.h
>

31 
	~<x’/ıu.h
>

32 
	~<asm/cu¼’t.h
>

33 
	~<asm/´oûssÜ.h
>

35 
	e¡İmachše_¡©e
 {

36 
	mSTOPMACHINE_START
,

37 
	mSTOPMACHINE_PREPARE
,

38 
	mSTOPMACHINE_DISABLE_IRQ
,

39 
	mSTOPMACHINE_INVOKE
,

40 
	mSTOPMACHINE_EXIT


43 
	s¡İmachše_d©a
 {

44 
	mÄ_ıus
;

46 
¡İmachše_¡©e
 
	m¡©e
;

47 
©omic_t
 
	mdÚe
;

49 
	mâ_ıu
;

50 
	mâ_»suÉ
;

51 (*
	mâ
)(*);

52 *
	mâ_d©a
;

55 
DEFINE_PER_CPU
(
skËt
, 
¡İmachše_skËt
);

56 
¡İmachše_d©a
 
	g¡İmachše_d©a
;

57 
DEFINE_SPINLOCK
(
¡İmachše_lock
);

59 
	$¡İmachše_£t_¡©e
(
¡İmachše_¡©e
 
¡©e
)

61 
	`©omic_£t
(&
¡İmachše_d©a
.
dÚe
, 0);

62 
	`smp_wmb
();

63 
¡İmachše_d©a
.
¡©e
 = state;

64 
	}
}

66 
	$¡İmachše_wa™_¡©e
()

68  
	`©omic_»ad
(&
¡İmachše_d©a
.
dÚe
è!ğ¡İmachše_d©a.
Ä_ıus
 )

69 
	`ıu_»Ïx
();

70 
	}
}

72 
¡İ_machše_run
((*
â
)(*), *
d©a
, 
ıu
)

74 
ıumask_t
 
®lbut£lf
;

75 
i
, 
Ä_ıus
;

76 
»t
;

78 
	`BUG_ON
(!
	`loÿl_œq_is_’abËd
());

81 iàĞ!
	`g‘_ıu_m­s
() )

82  -
EBUSY
;

84 
®lbut£lf
 = 
ıu_Úlše_m­
;

85 
	`ıu_ş—r
(
	`smp_´oûssÜ_id
(), 
®lbut£lf
);

86 
Ä_ıus
 = 
	`ıus_weight
(
®lbut£lf
);

89 iàĞ!
	`¥š_Œylock
(&
¡İmachše_lock
) )

91 
	`put_ıu_m­s
();

92  -
EBUSY
;

95 
¡İmachše_d©a
.
â
 = fn;

96 
¡İmachše_d©a
.
â_d©a
 = 
d©a
;

97 
¡İmachše_d©a
.
Ä_ıus
 =‚r_cpus;

98 
¡İmachše_d©a
.
â_ıu
 = 
ıu
;

99 
	`©omic_£t
(&
¡İmachše_d©a
.
dÚe
, 0);

100 
¡İmachše_d©a
.
¡©e
 = 
STOPMACHINE_START
;

102 
	`smp_wmb
();

104 
	`fÜ_—ch_ıu_mask
 ( 
i
, 
®lbut£lf
 )

105 
	`skËt_scheduË_Ú_ıu
(&
	`³r_ıu
(
¡İmachše_skËt
, 
i
), i);

107 
	`¡İmachše_£t_¡©e
(
STOPMACHINE_PREPARE
);

108 
	`¡İmachše_wa™_¡©e
();

110 
	`loÿl_œq_di§bË
();

111 
	`¡İmachše_£t_¡©e
(
STOPMACHINE_DISABLE_IRQ
);

112 
	`¡İmachše_wa™_¡©e
();

114 
	`¡İmachše_£t_¡©e
(
STOPMACHINE_INVOKE
);

115 iàĞ(
ıu
 =ğ
	`smp_´oûssÜ_id
()è|| (ıu =ğ
NR_CPUS
) )

116 
¡İmachše_d©a
.
â_»suÉ
 = (*
â
)(
d©a
);

117 
	`¡İmachše_wa™_¡©e
();

118 
»t
 = 
¡İmachše_d©a
.
â_»suÉ
;

120 
	`¡İmachše_£t_¡©e
(
STOPMACHINE_EXIT
);

121 
	`¡İmachše_wa™_¡©e
();

122 
	`loÿl_œq_’abË
();

124 
	`¥š_uÆock
(&
¡İmachše_lock
);

126 
	`put_ıu_m­s
();

128  
»t
;

129 
	}
}

131 
	$¡İmachše_aùiÚ
(
ıu
)

133 
¡İmachše_¡©e
 
¡©e
 = 
STOPMACHINE_START
;

135 
	`BUG_ON
(
ıu
 !ğ
	`smp_´oûssÜ_id
());

137 
	`smp_mb
();

139  
¡©e
 !ğ
STOPMACHINE_EXIT
 )

141  
¡İmachše_d©a
.
¡©e
 == state )

142 
	`ıu_»Ïx
();

144 
¡©e
 = 
¡İmachše_d©a
.state;

145  
¡©e
 )

147 
STOPMACHINE_DISABLE_IRQ
:

148 
	`loÿl_œq_di§bË
();

150 
STOPMACHINE_INVOKE
:

151 iàĞ(
¡İmachše_d©a
.
â_ıu
 =ğ
	`smp_´oûssÜ_id
()) ||

152 (
¡İmachše_d©a
.
â_ıu
 =ğ
NR_CPUS
) )

153 
¡İmachše_d©a
.
â_»suÉ
 =

154 
¡İmachše_d©a
.
	`â
(¡İmachše_d©a.
â_d©a
);

160 
	`smp_mb
();

161 
	`©omic_šc
(&
¡İmachše_d©a
.
dÚe
);

164 
	`loÿl_œq_’abË
();

165 
	}
}

167 
	$ıu_ÿÎback
(

168 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

170 
ıu
 = ()
hıu
;

172 iàĞ
aùiÚ
 =ğ
CPU_UP_PREPARE
 )

173 
	`skËt_š™
(&
	`³r_ıu
(
¡İmachše_skËt
, 
ıu
),

174 
¡İmachše_aùiÚ
, 
ıu
);

176  
NOTIFY_DONE
;

177 
	}
}

179 
nÙif›r_block
 
	gıu_nfb
 = {

180 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback


183 
__š™
 
	$ıu_¡İmachše_š™
()

185 
ıu
;

186 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

188 *
hıu
 = (*)()
ıu
;

189 
	`ıu_ÿÎback
(&
ıu_nfb
, 
CPU_UP_PREPARE
, 
hıu
);

191 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

193 
	}
}

194 
__š™ÿÎ
(
ıu_¡İmachše_š™
);

	@string.c

7 
	~<x’/ty³s.h
>

8 
	~<x’/¡ršg.h
>

9 
	~<x’/ùy³.h
>

11 #iâdeà
__HAVE_ARCH_STRNICMP


18 
	$¡ºicmp
(cÚ¡ *
s1
, cÚ¡ *
s2
, 
size_t
 
Ën
)

21 
c1
, 
c2
;

23 
c1
 = 0; 
c2
 = 0;

24 ià(
Ën
) {

26 
c1
 = *
s1
; 
c2
 = *
s2
;

27 
s1
++; 
s2
++;

28 ià(!
c1
)

30 ià(!
c2
)

32 ià(
c1
 =ğ
c2
)

34 
c1
 = 
	`tŞow”
(c1);

35 
c2
 = 
	`tŞow”
(c2);

36 ià(
c1
 !ğ
c2
)

38 } --
Ën
);

40  ()
c1
 - ()
c2
;

41 
	}
}

44 #iâdeà
__HAVE_ARCH_STRLCPY


56 
size_t
 
	$¡¾ıy
(*
de¡
, cÚ¡ *
¤c
, 
size_t
 
size
)

58 
size_t
 
»t
 = 
	`¡¾’
(
¤c
);

60 ià(
size
) {

61 
size_t
 
Ën
 = (
»t
 >ğ
size
) ? size-1 :„et;

62 
	`memıy
(
de¡
, 
¤c
, 
Ën
);

63 
de¡
[
Ën
] = '\0';

65  
»t
;

66 
	}
}

67 
EXPORT_SYMBOL
(
¡¾ıy
);

70 #iâdeà
__HAVE_ARCH_STRLCAT


81 
size_t
 
	$¡¾ÿt
(*
de¡
, cÚ¡ *
¤c
, 
size_t
 
size
)

83 
size_t
 
¦’
 = 
	`¡¾’
(
¤c
);

84 
size_t
 
dËn
 = 
	`¡ºËn
(
de¡
, 
size
);

85 *
p
 = 
de¡
 + 
dËn
;

87 (
p
 - 
de¡
è< 
size
)

88 ià((*
p
++ = *
¤c
++) == '\0')

91 ià(
dËn
 < 
size
)

92 *(
p
-1) = '\0';

94  
¦’
 + 
dËn
;

95 
	}
}

96 
EXPORT_SYMBOL
(
¡¾ÿt
);

99 #iâdeà
__HAVE_ARCH_STRCMP


105 
	$¡rcmp
(cÚ¡ * 
cs
,cÚ¡ * 
ù
)

107 sigÃd 
__»s
;

110 ià((
__»s
 = *
cs
 - *
ù
++) != 0 || !*cs++)

114  
__»s
;

115 
	}
}

118 #iâdeà
__HAVE_ARCH_STRNCMP


125 
	$¡ºcmp
(cÚ¡ * 
cs
,cÚ¡ * 
ù
,
size_t
 
couÁ
)

127 sigÃd 
__»s
 = 0;

129 
couÁ
) {

130 ià((
__»s
 = *
cs
 - *
ù
++) != 0 || !*cs++)

132 
couÁ
--;

135  
__»s
;

136 
	}
}

139 #iâdeà
__HAVE_ARCH_STRCHR


145 * 
	$¡rchr
(cÚ¡ * 
s
, 
c
)

147 ; *
s
 !ğ(è
c
; ++s)

148 ià(*
s
 == '\0')

149  
NULL
;

150  (*è
s
;

151 
	}
}

154 #iâdeà
__HAVE_ARCH_STRRCHR


160 * 
	$¡¼chr
(cÚ¡ * 
s
, 
c
)

162 cÚ¡ *
p
 = 
s
 + 
	`¡¾’
(s);

164 ià(*
p
 =ğ()
c
)

165  (*)
p
;

166 } --
p
 >ğ
s
);

167  
NULL
;

168 
	}
}

171 #iâdeà
__HAVE_ARCH_STRLEN


176 
size_t
 
	$¡¾’
(cÚ¡ * 
s
)

178 cÚ¡ *
sc
;

180 
sc
 = 
s
; *sc != '\0'; ++sc)

182  
sc
 - 
s
;

183 
	}
}

186 #iâdeà
__HAVE_ARCH_STRNLEN


192 
size_t
 
	$¡ºËn
(cÚ¡ * 
s
, 
size_t
 
couÁ
)

194 cÚ¡ *
sc
;

196 
sc
 = 
s
; 
couÁ
-- && *sc != '\0'; ++sc)

198  
sc
 - 
s
;

199 
	}
}

202 #iâdeà
__HAVE_ARCH_STRSPN


209 
size_t
 
	$¡r¥n
(cÚ¡ *
s
, cÚ¡ *
acû±
)

211 cÚ¡ *
p
;

212 cÚ¡ *
a
;

213 
size_t
 
couÁ
 = 0;

215 
p
 = 
s
; *p != '\0'; ++p) {

216 
a
 = 
acû±
; *a != '\0'; ++a) {

217 ià(*
p
 =ğ*
a
)

220 ià(*
a
 == '\0')

221  
couÁ
;

222 ++
couÁ
;

225  
couÁ
;

226 
	}
}

229 #iâdeà
__HAVE_ARCH_STRPBRK


235 * 
	$¡½brk
(cÚ¡ * 
cs
,cÚ¡ * 
ù
)

237 cÚ¡ *
sc1
,*
sc2
;

239  
sc1
 = 
cs
; *sc1 != '\0'; ++sc1) {

240  
sc2
 = 
ù
; *sc2 != '\0'; ++sc2) {

241 ià(*
sc1
 =ğ*
sc2
)

242  (*è
sc1
;

245  
NULL
;

246 
	}
}

249 #iâdeà
__HAVE_ARCH_STRSEP


261 * 
	$¡r£p
(**
s
, cÚ¡ *
ù
)

263 *
sbegš
 = *
s
, *
’d
;

265 ià(
sbegš
 =ğ
NULL
)

266  
NULL
;

268 
’d
 = 
	`¡½brk
(
sbegš
, 
ù
);

269 ià(
’d
)

270 *
’d
++ = '\0';

271 *
s
 = 
’d
;

273  
sbegš
;

274 
	}
}

277 #iâdeà
__HAVE_ARCH_MEMSET


286 * 
	$mem£t
(* 
s
,
c
,
size_t
 
couÁ
)

288 *
xs
 = (*è
s
;

290 
couÁ
--)

291 *
xs
++ = 
c
;

293  
s
;

294 
	}
}

297 #iâdeà
__HAVE_ARCH_MEMCPY


307 * 
	$memıy
(* 
de¡
,cÚ¡ *
¤c
,
size_t
 
couÁ
)

309 *
tmp
 = (*è
de¡
, *
s
 = (*è
¤c
;

311 
couÁ
--)

312 *
tmp
++ = *
s
++;

314  
de¡
;

315 
	}
}

318 #iâdeà
__HAVE_ARCH_MEMMOVE


327 * 
	$memmove
(* 
de¡
,cÚ¡ *
¤c
,
size_t
 
couÁ
)

329 *
tmp
, *
s
;

331 ià(
de¡
 <ğ
¤c
) {

332 
tmp
 = (*è
de¡
;

333 
s
 = (*è
¤c
;

334 
couÁ
--)

335 *
tmp
++ = *
s
++;

338 
tmp
 = (*è
de¡
 + 
couÁ
;

339 
s
 = (*è
¤c
 + 
couÁ
;

340 
couÁ
--)

341 *--
tmp
 = *--
s
;

344  
de¡
;

345 
	}
}

348 #iâdeà
__HAVE_ARCH_MEMCMP


355 
	$memcmp
(cÚ¡ * 
cs
,cÚ¡ * 
ù
,
size_t
 
couÁ
)

357 cÚ¡ *
su1
, *
su2
;

358 
»s
 = 0;

360  
su1
 = 
cs
, 
su2
 = 
ù
; 0 < 
couÁ
; ++su1, ++su2, count--)

361 ià((
»s
 = *
su1
 - *
su2
) != 0)

363  
»s
;

364 
	}
}

367 #iâdeà
__HAVE_ARCH_MEMSCAN


377 * 
	$memsÿn
(* 
addr
, 
c
, 
size_t
 
size
)

379 * 
p
 = (*è
addr
;

381 
size
) {

382 ià(*
p
 =ğ
c
)

383  (*è
p
;

384 
p
++;

385 
size
--;

387  (*è
p
;

388 
	}
}

391 #iâdeà
__HAVE_ARCH_STRSTR


397 * 
	$¡r¡r
(cÚ¡ * 
s1
,cÚ¡ * 
s2
)

399 
l1
, 
l2
;

401 
l2
 = 
	`¡¾’
(
s2
);

402 ià(!
l2
)

403  (*è
s1
;

404 
l1
 = 
	`¡¾’
(
s1
);

405 
l1
 >ğ
l2
) {

406 
l1
--;

407 ià(!
	`memcmp
(
s1
,
s2
,
l2
))

408  (*è
s1
;

409 
s1
++;

411  
NULL
;

412 
	}
}

415 #iâdeà
__HAVE_ARCH_MEMCHR


425 *
	$memchr
(cÚ¡ *
s
, 
c
, 
size_t
 
n
)

427 cÚ¡ *
p
 = 
s
;

428 
n
-- != 0) {

429 ià(()
c
 =ğ*
p
++) {

430  (*)(
p
-1);

433  
NULL
;

434 
	}
}

	@symbols-dummy.c

6 
	~<x’/cÚfig.h
>

7 
	~<x’/ty³s.h
>

9 #ifdeà
SYMBOLS_ORIGIN


10 cÚ¡ 
	gsymbŞs_off£ts
[1];

12 cÚ¡ 
	gsymbŞs_add»s£s
[1];

14 cÚ¡ 
	gsymbŞs_num_syms
;

15 cÚ¡ 
u8
 
	gsymbŞs_Çmes
[1];

17 cÚ¡ 
u8
 
	gsymbŞs_tok’_bË
[1];

18 cÚ¡ 
u16
 
	gsymbŞs_tok’_šdex
[1];

20 cÚ¡ 
	gsymbŞs_m¬k”s
[1];

	@symbols.c

13 
	~<x’/cÚfig.h
>

14 
	~<x’/symbŞs.h
>

15 
	~<x’/k”Ãl.h
>

16 
	~<x’/š™.h
>

17 
	~<x’/lib.h
>

18 
	~<x’/¡ršg.h
>

19 
	~<x’/¥šlock.h
>

21 #ifdeà
SYMBOLS_ORIGIN


22 cÚ¡ 
symbŞs_off£ts
[1];

23 
	#symbŞs_add»ss
(
n
è(
SYMBOLS_ORIGIN
 + 
symbŞs_off£ts
[n])

	)

25 cÚ¡ 
symbŞs_add»s£s
[];

26 
	#symbŞs_add»ss
(
n
è
symbŞs_add»s£s
[n]

	)

28 cÚ¡ 
symbŞs_num_syms
;

29 cÚ¡ 
u8
 
symbŞs_Çmes
[];

31 cÚ¡ 
u8
 
symbŞs_tok’_bË
[];

32 cÚ¡ 
u16
 
symbŞs_tok’_šdex
[];

34 cÚ¡ 
symbŞs_m¬k”s
[];

38 
	$symbŞs_ex·nd_symbŞ
(
off
, *
»suÉ
)

40 
Ën
, 
sk³d_fœ¡
 = 0;

41 cÚ¡ 
u8
 *
Œ
, *
d©a
;

44 
d©a
 = &
symbŞs_Çmes
[
off
];

45 
Ën
 = *
d©a
;

46 
d©a
++;

50 
off
 +ğ
Ën
 + 1;

54 
Ën
) {

55 
Œ
 = &
symbŞs_tok’_bË
[ 
symbŞs_tok’_šdex
[*
d©a
] ];

56 
d©a
++;

57 
Ën
--;

59 *
Œ
) {

60 if(
sk³d_fœ¡
) {

61 *
»suÉ
 = *
Œ
;

62 
»suÉ
++;

64 
sk³d_fœ¡
 = 1;

65 
Œ
++;

69 *
»suÉ
 = '\0';

72  
off
;

73 
	}
}

77 
	$g‘_symbŞ_off£t
(
pos
)

79 cÚ¡ 
u8
 *
Çme
;

80 
i
;

84 
Çme
 = &
symbŞs_Çmes
[ 
symbŞs_m¬k”s
[
pos
>>8] ];

90 
i
 = 0; i < (
pos
&0xFF); i++)

91 
Çme
 =‚ame + (*name) + 1;

93  
Çme
 - 
symbŞs_Çmes
;

94 
	}
}

96 cÚ¡ *
	$symbŞs_lookup
(
addr
,

97 *
symbŞsize
,

98 *
off£t
,

99 *
Çmebuf
)

101 
i
, 
low
, 
high
, 
mid
;

102 
symbŞ_’d
 = 0;

104 
Çmebuf
[
KSYM_NAME_LEN
] = 0;

105 
Çmebuf
[0] = 0;

107 ià(!
	`is_k”Ãl_‹xt
(
addr
è&& !
	`is_k”Ãl_š™‹xt
(addr))

108  
NULL
;

111 
low
 = 0;

112 
high
 = 
symbŞs_num_syms
;

114 
high
-
low
 > 1) {

115 
mid
 = (
low
 + 
high
) / 2;

116 ià(
	`symbŞs_add»ss
(
mid
è<ğ
addr
è
low
 = mid;

117 
high
 = 
mid
;

122 
low
 && 
	`symbŞs_add»ss
(low - 1) == symbols_address(low))

123 --
low
;

126 
	`symbŞs_ex·nd_symbŞ
(
	`g‘_symbŞ_off£t
(
low
), 
Çmebuf
);

129 
i
 = 
low
 + 1; i < 
symbŞs_num_syms
; i++) {

130 ià(
	`symbŞs_add»ss
(
i
è> symbŞs_add»ss(
low
)) {

131 
symbŞ_’d
 = 
	`symbŞs_add»ss
(
i
);

137 ià(!
symbŞ_’d
)

138 
symbŞ_’d
 = 
	`is_k”Ãl_š™‹xt
(
addr
) ?

139 ()
_eš™‹xt
 : ()
_‘ext
;

141 *
symbŞsize
 = 
symbŞ_’d
 - 
	`symbŞs_add»ss
(
low
);

142 *
off£t
 = 
addr
 - 
	`symbŞs_add»ss
(
low
);

143  
Çmebuf
;

144 
	}
}

147 
	$__´št_symbŞ
(cÚ¡ *
fmt
, 
add»ss
)

149 cÚ¡ *
Çme
;

150 
off£t
, 
size
, 
æags
;

152 
	`DEFINE_SPINLOCK
(
lock
);

153 
Çmebuf
[
KSYM_NAME_LEN
+1];

154 
	#BUFFER_SIZE
 ("%s+%#lx/%#lx [%s]"è+ 
KSYM_NAME_LEN
 + \

155 2*(
BITS_PER_LONG
*3/10è+ 1

	)

156 
bufãr
[
BUFFER_SIZE
];

158 
	`¥š_lock_œq§ve
(&
lock
, 
æags
);

160 
Çme
 = 
	`symbŞs_lookup
(
add»ss
, &
size
, &
off£t
, 
Çmebuf
);

162 ià(!
Çme
)

163 
	`¢´štf
(
bufãr
, 
BUFFER_SIZE
, "???");

165 
	`¢´štf
(
bufãr
, 
BUFFER_SIZE
, "%s+%#lx/%#lx", 
Çme
, 
off£t
, 
size
);

167 
	`´štk
(
fmt
, 
bufãr
);

169 
	`¥š_uÆock_œq»¡Üe
(&
lock
, 
æags
);

170 
	}
}

	@sysctl.c

9 
	~<x’/cÚfig.h
>

10 
	~<x’/ty³s.h
>

11 
	~<x’/lib.h
>

12 
	~<x’/mm.h
>

13 
	~<x’/sched.h
>

14 
	~<x’/domaš.h
>

15 
	~<x’/ev’t.h
>

16 
	~<x’/domaš_·ge.h
>

17 
	~<x’/Œaû.h
>

18 
	~<x’/cÚsŞe.h
>

19 
	~<x’/ioÿp.h
>

20 
	~<x’/gue¡_acûss.h
>

21 
	~<x’/keyhªdËr.h
>

22 
	~<asm/cu¼’t.h
>

23 
	~<x’/hy³rÿÎ.h
>

24 
	~<public/sysùl.h
>

25 
	~<asm/numa.h
>

26 
	~<x’/nodemask.h
>

27 
	~<xsm/xsm.h
>

28 
	~<x’/pm¡©.h
>

30 
¬ch_do_sysùl
(

31 
x’_sysùl
 *
İ
, 
	$XEN_GUEST_HANDLE
(
x’_sysùl_t
è
u_sysùl
);

32 #ifdeà
LOCK_PROFILE


33 
	`¥šlock_´ofe_cÚŒŞ
(
x’_sysùl_lock´of_İ_t
 *
pc
);

36 
	`do_sysùl
(
	$XEN_GUEST_HANDLE
(
x’_sysùl_t
è
u_sysùl
)

38 
»t
 = 0;

39 
x’_sysùl
 
curİ
, *
İ
 = &curop;

40 
	`DEFINE_SPINLOCK
(
sysùl_lock
);

42 iàĞ!
	`IS_PRIV
(
cu¼’t
->
domaš
) )

43  -
EPERM
;

45 iàĞ
	`cİy_äom_gue¡
(
İ
, 
u_sysùl
, 1) )

46  -
EFAULT
;

48 iàĞ
İ
->
š‹rçû_v”siÚ
 !ğ
XEN_SYSCTL_INTERFACE_VERSION
 )

49  -
EACCES
;

56  !
	`¥š_Œylock
(&
sysùl_lock
) )

57 iàĞ
	`hy³rÿÎ_´“m±_check
() )

58  
	`hy³rÿÎ_ü—‹_cÚtšu©iÚ
(

59 
__HYPERVISOR_sysùl
, "h", 
u_sysùl
);

61  
İ
->
cmd
 )

63 
XEN_SYSCTL_»adcÚsŞe
:

65 
»t
 = 
	`xsm_»adcÚsŞe
(
İ
->
u
.
»adcÚsŞe
.
ş—r
);

66 iàĞ
»t
 )

69 
»t
 = 
	`»ad_cÚsŞe_ršg
(&
İ
->
u
.
»adcÚsŞe
);

70 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

71 
»t
 = -
EFAULT
;

75 
XEN_SYSCTL_tbuf_İ
:

77 
»t
 = 
	`xsm_tbufcÚŒŞ
();

78 iàĞ
»t
 )

81 
»t
 = 
	`tb_cÚŒŞ
(&
İ
->
u
.
tbuf_İ
);

82 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

83 
»t
 = -
EFAULT
;

87 
XEN_SYSCTL_sched_id
:

89 
»t
 = 
	`xsm_sched_id
();

90 iàĞ
»t
 )

93 
İ
->
u
.
sched_id
.sched_id = 
	`sched_id
();

94 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

95 
»t
 = -
EFAULT
;

97 
»t
 = 0;

101 
XEN_SYSCTL_g‘domaššfŞi¡
:

103 
domaš
 *
d
;

104 
x’_domùl_g‘domaššfo
 
šfo
;

105 
u32
 
num_domašs
 = 0;

107 
	`rcu_»ad_lock
(&
domli¡_»ad_lock
);

109 
	`fÜ_—ch_domaš
 ( 
d
 )

111 iàĞ
d
->
domaš_id
 < 
İ
->
u
.
g‘domaššfŞi¡
.
fœ¡_domaš
 )

113 iàĞ
num_domašs
 =ğ
İ
->
u
.
g‘domaššfŞi¡
.
max_domašs
 )

116 
»t
 = 
	`xsm_g‘domaššfo
(
d
);

117 iàĞ
»t
 )

120 
	`g‘domaššfo
(
d
, &
šfo
);

122 iàĞ
	`cİy_to_gue¡_off£t
(
İ
->
u
.
g‘domaššfŞi¡
.
bufãr
,

123 
num_domašs
, &
šfo
, 1) )

125 
»t
 = -
EFAULT
;

129 
num_domašs
++;

132 
	`rcu_»ad_uÆock
(&
domli¡_»ad_lock
);

134 iàĞ
»t
 != 0 )

137 
İ
->
u
.
g‘domaššfŞi¡
.
num_domašs
 =‚um_domains;

139 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

140 
»t
 = -
EFAULT
;

144 #ifdeà
PERF_COUNTERS


145 
XEN_SYSCTL_³rfc_İ
:

147 
»t
 = 
	`xsm_³rfcÚŒŞ
();

148 iàĞ
»t
 )

151 
»t
 = 
	`³rfc_cÚŒŞ
(&
İ
->
u
.
³rfc_İ
);

152 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

153 
»t
 = -
EFAULT
;

158 #ifdeà
LOCK_PROFILE


159 
XEN_SYSCTL_lock´of_İ
:

161 
»t
 = 
	`¥šlock_´ofe_cÚŒŞ
(&
İ
->
u
.
lock´of_İ
);

162 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

163 
»t
 = -
EFAULT
;

167 
XEN_SYSCTL_debug_keys
:

169 
c
;

170 
ušt32_t
 
i
;

172 
»t
 = 
	`xsm_debug_keys
();

173 iàĞ
»t
 )

176 
»t
 = -
EFAULT
;

177  
i
 = 0; i < 
İ
->
u
.
debug_keys
.
Ä_keys
; i++ )

179 iàĞ
	`cİy_äom_gue¡_off£t
(&
c
, 
İ
->
u
.
debug_keys
.
keys
, 
i
, 1) )

180 
out
;

181 
	`hªdË_key´ess
(
c
, 
	`gue¡_ıu_u£r_»gs
());

183 
»t
 = 0;

187 
XEN_SYSCTL_g‘ıušfo
:

189 
ušt32_t
 
i
, 
Ä_ıus
;

190 
x’_sysùl_ıušfo
 
ıušfo
;

192 
Ä_ıus
 = 
	`mš_t
(
ušt32_t
, 
İ
->
u
.
g‘ıušfo
.
max_ıus
, 
NR_CPUS
);

194 
»t
 = 
	`xsm_g‘ıušfo
();

195 iàĞ
»t
 )

198  
i
 = 0; i < 
Ä_ıus
; i++ )

200 
ıušfo
.
idËtime
 = 
	`g‘_ıu_idË_time
(
i
);

202 
»t
 = -
EFAULT
;

203 iàĞ
	`cİy_to_gue¡_off£t
(
İ
->
u
.
g‘ıušfo
.
šfo
, 
i
, &
ıušfo
, 1) )

204 
out
;

207 
İ
->
u
.
g‘ıušfo
.
Ä_ıus
 = 
i
;

208 
»t
 = 
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1è? -
EFAULT
 : 0;

212 
XEN_SYSCTL_avah—p
:

214 
»t
 = 
	`xsm_avah—p
();

215 iàĞ
»t
 )

218 
İ
->
u
.
avah—p
.
ava_by‹s
 = 
	`ava_domh—p_·ges_»giÚ
(

219 
İ
->
u
.
avah—p
.
node
,

220 
İ
->
u
.
avah—p
.
mš_b™width
,

221 
İ
->
u
.
avah—p
.
max_b™width
);

222 
İ
->
u
.
avah—p
.
ava_by‹s
 <<ğ
PAGE_SHIFT
;

224 
»t
 = 
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1è? -
EFAULT
 : 0;

228 
XEN_SYSCTL_g‘_pm¡©
:

230 
»t
 = 
	`xsm_g‘_pm¡©
();

231 iàĞ
»t
 )

234 
»t
 = 
	`do_g‘_pm_šfo
(&
İ
->
u
.
g‘_pm¡©
);

235 iàĞ
»t
 )

238 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

240 
»t
 = -
EFAULT
;

246 
XEN_SYSCTL_pm_İ
:

248 
»t
 = 
	`xsm_pm_İ
();

249 iàĞ
»t
 )

252 
»t
 = 
	`do_pm_İ
(&
İ
->
u
.
pm_İ
);

253 iàĞ
»t
 && (»ˆ!ğ-
EAGAIN
) )

256 iàĞ
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

258 
»t
 = -
EFAULT
;

264 
XEN_SYSCTL_·ge_ofæše_İ
:

266 
ušt32_t
 *
¡©us
, *
±r
;

267 
pâ
;

269 
±r
 = 
¡©us
 = 
	`xm®loc_by‹s
Ğ(
ušt32_t
) *

270 (
İ
->
u
.
·ge_ofæše
.
’d
 -

271 
İ
->
u
.
·ge_ofæše
.
¡¬t
 + 1));

272 iàĞ!
¡©us
 )

274 
	`d´štk
(
XENLOG_WARNING
, "Out of memory for…age offline op\n");

275 
»t
 = -
ENOMEM
;

279 
	`mem£t
(
¡©us
, 
PG_OFFLINE_INVALID
, (
ušt32_t
) *

280 (
İ
->
u
.
·ge_ofæše
.
’d
 - op->u.·ge_ofæše.
¡¬t
 + 1));

282  
pâ
 = 
İ
->
u
.
·ge_ofæše
.
¡¬t
;

283 
pâ
 <ğ
İ
->
u
.
·ge_ofæše
.
’d
;

284 
pâ
 ++ )

286  
İ
->
u
.
·ge_ofæše
.
cmd
 )

289 
sysùl_·ge_ofæše
:

290 
»t
 = 
	`ofæše_·ge
(
pâ
, 0, 
±r
++);

292 
sysùl_·ge_Úlše
:

293 
»t
 = 
	`Úlše_·ge
(
pâ
, 
±r
++);

295 
sysùl_qu”y_·ge_ofæše
:

296 
»t
 = 
	`qu”y_·ge_ofæše
(
pâ
, 
±r
++);

299 
	`gd´štk
(
XENLOG_WARNING
, "invalid…age offline op %x\n",

300 
İ
->
u
.
·ge_ofæše
.
cmd
);

301 
»t
 = -
EINVAL
;

305 ià(
»t
)

309 iàĞ
	`cİy_to_gue¡
(

310 
İ
->
u
.
·ge_ofæše
.
¡©us
, status,

311 
İ
->
u
.
·ge_ofæše
.
’d
 - op->u.·ge_ofæše.
¡¬t
 + 1) )

313 
»t
 = -
EFAULT
;

317 
	`xä“
(
¡©us
);

321 
XEN_SYSCTL_ıupoŞ_İ
:

323 
»t
 = 
	`ıupoŞ_do_sysùl
(&
İ
->
u
.
ıupoŞ_İ
);

324 iàĞ(
»t
 =ğ0è&& 
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

325 
»t
 = -
EFAULT
;

329 
XEN_SYSCTL_scheduËr_İ
:

331 
»t
 = 
	`sched_adju¡_glob®
(&
İ
->
u
.
scheduËr_İ
);

332 iàĞ(
»t
 =ğ0è&& 
	`cİy_to_gue¡
(
u_sysùl
, 
İ
, 1) )

333 
»t
 = -
EFAULT
;

338 
»t
 = 
	`¬ch_do_sysùl
(
İ
, 
u_sysùl
);

342 
out
:

343 
	`¥š_uÆock
(&
sysùl_lock
);

345  
»t
;

346 
	}
}

	@tasklet.c

14 
	~<x’/cÚfig.h
>

15 
	~<x’/š™.h
>

16 
	~<x’/sched.h
>

17 
	~<x’/soáœq.h
>

18 
	~<x’/skËt.h
>

19 
	~<x’/ıu.h
>

22 
boŞ_t
 
	gskËts_š™Ÿli£d
;

24 
DEFINE_PER_CPU
(, 
skËt_wÜk_to_do
);

26 
DEFINE_PER_CPU
(
li¡_h—d
, 
skËt_li¡
);

29 
DEFINE_SPINLOCK
(
skËt_lock
);

31 
	$skËt_’queue
(
skËt
 *
t
)

33 
ıu
 = 
t
->
scheduËd_Ú
;

34 *
wÜk_to_do
 = &
	`³r_ıu
(
skËt_wÜk_to_do
, 
ıu
);

36 
	`li¡_add_
(&
t
->
li¡
, &
	`³r_ıu
(
skËt_li¡
, 
ıu
));

37 iàĞ!
	`‹¡_ªd_£t_b™
(
_TASKLET_’queued
, 
wÜk_to_do
) )

38 
	`ıu_¿i£_soáœq
(
ıu
, 
SCHEDULE_SOFTIRQ
);

39 
	}
}

41 
	$skËt_scheduË_Ú_ıu
(
skËt
 *
t
, 
ıu
)

43 
æags
;

45 
	`¥š_lock_œq§ve
(&
skËt_lock
, 
æags
);

47 iàĞ
skËts_š™Ÿli£d
 && !
t
->
is_d—d
 )

49 
t
->
scheduËd_Ú
 = 
ıu
;

50 iàĞ!
t
->
is_ruÂšg
 )

52 
	`li¡_d–
(&
t
->
li¡
);

53 
	`skËt_’queue
(
t
);

57 
	`¥š_uÆock_œq»¡Üe
(&
skËt_lock
, 
æags
);

58 
	}
}

60 
	$skËt_scheduË
(
skËt
 *
t
)

62 
	`skËt_scheduË_Ú_ıu
(
t
, 
	`smp_´oûssÜ_id
());

63 
	}
}

65 
	$do_skËt
()

67 
ıu
 = 
	`smp_´oûssÜ_id
();

68 *
wÜk_to_do
 = &
	`³r_ıu
(
skËt_wÜk_to_do
, 
ıu
);

69 
li¡_h—d
 *
li¡
 = &
	`³r_ıu
(
skËt_li¡
, 
ıu
);

70 
skËt
 *
t
;

76 iàĞ
	`lik–y
(*
wÜk_to_do
 !ğ(
TASKLET_’queued
|
TASKLET_scheduËd
)) )

79 
	`¥š_lock_œq
(&
skËt_lock
);

81 iàĞ
	`uÆik–y
(
	`li¡_em±y
(
li¡
è|| 
	`ıu_is_ofæše
(
ıu
)) )

82 
out
;

84 
t
 = 
	`li¡_’Œy
(
li¡
->
Ãxt
, 
skËt
,†ist);

85 
	`li¡_d–_š™
(&
t
->
li¡
);

87 
	`BUG_ON
(
t
->
is_d—d
 ||->
is_ruÂšg
 || (t->
scheduËd_Ú
 !ğ
ıu
));

88 
t
->
scheduËd_Ú
 = -1;

89 
t
->
is_ruÂšg
 = 1;

91 
	`¥š_uÆock_œq
(&
skËt_lock
);

92 
	`sync_loÿl_exec¡©e
();

93 
t
->
	`func
Ñ->
d©a
);

94 
	`¥š_lock_œq
(&
skËt_lock
);

96 
t
->
is_ruÂšg
 = 0;

98 iàĞ
t
->
scheduËd_Ú
 >= 0 )

100 
	`BUG_ON
(
t
->
is_d—d
 || !
	`li¡_em±y
(&t->
li¡
));

101 
	`skËt_’queue
(
t
);

104 
out
:

105 iàĞ
	`li¡_em±y
(
li¡
) )

107 
	`ş—r_b™
(
_TASKLET_’queued
, 
wÜk_to_do
);

108 
	`¿i£_soáœq
(
SCHEDULE_SOFTIRQ
);

111 
	`¥š_uÆock_œq
(&
skËt_lock
);

112 
	}
}

114 
	$skËt_kl
(
skËt
 *
t
)

116 
æags
;

118 
	`¥š_lock_œq§ve
(&
skËt_lock
, 
æags
);

120 iàĞ!
	`li¡_em±y
(&
t
->
li¡
) )

122 
	`BUG_ON
(
t
->
is_d—d
 ||->
is_ruÂšg
 || (t->
scheduËd_Ú
 < 0));

123 
	`li¡_d–_š™
(&
t
->
li¡
);

126 
t
->
scheduËd_Ú
 = -1;

127 
t
->
is_d—d
 = 1;

129  
t
->
is_ruÂšg
 )

131 
	`¥š_uÆock_œq»¡Üe
(&
skËt_lock
, 
æags
);

132 
	`ıu_»Ïx
();

133 
	`¥š_lock_œq§ve
(&
skËt_lock
, 
æags
);

136 
	`¥š_uÆock_œq»¡Üe
(&
skËt_lock
, 
æags
);

137 
	}
}

139 
	$mig¿‹_skËts_äom_ıu
(
ıu
)

141 
li¡_h—d
 *
li¡
 = &
	`³r_ıu
(
skËt_li¡
, 
ıu
);

142 
æags
;

143 
skËt
 *
t
;

145 
	`¥š_lock_œq§ve
(&
skËt_lock
, 
æags
);

147  !
	`li¡_em±y
(
li¡
) )

149 
t
 = 
	`li¡_’Œy
(
li¡
->
Ãxt
, 
skËt
,†ist);

150 
	`BUG_ON
(
t
->
scheduËd_Ú
 !ğ
ıu
);

151 
t
->
scheduËd_Ú
 = 
	`smp_´oûssÜ_id
();

152 
	`li¡_d–
(&
t
->
li¡
);

153 
	`skËt_’queue
(
t
);

156 
	`¥š_uÆock_œq»¡Üe
(&
skËt_lock
, 
æags
);

157 
	}
}

159 
skËt_š™
(

160 
skËt
 *
t
, (*
func
)(), 
d©a
)

162 
	`mem£t
(
t
, 0, (*t));

163 
	`INIT_LIST_HEAD
(&
t
->
li¡
);

164 
t
->
scheduËd_Ú
 = -1;

165 
t
->
func
 = func;

166 
t
->
d©a
 = data;

167 
	}
}

169 
	$ıu_ÿÎback
(

170 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

172 
ıu
 = ()
hıu
;

174  
aùiÚ
 )

176 
CPU_UP_PREPARE
:

177 
	`INIT_LIST_HEAD
(&
	`³r_ıu
(
skËt_li¡
, 
ıu
));

179 
CPU_UP_CANCELED
:

180 
CPU_DEAD
:

181 
	`mig¿‹_skËts_äom_ıu
(
ıu
);

187  
NOTIFY_DONE
;

188 
	}
}

190 
nÙif›r_block
 
	gıu_nfb
 = {

191 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback
,

192 .
	g´iÜ™y
 = 99

195 
__š™
 
	$skËt_subsys_š™
()

197 *
hıu
 = (*)()
	`smp_´oûssÜ_id
();

198 
	`ıu_ÿÎback
(&
ıu_nfb
, 
CPU_UP_PREPARE
, 
hıu
);

199 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

200 
skËts_š™Ÿli£d
 = 1;

201 
	}
}

	@time.c

19 
	~<x’/cÚfig.h
>

20 
	~<x’/time.h
>

24 
	#__i¦—p
(
y—r
) \

25 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

28 cÚ¡ 
	g__mÚ_Ëngths
[2][12] = {

35 
	#SECS_PER_HOUR
 (60 * 60)

	)

36 
	#SECS_PER_DAY
 (
SECS_PER_HOUR
 * 24)

	)

38 
tm
 
	$gmtime
(
t
)

40 
tm
 
tbuf
;

41 
days
, 
»m
;

42 
y
;

43 cÚ¡ *

;

45 
y
 = 1970;

46 #ifdeà
__x86_64__


49  
t
 & (1UL<<39) )

51 
y
 -= 400;

52 
t
 +ğ(()(365 * 303 + 366 * 97)è* 
SECS_PER_DAY
;

54 
t
 &= (1UL << 40) - 1;

57 
days
 = 
t
 / 
SECS_PER_DAY
;

58 
»m
 = 
t
 % 
SECS_PER_DAY
;

60 
tbuf
.
tm_hour
 = 
»m
 / 
SECS_PER_HOUR
;

61 
»m
 %ğ
SECS_PER_HOUR
;

62 
tbuf
.
tm_mš
 = 
»m
 / 60;

63 
tbuf
.
tm_£c
 = 
»m
 % 60;

65 
tbuf
.
tm_wday
 = (4 + 
days
) % 7;

66 iàĞ
tbuf
.
tm_wday
 < 0 )

67 
tbuf
.
tm_wday
 += 7;

68  
days
 >ğ(
»m
 = 
	`__i¦—p
(
y
) ? 366 : 365) )

70 ++
y
;

71 
days
 -ğ
»m
;

73  
days
 < 0 )

75 --
y
;

76 
days
 +ğ
	`__i¦—p
(
y
) ? 366 : 365;

78 
tbuf
.
tm_y—r
 = 
y
 - 1900;

79 
tbuf
.
tm_yday
 = 
days
;

80 

 = (cÚ¡ *)
__mÚ_Ëngths
[
	`__i¦—p
(
y
)];

81  
y
 = 0; 
days
 >ğ

[y]; ++y )

82 
days
 -ğ

[
y
];

83 
tbuf
.
tm_mÚ
 = 
y
;

84 
tbuf
.
tm_mday
 = 
days
 + 1;

85 
tbuf
.
tm_isd¡
 = -1;

87  
tbuf
;

88 
	}
}

	@timer.c

8 
	~<x’/cÚfig.h
>

9 
	~<x’/š™.h
>

10 
	~<x’/ty³s.h
>

11 
	~<x’/”ºo.h
>

12 
	~<x’/sched.h
>

13 
	~<x’/lib.h
>

14 
	~<x’/smp.h
>

15 
	~<x’/³rfc.h
>

16 
	~<x’/time.h
>

17 
	~<x’/soáœq.h
>

18 
	~<x’/tim”.h
>

19 
	~<x’/keyhªdËr.h
>

20 
	~<x’/³rıu.h
>

21 
	~<x’/ıu.h
>

22 
	~<x’/rcupd©e.h
>

23 
	~<x’/symbŞs.h
>

24 
	~<asm/sy¡em.h
>

25 
	~<asm/desc.h
>

26 
	~<asm/©omic.h
>

29 
tim”_¦İ
 
	g__»ad_mo¡ly
 = 50000;

30 
š‹g”_·¿m
("tim”_¦İ", 
tim”_¦İ
);

32 
	stim”s
 {

33 
¥šlock_t
 
	mlock
;

34 
tim”
 **
	mh—p
;

35 
tim”
 *
	mli¡
;

36 
tim”
 *
	mruÂšg
;

37 
li¡_h—d
 
	mšaùive
;

38 } 
	g__ÿch–še_®igÃd
;

40 
DEFINE_PER_CPU
(
tim”s
,imers);

43 
DEFINE_RCU_READ_LOCK
(
tim”_ıu_»ad_lock
);

45 
DEFINE_PER_CPU
(
s_time_t
, 
tim”_d—dlše
);

51 
	#GET_HEAP_SIZE
(
_h
è(()(((
u16
 *)(_h))[0]))

	)

52 
	#SET_HEAP_SIZE
(
_h
,
_v
è(((
u16
 *)(_h))[0] = (u16)(_v))

	)

54 
	#GET_HEAP_LIMIT
(
_h
è(()(((
u16
 *)(_h))[1]))

	)

55 
	#SET_HEAP_LIMIT
(
_h
,
_v
è(((
u16
 *)(_h))[1] = (u16)(_v))

	)

58 
	$down_h—p
(
tim”
 **
h—p
, 
pos
)

60 
sz
 = 
	`GET_HEAP_SIZE
(
h—p
), 
nxt
;

61 
tim”
 *
t
 = 
h—p
[
pos
];

63  (
nxt
 = (
pos
 << 1)è<ğ
sz
 )

65 iàĞ((
nxt
+1è<ğ
sz
è&& (
h—p
[nxt+1]->
expœes
 < heap[nxt]->expires) )

66 
nxt
++;

67 iàĞ
h—p
[
nxt
]->
expœes
 > 
t
->expires )

69 
h—p
[
pos
] = h—p[
nxt
];

70 
h—p
[
pos
]->
h—p_off£t
 =…os;

71 
pos
 = 
nxt
;

74 
h—p
[
pos
] = 
t
;

75 
t
->
h—p_off£t
 = 
pos
;

76 
	}
}

79 
	$up_h—p
(
tim”
 **
h—p
, 
pos
)

81 
tim”
 *
t
 = 
h—p
[
pos
];

83  (
pos
 > 1è&& (
t
->
expœes
 < 
h—p
[pos>>1]->expires) )

85 
h—p
[
pos
] = heap[pos>>1];

86 
h—p
[
pos
]->
h—p_off£t
 =…os;

87 
pos
 >>= 1;

90 
h—p
[
pos
] = 
t
;

91 
t
->
h—p_off£t
 = 
pos
;

92 
	}
}

96 
	$»move_äom_h—p
(
tim”
 **
h—p
, tim” *
t
)

98 
sz
 = 
	`GET_HEAP_SIZE
(
h—p
);

99 
pos
 = 
t
->
h—p_off£t
;

101 iàĞ
	`uÆik–y
(
pos
 =ğ
sz
) )

103 
	`SET_HEAP_SIZE
(
h—p
, 
sz
-1);

104 
out
;

107 
h—p
[
pos
] = h—p[
sz
];

108 
h—p
[
pos
]->
h—p_off£t
 =…os;

110 
	`SET_HEAP_SIZE
(
h—p
, --
sz
);

112 iàĞ(
pos
 > 1è&& (
h—p
[pos]->
expœes
 < heap[pos>>1]->expires) )

113 
	`up_h—p
(
h—p
, 
pos
);

115 
	`down_h—p
(
h—p
, 
pos
);

117 
out
:

118  (
pos
 == 1);

119 
	}
}

123 
	$add_to_h—p
(
tim”
 **
h—p
, tim” *
t
)

125 
sz
 = 
	`GET_HEAP_SIZE
(
h—p
);

128 iàĞ
	`uÆik–y
(
sz
 =ğ
	`GET_HEAP_LIMIT
(
h—p
)) )

131 
	`SET_HEAP_SIZE
(
h—p
, ++
sz
);

132 
h—p
[
sz
] = 
t
;

133 
t
->
h—p_off£t
 = 
sz
;

134 
	`up_h—p
(
h—p
, 
sz
);

136  (
t
->
h—p_off£t
 == 1);

137 
	}
}

144 
	$»move_äom_li¡
(
tim”
 **
µ»v
, tim” *
t
)

146 
tim”
 *
cu¼
, **
_µ»v
 = 
µ»v
;

148  (
cu¼
 = *
_µ»v
è!ğ
t
 )

149 
_µ»v
 = &
cu¼
->
li¡_Ãxt
;

151 *
_µ»v
 = 
t
->
li¡_Ãxt
;

153  (
_µ»v
 =ğ
µ»v
);

154 
	}
}

156 
	$add_to_li¡
(
tim”
 **
µ»v
, tim” *
t
)

158 
tim”
 *
cu¼
, **
_µ»v
 = 
µ»v
;

160  ((
cu¼
 = *
_µ»v
è!ğ
NULL
è&& (cu¼->
expœes
 <ğ
t
->expires) )

161 
_µ»v
 = &
cu¼
->
li¡_Ãxt
;

163 
t
->
li¡_Ãxt
 = 
cu¼
;

164 *
_µ»v
 = 
t
;

166  (
_µ»v
 =ğ
µ»v
);

167 
	}
}

174 
	$»move_’Œy
(
tim”
 *
t
)

176 
tim”s
 *tim” ğ&
	`³r_ıu
Ñim”s, 
t
->
ıu
);

177 
rc
;

179  
t
->
¡©us
 )

181 
TIMER_STATUS_š_h—p
:

182 
rc
 = 
	`»move_äom_h—p
(
tim”s
->
h—p
, 
t
);

184 
TIMER_STATUS_š_li¡
:

185 
rc
 = 
	`»move_äom_li¡
(&
tim”s
->
li¡
, 
t
);

188 
rc
 = 0;

189 
	`BUG
();

192 
t
->
¡©us
 = 
TIMER_STATUS_šv®id
;

193  
rc
;

194 
	}
}

196 
	$add_’Œy
(
tim”
 *
t
)

198 
tim”s
 *tim” ğ&
	`³r_ıu
Ñim”s, 
t
->
ıu
);

199 
rc
;

201 
	`ASSERT
(
t
->
¡©us
 =ğ
TIMER_STATUS_šv®id
);

204 
t
->
h—p_off£t
 = 0;

205 
t
->
¡©us
 = 
TIMER_STATUS_š_h—p
;

206 
rc
 = 
	`add_to_h—p
(
tim”s
->
h—p
, 
t
);

207 iàĞ
t
->
h—p_off£t
 != 0 )

208  
rc
;

211 
t
->
¡©us
 = 
TIMER_STATUS_š_li¡
;

212  
	`add_to_li¡
(&
tim”s
->
li¡
, 
t
);

213 
	}
}

215 
šlše
 
	$aùiv©e_tim”
(
tim”
 *timer)

217 
	`ASSERT
(
tim”
->
¡©us
 =ğ
TIMER_STATUS_šaùive
);

218 
tim”
->
¡©us
 = 
TIMER_STATUS_šv®id
;

219 
	`li¡_d–
(&
tim”
->
šaùive
);

221 iàĞ
	`add_’Œy
(
tim”
) )

222 
	`ıu_¿i£_soáœq
(
tim”
->
ıu
, 
TIMER_SOFTIRQ
);

223 
	}
}

225 
šlše
 
	$d—ùiv©e_tim”
(
tim”
 *timer)

227 iàĞ
	`»move_’Œy
(
tim”
) )

228 
	`ıu_¿i£_soáœq
(
tim”
->
ıu
, 
TIMER_SOFTIRQ
);

230 
tim”
->
¡©us
 = 
TIMER_STATUS_šaùive
;

231 
	`li¡_add
(&
tim”
->
šaùive
, &
	`³r_ıu
(
tim”s
,im”->
ıu
).inactive);

232 
	}
}

234 
šlše
 
boŞ_t
 
	$tim”_lock
(
tim”
 *timer)

236 
ıu
;

238 
	`rcu_»ad_lock
(&
tim”_ıu_»ad_lock
);

242 
ıu
 = 
	`©omic_»ad16
(&
tim”
->cpu);

243 iàĞ
	`uÆik–y
(
ıu
 =ğ
TIMER_CPU_¡©us_kËd
) )

245 
	`rcu_»ad_uÆock
(&
tim”_ıu_»ad_lock
);

248 
	`¥š_lock
(&
	`³r_ıu
(
tim”s
, 
ıu
).
lock
);

249 iàĞ
	`lik–y
(
tim”
->
ıu
 == cpu) )

251 
	`¥š_uÆock
(&
	`³r_ıu
(
tim”s
, 
ıu
).
lock
);

254 
	`rcu_»ad_uÆock
(&
tim”_ıu_»ad_lock
);

256 
	}
}

258 
	#tim”_lock_œq§ve
(
t
, 
æags
) ({ \

259 
boŞ_t
 
__x
; \

260 
	`loÿl_œq_§ve
(
æags
); \

261 iàĞ!(
__x
 = 
	`tim”_lock
(
t
)) ) \

262 
	`loÿl_œq_»¡Üe
(
æags
); \

263 
__x
; \

264 })

	)

266 
šlše
 
	$tim”_uÆock
(
tim”
 *timer)

268 
	`¥š_uÆock
(&
	`³r_ıu
(
tim”s
, 
tim”
->
ıu
).
lock
);

269 
	}
}

271 
	#tim”_uÆock_œq»¡Üe
(
t
, 
æags
) ({ \

272 
	`tim”_uÆock
(
t
); \

273 
	`loÿl_œq_»¡Üe
(
æags
); \

274 })

	)

277 
boŞ_t
 
	$aùive_tim”
(
tim”
 *timer)

279 
	`ASSERT
(
tim”
->
¡©us
 >ğ
TIMER_STATUS_šaùive
);

280 
	`ASSERT
(
tim”
->
¡©us
 <ğ
TIMER_STATUS_š_li¡
);

281  (
tim”
->
¡©us
 >ğ
TIMER_STATUS_š_h—p
);

282 
	}
}

285 
š™_tim”
(

286 
tim”
 *timer,

287 (*
funùiÚ
)(*),

288 *
d©a
,

289 
ıu
)

291 
æags
;

292 
	`mem£t
(
tim”
, 0, (*timer));

293 
tim”
->
funùiÚ
 = function;

294 
tim”
->
d©a
 = data;

295 
	`©omic_wr™e16
(&
tim”
->
ıu
, cpu);

296 
tim”
->
¡©us
 = 
TIMER_STATUS_šaùive
;

297 iàĞ!
	`tim”_lock_œq§ve
(
tim”
, 
æags
) )

298 
	`BUG
();

299 
	`li¡_add
(&
tim”
->
šaùive
, &
	`³r_ıu
(
tim”s
, 
ıu
).inactive);

300 
	`tim”_uÆock_œq»¡Üe
(
tim”
, 
æags
);

301 
	}
}

304 
	$£t_tim”
(
tim”
 *tim”, 
s_time_t
 
expœes
)

306 
æags
;

308 iàĞ!
	`tim”_lock_œq§ve
(
tim”
, 
æags
) )

311 iàĞ
	`aùive_tim”
(
tim”
) )

312 
	`d—ùiv©e_tim”
(
tim”
);

314 
tim”
->
expœes
 =ƒxpires;

316 
	`aùiv©e_tim”
(
tim”
);

318 
	`tim”_uÆock_œq»¡Üe
(
tim”
, 
æags
);

319 
	}
}

322 
	$¡İ_tim”
(
tim”
 *timer)

324 
æags
;

326 iàĞ!
	`tim”_lock_œq§ve
(
tim”
, 
æags
) )

329 iàĞ
	`aùive_tim”
(
tim”
) )

330 
	`d—ùiv©e_tim”
(
tim”
);

332 
	`tim”_uÆock_œq»¡Üe
(
tim”
, 
æags
);

333 
	}
}

336 
	$mig¿‹_tim”
(
tim”
 *tim”, 
Ãw_ıu
)

338 
Şd_ıu
;

339 
boŞ_t
 
aùive
;

340 
æags
;

342 
	`rcu_»ad_lock
(&
tim”_ıu_»ad_lock
);

346 
Şd_ıu
 = 
	`©omic_»ad16
(&
tim”
->
ıu
);

347 iàĞ(
Şd_ıu
 =ğ
Ãw_ıu
è|| (Şd_ıu =ğ
TIMER_CPU_¡©us_kËd
) )

349 
	`rcu_»ad_uÆock
(&
tim”_ıu_»ad_lock
);

353 iàĞ
Şd_ıu
 < 
Ãw_ıu
 )

355 
	`¥š_lock_œq§ve
(&
	`³r_ıu
(
tim”s
, 
Şd_ıu
).
lock
, 
æags
);

356 
	`¥š_lock
(&
	`³r_ıu
(
tim”s
, 
Ãw_ıu
).
lock
);

360 
	`¥š_lock_œq§ve
(&
	`³r_ıu
(
tim”s
, 
Ãw_ıu
).
lock
, 
æags
);

361 
	`¥š_lock
(&
	`³r_ıu
(
tim”s
, 
Şd_ıu
).
lock
);

364 iàĞ
	`lik–y
(
tim”
->
ıu
 =ğ
Şd_ıu
) )

367 
	`¥š_uÆock
(&
	`³r_ıu
(
tim”s
, 
Şd_ıu
).
lock
);

368 
	`¥š_uÆock_œq»¡Üe
(&
	`³r_ıu
(
tim”s
, 
Ãw_ıu
).
lock
, 
æags
);

371 
	`rcu_»ad_uÆock
(&
tim”_ıu_»ad_lock
);

373 
aùive
 = 
	`aùive_tim”
(
tim”
);

374 iàĞ
aùive
 )

375 
	`d—ùiv©e_tim”
(
tim”
);

377 
	`li¡_d–
(&
tim”
->
šaùive
);

378 
	`©omic_wr™e16
(&
tim”
->
ıu
, 
Ãw_ıu
);

379 
	`li¡_add
(&
tim”
->
šaùive
, &
	`³r_ıu
(
tim”s
, 
Ãw_ıu
).inactive);

381 iàĞ
aùive
 )

382 
	`aùiv©e_tim”
(
tim”
);

384 
	`¥š_uÆock
(&
	`³r_ıu
(
tim”s
, 
Şd_ıu
).
lock
);

385 
	`¥š_uÆock_œq»¡Üe
(&
	`³r_ıu
(
tim”s
, 
Ãw_ıu
).
lock
, 
æags
);

386 
	}
}

389 
	$kl_tim”
(
tim”
 *timer)

391 
Şd_ıu
, 
ıu
;

392 
æags
;

394 
	`BUG_ON
(
	`this_ıu
(
tim”s
).
ruÂšg
 =ğ
tim”
);

396 iàĞ!
	`tim”_lock_œq§ve
(
tim”
, 
æags
) )

399 iàĞ
	`aùive_tim”
(
tim”
) )

400 
	`d—ùiv©e_tim”
(
tim”
);

402 
	`li¡_d–
(&
tim”
->
šaùive
);

403 
tim”
->
¡©us
 = 
TIMER_STATUS_kËd
;

404 
Şd_ıu
 = 
tim”
->
ıu
;

405 
	`©omic_wr™e16
(&
tim”
->
ıu
, 
TIMER_CPU_¡©us_kËd
);

407 
	`¥š_uÆock_œq»¡Üe
(&
	`³r_ıu
(
tim”s
, 
Şd_ıu
).
lock
, 
æags
);

409 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

410  
	`³r_ıu
(
tim”s
, 
ıu
).
ruÂšg
 =ğ
tim”
 )

411 
	`ıu_»Ïx
();

412 
	}
}

415 
	$execu‹_tim”
(
tim”s
 *
ts
, 
tim”
 *
t
)

417 (*
â
)(*èğ
t
->
funùiÚ
;

418 *
d©a
 = 
t
->data;

420 
t
->
¡©us
 = 
TIMER_STATUS_šaùive
;

421 
	`li¡_add
(&
t
->
šaùive
, &
ts
->inactive);

423 
ts
->
ruÂšg
 = 
t
;

424 
	`¥š_uÆock_œq
(&
ts
->
lock
);

425 (*
â
)(
d©a
);

426 
	`¥š_lock_œq
(&
ts
->
lock
);

427 
ts
->
ruÂšg
 = 
NULL
;

428 
	}
}

431 
	$tim”_soáœq_aùiÚ
()

433 
tim”
 *
t
, **
h—p
, *
Ãxt
;

434 
tim”s
 *
ts
;

435 
s_time_t
 
now
, 
d—dlše
;

437 
ts
 = &
	`this_ıu
(
tim”s
);

438 
h—p
 = 
ts
->heap;

441 iàĞ
	`uÆik–y
(
ts
->
li¡
 !ğ
NULL
) )

444 
Şd_lim™
 = 
	`GET_HEAP_LIMIT
(
h—p
);

445 
Ãw_lim™
 = ((
Şd_lim™
 + 1) << 4) - 1;

446 
tim”
 **
Ãwh—p
 = 
	`xm®loc_¬¿y
(tim” *, 
Ãw_lim™
 + 1);

447 iàĞ
Ãwh—p
 !ğ
NULL
 )

449 
	`¥š_lock_œq
(&
ts
->
lock
);

450 
	`memıy
(
Ãwh—p
, 
h—p
, (
Şd_lim™
 + 1) * (*heap));

451 
	`SET_HEAP_LIMIT
(
Ãwh—p
, 
Ãw_lim™
);

452 
ts
->
h—p
 = 
Ãwh—p
;

453 
	`¥š_uÆock_œq
(&
ts
->
lock
);

454 iàĞ
Şd_lim™
 != 0 )

455 
	`xä“
(
h—p
);

456 
h—p
 = 
Ãwh—p
;

460 
	`¥š_lock_œq
(&
ts
->
lock
);

462 
now
 = 
	`NOW
();

465  (
	`GET_HEAP_SIZE
(
h—p
) != 0) &&

466 ((
t
 = 
h—p
[1])->
expœes
 < 
now
) )

468 
	`»move_äom_h—p
(
h—p
, 
t
);

469 
	`execu‹_tim”
(
ts
, 
t
);

473  ((
t
 = 
ts
->
li¡
è!ğ
NULL
è&& (t->
expœes
 < 
now
) )

475 
ts
->
li¡
 = 
t
->
li¡_Ãxt
;

476 
	`execu‹_tim”
(
ts
, 
t
);

480 
Ãxt
 = 
ts
->
li¡
;

481 
ts
->
li¡
 = 
NULL
;

482  
	`uÆik–y
((
t
 = 
Ãxt
è!ğ
NULL
) )

484 
Ãxt
 = 
t
->
li¡_Ãxt
;

485 
t
->
¡©us
 = 
TIMER_STATUS_šv®id
;

486 
	`add_’Œy
(
t
);

490 
d—dlše
 = 
STIME_MAX
;

491 iàĞ
	`GET_HEAP_SIZE
(
h—p
) != 0 )

492 
d—dlše
 = 
h—p
[1]->
expœes
;

493 iàĞ(
ts
->
li¡
 !ğ
NULL
è&& (ts->li¡->
expœes
 < 
d—dlše
) )

494 
d—dlše
 = 
ts
->
li¡
->
expœes
;

495 
	`this_ıu
(
tim”_d—dlše
) =

496 (
d—dlše
 =ğ
STIME_MAX
è? 0 : d—dlš+ 
tim”_¦İ
;

498 iàĞ!
	`»´og¿m_tim”
(
	`this_ıu
(
tim”_d—dlše
)) )

499 
	`¿i£_soáœq
(
TIMER_SOFTIRQ
);

501 
	`¥š_uÆock_œq
(&
ts
->
lock
);

502 
	}
}

504 
s_time_t
 
	$®ign_tim”
(
s_time_t
 
fœ¡tick
, 
ušt64_t
 
³riod
)

506 iàĞ!
³riod
 )

507  
fœ¡tick
;

509  
fœ¡tick
 + (
³riod
 - 1) - ((firsttick - 1) %…eriod);

510 
	}
}

512 
	$dump_tim”
(
tim”
 *
t
, 
s_time_t
 
now
)

514 
	`´štk
("ƒx=%8"
PRId64
"usimer=%p cb=%p(%p)",

515 (
t
->
expœes
 - 
now
è/ 1000,,->
funùiÚ
,->
d©a
);

516 
	`´št_symbŞ
(" %s\n", ()
t
->
funùiÚ
);

517 
	}
}

519 
	$dump_tim”q
(
key
)

521 
tim”
 *
t
;

522 
tim”s
 *
ts
;

523 
æags
;

524 
s_time_t
 
now
 = 
	`NOW
();

525 
i
, 
j
;

527 
	`´štk
("Dumpingimer queues:\n");

529 
	`fÜ_—ch_Úlše_ıu
Ğ
i
 )

531 
ts
 = &
	`³r_ıu
(
tim”s
, 
i
);

533 
	`´štk
("CPU%02d:\n", 
i
);

534 
	`¥š_lock_œq§ve
(&
ts
->
lock
, 
æags
);

535  
j
 = 1; j <ğ
	`GET_HEAP_SIZE
(
ts
->
h—p
); j++ )

536 
	`dump_tim”
(
ts
->
h—p
[
j
], 
now
);

537  
t
 = 
ts
->
li¡
, 
j
 = 0; !ğ
NULL
; =->
li¡_Ãxt
, j++ )

538 
	`dump_tim”
(
t
, 
now
);

539 
	`¥š_uÆock_œq»¡Üe
(&
ts
->
lock
, 
æags
);

541 
	}
}

543 
keyhªdËr
 
	gdump_tim”q_keyhªdËr
 = {

544 .
dŸgno¡ic
 = 1,

545 .
	gu
.
	gâ
 = 
dump_tim”q
,

546 .
	gdesc
 = "dumpimer queues"

549 
	$mig¿‹_tim”s_äom_ıu
(
Şd_ıu
)

551 
Ãw_ıu
 = 
	`fœ¡_ıu
(
ıu_Úlše_m­
);

552 
tim”s
 *
Şd_ts
, *
Ãw_ts
;

553 
tim”
 *
t
;

554 
boŞ_t
 
nÙify
 = 0;

556 
	`ASSERT
(!
	`ıu_Úlše
(
Şd_ıu
è&& cpu_Úlše(
Ãw_ıu
));

558 
Şd_ts
 = &
	`³r_ıu
(
tim”s
, 
Şd_ıu
);

559 
Ãw_ts
 = &
	`³r_ıu
(
tim”s
, 
Ãw_ıu
);

561 iàĞ
Şd_ıu
 < 
Ãw_ıu
 )

563 
	`¥š_lock_œq
(&
Şd_ts
->
lock
);

564 
	`¥š_lock
(&
Ãw_ts
->
lock
);

568 
	`¥š_lock_œq
(&
Ãw_ts
->
lock
);

569 
	`¥š_lock
(&
Şd_ts
->
lock
);

572  (
t
 = 
	`GET_HEAP_SIZE
(
Şd_ts
->
h—p
)

573 ? 
Şd_ts
->
h—p
[1] : old_ts->
li¡
è!ğ
NULL
 )

575 
	`»move_’Œy
(
t
);

576 
	`©omic_wr™e16
(&
t
->
ıu
, 
Ãw_ıu
);

577 
nÙify
 |ğ
	`add_’Œy
(
t
);

580  !
	`li¡_em±y
(&
Şd_ts
->
šaùive
) )

582 
t
 = 
	`li¡_’Œy
(
Şd_ts
->
šaùive
.
Ãxt
, 
tim”
, inactive);

583 
	`li¡_d–
(&
t
->
šaùive
);

584 
	`©omic_wr™e16
(&
t
->
ıu
, 
Ãw_ıu
);

585 
	`li¡_add
(&
t
->
šaùive
, &
Ãw_ts
->inactive);

588 
	`¥š_uÆock
(&
Şd_ts
->
lock
);

589 
	`¥š_uÆock_œq
(&
Ãw_ts
->
lock
);

590 
	`loÿl_œq_’abË
();

592 iàĞ
nÙify
 )

593 
	`ıu_¿i£_soáœq
(
Ãw_ıu
, 
TIMER_SOFTIRQ
);

594 
	}
}

596 
tim”
 *
	gdummy_h—p
;

598 
	$ıu_ÿÎback
(

599 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

601 
ıu
 = ()
hıu
;

602 
tim”s
 *
ts
 = &
	`³r_ıu
Ñim”s, 
ıu
);

604  
aùiÚ
 )

606 
CPU_UP_PREPARE
:

607 
	`INIT_LIST_HEAD
(&
ts
->
šaùive
);

608 
	`¥š_lock_š™
(&
ts
->
lock
);

609 
ts
->
h—p
 = &
dummy_h—p
;

611 
CPU_UP_CANCELED
:

612 
CPU_DEAD
:

613 
	`mig¿‹_tim”s_äom_ıu
(
ıu
);

619  
NOTIFY_DONE
;

620 
	}
}

622 
nÙif›r_block
 
	gıu_nfb
 = {

623 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback
,

624 .
	g´iÜ™y
 = 99

627 
__š™
 
	$tim”_š™
()

629 *
ıu
 = (*)()
	`smp_´oûssÜ_id
();

631 
	`İ’_soáœq
(
TIMER_SOFTIRQ
, 
tim”_soáœq_aùiÚ
);

637 
	`SET_HEAP_SIZE
(&
dummy_h—p
, 0);

638 
	`SET_HEAP_LIMIT
(&
dummy_h—p
, 0);

640 
	`ıu_ÿÎback
(&
ıu_nfb
, 
CPU_UP_PREPARE
, 
ıu
);

641 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

643 
	`»gi¡”_keyhªdËr
('a', &
dump_tim”q_keyhªdËr
);

644 
	}
}

	@tmem.c

17 #ifdeà
__XEN__


18 
	~<x’/tmem_x’.h
>

21 
	~<x’/tmem.h
>

22 
	~<x’/rbŒ“.h
>

23 
	~<x’/¿dix-Œ“.h
>

24 
	~<x’/li¡.h
>

26 
	#EXPORT


	)

27 
	#FORWARD


	)

29 
	#TMEM_SPEC_VERSION
 1

	)

33 
	#CLI_ID_NULL
 
TMH_CLI_ID_NULL


	)

34 
	#şi_id_¡r
 
tmh_şi_id_¡r


	)

35 
	#ş›Á_¡r
 
tmh_ş›Á_¡r


	)

39 #iâdeà
NDEBUG


40 
	#SENTINELS


	)

41 
	#NOINLINE
 
nošlše


	)

43 
	#NOINLINE


	)

46 #ifdeà
SENTINELS


47 
	#DECL_SENTINEL
 
£Áš–
;

	)

48 
	#SET_SENTINEL
(
_x
,
_y
è_x->
£Áš–
 = _y##
_SENTINEL


	)

49 
	#INVERT_SENTINEL
(
_x
,
_y
è_x->
£Áš–
 = ~_y##
_SENTINEL


	)

50 
	#ASSERT_SENTINEL
(
_x
,
_y
) \

51 
	`ASSERT
(
_x
->
£Áš–
 !ğ~
_y
##
_SENTINEL
);ASSERT(_x->£Áš– =ğ_y##_SENTINEL)

	)

52 #ifdeà
__i386__


53 
	#POOL_SENTINEL
 0x87658765

	)

54 
	#OBJ_SENTINEL
 0x12345678

	)

55 
	#OBJNODE_SENTINEL
 0xãdcba09

	)

56 
	#PGD_SENTINEL
 0x43214321

	)

58 
	#POOL_SENTINEL
 0x8765876587658765

	)

59 
	#OBJ_SENTINEL
 0x1234567812345678

	)

60 
	#OBJNODE_SENTINEL
 0xãdcba0987654321

	)

61 
	#PGD_SENTINEL
 0x4321432143214321

	)

64 
	#DECL_SENTINEL


	)

65 
	#SET_SENTINEL
(
_x
,
_y
èdØ{ } 0)

	)

66 
	#ASSERT_SENTINEL
(
_x
,
_y
èdØ{ } 0)

	)

67 
	#INVERT_SENTINEL
(
_x
,
_y
èdØ{ } 0)

	)

71 
	gtÙ®_tmem_İs
 = 0;

72 
	g”rÜed_tmem_İs
 = 0;

73 
	gtÙ®_æush_poŞ
 = 0;

74 
	g®loc_çed
 = 0, 
	g®loc_·ge_çed
 = 0;

75 
	geviùed_pgs
 = 0, 
	geviù_©‹m±s
 = 0;

76 
	g»lšq_pgs
 = 0, 
	g»lšq_©‹m±s
 = 0;

77 
	gmax_eviùs_³r_»lšq
 = 0;

78 
	glow_Ú_memÜy
 = 0;

79 
	gdedu³d_puts
 = 0;

80 
	gtÙ_good_•h_puts
 = 0;

81 
	gglob®_obj_couÁ_max
 = 0;

82 
	gglob®_pgp_couÁ_max
 = 0;

83 
	gglob®_pcd_couÁ_max
 = 0;

84 
	gglob®_·ge_couÁ_max
 = 0;

85 
	gglob®_¹»e_node_couÁ_max
 = 0;

86 
	gglob®_•h_couÁ_max
 = 0;

87 
	gçed_cİ›s
;

88 
	gpcd_tÙ_tze_size
 = 0;

89 
	gpcd_tÙ_csize
 = 0;

91 
DECL_CYC_COUNTER
(
succ_g‘
);

92 
DECL_CYC_COUNTER
(
succ_put
);

93 
DECL_CYC_COUNTER
(
nÚ_succ_g‘
);

94 
DECL_CYC_COUNTER
(
nÚ_succ_put
);

95 
DECL_CYC_COUNTER
(
æush
);

96 
DECL_CYC_COUNTER
(
æush_obj
);

97 #ifdeà
COMPARE_COPY_PAGE_SSE2


98 
EXTERN_CYC_COUNTER
(
pg_cİy1
);

99 
EXTERN_CYC_COUNTER
(
pg_cİy2
);

100 
EXTERN_CYC_COUNTER
(
pg_cİy3
);

101 
EXTERN_CYC_COUNTER
(
pg_cİy4
);

103 
EXTERN_CYC_COUNTER
(
pg_cİy
);

105 
DECL_CYC_COUNTER
(
com´ess
);

106 
DECL_CYC_COUNTER
(
decom´ess
);

110 
	#MAX_POOLS_PER_DOMAIN
 16

	)

111 
	#MAX_GLOBAL_SHARED_POOLS
 16

	)

113 
	gtm_poŞ
;

114 
	gtmem_·ge_desütÜ
;

115 
	gtmem_·ge_cÚ‹Á_desütÜ
;

116 
	sş›Á
 {

117 
li¡_h—d
 
	mş›Á_li¡
;

118 
tm_poŞ
 *
	mpoŞs
[
MAX_POOLS_PER_DOMAIN
];

119 
tmh_ş›Á_t
 *
	mtmh
;

120 
li¡_h—d
 
	m•hem”®_·ge_li¡
;

121 
	m•h_couÁ
, 
	m•h_couÁ_max
;

122 
şi_id_t
 
	mşi_id
;

123 
ušt32_t
 
	mweight
;

124 
ušt32_t
 
	mÿp
;

125 
boŞ_t
 
	mcom´ess
;

126 
boŞ_t
 
	mäoz’
;

127 
boŞ_t
 
	msh¬ed_auth_»quœed
;

129 
boŞ_t
 
	mlive_mig¿tšg
;

130 
boŞ_t
 
	mwas_äoz’
;

131 
li¡_h—d
 
	m³rsi¡’t_šv®id©ed_li¡
;

132 
tmem_·ge_desütÜ
 *
	mcur_pgp
;

134 
	mcom´ess_poÜ
, 
	mcom´ess_nomem
;

135 
	mcom´es£d_·ges
;

136 
ušt64_t
 
	mcom´es£d_sum_size
;

137 
ušt64_t
 
	mtÙ®_cyşes
;

138 
	msucc_³rs_puts
, 
	msucc_•h_g‘s
, 
	msucc_³rs_g‘s
;

140 
ušt64_t
 
	msh¬ed_auth_uuid
[
MAX_GLOBAL_SHARED_POOLS
][2];

142 
ş›Á
 
	tş›Á_t
;

144 
	ssh¬e_li¡
 {

145 
li¡_h—d
 
	msh¬e_li¡
;

146 
ş›Á_t
 *
	mş›Á
;

148 
sh¬e_li¡
 
	tsh¬–i¡_t
;

150 
	#OBJ_HASH_BUCKETS
 256

	)

151 
	#OBJ_HASH_BUCKETS_MASK
 (
OBJ_HASH_BUCKETS
-1)

	)

153 
	stm_poŞ
 {

154 
boŞ_t
 
	msh¬ed
;

155 
boŞ_t
 
	m³rsi¡’t
;

156 
boŞ_t
 
	mis_dyšg
;

157 
	m·geshiá
;

158 
li¡_h—d
 
	mpoŞ_li¡
;

159 
ş›Á_t
 *
	mş›Á
;

160 
ušt64_t
 
	muuid
[2];

161 
ušt32_t
 
	mpoŞ_id
;

162 
rwlock_t
 
	mpoŞ_rwlock
;

163 
rb_roÙ
 
	mobj_rb_roÙ
[
OBJ_HASH_BUCKETS
];

164 
li¡_h—d
 
	msh¬e_li¡
;

165 
	msh¬ed_couÁ
;

167 
li¡_h—d
 
	m³rsi¡’t_·ge_li¡
;

168 
tmem_·ge_desütÜ
 *
	mcur_pgp
;

170 
©omic_t
 
	mpgp_couÁ
;

171 
	mpgp_couÁ_max
;

172 
	mobj_couÁ
;

173 
	mobj_couÁ_max
;

174 
	mobjnode_couÁ
, 
	mobjnode_couÁ_max
;

175 
ušt64_t
 
	msum_liã_cyşes
;

176 
ušt64_t
 
	msum_eviùed_cyşes
;

177 
	mputs
, 
	mgood_puts
, 
	mno_mem_puts
;

178 
	mdup_puts_æushed
, 
	mdup_puts_»¶aûd
;

179 
	mg‘s
, 
	mfound_g‘s
;

180 
	mæushs
, 
	mæushs_found
;

181 
	mæush_objs
, 
	mæush_objs_found
;

182 
	mDECL_SENTINEL


184 
tm_poŞ
 
	tpoŞ_t
;

186 
	#is_³rsi¡’t
(
_p
è(_p->
³rsi¡’t
)

	)

187 
	#is_•hem”®
(
_p
è(!(_p->
³rsi¡’t
))

	)

188 
	#is_sh¬ed
(
_p
è(_p->
sh¬ed
)

	)

189 
	#is_´iv©e
(
_p
è(!(_p->
sh¬ed
))

	)

191 
	soid
 {

192 
ušt64_t
 
	moid
[3];

194 
oid
 
	tOID
;

196 
	stmem_objeù_roÙ
 {

197 
DECL_SENTINEL


198 
OID
 
	moid
;

199 
rb_node
 
	mrb_Œ“_node
;

200 
	mobjnode_couÁ
;

201 
	mpgp_couÁ
;

202 
¿dix_Œ“_roÙ
 
	mŒ“_roÙ
;

203 
poŞ_t
 *
	mpoŞ
;

204 
şi_id_t
 
	mÏ¡_ş›Á
;

205 
¥šlock_t
 
	mobj_¥šlock
;

206 
boŞ_t
 
	mno_eviù
;

208 
tmem_objeù_roÙ
 
	tobj_t
;

210 
¿dix_Œ“_node
 
	t¹n_t
;

211 
	stmem_objeù_node
 {

212 
obj_t
 *
	mobj
;

213 
DECL_SENTINEL


214 
¹n_t
 
	m¹n
;

216 
tmem_objeù_node
 
	tobjnode_t
;

218 
	stmem_·ge_desütÜ
 {

220 
li¡_h—d
 
	mglob®_•h_·ges
;

221 
li¡_h—d
 
	mş›Á_šv_·ges
;

226 
li¡_h—d
 
	mş›Á_•h_·ges
;

227 
li¡_h—d
 
	mpoŞ_³rs_·ges
;

229 
obj_t
 *
	mobj
;

230 } 
	mus
;

231 
OID
 
	mšv_oid
;

233 
·gesize_t
 
	msize
;

235 
ušt32_t
 
	mšdex
;

237 
ušt16_t
 
	mfœ¡by‹
;

238 
boŞ_t
 
	meviùiÚ_©‹m±ed
;

239 
li¡_h—d
 
	mpcd_siblšgs
;

241 
på_t
 *
	mpå
;

242 *
	mcd©a
;

243 
tmem_·ge_cÚ‹Á_desütÜ
 *
	mpcd
;

246 
ušt64_t
 
	mtime¡amp
;

247 
ušt32_t
 
	mpoŞ_id
;

249 
	mDECL_SENTINEL


251 
tmem_·ge_desütÜ
 
	tpgp_t
;

253 
	#PCD_TZE_MAX_SIZE
 (
PAGE_SIZE
 - (PAGE_SIZE/64))

	)

255 
	stmem_·ge_cÚ‹Á_desütÜ
 {

257 
på_t
 *
	mpå
;

258 *
	mcd©a
;

259 *
	mtze
;

261 
li¡_h—d
 
	mpgp_li¡
;

262 
rb_node
 
	mpcd_rb_Œ“_node
;

263 
ušt32_t
 
	mpgp_»f_couÁ
;

264 
·gesize_t
 
	msize
;

268 
tmem_·ge_cÚ‹Á_desütÜ
 
	tpcd_t
;

269 
rb_roÙ
 
	gpcd_Œ“_roÙs
[256];

270 
rwlock_t
 
	gpcd_Œ“_rwlocks
[256];

272 
LIST_HEAD
(
glob®_•hem”®_·ge_li¡
);

274 
LIST_HEAD
(
glob®_ş›Á_li¡
);

275 
LIST_HEAD
(
glob®_poŞ_li¡
);

277 
poŞ_t
 *
	gglob®_sh¬ed_poŞs
[
MAX_GLOBAL_SHARED_POOLS
] = { 0 };

278 
boŞ_t
 
	gglob®_sh¬ed_auth
 = 0;

279 
©omic_t
 
	gş›Á_weight_tÙ®
 = 
ATOMIC_INIT
(0);

280 
	gtmem_š™Ÿlized
 = 0;

284 
EXPORT
 
DEFINE_SPINLOCK
(
tmem_¥šlock
);

285 
EXPORT
 
DEFINE_RWLOCK
(
tmem_rwlock
);

286 
DEFINE_SPINLOCK
(
•h_li¡s_¥šlock
);

287 
DEFINE_SPINLOCK
(
³rs_li¡s_¥šlock
);

289 
	#tmem_¥š_lock
(
_l
èdØ{ià(!
tmh_lock_®l
è
	`¥š_lock
(_l);}0)

	)

290 
	#tmem_¥š_uÆock
(
_l
èdØ{ià(!
tmh_lock_®l
è
	`¥š_uÆock
(_l);}0)

	)

291 
	#tmem_»ad_lock
(
_l
èdØ{ià(!
tmh_lock_®l
è
	`»ad_lock
(_l);}0)

	)

292 
	#tmem_»ad_uÆock
(
_l
èdØ{ià(!
tmh_lock_®l
è
	`»ad_uÆock
(_l);}0)

	)

293 
	#tmem_wr™e_lock
(
_l
èdØ{ià(!
tmh_lock_®l
è
	`wr™e_lock
(_l);}0)

	)

294 
	#tmem_wr™e_uÆock
(
_l
èdØ{ià(!
tmh_lock_®l
è
	`wr™e_uÆock
(_l);}0)

	)

295 
	#tmem_wr™e_Œylock
(
_l
è((
tmh_lock_®l
)?1:
	`wr™e_Œylock
(_l))

	)

296 
	#tmem_¥š_Œylock
(
_l
è(
tmh_lock_®l
?1:
	`¥š_Œylock
(_l))

	)

298 
	#ASSERT_SPINLOCK
(
_l
è
	`ASSERT
(
tmh_lock_®l
 || 
	`¥š_is_locked
(_l))

	)

299 
	#ASSERT_WRITELOCK
(
_l
è
	`ASSERT
(
tmh_lock_®l
 || 
	`rw_is_wr™e_locked
(_l))

	)

302 
	gglob®_•h_couÁ
 = 0;

303 
©omic_t
 
	gglob®_obj_couÁ
 = 
ATOMIC_INIT
(0);

304 
©omic_t
 
	gglob®_pgp_couÁ
 = 
ATOMIC_INIT
(0);

305 
©omic_t
 
	gglob®_pcd_couÁ
 = 
ATOMIC_INIT
(0);

306 
©omic_t
 
	gglob®_·ge_couÁ
 = 
ATOMIC_INIT
(0);

307 
©omic_t
 
	gglob®_¹»e_node_couÁ
 = 
ATOMIC_INIT
(0);

309 
	#©omic_šc_ªd_max
(
_c
) do { \

310 
	`©omic_šc
(&
_c
); \

311 iàĞ
	`_©omic_»ad
(
_c
è> _c##
_max
 ) \

312 
_c
##
_max
 = 
	`_©omic_»ad
(_c); \

313 } 0)

	)

315 
	#©omic_dec_ªd_as£¹
(
_c
) do { \

316 
	`©omic_dec
(&
_c
); \

317 
	`ASSERT
(
	`_©omic_»ad
(
_c
) >= 0); \

318 } 0)

	)

323 
	#tmem_m®loc
(
_ty³
,
_poŞ
) \

324 
	`_tmem_m®loc
((
_ty³
), 
	`__®ignof__
(_ty³), 
_poŞ
)

	)

326 
	#tmem_m®loc_by‹s
(
_size
,
_poŞ
) \

327 
	`_tmem_m®loc
(
_size
, 1, 
_poŞ
)

	)

329 
NOINLINE
 *
	$_tmem_m®loc
(
size_t
 
size
, size_ˆ
®ign
, 
poŞ_t
 *
poŞ
)

331 *
v
;

333 iàĞ(
poŞ
 !ğ
NULL
è&& 
	`is_³rsi¡’t
(pool) )

334 
v
 = 
	`tmh_®loc_sub·ge_thi¥oŞ
(
poŞ
,
size
,
®ign
);

336 
v
 = 
	`tmh_®loc_sub·ge
(
poŞ
, 
size
, 
®ign
);

337 iàĞ
v
 =ğ
NULL
 )

338 
®loc_çed
++;

339  
v
;

340 
	}
}

342 
NOINLINE
 
	$tmem_ä“
(*
p
, 
size_t
 
size
, 
poŞ_t
 *
poŞ
)

344 iàĞ
poŞ
 =ğ
NULL
 || !
	`is_³rsi¡’t
(pool) )

345 
	`tmh_ä“_sub·ge
(
p
,
size
);

347 
	`tmh_ä“_sub·ge_thi¥oŞ
(
poŞ
,
p
,
size
);

348 
	}
}

350 
NOINLINE
 
på_t
 *
	$tmem_·ge_®loc
(
poŞ_t
 *
poŞ
)

352 
på_t
 *
på
 = 
NULL
;

354 iàĞ
poŞ
 !ğ
NULL
 && 
	`is_³rsi¡’t
(pool) )

355 
på
 = 
	`tmh_®loc_·ge_thi¥oŞ
(
poŞ
);

357 
på
 = 
	`tmh_®loc_·ge
(
poŞ
,0);

358 iàĞ
på
 =ğ
NULL
 )

359 
®loc_·ge_çed
++;

361 
	`©omic_šc_ªd_max
(
glob®_·ge_couÁ
);

362  
på
;

363 
	}
}

365 
NOINLINE
 
	$tmem_·ge_ä“
(
poŞ_t
 *
poŞ
, 
på_t
 *
på
)

367 
	`ASSERT
(
på
);

368 iàĞ
poŞ
 =ğ
NULL
 || !
	`is_³rsi¡’t
(pool) )

369 
	`tmh_ä“_·ge
(
på
);

371 
	`tmh_ä“_·ge_thi¥oŞ
(
poŞ
,
på
);

372 
	`©omic_dec_ªd_as£¹
(
glob®_·ge_couÁ
);

373 
	}
}

377 
	#NOT_SHAREABLE
 ((
ušt16_t
)-1UL)

	)

379 
NOINLINE
 
	$pcd_cİy_to_ş›Á
(
tmem_şi_mâ_t
 
cmâ
, 
pgp_t
 *
pgp
)

381 
ušt8_t
 
fœ¡by‹
 = 
pgp
->firstbyte;

382 
pcd_t
 *
pcd
;

383 
»t
;

385 
	`ASSERT
(
	`tmh_dedup_’abËd
());

386 
	`tmem_»ad_lock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

387 
pcd
 = 
pgp
->pcd;

388 iàĞ
pgp
->
size
 < 
PAGE_SIZE
 &&…gp->size != 0 &&

389 
pcd
->
size
 < 
PAGE_SIZE
 &&…cd->size != 0 )

390 
»t
 = 
	`tmh_decom´ess_to_ş›Á
(
cmâ
, 
pcd
->
cd©a
,…cd->
size
, 
NULL
);

391 iàĞ
	`tmh_tze_’abËd
(è&& 
pcd
->
size
 < 
PAGE_SIZE
 )

392 
»t
 = 
	`tmh_cİy_tze_to_ş›Á
(
cmâ
, 
pcd
->
tze
,…cd->
size
);

394 
»t
 = 
	`tmh_cİy_to_ş›Á
(
cmâ
, 
pcd
->
på
, 0, 0, 
PAGE_SIZE
, 
NULL
);

395 
	`tmem_»ad_uÆock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

396  
»t
;

397 
	}
}

401 
NOINLINE
 
	$pcd_di§ssocŸ‹
(
pgp_t
 *
pgp
, 
poŞ_t
 *
poŞ
, 
boŞ_t
 
have_pcd_rwlock
)

403 
pcd_t
 *
pcd
 = 
pgp
->pcd;

404 
på_t
 *
på
 = 
pgp
->
pcd
->pfp;

405 
ušt16_t
 
fœ¡by‹
 = 
pgp
->firstbyte;

406 *
pcd_tze
 = 
pgp
->
pcd
->
tze
;

407 
·gesize_t
 
pcd_size
 = 
pcd
->
size
;

408 
·gesize_t
 
pgp_size
 = 
pgp
->
size
;

409 *
pcd_cd©a
 = 
pgp
->
pcd
->
cd©a
;

410 
·gesize_t
 
pcd_csize
 = 
pgp
->
pcd
->
size
;

412 
	`ASSERT
(
	`tmh_dedup_’abËd
());

413 
	`ASSERT
(
fœ¡by‹
 !ğ
NOT_SHAREABLE
);

414 
	`ASSERT
(
fœ¡by‹
 < 256);

416 iàĞ
have_pcd_rwlock
 )

417 
	`ASSERT_WRITELOCK
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

419 
	`tmem_wr™e_lock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

420 
	`li¡_d–_š™
(&
pgp
->
pcd_siblšgs
);

421 
pgp
->
pcd
 = 
NULL
;

422 
pgp
->
fœ¡by‹
 = 
NOT_SHAREABLE
;

423 
pgp
->
size
 = -1;

424 iàĞ--
pcd
->
pgp_»f_couÁ
 )

426 
	`tmem_wr™e_uÆock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

431 
	`ASSERT
(
	`li¡_em±y
(&
pcd
->
pgp_li¡
));

432 
pcd
->
på
 = 
NULL
;

434 
	`rb_”a£
(&
pcd
->
pcd_rb_Œ“_node
,&
pcd_Œ“_roÙs
[
fœ¡by‹
]);

436 
	`RB_CLEAR_NODE
(&
pcd
->
pcd_rb_Œ“_node
);

438 
	`tmem_ä“
(
pcd
,(
pcd_t
),
NULL
);

439 
	`©omic_dec_ªd_as£¹
(
glob®_pcd_couÁ
);

440 iàĞ
pgp_size
 !ğ0 && 
pcd_size
 < 
PAGE_SIZE
 )

443 
	`tmem_ä“
(
pcd_cd©a
,
pcd_csize
,
poŞ
);

444 
pcd_tÙ_csize
 -ğ
pcd_csize
;

446 iàĞ
pcd_size
 !ğ
PAGE_SIZE
 )

449 
pcd_tÙ_tze_size
 -ğ
pcd_size
;

450 iàĞ
pcd_size
 )

451 
	`tmem_ä“
(
pcd_tze
,
pcd_size
,
poŞ
);

454 iàĞ
	`tmh_tze_’abËd
() )

455 
pcd_tÙ_tze_size
 -ğ
PAGE_SIZE
;

456 iàĞ
	`tmh_com´essiÚ_’abËd
() )

457 
pcd_tÙ_csize
 -ğ
PAGE_SIZE
;

458 
	`tmem_·ge_ä“
(
poŞ
,
på
);

460 
	`tmem_wr™e_uÆock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

461 
	}
}

464 
NOINLINE
 
	$pcd_assocŸ‹
(
pgp_t
 *
pgp
, *
cd©a
, 
·gesize_t
 
csize
)

466 
rb_node
 **
Ãw
, *
·»Á
 = 
NULL
;

467 
rb_roÙ
 *
roÙ
;

468 
pcd_t
 *
pcd
;

469 
cmp
;

470 
·gesize_t
 
på_size
 = 0;

471 
ušt8_t
 
fœ¡by‹
 = (
cd©a
 =ğ
NULL
è? 
	`tmh_g‘_fœ¡_by‹
(
pgp
->
på
) : *cdata;

472 
»t
 = 0;

474 iàĞ!
	`tmh_dedup_’abËd
() )

476 
	`ASSERT
(
pgp
->
us
.
obj
 !ğ
NULL
);

477 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
 !ğ
NULL
);

478 
	`ASSERT
(!
pgp
->
us
.
obj
->
poŞ
->
³rsi¡’t
);

479 iàĞ
cd©a
 =ğ
NULL
 )

481 
	`ASSERT
(
pgp
->
på
 !ğ
NULL
);

482 
på_size
 = 
PAGE_SIZE
;

483 iàĞ
	`tmh_tze_’abËd
() )

485 
på_size
 = 
	`tmh_tze_på_sÿn
(
pgp
->
på
);

486 iàĞ
på_size
 > 
PCD_TZE_MAX_SIZE
 )

487 
på_size
 = 
PAGE_SIZE
;

489 
	`ASSERT
(
på_size
 <ğ
PAGE_SIZE
);

490 
	`ASSERT
(!(
på_size
 & ((
ušt64_t
)-1)));

492 
	`tmem_wr™e_lock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

495 
roÙ
 = &
pcd_Œ“_roÙs
[
fœ¡by‹
];

496 
Ãw
 = &(
roÙ
->
rb_node
);

497  *
Ãw
 )

499 
pcd
 = 
	`cÚš”_of
(*
Ãw
, 
pcd_t
, 
pcd_rb_Œ“_node
);

500 
·»Á
 = *
Ãw
;

502 iàĞ
cd©a
 !ğ
NULL
 )

504 iàĞ
pcd
->
size
 < 
PAGE_SIZE
 )

506 
cmp
 = 
	`tmh_pcd_cmp
(
cd©a
,
csize
,
pcd
->cd©a,pcd->
size
);

509 
cmp
 = -1;

510 } iàĞ
pcd
->
size
 < 
PAGE_SIZE
 )

512 
cmp
 = 1;

513 iàĞ
	`tmh_tze_’abËd
() ) {

514 iàĞ
pcd
->
size
 < 
PAGE_SIZE
 )

516 
cmp
 = 
	`tmh_tze_på_cmp
(
pgp
->
på
,
på_size
,
pcd
->
tze
,pcd->
size
);

519 
cmp
 = 
	`tmh_tze_på_cmp
(
pgp
->
på
,
på_size
,
pcd
->på,
PAGE_SIZE
);

522 
	`ASSERT
(
pgp
->
på
 !ğ
NULL
);

523 
	`ASSERT
(
pcd
->
på
 !ğ
NULL
);

524 
cmp
 = 
	`tmh_·ge_cmp
(
pgp
->
på
,
pcd
->pfp);

528 iàĞ
cmp
 < 0 )

529 
Ãw
 = &((*Ãw)->
rb_Ëá
);

530 iàĞ
cmp
 > 0 )

531 
Ãw
 = &((*Ãw)->
rb_right
);

536 iàĞ
cd©a
 =ğ
NULL
 )

537 
	`tmem_·ge_ä“
(
pgp
->
us
.
obj
->
poŞ
,pgp->
på
);

538 
dedu³d_puts
++;

539 
m©ch
;

544 iàĞ(
pcd
 = 
	`tmem_m®loc
(
pcd_t
, 
NULL
)) == NULL )

546 
»t
 = -
ENOMEM
;

547 
uÆock
;

548 } iàĞ
cd©a
 !ğ
NULL
 ) {

549 iàĞ(
pcd
->
cd©a
 = 
	`tmem_m®loc_by‹s
(
csize
,
pgp
->
us
.
obj
->
poŞ
)è=ğ
NULL
 )

551 
	`tmem_ä“
(
pcd
,(
pcd_t
),
NULL
);

552 
»t
 = -
ENOMEM
;

553 
uÆock
;

556 
	`©omic_šc_ªd_max
(
glob®_pcd_couÁ
);

557 
	`RB_CLEAR_NODE
(&
pcd
->
pcd_rb_Œ“_node
);

558 
	`INIT_LIST_HEAD
(&
pcd
->
pgp_li¡
);

559 
pcd
->
pgp_»f_couÁ
 = 0;

560 iàĞ
cd©a
 !ğ
NULL
 )

562 
	`memıy
(
pcd
->
cd©a
,cd©a,
csize
);

563 
pcd
->
size
 = 
csize
;

564 
pcd_tÙ_csize
 +ğ
csize
;

565 } iàĞ
på_size
 == 0 ) {

566 
	`ASSERT
(
	`tmh_tze_’abËd
());

567 
pcd
->
size
 = 0;

568 
pcd
->
tze
 = 
NULL
;

569 } iàĞ
på_size
 < 
PAGE_SIZE
 &&

570 ((
pcd
->
tze
 = 
	`tmem_m®loc_by‹s
(
på_size
,
pgp
->
us
.
obj
->
poŞ
)è!ğ
NULL
) ) {

571 
	`tmh_tze_cİy_äom_på
(
pcd
->
tze
,
pgp
->
på
,
på_size
);

572 
pcd
->
size
 = 
på_size
;

573 
pcd_tÙ_tze_size
 +ğ
på_size
;

574 
	`tmem_·ge_ä“
(
pgp
->
us
.
obj
->
poŞ
,pgp->
på
);

576 
pcd
->
på
 = 
pgp
->pfp;

577 
pcd
->
size
 = 
PAGE_SIZE
;

578 iàĞ
	`tmh_tze_’abËd
() )

579 
pcd_tÙ_tze_size
 +ğ
PAGE_SIZE
;

580 iàĞ
	`tmh_com´essiÚ_’abËd
() )

581 
pcd_tÙ_csize
 +ğ
PAGE_SIZE
;

583 
	`rb_lšk_node
(&
pcd
->
pcd_rb_Œ“_node
, 
·»Á
, 
Ãw
);

584 
	`rb_š£¹_cŞÜ
(&
pcd
->
pcd_rb_Œ“_node
, 
roÙ
);

586 
m©ch
:

587 
pcd
->
pgp_»f_couÁ
++;

588 
	`li¡_add
(&
pgp
->
pcd_siblšgs
,&
pcd
->
pgp_li¡
);

589 
pgp
->
fœ¡by‹
 = firstbyte;

590 
pgp
->
eviùiÚ_©‹m±ed
 = 0;

591 
pgp
->
pcd
 =…cd;

593 
uÆock
:

594 
	`tmem_wr™e_uÆock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

595  
»t
;

596 
	}
}

601 
NOINLINE
 
pgp_t
 *
	$pgp_®loc
(
obj_t
 *
obj
)

603 
pgp_t
 *
pgp
;

604 
poŞ_t
 *
poŞ
;

606 
	`ASSERT
(
obj
 !ğ
NULL
);

607 
	`ASSERT
(
obj
->
poŞ
 !ğ
NULL
);

608 
poŞ
 = 
obj
->pool;

609 iàĞ(
pgp
 = 
	`tmem_m®loc
(
pgp_t
, 
poŞ
)è=ğ
NULL
 )

610  
NULL
;

611 
pgp
->
us
.
obj
 = obj;

612 
	`INIT_LIST_HEAD
(&
pgp
->
glob®_•h_·ges
);

613 
	`INIT_LIST_HEAD
(&
pgp
->
us
.
ş›Á_•h_·ges
);

614 
pgp
->
på
 = 
NULL
;

615 iàĞ
	`tmh_dedup_’abËd
() )

617 
pgp
->
fœ¡by‹
 = 
NOT_SHAREABLE
;

618 
pgp
->
eviùiÚ_©‹m±ed
 = 0;

619 
	`INIT_LIST_HEAD
(&
pgp
->
pcd_siblšgs
);

621 
pgp
->
size
 = -1;

622 
pgp
->
šdex
 = -1;

623 
pgp
->
time¡amp
 = 
	`g‘_cyşes
();

624 
	`SET_SENTINEL
(
pgp
,
PGD
);

625 
	`©omic_šc_ªd_max
(
glob®_pgp_couÁ
);

626 
	`©omic_šc_ªd_max
(
poŞ
->
pgp_couÁ
);

627  
pgp
;

628 
	}
}

630 
pgp_t
 *
	$pgp_lookup_š_obj
(
obj_t
 *
obj
, 
ušt32_t
 
šdex
)

632 
	`ASSERT
(
obj
 !ğ
NULL
);

633 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

634 
	`ASSERT_SENTINEL
(
obj
,
OBJ
);

635 
	`ASSERT
(
obj
->
poŞ
 !ğ
NULL
);

636 
	`ASSERT_SENTINEL
(
obj
->
poŞ
,
POOL
);

637  
	`¿dix_Œ“_lookup
(&
obj
->
Œ“_roÙ
, 
šdex
);

638 
	}
}

640 
NOINLINE
 
	$pgp_ä“_d©a
(
pgp_t
 *
pgp
, 
poŞ_t
 *
poŞ
)

642 
·gesize_t
 
pgp_size
 = 
pgp
->
size
;

644 iàĞ
pgp
->
på
 =ğ
NULL
 )

646 iàĞ
	`tmh_dedup_’abËd
(è&& 
pgp
->
fœ¡by‹
 !ğ
NOT_SHAREABLE
 )

647 
	`pcd_di§ssocŸ‹
(
pgp
,
poŞ
,0);

648 iàĞ
pgp_size
 )

649 
	`tmem_ä“
(
pgp
->
cd©a
,
pgp_size
,
poŞ
);

651 
	`tmem_·ge_ä“
(
pgp
->
us
.
obj
->
poŞ
,pgp->
på
);

652 iàĞ
poŞ
 !ğ
NULL
 && 
pgp_size
 )

654 
poŞ
->
ş›Á
->
com´es£d_·ges
--;

655 
poŞ
->
ş›Á
->
com´es£d_sum_size
 -ğ
pgp_size
;

657 
pgp
->
på
 = 
NULL
;

658 
pgp
->
size
 = -1;

659 
	}
}

661 
NOINLINE
 
	$pgp_ä“
(
pgp_t
 *
pgp
, 
äom_d–‘e
)

663 
poŞ_t
 *
poŞ
 = 
NULL
;

665 
	`ASSERT_SENTINEL
(
pgp
,
PGD
);

666 
	`ASSERT
(
pgp
->
us
.
obj
 !ğ
NULL
);

667 
	`ASSERT_SENTINEL
(
pgp
->
us
.
obj
,
OBJ
);

668 
	`ASSERT_SENTINEL
(
pgp
->
us
.
obj
->
poŞ
,
POOL
);

669 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
->
ş›Á
 !ğ
NULL
);

670 iàĞ
äom_d–‘e
 )

671 
	`ASSERT
(
	`pgp_lookup_š_obj
(
pgp
->
us
.
obj
,pgp->
šdex
è=ğ
NULL
);

672 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
 !ğ
NULL
);

673 
poŞ
 = 
pgp
->
us
.
obj
->pool;

674 iàĞ
	`is_•hem”®
(
poŞ
) )

676 
	`ASSERT
(
	`li¡_em±y
(&
pgp
->
glob®_•h_·ges
));

677 
	`ASSERT
(
	`li¡_em±y
(&
pgp
->
us
.
ş›Á_•h_·ges
));

679 
	`pgp_ä“_d©a
(
pgp
, 
poŞ
);

680 
	`©omic_dec_ªd_as£¹
(
glob®_pgp_couÁ
);

681 
	`©omic_dec_ªd_as£¹
(
poŞ
->
pgp_couÁ
);

682 
pgp
->
size
 = -1;

683 iàĞ
	`is_³rsi¡’t
(
poŞ
è&&…oŞ->
ş›Á
->
live_mig¿tšg
 )

685 
pgp
->
šv_oid
 =…gp->
us
.
obj
->
oid
;

686 
pgp
->
poŞ_id
 = 
poŞ
->pool_id;

689 
	`INVERT_SENTINEL
(
pgp
,
PGD
);

690 
pgp
->
us
.
obj
 = 
NULL
;

691 
pgp
->
šdex
 = -1;

692 
	`tmem_ä“
(
pgp
,(
pgp_t
),
poŞ
);

693 
	}
}

695 
NOINLINE
 
	$pgp_ä“_äom_šv_li¡
(
ş›Á_t
 *
ş›Á
, 
pgp_t
 *
pgp
)

697 
poŞ_t
 *
poŞ
 = 
ş›Á
->
poŞs
[
pgp
->
poŞ_id
];

699 
	`ASSERT_SENTINEL
(
poŞ
,
POOL
);

700 
	`ASSERT_SENTINEL
(
pgp
,
PGD
);

701 
	`INVERT_SENTINEL
(
pgp
,
PGD
);

702 
pgp
->
us
.
obj
 = 
NULL
;

703 
pgp
->
šdex
 = -1;

704 
	`tmem_ä“
(
pgp
,(
pgp_t
),
poŞ
);

705 
	}
}

708 
	$pgp_d–i¡
(
pgp_t
 *
pgp
, 
boŞ_t
 
no_•h_lock
)

710 
ş›Á_t
 *
ş›Á
;

712 
	`ASSERT
(
pgp
 !ğ
NULL
);

713 
	`ASSERT
(
pgp
->
us
.
obj
 !ğ
NULL
);

714 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
 !ğ
NULL
);

715 
ş›Á
 = 
pgp
->
us
.
obj
->
poŞ
->client;

716 
	`ASSERT
(
ş›Á
 !ğ
NULL
);

717 iàĞ
	`is_•hem”®
(
pgp
->
us
.
obj
->
poŞ
) )

719 iàĞ!
no_•h_lock
 )

720 
	`tmem_¥š_lock
(&
•h_li¡s_¥šlock
);

721 iàĞ!
	`li¡_em±y
(&
pgp
->
us
.
ş›Á_•h_·ges
) )

722 
ş›Á
->
•h_couÁ
--;

723 
	`ASSERT
(
ş›Á
->
•h_couÁ
 >= 0);

724 
	`li¡_d–_š™
(&
pgp
->
us
.
ş›Á_•h_·ges
);

725 iàĞ!
	`li¡_em±y
(&
pgp
->
glob®_•h_·ges
) )

726 
glob®_•h_couÁ
--;

727 
	`ASSERT
(
glob®_•h_couÁ
 >= 0);

728 
	`li¡_d–_š™
(&
pgp
->
glob®_•h_·ges
);

729 iàĞ!
no_•h_lock
 )

730 
	`tmem_¥š_uÆock
(&
•h_li¡s_¥šlock
);

732 iàĞ
ş›Á
->
live_mig¿tšg
 )

734 
	`tmem_¥š_lock
(&
³rs_li¡s_¥šlock
);

735 
	`li¡_add_
(&
pgp
->
ş›Á_šv_·ges
,

736 &
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
);

737 iàĞ
pgp
 !ğpgp->
us
.
obj
->
poŞ
->
cur_pgp
 )

738 
	`li¡_d–_š™
(&
pgp
->
us
.
poŞ_³rs_·ges
);

739 
	`tmem_¥š_uÆock
(&
³rs_li¡s_¥šlock
);

741 
	`tmem_¥š_lock
(&
³rs_li¡s_¥šlock
);

742 
	`li¡_d–_š™
(&
pgp
->
us
.
poŞ_³rs_·ges
);

743 
	`tmem_¥š_uÆock
(&
³rs_li¡s_¥šlock
);

746 
	}
}

749 
NOINLINE
 
	$pgp_d–‘e
(
pgp_t
 *
pgp
, 
boŞ_t
 
no_•h_lock
)

751 
ušt64_t
 
liã
;

753 
	`ASSERT
(
pgp
 !ğ
NULL
);

754 
	`ASSERT
(
pgp
->
us
.
obj
 !ğ
NULL
);

755 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
 !ğ
NULL
);

756 
liã
 = 
	`g‘_cyşes
(è- 
pgp
->
time¡amp
;

757 
pgp
->
us
.
obj
->
poŞ
->
sum_liã_cyşes
 +ğ
liã
;

758 
	`pgp_d–i¡
(
pgp
, 
no_•h_lock
);

759 
	`pgp_ä“
(
pgp
,1);

760 
	}
}

763 
NOINLINE
 
	$pgp_de¡roy
(*
v
)

765 
pgp_t
 *
pgp
 = (pgp_ˆ*)
v
;

767 
	`ASSERT_SPINLOCK
(&
pgp
->
us
.
obj
->
obj_¥šlock
);

768 
	`pgp_d–i¡
(
pgp
,0);

769 
	`ASSERT
(
pgp
->
us
.
obj
 !ğ
NULL
);

770 
pgp
->
us
.
obj
->
pgp_couÁ
--;

771 
	`ASSERT
(
pgp
->
us
.
obj
->
pgp_couÁ
 >= 0);

772 
	`pgp_ä“
(
pgp
,0);

773 
	}
}

775 
FORWARD
 
¹n_t
 *
¹n_®loc
(*
¬g
);

776 
FORWARD
 
¹n_ä“
(
¹n_t
 *
¹n
);

778 
	$pgp_add_to_obj
(
obj_t
 *
obj
, 
ušt32_t
 
šdex
, 
pgp_t
 *
pgp
)

780 
»t
;

782 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

783 
»t
 = 
	`¿dix_Œ“_š£¹
(&
obj
->
Œ“_roÙ
, 
šdex
, 
pgp
, 
¹n_®loc
, obj);

784 iàĞ!
»t
 )

785 
obj
->
pgp_couÁ
++;

786  
»t
;

787 
	}
}

789 
NOINLINE
 
pgp_t
 *
	$pgp_d–‘e_äom_obj
(
obj_t
 *
obj
, 
ušt32_t
 
šdex
)

791 
pgp_t
 *
pgp
;

793 
	`ASSERT
(
obj
 !ğ
NULL
);

794 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

795 
	`ASSERT_SENTINEL
(
obj
,
OBJ
);

796 
	`ASSERT
(
obj
->
poŞ
 !ğ
NULL
);

797 
	`ASSERT_SENTINEL
(
obj
->
poŞ
,
POOL
);

798 
pgp
 = 
	`¿dix_Œ“_d–‘e
(&
obj
->
Œ“_roÙ
, 
šdex
, 
¹n_ä“
);

799 iàĞ
pgp
 !ğ
NULL
 )

800 
obj
->
pgp_couÁ
--;

801 
	`ASSERT
(
obj
->
pgp_couÁ
 >= 0);

803  
pgp
;

804 
	}
}

809 
NOINLINE
 
¹n_t
 *
	$¹n_®loc
(*
¬g
)

811 
objnode_t
 *
objnode
;

812 
obj_t
 *
obj
 = (obj_ˆ*)
¬g
;

814 
	`ASSERT_SENTINEL
(
obj
,
OBJ
);

815 
	`ASSERT
(
obj
->
poŞ
 !ğ
NULL
);

816 
	`ASSERT_SENTINEL
(
obj
->
poŞ
,
POOL
);

817 
objnode
 = 
	`tmem_m®loc
(
objnode_t
,
obj
->
poŞ
);

818 ià(
objnode
 =ğ
NULL
)

819  
NULL
;

820 
objnode
->
obj
 = obj;

821 
	`SET_SENTINEL
(
objnode
,
OBJNODE
);

822 
	`mem£t
(&
objnode
->
¹n
, 0, (
¹n_t
));

823 ià(++
obj
->
poŞ
->
objnode_couÁ
 > obj->poŞ->
objnode_couÁ_max
)

824 
obj
->
poŞ
->
objnode_couÁ_max
 = obj->poŞ->
objnode_couÁ
;

825 
	`©omic_šc_ªd_max
(
glob®_¹»e_node_couÁ
);

826 
obj
->
objnode_couÁ
++;

827  &
objnode
->
¹n
;

828 
	}
}

831 
	$¹n_ä“
(
¹n_t
 *
¹n
)

833 
poŞ_t
 *
poŞ
;

834 
objnode_t
 *
objnode
;

835 
i
;

837 
	`ASSERT
(
¹n
 !ğ
NULL
);

838 
i
 = 0; i < 
RADIX_TREE_MAP_SIZE
; i++)

839 
	`ASSERT
(
¹n
->
¦Ùs
[
i
] =ğ
NULL
);

840 
objnode
 = 
	`cÚš”_of
(
¹n
,
objnode_t
,rtn);

841 
	`ASSERT_SENTINEL
(
objnode
,
OBJNODE
);

842 
	`INVERT_SENTINEL
(
objnode
,
OBJNODE
);

843 
	`ASSERT
(
objnode
->
obj
 !ğ
NULL
);

844 
	`ASSERT_SPINLOCK
(&
objnode
->
obj
->
obj_¥šlock
);

845 
	`ASSERT_SENTINEL
(
objnode
->
obj
,
OBJ
);

846 
poŞ
 = 
objnode
->
obj
->pool;

847 
	`ASSERT
(
poŞ
 !ğ
NULL
);

848 
	`ASSERT_SENTINEL
(
poŞ
,
POOL
);

849 
poŞ
->
objnode_couÁ
--;

850 
objnode
->
obj
->
objnode_couÁ
--;

851 
objnode
->
obj
 = 
NULL
;

852 
	`tmem_ä“
(
objnode
,(
objnode_t
),
poŞ
);

853 
	`©omic_dec_ªd_as£¹
(
glob®_¹»e_node_couÁ
);

854 
	}
}

858 
	$oid_com·»
(
OID
 *
Ëá
, OID *
right
)

860 iàĞ
Ëá
->
oid
[2] =ğ
right
->oid[2] )

862 iàĞ
Ëá
->
oid
[1] =ğ
right
->oid[1] )

864 iàĞ
Ëá
->
oid
[0] =ğ
right
->oid[0] )

866 iàĞ
Ëá
->
oid
[0] < 
right
->oid[0] )

871 iàĞ
Ëá
->
oid
[1] < 
right
->oid[1] )

876 iàĞ
Ëá
->
oid
[2] < 
right
->oid[2] )

880 
	}
}

882 
	$oid_£t_šv®id
(
OID
 *
oidp
)

884 
oidp
->
oid
[0] = oidp->oid[1] = oidp->oid[2] = -1UL;

885 
	}
}

887 
	$oid_hash
(
OID
 *
oidp
)

889  (
	`tmh_hash
(
oidp
->
oid
[0] ^ oidp->oid[1] ^ oidp->oid[2],

890 
BITS_PER_LONG
è& 
OBJ_HASH_BUCKETS_MASK
);

891 
	}
}

894 
NOINLINE
 
obj_t
 * 
	$obj_fšd
(
poŞ_t
 *
poŞ
, 
OID
 *
oidp
)

896 
rb_node
 *
node
;

897 
obj_t
 *
obj
;

899 
»¡¬t_fšd
:

900 
	`tmem_»ad_lock
(&
poŞ
->
poŞ_rwlock
);

901 
node
 = 
poŞ
->
obj_rb_roÙ
[
	`oid_hash
(
oidp
)].
rb_node
;

902  
node
 )

904 
obj
 = 
	`cÚš”_of
(
node
, 
obj_t
, 
rb_Œ“_node
);

905  
	`oid_com·»
(&
obj
->
oid
, 
oidp
) )

908 iàĞ
tmh_lock_®l
 )

909 
obj
->
no_eviù
 = 1;

912 iàĞ!
	`tmem_¥š_Œylock
(&
obj
->
obj_¥šlock
) )

914 
	`tmem_»ad_uÆock
(&
poŞ
->
poŞ_rwlock
);

915 
»¡¬t_fšd
;

917 
	`tmem_»ad_uÆock
(&
poŞ
->
poŞ_rwlock
);

919  
obj
;

921 
node
 =‚ode->
rb_Ëá
;

924 
node
 =‚ode->
rb_right
;

927 
	`tmem_»ad_uÆock
(&
poŞ
->
poŞ_rwlock
);

928  
NULL
;

929 
	}
}

932 
NOINLINE
 
	$obj_ä“
(
obj_t
 *
obj
, 
no_»b®ªû
)

934 
poŞ_t
 *
poŞ
;

935 
OID
 
Şd_oid
;

937 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

938 
	`ASSERT
(
obj
 !ğ
NULL
);

939 
	`ASSERT_SENTINEL
(
obj
,
OBJ
);

940 
	`ASSERT
(
obj
->
pgp_couÁ
 == 0);

941 
poŞ
 = 
obj
->pool;

942 
	`ASSERT
(
poŞ
 !ğ
NULL
);

943 
	`ASSERT
(
poŞ
->
ş›Á
 !ğ
NULL
);

944 
	`ASSERT_WRITELOCK
(&
poŞ
->
poŞ_rwlock
);

945 iàĞ
obj
->
Œ“_roÙ
.
ºode
 !ğ
NULL
 )

946 
	`¿dix_Œ“_de¡roy
(&
obj
->
Œ“_roÙ
, 
pgp_de¡roy
, 
¹n_ä“
);

947 
	`ASSERT
(()
obj
->
objnode_couÁ
 == 0);

948 
	`ASSERT
(
obj
->
Œ“_roÙ
.
ºode
 =ğ
NULL
);

949 
poŞ
->
obj_couÁ
--;

950 
	`ASSERT
(
poŞ
->
obj_couÁ
 >= 0);

951 
	`INVERT_SENTINEL
(
obj
,
OBJ
);

952 
obj
->
poŞ
 = 
NULL
;

953 
Şd_oid
 = 
obj
->
oid
;

954 
	`oid_£t_šv®id
(&
obj
->
oid
);

955 
obj
->
Ï¡_ş›Á
 = 
CLI_ID_NULL
;

956 
	`©omic_dec_ªd_as£¹
(
glob®_obj_couÁ
);

958 iàĞ!
no_»b®ªû
 )

959 
	`rb_”a£
(&
obj
->
rb_Œ“_node
,&
poŞ
->
obj_rb_roÙ
[
	`oid_hash
(&
Şd_oid
)]);

960 
	`tmem_ä“
(
obj
,(
obj_t
),
poŞ
);

961 
	}
}

963 
NOINLINE
 
	$obj_rb_š£¹
(
rb_roÙ
 *
roÙ
, 
obj_t
 *
obj
)

965 
rb_node
 **
Ãw
, *
·»Á
 = 
NULL
;

966 
obj_t
 *
this
;

968 
Ãw
 = &(
roÙ
->
rb_node
);

969  *
Ãw
 )

971 
this
 = 
	`cÚš”_of
(*
Ãw
, 
obj_t
, 
rb_Œ“_node
);

972 
·»Á
 = *
Ãw
;

973  
	`oid_com·»
(&
this
->
oid
, &
obj
->oid) )

978 
Ãw
 = &((*Ãw)->
rb_Ëá
);

981 
Ãw
 = &((*Ãw)->
rb_right
);

985 
	`rb_lšk_node
(&
obj
->
rb_Œ“_node
, 
·»Á
, 
Ãw
);

986 
	`rb_š£¹_cŞÜ
(&
obj
->
rb_Œ“_node
, 
roÙ
);

988 
	}
}

994 
NOINLINE
 
obj_t
 * 
	$obj_Ãw
(
poŞ_t
 *
poŞ
, 
OID
 *
oidp
)

996 
obj_t
 *
obj
;

998 
	`ASSERT
(
poŞ
 !ğ
NULL
);

999 
	`ASSERT_WRITELOCK
(&
poŞ
->
poŞ_rwlock
);

1000 iàĞ(
obj
 = 
	`tmem_m®loc
(
obj_t
,
poŞ
)è=ğ
NULL
 )

1001  
NULL
;

1002 
poŞ
->
obj_couÁ
++;

1003 ià(
poŞ
->
obj_couÁ
 >…oŞ->
obj_couÁ_max
)

1004 
poŞ
->
obj_couÁ_max
 =…oŞ->
obj_couÁ
;

1005 
	`©omic_šc_ªd_max
(
glob®_obj_couÁ
);

1006 
	`INIT_RADIX_TREE
(&
obj
->
Œ“_roÙ
,0);

1007 
	`¥š_lock_š™
(&
obj
->
obj_¥šlock
);

1008 
obj
->
poŞ
 =…ool;

1009 
obj
->
oid
 = *
oidp
;

1010 
obj
->
objnode_couÁ
 = 0;

1011 
obj
->
pgp_couÁ
 = 0;

1012 
obj
->
Ï¡_ş›Á
 = 
CLI_ID_NULL
;

1013 
	`SET_SENTINEL
(
obj
,
OBJ
);

1014 
	`tmem_¥š_lock
(&
obj
->
obj_¥šlock
);

1015 
	`obj_rb_š£¹
(&
poŞ
->
obj_rb_roÙ
[
	`oid_hash
(
oidp
)], 
obj
);

1016 
obj
->
no_eviù
 = 1;

1017 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

1018  
obj
;

1019 
	}
}

1022 
NOINLINE
 
	$obj_de¡roy
(
obj_t
 *
obj
, 
no_»b®ªû
)

1024 
	`ASSERT_WRITELOCK
(&
obj
->
poŞ
->
poŞ_rwlock
);

1025 
	`¿dix_Œ“_de¡roy
(&
obj
->
Œ“_roÙ
, 
pgp_de¡roy
, 
¹n_ä“
);

1026 
	`obj_ä“
(
obj
,
no_»b®ªû
);

1027 
	}
}

1030 
	$poŞ_de¡roy_objs
(
poŞ_t
 *
poŞ
, 
boŞ_t
 
£Ëùive
, 
şi_id_t
 
şi_id
)

1032 
rb_node
 *
node
;

1033 
obj_t
 *
obj
;

1034 
i
;

1036 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1037 
poŞ
->
is_dyšg
 = 1;

1038 
i
 = 0; i < 
OBJ_HASH_BUCKETS
; i++)

1040 
node
 = 
	`rb_fœ¡
(&
poŞ
->
obj_rb_roÙ
[
i
]);

1041  
node
 !ğ
NULL
 )

1043 
obj
 = 
	`cÚš”_of
(
node
, 
obj_t
, 
rb_Œ“_node
);

1044 
	`tmem_¥š_lock
(&
obj
->
obj_¥šlock
);

1045 
node
 = 
	`rb_Ãxt
(node);

1046 
	`ASSERT
(
obj
->
no_eviù
 == 0);

1047 iàĞ!
£Ëùive
 )

1049 
	`obj_de¡roy
(
obj
,0);

1050 iàĞ
obj
->
Ï¡_ş›Á
 =ğ
şi_id
 )

1051 
	`obj_de¡roy
(
obj
,0);

1053 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1056 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1057 
	}
}

1062 
poŞ_t
 * 
	$poŞ_®loc
()

1064 
poŞ_t
 *
poŞ
;

1065 
i
;

1067 iàĞ(
poŞ
 = 
	`tmh_®loc_šäa
((
poŞ_t
),
	`__®ignof__
ÕoŞ_t))è=ğ
NULL
 )

1068  
NULL
;

1069 
i
 = 0; i < 
OBJ_HASH_BUCKETS
; i++)

1070 
poŞ
->
obj_rb_roÙ
[
i
] = 
RB_ROOT
;

1071 
	`INIT_LIST_HEAD
(&
poŞ
->
poŞ_li¡
);

1072 
	`INIT_LIST_HEAD
(&
poŞ
->
³rsi¡’t_·ge_li¡
);

1073 
poŞ
->
cur_pgp
 = 
NULL
;

1074 
	`rwlock_š™
(&
poŞ
->
poŞ_rwlock
);

1075 
poŞ
->
pgp_couÁ_max
 =…oŞ->
obj_couÁ_max
 = 0;

1076 
poŞ
->
objnode_couÁ
 =…oŞ->
objnode_couÁ_max
 = 0;

1077 
	`©omic_£t
(&
poŞ
->
pgp_couÁ
,0);

1078 
poŞ
->
obj_couÁ
 = 0;…oŞ->
sh¬ed_couÁ
 = 0;

1079 
poŞ
->
·geshiá
 = 
PAGE_SHIFT
 - 12;

1080 
poŞ
->
good_puts
 =…oŞ->
puts
 =…oŞ->
dup_puts_æushed
 = 0;

1081 
poŞ
->
dup_puts_»¶aûd
 =…oŞ->
no_mem_puts
 = 0;

1082 
poŞ
->
found_g‘s
 =…oŞ->
g‘s
 = 0;

1083 
poŞ
->
æushs_found
 =…oŞ->
æushs
 = 0;

1084 
poŞ
->
æush_objs_found
 =…oŞ->
æush_objs
 = 0;

1085 
poŞ
->
is_dyšg
 = 0;

1086 
	`SET_SENTINEL
(
poŞ
,
POOL
);

1087  
poŞ
;

1088 
	}
}

1090 
NOINLINE
 
	$poŞ_ä“
(
poŞ_t
 *
poŞ
)

1092 
	`ASSERT_SENTINEL
(
poŞ
,
POOL
);

1093 
	`INVERT_SENTINEL
(
poŞ
,
POOL
);

1094 
poŞ
->
ş›Á
 = 
NULL
;

1095 
	`li¡_d–
(&
poŞ
->
poŞ_li¡
);

1096 
	`tmh_ä“_šäa
(
poŞ
);

1097 
	}
}

1101 
	$sh¬ed_poŞ_još
(
poŞ_t
 *
poŞ
, 
ş›Á_t
 *
Ãw_ş›Á
)

1103 
sh¬–i¡_t
 *
¦
;

1105 
	`ASSERT
(
	`is_sh¬ed
(
poŞ
));

1106 iàĞ(
¦
 = 
	`tmem_m®loc
(
sh¬–i¡_t
,
NULL
)) == NULL )

1108 
¦
->
ş›Á
 = 
Ãw_ş›Á
;

1109 
	`li¡_add_
(&
¦
->
sh¬e_li¡
, &
poŞ
->share_list);

1110 iàĞ
Ãw_ş›Á
->
şi_id
 !ğ
poŞ
->
ş›Á
->cli_id )

1111 
	`´štk
("adding‚ew %s %do shared…ool owned by %s %d\n",

1112 
ş›Á_¡r
, 
Ãw_ş›Á
->
şi_id
, cl›Á_¡r, 
poŞ
->
ş›Á
->cli_id);

1113  ++
poŞ
->
sh¬ed_couÁ
;

1114 
	}
}

1117 
NOINLINE
 
	$sh¬ed_poŞ_»assign
(
poŞ_t
 *
poŞ
)

1119 
sh¬–i¡_t
 *
¦
;

1120 
poŞid
;

1121 
ş›Á_t
 *
Şd_ş›Á
 = 
poŞ
->
ş›Á
, *
Ãw_ş›Á
;

1123 
	`ASSERT
(
	`is_sh¬ed
(
poŞ
));

1124 iàĞ
	`li¡_em±y
(&
poŞ
->
sh¬e_li¡
) )

1126 
	`ASSERT
(
poŞ
->
sh¬ed_couÁ
 == 0);

1129 
Şd_ş›Á
->
poŞs
[
poŞ
->
poŞ_id
] = 
NULL
;

1130 
¦
 = 
	`li¡_’Œy
(
poŞ
->
sh¬e_li¡
.
Ãxt
, 
sh¬–i¡_t
, share_list);

1131 
	`ASSERT
(
¦
->
ş›Á
 !ğ
Şd_ş›Á
);

1132 
poŞ
->
ş›Á
 = 
Ãw_ş›Á
 = 
¦
->client;

1133 
poŞid
 = 0;…oŞid < 
MAX_POOLS_PER_DOMAIN
;…oolid++)

1134 ià(
Ãw_ş›Á
->
poŞs
[
poŞid
] =ğ
poŞ
)

1136 
	`ASSERT
(
poŞid
 !ğ
MAX_POOLS_PER_DOMAIN
);

1137 
Ãw_ş›Á
->
•h_couÁ
 +ğ
	`_©omic_»ad
(
poŞ
->
pgp_couÁ
);

1138 
Şd_ş›Á
->
•h_couÁ
 -ğ
	`_©omic_»ad
(
poŞ
->
pgp_couÁ
);

1139 
	`li¡_¥liû_š™
(&
Şd_ş›Á
->
•hem”®_·ge_li¡
,

1140 &
Ãw_ş›Á
->
•hem”®_·ge_li¡
);

1141 
	`´štk
("reassigned shared…ool from %s=%do %s=%d…ool_id=%d\n",

1142 
şi_id_¡r
, 
Şd_ş›Á
->
şi_id
, cli_id_¡r, 
Ãw_ş›Á
->şi_id, 
poŞid
);

1143 
poŞ
->
poŞ_id
 = 
poŞid
;

1144 
	}
}

1148 
NOINLINE
 
	$sh¬ed_poŞ_qu™
(
poŞ_t
 *
poŞ
, 
şi_id_t
 
şi_id
)

1150 
sh¬–i¡_t
 *
¦
;

1151 
s_poŞid
;

1153 
	`ASSERT
(
	`is_sh¬ed
(
poŞ
));

1154 
	`ASSERT
(
poŞ
->
ş›Á
 !ğ
NULL
);

1156 
	`ASSERT_WRITELOCK
(&
tmem_rwlock
);

1157 
	`poŞ_de¡roy_objs
(
poŞ
,1,
şi_id
);

1158 
	`li¡_fÜ_—ch_’Œy
(
¦
,&
poŞ
->
sh¬e_li¡
, share_list)

1160 ià(
¦
->
ş›Á
->
şi_id
 != cli_id)

1162 
	`li¡_d–
(&
¦
->
sh¬e_li¡
);

1163 
	`tmem_ä“
(
¦
,(
sh¬–i¡_t
),
poŞ
);

1164 --
poŞ
->
sh¬ed_couÁ
;

1165 ià(
poŞ
->
ş›Á
->
şi_id
 == cli_id)

1166 
	`sh¬ed_poŞ_»assign
(
poŞ
);

1167 ià(
poŞ
->
sh¬ed_couÁ
)

1168  
poŞ
->
sh¬ed_couÁ
;

1169 
s_poŞid
 = 0; s_poŞid < 
MAX_GLOBAL_SHARED_POOLS
; s_poolid++)

1170 iàĞ(
glob®_sh¬ed_poŞs
[
s_poŞid
]è=ğ
poŞ
 )

1172 
glob®_sh¬ed_poŞs
[
s_poŞid
] = 
NULL
;

1177 
	`´štk
("tmem:‚o match unsharing…ool, %s=%d\n",

1178 
şi_id_¡r
,
poŞ
->
ş›Á
->
şi_id
);

1180 
	}
}

1183 
	$poŞ_æush
(
poŞ_t
 *
poŞ
, 
şi_id_t
 
şi_id
, 
boŞ_t
 
de¡roy
)

1185 
	`ASSERT
(
poŞ
 !ğ
NULL
);

1186 iàĞ(
	`is_sh¬ed
(
poŞ
)è&& (
	`sh¬ed_poŞ_qu™
ÕoŞ,
şi_id
) > 0) )

1188 
	`´štk
("tmem: %s=%d‚o†onger using shared…ool %d owned by %s=%d\n",

1189 
şi_id_¡r
, 
şi_id
, 
poŞ
->
poŞ_id
, cli_id_¡r,poŞ->
ş›Á
->cli_id);

1192 
	`´štk
("% %s-% tmem…oŞ ",
de¡roy
?"destroying":"flushing",

1193 
	`is_³rsi¡’t
(
poŞ
) ? "persistent" : "ephemeral" ,

1194 
	`is_sh¬ed
(
poŞ
) ? "shared" : "private");

1195 
	`´štk
("%s=%d…oŞ_id=%d\n", 
şi_id_¡r
,
poŞ
->
ş›Á
->
şi_id
,poŞ->
poŞ_id
);

1196 iàĞ
poŞ
->
ş›Á
->
live_mig¿tšg
 )

1198 
	`´štk
("can't %s…ool while %s is†ive-migrating\n",

1199 
de¡roy
?"de¡roy":"æush", 
ş›Á_¡r
);

1202 
	`poŞ_de¡roy_objs
(
poŞ
,0,
CLI_ID_NULL
);

1203 iàĞ
de¡roy
 )

1205 
poŞ
->
ş›Á
->
poŞs
[poŞ->
poŞ_id
] = 
NULL
;

1206 
	`poŞ_ä“
(
poŞ
);

1208 
	}
}

1212 
ş›Á_t
 *
	$ş›Á_ü—‹
(
şi_id_t
 
şi_id
)

1214 
ş›Á_t
 *
ş›Á
 = 
	`tmh_®loc_šäa
((ş›Á_t),
	`__®ignof__
(client_t));

1215 
i
;

1217 
	`´štk
("tmem: in™Ÿlizšgmem c­ab™y fÜ %s=%d...",
şi_id_¡r
,
şi_id
);

1218 iàĞ
ş›Á
 =ğ
NULL
 )

1220 
	`´štk
("failed... out of memory\n");

1221 
ç
;

1223 
	`mem£t
(
ş›Á
,0,(
ş›Á_t
));

1224 iàĞ(
ş›Á
->
tmh
 = 
	`tmh_ş›Á_š™
(
şi_id
)è=ğ
NULL
 )

1226 
	`´štk
("failed... can't‡llocate host-dependent…art of client\n");

1227 
ç
;

1229 iàĞ!
	`tmh_£t_ş›Á_äom_id
(
ş›Á
, cl›Á->
tmh
, 
şi_id
) )

1231 
	`´štk
("failed... can't set client\n");

1232 
ç
;

1234 
ş›Á
->
şi_id
 = cli_id;

1235 #ifdeà
__i386__


1236 
ş›Á
->
com´ess
 = 0;

1238 
ş›Á
->
com´ess
 = 
	`tmh_com´essiÚ_’abËd
();

1240 
ş›Á
->
sh¬ed_auth_»quœed
 = 
	`tmh_sh¬ed_auth
();

1241  
i
 = 0; i < 
MAX_GLOBAL_SHARED_POOLS
; i++)

1242 
ş›Á
->
sh¬ed_auth_uuid
[
i
][0] =

1243 
ş›Á
->
sh¬ed_auth_uuid
[
i
][1] = -1L;

1244 
ş›Á
->
äoz’
 = 0; cl›Á->
live_mig¿tšg
 = 0;

1245 
ş›Á
->
weight
 = 0; cl›Á->
ÿp
 = 0;

1246 
	`li¡_add_
(&
ş›Á
->
ş›Á_li¡
, &
glob®_ş›Á_li¡
);

1247 
	`INIT_LIST_HEAD
(&
ş›Á
->
•hem”®_·ge_li¡
);

1248 
	`INIT_LIST_HEAD
(&
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
);

1249 
ş›Á
->
cur_pgp
 = 
NULL
;

1250 
ş›Á
->
•h_couÁ
 = cl›Á->
•h_couÁ_max
 = 0;

1251 
ş›Á
->
tÙ®_cyşes
 = 0; cl›Á->
succ_³rs_puts
 = 0;

1252 
ş›Á
->
succ_•h_g‘s
 = 0; cl›Á->
succ_³rs_g‘s
 = 0;

1253 
	`´štk
("ok\n");

1254  
ş›Á
;

1256 
ç
:

1257 
	`tmh_ä“_šäa
(
ş›Á
);

1258  
NULL
;

1259 
	}
}

1261 
	$ş›Á_ä“
(
ş›Á_t
 *
ş›Á
)

1263 
	`li¡_d–
(&
ş›Á
->
ş›Á_li¡
);

1264 
	`tmh_ş›Á_de¡roy
(
ş›Á
->
tmh
);

1265 
	`tmh_ä“_šäa
(
ş›Á
);

1266 
	}
}

1269 
	$ş›Á_æush
(
ş›Á_t
 *
ş›Á
, 
boŞ_t
 
de¡roy
)

1271 
i
;

1272 
poŞ_t
 *
poŞ
;

1274 
i
 = 0; i < 
MAX_POOLS_PER_DOMAIN
; i++)

1276 iàĞ(
poŞ
 = 
ş›Á
->
poŞs
[
i
]è=ğ
NULL
 )

1278 
	`poŞ_æush
(
poŞ
,
ş›Á
->
şi_id
,
de¡roy
);

1279 iàĞ
de¡roy
 )

1280 
ş›Á
->
poŞs
[
i
] = 
NULL
;

1282 iàĞ
de¡roy
 )

1283 
	`ş›Á_ä“
(
ş›Á
);

1284 
	}
}

1286 
boŞ_t
 
	$ş›Á_ov”_quÙa
(
ş›Á_t
 *
ş›Á
)

1288 
tÙ®
 = 
	`_©omic_»ad
(
ş›Á_weight_tÙ®
);

1290 
	`ASSERT
(
ş›Á
 !ğ
NULL
);

1291 iàĞ(
tÙ®
 =ğ0è|| (
ş›Á
->
weight
 == 0) ||

1292 (
ş›Á
->
•h_couÁ
 == 0) )

1294  ( ((
glob®_•h_couÁ
*100Lè/ 
ş›Á
->
•h_couÁ
 ) >

1295 ((
tÙ®
*100Lè/ 
ş›Á
->
weight
) );

1296 
	}
}

1298 
	$ş›Á_ä“ze
(
ş›Á_t
 *
ş›Á
, 
ä“ze
)

1300 
ş›Á
->
äoz’
 = 
ä“ze
;

1301 
	}
}

1305 
boŞ_t
 
	$tmem_Œy_to_eviù_pgp
(
pgp_t
 *
pgp
, 
boŞ_t
 *
hŞd_poŞ_rwlock
)

1307 
obj_t
 *
obj
 = 
pgp
->
us
.obj;

1308 
poŞ_t
 *
poŞ
 = 
obj
->pool;

1309 
ş›Á_t
 *
ş›Á
 = 
poŞ
->client;

1310 
ušt16_t
 
fœ¡by‹
 = 
pgp
->firstbyte;

1312 iàĞ
poŞ
->
is_dyšg
 )

1314 iàĞ
tmh_lock_®l
 && !
obj
->
no_eviù
 )

1316 iàĞ
	`tmem_¥š_Œylock
(&
obj
->
obj_¥šlock
) )

1318 iàĞ
	`tmh_dedup_’abËd
() )

1320 
fœ¡by‹
 = 
pgp
->firstbyte;

1321 iàĞ
fœ¡by‹
 =ğ
NOT_SHAREABLE
 )

1322 
obj_uÆock
;

1323 
	`ASSERT
(
fœ¡by‹
 < 256);

1324 iàĞ!
	`tmem_wr™e_Œylock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]) )

1325 
obj_uÆock
;

1326 iàĞ
pgp
->
pcd
->
pgp_»f_couÁ
 > 1 && !pgp->
eviùiÚ_©‹m±ed
 )

1328 
pgp
->
eviùiÚ_©‹m±ed
++;

1329 
	`li¡_d–
(&
pgp
->
glob®_•h_·ges
);

1330 
	`li¡_add_
(&
pgp
->
glob®_•h_·ges
,&
glob®_•hem”®_·ge_li¡
);

1331 
	`li¡_d–
(&
pgp
->
us
.
ş›Á_•h_·ges
);

1332 
	`li¡_add_
(&
pgp
->
us
.
ş›Á_•h_·ges
,&
ş›Á
->
•hem”®_·ge_li¡
);

1333 
pcd_uÆock
;

1336 iàĞ
obj
->
pgp_couÁ
 > 1 )

1338 iàĞ
	`tmem_wr™e_Œylock
(&
poŞ
->
poŞ_rwlock
) )

1340 *
hŞd_poŞ_rwlock
 = 1;

1343 
pcd_uÆock
:

1344 
	`tmem_wr™e_uÆock
(&
pcd_Œ“_rwlocks
[
fœ¡by‹
]);

1345 
obj_uÆock
:

1346 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1349 
	}
}

1351 
	$tmem_eviù
()

1353 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_cu¼’t
();

1354 
pgp_t
 *
pgp
 = 
NULL
, *
pgp2
, *
pgp_d–
;

1355 
obj_t
 *
obj
;

1356 
poŞ_t
 *
poŞ
;

1357 
»t
 = 0;

1358 
boŞ_t
 
hŞd_poŞ_rwlock
 = 0;

1360 
eviù_©‹m±s
++;

1361 
	`tmem_¥š_lock
(&
•h_li¡s_¥šlock
);

1362 iàĞ(
ş›Á
 !ğ
NULL
è&& 
	`ş›Á_ov”_quÙa
(client) &&

1363 !
	`li¡_em±y
(&
ş›Á
->
•hem”®_·ge_li¡
) )

1365 
	`li¡_fÜ_—ch_’Œy_§ã
(
pgp
,
pgp2
,&
ş›Á
->
•hem”®_·ge_li¡
,
us
.
ş›Á_•h_·ges
)

1366 iàĞ
	`tmem_Œy_to_eviù_pgp
(
pgp
,&
hŞd_poŞ_rwlock
) )

1367 
found
;

1368 } iàĞ
	`li¡_em±y
(&
glob®_•hem”®_·ge_li¡
) ) {

1369 
out
;

1371 
	`li¡_fÜ_—ch_’Œy_§ã
(
pgp
,
pgp2
,&
glob®_•hem”®_·ge_li¡
,
glob®_•h_·ges
)

1372 iàĞ
	`tmem_Œy_to_eviù_pgp
(
pgp
,&
hŞd_poŞ_rwlock
) )

1373 
found
;

1376 
»t
 = 0;

1377 
out
;

1379 
found
:

1380 
	`ASSERT
(
pgp
 !ğ
NULL
);

1381 
	`ASSERT_SENTINEL
(
pgp
,
PGD
);

1382 
obj
 = 
pgp
->
us
.obj;

1383 
	`ASSERT
(
obj
 !ğ
NULL
);

1384 
	`ASSERT
(
obj
->
no_eviù
 == 0);

1385 
	`ASSERT
(
obj
->
poŞ
 !ğ
NULL
);

1386 
	`ASSERT_SENTINEL
(
obj
,
OBJ
);

1387 
poŞ
 = 
obj
->pool;

1389 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

1390 
pgp_d–
 = 
	`pgp_d–‘e_äom_obj
(
obj
, 
pgp
->
šdex
);

1391 
	`ASSERT
(
pgp_d–
 =ğ
pgp
);

1392 iàĞ
	`tmh_dedup_’abËd
(è&& 
pgp
->
fœ¡by‹
 !ğ
NOT_SHAREABLE
 )

1394 
	`ASSERT
(
pgp
->
pcd
->
pgp_»f_couÁ
 =ğ1 ||…gp->
eviùiÚ_©‹m±ed
);

1395 
	`pcd_di§ssocŸ‹
(
pgp
,
poŞ
,1);

1397 
	`pgp_d–‘e
(
pgp
,1);

1398 iàĞ
obj
->
pgp_couÁ
 == 0 )

1400 
	`ASSERT_WRITELOCK
(&
poŞ
->
poŞ_rwlock
);

1401 
	`obj_ä“
(
obj
,0);

1404 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1405 iàĞ
hŞd_poŞ_rwlock
 )

1406 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1407 
eviùed_pgs
++;

1408 
»t
 = 1;

1410 
out
:

1411 
	`tmem_¥š_uÆock
(&
•h_li¡s_¥šlock
);

1412  
»t
;

1413 
	}
}

1415 
	$tmem_»lšquish_Åages
(
n
)

1417 
ava_·ges
 = 0;

1419  (
ava_·ges
 = 
	`tmh_ava_·ges
()è< 
n
 )

1421 iàĞ!
	`tmem_eviù
() )

1424 iàĞ
ava_·ges
 )

1425 
	`tmh_»Ëa£_ava_·ges_to_ho¡
();

1426  
ava_·ges
;

1427 
	}
}

1434 
šlše
 
	$tmem_’su»_ava_·ges
()

1436 
çed_eviù
 = 10;

1438  !
	`tmh_ä“_mb
() )

1440 iàĞ
	`tmem_eviù
() )

1442 iàĞ
çed_eviù
-- <= 0 )

1445 
	}
}

1449 
NOINLINE
 
	$do_tmem_put_com´ess
(
pgp_t
 *
pgp
, 
tmem_şi_mâ_t
 
cmâ
,

1450 *
cva
)

1452 *
d¡
, *
p
;

1453 
size_t
 
size
;

1454 
»t
 = 0;

1455 
	`DECL_LOCAL_CYC_COUNTER
(
com´ess
);

1457 
	`ASSERT
(
pgp
 !ğ
NULL
);

1458 
	`ASSERT
(
pgp
->
us
.
obj
 !ğ
NULL
);

1459 
	`ASSERT_SPINLOCK
(&
pgp
->
us
.
obj
->
obj_¥šlock
);

1460 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
 !ğ
NULL
);

1461 
	`ASSERT
(
pgp
->
us
.
obj
->
poŞ
->
ş›Á
 !ğ
NULL
);

1462 #ifdeà
__i386__


1463  -
ENOMEM
;

1466 iàĞ
pgp
->
på
 !ğ
NULL
 )

1467 
	`pgp_ä“_d©a
(
pgp
,…gp->
us
.
obj
->
poŞ
);

1468 
	`START_CYC_COUNTER
(
com´ess
);

1469 
»t
 = 
	`tmh_com´ess_äom_ş›Á
(
cmâ
, &
d¡
, &
size
, 
cva
);

1470 iàĞ(
»t
 =ğ-
EFAULT
) || (ret == 0) )

1471 
out
;

1472 iàĞ(
size
 =ğ0è|| (siz>ğ
	`tmem_sub·ge_maxsize
()) ) {

1473 
»t
 = 0;

1474 
out
;

1475 } iàĞ
	`tmh_dedup_’abËd
(è&& !
	`is_³rsi¡’t
(
pgp
->
us
.
obj
->
poŞ
) ) {

1476 iàĞ(
»t
 = 
	`pcd_assocŸ‹
(
pgp
,
d¡
,
size
)è=ğ-
ENOMEM
 )

1477 
out
;

1478 } iàĞ(
p
 = 
	`tmem_m®loc_by‹s
(
size
,
pgp
->
us
.
obj
->
poŞ
)è=ğ
NULL
 ) {

1479 
»t
 = -
ENOMEM
;

1480 
out
;

1482 
	`memıy
(
p
,
d¡
,
size
);

1483 
pgp
->
cd©a
 = 
p
;

1485 
pgp
->
size
 = size;

1486 
pgp
->
us
.
obj
->
poŞ
->
ş›Á
->
com´es£d_·ges
++;

1487 
pgp
->
us
.
obj
->
poŞ
->
ş›Á
->
com´es£d_sum_size
 +ğ
size
;

1488 
»t
 = 1;

1490 
out
:

1491 
	`END_CYC_COUNTER
(
com´ess
);

1492  
»t
;

1493 
	}
}

1495 
NOINLINE
 
	$do_tmem_dup_put
(
pgp_t
 *
pgp
, 
tmem_şi_mâ_t
 
cmâ
,

1496 
·gesize_t
 
tmem_off£t
,…agesize_ˆ
pâ_off£t
,…agesize_ˆ
Ën
, *
cva
)

1498 
poŞ_t
 *
poŞ
;

1499 
obj_t
 *
obj
;

1500 
ş›Á_t
 *
ş›Á
;

1501 
pgp_t
 *
pgpfound
 = 
NULL
;

1502 
»t
;

1504 
	`ASSERT
(
pgp
 !ğ
NULL
);

1505 
	`ASSERT
(
pgp
->
på
 !ğ
NULL
);

1506 
	`ASSERT
(
pgp
->
size
 != -1);

1507 
obj
 = 
pgp
->
us
.obj;

1508 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

1509 
	`ASSERT
(
obj
 !ğ
NULL
);

1510 
poŞ
 = 
obj
->pool;

1511 
	`ASSERT
(
poŞ
 !ğ
NULL
);

1512 
ş›Á
 = 
poŞ
->client;

1513 iàĞ
ş›Á
->
live_mig¿tšg
 )

1514 
çed_dup
;

1516 iàĞ
Ën
 !ğ0 && 
ş›Á
->
com´ess
 && 
pgp
->
size
 != 0 )

1518 
»t
 = 
	`do_tmem_put_com´ess
(
pgp
,
cmâ
,
cva
);

1519 iàĞ
»t
 == 1 )

1520 
dÚe
;

1521 iàĞ
»t
 == 0 )

1522 
cİy_uncom´es£d
;

1523 iàĞ
»t
 =ğ-
ENOMEM
 )

1524 
çed_dup
;

1525 iàĞ
»t
 =ğ-
EFAULT
 )

1526 
bad_cİy
;

1529 
cİy_uncom´es£d
:

1530 iàĞ
pgp
->
på
 )

1531 
	`pgp_ä“_d©a
(
pgp
, 
poŞ
);

1532 iàĞĞ
pgp
->
på
 = 
	`tmem_·ge_®loc
(
poŞ
èè=ğ
NULL
 )

1533 
çed_dup
;

1534 
pgp
->
size
 = 0;

1536 
»t
 = 
	`tmh_cİy_äom_ş›Á
(
pgp
->
på
,
cmâ
,
tmem_off£t
,
pâ_off£t
,
Ën
,0);

1537 iàĞ
»t
 =ğ-
EFAULT
 )

1538 
bad_cİy
;

1539 iàĞ
	`tmh_dedup_’abËd
(è&& !
	`is_³rsi¡’t
(
poŞ
) )

1541 iàĞ
	`pcd_assocŸ‹
(
pgp
,
NULL
,0è=ğ-
ENOMEM
 )

1542 
çed_dup
;

1545 
dÚe
:

1547 iàĞ
	`is_sh¬ed
(
poŞ
) )

1548 
obj
->
Ï¡_ş›Á
 = 
ş›Á
->
şi_id
;

1549 
obj
->
no_eviù
 = 0;

1550 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1551 
poŞ
->
dup_puts_»¶aûd
++;

1552 
poŞ
->
good_puts
++;

1553 iàĞ
	`is_³rsi¡’t
(
poŞ
) )

1554 
ş›Á
->
succ_³rs_puts
++;

1557 
bad_cİy
:

1559 
çed_cİ›s
++;

1560 
»t
 = -
EFAULT
;

1561 
ş—nup
;

1563 
çed_dup
:

1566 
»t
 = -
ENOSPC
;

1567 
ş—nup
:

1568 
pgpfound
 = 
	`pgp_d–‘e_äom_obj
(
obj
, 
pgp
->
šdex
);

1569 
	`ASSERT
(
pgpfound
 =ğ
pgp
);

1570 
	`pgp_d–‘e
(
pgpfound
,0);

1571 iàĞ
obj
->
pgp_couÁ
 == 0 )

1573 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1574 
	`obj_ä“
(
obj
,0);

1575 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1577 
obj
->
no_eviù
 = 0;

1578 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1580 
poŞ
->
dup_puts_æushed
++;

1581  
»t
;

1582 
	}
}

1585 
NOINLINE
 
	$do_tmem_put
(
poŞ_t
 *
poŞ
,

1586 
OID
 *
oidp
, 
ušt32_t
 
šdex
,

1587 
tmem_şi_mâ_t
 
cmâ
, 
·gesize_t
 
tmem_off£t
,

1588 
·gesize_t
 
pâ_off£t
,…agesize_ˆ
Ën
, *
cva
)

1590 
obj_t
 *
obj
 = 
NULL
, *
objfound
 = NULL, *
objÃw
 = NULL;

1591 
pgp_t
 *
pgp
 = 
NULL
, *
pgpd–
 = NULL;

1592 
ş›Á_t
 *
ş›Á
 = 
poŞ
->client;

1593 
»t
 = 
ş›Á
->
äoz’
 ? -
EFROZEN
 : -
ENOMEM
;

1595 
	`ASSERT
(
poŞ
 !ğ
NULL
);

1596 
poŞ
->
puts
++;

1598 iàĞ(
obj
 = 
objfound
 = 
	`obj_fšd
(
poŞ
,
oidp
)è!ğ
NULL
 )

1600 
	`ASSERT_SPINLOCK
(&
objfound
->
obj_¥šlock
);

1601 ià((
pgp
 = 
	`pgp_lookup_š_obj
(
objfound
, 
šdex
)è!ğ
NULL
)

1602  
	`do_tmem_dup_put
(
pgp
,
cmâ
,
tmem_off£t
,
pâ_off£t
,
Ën
,
cva
);

1606 iàĞ
ş›Á
->
äoz’
 )

1607 
ä“
;

1609 iàĞ(
objfound
 =ğ
NULL
) )

1611 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1612 iàĞ(
obj
 = 
objÃw
 = 
	`obj_Ãw
(
poŞ
,
oidp
)è=ğ
NULL
 )

1614 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1615  -
ENOMEM
;

1617 
	`ASSERT_SPINLOCK
(&
objÃw
->
obj_¥šlock
);

1618 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1621 
	`ASSERT
((
obj
 !ğ
NULL
)&&((
objÃw
==obj)||(
objfound
==obj))&&(objnew!=objfound));

1622 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

1623 iàĞ(
pgp
 = 
	`pgp_®loc
(
obj
)è=ğ
NULL
 )

1624 
ä“
;

1626 
»t
 = 
	`pgp_add_to_obj
(
obj
, 
šdex
, 
pgp
);

1627 iàĞ
»t
 =ğ-
ENOMEM
 )

1629 
ä“
;

1630 
	`ASSERT
(
»t
 !ğ-
EEXIST
);

1631 
pgp
->
šdex
 = index;

1632 
pgp
->
size
 = 0;

1634 iàĞ
Ën
 !ğ0 && 
ş›Á
->
com´ess
 )

1636 
	`ASSERT
(
pgp
->
på
 =ğ
NULL
);

1637 
»t
 = 
	`do_tmem_put_com´ess
(
pgp
,
cmâ
,
cva
);

1638 iàĞ
»t
 == 1 )

1639 
š£¹_·ge
;

1640 iàĞ
»t
 =ğ-
ENOMEM
 )

1642 
ş›Á
->
com´ess_nomem
++;

1643 
d–‘e_ªd_ä“
;

1645 iàĞ
»t
 == 0 )

1647 
ş›Á
->
com´ess_poÜ
++;

1648 
cİy_uncom´es£d
;

1650 iàĞ
»t
 =ğ-
EFAULT
 )

1651 
bad_cİy
;

1654 
cİy_uncom´es£d
:

1655 iàĞĞ
pgp
->
på
 = 
	`tmem_·ge_®loc
(
poŞ
èè=ğ
NULL
 )

1657 
»t
 = -
ENOMEM
;

1658 
d–‘e_ªd_ä“
;

1661 
»t
 = 
	`tmh_cİy_äom_ş›Á
(
pgp
->
på
,
cmâ
,
tmem_off£t
,
pâ_off£t
,
Ën
,
cva
);

1662 iàĞ
»t
 =ğ-
EFAULT
 )

1663 
bad_cİy
;

1664 iàĞ
	`tmh_dedup_’abËd
(è&& !
	`is_³rsi¡’t
(
poŞ
) )

1666 iàĞ
	`pcd_assocŸ‹
(
pgp
,
NULL
,0è=ğ-
ENOMEM
 )

1667 
d–‘e_ªd_ä“
;

1670 
š£¹_·ge
:

1671 iàĞ
	`is_•hem”®
(
poŞ
) )

1673 
	`tmem_¥š_lock
(&
•h_li¡s_¥šlock
);

1674 
	`li¡_add_
(&
pgp
->
glob®_•h_·ges
,

1675 &
glob®_•hem”®_·ge_li¡
);

1676 ià(++
glob®_•h_couÁ
 > 
glob®_•h_couÁ_max
)

1677 
glob®_•h_couÁ_max
 = 
glob®_•h_couÁ
;

1678 
	`li¡_add_
(&
pgp
->
us
.
ş›Á_•h_·ges
,

1679 &
ş›Á
->
•hem”®_·ge_li¡
);

1680 ià(++
ş›Á
->
•h_couÁ
 > cl›Á->
•h_couÁ_max
)

1681 
ş›Á
->
•h_couÁ_max
 = cl›Á->
•h_couÁ
;

1682 
	`tmem_¥š_uÆock
(&
•h_li¡s_¥šlock
);

1684 
	`tmem_¥š_lock
(&
³rs_li¡s_¥šlock
);

1685 
	`li¡_add_
(&
pgp
->
us
.
poŞ_³rs_·ges
,

1686 &
poŞ
->
³rsi¡’t_·ge_li¡
);

1687 
	`tmem_¥š_uÆock
(&
³rs_li¡s_¥šlock
);

1689 
	`ASSERT
Ğ((
objÃw
==
obj
)||(
objfound
==obj)) && (objnew!=objfound));

1690 iàĞ
	`is_sh¬ed
(
poŞ
) )

1691 
obj
->
Ï¡_ş›Á
 = 
ş›Á
->
şi_id
;

1692 
obj
->
no_eviù
 = 0;

1693 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1694 
poŞ
->
good_puts
++;

1695 iàĞ
	`is_³rsi¡’t
(
poŞ
) )

1696 
ş›Á
->
succ_³rs_puts
++;

1698 
tÙ_good_•h_puts
++;

1701 
bad_cİy
:

1703 
»t
 = -
EFAULT
;

1704 
çed_cİ›s
++;

1706 
d–‘e_ªd_ä“
:

1707 
	`ASSERT
((
obj
 !ğ
NULL
è&& (
pgp
 !ğNULLè&& (pgp->
šdex
 != -1));

1708 
pgpd–
 = 
	`pgp_d–‘e_äom_obj
(
obj
, 
pgp
->
šdex
);

1709 
	`ASSERT
(
pgp
 =ğ
pgpd–
);

1711 
ä“
:

1712 iàĞ
pgp
 )

1713 
	`pgp_d–‘e
(
pgp
,0);

1714 iàĞ
objfound
 )

1716 
objfound
->
no_eviù
 = 0;

1717 
	`tmem_¥š_uÆock
(&
objfound
->
obj_¥šlock
);

1719 iàĞ
objÃw
 )

1721 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1722 
	`obj_ä“
(
objÃw
,0);

1723 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1725 
poŞ
->
no_mem_puts
++;

1726  
»t
;

1727 
	}
}

1729 
NOINLINE
 
	$do_tmem_g‘
(
poŞ_t
 *
poŞ
, 
OID
 *
oidp
, 
ušt32_t
 
šdex
,

1730 
tmem_şi_mâ_t
 
cmâ
, 
·gesize_t
 
tmem_off£t
,

1731 
·gesize_t
 
pâ_off£t
,…agesize_ˆ
Ën
, *
cva
)

1733 
obj_t
 *
obj
;

1734 
pgp_t
 *
pgp
;

1735 
ş›Á_t
 *
ş›Á
 = 
poŞ
->client;

1736 
	`DECL_LOCAL_CYC_COUNTER
(
decom´ess
);

1738 iàĞ!
	`_©omic_»ad
(
poŞ
->
pgp_couÁ
) )

1739  -
EEMPTY
;

1741 
poŞ
->
g‘s
++;

1742 
obj
 = 
	`obj_fšd
(
poŞ
,
oidp
);

1743 iàĞ
obj
 =ğ
NULL
 )

1746 
	`ASSERT_SPINLOCK
(&
obj
->
obj_¥šlock
);

1747 ià(
	`is_sh¬ed
(
poŞ
è|| 
	`is_³rsi¡’t
(pool) )

1748 
pgp
 = 
	`pgp_lookup_š_obj
(
obj
, 
šdex
);

1750 
pgp
 = 
	`pgp_d–‘e_äom_obj
(
obj
, 
šdex
);

1751 iàĞ
pgp
 =ğ
NULL
 )

1753 
obj
->
no_eviù
 = 0;

1754 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1757 
	`ASSERT
(
pgp
->
size
 != -1);

1758 iàĞ
	`tmh_dedup_’abËd
(è&& !
	`is_³rsi¡’t
(
poŞ
) &&

1759 
pgp
->
fœ¡by‹
 !ğ
NOT_SHAREABLE
 )

1761 iàĞ
	`pcd_cİy_to_ş›Á
(
cmâ
, 
pgp
è=ğ-
EFAULT
 )

1762 
bad_cİy
;

1763 } iàĞ
pgp
->
size
 != 0 ) {

1764 
	`START_CYC_COUNTER
(
decom´ess
);

1765 iàĞ
	`tmh_decom´ess_to_ş›Á
(
cmâ
, 
pgp
->
cd©a
,

1766 
pgp
->
size
, 
cva
è=ğ-
EFAULT
 )

1767 
bad_cİy
;

1768 
	`END_CYC_COUNTER
(
decom´ess
);

1769 } iàĞ
	`tmh_cİy_to_ş›Á
(
cmâ
, 
pgp
->
på
, 
tmem_off£t
,

1770 
pâ_off£t
, 
Ën
, 
cva
è=ğ-
EFAULT
)

1771 
bad_cİy
;

1772 iàĞ
	`is_•hem”®
(
poŞ
) )

1774 iàĞ
	`is_´iv©e
(
poŞ
) )

1776 
	`pgp_d–‘e
(
pgp
,0);

1777 iàĞ
obj
->
pgp_couÁ
 == 0 )

1779 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1780 
	`obj_ä“
(
obj
,0);

1781 
obj
 = 
NULL
;

1782 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1785 
	`tmem_¥š_lock
(&
•h_li¡s_¥šlock
);

1786 
	`li¡_d–
(&
pgp
->
glob®_•h_·ges
);

1787 
	`li¡_add_
(&
pgp
->
glob®_•h_·ges
,&
glob®_•hem”®_·ge_li¡
);

1788 
	`li¡_d–
(&
pgp
->
us
.
ş›Á_•h_·ges
);

1789 
	`li¡_add_
(&
pgp
->
us
.
ş›Á_•h_·ges
,&
ş›Á
->
•hem”®_·ge_li¡
);

1790 
	`tmem_¥š_uÆock
(&
•h_li¡s_¥šlock
);

1791 
	`ASSERT
(
obj
 !ğ
NULL
);

1792 
obj
->
Ï¡_ş›Á
 = 
	`tmh_g‘_şi_id_äom_cu¼’t
();

1795 iàĞ
obj
 !ğ
NULL
 )

1797 
obj
->
no_eviù
 = 0;

1798 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1800 
poŞ
->
found_g‘s
++;

1801 iàĞ
	`is_•hem”®
(
poŞ
) )

1802 
ş›Á
->
succ_•h_g‘s
++;

1804 
ş›Á
->
succ_³rs_g‘s
++;

1807 
bad_cİy
:

1809 
çed_cİ›s
++;

1810  -
EFAULT
;

1812 
	}
}

1814 
NOINLINE
 
	$do_tmem_æush_·ge
(
poŞ_t
 *
poŞ
, 
OID
 *
oidp
, 
ušt32_t
 
šdex
)

1816 
obj_t
 *
obj
;

1817 
pgp_t
 *
pgp
;

1819 
poŞ
->
æushs
++;

1820 
obj
 = 
	`obj_fšd
(
poŞ
,
oidp
);

1821 iàĞ
obj
 =ğ
NULL
 )

1822 
out
;

1823 
pgp
 = 
	`pgp_d–‘e_äom_obj
(
obj
, 
šdex
);

1824 iàĞ
pgp
 =ğ
NULL
 )

1826 
obj
->
no_eviù
 = 0;

1827 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1828 
out
;

1830 
	`pgp_d–‘e
(
pgp
,0);

1831 iàĞ
obj
->
pgp_couÁ
 == 0 )

1833 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1834 
	`obj_ä“
(
obj
,0);

1835 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1837 
obj
->
no_eviù
 = 0;

1838 
	`tmem_¥š_uÆock
(&
obj
->
obj_¥šlock
);

1840 
poŞ
->
æushs_found
++;

1842 
out
:

1843 iàĞ
poŞ
->
ş›Á
->
äoz’
 )

1844  -
EFROZEN
;

1847 
	}
}

1849 
NOINLINE
 
	$do_tmem_æush_objeù
(
poŞ_t
 *
poŞ
, 
OID
 *
oidp
)

1851 
obj_t
 *
obj
;

1853 
poŞ
->
æush_objs
++;

1854 
obj
 = 
	`obj_fšd
(
poŞ
,
oidp
);

1855 iàĞ
obj
 =ğ
NULL
 )

1856 
out
;

1857 
	`tmem_wr™e_lock
(&
poŞ
->
poŞ_rwlock
);

1858 
	`obj_de¡roy
(
obj
,0);

1859 
poŞ
->
æush_objs_found
++;

1860 
	`tmem_wr™e_uÆock
(&
poŞ
->
poŞ_rwlock
);

1862 
out
:

1863 iàĞ
poŞ
->
ş›Á
->
äoz’
 )

1864  -
EFROZEN
;

1867 
	}
}

1869 
NOINLINE
 
	$do_tmem_de¡roy_poŞ
(
ušt32_t
 
poŞ_id
)

1871 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_cu¼’t
();

1872 
poŞ_t
 *
poŞ
;

1874 iàĞ
ş›Á
->
poŞs
 =ğ
NULL
 )

1876 iàĞ(
poŞ
 = 
ş›Á
->
poŞs
[
poŞ_id
]è=ğ
NULL
 )

1878 
ş›Á
->
poŞs
[
poŞ_id
] = 
NULL
;

1879 
	`poŞ_æush
(
poŞ
,
ş›Á
->
şi_id
,1);

1881 
	}
}

1883 
NOINLINE
 
	$do_tmem_Ãw_poŞ
(
şi_id_t
 
this_şi_id
,

1884 
ušt32_t
 
d_poŞid
, ušt32_ˆ
æags
,

1885 
ušt64_t
 
uuid_lo
, ušt64_ˆ
uuid_hi
)

1887 
ş›Á_t
 *
ş›Á
;

1888 
şi_id_t
 
şi_id
;

1889 
³rsi¡’t
 = 
æags
 & 
TMEM_POOL_PERSIST
;

1890 
sh¬ed
 = 
æags
 & 
TMEM_POOL_SHARED
;

1891 
·geb™s
 = (
æags
 >> 
TMEM_POOL_PAGESIZE_SHIFT
)

1892 & 
TMEM_POOL_PAGESIZE_MASK
;

1893 
¥ecv”siÚ
 = (
æags
 >> 
TMEM_POOL_VERSION_SHIFT
)

1894 & 
TMEM_POOL_VERSION_MASK
;

1895 
poŞ_t
 *
poŞ
, *
shpoŞ
;

1896 
s_poŞid
, 
fœ¡_unu£d_s_poŞid
;

1897 
i
;

1899 iàĞ
this_şi_id
 =ğ
CLI_ID_NULL
 )

1900 
şi_id
 = 
	`tmh_g‘_şi_id_äom_cu¼’t
();

1902 
şi_id
 = 
this_şi_id
;

1903 
	`´štk
("tmem:‡llocating %s-%smem…ool for %s=%d...",

1904 
³rsi¡’t
 ? "persistent" : "ephemeral" ,

1905 
sh¬ed
 ? "sh¬ed" : "´iv©e", 
şi_id_¡r
, 
şi_id
);

1906 iàĞ
¥ecv”siÚ
 !ğ
TMEM_SPEC_VERSION
 )

1908 
	`´štk
("failed... unsupported spec version\n");

1909  -
EPERM
;

1911 iàĞ
·geb™s
 !ğ(
PAGE_SHIFT
 - 12) )

1913 
	`´štk
("çed... unsuµÜ‹d…agesiz%d\n",1<<(
·geb™s
+12));

1914  -
EPERM
;

1916 iàĞ
æags
 & 
TMEM_POOL_PRECOMPRESSED
 )

1918 
	`´štk
("failed...…recompression flag set but unsupported\n");

1919  -
EPERM
;

1921 iàĞ
æags
 & 
TMEM_POOL_RESERVED_BITS
 )

1923 
	`´štk
("failed...„eserved bits must be zero\n");

1924  -
EPERM
;

1926 iàĞ(
poŞ
 = 
	`poŞ_®loc
()è=ğ
NULL
 )

1928 
	`´štk
("failed... out of memory\n");

1929  -
ENOMEM
;

1931 iàĞ
this_şi_id
 !ğ
CLI_ID_NULL
 )

1933 iàĞ(
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
this_şi_id
)è=ğ
NULL


1934 || 
d_poŞid
 >ğ
MAX_POOLS_PER_DOMAIN


1935 || 
ş›Á
->
poŞs
[
d_poŞid
] !ğ
NULL
 )

1936 
ç
;

1940 
ş›Á
 = 
	`tmh_ş›Á_äom_cu¼’t
();

1941 
	`ASSERT
(
ş›Á
 !ğ
NULL
);

1942  
d_poŞid
 = 0; d_poŞid < 
MAX_POOLS_PER_DOMAIN
; d_poolid++ )

1943 iàĞ
ş›Á
->
poŞs
[
d_poŞid
] =ğ
NULL
 )

1945 iàĞ
d_poŞid
 >ğ
MAX_POOLS_PER_DOMAIN
 )

1947 
	`´štk
("failed...‚o more…ool slots‡vailable forhis %s\n",

1948 
ş›Á_¡r
);

1949 
ç
;

1952 iàĞ
sh¬ed
 )

1954 iàĞ
uuid_lo
 =ğ-1L && 
uuid_hi
 == -1L )

1955 
sh¬ed
 = 0;

1956 iàĞ
ş›Á
->
sh¬ed_auth_»quœed
 && !
glob®_sh¬ed_auth
 )

1958  
i
 = 0; i < 
MAX_GLOBAL_SHARED_POOLS
; i++)

1959 iàĞ(
ş›Á
->
sh¬ed_auth_uuid
[
i
][0] =ğ
uuid_lo
) &&

1960 (
ş›Á
->
sh¬ed_auth_uuid
[
i
][1] =ğ
uuid_hi
) )

1962 iàĞ
i
 =ğ
MAX_GLOBAL_SHARED_POOLS
 )

1963 
sh¬ed
 = 0;

1966 
poŞ
->
sh¬ed
 = shared;

1967 
poŞ
->
ş›Á
 = client;

1968 iàĞ
sh¬ed
 )

1970 
fœ¡_unu£d_s_poŞid
 = 
MAX_GLOBAL_SHARED_POOLS
;

1971  
s_poŞid
 = 0; s_poŞid < 
MAX_GLOBAL_SHARED_POOLS
; s_poolid++ )

1973 iàĞ(
shpoŞ
 = 
glob®_sh¬ed_poŞs
[
s_poŞid
]è!ğ
NULL
 )

1975 iàĞ
shpoŞ
->
uuid
[0] =ğ
uuid_lo
 && shpoŞ->uuid[1] =ğ
uuid_hi
 )

1977 
	`´štk
("(m©che sh¬ed…oŞ uuid=%"
PRIx64
".%"PRIx64") ",

1978 
uuid_hi
, 
uuid_lo
);

1979 
	`´štk
("poŞ_id=%d\n",
d_poŞid
);

1980 
ş›Á
->
poŞs
[
d_poŞid
] = 
glob®_sh¬ed_poŞs
[
s_poŞid
];

1981 
	`sh¬ed_poŞ_još
(
glob®_sh¬ed_poŞs
[
s_poŞid
], 
ş›Á
);

1982 
	`poŞ_ä“
(
poŞ
);

1983  
d_poŞid
;

1986 iàĞ
fœ¡_unu£d_s_poŞid
 =ğ
MAX_GLOBAL_SHARED_POOLS
 )

1987 
fœ¡_unu£d_s_poŞid
 = 
s_poŞid
;

1989 iàĞ
fœ¡_unu£d_s_poŞid
 =ğ
MAX_GLOBAL_SHARED_POOLS
 )

1991 
	`´štk
("tmem: failed...‚o global shared…ool slots‡vailable\n");

1992 
ç
;

1996 
	`INIT_LIST_HEAD
(&
poŞ
->
sh¬e_li¡
);

1997 
poŞ
->
sh¬ed_couÁ
 = 0;

1998 
glob®_sh¬ed_poŞs
[
fœ¡_unu£d_s_poŞid
] = 
poŞ
;

1999 ()
	`sh¬ed_poŞ_još
(
poŞ
,
ş›Á
);

2002 
ş›Á
->
poŞs
[
d_poŞid
] = 
poŞ
;

2003 
	`li¡_add_
(&
poŞ
->
poŞ_li¡
, &
glob®_poŞ_li¡
);

2004 
poŞ
->
poŞ_id
 = 
d_poŞid
;

2005 
poŞ
->
³rsi¡’t
 =…ersistent;

2006 
poŞ
->
uuid
[0] = 
uuid_lo
;…oŞ->uuid[1] = 
uuid_hi
;

2007 
	`´štk
("poŞ_id=%d\n",
d_poŞid
);

2008  
d_poŞid
;

2010 
ç
:

2011 
	`poŞ_ä“
(
poŞ
);

2012  -
EPERM
;

2013 
	}
}

2018 
	$tmemc_ä“ze_poŞs
(
şi_id_t
 
şi_id
, 
¬g
)

2020 
ş›Á_t
 *
ş›Á
;

2021 
boŞ_t
 
ä“ze
 = (
¬g
 =ğ
TMEMC_FREEZE
) ? 1 : 0;

2022 
boŞ_t
 
de¡roy
 = (
¬g
 =ğ
TMEMC_DESTROY
) ? 1 : 0;

2023 *
s
;

2025 
s
 = 
de¡roy
 ? "de¡royed" : ( 
ä“ze
 ? "frozen" : "thawed" );

2026 iàĞ
şi_id
 =ğ
CLI_ID_NULL
 )

2028 
	`li¡_fÜ_—ch_’Œy
(
ş›Á
,&
glob®_ş›Á_li¡
,
ş›Á_li¡
)

2029 
	`ş›Á_ä“ze
(
ş›Á
,
ä“ze
);

2030 
	`´štk
("tmem:‡Î…oŞ % fÜ‡Î %ss\n",
s
,
ş›Á_¡r
);

2034 iàĞ(
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
)è=ğ
NULL
)

2036 
	`ş›Á_ä“ze
(
ş›Á
,
ä“ze
);

2037 
	`´štk
("tmem:‡Î…oŞ % fÜ %s=%d\n",
s
,
şi_id_¡r
,
şi_id
);

2040 
	}
}

2042 
	$tmemc_æush_mem
(
şi_id_t
 
şi_id
, 
ušt32_t
 
kb
)

2044 
ušt32_t
 
Åages
, 
æushed_·ges
, 
æushed_kb
;

2046 iàĞ
şi_id
 !ğ
CLI_ID_NULL
 )

2048 
	`´štk
("tmem: %s-specific flush‚ot supported yet, use --all\n",

2049 
ş›Á_¡r
);

2053 
Åages
 = (
kb
 + ((1 << (
PAGE_SHIFT
-10))-1)) >> (PAGE_SHIFT-10);

2054 
æushed_·ges
 = 
	`tmem_»lšquish_Åages
(
Åages
);

2055 
æushed_kb
 = 
æushed_·ges
 << (
PAGE_SHIFT
-10);

2056  
æushed_kb
;

2057 
	}
}

2068 
	#BSIZE
 1024

	)

2070 
	$tmemc_li¡_ş›Á
(
ş›Á_t
 *
c
, 
tmem_şi_va_t
 
buf
, 
off
,

2071 
ušt32_t
 
Ën
, 
boŞ_t
 
u£_lÚg
)

2073 
šfo
[
BSIZE
];

2074 
i
, 
n
 = 0, 
sum
 = 0;

2075 
poŞ_t
 *
p
;

2076 
boŞ_t
 
s
;

2078 
n
 = 
	`sú´štf
(
šfo
,
BSIZE
,"C=CI:%d,ww:%d,ca:%d,co:%d,fr:%d,"

2079 "Tc:%"
PRIu64
",Ge:%ld,Pp:%ld,Gp:%ld%c",

2080 
c
->
şi_id
, c->
weight
, c->
ÿp
, c->
com´ess
, c->
äoz’
,

2081 
c
->
tÙ®_cyşes
, c->
succ_•h_g‘s
, c->
succ_³rs_puts
, c->
succ_³rs_g‘s
,

2082 
u£_lÚg
 ? ',' : '\n');

2083 ià(
u£_lÚg
)

2084 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,

2085 "Ec:%ld,Em:%ld,ı:%ld,cb:%"
PRId64
",cn:%ld,cm:%ld\n",

2086 
c
->
•h_couÁ
, c->
•h_couÁ_max
,

2087 
c
->
com´es£d_·ges
, c->
com´es£d_sum_size
,

2088 
c
->
com´ess_poÜ
, c->
com´ess_nomem
);

2089 
	`tmh_cİy_to_ş›Á_buf_off£t
(
buf
,
off
+
sum
,
šfo
,
n
+1);

2090 
sum
 +ğ
n
;

2091  
i
 = 0; i < 
MAX_POOLS_PER_DOMAIN
; i++ )

2093 iàĞ(
p
 = 
c
->
poŞs
[
i
]è=ğ
NULL
 )

2095 
s
 = 
	`is_sh¬ed
(
p
);

2096 
n
 = 
	`sú´štf
(
šfo
,
BSIZE
,"P=CI:%d,PI:%d,"

2097 "PT:%c%c,U0:%"
PRIx64
",U1:%"PRIx64"%c",

2098 
c
->
şi_id
, 
p
->
poŞ_id
,

2099 
	`is_³rsi¡’t
(
p
è? 'P' : 'E', 
s
 ? 'S' : 'P',

2100 (
ušt64_t
)(
s
 ? 
p
->
uuid
[0] : 0),

2101 (
ušt64_t
)(
s
 ? 
p
->
uuid
[1] : 0LL),

2102 
u£_lÚg
 ? ',' : '\n');

2103 ià(
u£_lÚg
)

2104 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,

2108 
	`_©omic_»ad
(
p
->
pgp_couÁ
),…->
pgp_couÁ_max
,

2109 
p
->
obj_couÁ
,…->
obj_couÁ_max
,

2110 
p
->
objnode_couÁ
,…->
objnode_couÁ_max
,

2111 
p
->
good_puts
,…->
puts
,p->
dup_puts_æushed
,…->
dup_puts_»¶aûd
,

2112 
p
->
no_mem_puts
,

2113 
p
->
found_g‘s
,…->
g‘s
,

2114 
p
->
æushs_found
,…->
æushs
,…->
æush_objs_found
,…->
æush_objs
);

2115 iàĞ
sum
 + 
n
 >ğ
Ën
 )

2116  
sum
;

2117 
	`tmh_cİy_to_ş›Á_buf_off£t
(
buf
,
off
+
sum
,
šfo
,
n
+1);

2118 
sum
 +ğ
n
;

2120  
sum
;

2121 
	}
}

2123 
	$tmemc_li¡_sh¬ed
(
tmem_şi_va_t
 
buf
, 
off
, 
ušt32_t
 
Ën
,

2124 
boŞ_t
 
u£_lÚg
)

2126 
šfo
[
BSIZE
];

2127 
i
, 
n
 = 0, 
sum
 = 0;

2128 
poŞ_t
 *
p
;

2129 
sh¬–i¡_t
 *
¦
;

2131  
i
 = 0; i < 
MAX_GLOBAL_SHARED_POOLS
; i++ )

2133 iàĞ(
p
 = 
glob®_sh¬ed_poŞs
[
i
]è=ğ
NULL
 )

2135 
n
 = 
	`sú´štf
(
šfo
+n,
BSIZE
-n,"S=SI:%d,PT:%c%c,U0:%"
PRIx64
",U1:%"PRIx64,

2136 
i
, 
	`is_³rsi¡’t
(
p
) ? 'P' : 'E',

2137 
	`is_sh¬ed
(
p
) ? 'S' : 'P',

2138 
p
->
uuid
[0],…->uuid[1]);

2139 
	`li¡_fÜ_—ch_’Œy
(
¦
,&
p
->
sh¬e_li¡
, share_list)

2140 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,",SC:%d",
¦
->
ş›Á
->
şi_id
);

2141 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,"%c", 
u£_lÚg
 ? ',' : '\n');

2142 ià(
u£_lÚg
)

2143 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,

2147 
	`_©omic_»ad
(
p
->
pgp_couÁ
),…->
pgp_couÁ_max
,

2148 
p
->
obj_couÁ
,…->
obj_couÁ_max
,

2149 
p
->
objnode_couÁ
,…->
objnode_couÁ_max
,

2150 
p
->
good_puts
,…->
puts
,p->
dup_puts_æushed
,…->
dup_puts_»¶aûd
,

2151 
p
->
no_mem_puts
,

2152 
p
->
found_g‘s
,…->
g‘s
,

2153 
p
->
æushs_found
,…->
æushs
,…->
æush_objs_found
,…->
æush_objs
);

2154 iàĞ
sum
 + 
n
 >ğ
Ën
 )

2155  
sum
;

2156 
	`tmh_cİy_to_ş›Á_buf_off£t
(
buf
,
off
+
sum
,
šfo
,
n
+1);

2157 
sum
 +ğ
n
;

2159  
sum
;

2160 
	}
}

2162 #ifdeà
TMEM_PERF


2163 
	$tmemc_li¡_glob®_³rf
(
tmem_şi_va_t
 
buf
, 
off
, 
ušt32_t
 
Ën
,

2164 
boŞ_t
 
u£_lÚg
)

2166 
šfo
[
BSIZE
];

2167 
n
 = 0, 
sum
 = 0;

2169 
n
 = 
	`sú´štf
(
šfo
+n,
BSIZE
-n,"T=");

2170 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
succ_g‘
,"G");

2171 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
succ_put
,"P");

2172 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
nÚ_succ_g‘
,"g");

2173 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
nÚ_succ_put
,"p");

2174 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
æush
,"F");

2175 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
æush_obj
,"O");

2176 #ifdeà
COMPARE_COPY_PAGE_SSE2


2177 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
pg_cİy1
,"1");

2178 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
pg_cİy2
,"2");

2179 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
pg_cİy3
,"3");

2180 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
pg_cİy4
,"4");

2182 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
pg_cİy
,"C");

2184 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
com´ess
,"c");

2185 
n
 +ğ
	`SCNPRINTF_CYC_COUNTER
(
šfo
+n,
BSIZE
-n,
decom´ess
,"d");

2186 
n
--;

2187 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,"\n");

2188 iàĞ
sum
 + 
n
 >ğ
Ën
 )

2189  
sum
;

2190 
	`tmh_cİy_to_ş›Á_buf_off£t
(
buf
,
off
+
sum
,
šfo
,
n
+1);

2191 
sum
 +ğ
n
;

2192  
sum
;

2193 
	}
}

2195 
	#tmemc_li¡_glob®_³rf
(
_buf
,
_off
,
_Ën
,
_u£
è(0)

	)

2198 
	$tmemc_li¡_glob®
(
tmem_şi_va_t
 
buf
, 
off
, 
ušt32_t
 
Ën
,

2199 
boŞ_t
 
u£_lÚg
)

2201 
šfo
[
BSIZE
];

2202 
n
 = 0, 
sum
 = 
off
;

2204 
n
 +ğ
	`sú´štf
(
šfo
,
BSIZE
,"G="

2207 
tÙ®_tmem_İs
, 
”rÜed_tmem_İs
, 
çed_cİ›s
,

2208 
®loc_çed
, 
®loc_·ge_çed
, 
	`tmh_ava_·ges
(),

2209 
low_Ú_memÜy
, 
eviùed_pgs
,

2210 
eviù_©‹m±s
, 
»lšq_pgs
, 
»lšq_©‹m±s
, 
max_eviùs_³r_»lšq
,

2211 
tÙ®_æush_poŞ
, 
u£_lÚg
 ? ',' : '\n');

2212 ià(
u£_lÚg
)

2213 
n
 +ğ
	`sú´štf
(
šfo
+n,
BSIZE
-n,

2216 
glob®_•h_couÁ
, 
glob®_•h_couÁ_max
,

2217 
	`_©omic_»ad
(
glob®_obj_couÁ
), 
glob®_obj_couÁ_max
,

2218 
	`_©omic_»ad
(
glob®_¹»e_node_couÁ
), 
glob®_¹»e_node_couÁ_max
,

2219 
	`_©omic_»ad
(
glob®_pgp_couÁ
), 
glob®_pgp_couÁ_max
,

2220 
	`_©omic_»ad
(
glob®_·ge_couÁ
), 
glob®_·ge_couÁ_max
,

2221 
	`_©omic_»ad
(
glob®_pcd_couÁ
), 
glob®_pcd_couÁ_max
,

2222 
tÙ_good_•h_puts
,
dedu³d_puts
,
pcd_tÙ_tze_size
,
pcd_tÙ_csize
);

2223 iàĞ
sum
 + 
n
 >ğ
Ën
 )

2224  
sum
;

2225 
	`tmh_cİy_to_ş›Á_buf_off£t
(
buf
,
off
+
sum
,
šfo
,
n
+1);

2226 
sum
 +ğ
n
;

2227  
sum
;

2228 
	}
}

2230 
	$tmemc_li¡
(
şi_id_t
 
şi_id
, 
tmem_şi_va_t
 
buf
, 
ušt32_t
 
Ën
,

2231 
boŞ_t
 
u£_lÚg
)

2233 
ş›Á_t
 *
ş›Á
;

2234 
off
 = 0;

2236 iàĞ
şi_id
 =ğ
CLI_ID_NULL
 ) {

2237 
off
 = 
	`tmemc_li¡_glob®
(
buf
,0,
Ën
,
u£_lÚg
);

2238 
off
 +ğ
	`tmemc_li¡_sh¬ed
(
buf
,off,
Ën
-off,
u£_lÚg
);

2239 
	`li¡_fÜ_—ch_’Œy
(
ş›Á
,&
glob®_ş›Á_li¡
,
ş›Á_li¡
)

2240 
off
 +ğ
	`tmemc_li¡_ş›Á
(
ş›Á
, 
buf
, off, 
Ën
-off, 
u£_lÚg
);

2241 
off
 +ğ
	`tmemc_li¡_glob®_³rf
(
buf
,off,
Ën
-off,
u£_lÚg
);

2243 iàĞ(
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
)è=ğ
NULL
)

2246 
off
 = 
	`tmemc_li¡_ş›Á
(
ş›Á
, 
buf
, 0, 
Ën
, 
u£_lÚg
);

2249 
	}
}

2251 
	$tmemc_£t_v¬_Úe
(
ş›Á_t
 *
ş›Á
, 
ušt32_t
 
subİ
, ušt32_ˆ
¬g1
)

2253 
şi_id_t
 
şi_id
 = 
ş›Á
->cli_id;

2254 
ušt32_t
 
Şd_weight
;

2256 
subİ
)

2258 
TMEMC_SET_WEIGHT
:

2259 
Şd_weight
 = 
ş›Á
->
weight
;

2260 
ş›Á
->
weight
 = 
¬g1
;

2261 
	`´štk
("tmem: weighˆ£ˆtØ%d fÜ %s=%d\n",
¬g1
,
şi_id_¡r
,
şi_id
);

2262 
	`©omic_sub
(
Şd_weight
,&
ş›Á_weight_tÙ®
);

2263 
	`©omic_add
(
ş›Á
->
weight
,&
ş›Á_weight_tÙ®
);

2265 
TMEMC_SET_CAP
:

2266 
ş›Á
->
ÿp
 = 
¬g1
;

2267 
	`´štk
("tmem: c­ s‘Ø%d fÜ %s=%d\n",
¬g1
,
şi_id_¡r
,
şi_id
);

2269 
TMEMC_SET_COMPRESS
:

2270 #ifdeà
__i386__


2273 iàĞ
	`tmh_dedup_’abËd
() )

2275 
	`´štk
("tmem: compression %s for‡ll %ss, cannot be changed "

2277 
	`tmh_com´essiÚ_’abËd
(è? "’abËd" : "di§bËd",
ş›Á_¡r
);

2280 
ş›Á
->
com´ess
 = 
¬g1
 ? 1 : 0;

2281 
	`´štk
("tmem: compression %s for %s=%d\n",

2282 
¬g1
 ? "’abËd" : "di§bËd",
şi_id_¡r
,
şi_id
);

2285 
	`´štk
("tmem: unknowÀsubİ %d fÜmemc_£t_v¬\n",
subİ
);

2289 
	}
}

2291 
	$tmemc_£t_v¬
(
şi_id_t
 
şi_id
, 
ušt32_t
 
subİ
, ušt32_ˆ
¬g1
)

2293 
ş›Á_t
 *
ş›Á
;

2295 iàĞ
şi_id
 =ğ
CLI_ID_NULL
 )

2296 
	`li¡_fÜ_—ch_’Œy
(
ş›Á
,&
glob®_ş›Á_li¡
,
ş›Á_li¡
)

2297 
	`tmemc_£t_v¬_Úe
(
ş›Á
, 
subİ
, 
¬g1
);

2298 iàĞ(
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
)è=ğ
NULL
)

2301 
	`tmemc_£t_v¬_Úe
(
ş›Á
, 
subİ
, 
¬g1
);

2303 
	}
}

2305 
NOINLINE
 
	$tmemc_sh¬ed_poŞ_auth
(
şi_id_t
 
şi_id
, 
ušt64_t
 
uuid_lo
,

2306 
ušt64_t
 
uuid_hi
, 
boŞ_t
 
auth
)

2308 
ş›Á_t
 *
ş›Á
;

2309 
i
, 
ä“
 = -1;

2311 iàĞ
şi_id
 =ğ
CLI_ID_NULL
 )

2313 
glob®_sh¬ed_auth
 = 
auth
;

2316 
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
);

2317 iàĞ
ş›Á
 =ğ
NULL
 )

2318  -
EINVAL
;

2319  
i
 = 0; i < 
MAX_GLOBAL_SHARED_POOLS
; i++)

2321 iàĞ(
ş›Á
->
sh¬ed_auth_uuid
[
i
][0] =ğ
uuid_lo
) &&

2322 (
ş›Á
->
sh¬ed_auth_uuid
[
i
][1] =ğ
uuid_hi
) )

2324 iàĞ
auth
 == 0 )

2325 
ş›Á
->
sh¬ed_auth_uuid
[
i
][0] =

2326 
ş›Á
->
sh¬ed_auth_uuid
[
i
][1] = -1L;

2329 iàĞ(
auth
 =ğ1è&& (
ş›Á
->
sh¬ed_auth_uuid
[
i
][0] == -1L) &&

2330 (
ş›Á
->
sh¬ed_auth_uuid
[
i
][1] =ğ-1Lè&& (
ä“
 == -1) )

2331 
ä“
 = 
i
;

2333 iàĞ
auth
 == 0 )

2335 iàĞ
auth
 =ğ1 && 
ä“
 == -1 )

2336  -
ENOMEM
;

2337 
ş›Á
->
sh¬ed_auth_uuid
[
ä“
][0] = 
uuid_lo
;

2338 
ş›Á
->
sh¬ed_auth_uuid
[
ä“
][1] = 
uuid_hi
;

2340 
	}
}

2342 
NOINLINE
 
	$tmemc_§ve_subİ
(
şi_id
, 
ušt32_t
 
poŞ_id
,

2343 
ušt32_t
 
subİ
, 
tmem_şi_va_t
 
buf
, ušt32_ˆ
¬g1
)

2345 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
);

2346 
poŞ_t
 *
poŞ
 = (
ş›Á
 =ğ
NULL
 || 
poŞ_id
 >ğ
MAX_POOLS_PER_DOMAIN
)

2347 ? 
NULL
 : 
ş›Á
->
poŞs
[
poŞ_id
];

2348 
ušt32_t
 
p
;

2349 
ušt64_t
 *
uuid
;

2350 
pgp_t
 *
pgp
, *
pgp2
;

2351 
rc
 = -1;

2353 
subİ
)

2355 
TMEMC_SAVE_BEGIN
:

2356 iàĞ
ş›Á
 =ğ
NULL
 )

2358 
p
 = 0;… < 
MAX_POOLS_PER_DOMAIN
;…++)

2359 iàĞ
ş›Á
->
poŞs
[
p
] !ğ
NULL
 )

2361 iàĞ
p
 =ğ
MAX_POOLS_PER_DOMAIN
 )

2363 
rc
 = 0;

2366 
ş›Á
->
was_äoz’
 = cl›Á->
äoz’
;

2367 
ş›Á
->
äoz’
 = 1;

2368 iàĞ
¬g1
 != 0 )

2369 
ş›Á
->
live_mig¿tšg
 = 1;

2370 
rc
 = 1;

2372 
TMEMC_RESTORE_BEGIN
:

2373 iàĞ
ş›Á
 =ğ
NULL
 && (ş›Á = 
	`ş›Á_ü—‹
(
şi_id
)) != NULL )

2376 
TMEMC_SAVE_GET_VERSION
:

2377 
rc
 = 
TMEM_SPEC_VERSION
;

2379 
TMEMC_SAVE_GET_MAXPOOLS
:

2380 
rc
 = 
MAX_POOLS_PER_DOMAIN
;

2382 
TMEMC_SAVE_GET_CLIENT_WEIGHT
:

2383 
rc
 = 
ş›Á
->
weight
 == -1 ? -2 : client->weight;

2385 
TMEMC_SAVE_GET_CLIENT_CAP
:

2386 
rc
 = 
ş›Á
->
ÿp
 == -1 ? -2 : client->cap;

2388 
TMEMC_SAVE_GET_CLIENT_FLAGS
:

2389 
rc
 = (
ş›Á
->
com´ess
 ? 
TMEM_CLIENT_COMPRESS
 : 0 ) |

2390 (
ş›Á
->
was_äoz’
 ? 
TMEM_CLIENT_FROZEN
 : 0 );

2392 
TMEMC_SAVE_GET_POOL_FLAGS
:

2393 iàĞ
poŞ
 =ğ
NULL
 )

2395 
rc
 = (
poŞ
->
³rsi¡’t
 ? 
TMEM_POOL_PERSIST
 : 0) |

2396 (
poŞ
->
sh¬ed
 ? 
TMEM_POOL_SHARED
 : 0) |

2397 (
poŞ
->
·geshiá
 << 
TMEM_POOL_PAGESIZE_SHIFT
);

2399 
TMEMC_SAVE_GET_POOL_NPAGES
:

2400 iàĞ
poŞ
 =ğ
NULL
 )

2402 
rc
 = 
	`_©omic_»ad
(
poŞ
->
pgp_couÁ
);

2404 
TMEMC_SAVE_GET_POOL_UUID
:

2405 iàĞ
poŞ
 =ğ
NULL
 )

2407 
uuid
 = (
ušt64_t
 *)
buf
.
p
;

2408 *
uuid
++ = 
poŞ
->uuid[0];

2409 *
uuid
 = 
poŞ
->uuid[1];

2410 
rc
 = 0;

2411 
TMEMC_SAVE_END
:

2412 
ş›Á
->
live_mig¿tšg
 = 0;

2413 iàĞ!
	`li¡_em±y
(&
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
) )

2414 
	`li¡_fÜ_—ch_’Œy_§ã
(
pgp
,
pgp2
,

2415 &
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
, 
ş›Á_šv_·ges
)

2416 
	`pgp_ä“_äom_šv_li¡
(
ş›Á
,
pgp
);

2417 
ş›Á
->
äoz’
 = cl›Á->
was_äoz’
;

2418 
rc
 = 0;

2420  
rc
;

2421 
	}
}

2423 
NOINLINE
 
	$tmemc_§ve_g‘_Ãxt_·ge
(
şi_id
, 
poŞ_id
,

2424 
tmem_şi_va_t
 
buf
, 
ušt32_t
 
bufsize
)

2426 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
);

2427 
poŞ_t
 *
poŞ
 = (
ş›Á
 =ğ
NULL
 || 
poŞ_id
 >ğ
MAX_POOLS_PER_DOMAIN
)

2428 ? 
NULL
 : 
ş›Á
->
poŞs
[
poŞ_id
];

2429 
pgp_t
 *
pgp
;

2430 
OID
 
oid
;

2431 
»t
 = 0;

2432 
tmem_hªdË
 *
h
;

2433 
·gesize
 = 1 << (
poŞ
->
·geshiá
+12);

2435 iàĞ
poŞ
 =ğ
NULL
 || 
	`is_•hem”®
(pool) )

2437 iàĞ
bufsize
 < 
·gesize
 + (
tmem_hªdË
) )

2438  -
ENOMEM
;

2440 
	`tmem_¥š_lock
(&
³rs_li¡s_¥šlock
);

2441 iàĞ
	`li¡_em±y
(&
poŞ
->
³rsi¡’t_·ge_li¡
) )

2443 
»t
 = -1;

2444 
out
;

2447 iàĞ
poŞ
->
cur_pgp
 =ğ
NULL
 )

2450 
poŞ
->
cur_pgp
 = 
pgp
 = 
	`li¡_’Œy
((&poŞ->
³rsi¡’t_·ge_li¡
)->
Ãxt
,

2451 
pgp_t
,
us
.
poŞ_³rs_·ges
);

2452 } iàĞ
	`li¡_is_Ï¡
(&
poŞ
->
cur_pgp
->
us
.
poŞ_³rs_·ges
,

2453 &
poŞ
->
³rsi¡’t_·ge_li¡
) )

2456 
»t
 = -1;

2457 
out
;

2459 
pgp
 = 
	`li¡_’Œy
((&
poŞ
->
cur_pgp
->
us
.
poŞ_³rs_·ges
)->
Ãxt
,

2460 
pgp_t
,
us
.
poŞ_³rs_·ges
);

2461 
poŞ
->
cur_pgp
 = 
pgp
;

2462 
oid
 = 
pgp
->
us
.
obj
->oid;

2463 
h
 = (
tmem_hªdË
 *)
buf
.
p
;

2464 *(
OID
 *)&
h
->
oid
[0] = oid;

2465 
h
->
šdex
 = 
pgp
->index;

2466 
buf
.
p
 = (*)(
h
+1);

2467 
»t
 = 
	`do_tmem_g‘
(
poŞ
, &
oid
, 
h
->
šdex
,0,0,0,
·gesize
,
buf
.
p
);

2469 
out
:

2470 
	`tmem_¥š_uÆock
(&
³rs_li¡s_¥šlock
);

2471  
»t
;

2472 
	}
}

2474 
NOINLINE
 
	$tmemc_§ve_g‘_Ãxt_šv
(
şi_id
, 
tmem_şi_va_t
 
buf
,

2475 
ušt32_t
 
bufsize
)

2477 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
);

2478 
pgp_t
 *
pgp
;

2479 
tmem_hªdË
 *
h
;

2480 
»t
 = 0;

2482 iàĞ
ş›Á
 =ğ
NULL
 )

2484 iàĞ
bufsize
 < (
tmem_hªdË
) )

2486 
	`tmem_¥š_lock
(&
³rs_li¡s_¥šlock
);

2487 iàĞ
	`li¡_em±y
(&
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
) )

2488 
out
;

2489 iàĞ
ş›Á
->
cur_pgp
 =ğ
NULL
 )

2491 
pgp
 = 
	`li¡_’Œy
((&
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
)->
Ãxt
,

2492 
pgp_t
,
ş›Á_šv_·ges
);

2493 
ş›Á
->
cur_pgp
 = 
pgp
;

2494 } iàĞ
	`li¡_is_Ï¡
(&
ş›Á
->
cur_pgp
->
ş›Á_šv_·ges
,

2495 &
ş›Á
->
³rsi¡’t_šv®id©ed_li¡
) )

2497 
ş›Á
->
cur_pgp
 = 
NULL
;

2498 
»t
 = 0;

2499 
out
;

2501 
pgp
 = 
	`li¡_’Œy
((&
ş›Á
->
cur_pgp
->
ş›Á_šv_·ges
)->
Ãxt
,

2502 
pgp_t
,
ş›Á_šv_·ges
);

2503 
ş›Á
->
cur_pgp
 = 
pgp
;

2505 
h
 = (
tmem_hªdË
 *)
buf
.
p
;

2506 
h
->
poŞ_id
 = 
pgp
->pool_id;

2507 *(
OID
 *)&
h
->
oid
 = 
pgp
->
šv_oid
;

2508 
h
->
šdex
 = 
pgp
->index;

2509 
»t
 = 1;

2510 
out
:

2511 
	`tmem_¥š_uÆock
(&
³rs_li¡s_¥šlock
);

2512  
»t
;

2513 
	}
}

2515 
	$tmemc_»¡Üe_put_·ge
(
şi_id
, 
poŞ_id
, 
OID
 *
oidp
,

2516 
ušt32_t
 
šdex
, 
tmem_şi_va_t
 
buf
, ušt32_ˆ
bufsize
)

2518 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
);

2519 
poŞ_t
 *
poŞ
 = (
ş›Á
 =ğ
NULL
 || 
poŞ_id
 >ğ
MAX_POOLS_PER_DOMAIN
)

2520 ? 
NULL
 : 
ş›Á
->
poŞs
[
poŞ_id
];

2522 iàĞ
poŞ
 =ğ
NULL
 )

2524  
	`do_tmem_put
(
poŞ
,
oidp
,
šdex
,0,0,0,
bufsize
,
buf
.
p
);

2525 
	}
}

2527 
	$tmemc_»¡Üe_æush_·ge
(
şi_id
, 
poŞ_id
, 
OID
 *
oidp
,

2528 
ušt32_t
 
šdex
)

2530 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_şi_id
(
şi_id
);

2531 
poŞ_t
 *
poŞ
 = (
ş›Á
 =ğ
NULL
 || 
poŞ_id
 >ğ
MAX_POOLS_PER_DOMAIN
)

2532 ? 
NULL
 : 
ş›Á
->
poŞs
[
poŞ_id
];

2534 iàĞ
poŞ
 =ğ
NULL
 )

2536  
	`do_tmem_æush_·ge
(
poŞ
,
oidp
,
šdex
);

2537 
	}
}

2539 
NOINLINE
 
	$do_tmem_cÚŒŞ
(
tmem_İ
 *
İ
)

2541 
»t
;

2542 
ušt32_t
 
poŞ_id
 = 
İ
->pool_id;

2543 
ušt32_t
 
subİ
 = 
İ
->
u
.
ù¾
.subop;

2544 
OID
 *
oidp
 = (OID *)(&
İ
->
u
.
ù¾
.
oid
[0]);

2546 ià(!
	`tmh_cu¼’t_is_´iveged
())

2551 
subİ
)

2553 
TMEMC_THAW
:

2554 
TMEMC_FREEZE
:

2555 
TMEMC_DESTROY
:

2556 
»t
 = 
	`tmemc_ä“ze_poŞs
(
İ
->
u
.
ù¾
.
şi_id
,
subİ
);

2558 
TMEMC_FLUSH
:

2559 
»t
 = 
	`tmemc_æush_mem
(
İ
->
u
.
ù¾
.
şi_id
,İ->u.ù¾.
¬g1
);

2561 
TMEMC_LIST
:

2562 
»t
 = 
	`tmemc_li¡
(
İ
->
u
.
ù¾
.
şi_id
,İ->u.ù¾.
buf
,

2563 
İ
->
u
.
ù¾
.
¬g1
,İ->u.ù¾.
¬g2
);

2565 
TMEMC_SET_WEIGHT
:

2566 
TMEMC_SET_CAP
:

2567 
TMEMC_SET_COMPRESS
:

2568 
»t
 = 
	`tmemc_£t_v¬
(
İ
->
u
.
ù¾
.
şi_id
,
subİ
,İ->u.ù¾.
¬g1
);

2570 
TMEMC_QUERY_FREEABLE_MB
:

2571 
»t
 = 
	`tmh_ä“abË_·ges
(è>> (20 - 
PAGE_SHIFT
);

2573 
TMEMC_SAVE_BEGIN
:

2574 
TMEMC_RESTORE_BEGIN
:

2575 
TMEMC_SAVE_GET_VERSION
:

2576 
TMEMC_SAVE_GET_MAXPOOLS
:

2577 
TMEMC_SAVE_GET_CLIENT_WEIGHT
:

2578 
TMEMC_SAVE_GET_CLIENT_CAP
:

2579 
TMEMC_SAVE_GET_CLIENT_FLAGS
:

2580 
TMEMC_SAVE_GET_POOL_FLAGS
:

2581 
TMEMC_SAVE_GET_POOL_NPAGES
:

2582 
TMEMC_SAVE_GET_POOL_UUID
:

2583 
TMEMC_SAVE_END
:

2584 
»t
 = 
	`tmemc_§ve_subİ
(
İ
->
u
.
ù¾
.
şi_id
,
poŞ_id
,
subİ
,

2585 
İ
->
u
.
ù¾
.
buf
,İ->u.ù¾.
¬g1
);

2587 
TMEMC_SAVE_GET_NEXT_PAGE
:

2588 
»t
 = 
	`tmemc_§ve_g‘_Ãxt_·ge
(
İ
->
u
.
ù¾
.
şi_id
, 
poŞ_id
,

2589 
İ
->
u
.
ù¾
.
buf
, op->u.ù¾.
¬g1
);

2591 
TMEMC_SAVE_GET_NEXT_INV
:

2592 
»t
 = 
	`tmemc_§ve_g‘_Ãxt_šv
(
İ
->
u
.
ù¾
.
şi_id
, op->u.ù¾.
buf
,

2593 
İ
->
u
.
ù¾
.
¬g1
);

2595 
TMEMC_RESTORE_PUT_PAGE
:

2596 
»t
 = 
	`tmemc_»¡Üe_put_·ge
(
İ
->
u
.
ù¾
.
şi_id
,
poŞ_id
,

2597 
oidp
, 
İ
->
u
.
ù¾
.
¬g2
,

2598 
İ
->
u
.
ù¾
.
buf
, op->u.ù¾.
¬g1
);

2600 
TMEMC_RESTORE_FLUSH_PAGE
:

2601 
»t
 = 
	`tmemc_»¡Üe_æush_·ge
(
İ
->
u
.
ù¾
.
şi_id
,
poŞ_id
,

2602 
oidp
, 
İ
->
u
.
ù¾
.
¬g2
);

2605 
»t
 = -1;

2607  
»t
;

2608 
	}
}

2612 
EXPORT
 
	$do_tmem_İ
(
tmem_şi_İ_t
 
uİs
)

2614 
tmem_İ
 
İ
;

2615 
ş›Á_t
 *
ş›Á
 = 
	`tmh_ş›Á_äom_cu¼’t
();

2616 
poŞ_t
 *
poŞ
 = 
NULL
;

2617 
OID
 *
oidp
;

2618 
rc
 = 0;

2619 
boŞ_t
 
succ_g‘
 = 0, 
succ_put
 = 0;

2620 
boŞ_t
 
nÚ_succ_g‘
 = 0, 
nÚ_succ_put
 = 0;

2621 
boŞ_t
 
æush
 = 0, 
æush_obj
 = 0;

2622 
boŞ_t
 
tmem_wr™e_lock_£t
 = 0, 
tmem_»ad_lock_£t
 = 0;

2623 
	`DECL_LOCAL_CYC_COUNTER
(
succ_g‘
);

2624 
	`DECL_LOCAL_CYC_COUNTER
(
succ_put
);

2625 
	`DECL_LOCAL_CYC_COUNTER
(
nÚ_succ_g‘
);

2626 
	`DECL_LOCAL_CYC_COUNTER
(
nÚ_succ_put
);

2627 
	`DECL_LOCAL_CYC_COUNTER
(
æush
);

2628 
	`DECL_LOCAL_CYC_COUNTER
(
æush_obj
);

2630 iàĞ!
tmem_š™Ÿlized
 )

2631  -
ENODEV
;

2633 
tÙ®_tmem_İs
++;

2635 iàĞ
tmh_lock_®l
 )

2637 iàĞ
tmh_lock_®l
 > 1 )

2638 
	`¥š_lock_œq
(&
tmem_¥šlock
);

2640 
	`¥š_lock
(&
tmem_¥šlock
);

2643 
	`START_CYC_COUNTER
(
succ_g‘
);

2644 
	`DUP_START_CYC_COUNTER
(
succ_put
,
succ_g‘
);

2645 
	`DUP_START_CYC_COUNTER
(
nÚ_succ_g‘
,
succ_g‘
);

2646 
	`DUP_START_CYC_COUNTER
(
nÚ_succ_put
,
succ_g‘
);

2647 
	`DUP_START_CYC_COUNTER
(
æush
,
succ_g‘
);

2648 
	`DUP_START_CYC_COUNTER
(
æush_obj
,
succ_g‘
);

2650 iàĞ
ş›Á
 !ğ
NULL
 && 
	`tmh_ş›Á_is_dyšg
(client) )

2652 
rc
 = -
ENODEV
;

2653 
out
;

2656 iàĞ
	`uÆik–y
(
	`tmh_g‘_tmemİ_äom_ş›Á
(&
İ
, 
uİs
) != 0) )

2658 
	`´štk
("tmem: cª'ˆg‘mem sŒuù from %s\n",
ş›Á_¡r
);

2659 
rc
 = -
EFAULT
;

2660 
out
;

2663 iàĞ
İ
.
cmd
 =ğ
TMEM_CONTROL
 )

2665 
	`tmem_wr™e_lock
(&
tmem_rwlock
);

2666 
tmem_wr™e_lock_£t
 = 1;

2667 
rc
 = 
	`do_tmem_cÚŒŞ
(&
İ
);

2668 
out
;

2669 } iàĞ
İ
.
cmd
 =ğ
TMEM_AUTH
 ) {

2670 
	`tmem_wr™e_lock
(&
tmem_rwlock
);

2671 
tmem_wr™e_lock_£t
 = 1;

2672 
rc
 = 
	`tmemc_sh¬ed_poŞ_auth
(
İ
.
u
.
ü—t
.
¬g1
,İ.u.ü—t.
uuid
[0],

2673 
İ
.
u
.
ü—t
.
uuid
[1],İ.u.ü—t.
æags
);

2674 
out
;

2675 } iàĞ
İ
.
cmd
 =ğ
TMEM_RESTORE_NEW
 ) {

2676 
	`tmem_wr™e_lock
(&
tmem_rwlock
);

2677 
tmem_wr™e_lock_£t
 = 1;

2678 
rc
 = 
	`do_tmem_Ãw_poŞ
(
İ
.
u
.
ü—t
.
¬g1
, op.
poŞ_id
, op.u.ü—t.
æags
,

2679 
İ
.
u
.
ü—t
.
uuid
[0], op.u.creat.uuid[1]);

2680 
out
;

2684 iàĞ
ş›Á
 =ğ
NULL
 )

2686 
	`tmem_wr™e_lock
(&
tmem_rwlock
);

2687 
tmem_wr™e_lock_£t
 = 1;

2688 iàĞ(
ş›Á
 = 
	`ş›Á_ü—‹
(
	`tmh_g‘_şi_id_äom_cu¼’t
())è=ğ
NULL
 )

2690 
	`´štk
("tmem: cª'ˆü—‹mem sŒuùu» fÜ %s\n",
ş›Á_¡r
);

2691 
rc
 = -
ENOMEM
;

2692 
out
;

2696 iàĞ
İ
.
cmd
 =ğ
TMEM_NEW_POOL
 || op.cmd =ğ
TMEM_DESTROY_POOL
 )

2698 iàĞ!
tmem_wr™e_lock_£t
 )

2700 
	`tmem_wr™e_lock
(&
tmem_rwlock
);

2701 
tmem_wr™e_lock_£t
 = 1;

2706 iàĞ!
tmem_wr™e_lock_£t
 )

2708 
	`tmem_»ad_lock
(&
tmem_rwlock
);

2709 
tmem_»ad_lock_£t
 = 1;

2711 iàĞ((
ušt32_t
)
İ
.
poŞ_id
 >ğ
MAX_POOLS_PER_DOMAIN
) ||

2712 ((
poŞ
 = 
ş›Á
->
poŞs
[
İ
.
poŞ_id
]è=ğ
NULL
) )

2714 
rc
 = -
ENODEV
;

2715 
	`´štk
("tmem: operation„equested on uncreated…ool\n");

2716 
out
;

2718 
	`ASSERT_SENTINEL
(
poŞ
,
POOL
);

2721 
oidp
 = (
OID
 *)&
İ
.
u
.
g’
.
oid
[0];

2722  
İ
.
cmd
 )

2724 
TMEM_NEW_POOL
:

2725 
rc
 = 
	`do_tmem_Ãw_poŞ
(
CLI_ID_NULL
, 0, 
İ
.
u
.
ü—t
.
æags
,

2726 
İ
.
u
.
ü—t
.
uuid
[0], op.u.creat.uuid[1]);

2728 
TMEM_NEW_PAGE
:

2729 
	`tmem_’su»_ava_·ges
();

2730 
rc
 = 
	`do_tmem_put
(
poŞ
, 
oidp
,

2731 
İ
.
u
.
g’
.
šdex
, op.u.g’.
cmâ
, 0, 0, 0, 
NULL
);

2733 
TMEM_PUT_PAGE
:

2734 
	`tmem_’su»_ava_·ges
();

2735 
rc
 = 
	`do_tmem_put
(
poŞ
, 
oidp
,

2736 
İ
.
u
.
g’
.
šdex
, op.u.g’.
cmâ
, 0, 0, 
PAGE_SIZE
, 
NULL
);

2737 ià(
rc
 =ğ1è
succ_put
 = 1;

2738 
nÚ_succ_put
 = 1;

2740 
TMEM_GET_PAGE
:

2741 
rc
 = 
	`do_tmem_g‘
(
poŞ
, 
oidp
, 
İ
.
u
.
g’
.
šdex
, op.u.g’.
cmâ
,

2742 0, 0, 
PAGE_SIZE
, 0);

2743 ià(
rc
 =ğ1è
succ_g‘
 = 1;

2744 
nÚ_succ_g‘
 = 1;

2746 
TMEM_FLUSH_PAGE
:

2747 
æush
 = 1;

2748 
rc
 = 
	`do_tmem_æush_·ge
(
poŞ
, 
oidp
, 
İ
.
u
.
g’
.
šdex
);

2750 
TMEM_FLUSH_OBJECT
:

2751 
rc
 = 
	`do_tmem_æush_objeù
(
poŞ
, 
oidp
);

2752 
æush_obj
 = 1;

2754 
TMEM_DESTROY_POOL
:

2755 
æush
 = 1;

2756 
rc
 = 
	`do_tmem_de¡roy_poŞ
(
İ
.
poŞ_id
);

2758 
TMEM_READ
:

2759 
rc
 = 
	`do_tmem_g‘
(
poŞ
, 
oidp
, 
İ
.
u
.
g’
.
šdex
, op.u.g’.
cmâ
,

2760 
İ
.
u
.
g’
.
tmem_off£t
, op.u.g’.
pâ_off£t
,

2761 
İ
.
u
.
g’
.
Ën
,0);

2763 
TMEM_WRITE
:

2764 
rc
 = 
	`do_tmem_put
(
poŞ
, 
oidp
,

2765 
İ
.
u
.
g’
.
šdex
, op.u.g’.
cmâ
,

2766 
İ
.
u
.
g’
.
tmem_off£t
, op.u.g’.
pâ_off£t
,

2767 
İ
.
u
.
g’
.
Ën
, 
NULL
);

2769 
TMEM_XCHG
:

2771 
	`´štk
("tmem_xchg op‚ot implemented yet\n");

2772 
rc
 = 0;

2775 
	`´štk
("tmem: o°%d‚Ù im¶em’‹d\n", 
İ
.
cmd
);

2776 
rc
 = 0;

2780 
out
:

2781 iàĞ
rc
 < 0 )

2782 
”rÜed_tmem_İs
++;

2783 iàĞ
succ_g‘
 )

2784 
	`END_CYC_COUNTER_CLI
(
succ_g‘
,
ş›Á
);

2785 iàĞ
succ_put
 )

2786 
	`END_CYC_COUNTER_CLI
(
succ_put
,
ş›Á
);

2787 iàĞ
nÚ_succ_g‘
 )

2788 
	`END_CYC_COUNTER_CLI
(
nÚ_succ_g‘
,
ş›Á
);

2789 iàĞ
nÚ_succ_put
 )

2790 
	`END_CYC_COUNTER_CLI
(
nÚ_succ_put
,
ş›Á
);

2791 iàĞ
æush
 )

2792 
	`END_CYC_COUNTER_CLI
(
æush
,
ş›Á
);

2793 iàĞ
æush_obj
 )

2794 
	`END_CYC_COUNTER_CLI
(
æush_obj
,
ş›Á
);

2796 iàĞ
tmh_lock_®l
 )

2798 iàĞ
tmh_lock_®l
 > 1 )

2799 
	`¥š_uÆock_œq
(&
tmem_¥šlock
);

2801 
	`¥š_uÆock
(&
tmem_¥šlock
);

2803 iàĞ
tmem_wr™e_lock_£t
 )

2804 
	`wr™e_uÆock
(&
tmem_rwlock
);

2805 iàĞ
tmem_»ad_lock_£t
 )

2806 
	`»ad_uÆock
(&
tmem_rwlock
);

2808 
	`ASSERT
(0);

2811  
rc
;

2812 
	}
}

2815 
EXPORT
 
	$tmem_de¡roy
(*
v
)

2817 
ş›Á_t
 *
ş›Á
 = (ş›Á_ˆ*)
v
;

2819 iàĞ
ş›Á
 =ğ
NULL
 )

2822 iàĞ!
	`tmh_ş›Á_is_dyšg
(
ş›Á
) )

2824 
	`´štk
("tmem:mem_destroy can only destroy dying client\n");

2828 iàĞ
tmh_lock_®l
 )

2829 
	`¥š_lock
(&
tmem_¥šlock
);

2831 
	`wr™e_lock
(&
tmem_rwlock
);

2833 
	`´štk
("tmem: flushingmem…ools for %s=%d\n",

2834 
şi_id_¡r
, 
ş›Á
->
şi_id
);

2835 
	`ş›Á_æush
(
ş›Á
, 1);

2837 iàĞ
tmh_lock_®l
 )

2838 
	`¥š_uÆock
(&
tmem_¥šlock
);

2840 
	`wr™e_uÆock
(&
tmem_rwlock
);

2841 
	}
}

2844 
EXPORT
 
	$tmem_ä“ze_®l
(
key
)

2846 
ä“ze
 = 0;

2848 iàĞ
tmh_lock_®l
 )

2849 
	`¥š_lock
(&
tmem_¥šlock
);

2851 
	`wr™e_lock
(&
tmem_rwlock
);

2853 
ä“ze
 = !freeze;

2854 
	`tmemc_ä“ze_poŞs
(
CLI_ID_NULL
,
ä“ze
);

2856 iàĞ
tmh_lock_®l
 )

2857 
	`¥š_uÆock
(&
tmem_¥šlock
);

2859 
	`wr™e_uÆock
(&
tmem_rwlock
);

2860 
	}
}

2862 
	#MAX_EVICTS
 10

	)

2864 
EXPORT
 *
	$tmem_»lšquish_·ges
(
Üd”
, 
memæags
)

2866 
på_t
 *
på
;

2867 
eviùs_³r_»lšq
 = 0;

2868 
max_eviùiÚs
 = 10;

2870 ià(!
	`tmh_’abËd
(è|| !
	`tmh_ä“abË_·ges
())

2871  
NULL
;

2872 #ifdeà
__i386__


2873  
NULL
;

2876 
»lšq_©‹m±s
++;

2877 iàĞ
Üd”
 > 0 )

2879 #iâdeà
NDEBUG


2880 
	`´štk
("tmem_»lšquish_·ge: fašg ord”=%d\n", 
Üd”
);

2882  
NULL
;

2885 iàĞ
	`tmh_ÿÎed_äom_tmem
(
memæags
) )

2887 iàĞ
tmh_lock_®l
 )

2888 
	`¥š_lock
(&
tmem_¥šlock
);

2890 
	`»ad_lock
(&
tmem_rwlock
);

2893  (
på
 = 
	`tmh_®loc_·ge
(
NULL
,1)) == NULL )

2895 iàĞ(
max_eviùiÚs
-- <ğ0è|| !
	`tmem_eviù
())

2897 
eviùs_³r_»lšq
++;

2899 iàĞ
eviùs_³r_»lšq
 > 
max_eviùs_³r_»lšq
 )

2900 
max_eviùs_³r_»lšq
 = 
eviùs_³r_»lšq
;

2901 
	`tmh_süub_·ge
(
på
, 
memæags
);

2902 iàĞ
på
 !ğ
NULL
 )

2903 
»lšq_pgs
++;

2905 iàĞ
	`tmh_ÿÎed_äom_tmem
(
memæags
) )

2907 iàĞ
tmh_lock_®l
 )

2908 
	`¥š_uÆock
(&
tmem_¥šlock
);

2910 
	`»ad_uÆock
(&
tmem_rwlock
);

2913  
på
;

2914 
	}
}

2916 
EXPORT
 
	$tmem_ä“abË_·ges
()

2918  
	`tmh_ä“abË_·ges
();

2919 
	}
}

2922 
__š™
 
	$š™_tmem
()

2924 
i
;

2925 iàĞ!
	`tmh_’abËd
() )

2928 
	`¿dix_Œ“_š™
();

2929 iàĞ
	`tmh_dedup_’abËd
() )

2930 
i
 = 0; i < 256; i++ )

2932 
pcd_Œ“_roÙs
[
i
] = 
RB_ROOT
;

2933 
	`rwlock_š™
(&
pcd_Œ“_rwlocks
[
i
]);

2936 iàĞ
	`tmh_š™
() )

2938 
	`´štk
("tmem: initialized comp=%d dedup=%dze=%d global-lock=%d\n",

2939 
	`tmh_com´essiÚ_’abËd
(), 
	`tmh_dedup_’abËd
(), 
	`tmh_tze_’abËd
(),

2940 
tmh_lock_®l
);

2941 iàĞ
	`tmh_dedup_’abËd
()&&
	`tmh_com´essiÚ_’abËd
()&&
	`tmh_tze_’abËd
() )

2943 
	`tmh_tze_di§bË
();

2944 
	`´štk
("tmem:ze‡nd compression‚ot compatible, disablingze\n");

2946 
tmem_š™Ÿlized
 = 1;

2949 
	`´štk
("tmem: initialization FAILED\n");

2952 
	}
}

2953 
__š™ÿÎ
(
š™_tmem
);

	@tmem_xen.c

9 
	~<x’/tmem.h
>

10 
	~<x’/tmem_x’.h
>

11 
	~<x’/lzo.h
>

12 
	~<x’/·gšg.h
>

13 
	~<x’/domaš_·ge.h
>

14 
	~<x’/ıu.h
>

16 
	#EXPORT


	)

18 
EXPORT
 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_tmem
 = 0;

19 
boŞ—n_·¿m
("tmem", 
İt_tmem
);

21 
EXPORT
 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_tmem_com´ess
 = 0;

22 
boŞ—n_·¿m
("tmem_com´ess", 
İt_tmem_com´ess
);

24 
EXPORT
 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_tmem_dedup
 = 0;

25 
boŞ—n_·¿m
("tmem_dedup", 
İt_tmem_dedup
);

27 
EXPORT
 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_tmem_tze
 = 0;

28 
boŞ—n_·¿m
("tmem_tze", 
İt_tmem_tze
);

30 
EXPORT
 
boŞ_t
 
__»ad_mo¡ly
 
	gİt_tmem_sh¬ed_auth
 = 0;

31 
boŞ—n_·¿m
("tmem_sh¬ed_auth", 
İt_tmem_sh¬ed_auth
);

33 
EXPORT
 
__»ad_mo¡ly
 
	gİt_tmem_lock
 = 0;

34 
š‹g”_·¿m
("tmem_lock", 
İt_tmem_lock
);

36 
EXPORT
 
©omic_t
 
	gä“abË_·ge_couÁ
 = 
ATOMIC_INIT
(0);

38 #ifdeà
COMPARE_COPY_PAGE_SSE2


39 
DECL_CYC_COUNTER
(
pg_cİy1
);

40 
DECL_CYC_COUNTER
(
pg_cİy2
);

41 
DECL_CYC_COUNTER
(
pg_cİy3
);

42 
DECL_CYC_COUNTER
(
pg_cİy4
);

44 
DECL_CYC_COUNTER
(
pg_cİy
);

49 
	#LZO_WORKMEM_BYTES
 
LZO1X_1_MEM_COMPRESS


	)

50 
	#LZO_DSTMEM_PAGES
 2

	)

51 
DEFINE_PER_CPU_READ_MOSTLY
(*, 
wÜkmem
);

52 
DEFINE_PER_CPU_READ_MOSTLY
(*, 
d¡mem
);

54 #ifdeà
COMPARE_COPY_PAGE_SSE2


55 
	~<asm/æushb.h
>

56 
	~<asm/·ge.h
>

58 
	$tmh_cİy_·ge
(*
to
, *
äom
)

60 #ifdeà
COMPARE_COPY_PAGE_SSE2


61 
	`DECL_LOCAL_CYC_COUNTER
(
pg_cİy1
);

62 
	`DECL_LOCAL_CYC_COUNTER
(
pg_cİy2
);

63 
	`DECL_LOCAL_CYC_COUNTER
(
pg_cİy3
);

64 
	`DECL_LOCAL_CYC_COUNTER
(
pg_cİy4
);

65 *
to
 = *
äom
;

66 
	`æush_¬—_loÿl
(
to
,
FLUSH_CACHE
|
	`FLUSH_ORDER
(0));

67 
	`æush_¬—_loÿl
(
äom
,
FLUSH_CACHE
|
	`FLUSH_ORDER
(0));

68 
	`START_CYC_COUNTER
(
pg_cİy1
);

69 
	`cİy_·ge_s£2
(
to
, 
äom
);

70 
	`END_CYC_COUNTER
(
pg_cİy1
);

71 
	`START_CYC_COUNTER
(
pg_cİy2
);

72 
	`cİy_·ge_s£2
(
to
, 
äom
);

73 
	`END_CYC_COUNTER
(
pg_cİy2
);

74 
	`æush_¬—_loÿl
(
to
,
FLUSH_CACHE
|
	`FLUSH_ORDER
(0));

75 
	`æush_¬—_loÿl
(
äom
,
FLUSH_CACHE
|
	`FLUSH_ORDER
(0));

76 
	`START_CYC_COUNTER
(
pg_cİy3
);

77 
	`memıy
(
to
, 
äom
, 
PAGE_SIZE
);

78 
	`END_CYC_COUNTER
(
pg_cİy3
);

79 
	`START_CYC_COUNTER
(
pg_cİy4
);

80 
	`memıy
(
to
, 
äom
, 
PAGE_SIZE
);

81 
	`END_CYC_COUNTER
(
pg_cİy4
);

83 
	`DECL_LOCAL_CYC_COUNTER
(
pg_cİy
);

84 
	`START_CYC_COUNTER
(
pg_cİy
);

85 
	`memıy
(
to
, 
äom
, 
PAGE_SIZE
);

86 
	`END_CYC_COUNTER
(
pg_cİy
);

88 
	}
}

90 #ifdeà
__Ÿ64__


91 
šlše
 *
	$şi_g‘_·ge
(
tmem_şi_mâ_t
 
cmâ
, *
pşi_mâ
,

92 
på_t
 **
pşi_på
, 
boŞ_t
 
şi_wr™e
)

94 
	`ASSERT
(0);

95  
NULL
;

96 
	}
}

98 
šlše
 
	$şi_put_·ge
(*
şi_va
, 
på_t
 *
şi_på
,

99 
şi_mâ
, 
boŞ_t
 
m¬k_dœty
)

101 
	`ASSERT
(0);

102 
	}
}

104 
šlše
 *
	$şi_g‘_·ge
(
tmem_şi_mâ_t
 
cmâ
, *
pşi_mâ
,

105 
på_t
 **
pşi_på
, 
boŞ_t
 
şi_wr™e
)

107 
şi_mâ
;

108 
p2m_ty³_t
 
t
;

109 
·ge_šfo
 *
·ge
;

110 
»t
;

112 
şi_mâ
 = 
	`mâ_x
(
	`gâ_to_mâ
(
	`p2m_g‘_ho¡p2m
(
cu¼’t
->
domaš
), 
cmâ
, &
t
));

113 iàĞ
t
 !ğ
p2m_¿m_rw
 || !
	`mâ_v®id
(
şi_mâ
) )

114  
NULL
;

115 
·ge
 = 
	`mâ_to_·ge
(
şi_mâ
);

116 iàĞ
şi_wr™e
 )

117 
»t
 = 
	`g‘_·ge_ªd_ty³
(
·ge
, 
cu¼’t
->
domaš
, 
PGT_wr™abË_·ge
);

119 
»t
 = 
	`g‘_·ge
(
·ge
, 
cu¼’t
->
domaš
);

120 iàĞ!
»t
 )

121  
NULL
;

122 *
pşi_mâ
 = 
şi_mâ
;

123 *
pşi_på
 = (
på_t
 *)
·ge
;

124  
	`m­_domaš_·ge
(
şi_mâ
);

125 
	}
}

127 
šlše
 
	$şi_put_·ge
(*
şi_va
, 
på_t
 *
şi_på
,

128 
şi_mâ
, 
boŞ_t
 
m¬k_dœty
)

130 iàĞ
m¬k_dœty
 )

132 
	`put_·ge_ªd_ty³
((
·ge_šfo
 *)
şi_på
);

133 
	`·gšg_m¬k_dœty
(
cu¼’t
->
domaš
,
şi_mâ
);

136 
	`put_·ge
((
·ge_šfo
 *)
şi_på
);

137 
	`unm­_domaš_·ge
(
şi_va
);

138 
	}
}

141 
EXPORT
 
	$tmh_cİy_äom_ş›Á
(
på_t
 *
på
,

142 
tmem_şi_mâ_t
 
cmâ
, 
·gesize_t
 
tmem_off£t
,

143 
·gesize_t
 
pâ_off£t
,…agesize_ˆ
Ën
, *
şi_va
)

145 
tmem_mâ
, 
şi_mâ
 = 0;

146 *
tmem_va
;

147 
på_t
 *
şi_på
 = 
NULL
;

148 
boŞ_t
 
tmemc
 = 
şi_va
 !ğ
NULL
;

150 
	`ASSERT
(
på
 !ğ
NULL
);

151 
tmem_mâ
 = 
	`·ge_to_mâ
(
på
);

152 
tmem_va
 = 
	`m­_domaš_·ge
(
tmem_mâ
);

153 iàĞ
tmem_off£t
 =ğ0 && 
pâ_off£t
 =ğ0 && 
Ën
 == 0 )

155 
	`mem£t
(
tmem_va
, 0, 
PAGE_SIZE
);

156 
	`unm­_domaš_·ge
(
tmem_va
);

159 iàĞ!
tmemc
 )

161 
şi_va
 = 
	`şi_g‘_·ge
(
cmâ
, &
şi_mâ
, &
şi_på
, 0);

162 iàĞ
şi_va
 =ğ
NULL
 )

163  -
EFAULT
;

165 
	`mb
();

166 ià(
Ën
 =ğ
PAGE_SIZE
 && !
tmem_off£t
 && !
pâ_off£t
)

167 
	`tmh_cİy_·ge
(
tmem_va
, 
şi_va
);

168 iàĞ(
tmem_off£t
+
Ën
 <ğ
PAGE_SIZE
) &&

169 (
pâ_off£t
+
Ën
 <ğ
PAGE_SIZE
) )

170 
	`memıy
((*)
tmem_va
+
tmem_off£t
,(*)
şi_va
+
pâ_off£t
,
Ën
);

171 iàĞ!
tmemc
 )

172 
	`şi_put_·ge
(
şi_va
, 
şi_på
, 
şi_mâ
, 0);

173 
	`unm­_domaš_·ge
(
tmem_va
);

175 
	}
}

177 
EXPORT
 
	$tmh_com´ess_äom_ş›Á
(
tmem_şi_mâ_t
 
cmâ
,

178 **
out_va
, 
size_t
 *
out_Ën
, *
şi_va
)

180 
»t
 = 0;

181 *
dmem
 = 
	`this_ıu
(
d¡mem
);

182 *
wmem
 = 
	`this_ıu
(
wÜkmem
);

183 
på_t
 *
şi_på
 = 
NULL
;

184 
şi_mâ
 = 0;

185 
boŞ_t
 
tmemc
 = 
şi_va
 !ğ
NULL
;

187 iàĞ
dmem
 =ğ
NULL
 || 
wmem
 == NULL )

189 iàĞ!
tmemc
 )

191 
şi_va
 = 
	`şi_g‘_·ge
(
cmâ
, &
şi_mâ
, &
şi_på
, 0);

192 iàĞ
şi_va
 =ğ
NULL
 )

193  -
EFAULT
;

195 
	`mb
();

196 
»t
 = 
	`lzo1x_1_com´ess
(
şi_va
, 
PAGE_SIZE
, 
dmem
, 
out_Ën
, 
wmem
);

197 
	`ASSERT
(
»t
 =ğ
LZO_E_OK
);

198 *
out_va
 = 
dmem
;

199 iàĞ!
tmemc
 )

200 
	`şi_put_·ge
(
şi_va
, 
şi_på
, 
şi_mâ
, 0);

201 
	`unm­_domaš_·ge
(
şi_va
);

203 
	}
}

205 
EXPORT
 
	$tmh_cİy_to_ş›Á
(
tmem_şi_mâ_t
 
cmâ
, 
på_t
 *
på
,

206 
·gesize_t
 
tmem_off£t
,…agesize_ˆ
pâ_off£t
,…agesize_ˆ
Ën
, *
şi_va
)

208 
tmem_mâ
, 
şi_mâ
 = 0;

209 *
tmem_va
;

210 
på_t
 *
şi_på
 = 
NULL
;

211 
boŞ_t
 
tmemc
 = 
şi_va
 !ğ
NULL
;

213 
	`ASSERT
(
på
 !ğ
NULL
);

214 iàĞ!
tmemc
 )

216 
şi_va
 = 
	`şi_g‘_·ge
(
cmâ
, &
şi_mâ
, &
şi_på
, 1);

217 iàĞ
şi_va
 =ğ
NULL
 )

218  -
EFAULT
;

220 
tmem_mâ
 = 
	`·ge_to_mâ
(
på
);

221 
tmem_va
 = 
	`m­_domaš_·ge
(
tmem_mâ
);

222 ià(
Ën
 =ğ
PAGE_SIZE
 && !
tmem_off£t
 && !
pâ_off£t
)

223 
	`tmh_cİy_·ge
(
şi_va
, 
tmem_va
);

224 iàĞ(
tmem_off£t
+
Ën
 <ğ
PAGE_SIZE
è&& (
pâ_off£t
+len <= PAGE_SIZE) )

225 
	`memıy
((*)
şi_va
+
pâ_off£t
,(*)
tmem_va
+
tmem_off£t
,
Ën
);

226 
	`unm­_domaš_·ge
(
tmem_va
);

227 iàĞ!
tmemc
 )

228 
	`şi_put_·ge
(
şi_va
, 
şi_på
, 
şi_mâ
, 1);

229 
	`mb
();

231 
	}
}

233 
EXPORT
 
	$tmh_decom´ess_to_ş›Á
(
tmem_şi_mâ_t
 
cmâ
, *
tmem_va
,

234 
size_t
 
size
, *
şi_va
)

236 
şi_mâ
 = 0;

237 
på_t
 *
şi_på
 = 
NULL
;

238 
size_t
 
out_Ën
 = 
PAGE_SIZE
;

239 
boŞ_t
 
tmemc
 = 
şi_va
 !ğ
NULL
;

240 
»t
;

242 iàĞ!
tmemc
 )

244 
şi_va
 = 
	`şi_g‘_·ge
(
cmâ
, &
şi_mâ
, &
şi_på
, 1);

245 iàĞ
şi_va
 =ğ
NULL
 )

246  -
EFAULT
;

248 
»t
 = 
	`lzo1x_decom´ess_§ã
(
tmem_va
, 
size
, 
şi_va
, &
out_Ën
);

249 
	`ASSERT
(
»t
 =ğ
LZO_E_OK
);

250 
	`ASSERT
(
out_Ën
 =ğ
PAGE_SIZE
);

251 iàĞ!
tmemc
 )

252 
	`şi_put_·ge
(
şi_va
, 
şi_på
, 
şi_mâ
, 1);

253 
	`mb
();

255 
	}
}

257 
EXPORT
 
	$tmh_cİy_tze_to_ş›Á
(
tmem_şi_mâ_t
 
cmâ
, *
tmem_va
,

258 
·gesize_t
 
Ën
)

260 *
şi_va
;

261 
şi_mâ
;

262 
på_t
 *
şi_på
 = 
NULL
;

264 
	`ASSERT
(!(
Ën
 & ((
ušt64_t
)-1)));

265 
	`ASSERT
(
Ën
 <ğ
PAGE_SIZE
);

266 
	`ASSERT
(
Ën
 > 0 || 
tmem_va
 =ğ
NULL
);

267 
şi_va
 = 
	`şi_g‘_·ge
(
cmâ
, &
şi_mâ
, &
şi_på
, 1);

268 iàĞ
şi_va
 =ğ
NULL
 )

269  -
EFAULT
;

270 iàĞ
Ën
 > 0 )

271 
	`memıy
((*)
şi_va
,(*)
tmem_va
,
Ën
);

272 iàĞ
Ën
 < 
PAGE_SIZE
 )

273 
	`mem£t
((*)
şi_va
+
Ën
,0,
PAGE_SIZE
-len);

274 
	`şi_put_·ge
(
şi_va
, 
şi_på
, 
şi_mâ
, 1);

275 
	`mb
();

277 
	}
}

281 
EXPORT
 
xmem_poŞ
 *
	gtmh_mempoŞ
 = 0;

282 
EXPORT
 
	gtmh_mempoŞ_max®loc
 = 0;

284 
EXPORT
 
DEFINE_SPINLOCK
(
tmh_·ge_li¡_lock
);

285 
EXPORT
 
PAGE_LIST_HEAD
(
tmh_·ge_li¡
);

286 
EXPORT
 
	gtmh_·ge_li¡_·ges
 = 0;

289 
EXPORT
 
	$tmh_»Ëa£_ava_·ges_to_ho¡
()

291 
	`¥š_lock
(&
tmh_·ge_li¡_lock
);

292  !
	`·ge_li¡_em±y
(&
tmh_·ge_li¡
) )

294 
·ge_šfo
 *
pg
 = 
	`·ge_li¡_»move_h—d
(&
tmh_·ge_li¡
);

295 
	`süub_Úe_·ge
(
pg
);

296 
tmh_·ge_li¡_·ges
--;

297 
	`ä“_domh—p_·ge
(
pg
);

299 
	`ASSERT
(
tmh_·ge_li¡_·ges
 == 0);

300 
	`INIT_PAGE_LIST_HEAD
(&
tmh_·ge_li¡
);

301 
	`¥š_uÆock
(&
tmh_·ge_li¡_lock
);

302 
	}
}

304 
EXPORT
 
	$tmh_süub_·ge
(
·ge_šfo
 *
pi
, 
memæags
)

306 iàĞ
pi
 =ğ
NULL
 )

308 iàĞ!(
memæags
 & 
MEMF_tmem
) )

309 
	`süub_Úe_·ge
(
pi
);

310 
	}
}

312 #iâdeà
__i386__


313 
nošlše
 *
	$tmh_mempoŞ_·ge_g‘
(
size
)

315 
·ge_šfo
 *
pi
;

317 
	`ASSERT
(
size
 =ğ
PAGE_SIZE
);

318 iàĞ(
pi
 = 
	`tmh_®loc_·ge
(
NULL
,0)) == NULL )

319  
NULL
;

320 
	`ASSERT
(
	`IS_VALID_PAGE
(
pi
));

321  
	`·ge_to_vœt
(
pi
);

322 
	}
}

324 
	$tmh_mempoŞ_·ge_put
(*
·ge_va
)

326 
	`ASSERT
(
	`IS_PAGE_ALIGNED
(
·ge_va
));

327 
	`tmh_ä“_·ge
(
	`vœt_to_·ge
(
·ge_va
));

328 
	}
}

330 
__š™
 
	$tmh_mempoŞ_š™
()

332 
tmh_mempoŞ
 = 
	`xmem_poŞ_ü—‹
("tmem", 
tmh_mempoŞ_·ge_g‘
,

333 
tmh_mempoŞ_·ge_put
, 
PAGE_SIZE
, 0, PAGE_SIZE);

334 iàĞ
tmh_mempoŞ
 )

335 
tmh_mempoŞ_max®loc
 = 
	`xmem_poŞ_max®loc
(
tmh_mempoŞ
);

336  
tmh_mempoŞ
 !ğ
NULL
;

337 
	}
}

341 *
	$tmh_³rsi¡’t_poŞ_·ge_g‘
(
size
)

343 
·ge_šfo
 *
pi
;

344 
domaš
 *
d
 = 
cu¼’t
->domain;

346 
	`ASSERT
(
size
 =ğ
PAGE_SIZE
);

347 iàĞ(
pi
 = 
	`_tmh_®loc_·ge_thi¥oŞ
(
d
)è=ğ
NULL
 )

348  
NULL
;

349 
	`ASSERT
(
	`IS_VALID_PAGE
(
pi
));

350  
	`__m­_domaš_·ge
(
pi
);

351 
	}
}

353 
	$tmh_³rsi¡’t_poŞ_·ge_put
(*
·ge_va
)

355 
·ge_šfo
 *
pi
;

357 
	`ASSERT
(
	`IS_PAGE_ALIGNED
(
·ge_va
));

358 
pi
 = 
	`vœt_to_·ge
(
·ge_va
);

359 
	`ASSERT
(
	`IS_VALID_PAGE
(
pi
));

360 
	`_tmh_ä“_·ge_thi¥oŞ
(
pi
);

361 
	}
}

366 
EXPORT
 
tmh_ş›Á_t
 *
	$tmh_ş›Á_š™
(
şi_id_t
 
şi_id
)

368 
tmh_ş›Á_t
 *
tmh
;

369 
Çme
[5];

370 
i
, 
shiá
;

372 iàĞ(
tmh
 = 
	`xm®loc
(
tmh_ş›Á_t
)è=ğ
NULL
 )

373  
NULL
;

374 
i
 = 0, 
shiá
 = 12; i < 4; shift -=4, i++)

375 
Çme
[
i
] = ((()
şi_id
 >> 
shiá
) & 0xf) + '0';

376 
Çme
[4] = '\0';

377 #iâdeà
__i386__


378 
tmh
->
³rsi¡’t_poŞ
 = 
	`xmem_poŞ_ü—‹
(
Çme
, 
tmh_³rsi¡’t_poŞ_·ge_g‘
,

379 
tmh_³rsi¡’t_poŞ_·ge_put
, 
PAGE_SIZE
, 0, PAGE_SIZE);

380 iàĞ
tmh
->
³rsi¡’t_poŞ
 =ğ
NULL
 )

382 
	`xä“
(
tmh
);

383  
NULL
;

384 
	}
}

386  
	gtmh
;

389 
EXPORT
 
	$tmh_ş›Á_de¡roy
(
tmh_ş›Á_t
 *
tmh
)

391 
	`ASSERT
(
tmh
->
domaš
->
is_dyšg
);

392 #iâdeà
__i386__


393 
	`xmem_poŞ_de¡roy
(
tmh
->
³rsi¡’t_poŞ
);

395 
tmh
->
domaš
 = 
NULL
;

396 
	}
}

400 #iâdeà
__i386__


402 
	gd¡mem_Üd”
, 
	gwÜkmem_Üd”
;

404 
	$ıu_ÿÎback
(

405 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

407 
ıu
 = ()
hıu
;

409  
aùiÚ
 )

411 
CPU_UP_PREPARE
: {

412 iàĞ
	`³r_ıu
(
d¡mem
, 
ıu
è=ğ
NULL
 )

414 
·ge_šfo
 *
p
 = 
	`®loc_domh—p_·ges
(0, 
d¡mem_Üd”
, 0);

415 
	`³r_ıu
(
d¡mem
, 
ıu
èğ
p
 ? 
	`·ge_to_vœt
Õè: 
NULL
;

417 iàĞ
	`³r_ıu
(
wÜkmem
, 
ıu
è=ğ
NULL
 )

419 
·ge_šfo
 *
p
 = 
	`®loc_domh—p_·ges
(0, 
wÜkmem_Üd”
, 0);

420 
	`³r_ıu
(
wÜkmem
, 
ıu
èğ
p
 ? 
	`·ge_to_vœt
Õè: 
NULL
;

424 
CPU_DEAD
:

425 
CPU_UP_CANCELED
: {

426 iàĞ
	`³r_ıu
(
d¡mem
, 
ıu
è!ğ
NULL
 )

428 
·ge_šfo
 *
p
 = 
	`vœt_to_·ge
(
	`³r_ıu
(
d¡mem
, 
ıu
));

429 
	`ä“_domh—p_·ges
(
p
, 
d¡mem_Üd”
);

430 
	`³r_ıu
(
d¡mem
, 
ıu
èğ
NULL
;

432 iàĞ
	`³r_ıu
(
wÜkmem
, 
ıu
è!ğ
NULL
 )

434 
·ge_šfo
 *
p
 = 
	`vœt_to_·ge
(
	`³r_ıu
(
wÜkmem
, 
ıu
));

435 
	`ä“_domh—p_·ges
(
p
, 
wÜkmem_Üd”
);

436 
	`³r_ıu
(
wÜkmem
, 
ıu
èğ
NULL
;

444  
NOTIFY_DONE
;

445 
	}
}

447 
nÙif›r_block
 
	gıu_nfb
 = {

448 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback


451 
EXPORT
 
__š™
 
	$tmh_š™
()

453 
ıu
;

455 iàĞ!
	`tmh_mempoŞ_š™
() )

458 
d¡mem_Üd”
 = 
	`g‘_Üd”_äom_·ges
(
LZO_DSTMEM_PAGES
);

459 
wÜkmem_Üd”
 = 
	`g‘_Üd”_äom_by‹s
(
LZO1X_1_MEM_COMPRESS
);

461 
	`fÜ_—ch_Úlše_ıu
 ( 
ıu
 )

463 *
hıu
 = (*)()
ıu
;

464 
	`ıu_ÿÎback
(&
ıu_nfb
, 
CPU_UP_PREPARE
, 
hıu
);

467 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

470 
	}
}

474 
EXPORT
 
__š™
 
	$tmh_š™
()

477 
	}
}

	@trace.c

19 
	~<x’/cÚfig.h
>

20 
	~<asm/ty³s.h
>

21 
	~<asm/io.h
>

22 
	~<x’/lib.h
>

23 
	~<x’/sched.h
>

24 
	~<x’/smp.h
>

25 
	~<x’/Œaû.h
>

26 
	~<x’/”ºo.h
>

27 
	~<x’/ev’t.h
>

28 
	~<x’/skËt.h
>

29 
	~<x’/š™.h
>

30 
	~<x’/mm.h
>

31 
	~<x’/³rıu.h
>

32 
	~<x’/ıu.h
>

33 
	~<asm/©omic.h
>

34 
	~<public/sysùl.h
>

35 
	~<mši.h
>

37 #ifdeà
CONFIG_COMPAT


38 
	~<com·t/Œaû.h
>

39 
	#x’_t_buf
 
t_buf


	)

40 
	gCHECK_t_buf
;

41 #undeà
x’_t_buf


43 
	#com·t_t_»c
 
t_»c


	)

47 
	gİt_tbuf_size
 = 0;

48 
š‹g”_·¿m
("tbuf_size", 
İt_tbuf_size
);

51 
t_šfo
 *
	gt_šfo
;

52 
	#T_INFO_PAGES
 2

	)

53 
	#T_INFO_SIZE
 ((
T_INFO_PAGES
)*(
PAGE_SIZE
))

	)

54 
DEFINE_PER_CPU_READ_MOSTLY
(
t_buf
 *, 
t_bufs
);

55 
DEFINE_PER_CPU_READ_MOSTLY
(*, 
t_d©a
);

56 
DEFINE_PER_CPU_READ_MOSTLY
(
¥šlock_t
, 
t_lock
);

57 
u32
 
	gd©a_size
;

58 
u32
 
t_šfo_fœ¡_off£t
 
	g__»ad_mo¡ly
;

62 
u32
 
	gt_buf_highw©”
;

65 
DEFINE_PER_CPU
(, 
lo¡_»cÜds
);

66 
DEFINE_PER_CPU
(, 
lo¡_»cÜds_fœ¡_tsc
);

70 
tb_š™_dÚe
 
	g__»ad_mo¡ly
;

73 
ıumask_t
 
	gtb_ıu_mask
 = 
CPU_MASK_ALL
;

76 
u32
 
	gtb_ev’t_mask
 = 
TRC_ALL
;

80 
	#f™_to_ty³
(
_ty³
, 
_x
è(((_x)+(_ty³)-1è/ (_ty³))

	)

82 
	$ÿlc_tšfo_fœ¡_off£t
()

84 
off£t_š_by‹s
 = 
	`off£tof
(
t_šfo
, 
mâ_off£t
[
NR_CPUS
]);

85 
t_šfo_fœ¡_off£t
 = 
	`f™_to_ty³
(
ušt32_t
, 
off£t_š_by‹s
);

86 
	}
}

93 
	$check_tbuf_size
(
u32
 
·ges
)

95 
t_buf
 
dummy
;

96 
	`ty³of
(
dummy
.
´od
è
size
;

98 
size
 = ((
	`ty³of
(
dummy
.
´od
))
·ges
è* 
PAGE_SIZE
;

100  (
size
 / 
PAGE_SIZE
 !ğ
·ges
)

101 || (
size
 + size < size)

102 || (
	`num_Úlše_ıus
(è* 
·ges
 + 
t_šfo_fœ¡_off£t
 > 
T_INFO_SIZE
 / (
ušt32_t
));

103 
	}
}

115 
	$®loc_Œaû_bufs
()

117 
i
, 
ıu
, 
Üd”
;

118 
Ä_·ges
;

120 
ušt32_t
 *
t_šfo_mâ_li¡
;

121 
off£t
;

123 iàĞ
İt_tbuf_size
 == 0 )

124  -
EINVAL
;

126 iàĞ
	`check_tbuf_size
(
İt_tbuf_size
) )

128 
	`´štk
("Xenrace buffers:b size %doo†arge. "

130 
İt_tbuf_size
);

131  -
EINVAL
;

136 
t_šfo
 = 
	`®loc_x’h—p_·ges
(
	`g‘_Üd”_äom_·ges
(
T_INFO_PAGES
), 0);

137 iàĞ
t_šfo
 =ğ
NULL
 )

139 
	`´štk
("Xenrace buffers:_info‡llocation failed! "

141  -
ENOMEM
;

144  
i
 = 0; i < 
T_INFO_PAGES
; i++ )

145 
	`sh¬e_x’_·ge_w™h_´iveged_gue¡s
(

146 
	`vœt_to_·ge
(
t_šfo
è+ 
i
, 
XENSHARE_»adÚly
);

148 
t_šfo_mâ_li¡
 = (
ušt32_t
 *)
t_šfo
;

149 
off£t
 = 
t_šfo_fœ¡_off£t
;

151 
t_šfo
->
tbuf_size
 = 
İt_tbuf_size
;

152 
	`´štk
(
XENLOG_INFO
 "tbuf_siz%d\n", 
t_šfo
->
tbuf_size
);

154 
Ä_·ges
 = 
İt_tbuf_size
;

155 
Üd”
 = 
	`g‘_Üd”_äom_·ges
(
Ä_·ges
);

161 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

163 
æags
;

164 *
¿wbuf
;

165 
t_buf
 *
buf
;

167 iàĞ(
¿wbuf
 = 
	`®loc_x’h—p_·ges
(

168 
Üd”
, 
	`MEMF_b™s
(32 + 
PAGE_SHIFT
))è=ğ
NULL
 )

170 
	`´štk
("Xenrace buffers: memory‡llocation failed\n");

171 
İt_tbuf_size
 = 0;

172 
out_d—Îoc
;

175 
	`¥š_lock_œq§ve
(&
	`³r_ıu
(
t_lock
, 
ıu
), 
æags
);

177 
	`³r_ıu
(
t_bufs
, 
ıu
èğ
buf
 = (
t_buf
 *)
¿wbuf
;

178 
buf
->
cÚs
 = buf->
´od
 = 0;

179 
	`³r_ıu
(
t_d©a
, 
ıu
èğ(*)(
buf
 + 1);

181 
	`¥š_uÆock_œq»¡Üe
(&
	`³r_ıu
(
t_lock
, 
ıu
), 
æags
);

189 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

192 *
¿wbuf
;

194 iàĞ(
¿wbuf
 = (*)
	`³r_ıu
(
t_bufs
, 
ıu
)) )

196 
·ge_šfo
 *
p
 = 
	`vœt_to_·ge
(
¿wbuf
);

197 
ušt32_t
 
mâ
 = 
	`vœt_to_mâ
(
¿wbuf
);

199  
i
 = 0; i < 
Ä_·ges
; i++ )

201 
	`sh¬e_x’_·ge_w™h_´iveged_gue¡s
(

202 
p
 + 
i
, 
XENSHARE_wr™abË
);

204 
t_šfo_mâ_li¡
[
off£t
 + 
i
]=
mâ
 + i;

207 
	`wmb
();

208 
t_šfo
->
mâ_off£t
[
ıu
]=
off£t
;

209 
	`´štk
(
XENLOG_INFO
 "p%d mâ %"
PRIx32
" offset %d\n",

210 
ıu
, 
mâ
, 
off£t
);

211 
off£t
+=
i
;

215 
d©a_size
 = (
İt_tbuf_size
 * 
PAGE_SIZE
 - (
t_buf
));

216 
t_buf_highw©”
 = 
d©a_size
 >> 1;

219 
out_d—Îoc
:

220 
	`fÜ_—ch_Úlše_ıu
(
ıu
)

222 
æags
;

223 * 
¿wbuf
;

225 
	`¥š_lock_œq§ve
(&
	`³r_ıu
(
t_lock
, 
ıu
), 
æags
);

226 iàĞ(
¿wbuf
 = (*)
	`³r_ıu
(
t_bufs
, 
ıu
)) )

228 
	`³r_ıu
(
t_bufs
, 
ıu
èğ
NULL
;

229 
	`ASSERT
(!(
	`vœt_to_·ge
(
¿wbuf
)->
couÁ_šfo
 & 
PGC_®loÿ‹d
));

230 
	`ä“_x’h—p_·ges
(
¿wbuf
, 
Üd”
);

232 
	`¥š_uÆock_œq»¡Üe
(&
	`³r_ıu
(
t_lock
, 
ıu
), 
æags
);

235  -
ENOMEM
;

236 
	}
}

245 
	$tb_£t_size
(
size
)

252 
»t
 = 0;

254 iàĞ
İt_tbuf_size
 != 0 )

256 iàĞ
size
 !ğ
İt_tbuf_size
 )

257 
	`gd´štk
(
XENLOG_INFO
, "tb_set_size from %do %d‚ot implemented\n",

258 
İt_tbuf_size
, 
size
);

259  -
EINVAL
;

262 iàĞ
size
 <= 0 )

263  -
EINVAL
;

265 
İt_tbuf_size
 = 
size
;

267 iàĞ(
»t
 = 
	`®loc_Œaû_bufs
()) != 0 )

269 
İt_tbuf_size
 = 0;

270  
»t
;

273 
	`´štk
("Xenrace buffers: initialized\n");

275 
	}
}

277 
	$Œaû_wl_Œaû_ev’t
(
u32
 
ev’t
)

279 iàĞ!
tb_š™_dÚe
 )

285 iàĞ(
tb_ev’t_mask
 & 
ev’t
) == 0 )

289 iàĞ((
tb_ev’t_mask
 >> 
TRC_CLS_SHIFT
è& (
ev’t
 >> TRC_CLS_SHIFT)) == 0 )

293 iàĞ(((
tb_ev’t_mask
 >> 
TRC_SUBCLS_SHIFT
) & 0xf )

294 & ((
ev’t
 >> 
TRC_SUBCLS_SHIFT
) & 0xf )) == 0 )

297 iàĞ!
	`ıu_is£t
(
	`smp_´oûssÜ_id
(), 
tb_ıu_mask
) )

301 
	}
}

303 
	$ıu_ÿÎback
(

304 
nÙif›r_block
 *
nfb
, 
aùiÚ
, *
hıu
)

306 
ıu
 = ()
hıu
;

308 iàĞ
aùiÚ
 =ğ
CPU_UP_PREPARE
 )

309 
	`¥š_lock_š™
(&
	`³r_ıu
(
t_lock
, 
ıu
));

311  
NOTIFY_DONE
;

312 
	}
}

314 
nÙif›r_block
 
	gıu_nfb
 = {

315 .
nÙif›r_ÿÎ
 = 
ıu_ÿÎback


325 
__š™
 
	$š™_Œaû_bufs
()

327 
i
;

330 
	`ÿlc_tšfo_fœ¡_off£t
();

333 
	`fÜ_—ch_Úlše_ıu
 ( 
i
 )

334 
	`¥š_lock_š™
(&
	`³r_ıu
(
t_lock
, 
i
));

335 
	`»gi¡”_ıu_nÙif›r
(&
ıu_nfb
);

337 iàĞ
İt_tbuf_size
 == 0 )

339 
	`´štk
("Xenrace buffers: disabled\n");

340 
ç
;

343 iàĞ
	`®loc_Œaû_bufs
() != 0 )

345 
	`d´štk
(
XENLOG_INFO
, "Xenrace buffers: "

347 
İt_tbuf_size
);

348 
ç
;

351 
	`´štk
("Xenrace buffers: initialised\n");

352 
	`wmb
();

353 
tb_š™_dÚe
 = 1;

356 
ç
:

357 
İt_tbuf_size
 = 0;

358 
	}
}

364 
	$tb_cÚŒŞ
(
x’_sysùl_tbuf_İ_t
 *
tbc
)

366 
	`DEFINE_SPINLOCK
(
lock
);

367 
rc
 = 0;

369 
	`¥š_lock
(&
lock
);

371  
tbc
->
cmd
 )

373 
XEN_SYSCTL_TBUFOP_g‘_šfo
:

374 
tbc
->
evt_mask
 = 
tb_ev’t_mask
;

375 
tbc
->
bufãr_mâ
 = 
t_šfo
 ? 
	`vœt_to_mâ
(t_info) : 0;

376 
tbc
->
size
 = 
T_INFO_PAGES
 * 
PAGE_SIZE
;

378 
XEN_SYSCTL_TBUFOP_£t_ıu_mask
:

379 
rc
 = 
	`x’ùl_ıum­_to_ıumask
(&
tb_ıu_mask
, &
tbc
->
ıu_mask
);

381 
XEN_SYSCTL_TBUFOP_£t_evt_mask
:

382 
tb_ev’t_mask
 = 
tbc
->
evt_mask
;

384 
XEN_SYSCTL_TBUFOP_£t_size
:

385 
rc
 = 
	`tb_£t_size
(
tbc
->
size
);

387 
XEN_SYSCTL_TBUFOP_’abË
:

389 iàĞ
İt_tbuf_size
 == 0 )

390 
rc
 = -
EINVAL
;

392 
tb_š™_dÚe
 = 1;

394 
XEN_SYSCTL_TBUFOP_di§bË
:

400 
i
;

402 
tb_š™_dÚe
 = 0;

403 
	`wmb
();

407 
	`fÜ_—ch_Úlše_ıu
(
i
)

409 
æags
;

410 
	`¥š_lock_œq§ve
(&
	`³r_ıu
(
t_lock
, 
i
), 
æags
);

411 
	`³r_ıu
(
lo¡_»cÜds
, 
i
)=0;

412 
	`¥š_uÆock_œq»¡Üe
(&
	`³r_ıu
(
t_lock
, 
i
), 
æags
);

417 
rc
 = -
EINVAL
;

421 
	`¥š_uÆock
(&
lock
);

423  
rc
;

424 
	}
}

426 
šlše
 
	$ÿlc_»c_size
(
boŞ_t
 
cyşes
, 
exŒa
)

428 
»c_size
 = 4;

430 iàĞ
cyşes
 )

431 
»c_size
 += 8;

432 
»c_size
 +ğ
exŒa
;

433  
»c_size
;

434 
	}
}

436 
šlše
 
boŞ_t
 
	$bogus
(
u32
 
´od
, u32 
cÚs
)

438 iàĞ
	`uÆik–y
(
´od
 & 3è|| uÆik–yÕrod >ğ2 * 
d©a_size
) ||

439 
	`uÆik–y
(
cÚs
 & 3è|| uÆik–y(cÚ >ğ2 * 
d©a_size
) )

441 
tb_š™_dÚe
 = 0;

442 
	`´štk
(
XENLOG_WARNING
 "trc#%u: bogus…rod (%08x)‡nd/or cons (%08x)\n",

443 
	`smp_´oûssÜ_id
(), 
´od
, 
cÚs
);

447 
	}
}

449 
šlše
 
u32
 
	$ÿlc_uncÚsumed_by‹s
(cÚ¡ 
t_buf
 *
buf
)

451 
u32
 
´od
 = 
buf
->´od, 
cÚs
 = buf->cons;

452 
s32
 
x
;

454 
	`b¬r›r
();

455 iàĞ
	`bogus
(
´od
, 
cÚs
) )

456  
d©a_size
;

458 
x
 = 
´od
 - 
cÚs
;

459 iàĞ
x
 < 0 )

460 
x
 +ğ2*
d©a_size
;

462 
	`ASSERT
(
x
 >= 0);

463 
	`ASSERT
(
x
 <ğ
d©a_size
);

465  
x
;

466 
	}
}

468 
šlše
 
u32
 
	$ÿlc_by‹s_to_w¿p
(cÚ¡ 
t_buf
 *
buf
)

470 
u32
 
´od
 = 
buf
->´od, 
cÚs
 = buf->cons;

471 
s32
 
x
;

473 
	`b¬r›r
();

474 iàĞ
	`bogus
(
´od
, 
cÚs
) )

477 
x
 = 
d©a_size
 - 
´od
;

478 iàĞ
x
 <= 0 )

479 
x
 +ğ
d©a_size
;

481 
	`ASSERT
(
x
 > 0);

482 
	`ASSERT
(
x
 <ğ
d©a_size
);

484  
x
;

485 
	}
}

487 
šlše
 
u32
 
	$ÿlc_by‹s_ava
(cÚ¡ 
t_buf
 *
buf
)

489  
d©a_size
 - 
	`ÿlc_uncÚsumed_by‹s
(
buf
);

490 
	}
}

492 
šlše
 
t_»c
 *
	$Ãxt_»cÜd
(cÚ¡ 
t_buf
 *
buf
,

493 
ušt32_t
 *
Ãxt
)

495 
u32
 
x
 = 
buf
->
´od
, 
cÚs
 = buf->cons;

497 
	`b¬r›r
();

498 *
Ãxt
 = 
x
;

499 iàĞ!
tb_š™_dÚe
 || 
	`bogus
(
x
, 
cÚs
) )

500  
NULL
;

502 iàĞ
x
 >ğ
d©a_size
 )

503 
x
 -ğ
d©a_size
;

505 
	`ASSERT
(
x
 < 
d©a_size
);

507  (
t_»c
 *)&
	`this_ıu
(
t_d©a
)[
x
];

508 
	}
}

510 
šlše
 
	$__š£¹_»cÜd
(
t_buf
 *
buf
,

511 
ev’t
,

512 
exŒa
,

513 
boŞ_t
 
cyşes
,

514 
»c_size
,

515 cÚ¡ *
exŒa_d©a
)

517 
t_»c
 *
»c
;

518 *
d¡
;

519 
exŒa_wÜd
 = 
exŒa
 / (
u32
);

520 
loÿl_»c_size
 = 
	`ÿlc_»c_size
(
cyşes
, 
exŒa
);

521 
ušt32_t
 
Ãxt
;

523 
	`BUG_ON
(
loÿl_»c_size
 !ğ
»c_size
);

524 
	`BUG_ON
(
exŒa
 & 3);

526 
»c
 = 
	`Ãxt_»cÜd
(
buf
, &
Ãxt
);

527 iàĞ!
»c
 )

532 iàĞ(*)
»c
 + 
»c_size
 > 
	`this_ıu
(
t_d©a
è+ 
d©a_size
 )

534 iàĞ
	`´štk_¿‹lim™
() )

535 
	`´štk
(
XENLOG_WARNING


537 
__func__
, 
d©a_size
, 
Ãxt
, 
buf
->
cÚs
, 
»c_size
);

541 
»c
->
ev’t
 =ƒvent;

542 
»c
->
exŒa_u32
 = 
exŒa_wÜd
;

543 #ifdeà
ENABLE_MYXTRACE


544 ià(
exŒa_wÜd
 >ğ
TRACE_EXTRA_MAX
) {

545 
»c
->
exŒa_u32
 = 
TRACE_EXTRA_MAX
;

546 
	`ASSERT
(
cyşes
);

549 
d¡
 = (*)
»c
->
u
.
nocyşes
.
exŒa_u32
;

550 iàĞ(
»c
->
cyşes_šşuded
 = 
cyşes
) != 0 )

552 
u64
 
tsc
 = (u64)
	`g‘_cyşes
();

553 
»c
->
u
.
cyşes
.
cyşes_lo
 = (
ušt32_t
)
tsc
;

554 
»c
->
u
.
cyşes
.
cyşes_hi
 = (
ušt32_t
)(
tsc
 >> 32);

555 #ifdeà
ENABLE_MYXTRACE


556 ià(
exŒa_wÜd
 >ğ
TRACE_EXTRA_MAX
) {

557 
	`ASSERT
((
»c
->
u
.
cyşes
.
cyşes_hi
 >> 16) ==0);

558 
»c
->
u
.
cyşes
.
cyşes_hi
 |ğ(
exŒa_wÜd
 << 16);

561 
d¡
 = (*)
»c
->
u
.
cyşes
.
exŒa_u32
;

564 iàĞ
exŒa_d©a
 && 
exŒa
 )

565 
	`memıy
(
d¡
, 
exŒa_d©a
, 
exŒa
);

567 
	`wmb
();

569 
Ãxt
 +ğ
»c_size
;

570 iàĞ
Ãxt
 >ğ2*
d©a_size
 )

571 
Ãxt
 -ğ2*
d©a_size
;

572 
	`ASSERT
(
Ãxt
 < 2*
d©a_size
);

573 
buf
->
´od
 = 
Ãxt
;

574 
	}
}

576 
šlše
 
	$š£¹_w¿p_»cÜd
(
t_buf
 *
buf
,

577 
size
)

579 
u32
 
¥aû_Ëá
 = 
	`ÿlc_by‹s_to_w¿p
(
buf
);

580 
exŒa_¥aû
 = 
¥aû_Ëá
 - (
u32
);

581 
boŞ_t
 
cyşes
 = 0;

583 
	`BUG_ON
(
¥aû_Ëá
 > 
size
);

584 #ifdeà
ENABLE_MYXTRACE


585 
	`BUG_ON
(
¥aû_Ëá
 < (
u32
) );

588 #ifdeà
ENABLE_MYXTRACE


589 iàĞ(
exŒa_¥aû
/(
u32
)è>ğ
TRACE_EXTRA_MAX
 )

591 iàĞ(
exŒa_¥aû
/(
u32
)è> 
TRACE_EXTRA_MAX
 )

594 
cyşes
 = 1;

595 
exŒa_¥aû
 -ğ(
u64
);

596 
	`ASSERT
((
exŒa_¥aû
/(
u32
)è<ğ
TRACE_EXTRA_MAX
);

599 
	`__š£¹_»cÜd
(
buf
, 
TRC_TRACE_WRAP_BUFFER
, 
exŒa_¥aû
, 
cyşes
,

600 
¥aû_Ëá
, 
NULL
);

601 
	}
}

603 
	#LOST_REC_SIZE
 (4 + 8 + 16è

	)

605 
šlše
 
	$š£¹_lo¡_»cÜds
(
t_buf
 *
buf
)

608 
u32
 
lo¡_»cÜds
;

609 
u32
 
did
:16, 
vid
:16;

610 
u64
 
fœ¡_tsc
;

611 } 
	`__©Œibu‹__
((
·cked
)è
ed
;

613 
ed
.
vid
 = 
cu¼’t
->
vıu_id
;

614 
ed
.
did
 = 
cu¼’t
->
domaš
->
domaš_id
;

615 
ed
.
lo¡_»cÜds
 = 
	`this_ıu
(lost_records);

616 
ed
.
fœ¡_tsc
 = 
	`this_ıu
(
lo¡_»cÜds_fœ¡_tsc
);

618 
	`this_ıu
(
lo¡_»cÜds
) = 0;

620 
	`__š£¹_»cÜd
(
buf
, 
TRC_LOST_RECORDS
, (
ed
), 1 ,

621 
LOST_REC_SIZE
, &
ed
);

622 
	}
}

628 
	$Œaû_nÙify_dom0
(
unu£d
)

630 
	`£nd_gue¡_glob®_vœq
(
dom0
, 
VIRQ_TBUF
);

631 
	}
}

632 
DECLARE_TASKLET
(
Œaû_nÙify_dom0_skËt
, 
Œaû_nÙify_dom0
, 0);

643 
	$__Œaû_v¬
(
u32
 
ev’t
, 
boŞ_t
 
cyşes
, 
exŒa
,

644 cÚ¡ *
exŒa_d©a
)

646 
t_buf
 *
buf
;

647 
æags
;

648 
u32
 
by‹s_to_
, 
by‹s_to_w¿p
;

649 
»c_size
, 
tÙ®_size
;

650 
exŒa_wÜd
;

651 
boŞ_t
 
¡¬‹d_b–ow_highw©”
;

653 ifĞ!
tb_š™_dÚe
 )

657 
exŒa_wÜd
 = (
exŒa
 / (
u32
));

658 iàĞ(
exŒa
 % (
u32
)) != 0 )

659 
exŒa_wÜd
++;

661 #ifdeà
ENABLE_MYXTRACE


662 
	`ASSERT
(
exŒa
 % (
u32
) == 0);

663 
	`ASSERT
(
exŒa_wÜd
 < 
TRACE_EXTRA_MAX
 );

665 
	`ASSERT
(
exŒa_wÜd
 <ğ
TRACE_EXTRA_MAX
);

666 
exŒa_wÜd
 = 
	`mš_t
(,ƒxŒa_wÜd, 
TRACE_EXTRA_MAX
);

669 
exŒa
 = 
exŒa_wÜd
 * (
u32
);

671 iàĞ(
tb_ev’t_mask
 & 
ev’t
) == 0 )

675 iàĞ((
tb_ev’t_mask
 >> 
TRC_CLS_SHIFT
è& (
ev’t
 >> TRC_CLS_SHIFT)) == 0 )

679 iàĞ(((
tb_ev’t_mask
 >> 
TRC_SUBCLS_SHIFT
) & 0xf )

680 & ((
ev’t
 >> 
TRC_SUBCLS_SHIFT
) & 0xf )) == 0 )

683 iàĞ!
	`ıu_is£t
(
	`smp_´oûssÜ_id
(), 
tb_ıu_mask
) )

687 
	`rmb
();

689 
	`¥š_lock_œq§ve
(&
	`this_ıu
(
t_lock
), 
æags
);

691 
buf
 = 
	`this_ıu
(
t_bufs
);

693 iàĞ
	`uÆik–y
(!
buf
) )

696 
¡¬‹d_b–ow_highw©”
 = 0;

697 
uÆock
;

700 
¡¬‹d_b–ow_highw©”
 = (
	`ÿlc_uncÚsumed_by‹s
(
buf
è< 
t_buf_highw©”
);

703 
»c_size
 = 
	`ÿlc_»c_size
(
cyşes
, 
exŒa
);

706 
by‹s_to_
 = 
	`ÿlc_by‹s_ava
(
buf
);

709 
by‹s_to_w¿p
 = 
	`ÿlc_by‹s_to_w¿p
(
buf
);

715 
tÙ®_size
 = 0;

719 iàĞ
	`this_ıu
(
lo¡_»cÜds
) )

721 iàĞ
LOST_REC_SIZE
 > 
by‹s_to_w¿p
 )

723 
tÙ®_size
 +ğ
by‹s_to_w¿p
;

724 
by‹s_to_w¿p
 = 
d©a_size
;

726 
tÙ®_size
 +ğ
LOST_REC_SIZE
;

727 
by‹s_to_w¿p
 -ğ
LOST_REC_SIZE
;

730 iàĞ
by‹s_to_w¿p
 == 0 )

731 
by‹s_to_w¿p
 = 
d©a_size
;

734 iàĞ
»c_size
 > 
by‹s_to_w¿p
 )

736 
tÙ®_size
 +ğ
by‹s_to_w¿p
;

738 
tÙ®_size
 +ğ
»c_size
;

741 iàĞ
tÙ®_size
 > 
by‹s_to_
 )

743 iàĞ++
	`this_ıu
(
lo¡_»cÜds
) == 1 )

744 
	`this_ıu
(
lo¡_»cÜds_fœ¡_tsc
)=(
u64
)
	`g‘_cyşes
();

745 
¡¬‹d_b–ow_highw©”
 = 0;

746 
uÆock
;

752 
by‹s_to_w¿p
 = 
	`ÿlc_by‹s_to_w¿p
(
buf
);

754 iàĞ
	`this_ıu
(
lo¡_»cÜds
) )

756 iàĞ
LOST_REC_SIZE
 > 
by‹s_to_w¿p
 )

758 
	`š£¹_w¿p_»cÜd
(
buf
, 
LOST_REC_SIZE
);

759 
by‹s_to_w¿p
 = 
d©a_size
;

761 
	`š£¹_lo¡_»cÜds
(
buf
);

762 
by‹s_to_w¿p
 -ğ
LOST_REC_SIZE
;

765 iàĞ
by‹s_to_w¿p
 == 0 )

766 
by‹s_to_w¿p
 = 
d©a_size
;

769 iàĞ
»c_size
 > 
by‹s_to_w¿p
 )

770 
	`š£¹_w¿p_»cÜd
(
buf
, 
»c_size
);

773 
	`__š£¹_»cÜd
(
buf
, 
ev’t
, 
exŒa
, 
cyşes
, 
»c_size
, 
exŒa_d©a
);

775 
uÆock
:

776 
	`¥š_uÆock_œq»¡Üe
(&
	`this_ıu
(
t_lock
), 
æags
);

779 iàĞ
	`lik–y
(
buf
!=
NULL
)

780 && 
¡¬‹d_b–ow_highw©”


781 && (
	`ÿlc_uncÚsumed_by‹s
(
buf
è>ğ
t_buf_highw©”
) )

782 
	`skËt_scheduË
(&
Œaû_nÙify_dom0_skËt
);

783 
	}
}

	@unlzma.c

32 
	~"decom´ess.h
"

34 
	#MIN
(
a
, 
b
è((×è< (b)è? (aè: (b))

	)

36 
INIT
 
	$»ad_št
(*
±r
, 
size
)

38 
i
;

39 
»t
 = 0;

41 
i
 = 0; i < 
size
; i++)

42 
»t
 = (»ˆ<< 8è| 
±r
[
size
-
i
-1];

43  
»t
;

44 
	}
}

46 
	#ENDIAN_CONVERT
(
x
) \

47 
x
 = (
	`ty³of
(x))
	`»ad_št
((*)&x, (x))

	)

57 
	~<x’/comp”.h
>

59 
	#LZMA_IOBUF_SIZE
 0x10000

	)

61 
	src
 {

62 (*
	mfl
)(*, );

63 
ušt8_t
 *
	m±r
;

64 
ušt8_t
 *
	mbufãr
;

65 
ušt8_t
 *
	mbufãr_’d
;

66 
	mbufãr_size
;

67 
ušt32_t
 
	mcode
;

68 
ušt32_t
 
	m¿nge
;

69 
ušt32_t
 
	mbound
;

73 
	#RC_TOP_BITS
 24

	)

74 
	#RC_MOVE_BITS
 5

	)

75 
	#RC_MODEL_TOTAL_BITS
 11

	)

78 
	$nofl
(*
bufãr
, 
Ën
)

81 
	}
}

84 
INIT
 
	$rc_»ad
(
rc
 *rc)

86 
rc
->
bufãr_size
 =„c->
	`fl
((*ìc->
bufãr
, 
LZMA_IOBUF_SIZE
);

87 ià(
rc
->
bufãr_size
 <= 0)

88 
	`”rÜ
("unexpected EOF");

89 
rc
->
±r
 =„c->
bufãr
;

90 
rc
->
bufãr_’d
 =„c->
bufãr
 +„c->
bufãr_size
;

91 
	}
}

94 
šlše
 
INIT
 
rc_š™
(
rc
 *rc,

95 (*
fl
)(*, ),

96 *
bufãr
, 
bufãr_size
)

98 ià(
fl
)

99 
rc
->
fl
 = fill;

101 
rc
->
fl
 = 
nofl
;

102 
rc
->
bufãr
 = (
ušt8_t
 *)buffer;

103 
rc
->
bufãr_size
 = buffer_size;

104 
rc
->
bufãr_’d
 =„c->
bufãr
 +„c->
bufãr_size
;

105 
rc
->
±r
 =„c->
bufãr
;

107 
rc
->
code
 = 0;

108 
rc
->
¿nge
 = 0xFFFFFFFF;

109 
	}
}

111 
šlše
 
INIT
 
	$rc_š™_code
(
rc
 *rc)

113 
i
;

115 
i
 = 0; i < 5; i++) {

116 ià(
rc
->
±r
 >ğrc->
bufãr_’d
)

117 
	`rc_»ad
(
rc
);

118 
rc
->
code
 = (rc->cod<< 8è| *rc->
±r
++;

120 
	}
}

124 
šlše
 
INIT
 
	$rc_ä“
(
rc
 *rc)

126 
	`ä“
(
rc
->
bufãr
);

127 
	}
}

130 
INIT
 
	$rc_do_nÜm®ize
(
rc
 *rc)

132 ià(
rc
->
±r
 >ğrc->
bufãr_’d
)

133 
	`rc_»ad
(
rc
);

134 
rc
->
¿nge
 <<= 8;

135 
rc
->
code
 = (rc->cod<< 8è| *rc->
±r
++;

136 
	}
}

137 
šlše
 
INIT
 
	$rc_nÜm®ize
(
rc
 *rc)

139 ià(
rc
->
¿nge
 < (1 << 
RC_TOP_BITS
))

140 
	`rc_do_nÜm®ize
(
rc
);

141 
	}
}

147 
šlše
 
ušt32_t
 
INIT
 
	$rc_is_b™_0_h–³r
(
rc
 *rc, 
ušt16_t
 *
p
)

149 
	`rc_nÜm®ize
(
rc
);

150 
rc
->
bound
 = *
p
 * (rc->
¿nge
 >> 
RC_MODEL_TOTAL_BITS
);

151  
rc
->
bound
;

152 
	}
}

153 
šlše
 
INIT
 
	$rc_is_b™_0
(
rc
 *rc, 
ušt16_t
 *
p
)

155 
ušt32_t
 
t
 = 
	`rc_is_b™_0_h–³r
(
rc
, 
p
);

156  
rc
->
code
 < 
t
;

157 
	}
}

160 
šlše
 
INIT
 
	$rc_upd©e_b™_0
(
rc
 *rc, 
ušt16_t
 *
p
)

162 
rc
->
¿nge
 =„c->
bound
;

163 *
p
 +ğ((1 << 
RC_MODEL_TOTAL_BITS
è- *pè>> 
RC_MOVE_BITS
;

164 
	}
}

165 
šlše
 
	$rc_upd©e_b™_1
(
rc
 *rc, 
ušt16_t
 *
p
)

167 
rc
->
¿nge
 -ğrc->
bound
;

168 
rc
->
code
 -ğrc->
bound
;

169 *
p
 -ğ*°>> 
RC_MOVE_BITS
;

170 
	}
}

173 
INIT
 
	$rc_g‘_b™
(
rc
 *rc, 
ušt16_t
 *
p
, *
symbŞ
)

175 ià(
	`rc_is_b™_0
(
rc
, 
p
)) {

176 
	`rc_upd©e_b™_0
(
rc
, 
p
);

177 *
symbŞ
 *= 2;

180 
	`rc_upd©e_b™_1
(
rc
, 
p
);

181 *
symbŞ
 = *symbol * 2 + 1;

184 
	}
}

187 
šlše
 
INIT
 
	$rc_dœeù_b™
(
rc
 *rc)

189 
	`rc_nÜm®ize
(
rc
);

190 
rc
->
¿nge
 >>= 1;

191 ià(
rc
->
code
 >ğrc->
¿nge
) {

192 
rc
->
code
 -ğrc->
¿nge
;

196 
	}
}

199 
šlše
 
INIT


200 
	$rc_b™_Œ“_decode
(
rc
 *rc, 
ušt16_t
 *
p
, 
num_Ëv–s
, *
symbŞ
)

202 
i
 = 
num_Ëv–s
;

204 *
symbŞ
 = 1;

205 
i
--)

206 
	`rc_g‘_b™
(
rc
, 
p
 + *
symbŞ
, symbol);

207 *
symbŞ
 -ğ1 << 
num_Ëv–s
;

208 
	}
}

220 
	slzma_h—d”
 {

221 
ušt8_t
 
	mpos
;

222 
ušt32_t
 
	mdiù_size
;

223 
ušt64_t
 
	md¡_size
;

224 } 
__©Œibu‹__
 ((
·cked
)) ;

227 
	#LZMA_BASE_SIZE
 1846

	)

228 
	#LZMA_LIT_SIZE
 768

	)

230 
	#LZMA_NUM_POS_BITS_MAX
 4

	)

232 
	#LZMA_LEN_NUM_LOW_BITS
 3

	)

233 
	#LZMA_LEN_NUM_MID_BITS
 3

	)

234 
	#LZMA_LEN_NUM_HIGH_BITS
 8

	)

236 
	#LZMA_LEN_CHOICE
 0

	)

237 
	#LZMA_LEN_CHOICE_2
 (
LZMA_LEN_CHOICE
 + 1)

	)

238 
	#LZMA_LEN_LOW
 (
LZMA_LEN_CHOICE_2
 + 1)

	)

239 
	#LZMA_LEN_MID
 (
LZMA_LEN_LOW
 \

240 + (1 << (
LZMA_NUM_POS_BITS_MAX
 + 
LZMA_LEN_NUM_LOW_BITS
)))

	)

241 
	#LZMA_LEN_HIGH
 (
LZMA_LEN_MID
 \

242 +(1 << (
LZMA_NUM_POS_BITS_MAX
 + 
LZMA_LEN_NUM_MID_BITS
)))

	)

243 
	#LZMA_NUM_LEN_PROBS
 (
LZMA_LEN_HIGH
 + (1 << 
LZMA_LEN_NUM_HIGH_BITS
))

	)

245 
	#LZMA_NUM_STATES
 12

	)

246 
	#LZMA_NUM_LIT_STATES
 7

	)

248 
	#LZMA_START_POS_MODEL_INDEX
 4

	)

249 
	#LZMA_END_POS_MODEL_INDEX
 14

	)

250 
	#LZMA_NUM_FULL_DISTANCES
 (1 << (
LZMA_END_POS_MODEL_INDEX
 >> 1))

	)

252 
	#LZMA_NUM_POS_SLOT_BITS
 6

	)

253 
	#LZMA_NUM_LEN_TO_POS_STATES
 4

	)

255 
	#LZMA_NUM_ALIGN_BITS
 4

	)

257 
	#LZMA_MATCH_MIN_LEN
 2

	)

259 
	#LZMA_IS_MATCH
 0

	)

260 
	#LZMA_IS_REP
 (
LZMA_IS_MATCH
 + (
LZMA_NUM_STATES
 << 
LZMA_NUM_POS_BITS_MAX
))

	)

261 
	#LZMA_IS_REP_G0
 (
LZMA_IS_REP
 + 
LZMA_NUM_STATES
)

	)

262 
	#LZMA_IS_REP_G1
 (
LZMA_IS_REP_G0
 + 
LZMA_NUM_STATES
)

	)

263 
	#LZMA_IS_REP_G2
 (
LZMA_IS_REP_G1
 + 
LZMA_NUM_STATES
)

	)

264 
	#LZMA_IS_REP_0_LONG
 (
LZMA_IS_REP_G2
 + 
LZMA_NUM_STATES
)

	)

265 
	#LZMA_POS_SLOT
 (
LZMA_IS_REP_0_LONG
 \

266 + (
LZMA_NUM_STATES
 << 
LZMA_NUM_POS_BITS_MAX
))

	)

267 
	#LZMA_SPEC_POS
 (
LZMA_POS_SLOT
 \

268 +(
LZMA_NUM_LEN_TO_POS_STATES
 << 
LZMA_NUM_POS_SLOT_BITS
))

	)

269 
	#LZMA_ALIGN
 (
LZMA_SPEC_POS
 \

270 + 
LZMA_NUM_FULL_DISTANCES
 - 
LZMA_END_POS_MODEL_INDEX
)

	)

271 
	#LZMA_LEN_CODER
 (
LZMA_ALIGN
 + (1 << 
LZMA_NUM_ALIGN_BITS
))

	)

272 
	#LZMA_REP_LEN_CODER
 (
LZMA_LEN_CODER
 + 
LZMA_NUM_LEN_PROBS
)

	)

273 
	#LZMA_LITERAL
 (
LZMA_REP_LEN_CODER
 + 
LZMA_NUM_LEN_PROBS
)

	)

276 
	swr™”
 {

277 
ušt8_t
 *
	mbufãr
;

278 
ušt8_t
 
	m´evious_by‹
;

279 
size_t
 
	mbufãr_pos
;

280 
	mbufsize
;

281 
size_t
 
	mglob®_pos
;

282 (*
	mæush
)(*, );

283 
lzma_h—d”
 *
	mh—d”
;

286 
	sc¡©e
 {

287 
	m¡©e
;

288 
ušt32_t
 
	m»p0
, 
	m»p1
, 
	m»p2
, 
	m»p3
;

291 
šlše
 
size_t
 
INIT
 
	$g‘_pos
(
wr™”
 *
wr
)

294 
wr
->
glob®_pos
 + wr->
bufãr_pos
;

295 
	}
}

297 
šlše
 
ušt8_t
 
INIT
 
	$³ek_Şd_by‹
(
wr™”
 *
wr
,

298 
ušt32_t
 
offs
)

300 ià(!
wr
->
æush
) {

301 
št32_t
 
pos
;

302 
offs
 > 
wr
->
h—d”
->
diù_size
)

303 
offs
 -ğ
wr
->
h—d”
->
diù_size
;

304 
pos
 = 
wr
->
bufãr_pos
 - 
offs
;

305  
wr
->
bufãr
[
pos
];

307 
ušt32_t
 
pos
 = 
wr
->
bufãr_pos
 - 
offs
;

308 
pos
 >ğ
wr
->
h—d”
->
diù_size
)

309 
pos
 +ğ
wr
->
h—d”
->
diù_size
;

310  
wr
->
bufãr
[
pos
];

313 
	}
}

315 
šlše
 
INIT
 
	$wr™e_by‹
(
wr™”
 *
wr
, 
ušt8_t
 
by‹
)

317 
wr
->
bufãr
[wr->
bufãr_pos
++] = wr->
´evious_by‹
 = 
by‹
;

318 ià(
wr
->
æush
 && wr->
bufãr_pos
 =ğwr->
h—d”
->
diù_size
) {

319 
wr
->
bufãr_pos
 = 0;

320 
wr
->
glob®_pos
 +ğwr->
h—d”
->
diù_size
;

321 
wr
->
	`æush
((*)wr->
bufãr
, wr->
h—d”
->
diù_size
);

323 
	}
}

326 
šlše
 
INIT
 
	$cİy_by‹
(
wr™”
 *
wr
, 
ušt32_t
 
offs
)

328 
	`wr™e_by‹
(
wr
, 
	`³ek_Şd_by‹
(wr, 
offs
));

329 
	}
}

331 
šlše
 
INIT
 
	$cİy_by‹s
(
wr™”
 *
wr
,

332 
ušt32_t
 
»p0
, 
Ën
)

335 
	`cİy_by‹
(
wr
, 
»p0
);

336 
Ën
--;

337 } 
Ën
 !ğ0 && 
wr
->
bufãr_pos
 < wr->
h—d”
->
d¡_size
);

338 
	}
}

340 
šlše
 
INIT
 
	$´oûss_b™0
(
wr™”
 *
wr
, 
rc
 *rc,

341 
c¡©e
 *
c¡
, 
ušt16_t
 *
p
,

342 
pos_¡©e
, 
ušt16_t
 *
´ob
,

343 
lc
, 
ušt32_t
 
l™”®_pos_mask
) {

344 
mi
 = 1;

345 
	`rc_upd©e_b™_0
(
rc
, 
´ob
);

346 
´ob
 = (
p
 + 
LZMA_LITERAL
 +

347 (
LZMA_LIT_SIZE


348 * (((
	`g‘_pos
(
wr
è& 
l™”®_pos_mask
è<< 
lc
)

349 + (
wr
->
´evious_by‹
 >> (8 - 
lc
))))

352 ià(
c¡
->
¡©e
 >ğ
LZMA_NUM_LIT_STATES
) {

353 
m©ch_by‹
 = 
	`³ek_Şd_by‹
(
wr
, 
c¡
->
»p0
);

355 
b™
;

356 
ušt16_t
 *
´ob_l™
;

358 
m©ch_by‹
 <<= 1;

359 
b™
 = 
m©ch_by‹
 & 0x100;

360 
´ob_l™
 = 
´ob
 + 0x100 + 
b™
 + 
mi
;

361 ià(
	`rc_g‘_b™
(
rc
, 
´ob_l™
, &
mi
)) {

362 ià(!
b™
)

365 ià(
b™
)

368 } 
mi
 < 0x100);

370 
mi
 < 0x100) {

371 
ušt16_t
 *
´ob_l™
 = 
´ob
 + 
mi
;

372 
	`rc_g‘_b™
(
rc
, 
´ob_l™
, &
mi
);

374 
	`wr™e_by‹
(
wr
, 
mi
);

375 ià(
c¡
->
¡©e
 < 4)

376 
c¡
->
¡©e
 = 0;

377 ià(
c¡
->
¡©e
 < 10)

378 
c¡
->
¡©e
 -= 3;

380 
c¡
->
¡©e
 -= 6;

381 
	}
}

383 
šlše
 
INIT
 
	$´oûss_b™1
(
wr™”
 *
wr
, 
rc
 *rc,

384 
c¡©e
 *
c¡
, 
ušt16_t
 *
p
,

385 
pos_¡©e
, 
ušt16_t
 *
´ob
) {

386 
off£t
;

387 
ušt16_t
 *
´ob_Ën
;

388 
num_b™s
;

389 
Ën
;

391 
	`rc_upd©e_b™_1
(
rc
, 
´ob
);

392 
´ob
 = 
p
 + 
LZMA_IS_REP
 + 
c¡
->
¡©e
;

393 ià(
	`rc_is_b™_0
(
rc
, 
´ob
)) {

394 
	`rc_upd©e_b™_0
(
rc
, 
´ob
);

395 
c¡
->
»p3
 = c¡->
»p2
;

396 
c¡
->
»p2
 = c¡->
»p1
;

397 
c¡
->
»p1
 = c¡->
»p0
;

398 
c¡
->
¡©e
 = c¡->¡©< 
LZMA_NUM_LIT_STATES
 ? 0 : 3;

399 
´ob
 = 
p
 + 
LZMA_LEN_CODER
;

401 
	`rc_upd©e_b™_1
(
rc
, 
´ob
);

402 
´ob
 = 
p
 + 
LZMA_IS_REP_G0
 + 
c¡
->
¡©e
;

403 ià(
	`rc_is_b™_0
(
rc
, 
´ob
)) {

404 
	`rc_upd©e_b™_0
(
rc
, 
´ob
);

405 
´ob
 = (
p
 + 
LZMA_IS_REP_0_LONG


406 + (
c¡
->
¡©e
 <<

407 
LZMA_NUM_POS_BITS_MAX
) +

408 
pos_¡©e
);

409 ià(
	`rc_is_b™_0
(
rc
, 
´ob
)) {

410 
	`rc_upd©e_b™_0
(
rc
, 
´ob
);

412 
c¡
->
¡©e
 = c¡->¡©< 
LZMA_NUM_LIT_STATES
 ?

414 
	`cİy_by‹
(
wr
, 
c¡
->
»p0
);

417 
	`rc_upd©e_b™_1
(
rc
, 
´ob
);

420 
ušt32_t
 
di¡ªû
;

422 
	`rc_upd©e_b™_1
(
rc
, 
´ob
);

423 
´ob
 = 
p
 + 
LZMA_IS_REP_G1
 + 
c¡
->
¡©e
;

424 ià(
	`rc_is_b™_0
(
rc
, 
´ob
)) {

425 
	`rc_upd©e_b™_0
(
rc
, 
´ob
);

426 
di¡ªû
 = 
c¡
->
»p1
;

428 
	`rc_upd©e_b™_1
(
rc
, 
´ob
);

429 
´ob
 = 
p
 + 
LZMA_IS_REP_G2
 + 
c¡
->
¡©e
;

430 ià(
	`rc_is_b™_0
(
rc
, 
´ob
)) {

431 
	`rc_upd©e_b™_0
(
rc
, 
´ob
);

432 
di¡ªû
 = 
c¡
->
»p2
;

434 
	`rc_upd©e_b™_1
(
rc
, 
´ob
);

435 
di¡ªû
 = 
c¡
->
»p3
;

436 
c¡
->
»p3
 = c¡->
»p2
;

438 
c¡
->
»p2
 = c¡->
»p1
;

440 
c¡
->
»p1
 = c¡->
»p0
;

441 
c¡
->
»p0
 = 
di¡ªû
;

443 
c¡
->
¡©e
 = c¡->¡©< 
LZMA_NUM_LIT_STATES
 ? 8 : 11;

444 
´ob
 = 
p
 + 
LZMA_REP_LEN_CODER
;

447 
´ob_Ën
 = 
´ob
 + 
LZMA_LEN_CHOICE
;

448 ià(
	`rc_is_b™_0
(
rc
, 
´ob_Ën
)) {

449 
	`rc_upd©e_b™_0
(
rc
, 
´ob_Ën
);

450 
´ob_Ën
 = (
´ob
 + 
LZMA_LEN_LOW


451 + (
pos_¡©e
 <<

452 
LZMA_LEN_NUM_LOW_BITS
));

453 
off£t
 = 0;

454 
num_b™s
 = 
LZMA_LEN_NUM_LOW_BITS
;

456 
	`rc_upd©e_b™_1
(
rc
, 
´ob_Ën
);

457 
´ob_Ën
 = 
´ob
 + 
LZMA_LEN_CHOICE_2
;

458 ià(
	`rc_is_b™_0
(
rc
, 
´ob_Ën
)) {

459 
	`rc_upd©e_b™_0
(
rc
, 
´ob_Ën
);

460 
´ob_Ën
 = (
´ob
 + 
LZMA_LEN_MID


461 + (
pos_¡©e
 <<

462 
LZMA_LEN_NUM_MID_BITS
));

463 
off£t
 = 1 << 
LZMA_LEN_NUM_LOW_BITS
;

464 
num_b™s
 = 
LZMA_LEN_NUM_MID_BITS
;

466 
	`rc_upd©e_b™_1
(
rc
, 
´ob_Ën
);

467 
´ob_Ën
 = 
´ob
 + 
LZMA_LEN_HIGH
;

468 
off£t
 = ((1 << 
LZMA_LEN_NUM_LOW_BITS
)

469 + (1 << 
LZMA_LEN_NUM_MID_BITS
));

470 
num_b™s
 = 
LZMA_LEN_NUM_HIGH_BITS
;

474 
	`rc_b™_Œ“_decode
(
rc
, 
´ob_Ën
, 
num_b™s
, &
Ën
);

475 
Ën
 +ğ
off£t
;

477 ià(
c¡
->
¡©e
 < 4) {

478 
pos_¦Ù
;

480 
c¡
->
¡©e
 +ğ
LZMA_NUM_LIT_STATES
;

481 
´ob
 =

482 
p
 + 
LZMA_POS_SLOT
 +

483 ((
Ën
 <

484 
LZMA_NUM_LEN_TO_POS_STATES
 ? 
Ën
 :

485 
LZMA_NUM_LEN_TO_POS_STATES
 - 1)

486 << 
LZMA_NUM_POS_SLOT_BITS
);

487 
	`rc_b™_Œ“_decode
(
rc
, 
´ob
,

488 
LZMA_NUM_POS_SLOT_BITS
,

489 &
pos_¦Ù
);

490 ià(
pos_¦Ù
 >ğ
LZMA_START_POS_MODEL_INDEX
) {

491 
i
, 
mi
;

492 
num_b™s
 = (
pos_¦Ù
 >> 1) - 1;

493 
c¡
->
»p0
 = 2 | (
pos_¦Ù
 & 1);

494 ià(
pos_¦Ù
 < 
LZMA_END_POS_MODEL_INDEX
) {

495 
c¡
->
»p0
 <<ğ
num_b™s
;

496 
´ob
 = 
p
 + 
LZMA_SPEC_POS
 +

497 
c¡
->
»p0
 - 
pos_¦Ù
 - 1;

499 
num_b™s
 -ğ
LZMA_NUM_ALIGN_BITS
;

500 
num_b™s
--)

501 
c¡
->
»p0
 = (cst->rep0 << 1) |

502 
	`rc_dœeù_b™
(
rc
);

503 
´ob
 = 
p
 + 
LZMA_ALIGN
;

504 
c¡
->
»p0
 <<ğ
LZMA_NUM_ALIGN_BITS
;

505 
num_b™s
 = 
LZMA_NUM_ALIGN_BITS
;

507 
i
 = 1;

508 
mi
 = 1;

509 
num_b™s
--) {

510 ià(
	`rc_g‘_b™
(
rc
, 
´ob
 + 
mi
, &mi))

511 
c¡
->
»p0
 |ğ
i
;

512 
i
 <<= 1;

515 
c¡
->
»p0
 = 
pos_¦Ù
;

516 ià(++(
c¡
->
»p0
) == 0)

520 
Ën
 +ğ
LZMA_MATCH_MIN_LEN
;

522 
	`cİy_by‹s
(
wr
, 
c¡
->
»p0
, 
Ën
);

523 
	}
}

527 
STATIC
 
INIT
 
uÆzma
(*
buf
, 
š_Ën
,

528 (*
fl
)(*, ),

529 (*
æush
)(*, ),

530 *
ouut
,

531 *
po¥
,

532 (*
”rÜ_â
)(cÚ¡ *
x
)

535 
lzma_h—d”
 
h—d”
;

536 
lc
, 
pb
, 
Í
;

537 
ušt32_t
 
pos_¡©e_mask
;

538 
ušt32_t
 
l™”®_pos_mask
;

539 
ušt16_t
 *
p
;

540 
num_´obs
;

541 
rc
„c;

542 
i
, 
mi
;

543 
wr™”
 
wr
;

544 
c¡©e
 
c¡
;

545 *
šbuf
;

546 
»t
 = -1;

548 
	`£t_”rÜ_â
(
”rÜ_â
);

550 ià(
buf
)

551 
šbuf
 = 
buf
;

553 
šbuf
 = 
	`m®loc
(
LZMA_IOBUF_SIZE
);

554 ià(!
šbuf
) {

555 
	`”rÜ
("Could‚ot‡llocate input bufer");

556 
ex™_0
;

559 
c¡
.
¡©e
 = 0;

560 
c¡
.
»p0
 = c¡.
»p1
 = c¡.
»p2
 = c¡.
»p3
 = 1;

562 
wr
.
h—d”
 = &header;

563 
wr
.
æush
 = flush;

564 
wr
.
glob®_pos
 = 0;

565 
wr
.
´evious_by‹
 = 0;

566 
wr
.
bufãr_pos
 = 0;

568 
	`rc_š™
(&
rc
, 
fl
, 
šbuf
, 
š_Ën
);

570 
i
 = 0; i < (
h—d”
); i++) {

571 ià(
rc
.
±r
 >ğrc.
bufãr_’d
)

572 
	`rc_»ad
(&
rc
);

573 ((*)&
h—d”
)[
i
] = *
rc
.
±r
++;

576 ià(
h—d”
.
pos
 >= (9 * 5 * 5))

577 
	`”rÜ
("bad header");

579 
mi
 = 0;

580 
lc
 = 
h—d”
.
pos
;

581 
lc
 >= 9) {

582 
mi
++;

583 
lc
 -= 9;

585 
pb
 = 0;

586 
Í
 = 
mi
;

587 
Í
 >= 5) {

588 
pb
++;

589 
Í
 -= 5;

591 
pos_¡©e_mask
 = (1 << 
pb
) - 1;

592 
l™”®_pos_mask
 = (1 << 
Í
) - 1;

594 
	`ENDIAN_CONVERT
(
h—d”
.
diù_size
);

595 
	`ENDIAN_CONVERT
(
h—d”
.
d¡_size
);

597 ià(
h—d”
.
diù_size
 == 0)

598 
h—d”
.
diù_size
 = 1;

600 ià(
ouut
)

601 
wr
.
bufãr
 = 
ouut
;

603 
wr
.
bufsize
 = 
	`MIN
(
h—d”
.
d¡_size
, h—d”.
diù_size
);

604 
wr
.
bufãr
 = 
	`Ïrge_m®loc
(wr.
bufsize
);

606 ià(
wr
.
bufãr
 =ğ
NULL
)

607 
ex™_1
;

609 
num_´obs
 = 
LZMA_BASE_SIZE
 + (
LZMA_LIT_SIZE
 << (
lc
 + 
Í
));

610 
p
 = (
ušt16_t
 *è
	`Ïrge_m®loc
(
num_´obs
 * (*p));

611 ià(
p
 == 0)

612 
ex™_2
;

613 
num_´obs
 = 
LZMA_LITERAL
 + (
LZMA_LIT_SIZE
 << (
lc
 + 
Í
));

614 
i
 = 0; i < 
num_´obs
; i++)

615 
p
[
i
] = (1 << 
RC_MODEL_TOTAL_BITS
) >> 1;

617 
	`rc_š™_code
(&
rc
);

619 
	`g‘_pos
(&
wr
è< 
h—d”
.
d¡_size
) {

620 
pos_¡©e
 = 
	`g‘_pos
(&
wr
è& 
pos_¡©e_mask
;

621 
ušt16_t
 *
´ob
 = 
p
 + 
LZMA_IS_MATCH
 +

622 (
c¡
.
¡©e
 << 
LZMA_NUM_POS_BITS_MAX
è+ 
pos_¡©e
;

623 ià(
	`rc_is_b™_0
(&
rc
, 
´ob
))

624 
	`´oûss_b™0
(&
wr
, &
rc
, &
c¡
, 
p
, 
pos_¡©e
, 
´ob
,

625 
lc
, 
l™”®_pos_mask
);

627 
	`´oûss_b™1
(&
wr
, &
rc
, &
c¡
, 
p
, 
pos_¡©e
, 
´ob
);

628 ià(
c¡
.
»p0
 == 0)

633 ià(
po¥
)

634 *
po¥
 = 
rc
.
±r
-rc.
bufãr
;

635 ià(
wr
.
æush
)

636 
wr
.
	`æush
(wr.
bufãr
, wr.
bufãr_pos
);

637 
»t
 = 0;

638 
	`Ïrge_ä“
(
p
);

639 
ex™_2
:

640 ià(!
ouut
)

641 
	`Ïrge_ä“
(
wr
.
bufãr
);

642 
ex™_1
:

643 ià(!
buf
)

644 
	`ä“
(
šbuf
);

645 
ex™_0
:

646  
»t
;

647 
	}
}

	@unlzo.c

33 
	~"decom´ess.h
"

34 
	~<x’/lzo.h
>

35 
	~<asm/by‹Üd”.h
>

38 
šlše
 
u16
 
INIT
 
	$g‘_uÇligÃd_be16
(*
p
)

40  
	`be16_to_ıup
(
p
);

41 
	}
}

43 
šlše
 
u32
 
INIT
 
	$g‘_uÇligÃd_be32
(*
p
)

45  
	`be32_to_ıup
(
p
);

46 
	}
}

48 
	~<asm/uÇligÃd.h
>

50 
šlše
 
u16
 
INIT
 
	$g‘_uÇligÃd_be16
(*
p
)

52  
	`be16_to_ıu
(
	`__g‘_uÇligÃd
(
p
, 2));

53 
	}
}

55 
šlše
 
u32
 
INIT
 
	$g‘_uÇligÃd_be32
(*
p
)

57  
	`be32_to_ıu
(
	`__g‘_uÇligÃd
(
p
, 4));

58 
	}
}

61 cÚ¡ 
	glzİ_magic
[] = {

64 
	#LZO_BLOCK_SIZE
 (256*1024l)

	)

65 
	#HEADER_HAS_FILTER
 0x00000800L

	)

67 
INIT
 
	$·r£_h—d”
(
u8
 *
šput
, u8 *
sk
)

69 
l
;

70 
u8
 *
·r£
 = 
šput
;

71 
u8
 
Ëv–
 = 0;

72 
u16
 
v”siÚ
;

75 
l
 = 0;† < 9;†++) {

76 ià(*
·r£
++ !ğ
lzİ_magic
[
l
])

82 
v”siÚ
 = 
	`g‘_uÇligÃd_be16
(
·r£
);

83 
·r£
 += 7;

84 ià(
v”siÚ
 >= 0x0940)

85 
Ëv–
 = *
·r£
++;

86 ià(
	`g‘_uÇligÃd_be32
(
·r£
è& 
HEADER_HAS_FILTER
)

87 
·r£
 += 8;

89 
·r£
 += 4;

92 
·r£
 += 8;

93 ià(
v”siÚ
 >= 0x0940)

94 
·r£
 += 4;

96 
l
 = *
·r£
++;

98 
·r£
 +ğ
l
 + 4;

100 *
sk
 = 
·r£
 - 
šput
;

102 
	}
}

104 
STATIC
 
INIT
 
uÆzo
(
u8
 *
šput
, 
š_Ën
,

105 (*
fl
) (*, ),

106 (*
æush
) (*, ),

107 
u8
 *
ouut
, *
po¥
,

108 (*
”rÜ_â
è(cÚ¡ *
x
))

110 
u8
 
sk
 = 0, 
r
 = 0;

111 
u32
 
¤c_Ën
, 
d¡_Ën
;

112 
size_t
 
tmp
;

113 
u8
 *
š_buf
, *
š_buf_§ve
, *
out_buf
;

114 
»t
 = -1;

116 
	`£t_”rÜ_â
(
”rÜ_â
);

118 ià(
ouut
) {

119 
out_buf
 = 
ouut
;

120 } ià(!
æush
) {

121 
	`”rÜ
("NULL output…ointer‡nd‚o flush function…rovided");

122 
ex™
;

124 
out_buf
 = 
	`m®loc
(
LZO_BLOCK_SIZE
);

125 ià(!
out_buf
) {

126 
	`”rÜ
("Could‚ot‡llocate output buffer");

127 
ex™
;

131 ià(
šput
 && 
fl
) {

132 
	`”rÜ
("Both input…ointer‡nd fill function…rovided, don't know whato do");

133 
ex™_1
;

134 } ià(
šput
) {

135 
š_buf
 = 
šput
;

136 } ià(!
fl
 || !
po¥
) {

137 
	`”rÜ
("NULL input…ointer‡nd missing…osition…ointer or fill function");

138 
ex™_1
;

140 
š_buf
 = 
	`m®loc
(
	`lzo1x_wÜ¡_com´ess
(
LZO_BLOCK_SIZE
));

141 ià(!
š_buf
) {

142 
	`”rÜ
("Could‚ot‡llocate input buffer");

143 
ex™_1
;

146 
š_buf_§ve
 = 
š_buf
;

148 ià(
po¥
)

149 *
po¥
 = 0;

151 ià(
fl
)

152 
	`fl
(
š_buf
, 
	`lzo1x_wÜ¡_com´ess
(
LZO_BLOCK_SIZE
));

154 ià(!
	`·r£_h—d”
(
šput
, &
sk
)) {

155 
	`”rÜ
("invalid header");

156 
ex™_2
;

158 
š_buf
 +ğ
sk
;

160 ià(
po¥
)

161 *
po¥
 = 
sk
;

165 
d¡_Ën
 = 
	`g‘_uÇligÃd_be32
(
š_buf
);

166 
š_buf
 += 4;

169 ià(
d¡_Ën
 == 0) {

170 ià(
po¥
)

171 *
po¥
 += 4;

175 ià(
d¡_Ën
 > 
LZO_BLOCK_SIZE
) {

176 
	`”rÜ
("dest†en†ongerhan block size");

177 
ex™_2
;

181 
¤c_Ën
 = 
	`g‘_uÇligÃd_be32
(
š_buf
);

182 
š_buf
 += 8;

184 ià(
¤c_Ën
 <ğ0 || src_ËÀ> 
d¡_Ën
) {

185 
	`”rÜ
("file corrupted");

186 
ex™_2
;

190 
tmp
 = 
d¡_Ën
;

195 ià(
	`uÆik–y
(
d¡_Ën
 =ğ
¤c_Ën
))

196 
	`memıy
(
out_buf
, 
š_buf
, 
¤c_Ën
);

198 
r
 = 
	`lzo1x_decom´ess_§ã
(
š_buf
, 
¤c_Ën
,

199 
out_buf
, &
tmp
);

201 ià(
r
 !ğ
LZO_E_OK
 || 
d¡_Ën
 !ğ
tmp
) {

202 
	`”rÜ
("Compressed data violation");

203 
ex™_2
;

207 ià(
æush
)

208 
	`æush
(
out_buf
, 
d¡_Ën
);

209 ià(
ouut
)

210 
out_buf
 +ğ
d¡_Ën
;

211 ià(
po¥
)

212 *
po¥
 +ğ
¤c_Ën
 + 12;

213 ià(
fl
) {

214 
š_buf
 = 
š_buf_§ve
;

215 
	`fl
(
š_buf
, 
	`lzo1x_wÜ¡_com´ess
(
LZO_BLOCK_SIZE
));

217 
š_buf
 +ğ
¤c_Ën
;

220 
»t
 = 0;

221 
ex™_2
:

222 ià(!
šput
)

223 
	`ä“
(
š_buf
);

224 
ex™_1
:

225 ià(!
ouut
)

226 
	`ä“
(
out_buf
);

227 
ex™
:

228  
»t
;

229 
	}
}

	@version.c

1 
	~<x’/compe.h
>

2 
	~<x’/v”siÚ.h
>

4 cÚ¡ *
	$x’_compe_d©e
()

6  
XEN_COMPILE_DATE
;

7 
	}
}

9 cÚ¡ *
	$x’_compe_time
()

11  
XEN_COMPILE_TIME
;

12 
	}
}

14 cÚ¡ *
	$x’_compe_by
()

16  
XEN_COMPILE_BY
;

17 
	}
}

19 cÚ¡ *
	$x’_compe_domaš
()

21  
XEN_COMPILE_DOMAIN
;

22 
	}
}

24 cÚ¡ *
	$x’_compe_ho¡
()

26  
XEN_COMPILE_HOST
;

27 
	}
}

29 cÚ¡ *
	$x’_comp”
()

31  
XEN_COMPILER
;

32 
	}
}

34 
	$x’_majÜ_v”siÚ
()

36  
XEN_VERSION
;

37 
	}
}

39 
	$x’_mšÜ_v”siÚ
()

41  
XEN_SUBVERSION
;

42 
	}
}

44 cÚ¡ *
	$x’_exŒa_v”siÚ
()

46  
XEN_EXTRAVERSION
;

47 
	}
}

49 cÚ¡ *
	$x’_chªge£t
()

51  
XEN_CHANGESET
;

52 
	}
}

54 cÚ¡ *
	$x’_bªÃr
()

56  
XEN_BANNER
;

57 
	}
}

	@vsprintf.c

19 
	~<x’/ùy³.h
>

20 
	~<x’/lib.h
>

21 
	~<asm/div64.h
>

22 
	~<asm/·ge.h
>

30 
	$sim¶e_¡¹oul
(

31 cÚ¡ *
ı
, cÚ¡ **
’dp
, 
ba£
)

33 
»suÉ
 = 0,
v®ue
;

35 ià(!
ba£
) {

36 
ba£
 = 10;

37 ià(*
ı
 == '0') {

38 
ba£
 = 8;

39 
ı
++;

40 ià((
	`touµ”
(*
ı
è=ğ'X'è&& 
	`isxdig™
(cp[1])) {

41 
ı
++;

42 
ba£
 = 16;

45 } ià(
ba£
 == 16) {

46 ià(
ı
[0] =ğ'0' && 
	`touµ”
(cp[1]) == 'X')

47 
ı
 += 2;

49 
	`isxdig™
(*
ı
) &&

50 (
v®ue
 = 
	`isdig™
(*
ı
è? *ı-'0' : 
	`touµ”
(*ı)-'A'+10è< 
ba£
) {

51 
»suÉ
 =„esuÉ*
ba£
 + 
v®ue
;

52 
ı
++;

54 ià(
’dp
)

55 *
’dp
 = 
ı
;

56  
»suÉ
;

57 
	}
}

59 
EXPORT_SYMBOL
(
sim¶e_¡¹oul
);

67 
	$sim¶e_¡¹Ş
(cÚ¡ *
ı
, cÚ¡ **
’dp
, 
ba£
)

69 if(*
ı
=='-')

70  -
	`sim¶e_¡¹oul
(
ı
+1,
’dp
,
ba£
);

71  
	`sim¶e_¡¹oul
(
ı
,
’dp
,
ba£
);

72 
	}
}

74 
EXPORT_SYMBOL
(
sim¶e_¡¹Ş
);

82 
	$sim¶e_¡¹ouÎ
(

83 cÚ¡ *
ı
, cÚ¡ **
’dp
, 
ba£
)

85 
»suÉ
 = 0,
v®ue
;

87 ià(!
ba£
) {

88 
ba£
 = 10;

89 ià(*
ı
 == '0') {

90 
ba£
 = 8;

91 
ı
++;

92 ià((
	`touµ”
(*
ı
è=ğ'X'è&& 
	`isxdig™
(cp[1])) {

93 
ı
++;

94 
ba£
 = 16;

97 } ià(
ba£
 == 16) {

98 ià(
ı
[0] =ğ'0' && 
	`touµ”
(cp[1]) == 'X')

99 
ı
 += 2;

101 
	`isxdig™
(*
ı
è&& (
v®ue
 = 
	`isdig™
(*ıè? *ı-'0' : (
	`i¦ow”
(*cp)

102 ? 
	`touµ”
(*
ı
è: *ı)-'A'+10è< 
ba£
) {

103 
»suÉ
 =„esuÉ*
ba£
 + 
v®ue
;

104 
ı
++;

106 ià(
’dp
)

107 *
’dp
 = 
ı
;

108  
»suÉ
;

109 
	}
}

111 
EXPORT_SYMBOL
(
sim¶e_¡¹ouÎ
);

119 
	$sim¶e_¡¹Şl
(cÚ¡ *
ı
,cÚ¡ **
’dp
,
ba£
)

121 if(*
ı
=='-')

122  -
	`sim¶e_¡¹ouÎ
(
ı
+1,
’dp
,
ba£
);

123  
	`sim¶e_¡¹ouÎ
(
ı
,
’dp
,
ba£
);

124 
	}
}

126 
	$sk_©oi
(cÚ¡ **
s
)

128 
i
=0;

130 
	`isdig™
(**
s
))

131 
i
 = i*10 + *((*
s
)++) - '0';

132  
i
;

133 
	}
}

135 
	#ZEROPAD
 1

	)

136 
	#SIGN
 2

	)

137 
	#PLUS
 4

	)

138 
	#SPACE
 8

	)

139 
	#LEFT
 16

	)

140 
	#SPECIAL
 32

	)

141 
	#LARGE
 64

	)

143 *
	$numb”
(

144 *
buf
, *
’d
, 
num
,

145 
ba£
, 
size
, 
´ecisiÚ
, 
ty³
)

147 
c
,
sign
,
tmp
[66];

148 cÚ¡ *
dig™s
;

149 cÚ¡ 
sm®l_dig™s
[] = "0123456789abcdefghijklmnopqrstuvwxyz";

150 cÚ¡ 
Ïrge_dig™s
[] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

151 
i
;

153 
dig™s
 = (
ty³
 & 
LARGE
è? 
Ïrge_dig™s
 : 
sm®l_dig™s
;

154 ià(
ty³
 & 
LEFT
)

155 
ty³
 &ğ~
ZEROPAD
;

156 ià(
ba£
 < 2 || base > 36)

157  
NULL
;

158 
c
 = (
ty³
 & 
ZEROPAD
) ? '0' : ' ';

159 
sign
 = 0;

160 ià(
ty³
 & 
SIGN
) {

161 ià((sigÃd è
num
 < 0) {

162 
sign
 = '-';

163 
num
 = - (signed )‚um;

164 
size
--;

165 } ià(
ty³
 & 
PLUS
) {

166 
sign
 = '+';

167 
size
--;

168 } ià(
ty³
 & 
SPACE
) {

169 
sign
 = ' ';

170 
size
--;

173 ià(
ty³
 & 
SPECIAL
) {

174 ià(
ba£
 == 16)

175 
size
 -= 2;

176 ià(
ba£
 == 8)

177 
size
--;

179 
i
 = 0;

180 ià(
num
 == 0)

181 
tmp
[
i
++]='0';

182 
num
 != 0)

183 
tmp
[
i
++] = 
dig™s
[
	`do_div
(
num
,
ba£
)];

184 ià(
i
 > 
´ecisiÚ
)

185 
´ecisiÚ
 = 
i
;

186 
size
 -ğ
´ecisiÚ
;

187 ià(!(
ty³
&(
ZEROPAD
+
LEFT
))) {

188 
size
-->0) {

189 ià(
buf
 <ğ
’d
)

190 *
buf
 = ' ';

191 ++
buf
;

194 ià(
sign
) {

195 ià(
buf
 <ğ
’d
)

196 *
buf
 = 
sign
;

197 ++
buf
;

199 ià(
ty³
 & 
SPECIAL
) {

200 ià(
ba£
==8) {

201 ià(
buf
 <ğ
’d
)

202 *
buf
 = '0';

203 ++
buf
;

204 } ià(
ba£
==16) {

205 ià(
buf
 <ğ
’d
)

206 *
buf
 = '0';

207 ++
buf
;

208 ià(
buf
 <ğ
’d
)

209 *
buf
 = 
dig™s
[33];

210 ++
buf
;

213 ià(!(
ty³
 & 
LEFT
)) {

214 
size
-- > 0) {

215 ià(
buf
 <ğ
’d
)

216 *
buf
 = 
c
;

217 ++
buf
;

220 
i
 < 
´ecisiÚ
--) {

221 ià(
buf
 <ğ
’d
)

222 *
buf
 = '0';

223 ++
buf
;

225 
i
-- > 0) {

226 ià(
buf
 <ğ
’d
)

227 *
buf
 = 
tmp
[
i
];

228 ++
buf
;

230 
size
-- > 0) {

231 ià(
buf
 <ğ
’d
)

232 *
buf
 = ' ';

233 ++
buf
;

235  
buf
;

236 
	}
}

256 
	$v¢´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, 
va_li¡
 
¬gs
)

258 
Ën
;

259 
num
;

260 
i
, 
ba£
;

261 *
¡r
, *
’d
, 
c
;

262 cÚ¡ *
s
;

264 
æags
;

266 
f›ld_width
;

267 
´ecisiÚ
;

269 
qu®if›r
;

274 
	`BUG_ON
((()
size
 < 0) || (()size != size));

276 
¡r
 = 
buf
;

277 
’d
 = 
buf
 + 
size
 - 1;

279 ià(
’d
 < 
buf
 - 1) {

280 
’d
 = ((*) -1);

281 
size
 = 
’d
 - 
buf
 + 1;

284 ; *
fmt
 ; ++fmt) {

285 ià(*
fmt
 != '%') {

286 ià(
¡r
 <ğ
’d
)

287 *
¡r
 = *
fmt
;

288 ++
¡r
;

293 
æags
 = 0;

294 
»³©
:

295 ++
fmt
;

296 *
fmt
) {

297 '-': 
æags
 |ğ
LEFT
; 
»³©
;

298 '+': 
æags
 |ğ
PLUS
; 
»³©
;

299 ' ': 
æags
 |ğ
SPACE
; 
»³©
;

300 '#': 
æags
 |ğ
SPECIAL
; 
»³©
;

301 '0': 
æags
 |ğ
ZEROPAD
; 
»³©
;

305 
f›ld_width
 = -1;

306 ià(
	`isdig™
(*
fmt
))

307 
f›ld_width
 = 
	`sk_©oi
(&
fmt
);

308 ià(*
fmt
 == '*') {

309 ++
fmt
;

311 
f›ld_width
 = 
	`va_¬g
(
¬gs
, );

312 ià(
f›ld_width
 < 0) {

313 
f›ld_width
 = -field_width;

314 
æags
 |ğ
LEFT
;

319 
´ecisiÚ
 = -1;

320 ià(*
fmt
 == '.') {

321 ++
fmt
;

322 ià(
	`isdig™
(*
fmt
))

323 
´ecisiÚ
 = 
	`sk_©oi
(&
fmt
);

324 ià(*
fmt
 == '*') {

325 ++
fmt
;

327 
´ecisiÚ
 = 
	`va_¬g
(
¬gs
, );

329 ià(
´ecisiÚ
 < 0)

330 
´ecisiÚ
 = 0;

334 
qu®if›r
 = -1;

335 ià(*
fmt
 == 'h' || *fmt == 'l' || *fmt == 'L' ||

336 *
fmt
 =='Z' || *fmt == 'z') {

337 
qu®if›r
 = *
fmt
;

338 ++
fmt
;

339 ià(
qu®if›r
 =ğ'l' && *
fmt
 == 'l') {

340 
qu®if›r
 = 'L';

341 ++
fmt
;

346 
ba£
 = 10;

348 *
fmt
) {

350 ià(!(
æags
 & 
LEFT
)) {

351 --
f›ld_width
 > 0) {

352 ià(
¡r
 <ğ
’d
)

353 *
¡r
 = ' ';

354 ++
¡r
;

357 
c
 = (è
	`va_¬g
(
¬gs
, );

358 ià(
¡r
 <ğ
’d
)

359 *
¡r
 = 
c
;

360 ++
¡r
;

361 --
f›ld_width
 > 0) {

362 ià(
¡r
 <ğ
’d
)

363 *
¡r
 = ' ';

364 ++
¡r
;

369 
s
 = 
	`va_¬g
(
¬gs
, *);

370 ià(()
s
 < 
PAGE_SIZE
)

371 
s
 = "<NULL>";

373 
Ën
 = 
	`¡ºËn
(
s
, 
´ecisiÚ
);

375 ià(!(
æags
 & 
LEFT
)) {

376 
Ën
 < 
f›ld_width
--) {

377 ià(
¡r
 <ğ
’d
)

378 *
¡r
 = ' ';

379 ++
¡r
;

382 
i
 = 0; i < 
Ën
; ++i) {

383 ià(
¡r
 <ğ
’d
)

384 *
¡r
 = *
s
;

385 ++
¡r
; ++
s
;

387 
Ën
 < 
f›ld_width
--) {

388 ià(
¡r
 <ğ
’d
)

389 *
¡r
 = ' ';

390 ++
¡r
;

395 ià(
f›ld_width
 == -1) {

396 
f›ld_width
 = 2*(*);

397 
æags
 |ğ
ZEROPAD
;

399 
¡r
 = 
	`numb”
(¡r, 
’d
,

400 (è
	`va_¬g
(
¬gs
, *),

401 16, 
f›ld_width
, 
´ecisiÚ
, 
æags
);

406 ià(
qu®if›r
 == 'l') {

407 * 

 = 
	`va_¬g
(
¬gs
, *);

408 *

 = (
¡r
 - 
buf
);

409 } ià(
qu®if›r
 == 'Z' || qualifier == 'z') {

410 
size_t
 * 

 = 
	`va_¬g
(
¬gs
, size_t *);

411 *

 = (
¡r
 - 
buf
);

413 * 

 = 
	`va_¬g
(
¬gs
, *);

414 *

 = (
¡r
 - 
buf
);

419 ià(
¡r
 <ğ
’d
)

420 *
¡r
 = '%';

421 ++
¡r
;

426 
ba£
 = 8;

430 
æags
 |ğ
LARGE
;

432 
ba£
 = 16;

437 
æags
 |ğ
SIGN
;

442 ià(
¡r
 <ğ
’d
)

443 *
¡r
 = '%';

444 ++
¡r
;

445 ià(*
fmt
) {

446 ià(
¡r
 <ğ
’d
)

447 *
¡r
 = *
fmt
;

448 ++
¡r
;

450 --
fmt
;

454 ià(
qu®if›r
 == 'L')

455 
num
 = 
	`va_¬g
(
¬gs
, );

456 ià(
qu®if›r
 == 'l') {

457 
num
 = 
	`va_¬g
(
¬gs
, );

458 ià(
æags
 & 
SIGN
)

459 
num
 = (signed )‚um;

460 } ià(
qu®if›r
 == 'Z' || qualifier == 'z') {

461 
num
 = 
	`va_¬g
(
¬gs
, 
size_t
);

462 } ià(
qu®if›r
 == 'h') {

463 
num
 = (è
	`va_¬g
(
¬gs
, );

464 ià(
æags
 & 
SIGN
)

465 
num
 = (signed )‚um;

467 
num
 = 
	`va_¬g
(
¬gs
, );

468 ià(
æags
 & 
SIGN
)

469 
num
 = (signed )‚um;

472 
¡r
 = 
	`numb”
(¡r, 
’d
, 
num
, 
ba£
,

473 
f›ld_width
, 
´ecisiÚ
, 
æags
);

475 ià(
¡r
 <ğ
’d
)

476 *
¡r
 = '\0';

477 ià(
size
 > 0)

479 *
’d
 = '\0';

483  
¡r
-
buf
;

484 
	}
}

486 
EXPORT_SYMBOL
(
v¢´štf
);

502 
	$vsú´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, 
va_li¡
 
¬gs
)

504 
i
;

506 
i
 = 
	`v¢´štf
(
buf
,
size
,
fmt
,
¬gs
);

507 ià(
i
 >ğ
size
)

508 
i
 = 
size
 - 1;

509  (
i
 > 0) ? i : 0;

510 
	}
}

512 
EXPORT_SYMBOL
(
vsú´štf
);

520 
	$vssÿnf
(cÚ¡ * 
buf
, cÚ¡ * 
fmt
, 
va_li¡
 
¬gs
)

522 cÚ¡ *
¡r
 = 
buf
;

523 cÚ¡ *
Ãxt
;

524 
dig™
;

525 
num
 = 0;

526 
qu®if›r
;

527 
ba£
;

528 
f›ld_width
;

529 
is_sign
 = 0;

531 *
fmt
 && *
¡r
) {

536 ià(
	`is¥aû
(*
fmt
)) {

537 
	`is¥aû
(*
fmt
))

538 ++
fmt
;

539 
	`is¥aû
(*
¡r
))

540 ++
¡r
;

544 ià(*
fmt
 != '%' && *fmt) {

545 ià(*
fmt
++ !ğ*
¡r
++)

550 ià(!*
fmt
)

552 ++
fmt
;

557 ià(*
fmt
 == '*') {

558 !
	`is¥aû
(*
fmt
) && *fmt)

559 
fmt
++;

560 !
	`is¥aû
(*
¡r
) && *str)

561 
¡r
++;

566 
f›ld_width
 = -1;

567 ià(
	`isdig™
(*
fmt
))

568 
f›ld_width
 = 
	`sk_©oi
(&
fmt
);

571 
qu®if›r
 = -1;

572 ià(*
fmt
 == 'h' || *fmt == 'l' || *fmt == 'L' || *fmt == 'Z'

573 || *
fmt
 == 'z') {

574 
qu®if›r
 = *
fmt
++;

575 ià(
	`uÆik–y
(
qu®if›r
 =ğ*
fmt
)) {

576 ià(
qu®if›r
 == 'h') {

577 
qu®if›r
 = 'H';

578 
fmt
++;

579 } ià(
qu®if›r
 == 'l') {

580 
qu®if›r
 = 'L';

581 
fmt
++;

585 
ba£
 = 10;

586 
is_sign
 = 0;

588 ià(!*
fmt
 || !*
¡r
)

591 *
fmt
++) {

593 *
s
 = (*è
	`va_¬g
(
¬gs
,*);

594 ià(
f›ld_width
 == -1)

595 
f›ld_width
 = 1;

597 *
s
++ = *
¡r
++;

598 } --
f›ld_width
 > 0 && *
¡r
);

599 
num
++;

603 *
s
 = (*è
	`va_¬g
(
¬gs
, *);

604 if(
f›ld_width
 == -1)

605 
f›ld_width
 = 
INT_MAX
;

607 
	`is¥aû
(*
¡r
))

608 
¡r
++;

611 *
¡r
 && !
	`is¥aû
(*¡rè&& 
f›ld_width
--)

612 *
s
++ = *
¡r
++;

613 *
s
 = '\0';

614 
num
++;

619 *
i
 = (*)
	`va_¬g
(
¬gs
,*);

620 *
i
 = 
¡r
 - 
buf
;

624 
ba£
 = 8;

628 
ba£
 = 16;

631 
ba£
 = 0;

633 
is_sign
 = 1;

638 ià(*
¡r
++ != '%')

639  
num
;

643  
num
;

649 
	`is¥aû
(*
¡r
))

650 
¡r
++;

652 
dig™
 = *
¡r
;

653 ià(
is_sign
 && 
dig™
 == '-')

654 
dig™
 = *(
¡r
 + 1);

656 ià(!
dig™
 || (
ba£
 =ğ16 && !
	`isxdig™
(digit))

657 || (
ba£
 =ğ10 && !
	`isdig™
(
dig™
))

658 || (
ba£
 =ğ8 && (!
	`isdig™
(
dig™
) || digit > '7'))

659 || (
ba£
 =ğ0 && !
	`isdig™
(
dig™
)))

662 
qu®if›r
) {

664 ià(
is_sign
) {

665 sigÃd *
s
 = (sigÃd *è
	`va_¬g
(
¬gs
,signed *);

666 *
s
 = (sigÃd è
	`sim¶e_¡¹Ş
(
¡r
,&
Ãxt
,
ba£
);

668 *
s
 = (*)

669 
	`va_¬g
(
¬gs
, *);

670 *
s
 = (è
	`sim¶e_¡¹oul
(
¡r
, &
Ãxt
, 
ba£
);

674 ià(
is_sign
) {

675 *
s
 = (*è
	`va_¬g
(
¬gs
,*);

676 *
s
 = (è
	`sim¶e_¡¹Ş
(
¡r
,&
Ãxt
,
ba£
);

678 *
s
 = (*)

679 
	`va_¬g
(
¬gs
, *);

680 *
s
 = (è
	`sim¶e_¡¹oul
(
¡r
, &
Ãxt
, 
ba£
);

684 ià(
is_sign
) {

685 *
l
 = (*è
	`va_¬g
(
¬gs
,*);

686 *
l
 = 
	`sim¶e_¡¹Ş
(
¡r
,&
Ãxt
,
ba£
);

688 *
l
 = (*)

689 
	`va_¬g
(
¬gs
,*);

690 *
l
 = 
	`sim¶e_¡¹oul
(
¡r
,&
Ãxt
,
ba£
);

694 ià(
is_sign
) {

695 *
l
 = (*è
	`va_¬g
(
¬gs
,*);

696 *
l
 = 
	`sim¶e_¡¹Şl
(
¡r
,&
Ãxt
,
ba£
);

698 *
l
 = (*)

699 
	`va_¬g
(
¬gs
,*);

700 *
l
 = 
	`sim¶e_¡¹ouÎ
(
¡r
,&
Ãxt
,
ba£
);

705 
size_t
 *
s
 = (size_t*è
	`va_¬g
(
¬gs
,size_t*);

706 *
s
 = (
size_t
è
	`sim¶e_¡¹oul
(
¡r
,&
Ãxt
,
ba£
);

710 ià(
is_sign
) {

711 *
i
 = (*è
	`va_¬g
(
¬gs
, *);

712 *
i
 = (è
	`sim¶e_¡¹Ş
(
¡r
,&
Ãxt
,
ba£
);

714 *
i
 = (*)

715 
	`va_¬g
(
¬gs
, *);

716 *
i
 = (è
	`sim¶e_¡¹oul
(
¡r
,&
Ãxt
,
ba£
);

720 
num
++;

722 ià(!
Ãxt
)

724 
¡r
 = 
Ãxt
;

726  
num
;

727 
	}
}

729 
EXPORT_SYMBOL
(
vssÿnf
);

743 
	$¢´štf
(* 
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, ...)

745 
va_li¡
 
¬gs
;

746 
i
;

748 
	`va_¡¬t
(
¬gs
, 
fmt
);

749 
i
=
	`v¢´štf
(
buf
,
size
,
fmt
,
¬gs
);

750 
	`va_’d
(
¬gs
);

751  
i
;

752 
	}
}

754 
EXPORT_SYMBOL
(
¢´štf
);

768 
	$sú´štf
(* 
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, ...)

770 
va_li¡
 
¬gs
;

771 
i
;

773 
	`va_¡¬t
(
¬gs
, 
fmt
);

774 
i
 = 
	`v¢´štf
(
buf
, 
size
, 
fmt
, 
¬gs
);

775 
	`va_’d
(
¬gs
);

776 ià(
i
 >ğ
size
)

777 
i
 = 
size
 - 1;

778  (
i
 > 0) ? i : 0;

779 
	}
}

780 
EXPORT_SYMBOL
(
sú´štf
);

788 
	$ssÿnf
(cÚ¡ * 
buf
, cÚ¡ * 
fmt
, ...)

790 
va_li¡
 
¬gs
;

791 
i
;

793 
	`va_¡¬t
(
¬gs
,
fmt
);

794 
i
 = 
	`vssÿnf
(
buf
,
fmt
,
¬gs
);

795 
	`va_’d
(
¬gs
);

796  
i
;

797 
	}
}

799 
EXPORT_SYMBOL
(
ssÿnf
);

	@wait.c

23 
	~<x’/cÚfig.h
>

24 
	~<x’/sched.h
>

25 
	~<x’/wa™.h
>

27 
	swa™queue_vıu
 {

28 
li¡_h—d
 
	mli¡
;

29 
vıu
 *
	mvıu
;

30 #ifdeà
CONFIG_X86


35 *
	me¥
;

36 
	m¡ack
[1500];

40 
	$š™_wa™queue_vıu
(
vıu
 *
v
)

42 
wa™queue_vıu
 *
wqv
;

44 
wqv
 = 
	`xm®loc
(
wa™queue_vıu
);

45 iàĞ
wqv
 =ğ
NULL
 )

46  -
ENOMEM
;

48 
	`mem£t
(
wqv
, 0, (*wqv));

49 
	`INIT_LIST_HEAD
(&
wqv
->
li¡
);

50 
wqv
->
vıu
 = 
v
;

52 
v
->
wa™queue_vıu
 = 
wqv
;

55 
	}
}

57 
	$de¡roy_wa™queue_vıu
(
vıu
 *
v
)

59 
wa™queue_vıu
 *
wqv
;

61 
wqv
 = 
v
->
wa™queue_vıu
;

62 iàĞ
wqv
 =ğ
NULL
 )

65 
	`BUG_ON
(!
	`li¡_em±y
(&
wqv
->
li¡
));

66 
	`xä“
(
wqv
);

68 
v
->
wa™queue_vıu
 = 
NULL
;

69 
	}
}

71 
	$š™_wa™queue_h—d
(
wa™queue_h—d
 *
wq
)

73 
	`¥š_lock_š™
(&
wq
->
lock
);

74 
	`INIT_LIST_HEAD
(&
wq
->
li¡
);

75 
	}
}

77 
	$wake_up
(
wa™queue_h—d
 *
wq
)

79 
wa™queue_vıu
 *
wqv
;

81 
	`¥š_lock
(&
wq
->
lock
);

83  !
	`li¡_em±y
(&
wq
->
li¡
) )

85 
wqv
 = 
	`li¡_’Œy
(
wq
->
li¡
.
Ãxt
, 
wa™queue_vıu
,†ist);

86 
	`li¡_d–_š™
(&
wqv
->
li¡
);

87 
	`vıu_uÅau£
(
wqv
->
vıu
);

90 
	`¥š_uÆock
(&
wq
->
lock
);

91 
	}
}

93 #ifdeà
CONFIG_X86


95 
	$__´•¬e_to_wa™
(
wa™queue_vıu
 *
wqv
)

97 *
ıu_šfo
 = (*)
	`g‘_ıu_šfo
();

98 
asm
 volatile (

99 #ifdeà
CONFIG_X86_64


115 : "=S" (
wqv
->
e¥
)

116 : "c" (
ıu_šfo
), "D" (
wqv
->
¡ack
)

118 
	`BUG_ON
((
ıu_šfo
 - (*)
wqv
->
e¥
è> (wqv->
¡ack
));

119 
	}
}

121 
	$__fšish_wa™
(
wa™queue_vıu
 *
wqv
)

123 
wqv
->
e¥
 = 
NULL
;

124 
	}
}

126 
	$check_wakeup_äom_wa™
()

128 
wa™queue_vıu
 *
wqv
 = 
cu¼’t
->waitqueue_vcpu;

130 
	`ASSERT
(
	`li¡_em±y
(&
wqv
->
li¡
));

132 iàĞ
	`lik–y
(
wqv
->
e¥
 =ğ
NULL
) )

135 
asm
 volatile (

136 "mov %1,%%"
__OP
"sp;„ep movsb; jmp *(%%"__OP"sp)"

137 : : "S" (
wqv
->
¡ack
), "D" (wqv->
e¥
),

138 "c" ((*)
	`g‘_ıu_šfo
(è- (*)
wqv
->
e¥
)

140 
	}
}

144 
	#__´•¬e_to_wa™
(
wqv
è(()0)

	)

145 
	#__fšish_wa™
(
wqv
è(()0)

	)

149 
	$´•¬e_to_wa™
(
wa™queue_h—d
 *
wq
)

151 
vıu
 *
cu¼
 = 
cu¼’t
;

152 
wa™queue_vıu
 *
wqv
 = 
cu¼
->waitqueue_vcpu;

154 
	`ASSERT
(
	`li¡_em±y
(&
wqv
->
li¡
));

156 
	`¥š_lock
(&
wq
->
lock
);

157 
	`li¡_add_
(&
wqv
->
li¡
, &
wq
->list);

158 
	`vıu_·u£_nosync
(
cu¼
);

159 
	`¥š_uÆock
(&
wq
->
lock
);

161 
	`__´•¬e_to_wa™
(
wqv
);

162 
	}
}

164 
	$fšish_wa™
(
wa™queue_h—d
 *
wq
)

166 
vıu
 *
cu¼
 = 
cu¼’t
;

167 
wa™queue_vıu
 *
wqv
 = 
cu¼
->waitqueue_vcpu;

169 
	`__fšish_wa™
(
wqv
);

171 iàĞ
	`li¡_em±y
(&
wqv
->
li¡
) )

174 
	`¥š_lock
(&
wq
->
lock
);

175 iàĞ!
	`li¡_em±y
(&
wqv
->
li¡
) )

177 
	`li¡_d–_š™
(&
wqv
->
li¡
);

178 
	`vıu_uÅau£
(
cu¼
);

180 
	`¥š_uÆock
(&
wq
->
lock
);

181 
	}
}

	@xencomm.c

25 
	~<x’/cÚfig.h
>

26 
	~<x’/mm.h
>

27 
	~<x’/sched.h
>

28 
	~<x’/x’comm.h
>

29 
	~<public/x’.h
>

30 
	~<public/x’comm.h
>

32 #undeà
DEBUG


33 #ifdeà
DEBUG


34 
	#xc_d´štk
(
f
, 
a
...è
	`´štk
("[x’comm]" f , ##‡)

	)

36 
	#xc_d´štk
(
f
, 
a
...è(()0)

	)

40 
	$x’comm_vaddr
(
·ddr
, 
·ge_šfo
 *
·ge
)

42  (*)((
·ddr
 & ~
PAGE_MASK
è| ()
	`·ge_to_vœt
(
·ge
));

43 
	}
}

47 
	$x’comm_g‘_·ge
(
·ddr
, 
·ge_šfo
 **
·ge
)

49 
maddr
 = 
	`·ddr_to_maddr
(
·ddr
);

50 iàĞ
maddr
 == 0 )

51  -
EFAULT
;

53 *
·ge
 = 
	`maddr_to_·ge
(
maddr
);

54 iàĞ!
	`g‘_·ge
(*
·ge
, 
cu¼’t
->
domaš
) )

60 
	`gd´štk
(
XENLOG_WARNING
,

62 
·ddr
, 
maddr
);

63  -
EFAULT
;

67 
	}
}

71 
	$x’comm_desc_üoss_·ge_bound¬y
(
·ddr
)

73 
off£t
 = 
·ddr
 & ~
PAGE_MASK
;

74 iàĞ
off£t
 > 
PAGE_SIZE
 - (
x’comm_desc
) )

77 
	}
}

79 
	sx’comm_ùxt
 {

80 
x’comm_desc
 
__u£r
 *
	mdesc_š_·ddr
;

81 
ušt32_t
 
	mÄ_addrs
;

83 
·ge_šfo
 *
	m·ge
;

84 *
	madd»ss
;

87 
ušt32_t


88 
	$x’comm_ùxt_Ä_addrs
(cÚ¡ 
x’comm_ùxt
 *
ùxt
)

90  
ùxt
->
Ä_addrs
;

91 
	}
}

94 
	$x’comm_ùxt_add»ss
(
x’comm_ùxt
 *
ùxt
)

96  
ùxt
->
add»ss
;

97 
	}
}

100 
	$x’comm_ùxt_š™
(cÚ¡ *
hªdË
, 
x’comm_ùxt
 *
ùxt
)

102 
·ge_šfo
 *
·ge
;

103 
x’comm_desc
 *
desc
;

104 
»t
;

107 iàĞ(()
hªdË
 % 
	`__®ignof__
(*
desc
)) != 0 )

108  -
EINVAL
;

109 iàĞ
	`x’comm_desc_üoss_·ge_bound¬y
(()
hªdË
) )

110  -
EINVAL
;

113 
»t
 = 
	`x’comm_g‘_·ge
(()
hªdË
, &
·ge
);

114 iàĞ
»t
 )

115  
»t
;

117 
desc
 = 
	`x’comm_vaddr
(()
hªdË
, 
·ge
);

118 iàĞ
desc
->
magic
 !ğ
XENCOMM_MAGIC
 )

120 
	`´štk
("%s:ƒ¼Ü: %°magiøwa 0x%x\n", 
__func__
, 
desc
, desc->
magic
);

121 
	`put_·ge
(
·ge
);

122  -
EINVAL
;

126 
ùxt
->
Ä_addrs
 = 
desc
->nr_addrs;

127 
ùxt
->
desc_š_·ddr
 = (
x’comm_desc
*)
hªdË
;

128 
ùxt
->
·ge
 =…age;

129 
ùxt
->
add»ss
 = &
desc
->address[0];

131 
	}
}

150 
	$x’comm_ùxt_Ãxt
(
x’comm_ùxt
 *
ùxt
, 
i
)

152 
·ddr
;

153 
·ge_šfo
 *
·ge
;

154 
»t
;

156 
	`BUG_ON
(
i
 >ğ
ùxt
->
Ä_addrs
);

159 iàĞ
i
 != 0 )

160 
ùxt
->
add»ss
++;

162 iàĞ(()
ùxt
->
add»ss
 & ~
PAGE_MASK
) != 0 )

166 
·ddr
 = ()&
ùxt
->
desc_š_·ddr
->
add»ss
[
i
];

167 
»t
 = 
	`x’comm_g‘_·ge
(
·ddr
, &
·ge
);

168 iàĞ
»t
 )

169  
»t
;

171 
	`put_·ge
(
ùxt
->
·ge
);

172 
ùxt
->
·ge
 =…age;

173 
ùxt
->
add»ss
 = 
	`x’comm_vaddr
(
·ddr
, 
·ge
);

176 
	}
}

179 
	$x’comm_ùxt_dÚe
(
x’comm_ùxt
 *
ùxt
)

181 
	`put_·ge
(
ùxt
->
·ge
);

182 
	}
}

185 
	$x’comm_cİy_chunk_äom
(

186 
to
, 
·ddr
, 
Ën
)

188 
·ge_šfo
 *
·ge
;

189 
»s
;

192 
»s
 = 
	`x’comm_g‘_·ge
(
·ddr
, &
·ge
);

193 }  
»s
 =ğ-
EAGAIN
 );

195 iàĞ
»s
 )

196  
»s
;

198 
	`xc_d´štk
("%lx[%d] -> %lx\n",

199 ()
	`x’comm_vaddr
(
·ddr
, 
·ge
), 
Ën
, 
to
);

201 
	`memıy
((*)
to
, 
	`x’comm_vaddr
(
·ddr
, 
·ge
), 
Ën
);

202 
	`put_·ge
(
·ge
);

205 
	}
}

208 
	$x’comm_šlše_äom_gue¡
(

209 *
to
, cÚ¡ *
äom
, 
n
, 
sk
)

211 
¤c_·ddr
 = 
	`x’comm_šlše_addr
(
äom
è+ 
sk
;

213  
n
 > 0 )

215 
chunksz
, 
by‹s
;

217 
chunksz
 = 
PAGE_SIZE
 - (
¤c_·ddr
 % PAGE_SIZE);

218 
by‹s
 = 
	`mš
(
chunksz
, 
n
);

220 iàĞ
	`x’comm_cİy_chunk_äom
(()
to
, 
¤c_·ddr
, 
by‹s
) )

221  
n
;

222 
¤c_·ddr
 +ğ
by‹s
;

223 
to
 +ğ
by‹s
;

224 
n
 -ğ
by‹s
;

229 
	}
}

244 
	$x’comm_cİy_äom_gue¡
(

245 *
to
, cÚ¡ *
äom
, 
n
, 
sk
)

247 
x’comm_ùxt
 
ùxt
;

248 
äom_pos
 = 0;

249 
to_pos
 = 0;

250 
i
 = 0;

252 iàĞ
	`x’comm_is_šlše
(
äom
) )

253  
	`x’comm_šlše_äom_gue¡
(
to
, 
äom
, 
n
, 
sk
);

255 iàĞ
	`x’comm_ùxt_š™
(
äom
, &
ùxt
) )

256  
n
;

259  (
to_pos
 < 
n
è&& (
i
 < 
	`x’comm_ùxt_Ä_addrs
(&
ùxt
)) )

261 
¤c_·ddr
;

262 
pgoff£t
, 
chunksz
, 
chunk_sk
;

264 iàĞ
	`x’comm_ùxt_Ãxt
(&
ùxt
, 
i
) )

265 
out
;

266 
¤c_·ddr
 = *
	`x’comm_ùxt_add»ss
(&
ùxt
);

267 iàĞ
¤c_·ddr
 =ğ
XENCOMM_INVALID
 )

269 
i
++;

273 
pgoff£t
 = 
¤c_·ddr
 % 
PAGE_SIZE
;

274 
chunksz
 = 
PAGE_SIZE
 - 
pgoff£t
;

276 
chunk_sk
 = 
	`mš
(
chunksz
, 
sk
);

277 
äom_pos
 +ğ
chunk_sk
;

278 
chunksz
 -ğ
chunk_sk
;

279 
sk
 -ğ
chunk_sk
;

281 iàĞ
sk
 =ğ0 && 
chunksz
 > 0 )

283 
by‹s
 = 
	`mš
(
chunksz
, 
n
 - 
to_pos
);

285 iàĞ
	`x’comm_cİy_chunk_äom
(()
to
 + 
to_pos
,

286 
¤c_·ddr
 + 
chunk_sk
, 
by‹s
) )

287 
out
;

288 
äom_pos
 +ğ
by‹s
;

289 
to_pos
 +ğ
by‹s
;

292 
i
++;

295 
out
:

296 
	`x’comm_ùxt_dÚe
(&
ùxt
);

297  
n
 - 
to_pos
;

298 
	}
}

301 
	$x’comm_cİy_chunk_to
(

302 
·ddr
, 
äom
, 
Ën
)

304 
·ge_šfo
 *
·ge
;

305 
»s
;

308 
»s
 = 
	`x’comm_g‘_·ge
(
·ddr
, &
·ge
);

309 }  
»s
 =ğ-
EAGAIN
 );

311 iàĞ
»s
 )

312  
»s
;

314 
	`xc_d´štk
("%lx[%d] -> %lx\n", 
äom
, 
Ën
,

315 ()
	`x’comm_vaddr
(
·ddr
, 
·ge
));

317 
	`memıy
(
	`x’comm_vaddr
(
·ddr
, 
·ge
), (*)
äom
, 
Ën
);

318 
	`x’comm_m¬k_dœty
(()
	`x’comm_vaddr
(
·ddr
, 
·ge
), 
Ën
);

319 
	`put_·ge
(
·ge
);

322 
	}
}

325 
	$x’comm_šlše_to_gue¡
(

326 *
to
, cÚ¡ *
äom
, 
n
, 
sk
)

328 
de¡_·ddr
 = 
	`x’comm_šlše_addr
(
to
è+ 
sk
;

330  
n
 > 0 )

332 
chunksz
, 
by‹s
;

334 
chunksz
 = 
PAGE_SIZE
 - (
de¡_·ddr
 % PAGE_SIZE);

335 
by‹s
 = 
	`mš
(
chunksz
, 
n
);

337 iàĞ
	`x’comm_cİy_chunk_to
(
de¡_·ddr
, ()
äom
, 
by‹s
) )

338  
n
;

339 
de¡_·ddr
 +ğ
by‹s
;

340 
äom
 +ğ
by‹s
;

341 
n
 -ğ
by‹s
;

346 
	}
}

361 
	$x’comm_cİy_to_gue¡
(

362 *
to
, cÚ¡ *
äom
, 
n
, 
sk
)

364 
x’comm_ùxt
 
ùxt
;

365 
äom_pos
 = 0;

366 
to_pos
 = 0;

367 
i
 = 0;

369 iàĞ
	`x’comm_is_šlše
(
to
) )

370  
	`x’comm_šlše_to_gue¡
(
to
, 
äom
, 
n
, 
sk
);

372 iàĞ
	`x’comm_ùxt_š™
(
to
, &
ùxt
) )

373  
n
;

376  (
äom_pos
 < 
n
è&& (
i
 < 
	`x’comm_ùxt_Ä_addrs
(&
ùxt
)) )

378 
de¡_·ddr
;

379 
pgoff£t
, 
chunksz
, 
chunk_sk
;

381 iàĞ
	`x’comm_ùxt_Ãxt
(&
ùxt
, 
i
) )

382 
out
;

383 
de¡_·ddr
 = *
	`x’comm_ùxt_add»ss
(&
ùxt
);

384 iàĞ
de¡_·ddr
 =ğ
XENCOMM_INVALID
 )

386 
i
++;

390 
pgoff£t
 = 
de¡_·ddr
 % 
PAGE_SIZE
;

391 
chunksz
 = 
PAGE_SIZE
 - 
pgoff£t
;

393 
chunk_sk
 = 
	`mš
(
chunksz
, 
sk
);

394 
to_pos
 +ğ
chunk_sk
;

395 
chunksz
 -ğ
chunk_sk
;

396 
sk
 -ğ
chunk_sk
;

398 iàĞ
sk
 =ğ0 && 
chunksz
 > 0 )

400 
by‹s
 = 
	`mš
(
chunksz
, 
n
 - 
äom_pos
);

402 iàĞ
	`x’comm_cİy_chunk_to
(
de¡_·ddr
 + 
chunk_sk
,

403 ()
äom
 + 
äom_pos
, 
by‹s
) )

404 
out
;

405 
äom_pos
 +ğ
by‹s
;

406 
to_pos
 +ğ
by‹s
;

409 
i
++;

412 
out
:

413 
	`x’comm_ùxt_dÚe
(&
ùxt
);

414  
n
 - 
äom_pos
;

415 
	}
}

417 
	$x’comm_šlše_add_off£t
(**
hªdË
, 
by‹s
)

419 *
hªdË
 +ğ
by‹s
;

421 
	}
}

425 
	$x’comm_add_off£t
(**
hªdË
, 
by‹s
)

427 
x’comm_ùxt
 
ùxt
;

428 
i
 = 0;

429 
»s
 = 0;

431 iàĞ
	`x’comm_is_šlše
(*
hªdË
) )

432  
	`x’comm_šlše_add_off£t
(
hªdË
, 
by‹s
);

434 
»s
 = 
	`x’comm_ùxt_š™
(
hªdË
, &
ùxt
);

435 iàĞ
»s
 != 0 )

436  
»s
;

439  (
by‹s
 > 0è&& (
i
 < 
	`x’comm_ùxt_Ä_addrs
(&
ùxt
)) )

441 *
add»ss
;

442 
de¡_·ddr
;

443 
pgoff£t
, 
chunksz
, 
chunk_sk
;

445 
»s
 = 
	`x’comm_ùxt_Ãxt
(&
ùxt
, 
i
);

446 iàĞ
»s
 )

447 
out
;

448 
add»ss
 = 
	`x’comm_ùxt_add»ss
(&
ùxt
);

449 
de¡_·ddr
 = *
add»ss
;

450 iàĞ
de¡_·ddr
 =ğ
XENCOMM_INVALID
 )

452 
i
++;

456 
pgoff£t
 = 
de¡_·ddr
 % 
PAGE_SIZE
;

457 
chunksz
 = 
PAGE_SIZE
 - 
pgoff£t
;

459 
chunk_sk
 = 
	`mš
(
chunksz
, 
by‹s
);

460 iàĞ
chunk_sk
 =ğ
chunksz
 )

461 *
add»ss
 = 
XENCOMM_INVALID
;

463 *
add»ss
 +ğ
chunk_sk
;

464 
by‹s
 -ğ
chunk_sk
;

466 
i
++;

469 
out
:

470 
	`x’comm_ùxt_dÚe
(&
ùxt
);

471  
»s
;

472 
	}
}

474 
	$x’comm_hªdË_is_nuÎ
(*
hªdË
)

476 
x’comm_ùxt
 
ùxt
;

477 
i
;

478 
»s
 = 1;

480 iàĞ
	`x’comm_is_šlše
(
hªdË
) )

481  
	`x’comm_šlše_addr
(
hªdË
) == 0;

483 iàĞ
	`x’comm_ùxt_š™
(
hªdË
, &
ùxt
) )

486  
i
 = 0; i < 
	`x’comm_ùxt_Ä_addrs
(&
ùxt
); i++ )

488 iàĞ
	`x’comm_ùxt_Ãxt
(&
ùxt
, 
i
) )

489 
out
;

490 iàĞ*
	`x’comm_ùxt_add»ss
(&
ùxt
è!ğ
XENCOMM_INVALID
 )

492 
»s
 = 0;

493 
out
;

497 
out
:

498 
	`x’comm_ùxt_dÚe
(&
ùxt
);

499  
»s
;

500 
	}
}

	@xenoprof.c

12 #iâdeà
COMPAT


13 
	~<x’/gue¡_acûss.h
>

14 
	~<x’/sched.h
>

15 
	~<x’/ev’t.h
>

16 
	~<public/x’İrof.h
>

17 
	~<x’/·gšg.h
>

18 
	~<xsm/xsm.h
>

19 
	~<x’/hy³rÿÎ.h
>

20 
	~<mši.h
>

23 
	#MAX_OPROF_SHARED_PAGES
 32

	)

26 
DEFINE_SPINLOCK
(
x’İrof_lock
);

28 
DEFINE_SPINLOCK
(
pmu_owÃr_lock
);

29 
	gpmu_owÃr
 = 0;

30 
	gpmu_hvm_»fcouÁ
 = 0;

32 
domaš
 *
	gaùive_domašs
[
MAX_OPROF_DOMAINS
];

33 
	gaùive_»ady
[
MAX_OPROF_DOMAINS
];

34 
	gadomašs
;

36 
domaš
 *
	g·ssive_domašs
[
MAX_OPROF_DOMAINS
];

37 
	gpdomašs
;

39 
	gaùiv©ed
;

40 
domaš
 *
	gx’İrof_´im¬y_´of”
;

41 
	gx’İrof_¡©e
 = 
XENOPROF_IDLE
;

42 
	gbackŒaû_d•th
;

44 
u64
 
	gtÙ®_§m¶es
;

45 
u64
 
	gšv®id_bufãr_§m¶es
;

46 
u64
 
	gcÜru±ed_bufãr_§m¶es
;

47 
u64
 
	glo¡_§m¶es
;

48 
u64
 
	gaùive_§m¶es
;

49 
u64
 
	g·ssive_§m¶es
;

50 
u64
 
	gidË_§m¶es
;

51 
u64
 
	gÙh”s_§m¶es
;

53 
	$acquœe_pmu_owÃrsh
(
pmu_ownsh
)

55 
	`¥š_lock
(&
pmu_owÃr_lock
);

56 iàĞ
pmu_owÃr
 =ğ
PMU_OWNER_NONE
 )

58 
pmu_owÃr
 = 
pmu_ownsh
;

59 
out
;

62 iàĞ
pmu_owÃr
 =ğ
pmu_ownsh
 )

63 
out
;

65 
	`¥š_uÆock
(&
pmu_owÃr_lock
);

67 
out
:

68 iàĞ
pmu_owÃr
 =ğ
PMU_OWNER_HVM
 )

69 
pmu_hvm_»fcouÁ
++;

70 
	`¥š_uÆock
(&
pmu_owÃr_lock
);

72 
	}
}

74 
	$»Ëa£_pmu_ownsh
(
pmu_ownsh
)

76 
	`¥š_lock
(&
pmu_owÃr_lock
);

77 iàĞ
pmu_ownsh
 =ğ
PMU_OWNER_HVM
 )

78 
pmu_hvm_»fcouÁ
--;

79 iàĞ!
pmu_hvm_»fcouÁ
 )

80 
pmu_owÃr
 = 
PMU_OWNER_NONE
;

81 
	`¥š_uÆock
(&
pmu_owÃr_lock
);

82 
	}
}

84 
	$is_aùive
(
domaš
 *
d
)

86 
x’İrof
 *
x
 = 
d
->xenoprof;

87  ((
x
 !ğ
NULL
è&& (x->
domaš_ty³
 =ğ
XENOPROF_DOMAIN_ACTIVE
));

88 
	}
}

90 
	$is_·ssive
(
domaš
 *
d
)

92 
x’İrof
 *
x
 = 
d
->xenoprof;

93  ((
x
 !ğ
NULL
è&& (x->
domaš_ty³
 =ğ
XENOPROF_DOMAIN_PASSIVE
));

94 
	}
}

96 
	$is_´ofed
(
domaš
 *
d
)

98  (
	`is_aùive
(
d
è|| 
	`is_·ssive
(d));

99 
	}
}

101 
	$x’İrof_»£t_¡©
()

103 
tÙ®_§m¶es
 = 0;

104 
šv®id_bufãr_§m¶es
 = 0;

105 
cÜru±ed_bufãr_§m¶es
 = 0;

106 
lo¡_§m¶es
 = 0;

107 
aùive_§m¶es
 = 0;

108 
·ssive_§m¶es
 = 0;

109 
idË_§m¶es
 = 0;

110 
Ùh”s_§m¶es
 = 0;

111 
	}
}

113 
	$x’İrof_»£t_buf
(
domaš
 *
d
)

115 
j
;

116 
x’İrof_buf_t
 *
buf
;

118 iàĞ
d
->
x’İrof
 =ğ
NULL
 )

120 
	`´štk
("xenoprof_reset_buf: ERROR - Unexpected "

125  
j
 = 0; j < 
d
->
max_vıus
; j++ )

127 
buf
 = 
d
->
x’İrof
->
vıu
[
j
].
bufãr
;

128 iàĞ
buf
 !ğ
NULL
 )

130 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_h—d
) = 0;

131 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_
) = 0;

134 
	}
}

137 
	$sh¬e_x’İrof_·ge_w™h_gue¡
(
domaš
 *
d
, 
mâ
, 
Åages
)

139 
i
;

142  
i
 = 0; i < 
Åages
; i++ )

144 
·ge_šfo
 *
·ge
 = 
	`mâ_to_·ge
(
mâ
 + 
i
);

145 iàĞ(
·ge
->
couÁ_šfo
 & (
PGC_®loÿ‹d
|
PGC_couÁ_mask
)) != 0 )

147 
	`gd´štk
(
XENLOG_INFO
, "mfn 0x%lx…age->count_info 0x%lx\n",

148 
mâ
 + 
i
, ()
·ge
->
couÁ_šfo
);

149  -
EBUSY
;

151 
	`·ge_£t_owÃr
(
·ge
, 
NULL
);

154  
i
 = 0; i < 
Åages
; i++ )

155 
	`sh¬e_x’_·ge_w™h_gue¡
(
	`mâ_to_·ge
(
mâ
 + 
i
), 
d
, 
XENSHARE_wr™abË
);

158 
	}
}

161 
	$unsh¬e_x’İrof_·ge_w™h_gue¡
(
x’İrof
 *
x
)

163 
i
, 
Åages
 = 
x
->npages;

164 
mâ
 = 
	`vœt_to_mâ
(
x
->
¿wbuf
);

166  
i
 = 0; i < 
Åages
; i++ )

168 
·ge_šfo
 *
·ge
 = 
	`mâ_to_·ge
(
mâ
 + 
i
);

169 
	`BUG_ON
(
	`·ge_g‘_owÃr
(
·ge
è!ğ
cu¼’t
->
domaš
);

170 iàĞ
	`‹¡_ªd_ş—r_b™
(
_PGC_®loÿ‹d
, &
·ge
->
couÁ_šfo
) )

171 
	`put_·ge
(
·ge
);

173 
	}
}

176 
	$x’İrof_sh¬ed_gmâ_w™h_gue¡
(

177 
domaš
 *
d
, 
maddr
, 
gmaddr
, 
Åages
)

179 
i
;

181  
i
 = 0; i < 
Åages
; i++, 
maddr
 +ğ
PAGE_SIZE
, 
gmaddr
 += PAGE_SIZE )

183 
	`BUG_ON
(
	`·ge_g‘_owÃr
(
	`maddr_to_·ge
(
maddr
)è!ğ
d
);

184 
	`x’İrof_sh¬ed_gmâ
(
d
, 
gmaddr
, 
maddr
);

186 
	}
}

188 
	$®loc_x’İrof_¡ruù
(

189 
domaš
 *
d
, 
max_§m¶es
, 
is_·ssive
)

191 
vıu
 *
v
;

192 
nvıu
, 
Åages
, 
bufsize
, 
max_bufsize
;

193 
max_max_§m¶es
;

194 
i
;

196 
d
->
x’İrof
 = 
	`xm®loc
(xenoprof);

198 iàĞ
d
->
x’İrof
 =ğ
NULL
 )

200 
	`´štk
("alloc_xenoprof_struct(): memory‡llocation failed\n");

201  -
ENOMEM
;

204 
	`mem£t
(
d
->
x’İrof
, 0, (*d->xenoprof));

206 
d
->
x’İrof
->
vıu
 = 
	`xm®loc_¬¿y
(
x’İrof_vıu
, d->
max_vıus
);

207 iàĞ
d
->
x’İrof
->
vıu
 =ğ
NULL
 )

209 
	`xä“
(
d
->
x’İrof
);

210 
d
->
x’İrof
 = 
NULL
;

211 
	`´štk
("alloc_xenoprof_struct(): vcpu‡rray‡llocation failed\n");

212  -
ENOMEM
;

215 
	`mem£t
(
d
->
x’İrof
->
vıu
, 0, d->
max_vıus
 * (*d->xenoprof->vcpu));

217 
nvıu
 = 0;

218 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

219 
nvıu
++;

221 
bufsize
 = (
x’İrof_buf
);

222 
i
 = (
ev’t_log
);

223 #ifdeà
CONFIG_COMPAT


224 
d
->
x’İrof
->
is_com·t
 = 
	`is_pv_32Ú64_domaš
(
is_·ssive
 ? 
dom0
 : d);

225 iàĞ
	`XENOPROF_COMPAT
(
d
->
x’İrof
) )

227 
bufsize
 = (
com·t_İrof_buf
);

228 
i
 = (
com·t_ev’t_log
);

233 
max_bufsize
 = (
MAX_OPROF_SHARED_PAGES
 * 
PAGE_SIZE
è/ 
nvıu
;

234 
max_max_§m¶es
 = ( (
max_bufsize
 - 
bufsize
è/ 
i
 ) + 1;

235 iàĞ()
max_§m¶es
 > 
max_max_§m¶es
 )

236 
max_§m¶es
 = 
max_max_§m¶es
;

238 
bufsize
 +ğ(
max_§m¶es
 - 1è* 
i
;

239 
Åages
 = (
nvıu
 * 
bufsize
 - 1è/ 
PAGE_SIZE
 + 1;

241 
d
->
x’İrof
->
¿wbuf
 = 
	`®loc_x’h—p_·ges
(
	`g‘_Üd”_äom_·ges
(
Åages
), 0);

242 iàĞ
d
->
x’İrof
->
¿wbuf
 =ğ
NULL
 )

244 
	`xä“
(
d
->
x’İrof
);

245 
d
->
x’İrof
 = 
NULL
;

246  -
ENOMEM
;

249 
d
->
x’İrof
->
Åages
 =‚pages;

250 
d
->
x’İrof
->
nbuf
 = 
nvıu
;

251 
d
->
x’İrof
->
bufsize
 = bufsize;

252 
d
->
x’İrof
->
domaš_»ady
 = 0;

253 
d
->
x’İrof
->
domaš_ty³
 = 
XENOPROF_DOMAIN_IGNORED
;

256 
i
 = 0;

257 
	`fÜ_—ch_vıu
 ( 
d
, 
v
 )

259 
x’İrof_buf_t
 *
buf
 = (xenoprof_buf_t *)

260 &
d
->
x’İrof
->
¿wbuf
[
i
 * 
bufsize
];

262 
d
->
x’İrof
->
vıu
[
v
->
vıu_id
].
ev’t_size
 = 
max_§m¶es
;

263 
d
->
x’İrof
->
vıu
[
v
->
vıu_id
].
bufãr
 = 
buf
;

264 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_size
èğ
max_§m¶es
;

265 
	`x’İrof_buf
(
d
, 
buf
, 
vıu_id
èğ
v
->vcpu_id;

267 
i
++;

269 iàĞ
i
 >ğ
nvıu
 )

274 
	}
}

276 
	$ä“_x’İrof_·ges
(
domaš
 *
d
)

278 
x’İrof
 *
x
;

279 
Üd”
;

281 
x
 = 
d
->
x’İrof
;

282 iàĞ
x
 =ğ
NULL
 )

285 iàĞ
x
->
¿wbuf
 !ğ
NULL
 )

287 
Üd”
 = 
	`g‘_Üd”_äom_·ges
(
x
->
Åages
);

288 
	`ä“_x’h—p_·ges
(
x
->
¿wbuf
, 
Üd”
);

291 
	`xä“
(
x
);

292 
d
->
x’İrof
 = 
NULL
;

293 
	}
}

295 
	$aùive_šdex
(
domaš
 *
d
)

297 
i
;

299  
i
 = 0; i < 
adomašs
; i++ )

300 iàĞ
aùive_domašs
[
i
] =ğ
d
 )

301  
i
;

304 
	}
}

306 
	$£t_aùive
(
domaš
 *
d
)

308 
šd
;

309 
x’İrof
 *
x
;

311 
šd
 = 
	`aùive_šdex
(
d
);

312 iàĞ
šd
 < 0 )

313  -
EPERM
;

315 
x
 = 
d
->
x’İrof
;

316 iàĞ
x
 =ğ
NULL
 )

317  -
EPERM
;

319 
x
->
domaš_»ady
 = 1;

320 
x
->
domaš_ty³
 = 
XENOPROF_DOMAIN_ACTIVE
;

321 
aùive_»ady
[
šd
] = 1;

322 
aùiv©ed
++;

325 
	}
}

327 
	$»£t_aùive
(
domaš
 *
d
)

329 
šd
;

330 
x’İrof
 *
x
;

332 
šd
 = 
	`aùive_šdex
(
d
);

333 iàĞ
šd
 < 0 )

334  -
EPERM
;

336 
x
 = 
d
->
x’İrof
;

337 iàĞ
x
 =ğ
NULL
 )

338  -
EPERM
;

340 
x
->
domaš_»ady
 = 0;

341 
x
->
domaš_ty³
 = 
XENOPROF_DOMAIN_IGNORED
;

342 
aùive_»ady
[
šd
] = 0;

343 
aùive_domašs
[
šd
] = 
NULL
;

344 
aùiv©ed
--;

345 
	`put_domaš
(
d
);

347 iàĞ
aùiv©ed
 <= 0 )

348 
adomašs
 = 0;

351 
	}
}

353 
	$»£t_·ssive
(
domaš
 *
d
)

355 
x’İrof
 *
x
;

357 iàĞ
d
 =ğ
NULL
 )

360 
x
 = 
d
->
x’İrof
;

361 iàĞ
x
 =ğ
NULL
 )

364 
	`unsh¬e_x’İrof_·ge_w™h_gue¡
(
x
);

365 
x
->
domaš_ty³
 = 
XENOPROF_DOMAIN_IGNORED
;

366 
	}
}

368 
	$»£t_aùive_li¡
()

370 
i
;

372  
i
 = 0; i < 
adomašs
; i++ )

373 iàĞ
aùive_»ady
[
i
] )

374 
	`»£t_aùive
(
aùive_domašs
[
i
]);

376 
adomašs
 = 0;

377 
aùiv©ed
 = 0;

378 
	}
}

380 
	$»£t_·ssive_li¡
()

382 
i
;

384  
i
 = 0; i < 
pdomašs
; i++ )

386 
	`»£t_·ssive
(
·ssive_domašs
[
i
]);

387 
	`put_domaš
(
·ssive_domašs
[
i
]);

388 
·ssive_domašs
[
i
] = 
NULL
;

391 
pdomašs
 = 0;

392 
	}
}

394 
	$add_aùive_li¡
(
domid_t
 
domid
)

396 
domaš
 *
d
;

398 iàĞ
adomašs
 >ğ
MAX_OPROF_DOMAINS
 )

399  -
E2BIG
;

401 
d
 = 
	`g‘_domaš_by_id
(
domid
);

402 iàĞ
d
 =ğ
NULL
 )

403  -
EINVAL
;

405 
aùive_domašs
[
adomašs
] = 
d
;

406 
aùive_»ady
[
adomašs
] = 0;

407 
adomašs
++;

410 
	}
}

412 
add_·ssive_li¡
(
	$XEN_GUEST_HANDLE
(è
¬g
)

414 
x’İrof_·ssive
 
·ssive
;

415 
domaš
 *
d
;

416 
»t
 = 0;

418 iàĞ
pdomašs
 >ğ
MAX_OPROF_DOMAINS
 )

419  -
E2BIG
;

421 iàĞ
	`cİy_äom_gue¡
(&
·ssive
, 
¬g
, 1) )

422  -
EFAULT
;

424 
d
 = 
	`g‘_domaš_by_id
(
·ssive
.
domaš_id
);

425 iàĞ
d
 =ğ
NULL
 )

426  -
EINVAL
;

428 iàĞ
d
->
x’İrof
 =ğ
NULL
 )

430 
»t
 = 
	`®loc_x’İrof_¡ruù
(
d
, 
·ssive
.
max_§m¶es
, 1);

431 iàĞ
»t
 < 0 )

433 
	`put_domaš
(
d
);

434  -
ENOMEM
;

438 
»t
 = 
	`sh¬e_x’İrof_·ge_w™h_gue¡
(

439 
cu¼’t
->
domaš
, 
	`vœt_to_mâ
(
d
->
x’İrof
->
¿wbuf
),

440 
d
->
x’İrof
->
Åages
);

441 iàĞ
»t
 < 0 )

443 
	`put_domaš
(
d
);

444  
»t
;

447 
d
->
x’İrof
->
domaš_ty³
 = 
XENOPROF_DOMAIN_PASSIVE
;

448 
·ssive
.
nbuf
 = 
d
->
x’İrof
->nbuf;

449 
·ssive
.
bufsize
 = 
d
->
x’İrof
->bufsize;

450 iàĞ!
	`·gšg_mode_Œª¦©e
(
cu¼’t
->
domaš
) )

451 
·ssive
.
buf_gmaddr
 = 
	`__·
(
d
->
x’İrof
->
¿wbuf
);

453 
	`x’İrof_sh¬ed_gmâ_w™h_gue¡
(

454 
cu¼’t
->
domaš
, 
	`__·
(
d
->
x’İrof
->
¿wbuf
),

455 
·ssive
.
buf_gmaddr
, 
d
->
x’İrof
->
Åages
);

457 iàĞ
	`cİy_to_gue¡
(
¬g
, &
·ssive
, 1) )

459 
	`put_domaš
(
d
);

460  -
EFAULT
;

463 
·ssive_domašs
[
pdomašs
] = 
d
;

464 
pdomašs
++;

466  
»t
;

467 
	}
}

471 
	$x’İrof_buf_¥aû
(
domaš
 *
d
, 
x’İrof_buf_t
 * 
buf
, 
size
)

473 
h—d
, 

;

475 
h—d
 = 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_h—d
);

476 

 = 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_
);

478  ((

 > 
h—d
è? 0 : 
size
) +ail - head - 1;

479 
	}
}

482 
	$x’İrof_add_§m¶e
(
domaš
 *
d
, 
x’İrof_buf_t
 *
buf
,

483 
e
, 
mode
, 
ev’t
)

485 
h—d
, 

, 
size
;

487 
h—d
 = 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_h—d
);

488 

 = 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_
);

489 
size
 = 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_size
);

492 iàĞ(
h—d
 < 0è|| (h—d >ğ
size
è|| (

 < 0) || (tail >= size) )

494 
cÜru±ed_bufãr_§m¶es
++;

498 iàĞ
	`x’İrof_buf_¥aû
(
d
, 
buf
, 
size
) > 0 )

500 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_log
[
h—d
].
e
) =ƒip;

501 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_log
[
h—d
].
mode
) = mode;

502 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_log
[
h—d
].
ev’t
) =ƒvent;

503 
h—d
++;

504 iàĞ
h—d
 >ğ
size
 )

505 
h—d
 = 0;

507 
	`x’İrof_buf
(
d
, 
buf
, 
ev’t_h—d
èğ
h—d
;

511 
	`x’İrof_buf
(
d
, 
buf
, 
lo¡_§m¶es
)++;

512 
lo¡_§m¶es
++;

517 
	}
}

519 
	$x’İrof_add_Œaû
(
domaš
 *
d
, 
vıu
 *vcpu,

520 
e
, 
mode
)

522 
x’İrof_buf_t
 *
buf
 = 
d
->
x’İrof
->
vıu
[vıu->
vıu_id
].
bufãr
;

525 iàĞ
e
 =ğ
XENOPROF_ESCAPE_CODE
 )

527 
šv®id_bufãr_§m¶es
++;

531  
	`x’İrof_add_§m¶e
(
d
, 
buf
, 
e
, 
mode
, 0);

532 
	}
}

535 #ifdeà
NEW_LOAD_BALANCE_CACHE


536 
csched_miss_ev’t
(
vıu
 *vcpu);

538 #ifdeà
ENABLE_MYPROF


539 
	gmy_tÙ®_§m¶es
;

541 
	$x’İrof_log_ev’t
(
vıu
 *vcpu,

542 
ıu_u£r_»gs
 * 
»gs
, 
e
,

543 
mode
, 
ev’t
)

545 
domaš
 *
d
 = 
vıu
->domain;

546 
x’İrof_vıu
 *
v
;

547 
x’İrof_buf_t
 *
buf
;

549 
tÙ®_§m¶es
++;

550 #ifdeà
ENABLE_MYPROF


551 
my_tÙ®_§m¶es
++;

555 iàĞ!
	`is_´ofed
(
d
) )

557 
Ùh”s_§m¶es
++;

560 #ifdeà
NEW_LOAD_BALANCE_CACHE


561 
	`csched_miss_ev’t
(
vıu
);

564 
v
 = &
d
->
x’İrof
->
vıu
[vıu->
vıu_id
];

565 iàĞ
v
->
bufãr
 =ğ
NULL
 )

567 
šv®id_bufãr_§m¶es
++;

571 
buf
 = 
v
->
bufãr
;

574 iàĞ
backŒaû_d•th
 > 0 )

576 iàĞ(
	`x’İrof_buf_¥aû
(
d
, 
buf
, 
v
->
ev’t_size
) < 2) ||

577 !
	`x’İrof_add_§m¶e
(
d
, 
buf
, 
XENOPROF_ESCAPE_CODE
, 
mode
,

578 
XENOPROF_TRACE_BEGIN
) )

580 
	`x’İrof_buf
(
d
, 
buf
, 
lo¡_§m¶es
)++;

581 
lo¡_§m¶es
++;

586 iàĞ
	`x’İrof_add_§m¶e
(
d
, 
buf
, 
e
, 
mode
, 
ev’t
) )

588 iàĞ
	`is_aùive
(
vıu
->
domaš
) )

589 
aùive_§m¶es
++;

591 
·ssive_§m¶es
++;

592 iàĞ
mode
 == 0 )

593 
	`x’İrof_buf
(
d
, 
buf
, 
u£r_§m¶es
)++;

594 iàĞ
mode
 == 1 )

595 
	`x’İrof_buf
(
d
, 
buf
, 
k”Ãl_§m¶es
)++;

597 
	`x’İrof_buf
(
d
, 
buf
, 
x’_§m¶es
)++;

601 iàĞ
backŒaû_d•th
 > 0 )

602 
	`x’İrof_backŒaû
(
d
, 
vıu
, 
»gs
, 
backŒaû_d•th
, 
mode
);

603 
	}
}

606 #ifdeà
ENABLE_MYPROF


607 
	$my´of_İ_š™
()

609 
x’İrof_š™
 xenoprof_init;

610 
	`x’İrof_¬ch_š™
(&
x’İrof_š™
.
num_ev’ts
, x’İrof_š™.
ıu_ty³
);

611 
	`my´štk
("num_ev’ts:0x%x, is_´im¬y:0x%x cpu_ty³:'%s'\n", 
x’İrof_š™
.
num_ev’ts
, x’İrof_š™.
is_´im¬y
, x’İrof_š™.
ıu_ty³
);

612 
x’İrof_´im¬y_´of”
 = 
cu¼’t
->
domaš
;

613 
	`my´štk
("£ˆx’İrof_´im¬y_´of” =ğcu¼’ˆdomaš %d\n", 
x’İrof_´im¬y_´of”
->
domaš_id
);

614 
	}
}

617 
x’İrof_İ_š™
(
	$XEN_GUEST_HANDLE
(è
¬g
)

619 
domaš
 *
d
 = 
cu¼’t
->domain;

620 
x’İrof_š™
 xenoprof_init;

621 
»t
;

623 iàĞ
	`cİy_äom_gue¡
(&
x’İrof_š™
, 
¬g
, 1) )

624  -
EFAULT
;

626 iàĞ(
»t
 = 
	`x’İrof_¬ch_š™
(&
x’İrof_š™
.
num_ev’ts
,

627 
x’İrof_š™
.
ıu_ty³
)) )

628  
»t
;

630 
x’İrof_š™
.
is_´im¬y
 =

631 ((
x’İrof_´im¬y_´of”
 =ğ
d
) ||

632 ((
x’İrof_´im¬y_´of”
 =ğ
NULL
è&& (
d
->
domaš_id
 == 0)));

633 iàĞ
x’İrof_š™
.
is_´im¬y
 )

634 
x’İrof_´im¬y_´of”
 = 
cu¼’t
->
domaš
;

636  (
	`cİy_to_gue¡
(
¬g
, &
x’İrof_š™
, 1è? -
EFAULT
 : 0);

637 
	}
}

641 
x’İrof_İ_g‘_bufãr
(
	$XEN_GUEST_HANDLE
(è
¬g
)

643 
x’İrof_g‘_bufãr
 xenoprof_get_buffer;

644 
domaš
 *
d
 = 
cu¼’t
->domain;

645 
»t
;

647 iàĞ
	`cİy_äom_gue¡
(&
x’İrof_g‘_bufãr
, 
¬g
, 1) )

648  -
EFAULT
;

654 iàĞ
d
->
x’İrof
 =ğ
NULL
 )

656 
»t
 = 
	`®loc_x’İrof_¡ruù
(
d
, 
x’İrof_g‘_bufãr
.
max_§m¶es
, 0);

657 iàĞ
»t
 < 0 )

658  
»t
;

661 
»t
 = 
	`sh¬e_x’İrof_·ge_w™h_gue¡
(

662 
d
, 
	`vœt_to_mâ
(d->
x’İrof
->
¿wbuf
), d->x’İrof->
Åages
);

663 iàĞ
»t
 < 0 )

664  
»t
;

666 
	`x’İrof_»£t_buf
(
d
);

668 
d
->
x’İrof
->
domaš_ty³
 = 
XENOPROF_DOMAIN_IGNORED
;

669 
d
->
x’İrof
->
domaš_»ady
 = 0;

670 
d
->
x’İrof
->
is_´im¬y
 = (
x’İrof_´im¬y_´of”
 =ğ
cu¼’t
->
domaš
);

672 
x’İrof_g‘_bufãr
.
nbuf
 = 
d
->
x’İrof
->nbuf;

673 
x’İrof_g‘_bufãr
.
bufsize
 = 
d
->
x’İrof
->bufsize;

674 iàĞ!
	`·gšg_mode_Œª¦©e
(
d
) )

675 
x’İrof_g‘_bufãr
.
buf_gmaddr
 = 
	`__·
(
d
->
x’İrof
->
¿wbuf
);

677 
	`x’İrof_sh¬ed_gmâ_w™h_gue¡
(

678 
d
, 
	`__·
(d->
x’İrof
->
¿wbuf
), 
x’İrof_g‘_bufãr
.
buf_gmaddr
,

679 
d
->
x’İrof
->
Åages
);

681 iàĞ
	`cİy_to_gue¡
(
¬g
, &
x’İrof_g‘_bufãr
, 1) )

682  -
EFAULT
;

685 
	}
}

687 
	#NONPRIV_OP
(
İ
èĞ(İ =ğ
XENOPROF_š™
) \

688 || (
İ
 =ğ
XENOPROF_’abË_vœq
) \

689 || (
İ
 =ğ
XENOPROF_di§bË_vœq
) \

690 || (
İ
 =ğ
XENOPROF_g‘_bufãr
))

	)

692 
do_x’İrof_İ
(
İ
, 
	$XEN_GUEST_HANDLE
(è
¬g
)

694 
»t
 = 0;

696 iàĞ(
İ
 < 0è|| (İ > 
XENOPROF_Ï¡_İ
) )

698 
	`´štk
("xenoprof: invalid operation %d for domain %d\n",

699 
İ
, 
cu¼’t
->
domaš
->
domaš_id
);

700  -
EINVAL
;

703 iàĞ!
	`NONPRIV_OP
(
İ
è&& (
cu¼’t
->
domaš
 !ğ
x’İrof_´im¬y_´of”
) )

705 
	`´štk
("xenoprof: dom %d denied…rivileged operation %d\n",

706 
cu¼’t
->
domaš
->
domaš_id
, 
İ
);

707  -
EPERM
;

710 
»t
 = 
	`xsm_´ofe
(
cu¼’t
->
domaš
, 
İ
);

711 iàĞ
»t
 )

712  
»t
;

713 #ifdeà
ENABLE_MYPROF


714 
	`my´štk
("İ:0x%x,‡rg:0x%x„eûived\n", 
İ
, 
¬g
);

717 
	`¥š_lock
(&
x’İrof_lock
);

719  
İ
 )

721 
XENOPROF_š™
:

722 
»t
 = 
	`x’İrof_İ_š™
(
¬g
);

723 iàĞ(
»t
 == 0) &&

724 (
cu¼’t
->
domaš
 =ğ
x’İrof_´im¬y_´of”
) )

725 
x’İrof_¡©e
 = 
XENOPROF_INITIALIZED
;

728 
XENOPROF_g‘_bufãr
:

729 iàĞ!
	`acquœe_pmu_owÃrsh
(
PMU_OWNER_XENOPROF
) )

731 
»t
 = -
EBUSY
;

734 
»t
 = 
	`x’İrof_İ_g‘_bufãr
(
¬g
);

737 
XENOPROF_»£t_aùive_li¡
:

738 
	`»£t_aùive_li¡
();

739 
»t
 = 0;

742 
XENOPROF_»£t_·ssive_li¡
:

743 
	`»£t_·ssive_li¡
();

744 
»t
 = 0;

747 
XENOPROF_£t_aùive
:

749 
domid_t
 
domid
;

750 iàĞ
x’İrof_¡©e
 !ğ
XENOPROF_INITIALIZED
 )

752 
»t
 = -
EPERM
;

755 iàĞ
	`cİy_äom_gue¡
(&
domid
, 
¬g
, 1) )

757 
»t
 = -
EFAULT
;

760 
»t
 = 
	`add_aùive_li¡
(
domid
);

764 
XENOPROF_£t_·ssive
:

765 iàĞ
x’İrof_¡©e
 !ğ
XENOPROF_INITIALIZED
 )

767 
»t
 = -
EPERM
;

770 
»t
 = 
	`add_·ssive_li¡
(
¬g
);

773 
XENOPROF_»£rve_couÁ”s
:

774 iàĞ
x’İrof_¡©e
 !ğ
XENOPROF_INITIALIZED
 )

776 
»t
 = -
EPERM
;

779 
»t
 = 
	`x’İrof_¬ch_»£rve_couÁ”s
();

780 iàĞ!
»t
 )

781 
x’İrof_¡©e
 = 
XENOPROF_COUNTERS_RESERVED
;

784 
XENOPROF_couÁ”
:

785 iàĞ(
x’İrof_¡©e
 !ğ
XENOPROF_COUNTERS_RESERVED
) ||

786 (
adomašs
 == 0) )

788 
»t
 = -
EPERM
;

791 
»t
 = 
	`x’İrof_¬ch_couÁ”
(
¬g
);

794 
XENOPROF_£tup_ev’ts
:

795 iàĞ
x’İrof_¡©e
 !ğ
XENOPROF_COUNTERS_RESERVED
 )

797 
»t
 = -
EPERM
;

800 
»t
 = 
	`x’İrof_¬ch_£tup_ev’ts
();

801 iàĞ!
»t
 )

802 
x’İrof_¡©e
 = 
XENOPROF_READY
;

805 
XENOPROF_’abË_vœq
:

807 
i
;

809 iàĞ
cu¼’t
->
domaš
 =ğ
x’İrof_´im¬y_´of”
 )

811 iàĞ
x’İrof_¡©e
 !ğ
XENOPROF_READY
 )

813 
»t
 = -
EPERM
;

816 
	`x’İrof_¬ch_’abË_vœq
();

817 
	`x’İrof_»£t_¡©
();

818  
i
 = 0; i < 
pdomašs
; i++ )

819 
	`x’İrof_»£t_buf
(
·ssive_domašs
[
i
]);

821 
	`x’İrof_»£t_buf
(
cu¼’t
->
domaš
);

822 
»t
 = 
	`£t_aùive
(
cu¼’t
->
domaš
);

826 
XENOPROF_¡¬t
:

827 
»t
 = -
EPERM
;

828 iàĞ(
x’İrof_¡©e
 =ğ
XENOPROF_READY
) &&

829 (
aùiv©ed
 =ğ
adomašs
) )

830 
»t
 = 
	`x’İrof_¬ch_¡¬t
();

831 iàĞ
»t
 == 0 )

832 
x’İrof_¡©e
 = 
XENOPROF_PROFILING
;

835 
XENOPROF_¡İ
:

837 
domaš
 *
d
;

838 
vıu
 *
v
;

839 
i
;

841 iàĞ
x’İrof_¡©e
 !ğ
XENOPROF_PROFILING
 )

843 
»t
 = -
EPERM
;

846 
	`x’İrof_¬ch_¡İ
();

849  
i
 = 0; i < 
adomašs
; i++ )

851 iàĞ!
aùive_»ady
[
i
] )

853 
d
 = 
aùive_domašs
[
i
];

854 
	`fÜ_—ch_vıu
(
d
, 
v
)

855 
	`£nd_gue¡_vıu_vœq
(
v
, 
VIRQ_XENOPROF
);

857 
x’İrof_¡©e
 = 
XENOPROF_READY
;

861 
XENOPROF_di§bË_vœq
:

863 
x’İrof
 *
x
;

864 iàĞ(
x’İrof_¡©e
 =ğ
XENOPROF_PROFILING
) &&

865 (
	`is_aùive
(
cu¼’t
->
domaš
)) )

867 
»t
 = -
EPERM
;

870 iàĞ(
»t
 = 
	`»£t_aùive
(
cu¼’t
->
domaš
)) != 0 )

872 
x
 = 
cu¼’t
->
domaš
->
x’İrof
;

873 
	`unsh¬e_x’İrof_·ge_w™h_gue¡
(
x
);

874 
	`»Ëa£_pmu_ownsh
(
PMU_OWNER_XENOPROF
);

878 
XENOPROF_»Ëa£_couÁ”s
:

879 
»t
 = -
EPERM
;

880 iàĞ(
x’İrof_¡©e
 =ğ
XENOPROF_COUNTERS_RESERVED
) ||

881 (
x’İrof_¡©e
 =ğ
XENOPROF_READY
) )

883 
x’İrof_¡©e
 = 
XENOPROF_INITIALIZED
;

884 
	`x’İrof_¬ch_»Ëa£_couÁ”s
();

885 
	`x’İrof_¬ch_di§bË_vœq
();

886 
	`»£t_·ssive_li¡
();

887 
»t
 = 0;

891 
XENOPROF_shutdown
:

892 
»t
 = -
EPERM
;

893 iàĞ
x’İrof_¡©e
 =ğ
XENOPROF_INITIALIZED
 )

895 
aùiv©ed
 = 0;

896 
adomašs
=0;

897 
x’İrof_´im¬y_´of”
 = 
NULL
;

898 
backŒaû_d•th
=0;

899 
»t
 = 0;

903 
XENOPROF_£t_backŒaû
:

904 
»t
 = 0;

905 iàĞ!
	`x’İrof_backŒaû_suµÜ‹d
() )

906 
»t
 = -
EINVAL
;

907 iàĞ
	`cİy_äom_gue¡
(&
backŒaû_d•th
, 
¬g
, 1) )

908 
»t
 = -
EFAULT
;

911 
XENOPROF_ibs_couÁ”
:

912 iàĞ(
x’İrof_¡©e
 !ğ
XENOPROF_COUNTERS_RESERVED
) ||

913 (
adomašs
 == 0) )

915 
»t
 = -
EPERM
;

918 
»t
 = 
	`x’İrof_¬ch_ibs_couÁ”
(
¬g
);

921 
XENOPROF_g‘_ibs_ÿps
:

922 
»t
 = 
ibs_ÿps
;

926 
»t
 = -
ENOSYS
;

929 
	`¥š_uÆock
(&
x’İrof_lock
);

931 iàĞ
»t
 < 0 )

932 
	`´štk
("xenoprof: operation %d failed for dom %d (status : %d)\n",

933 
İ
, 
cu¼’t
->
domaš
->
domaš_id
, 
»t
);

935  
»t
;

936 
	}
}

938 #ià
defšed
(
CONFIG_COMPAT
è&& !defšed(
COMPAT
)

939 
	~"com·t/x’İrof.c
"

	@xmalloc_tlsf.c

26 
	~<x’/cÚfig.h
>

27 
	~<x’/œq.h
>

28 
	~<x’/mm.h
>

29 
	~<asm/time.h
>

31 
	#MAX_POOL_NAME_LEN
 16

	)

34 
	#MEM_ALIGN
 ((*è* 2)

	)

35 
	#MEM_ALIGN_MASK
 (~(
MEM_ALIGN
 - 1))

	)

37 
	#MAX_FLI
 (30)

	)

38 
	#MAX_LOG2_SLI
 (5)

	)

39 
	#MAX_SLI
 (1 << 
MAX_LOG2_SLI
)

	)

41 
	#FLI_OFFSET
 (6)

	)

43 
	#SMALL_BLOCK
 (128)

	)

44 
	#REAL_FLI
 (
MAX_FLI
 - 
FLI_OFFSET
)

	)

45 
	#MIN_BLOCK_SIZE
 ((
ä“_±r
))

	)

46 
	#BHDR_OVERHEAD
 ((
bhdr
è- 
MIN_BLOCK_SIZE
)

	)

48 
	#PTR_MASK
 ((*è- 1)

	)

49 
	#BLOCK_SIZE_MASK
 (0xFFFFFFFF - 
PTR_MASK
)

	)

51 
	#GET_NEXT_BLOCK
(
addr
, 
r
è((
bhdr
 *) \

52 ((*)(
addr
è+ (
r
)))

	)

53 
	#ROUNDUP_SIZE
(
r
è((Ôè+ 
MEM_ALIGN
 - 1è& 
MEM_ALIGN_MASK
)

	)

54 
	#ROUNDDOWN_SIZE
(
r
è(Ôè& 
MEM_ALIGN_MASK
)

	)

55 
	#ROUNDUP_PAGE
(
r
è((Ôè+ 
PAGE_SIZE
 - 1è& 
PAGE_MASK
)

	)

57 
	#BLOCK_STATE
 (0x1)

	)

58 
	#PREV_STATE
 (0x2)

	)

61 
	#FREE_BLOCK
 (0x1)

	)

62 
	#USED_BLOCK
 (0x0)

	)

65 
	#PREV_FREE
 (0x2)

	)

66 
	#PREV_USED
 (0x0)

	)

68 
¥šlock_t
 
	gpoŞ_li¡_lock
;

69 
li¡_h—d
 
	gpoŞ_li¡_h—d
;

71 
	sä“_±r
 {

72 
bhdr
 *
	m´ev
;

73 
bhdr
 *
	mÃxt
;

76 
	sbhdr
 {

78 
bhdr
 *
	m´ev_hdr
;

84 
u32
 
	msize
;

87 
ä“_±r
 
	mä“_±r
;

88 
u8
 
	mbufãr
[(
ä“_±r
)];

89 } 
	m±r
;

92 
	sxmem_poŞ
 {

94 
u32
 
	mæ_b™m­
;

97 
u32
 
	m¦_b™m­
[
REAL_FLI
];

100 
bhdr
 *
	mm©rix
[
REAL_FLI
][
MAX_SLI
];

102 
¥šlock_t
 
	mlock
;

104 
	mš™_size
;

105 
	mmax_size
;

106 
	mgrow_size
;

109 
	mu£d_size
;

110 
	mnum_»giÚs
;

113 
xmem_poŞ_g‘_memÜy
 *
	mg‘_mem
;

114 
xmem_poŞ_put_memÜy
 *
	mput_mem
;

116 
li¡_h—d
 
	mli¡
;

118 *
	mš™_»giÚ
;

119 
	mÇme
[
MAX_POOL_NAME_LEN
];

129 
šlše
 
	$MAPPING_SEARCH
(*
r
, *
æ
, *
¦
)

131 
t
;

133 iàĞ*
r
 < 
SMALL_BLOCK
 )

135 *
æ
 = 0;

136 *
¦
 = *
r
 / (
SMALL_BLOCK
 / 
MAX_SLI
);

140 
t
 = (1 << (
	`æs
(*
r
è- 1 - 
MAX_LOG2_SLI
)) - 1;

141 *
r
 = *¸+ 
t
;

142 *
æ
 = 
	`æs
(*
r
) - 1;

143 *
¦
 = (*
r
 >> (*
æ
 - 
MAX_LOG2_SLI
)è- 
MAX_SLI
;

144 *
æ
 -ğ
FLI_OFFSET
;

148 *
r
 &ğ~
t
;

150 
	}
}

157 
šlše
 
	$MAPPING_INSERT
(
r
, *
æ
, *
¦
)

159 iàĞ
r
 < 
SMALL_BLOCK
 )

161 *
æ
 = 0;

162 *
¦
 = 
r
 / (
SMALL_BLOCK
 / 
MAX_SLI
);

166 *
æ
 = 
	`æs
(
r
) - 1;

167 *
¦
 = (
r
 >> (*
æ
 - 
MAX_LOG2_SLI
)è- 
MAX_SLI
;

168 *
æ
 -ğ
FLI_OFFSET
;

170 
	}
}

176 
šlše
 
bhdr
 *
	$FIND_SUITABLE_BLOCK
(
xmem_poŞ
 *
p
, *
æ
,

177 *
¦
)

179 
u32
 
tmp
 = 
p
->
¦_b™m­
[*
æ
] & (~0 << *
¦
);

180 
bhdr
 *
b
 = 
NULL
;

182 iàĞ
tmp
 )

184 *
¦
 = 
	`ffs
(
tmp
) - 1;

185 
b
 = 
p
->
m©rix
[*
æ
][*
¦
];

189 *
æ
 = 
	`ffs
(
p
->
æ_b™m­
 & (~0 << (*fl + 1))) - 1;

190 iàĞ
	`lik–y
(*
æ
 > 0) )

192 *
¦
 = 
	`ffs
(
p
->
¦_b™m­
[*
æ
]) - 1;

193 
b
 = 
p
->
m©rix
[*
æ
][*
¦
];

197  
b
;

198 
	}
}

203 
šlše
 
	$EXTRACT_BLOCK_HDR
(
bhdr
 *
b
, 
xmem_poŞ
 *
p
, 
æ
,

204 
¦
)

206 
p
->
m©rix
[
æ
][
¦
] = 
b
->
±r
.
ä“_±r
.
Ãxt
;

207 iàĞ
p
->
m©rix
[
æ
][
¦
] )

209 
p
->
m©rix
[
æ
][
¦
]->
±r
.
ä“_±r
.
´ev
 = 
NULL
;

213 
	`ş—r_b™
(
¦
, &
p
->
¦_b™m­
[
æ
]);

214 iàĞ!
p
->
¦_b™m­
[
æ
] )

215 
	`ş—r_b™
(
æ
, &
p
->
æ_b™m­
);

217 
b
->
±r
.
ä“_±r
 = (ä“_±rè{
NULL
, NULL};

218 
	}
}

223 
šlše
 
	$EXTRACT_BLOCK
(
bhdr
 *
b
, 
xmem_poŞ
 *
p
, 
æ
,

224 
¦
)

226 iàĞ
b
->
±r
.
ä“_±r
.
Ãxt
 )

227 
b
->
±r
.
ä“_±r
.
Ãxt
->±r.ä“_±r.
´ev
 =

228 
b
->
±r
.
ä“_±r
.
´ev
;

229 iàĞ
b
->
±r
.
ä“_±r
.
´ev
 )

230 
b
->
±r
.
ä“_±r
.
´ev
->±r.ä“_±r.
Ãxt
 =

231 
b
->
±r
.
ä“_±r
.
Ãxt
;

232 iàĞ
p
->
m©rix
[
æ
][
¦
] =ğ
b
 )

234 
p
->
m©rix
[
æ
][
¦
] = 
b
->
±r
.
ä“_±r
.
Ãxt
;

235 iàĞ!
p
->
m©rix
[
æ
][
¦
] )

237 
	`ş—r_b™
(
¦
, &
p
->
¦_b™m­
[
æ
]);

238 iàĞ!
p
->
¦_b™m­
[
æ
] )

239 
	`ş—r_b™
 (
æ
, &
p
->
æ_b™m­
);

242 
b
->
±r
.
ä“_±r
 = (ä“_±rè{
NULL
, NULL};

243 
	}
}

248 
šlše
 
	$INSERT_BLOCK
(
bhdr
 *
b
, 
xmem_poŞ
 *
p
, 
æ
, 
¦
)

250 
b
->
±r
.
ä“_±r
 = (ä“_±rè{
NULL
, 
p
->
m©rix
[
æ
][
¦
]};

251 iàĞ
p
->
m©rix
[
æ
][
¦
] )

252 
p
->
m©rix
[
æ
][
¦
]->
±r
.
ä“_±r
.
´ev
 = 
b
;

253 
p
->
m©rix
[
æ
][
¦
] = 
b
;

254 
	`£t_b™
(
¦
, &
p
->
¦_b™m­
[
æ
]);

255 
	`£t_b™
(
æ
, &
p
->
æ_b™m­
);

256 
	}
}

262 
šlše
 
	$ADD_REGION
(*
»giÚ
, 
»giÚ_size
,

263 
xmem_poŞ
 *
poŞ
)

265 
æ
, 
¦
;

266 
bhdr
 *
b
, *
lb
;

268 
b
 = (
bhdr
 *)(
»giÚ
);

269 
b
->
´ev_hdr
 = 
NULL
;

270 
b
->
size
 = 
	`ROUNDDOWN_SIZE
(
»giÚ_size
 - 2 * 
BHDR_OVERHEAD
)

271 | 
FREE_BLOCK
 | 
PREV_USED
;

272 
	`MAPPING_INSERT
(
b
->
size
 & 
BLOCK_SIZE_MASK
, &
æ
, &
¦
);

273 
	`INSERT_BLOCK
(
b
, 
poŞ
, 
æ
, 
¦
);

275 
lb
 = 
	`GET_NEXT_BLOCK
(
b
->
±r
.
bufãr
, b->
size
 & 
BLOCK_SIZE_MASK
);

276 
lb
->
´ev_hdr
 = 
b
;

277 
lb
->
size
 = 0 | 
USED_BLOCK
 | 
PREV_FREE
;

278 
poŞ
->
u£d_size
 +ğ
BHDR_OVERHEAD
;

279 
poŞ
->
num_»giÚs
++;

280 
	}
}

286 
xmem_poŞ
 *
	$xmem_poŞ_ü—‹
(

287 cÚ¡ *
Çme
,

288 
xmem_poŞ_g‘_memÜy
 
g‘_mem
,

289 
xmem_poŞ_put_memÜy
 
put_mem
,

290 
š™_size
,

291 
max_size
,

292 
grow_size
)

294 
xmem_poŞ
 *
poŞ
;

295 
poŞ_by‹s
, 
poŞ_Üd”
;

297 
	`BUG_ON
(
max_size
 && (max_siz< 
š™_size
));

299 
poŞ_by‹s
 = 
	`ROUNDUP_SIZE
((*
poŞ
));

300 
poŞ_Üd”
 = 
	`g‘_Üd”_äom_by‹s
(
poŞ_by‹s
);

302 
poŞ
 = (*)
	`®loc_x’h—p_·ges
(
poŞ_Üd”
, 0);

303 iàĞ
poŞ
 =ğ
NULL
 )

304  
NULL
;

305 
	`mem£t
(
poŞ
, 0, 
poŞ_by‹s
);

308 
š™_size
 = 
	`ROUNDUP_PAGE
(init_size);

309 
max_size
 = 
	`ROUNDUP_PAGE
(max_size);

310 
grow_size
 = 
	`ROUNDUP_PAGE
(grow_size);

313 
poŞ
->
u£d_size
 = 0;

315 
poŞ
->
š™_size
 = init_size;

316 
poŞ
->
max_size
 = max_size;

317 
poŞ
->
grow_size
 = grow_size;

318 
poŞ
->
g‘_mem
 = get_mem;

319 
poŞ
->
put_mem
 =…ut_mem;

320 
	`¡¾ıy
(
poŞ
->
Çme
,‚ame, (pool->name));

325 
	`¥š_lock_š™
(&
poŞ
->
lock
);

327 
	`¥š_lock
(&
poŞ_li¡_lock
);

328 
	`li¡_add_
(&
poŞ
->
li¡
, &
poŞ_li¡_h—d
);

329 
	`¥š_uÆock
(&
poŞ_li¡_lock
);

331  
poŞ
;

332 
	}
}

334 
	$xmem_poŞ_g‘_u£d_size
(
xmem_poŞ
 *
poŞ
)

336  
poŞ
->
u£d_size
;

337 
	}
}

339 
	$xmem_poŞ_g‘_tÙ®_size
(
xmem_poŞ
 *
poŞ
)

341 
tÙ®
;

342 
tÙ®
 = 
	`ROUNDUP_SIZE
((*
poŞ
))

343 + 
poŞ
->
š™_size


344 + (
poŞ
->
num_»giÚs
 - 1è*…oŞ->
grow_size
;

345  
tÙ®
;

346 
	}
}

348 
	$xmem_poŞ_de¡roy
(
xmem_poŞ
 *
poŞ
)

350 
poŞ_by‹s
, 
poŞ_Üd”
;

352 iàĞ
poŞ
 =ğ
NULL
 )

356 iàĞ
	`xmem_poŞ_g‘_u£d_size
(
poŞ
è=ğ
BHDR_OVERHEAD
 )

358 
	`ASSERT
(!
poŞ
->
š™_»giÚ
);

359 
poŞ
->
u£d_size
 -ğ
BHDR_OVERHEAD
;

363 iàĞ
	`xmem_poŞ_g‘_u£d_size
(
poŞ
) )

364 
	`´štk
("memory†eak in…ool: %s (%p). "

366 
poŞ
->
Çme
,…oŞ, 
	`xmem_poŞ_g‘_u£d_size
(pool));

368 
	`¥š_lock
(&
poŞ_li¡_lock
);

369 
	`li¡_d–_š™
(&
poŞ
->
li¡
);

370 
	`¥š_uÆock
(&
poŞ_li¡_lock
);

372 
poŞ_by‹s
 = 
	`ROUNDUP_SIZE
((*
poŞ
));

373 
poŞ_Üd”
 = 
	`g‘_Üd”_äom_by‹s
(
poŞ_by‹s
);

374 
	`ä“_x’h—p_·ges
(
poŞ
,
poŞ_Üd”
);

375 
	}
}

377 *
	$xmem_poŞ_®loc
(
size
, 
xmem_poŞ
 *
poŞ
)

379 
bhdr
 *
b
, *
b2
, *
Ãxt_b
, *
»giÚ
;

380 
æ
, 
¦
;

381 
tmp_size
;

383 iàĞ
poŞ
->
š™_»giÚ
 =ğ
NULL
 )

385 iàĞ(
»giÚ
 = 
poŞ
->
	`g‘_mem
ÕoŞ->
š™_size
)è=ğ
NULL
 )

386 
out
;

387 
	`ADD_REGION
(
»giÚ
, 
poŞ
->
š™_size
,…ool);

388 
poŞ
->
š™_»giÚ
 = 
»giÚ
;

391 
size
 = (siz< 
MIN_BLOCK_SIZE
è? MIN_BLOCK_SIZE : 
	`ROUNDUP_SIZE
(size);

394 
	`¥š_lock
(&
poŞ
->
lock
);

395 
»Œy_fšd
:

396 
	`MAPPING_SEARCH
(&
size
, &
æ
, &
¦
);

399 iàĞ!(
b
 = 
	`FIND_SUITABLE_BLOCK
(
poŞ
, &
æ
, &
¦
)) )

402 iàĞ
size
 > (
poŞ
->
grow_size
 - 2 * 
BHDR_OVERHEAD
) )

403 
out_locked
;

404 iàĞ
poŞ
->
max_size
 && (poŞ->
š™_size
 +

405 
poŞ
->
num_»giÚs
 *…oŞ->
grow_size


406 > 
poŞ
->
max_size
) )

407 
out_locked
;

408 
	`¥š_uÆock
(&
poŞ
->
lock
);

409 iàĞ(
»giÚ
 = 
poŞ
->
	`g‘_mem
ÕoŞ->
grow_size
)è=ğ
NULL
 )

410 
out
;

411 
	`¥š_lock
(&
poŞ
->
lock
);

412 
	`ADD_REGION
(
»giÚ
, 
poŞ
->
grow_size
,…ool);

413 
»Œy_fšd
;

415 
	`EXTRACT_BLOCK_HDR
(
b
, 
poŞ
, 
æ
, 
¦
);

418 
Ãxt_b
 = 
	`GET_NEXT_BLOCK
(
b
->
±r
.
bufãr
, b->
size
 & 
BLOCK_SIZE_MASK
);

420 
tmp_size
 = (
b
->
size
 & 
BLOCK_SIZE_MASK
) - size;

421 iàĞ
tmp_size
 >ğ(
bhdr
) )

423 
tmp_size
 -ğ
BHDR_OVERHEAD
;

424 
b2
 = 
	`GET_NEXT_BLOCK
(
b
->
±r
.
bufãr
, 
size
);

426 
b2
->
size
 = 
tmp_size
 | 
FREE_BLOCK
 | 
PREV_USED
;

427 
b2
->
´ev_hdr
 = 
b
;

429 
Ãxt_b
->
´ev_hdr
 = 
b2
;

431 
	`MAPPING_INSERT
(
tmp_size
, &
æ
, &
¦
);

432 
	`INSERT_BLOCK
(
b2
, 
poŞ
, 
æ
, 
¦
);

434 
b
->
size
 = siz| (b->siz& 
PREV_STATE
);

438 
Ãxt_b
->
size
 &ğ(~
PREV_FREE
);

439 
b
->
size
 &ğ(~
FREE_BLOCK
);

442 
poŞ
->
u£d_size
 +ğ(
b
->
size
 & 
BLOCK_SIZE_MASK
è+ 
BHDR_OVERHEAD
;

444 
	`¥š_uÆock
(&
poŞ
->
lock
);

445  (*)
b
->
±r
.
bufãr
;

448 
out_locked
:

449 
	`¥š_uÆock
(&
poŞ
->
lock
);

451 
out
:

452  
NULL
;

453 
	}
}

455 
	$xmem_poŞ_ä“
(*
±r
, 
xmem_poŞ
 *
poŞ
)

457 
bhdr
 *
b
, *
tmp_b
;

458 
æ
 = 0, 
¦
 = 0;

460 iàĞ
	`uÆik–y
(
±r
 =ğ
NULL
) )

463 
b
 = (
bhdr
 *)((*è
±r
 - 
BHDR_OVERHEAD
);

465 
	`¥š_lock
(&
poŞ
->
lock
);

466 
b
->
size
 |ğ
FREE_BLOCK
;

467 
poŞ
->
u£d_size
 -ğ(
b
->
size
 & 
BLOCK_SIZE_MASK
è+ 
BHDR_OVERHEAD
;

468 
b
->
±r
.
ä“_±r
 = (ä“_±rè{ 
NULL
, NULL};

469 
tmp_b
 = 
	`GET_NEXT_BLOCK
(
b
->
±r
.
bufãr
, b->
size
 & 
BLOCK_SIZE_MASK
);

470 iàĞ
tmp_b
->
size
 & 
FREE_BLOCK
 )

472 
	`MAPPING_INSERT
(
tmp_b
->
size
 & 
BLOCK_SIZE_MASK
, &
æ
, &
¦
);

473 
	`EXTRACT_BLOCK
(
tmp_b
, 
poŞ
, 
æ
, 
¦
);

474 
b
->
size
 +ğ(
tmp_b
->siz& 
BLOCK_SIZE_MASK
è+ 
BHDR_OVERHEAD
;

476 iàĞ
b
->
size
 & 
PREV_FREE
 )

478 
tmp_b
 = 
b
->
´ev_hdr
;

479 
	`MAPPING_INSERT
(
tmp_b
->
size
 & 
BLOCK_SIZE_MASK
, &
æ
, &
¦
);

480 
	`EXTRACT_BLOCK
(
tmp_b
, 
poŞ
, 
æ
, 
¦
);

481 
tmp_b
->
size
 +ğ(
b
->siz& 
BLOCK_SIZE_MASK
è+ 
BHDR_OVERHEAD
;

482 
b
 = 
tmp_b
;

484 
tmp_b
 = 
	`GET_NEXT_BLOCK
(
b
->
±r
.
bufãr
, b->
size
 & 
BLOCK_SIZE_MASK
);

485 
tmp_b
->
´ev_hdr
 = 
b
;

487 
	`MAPPING_INSERT
(
b
->
size
 & 
BLOCK_SIZE_MASK
, &
æ
, &
¦
);

489 iàĞ(
b
->
´ev_hdr
 =ğ
NULL
è&& ((
tmp_b
->
size
 & 
BLOCK_SIZE_MASK
) == 0) )

491 
poŞ
->
	`put_mem
(
b
);

492 
poŞ
->
num_»giÚs
--;

493 
poŞ
->
u£d_size
 -ğ
BHDR_OVERHEAD
;

494 
out
;

497 
	`INSERT_BLOCK
(
b
, 
poŞ
, 
æ
, 
¦
);

499 
tmp_b
->
size
 |ğ
PREV_FREE
;

500 
tmp_b
->
´ev_hdr
 = 
b
;

501 
out
:

502 
	`¥š_uÆock
(&
poŞ
->
lock
);

503 
	}
}

505 
	$xmem_poŞ_max®loc
(
xmem_poŞ
 *
poŞ
)

507  
poŞ
->
grow_size
 - (2 * 
BHDR_OVERHEAD
);

508 
	}
}

514 
xmem_poŞ
 *
	gx’poŞ
;

516 *
	$xm®loc_poŞ_g‘
(
size
)

518 
	`ASSERT
(
size
 =ğ
PAGE_SIZE
);

519  
	`®loc_x’h—p_·ge
();

520 
	}
}

522 
	$xm®loc_poŞ_put
(*
p
)

524 
	`ä“_x’h—p_·ge
(
p
);

525 
	}
}

527 *
	$xm®loc_whŞe_·ges
(
size
)

529 
bhdr
 *
b
;

530 
·geÜd”
 = 
	`g‘_Üd”_äom_by‹s
(
size
 + 
BHDR_OVERHEAD
);

532 
b
 = 
	`®loc_x’h—p_·ges
(
·geÜd”
, 0);

533 iàĞ
b
 =ğ
NULL
 )

534  
NULL
;

536 
b
->
size
 = (1 << (
·geÜd”
 + 
PAGE_SHIFT
));

537  (*)
b
->
±r
.
bufãr
;

538 
	}
}

540 
	$sf_š™
()

542 
	`INIT_LIST_HEAD
(&
poŞ_li¡_h—d
);

543 
	`¥š_lock_š™
(&
poŞ_li¡_lock
);

544 
x’poŞ
 = 
	`xmem_poŞ_ü—‹
(

545 "xm®loc", 
xm®loc_poŞ_g‘
, 
xm®loc_poŞ_put
,

546 
PAGE_SIZE
, 0, PAGE_SIZE);

547 
	`BUG_ON
(!
x’poŞ
);

548 
	}
}

554 *
	$_xm®loc
(
size
, 
®ign
)

556 *
p
 = 
NULL
;

557 
u32
 
·d
;

559 
	`ASSERT
(!
	`š_œq
());

561 
	`ASSERT
((
®ign
 & (align - 1)) == 0);

562 iàĞ
®ign
 < 
MEM_ALIGN
 )

563 
®ign
 = 
MEM_ALIGN
;

564 
size
 +ğ
®ign
 - 
MEM_ALIGN
;

566 iàĞ!
x’poŞ
 )

567 
	`sf_š™
();

569 iàĞ
size
 < 
PAGE_SIZE
 )

570 
p
 = 
	`xmem_poŞ_®loc
(
size
, 
x’poŞ
);

571 iàĞ
p
 =ğ
NULL
 )

572 
p
 = 
	`xm®loc_whŞe_·ges
(
size
);

575 iàĞ(
·d
 = -()
p
 & (
®ign
 - 1)) != 0 )

577 *
q
 = (*)
p
 + 
·d
;

578 
bhdr
 *
b
 = (bhd¸*)(
q
 - 
BHDR_OVERHEAD
);

579 
	`ASSERT
(
q
 > (*)
p
);

580 
b
->
size
 = 
·d
 | 1;

581 
p
 = 
q
;

584 
	`ASSERT
((()
p
 & (
®ign
 - 1)) == 0);

585  
p
;

586 
	}
}

588 
	$xä“
(*
p
)

590 
bhdr
 *
b
;

592 
	`ASSERT
(!
	`š_œq
());

594 iàĞ
p
 =ğ
NULL
 )

598 
b
 = (
bhdr
 *)((*è
p
 - 
BHDR_OVERHEAD
);

599 iàĞ
b
->
size
 & 1 )

601 
p
 = (*í - (
b
->
size
 & ~1u);

602 
b
 = (
bhdr
 *)((*)
p
 - 
BHDR_OVERHEAD
);

603 
	`ASSERT
(!(
b
->
size
 & 1));

606 iàĞ
b
->
size
 >ğ
PAGE_SIZE
 )

607 
	`ä“_x’h—p_·ges
((*)
b
, 
	`g‘_Üd”_äom_by‹s
(b->
size
));

609 
	`xmem_poŞ_ä“
(
p
, 
x’poŞ
);

610 
	}
}

	@/usr/include/asm/byteorder.h

1 #iâdeà
_ASM_X86_BYTEORDER_H


2 
	#_ASM_X86_BYTEORDER_H


	)

4 
	~<lšux/by‹Üd”/l™e_’dŸn.h
>

	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	#dma_addr_t
 
dma_addr_t


	)

6 
	~<asm-g’”ic/ty³s.h
>

	@/usr/include/byteswap.h

19 #iâdeà
_BYTESWAP_H


20 
	#_BYTESWAP_H
 1

	)

23 
	~<b™s/by‹sw­.h
>

30 
	#bsw­_16
(
x
è
	`__bsw­_16
 (x)

	)

33 
	#bsw­_32
(
x
è
	`__bsw­_32
 (x)

	)

35 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

37 
	#bsw­_64
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/inttypes.h

23 #iâdeà
_INTTYPES_H


24 
	#_INTTYPES_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<¡dšt.h
>

31 #iâdeà
____gwch¬_t_defšed


32 #ifdeà
__ılu¥lus


33 
	#__gwch¬_t
 
wch¬_t


	)

34 #–ià
defšed
 
__WCHAR_TYPE__


35 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

37 
	#__Ãed_wch¬_t


	)

38 
	~<¡ddef.h
>

39 
wch¬_t
 
	t__gwch¬_t
;

41 
	#____gwch¬_t_defšed
 1

	)

47 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_FORMAT_MACROS


49 #ià
__WORDSIZE
 == 64

50 
	#__PRI64_PREFIX
 "l"

	)

51 
	#__PRIPTR_PREFIX
 "l"

	)

53 
	#__PRI64_PREFIX
 "Î"

	)

54 
	#__PRIPTR_PREFIX


	)

60 
	#PRId8
 "d"

	)

61 
	#PRId16
 "d"

	)

62 
	#PRId32
 "d"

	)

63 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

65 
	#PRIdLEAST8
 "d"

	)

66 
	#PRIdLEAST16
 "d"

	)

67 
	#PRIdLEAST32
 "d"

	)

68 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIdFAST8
 "d"

	)

71 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

72 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

73 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

76 
	#PRIi8
 "i"

	)

77 
	#PRIi16
 "i"

	)

78 
	#PRIi32
 "i"

	)

79 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

81 
	#PRIiLEAST8
 "i"

	)

82 
	#PRIiLEAST16
 "i"

	)

83 
	#PRIiLEAST32
 "i"

	)

84 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIiFAST8
 "i"

	)

87 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

88 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

89 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

92 
	#PRIo8
 "o"

	)

93 
	#PRIo16
 "o"

	)

94 
	#PRIo32
 "o"

	)

95 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

97 
	#PRIoLEAST8
 "o"

	)

98 
	#PRIoLEAST16
 "o"

	)

99 
	#PRIoLEAST32
 "o"

	)

100 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIoFAST8
 "o"

	)

103 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

104 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

105 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

108 
	#PRIu8
 "u"

	)

109 
	#PRIu16
 "u"

	)

110 
	#PRIu32
 "u"

	)

111 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

113 
	#PRIuLEAST8
 "u"

	)

114 
	#PRIuLEAST16
 "u"

	)

115 
	#PRIuLEAST32
 "u"

	)

116 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIuFAST8
 "u"

	)

119 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

120 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

121 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

124 
	#PRIx8
 "x"

	)

125 
	#PRIx16
 "x"

	)

126 
	#PRIx32
 "x"

	)

127 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

129 
	#PRIxLEAST8
 "x"

	)

130 
	#PRIxLEAST16
 "x"

	)

131 
	#PRIxLEAST32
 "x"

	)

132 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIxFAST8
 "x"

	)

135 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

136 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

137 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

140 
	#PRIX8
 "X"

	)

141 
	#PRIX16
 "X"

	)

142 
	#PRIX32
 "X"

	)

143 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

145 
	#PRIXLEAST8
 "X"

	)

146 
	#PRIXLEAST16
 "X"

	)

147 
	#PRIXLEAST32
 "X"

	)

148 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

150 
	#PRIXFAST8
 "X"

	)

151 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

152 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

153 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

157 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

158 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

159 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

160 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

161 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

162 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

166 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

167 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

168 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

169 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

170 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

171 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

177 
	#SCNd8
 "hhd"

	)

178 
	#SCNd16
 "hd"

	)

179 
	#SCNd32
 "d"

	)

180 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

182 
	#SCNdLEAST8
 "hhd"

	)

183 
	#SCNdLEAST16
 "hd"

	)

184 
	#SCNdLEAST32
 "d"

	)

185 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNdFAST8
 "hhd"

	)

188 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

189 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

190 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

193 
	#SCNi8
 "hhi"

	)

194 
	#SCNi16
 "hi"

	)

195 
	#SCNi32
 "i"

	)

196 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

198 
	#SCNiLEAST8
 "hhi"

	)

199 
	#SCNiLEAST16
 "hi"

	)

200 
	#SCNiLEAST32
 "i"

	)

201 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNiFAST8
 "hhi"

	)

204 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

205 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

206 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

209 
	#SCNu8
 "hhu"

	)

210 
	#SCNu16
 "hu"

	)

211 
	#SCNu32
 "u"

	)

212 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

214 
	#SCNuLEAST8
 "hhu"

	)

215 
	#SCNuLEAST16
 "hu"

	)

216 
	#SCNuLEAST32
 "u"

	)

217 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNuFAST8
 "hhu"

	)

220 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

221 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

222 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

225 
	#SCNo8
 "hho"

	)

226 
	#SCNo16
 "ho"

	)

227 
	#SCNo32
 "o"

	)

228 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

230 
	#SCNoLEAST8
 "hho"

	)

231 
	#SCNoLEAST16
 "ho"

	)

232 
	#SCNoLEAST32
 "o"

	)

233 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNoFAST8
 "hho"

	)

236 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

237 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

238 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

241 
	#SCNx8
 "hhx"

	)

242 
	#SCNx16
 "hx"

	)

243 
	#SCNx32
 "x"

	)

244 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

246 
	#SCNxLEAST8
 "hhx"

	)

247 
	#SCNxLEAST16
 "hx"

	)

248 
	#SCNxLEAST32
 "x"

	)

249 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

251 
	#SCNxFAST8
 "hhx"

	)

252 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

253 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

254 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

258 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

259 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

260 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

261 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

262 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

265 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

266 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

267 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

268 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

269 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

274 
	g__BEGIN_DECLS


276 #ià
__WORDSIZE
 == 64

281 
	mquÙ
;

282 
	m»m
;

283 } 
	timaxdiv_t
;

290 
	mquÙ
;

291 
	m»m
;

292 } 
	timaxdiv_t
;

298 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

301 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

302 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

305 
štmax_t
 
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

306 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

309 
uštmax_t
 
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

310 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

313 
štmax_t
 
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

314 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

315 
__THROW
;

318 
uštmax_t
 
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

319 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

320 
__THROW
;

322 #ifdeà
__USE_EXTERN_INLINES


324 #ià
__WORDSIZE
 == 64

326 
	$__¡¹Ş_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

327 **
__»¡riù
 
__’d±r
,

328 
__ba£
, 
__group
)

329 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

331 
__ex‹º_šlše
 
štmax_t


332 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

333 
ba£
))

335  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

336 
	}
}

338 
	$__¡¹oul_š‹º®
 (
__cÚ¡
 *

339 
__»¡riù
 
__ÅŒ
,

340 ** 
__»¡riù
 
__’d±r
,

341 
__ba£
, 
__group
)

342 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

344 
__ex‹º_šlše
 
uštmax_t


345 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

346 
ba£
))

348  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

349 
	}
}

351 
	$__wc¡Ş_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

352 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

353 
__ba£
, 
__group
)

354 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

356 
__ex‹º_šlše
 
štmax_t


357 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

358 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

360  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

361 
	}
}

363 
	$__wc¡oul_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

364 
__»¡riù
 
__ÅŒ
,

365 
__gwch¬_t
 **

366 
__»¡riù
 
__’d±r
,

367 
__ba£
, 
__group
)

368 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

370 
__ex‹º_šlše
 
uštmax_t


371 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

372 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

374  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

375 
	}
}

379 
__ex‹nsiÚ__


380 
	$__¡¹Şl_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

381 **
__»¡riù
 
__’d±r
,

382 
__ba£
, 
__group
)

383 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

385 
__ex‹º_šlše
 
štmax_t


386 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

387 
ba£
))

389  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

390 
	}
}

392 
__ex‹nsiÚ__


393 
	$__¡¹ouÎ_š‹º®
 (
__cÚ¡
 *

394 
__»¡riù
 
__ÅŒ
,

396 
__»¡riù
 
__’d±r
,

397 
__ba£
,

398 
__group
)

399 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

401 
__ex‹º_šlše
 
uštmax_t


402 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

403 
ba£
))

405  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

406 
	}
}

408 
__ex‹nsiÚ__


409 
	$__wc¡Şl_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

410 
__»¡riù
 
__ÅŒ
,

411 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

412 
__ba£
, 
__group
)

413 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

415 
__ex‹º_šlše
 
štmax_t


416 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

417 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

419  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

420 
	}
}

423 
__ex‹nsiÚ__


424 
	$__wc¡ouÎ_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

425 
__»¡riù
 
__ÅŒ
,

426 
__gwch¬_t
 **

427 
__»¡riù
 
__’d±r
,

428 
__ba£
,

429 
__group
)

430 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

432 
__ex‹º_šlše
 
uštmax_t


433 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

434 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

436  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

437 
	}
}

442 
	g__END_DECLS


	@/usr/include/linux/kernel.h

1 #iâdeà
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

10 
	#SI_LOAD_SHIFT
 16

	)

11 
	ssysšfo
 {

12 
	mu±ime
;

13 
	mlßds
[3];

14 
	mtÙ®¿m
;

15 
	mä“¿m
;

16 
	msh¬ed¿m
;

17 
	mbufã¼am
;

18 
	mtÙ®sw­
;

19 
	mä“sw­
;

20 
	m´ocs
;

21 
	m·d
;

22 
	mtÙ®high
;

23 
	mä“high
;

24 
	mmem_un™
;

25 
	m_f
[20-2*()-()];

29 
	#BUILD_BUG_ON
(
cÚd™iÚ
è(()
	`BUILD_BUG_ON_ZERO
(cÚd™iÚ))

	)

32 
	#MAYBE_BUILD_BUG_ON
(
cÚd
è(()([1 - 2 * !!(cÚd)]))

	)

35 
	#BUILD_BUG_ON_NOT_POWER_OF_2
(
n
) \

36 
	`BUILD_BUG_ON
((
n
è=ğ0 || ((Òè& (Òè- 1)è!ğ0))

	)

42 
	#BUILD_BUG_ON_ZERO
(
e
è((¡ruù { :-!!Ó); }))

	)

43 
	#BUILD_BUG_ON_NULL
(
e
è((*)(¡ruù { :-!!Ó); }))

	)

46 
	#__FUNCTION__
 (
__func__
)

	)

49 #ifdeà
CONFIG_NUMA


50 
	#NUMA_BUILD
 1

	)

52 
	#NUMA_BUILD
 0

	)

56 #ifdeà
CONFIG_FTRACE_MCOUNT_RECORD


57 
	#REBUILD_DUE_TO_FTRACE_MCOUNT_RECORD


	)

60 
	gmoduË
;

62 
m¬k_h¬dw¬e_unsuµÜ‹d
(cÚ¡ *
msg
);

63 
m¬k_‹ch_´ev›w
(cÚ¡ *
msg
, 
moduË
 *
mod
);

	@/usr/include/linux/time.h

1 #iâdeà
_LINUX_TIME_H


2 
	#_LINUX_TIME_H


	)

4 
	~<lšux/ty³s.h
>

7 #iâdeà
_STRUCT_TIMESPEC


8 
	#_STRUCT_TIMESPEC


	)

9 
	stime¥ec
 {

10 
__k”Ãl_time_t
 
	mtv_£c
;

11 
	mtv_n£c
;

15 
	stimev®
 {

16 
__k”Ãl_time_t
 
	mtv_£c
;

17 
__k”Ãl_su£cÚds_t
 
	mtv_u£c
;

20 
	stimezÚe
 {

21 
	mtz_mšu‹swe¡
;

22 
	mtz_d¡time
;

26 
	#NFDBITS
 
__NFDBITS


	)

28 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

29 
	#FD_SET
(
fd
,
fd£
è
	`__FD_SET
(fd,fd£)

	)

30 
	#FD_CLR
(
fd
,
fd£
è
	`__FD_CLR
(fd,fd£)

	)

31 
	#FD_ISSET
(
fd
,
fd£
è
	`__FD_ISSET
(fd,fd£)

	)

32 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
(fd£)

	)

38 
	#ITIMER_REAL
 0

	)

39 
	#ITIMER_VIRTUAL
 1

	)

40 
	#ITIMER_PROF
 2

	)

42 
	s™im”¥ec
 {

43 
time¥ec
 
	m™_š‹rv®
;

44 
time¥ec
 
	m™_v®ue
;

47 
	s™im”v®
 {

48 
timev®
 
	m™_š‹rv®
;

49 
timev®
 
	m™_v®ue
;

55 
	#CLOCK_REALTIME
 0

	)

56 
	#CLOCK_MONOTONIC
 1

	)

57 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

58 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

59 
	#CLOCK_MONOTONIC_RAW
 4

	)

60 
	#CLOCK_REALTIME_COARSE
 5

	)

61 
	#CLOCK_MONOTONIC_COARSE
 6

	)

66 
	#CLOCK_SGI_CYCLE
 10

	)

67 
	#MAX_CLOCKS
 16

	)

68 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

69 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

74 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/stdio.h

24 #iâdeà
_STDIO_H


26 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

36 
	~<b™s/ty³s.h
>

37 
	#__Ãed_FILE


	)

38 
	#__Ãed___FILE


	)

42 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

52 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

53 || 
defšed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_defšed
 1

	)

59 #undeà
__Ãed_FILE


62 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_defšed
 1

	)

69 #undeà
__Ãed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


78 #ifdeà
__GNUC__


79 #iâdeà
_VA_LIST_DEFINED


80 
_G_va_li¡
 
	tva_li¡
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<¡d¬g.h
>

88 #ifdeà
__USE_XOPEN2K8


89 #iâdeà
__off_t_defšed


90 #iâdeà
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_defšed


	)

97 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_defšed


	)

102 #iâdeà
__ssize_t_defšed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_defšed


	)

109 
__BEGIN_NAMESPACE_STD


110 #iâdeà
__USE_FILE_OFFSET64


111 
_G_åos_t
 
	tåos_t
;

113 
_G_åos64_t
 
	tåos_t
;

115 
__END_NAMESPACE_STD


116 #ifdeà
__USE_LARGEFILE64


117 
_G_åos64_t
 
	tåos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #iâdeà
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #iâdeà
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


148 
	#P_tmpdœ
 "/tmp"

	)

161 
	~<b™s/¡dio_lim.h
>

165 
_IO_FILE
 *
¡dš
;

166 
_IO_FILE
 *
¡dout
;

167 
_IO_FILE
 *
¡d”r
;

168 #ifdeà
__STDC__


170 
	#¡dš
 
¡dš


	)

171 
	#¡dout
 
¡dout


	)

172 
	#¡d”r
 
¡d”r


	)

175 
__BEGIN_NAMESPACE_STD


177 
	$»move
 (
__cÚ¡
 *
__f’ame
è
__THROW
;

179 
	$»Çme
 (
__cÚ¡
 *
__Şd
, __cÚ¡ *
__Ãw
è
__THROW
;

180 
__END_NAMESPACE_STD


182 #ifdeà
__USE_ATFILE


184 
	$»Çm—t
 (
__Şdfd
, 
__cÚ¡
 *
__Şd
, 
__Ãwfd
,

185 
__cÚ¡
 *
__Ãw
è
__THROW
;

188 
__BEGIN_NAMESPACE_STD


193 #iâdeà
__USE_FILE_OFFSET64


194 
FILE
 *
	$tmpfe
 (è
__wur
;

196 #ifdeà
__REDIRECT


197 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

199 
	#tmpfe
 
tmpfe64


	)

203 #ifdeà
__USE_LARGEFILE64


204 
FILE
 *
	$tmpfe64
 (è
__wur
;

208 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

209 
__END_NAMESPACE_STD


211 #ifdeà
__USE_MISC


214 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

218 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


226 *
	$‹m²am
 (
__cÚ¡
 *
__dœ
, __cÚ¡ *
__pfx
)

227 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

231 
__BEGIN_NAMESPACE_STD


236 
	`fşo£
 (
FILE
 *
__¡»am
);

241 
	`fæush
 (
FILE
 *
__¡»am
);

242 
__END_NAMESPACE_STD


244 #ifdeà
__USE_MISC


251 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

254 #ifdeà
__USE_GNU


261 
	`fşo£®l
 ();

265 
__BEGIN_NAMESPACE_STD


266 #iâdeà
__USE_FILE_OFFSET64


271 
FILE
 *
	$fİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

272 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

277 
FILE
 *
	$äeİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

278 
__cÚ¡
 *
__»¡riù
 
__modes
,

279 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

281 #ifdeà
__REDIRECT


282 
FILE
 *
	`__REDIRECT
 (
fİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

283 
__cÚ¡
 *
__»¡riù
 
__modes
), 
fİ’64
)

284 
__wur
;

285 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

286 
__cÚ¡
 *
__»¡riù
 
__modes
,

287 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

288 
__wur
;

290 
	#fİ’
 
fİ’64


	)

291 
	#äeİ’
 
äeİ’64


	)

294 
__END_NAMESPACE_STD


295 #ifdeà
__USE_LARGEFILE64


296 
FILE
 *
	$fİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

297 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

298 
FILE
 *
	$äeİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

299 
__cÚ¡
 *
__»¡riù
 
__modes
,

300 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

303 #ifdef 
__USE_POSIX


305 
FILE
 *
	$fdİ’
 (
__fd
, 
__cÚ¡
 *
__modes
è
__THROW
 
__wur
;

308 #ifdef 
__USE_GNU


311 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

312 
__cÚ¡
 *
__»¡riù
 
__modes
,

313 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

316 #ifdeà
__USE_XOPEN2K8


318 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, 
__cÚ¡
 *
__modes
)

319 
__THROW
 
__wur
;

324 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

328 
__BEGIN_NAMESPACE_STD


331 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

335 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

336 
__modes
, 
size_t
 
__n
è
__THROW
;

337 
__END_NAMESPACE_STD


339 #ifdef 
__USE_BSD


342 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

343 
size_t
 
__size
è
__THROW
;

346 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

350 
__BEGIN_NAMESPACE_STD


355 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

356 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

361 
	`´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

363 
	$¥rštf
 (*
__»¡riù
 
__s
,

364 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

370 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

371 
_G_va_li¡
 
__¬g
);

376 
	`v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

378 
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

379 
_G_va_li¡
 
__¬g
è
__THROW
;

380 
__END_NAMESPACE_STD


382 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


383 
__BEGIN_NAMESPACE_C99


385 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

386 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

387 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

389 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

390 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

391 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

392 
__END_NAMESPACE_C99


395 #ifdeà
__USE_GNU


398 
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__f
,

399 
_G_va_li¡
 
__¬g
)

400 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

401 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

402 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

403 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

404 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

405 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

406 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

409 #ifdeà
__USE_XOPEN2K8


416 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

417 
_G_va_li¡
 
__¬g
)

418 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

419 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

420 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

424 
__BEGIN_NAMESPACE_STD


429 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

430 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

435 
	$sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

437 
	$ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

438 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

440 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

441 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

442 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

443 #ifdeà
__REDIRECT


447 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

448 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

449 
__isoc99_fsÿnf
è
__wur
;

450 
	`__REDIRECT
 (
sÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

451 
__isoc99_sÿnf
è
__wur
;

452 
	`__REDIRECT
 (
ssÿnf
, (
__cÚ¡
 *
__»¡riù
 
__s
,

453 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

454 
__isoc99_ssÿnf
è
__THROW
;

456 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

457 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

458 
	$__isoc99_sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

459 
	$__isoc99_ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

460 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

461 
	#fsÿnf
 
__isoc99_fsÿnf


	)

462 
	#sÿnf
 
__isoc99_sÿnf


	)

463 
	#ssÿnf
 
__isoc99_ssÿnf


	)

467 
__END_NAMESPACE_STD


469 #ifdef 
__USE_ISOC99


470 
__BEGIN_NAMESPACE_C99


475 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

476 
_G_va_li¡
 
__¬g
)

477 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

483 
	$vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

484 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

487 
	$vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

488 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

489 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

491 #ià!
defšed
 
__USE_GNU
 \

492 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

493 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

494 #ifdeà
__REDIRECT


498 
	`__REDIRECT
 (
vfsÿnf
,

499 (
FILE
 *
__»¡riù
 
__s
,

500 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

501 
__isoc99_vfsÿnf
)

502 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

503 
	`__REDIRECT
 (
vsÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

504 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

505 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

506 
	`__REDIRECT
 (
vssÿnf
,

507 (
__cÚ¡
 *
__»¡riù
 
__s
,

508 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

509 
__isoc99_vssÿnf
)

510 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

512 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

513 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

514 
_G_va_li¡
 
__¬g
è
__wur
;

515 
	$__isoc99_vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

516 
_G_va_li¡
 
__¬g
è
__wur
;

517 
	$__isoc99_vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

518 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

519 
_G_va_li¡
 
__¬g
è
__THROW
;

520 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

521 
	#vsÿnf
 
__isoc99_vsÿnf


	)

522 
	#vssÿnf
 
__isoc99_vssÿnf


	)

526 
__END_NAMESPACE_C99


530 
__BEGIN_NAMESPACE_STD


535 
	`fg‘c
 (
FILE
 *
__¡»am
);

536 
	`g‘c
 (
FILE
 *
__¡»am
);

542 
	`g‘ch¬
 ();

543 
__END_NAMESPACE_STD


547 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

549 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


554 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

555 
	`g‘ch¬_uÆocked
 ();

558 #ifdeà
__USE_MISC


565 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

569 
__BEGIN_NAMESPACE_STD


577 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

578 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

584 
	`putch¬
 (
__c
);

585 
__END_NAMESPACE_STD


589 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

591 #ifdeà
__USE_MISC


598 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

601 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


606 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

607 
	`putch¬_uÆocked
 (
__c
);

611 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

612 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

614 
	`g‘w
 (
FILE
 *
__¡»am
);

617 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

621 
__BEGIN_NAMESPACE_STD


626 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

627 
__wur
;

634 *
	$g‘s
 (*
__s
è
__wur
;

635 
__END_NAMESPACE_STD


637 #ifdeà
__USE_GNU


644 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

645 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

649 #ifdef 
__USE_XOPEN2K8


660 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

661 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

662 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

663 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

664 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

665 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

673 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

674 
size_t
 *
__»¡riù
 
__n
,

675 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

679 
__BEGIN_NAMESPACE_STD


684 
	`åuts
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

690 
	`puts
 (
__cÚ¡
 *
__s
);

697 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

704 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

705 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

710 
size_t
 
	$fwr™e
 (
__cÚ¡
 *
__»¡riù
 
__±r
, 
size_t
 
__size
,

711 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
è
__wur
;

712 
__END_NAMESPACE_STD


714 #ifdeà
__USE_GNU


721 
	`åuts_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__s
,

722 
FILE
 *
__»¡riù
 
__¡»am
);

725 #ifdeà
__USE_MISC


732 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

733 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

734 
size_t
 
	$fwr™e_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__±r
, 
size_t
 
__size
,

735 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
__BEGIN_NAMESPACE_STD


744 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

749 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

754 
	`»wšd
 (
FILE
 *
__¡»am
);

755 
__END_NAMESPACE_STD


762 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


763 #iâdeà
__USE_FILE_OFFSET64


768 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

773 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

775 #ifdeà
__REDIRECT


776 
	`__REDIRECT
 (
f£eko
,

777 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

778 
f£eko64
);

779 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

781 
	#f£eko
 
f£eko64


	)

782 
	#á–lo
 
á–lo64


	)

787 
__BEGIN_NAMESPACE_STD


788 #iâdeà
__USE_FILE_OFFSET64


793 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

798 
	`f£os
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
);

800 #ifdeà
__REDIRECT


801 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

802 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

803 
	`__REDIRECT
 (
f£os
,

804 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
), 
f£os64
);

806 
	#fg‘pos
 
fg‘pos64


	)

807 
	#f£os
 
f£os64


	)

810 
__END_NAMESPACE_STD


812 #ifdeà
__USE_LARGEFILE64


813 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

814 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

815 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

816 
	`f£os64
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos64_t
 *
__pos
);

819 
__BEGIN_NAMESPACE_STD


821 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

823 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

825 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

826 
__END_NAMESPACE_STD


828 #ifdeà
__USE_MISC


830 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

831 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

832 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

836 
__BEGIN_NAMESPACE_STD


841 
	`³¼Ü
 (
__cÚ¡
 *
__s
);

842 
__END_NAMESPACE_STD


848 
	~<b™s/sys_”¾i¡.h
>

851 #ifdef 
__USE_POSIX


853 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

856 #ifdeà
__USE_MISC


858 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

862 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

863 
defšed
 
__USE_MISC
)

868 
FILE
 *
	$pİ’
 (
__cÚ¡
 *
__commªd
, __cÚ¡ *
__modes
è
__wur
;

874 
	`pşo£
 (
FILE
 *
__¡»am
);

878 #ifdef 
__USE_POSIX


880 *
	$ù”mid
 (*
__s
è
__THROW
;

884 #ifdeà
__USE_XOPEN


886 *
	`cu£rid
 (*
__s
);

890 #ifdef 
__USE_GNU


891 
ob¡ack
;

894 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

895 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

896 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

897 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

898 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

899 
_G_va_li¡
 
__¬gs
)

900 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

904 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


908 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

912 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

915 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

918 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


922 
	#__Ãed_g‘İt


	)

923 
	~<g‘İt.h
>

928 #ifdeà
__USE_EXTERN_INLINES


929 
	~<b™s/¡dio.h
>

931 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


932 
	~<b™s/¡dio2.h
>

934 #ifdeà
__LDBL_COMPAT


935 
	~<b™s/¡dio-ldbl.h
>

938 
__END_DECLS


	@/usr/include/stdlib.h

23 #iâdef 
_STDLIB_H


25 
	~<ã©u»s.h
>

28 
	#__Ãed_size_t


	)

29 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


30 
	#__Ãed_wch¬_t


	)

31 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	g__BEGIN_DECLS


37 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


38 
	#_STDLIB_H
 1

	)

40 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


42 
	~<b™s/wa™æags.h
>

43 
	~<b™s/wa™¡©us.h
>

45 #ifdeà
__USE_BSD


50 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


51 
	#__WAIT_INT
(
¡©us
) \

52 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

53 { .
__š
 = (
¡©us
è}).
__i
))

	)

55 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

63 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
wa™
 *
	m__u±r
;

71 *
	m__Œ
;

72 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

90 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

91 #ifdeà
__WIFCONTINUED


92 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquÙ
;

101 
	m»m
;

102 } 
	tdiv_t
;

105 #iâdeà
__ldiv_t_defšed


108 
	mquÙ
;

109 
	m»m
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_defšed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 struct

120 
	mquÙ
;

121 
	m»m
;

122 } 
	tÎdiv_t
;

123 
	#__Îdiv_t_defšed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

140 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__cÚ¡
 *
__ÅŒ
)

146 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

148 
	$©oi
 (
__cÚ¡
 *
__ÅŒ
)

149 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

151 
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

153 
__END_NAMESPACE_STD


155 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__ex‹nsiÚ__
 
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
)

159 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$¡¹od
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

166 **
__»¡riù
 
__’d±r
)

167 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$¡¹of
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

174 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

176 
	$¡¹Şd
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
)

178 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$¡¹Ş
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

185 **
__»¡riù
 
__’d±r
, 
__ba£
)

186 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

188 
	$¡¹oul
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

189 **
__»¡riù
 
__’d±r
, 
__ba£
)

190 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

191 
__END_NAMESPACE_STD


193 #ià
defšed
 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_BSD


195 
__ex‹nsiÚ__


196 
	$¡¹oq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

197 **
__»¡riù
 
__’d±r
, 
__ba£
)

198 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

200 
__ex‹nsiÚ__


201 
	$¡¹ouq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

202 **
__»¡riù
 
__’d±r
, 
__ba£
)

203 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

206 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__ex‹nsiÚ__


210 
	$¡¹Şl
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
)

212 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

214 
__ex‹nsiÚ__


215 
	$¡¹ouÎ
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

216 **
__»¡riù
 
__’d±r
, 
__ba£
)

217 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

218 
__END_NAMESPACE_C99


222 #ifdeà
__USE_GNU


236 
	~<xloÿË.h
>

240 
	$¡¹Ş_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

241 **
__»¡riù
 
__’d±r
, 
__ba£
,

242 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

244 
	$¡¹oul_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

245 **
__»¡riù
 
__’d±r
,

246 
__ba£
, 
__loÿË_t
 
__loc
)

247 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

249 
__ex‹nsiÚ__


250 
	$¡¹Şl_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

251 **
__»¡riù
 
__’d±r
, 
__ba£
,

252 
__loÿË_t
 
__loc
)

253 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

255 
__ex‹nsiÚ__


256 
	$¡¹ouÎ_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

257 **
__»¡riù
 
__’d±r
,

258 
__ba£
, 
__loÿË_t
 
__loc
)

259 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

261 
	$¡¹od_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

262 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

263 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

265 
	$¡¹of_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

266 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

267 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

269 
	$¡¹Şd_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

270 **
__»¡riù
 
__’d±r
,

271 
__loÿË_t
 
__loc
)

272 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

276 #ifdeà
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__ex‹º_šlše
 

279 
	`__NTH
 (
	$©of
 (
__cÚ¡
 *
__ÅŒ
))

281  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

282 
	}
}

283 
__ex‹º_šlše
 

284 
__NTH
 (
	$©oi
 (
__cÚ¡
 *
__ÅŒ
))

286  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

287 
	}
}

288 
__ex‹º_šlše
 

289 
__NTH
 (
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
))

291  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

298 
__NTH
 (
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
))

300  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

314 
	$a64l
 (
__cÚ¡
 *
__s
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


320 
	~<sys/ty³s.h
>

327 
	$¿ndom
 (è
__THROW
;

330 
	$¤ªdom
 (
__£ed
è
__THROW
;

336 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

337 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

341 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

344 #ifdeà
__USE_MISC


349 
	s¿ndom_d©a


351 
št32_t
 *
åŒ
;

352 
št32_t
 *
½Œ
;

353 
št32_t
 *
¡©e
;

354 
¿nd_ty³
;

355 
¿nd_deg
;

356 
¿nd_£p
;

357 
št32_t
 *
’d_±r
;

360 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

361 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

363 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

364 
__THROW
 
	`__nÚnuÎ
 ((2));

366 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

367 
size_t
 
__¡©–’
,

368 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

369 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

371 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

372 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

373 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$¿nd
 (è
__THROW
;

382 
	$¤ªd
 (
__£ed
è
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifdeà
__USE_POSIX


387 
	$¿nd_r
 (*
__£ed
è
__THROW
;

391 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


395 
	$d¿nd48
 (è
__THROW
;

396 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

399 
	$Ìªd48
 (è
__THROW
;

400 
	$Äªd48
 (
__xsubi
[3])

401 
__THROW
 
	`__nÚnuÎ
 ((1));

404 
	$m¿nd48
 (è
__THROW
;

405 
	$j¿nd48
 (
__xsubi
[3])

406 
__THROW
 
	`__nÚnuÎ
 ((1));

409 
	$¤ªd48
 (
__£edv®
è
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__nÚnuÎ
 ((1));

412 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

414 #ifdeà
__USE_MISC


418 
	sd¿nd48_d©a


420 
__x
[3];

421 
__Şd_x
[3];

422 
__c
;

423 
__š™
;

424 
__a
;

428 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

429 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$”ªd48_r
 (
__xsubi
[3],

431 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

432 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

435 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

436 *
__»¡riù
 
__»suÉ
)

437 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

438 
	$Äªd48_r
 (
__xsubi
[3],

439 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

445 *
__»¡riù
 
__»suÉ
)

446 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

447 
	$j¿nd48_r
 (
__xsubi
[3],

448 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

449 *
__»¡riù
 
__»suÉ
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

454 
__THROW
 
	`__nÚnuÎ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$lcÚg48_r
 (
__·¿m
[7],

460 
d¿nd48_d©a
 *
__bufãr
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

467 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


468 
	#__m®loc_ªd_ÿÎoc_defšed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

473 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

474 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

488 
	$ä“
 (*
__±r
è
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$cä“
 (*
__±r
è
__THROW
;

496 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


497 
	~<®loÿ.h
>

500 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

501 || 
defšed
 
__USE_BSD


503 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

506 #ifdeà
__USE_XOPEN2K


508 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

509 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

518 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

520 #ifdeà
__USE_GNU


524 #ifdeà
__ılu¥lus


525 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

528 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

537 
__THROW
 
	`__nÚnuÎ
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

546 #ifdeà
__USE_GNU


552 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

554 
__END_NAMESPACE_STD


556 #ifdeà
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$g‘’v
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__£cu»_g‘’v
 (
__cÚ¡
 *
__Çme
)

573 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

575 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


579 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

582 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


585 
	$£‹nv
 (
__cÚ¡
 *
__Çme
, __cÚ¡ *
__v®ue
, 
__»¶aû
)

586 
__THROW
 
	`__nÚnuÎ
 ((2));

589 
	$un£‹nv
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

592 #ifdef 
__USE_MISC


596 
	$ş—»nv
 (è
__THROW
;

600 #ià
defšed
 
__USE_MISC
 \

601 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (
__cÚ¡
 *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (
__cÚ¡
 *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
è(
	t__cÚ¡
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
è(
	t__cÚ¡
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

761 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

762 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

763 #ifdeà
__USE_GNU


764 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

765 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

766 
	`__nÚnuÎ
 ((1, 4));

771 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

772 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

773 
__END_NAMESPACE_STD


775 #ifdeà
__USE_ISOC99


776 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

777 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__num”
, 
__d’om
)

786 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

788 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

789 
__END_NAMESPACE_STD


791 #ifdeà
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

794 
__d’om
)

795 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

796 
__END_NAMESPACE_C99


800 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

801 || 
defšed
 
__USE_SVID


808 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

809 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

814 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

815 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

820 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

821 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

824 #ifdeà
__USE_MISC


826 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

827 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

828 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

829 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

830 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

831 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

832 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

833 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

838 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

839 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

840 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

841 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

842 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

843 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

846 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

847 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

848 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbËn
 (
__cÚ¡
 *
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

863 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

864 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

867 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
 
__wur
;

871 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

872 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

874 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

875 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifdeà
__USE_SVID


885 
	$½m©ch
 (
__cÚ¡
 *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

889 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


896 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

897 *
__cÚ¡
 *
__»¡riù
 
__tok’s
,

898 **
__»¡riù
 
__v®u•
)

899 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

903 #ifdeà
__USE_XOPEN


905 
	$£tkey
 (
__cÚ¡
 *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

911 #ifdeà
__USE_XOPEN2KXSI


913 
	$posix_İ’±
 (
__oæag
è
__wur
;

916 #ifdeà
__USE_XOPEN


921 
	$g¿Á±
 (
__fd
è
__THROW
;

925 
	$uÆock±
 (
__fd
è
__THROW
;

930 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

933 #ifdeà
__USE_GNU


937 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

938 
__THROW
 
	`__nÚnuÎ
 ((2));

941 
	`g‘±
 ();

944 #ifdeà
__USE_BSD


948 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

949 
__THROW
 
	`__nÚnuÎ
 ((1));

954 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


955 
	~<b™s/¡dlib.h
>

957 #ifdeà
__LDBL_COMPAT


958 
	~<b™s/¡dlib-ldbl.h
>

962 #undeà
__Ãed_m®loc_ªd_ÿÎoc


964 
__END_DECLS


	@/usr/include/string.h

24 #iâdef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memıy
 (*
__»¡riù
 
__de¡
,

45 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

49 *
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


57 *
	$memcıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

68 
	$memcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

72 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 
__cÚ¡
 *
	`memchr
 (__cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

80 #ifdeà
__OPTIMIZE__


81 
__ex‹º_®ways_šlše
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


84  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

88 
	`memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


90  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifdeà
__USE_GNU


103 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 "C++" 
__cÚ¡
 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

109 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

110 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" 
__cÚ¡
 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

129 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

131 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

132 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

137 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

139 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

140 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
	$¡ºcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
	$¡rcŞl
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

153 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

154 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nÚnuÎ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifdeà
__USE_XOPEN2K8


162 
	~<xloÿË.h
>

165 
	$¡rcŞl_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

166 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

168 
size_t
 
	$¡rxäm_l
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

169 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

172 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

173 || 
defšed
 
__USE_XOPEN2K8


175 *
	$¡rdup
 (
__cÚ¡
 *
__s
)

176 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

182 #ià
defšed
 
__USE_XOPEN2K8


183 *
	$¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

184 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

187 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


189 
	#¡rdu·
(
s
) \

190 (
__ex‹nsiÚ__
 \

192 
__cÚ¡
 *
__Şd
 = (
s
); \

193 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

194 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

195 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

196 
	}
}))

	)

199 
	#¡ºdu·
(
s
, 
n
) \

200 (
__ex‹nsiÚ__
 \

202 
__cÚ¡
 *
__Şd
 = (
s
); \

203 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

204 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

205 
__Ãw
[
__Ën
] = '\0'; \

206 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
¡rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 
__cÚ¡
 *
¡rchr
 (__cÚ¡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

220 #ifdeà
__OPTIMIZE__


221 
__ex‹º_®ways_šlše
 *

222 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


224  
__butš_¡rchr
 (
__s
, 
__c
);

227 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

228 
¡rchr
 (
__cÚ¡
 *
__s
, 
__c
è
	g__THROW


230  
__butš_¡rchr
 (
__s
, 
__c
);

235 *
	$¡rchr
 (
__cÚ¡
 *
__s
, 
__c
)

236 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

239 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`¡¼chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 
__cÚ¡
 *
	`¡¼chr
 (__cÚ¡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__OPTIMIZE__


248 
__ex‹º_®ways_šlše
 *

249 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


251  
	`__butš_¡¼chr
 (
__s
, 
__c
);

254 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

255 
	`¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


257  
	`__butš_¡¼chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
)

263 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_GNU


270 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 "C++" 
__cÚ¡
 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

276 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$¡rc¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__»jeù
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 
size_t
 
	$¡r¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

289 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

291 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
)

295 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 
__cÚ¡
 *
	`¡½brk
 (__cÚ¡ *
__s
, __cÚ¡ *
__acû±
)

297 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

299 #ifdeà
__OPTIMIZE__


300 
__ex‹º_®ways_šlše
 *

301 
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
è
__THROW


303  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

306 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

307 
	`¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
è
__THROW


309  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

312 
	}
}

314 *
	$¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

318 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

322 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 
__cÚ¡
 *
	`¡r¡r
 (__cÚ¡ *
__hay¡ack
,

324 
__cÚ¡
 *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

335 
	`¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 
__cÚ¡
 *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" 
__cÚ¡
 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
,

370 
__cÚ¡
 *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (
__cÚ¡
 *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 
__cÚ¡
 *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (
__cÚ¡
 *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2));

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

482 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

510 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 #ifdeà
__GNUC__


530 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

531 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

536 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

548 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

551 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

552 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

553 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

560 
__cÚ¡
 *
__»¡riù
 
__d–im
)

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

569 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

577 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

580 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$¡rv”scmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

587 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

590 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

595 #iâdeà
ba£Çme


600 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£Çme
 (*
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

603 "C++" 
__cÚ¡
 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
)

604 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

606 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

612 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

613 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

614 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


634 
	~<b™s/¡ršg.h
>

637 
	~<b™s/¡ršg2.h
>

640 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


642 
	~<b™s/¡ršg3.h
>

646 
__END_DECLS


	@/usr/include/sys/types.h

23 #iâdef 
_SYS_TYPES_H


24 
	#_SYS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


30 
	~<b™s/ty³s.h
>

32 #ifdef 
__USE_BSD


33 #iâdeà
__u_ch¬_defšed


34 
__u_ch¬
 
	tu_ch¬
;

35 
__u_shÜt
 
	tu_shÜt
;

36 
__u_št
 
	tu_št
;

37 
__u_lÚg
 
	tu_lÚg
;

38 
__quad_t
 
	tquad_t
;

39 
__u_quad_t
 
	tu_quad_t
;

40 
__fsid_t
 
	tfsid_t
;

41 
	#__u_ch¬_defšed


	)

45 
__loff_t
 
	tloff_t
;

47 #iâdeà
__šo_t_defšed


48 #iâdeà
__USE_FILE_OFFSET64


49 
__šo_t
 
	tšo_t
;

51 
__šo64_t
 
	tšo_t
;

53 
	#__šo_t_defšed


	)

55 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


56 
__šo64_t
 
	tšo64_t
;

57 
	#__šo64_t_defšed


	)

60 #iâdeà
__dev_t_defšed


61 
__dev_t
 
	tdev_t
;

62 
	#__dev_t_defšed


	)

65 #iâdeà
__gid_t_defšed


66 
__gid_t
 
	tgid_t
;

67 
	#__gid_t_defšed


	)

70 #iâdeà
__mode_t_defšed


71 
__mode_t
 
	tmode_t
;

72 
	#__mode_t_defšed


	)

75 #iâdeà
__Æšk_t_defšed


76 
__Æšk_t
 
	tÆšk_t
;

77 
	#__Æšk_t_defšed


	)

80 #iâdeà
__uid_t_defšed


81 
__uid_t
 
	tuid_t
;

82 
	#__uid_t_defšed


	)

85 #iâdeà
__off_t_defšed


86 #iâdeà
__USE_FILE_OFFSET64


87 
__off_t
 
	toff_t
;

89 
__off64_t
 
	toff_t
;

91 
	#__off_t_defšed


	)

93 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


94 
__off64_t
 
	toff64_t
;

95 
	#__off64_t_defšed


	)

98 #iâdeà
__pid_t_defšed


99 
__pid_t
 
	tpid_t
;

100 
	#__pid_t_defšed


	)

103 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

104 && !
defšed
 
__id_t_defšed


105 
__id_t
 
	tid_t
;

106 
	#__id_t_defšed


	)

109 #iâdeà
__ssize_t_defšed


110 
__ssize_t
 
	tssize_t
;

111 
	#__ssize_t_defšed


	)

114 #ifdef 
__USE_BSD


115 #iâdeà
__daddr_t_defšed


116 
__daddr_t
 
	tdaddr_t
;

117 
__ÿddr_t
 
	tÿddr_t
;

118 
	#__daddr_t_defšed


	)

122 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


123 
__key_t
 
	tkey_t
;

124 
	#__key_t_defšed


	)

127 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


128 
	#__Ãed_şock_t


	)

130 
	#__Ãed_time_t


	)

131 
	#__Ãed_tim”_t


	)

132 
	#__Ãed_şockid_t


	)

133 
	~<time.h
>

135 #ifdeà
__USE_XOPEN


136 #iâdeà
__u£cÚds_t_defšed


137 
__u£cÚds_t
 
	tu£cÚds_t
;

138 
	#__u£cÚds_t_defšed


	)

140 #iâdeà
__su£cÚds_t_defšed


141 
__su£cÚds_t
 
	tsu£cÚds_t
;

142 
	#__su£cÚds_t_defšed


	)

146 
	#__Ãed_size_t


	)

147 
	~<¡ddef.h
>

149 #ifdeà
__USE_MISC


151 
	tulÚg
;

152 
	tushÜt
;

153 
	tušt
;

158 #ià!
__GNUC_PREREQ
 (2, 7)

161 #iâdeà
__št8_t_defšed


162 
	#__št8_t_defšed


	)

163 
	tšt8_t
;

164 
	tšt16_t
;

165 
	tšt32_t
;

166 #ià
__WORDSIZE
 == 64

167 
	tšt64_t
;

168 #–ià
__GLIBC_HAVE_LONG_LONG


169 
__ex‹nsiÚ__
 
	tšt64_t
;

174 
	tu_št8_t
;

175 
	tu_št16_t
;

176 
	tu_št32_t
;

177 #ià
__WORDSIZE
 == 64

178 
	tu_št64_t
;

179 #–ià
__GLIBC_HAVE_LONG_LONG


180 
__ex‹nsiÚ__
 
	tu_št64_t
;

183 
	t»gi¡”_t
;

188 
	#__štN_t
(
N
, 
MODE
) \

189 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

190 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

191 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

193 #iâdeà
	t__št8_t_defšed


194 
	t__št8_t_defšed


	)

195 
	t__štN_t
 (8, 
	t__QI__
);

196 
__štN_t
 (16, 
__HI__
);

197 
__štN_t
 (32, 
__SI__
);

198 
__štN_t
 (64, 
__DI__
);

201 
__u_štN_t
 (8, 
__QI__
);

202 
__u_štN_t
 (16, 
__HI__
);

203 
__u_štN_t
 (32, 
__SI__
);

204 
__u_štN_t
 (64, 
__DI__
);

206 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

212 
	#__BIT_TYPES_DEFINED__
 1

	)

215 #ifdef 
__USE_BSD


217 
	~<’dŸn.h
>

220 
	~<sys/£Ëù.h
>

223 
	~<sys/sysmaüos.h
>

227 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

228 && !
defšed
 
__blksize_t_defšed


229 
__blksize_t
 
	tblksize_t
;

230 
	#__blksize_t_defšed


	)

234 #iâdeà
__USE_FILE_OFFSET64


235 #iâdeà
__blkút_t_defšed


236 
__blkút_t
 
	tblkút_t
;

237 
	#__blkút_t_defšed


	)

239 #iâdeà
__fsblkút_t_defšed


240 
__fsblkút_t
 
	tfsblkút_t
;

241 
	#__fsblkút_t_defšed


	)

243 #iâdeà
__fsfút_t_defšed


244 
__fsfút_t
 
	tfsfút_t
;

245 
	#__fsfút_t_defšed


	)

248 #iâdeà
__blkút_t_defšed


249 
__blkút64_t
 
	tblkút_t
;

250 
	#__blkút_t_defšed


	)

252 #iâdeà
__fsblkút_t_defšed


253 
__fsblkút64_t
 
	tfsblkút_t
;

254 
	#__fsblkút_t_defšed


	)

256 #iâdeà
__fsfút_t_defšed


257 
__fsfút64_t
 
	tfsfút_t
;

258 
	#__fsfút_t_defšed


	)

262 #ifdeà
__USE_LARGEFILE64


263 
__blkút64_t
 
	tblkút64_t
;

264 
__fsblkút64_t
 
	tfsblkút64_t
;

265 
__fsfút64_t
 
	tfsfút64_t
;

270 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


271 
	~<b™s/±h»adty³s.h
>

274 
	g__END_DECLS


	@/usr/include/xen/elfnote.h

27 #iâdeà
__XEN_PUBLIC_ELFNOTE_H__


28 
	#__XEN_PUBLIC_ELFNOTE_H__


	)

44 
	#XEN_ELFNOTE_INFO
 0

	)

51 
	#XEN_ELFNOTE_ENTRY
 1

	)

58 
	#XEN_ELFNOTE_HYPERCALL_PAGE
 2

	)

66 
	#XEN_ELFNOTE_VIRT_BASE
 3

	)

78 
	#XEN_ELFNOTE_PADDR_OFFSET
 4

	)

85 
	#XEN_ELFNOTE_XEN_VERSION
 5

	)

92 
	#XEN_ELFNOTE_GUEST_OS
 6

	)

99 
	#XEN_ELFNOTE_GUEST_VERSION
 7

	)

106 
	#XEN_ELFNOTE_LOADER
 8

	)

122 
	#XEN_ELFNOTE_PAE_MODE
 9

	)

134 
	#XEN_ELFNOTE_FEATURES
 10

	)

142 
	#XEN_ELFNOTE_BSD_SYMTAB
 11

	)

151 
	#XEN_ELFNOTE_HV_START_LOW
 12

	)

157 
	#XEN_ELFNOTE_L1_MFN_VALID
 13

	)

162 
	#XEN_ELFNOTE_SUSPEND_CANCEL
 14

	)

173 
	#XEN_ELFNOTE_INIT_P2M
 15

	)

179 
	#XEN_ELFNOTE_MOD_START_PFN
 16

	)

184 
	#XEN_ELFNOTE_MAX
 
XEN_ELFNOTE_MOD_START_PFN


	)

193 
	#XEN_ELFNOTE_CRASH_INFO
 0x1000001

	)

203 
	#XEN_ELFNOTE_CRASH_REGS
 0x1000002

	)

213 
	#XEN_ELFNOTE_DUMPCORE_NONE
 0x2000000

	)

221 
	#XEN_ELFNOTE_DUMPCORE_HEADER
 0x2000001

	)

230 
	#XEN_ELFNOTE_DUMPCORE_XEN_VERSION
 0x2000002

	)

238 
	#XEN_ELFNOTE_DUMPCORE_FORMAT_VERSION
 0x2000003

	)

	@/usr/include/xen/kexec.h

27 #iâdeà
_XEN_PUBLIC_KEXEC_H


28 
	#_XEN_PUBLIC_KEXEC_H


	)

59 
	~"x’.h
"

61 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

62 
	#KEXEC_XEN_NO_PAGES
 17

	)

83 
	#KEXEC_TYPE_DEFAULT
 0

	)

84 
	#KEXEC_TYPE_CRASH
 1

	)

96 
	sx’_kexec_image
 {

97 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

98 
	m·ge_li¡
[
KEXEC_XEN_NO_PAGES
];

100 #ià
defšed
(
__Ÿ64__
)

101 
	m»boÙ_code_bufãr
;

103 
	mšdœeùiÚ_·ge
;

104 
	m¡¬t_add»ss
;

105 } 
	tx’_kexec_image_t
;

112 
	#KEXEC_CMD_kexec
 0

	)

113 
	sx’_kexec_exec
 {

114 
	mty³
;

115 } 
	tx’_kexec_exec_t
;

122 
	#KEXEC_CMD_kexec_lßd
 1

	)

123 
	#KEXEC_CMD_kexec_uÆßd
 2

	)

124 
	sx’_kexec_lßd
 {

125 
	mty³
;

126 
x’_kexec_image_t
 
	mimage
;

127 } 
	tx’_kexec_lßd_t
;

129 
	#KEXEC_RANGE_MA_CRASH
 0

	)

130 
	#KEXEC_RANGE_MA_XEN
 1

	)

131 
	#KEXEC_RANGE_MA_CPU
 2

	)

132 
	#KEXEC_RANGE_MA_XENHEAP
 3

	)

137 
	#KEXEC_RANGE_MA_BOOT_PARAM
 4

	)

139 
	#KEXEC_RANGE_MA_EFI_MEMMAP
 5

	)

141 
	#KEXEC_RANGE_MA_VMCOREINFO
 6

	)

150 
	#KEXEC_CMD_kexec_g‘_¿nge
 3

	)

151 
	sx’_kexec_¿nge
 {

152 
	m¿nge
;

153 
	mÄ
;

154 
	msize
;

155 
	m¡¬t
;

156 } 
	tx’_kexec_¿nge_t
;

	@/usr/include/xen/nmi.h

27 #iâdeà
__XEN_PUBLIC_NMI_H__


28 
	#__XEN_PUBLIC_NMI_H__


	)

30 
	~"x’.h
"

37 
	#_XEN_NMIREASON_io_”rÜ
 0

	)

38 
	#XEN_NMIREASON_io_”rÜ
 (1UL << 
_XEN_NMIREASON_io_”rÜ
)

	)

40 
	#_XEN_NMIREASON_·r™y_”rÜ
 1

	)

41 
	#XEN_NMIREASON_·r™y_”rÜ
 (1UL << 
_XEN_NMIREASON_·r™y_”rÜ
)

	)

43 
	#_XEN_NMIREASON_unknown
 2

	)

44 
	#XEN_NMIREASON_unknown
 (1UL << 
_XEN_NMIREASON_unknown
)

	)

56 
	#XENNMI_»gi¡”_ÿÎback
 0

	)

57 
	sx’nmi_ÿÎback
 {

58 
	mhªdËr_add»ss
;

59 
	m·d
;

61 
x’nmi_ÿÎback
 
	tx’nmi_ÿÎback_t
;

62 
DEFINE_XEN_GUEST_HANDLE
(
x’nmi_ÿÎback_t
);

68 
	#XENNMI_uÄegi¡”_ÿÎback
 1

	)

	@/usr/include/xen/sched.h

27 #iâdeà
__XEN_PUBLIC_SCHED_H__


28 
	#__XEN_PUBLIC_SCHED_H__


	)

30 
	~"ev’t_chªÃl.h
"

51 
	#SCHEDOP_y›ld
 0

	)

60 
	#SCHEDOP_block
 1

	)

66 
	#SCHEDOP_shutdown
 2

	)

67 
	ssched_shutdown
 {

68 
	m»asÚ
;

70 
sched_shutdown
 
	tsched_shutdown_t
;

71 
DEFINE_XEN_GUEST_HANDLE
(
sched_shutdown_t
);

78 
	#SCHEDOP_pŞl
 3

	)

79 
	ssched_pŞl
 {

80 
XEN_GUEST_HANDLE
(
evtchn_pÜt_t
è
	mpÜts
;

81 
	mÄ_pÜts
;

82 
ušt64_t
 
	mtimeout
;

84 
sched_pŞl
 
	tsched_pŞl_t
;

85 
DEFINE_XEN_GUEST_HANDLE
(
sched_pŞl_t
);

93 
	#SCHEDOP_»mÙe_shutdown
 4

	)

94 
	ssched_»mÙe_shutdown
 {

95 
domid_t
 
	mdomaš_id
;

96 
	m»asÚ
;

98 
sched_»mÙe_shutdown
 
	tsched_»mÙe_shutdown_t
;

99 
DEFINE_XEN_GUEST_HANDLE
(
sched_»mÙe_shutdown_t
);

106 
	#SCHEDOP_shutdown_code
 5

	)

116 
	#SCHEDOP_w©chdog
 6

	)

117 
	ssched_w©chdog
 {

118 
ušt32_t
 
	mid
;

119 
ušt32_t
 
	mtimeout
;

121 
sched_w©chdog
 
	tsched_w©chdog_t
;

122 
DEFINE_XEN_GUEST_HANDLE
(
sched_w©chdog_t
);

129 
	#SHUTDOWN_pow”off
 0

	)

130 
	#SHUTDOWN_»boÙ
 1

	)

131 
	#SHUTDOWN_su¥’d
 2

	)

132 
	#SHUTDOWN_üash
 3

	)

133 
	#SHUTDOWN_w©chdog
 4

	)

	@/usr/include/xen/tmem.h

27 #iâdeà
__XEN_PUBLIC_TMEM_H__


28 
	#__XEN_PUBLIC_TMEM_H__


	)

30 
	~"x’.h
"

33 
	#TMEM_SPEC_VERSION
 1

	)

36 
	#TMEM_CONTROL
 0

	)

37 
	#TMEM_NEW_POOL
 1

	)

38 
	#TMEM_DESTROY_POOL
 2

	)

39 
	#TMEM_NEW_PAGE
 3

	)

40 
	#TMEM_PUT_PAGE
 4

	)

41 
	#TMEM_GET_PAGE
 5

	)

42 
	#TMEM_FLUSH_PAGE
 6

	)

43 
	#TMEM_FLUSH_OBJECT
 7

	)

44 
	#TMEM_READ
 8

	)

45 
	#TMEM_WRITE
 9

	)

46 
	#TMEM_XCHG
 10

	)

49 
	#TMEM_AUTH
 101

	)

50 
	#TMEM_RESTORE_NEW
 102

	)

53 
	#TMEMC_THAW
 0

	)

54 
	#TMEMC_FREEZE
 1

	)

55 
	#TMEMC_FLUSH
 2

	)

56 
	#TMEMC_DESTROY
 3

	)

57 
	#TMEMC_LIST
 4

	)

58 
	#TMEMC_SET_WEIGHT
 5

	)

59 
	#TMEMC_SET_CAP
 6

	)

60 
	#TMEMC_SET_COMPRESS
 7

	)

61 
	#TMEMC_QUERY_FREEABLE_MB
 8

	)

62 
	#TMEMC_SAVE_BEGIN
 10

	)

63 
	#TMEMC_SAVE_GET_VERSION
 11

	)

64 
	#TMEMC_SAVE_GET_MAXPOOLS
 12

	)

65 
	#TMEMC_SAVE_GET_CLIENT_WEIGHT
 13

	)

66 
	#TMEMC_SAVE_GET_CLIENT_CAP
 14

	)

67 
	#TMEMC_SAVE_GET_CLIENT_FLAGS
 15

	)

68 
	#TMEMC_SAVE_GET_POOL_FLAGS
 16

	)

69 
	#TMEMC_SAVE_GET_POOL_NPAGES
 17

	)

70 
	#TMEMC_SAVE_GET_POOL_UUID
 18

	)

71 
	#TMEMC_SAVE_GET_NEXT_PAGE
 19

	)

72 
	#TMEMC_SAVE_GET_NEXT_INV
 20

	)

73 
	#TMEMC_SAVE_END
 21

	)

74 
	#TMEMC_RESTORE_BEGIN
 30

	)

75 
	#TMEMC_RESTORE_PUT_PAGE
 32

	)

76 
	#TMEMC_RESTORE_FLUSH_PAGE
 33

	)

79 
	#TMEM_POOL_PERSIST
 1

	)

80 
	#TMEM_POOL_SHARED
 2

	)

81 
	#TMEM_POOL_PRECOMPRESSED
 4

	)

82 
	#TMEM_POOL_PAGESIZE_SHIFT
 4

	)

83 
	#TMEM_POOL_PAGESIZE_MASK
 0xf

	)

84 
	#TMEM_POOL_VERSION_SHIFT
 24

	)

85 
	#TMEM_POOL_VERSION_MASK
 0xff

	)

86 
	#TMEM_POOL_RESERVED_BITS
 0x00ffff00

	)

89 
	#TMEM_CLIENT_COMPRESS
 1

	)

90 
	#TMEM_CLIENT_FROZEN
 2

	)

93 
	#EFROZEN
 1000

	)

94 
	#EEMPTY
 1001

	)

97 #iâdeà
__ASSEMBLY__


98 
x’_pâ_t
 
	ttmem_şi_mâ_t
;

99 
	$XEN_GUEST_HANDLE
(è
	ttmem_şi_va_t
;

100 
	stmem_İ
 {

101 
ušt32_t
 
cmd
;

102 
št32_t
 
poŞ_id
;

105 
ušt64_t
 
uuid
[2];

106 
ušt32_t
 
æags
;

107 
ušt32_t
 
¬g1
;

108 } 
ü—t
;

110 
ušt32_t
 
subİ
;

111 
ušt32_t
 
şi_id
;

112 
ušt32_t
 
¬g1
;

113 
ušt32_t
 
¬g2
;

114 
ušt64_t
 
oid
[3];

115 
tmem_şi_va_t
 
buf
;

116 } 
ù¾
;

119 
ušt64_t
 
oid
[3];

120 
ušt32_t
 
šdex
;

121 
ušt32_t
 
tmem_off£t
;

122 
ušt32_t
 
pâ_off£t
;

123 
ušt32_t
 
Ën
;

124 
tmem_şi_mâ_t
 
cmâ
;

125 } 
g’
;

126 } 
u
;

128 
tmem_İ
 
	ttmem_İ_t
;

129 
	`DEFINE_XEN_GUEST_HANDLE
(
tmem_İ_t
);

131 
	stmem_hªdË
 {

132 
ušt32_t
 
poŞ_id
;

133 
ušt32_t
 
šdex
;

134 
ušt64_t
 
oid
[3];

	@/usr/include/xen/trace.h

26 #iâdeà
__XEN_PUBLIC_TRACE_H__


27 
	#__XEN_PUBLIC_TRACE_H__


	)

29 
	#TRACE_EXTRA_MAX
 7

	)

30 
	#TRACE_EXTRA_SHIFT
 28

	)

33 
	#TRC_CLS_SHIFT
 16

	)

34 
	#TRC_GEN
 0x0001f000

	)

35 
	#TRC_SCHED
 0x0002f000

	)

36 
	#TRC_DOM0OP
 0x0004f000

	)

37 
	#TRC_HVM
 0x0008f000

	)

38 
	#TRC_MEM
 0x0010f000

	)

39 
	#TRC_PV
 0x0020f000

	)

40 
	#TRC_SHADOW
 0x0040f000

	)

41 
	#TRC_PM
 0x0080f000

	)

42 
	#TRC_GUEST
 0x0800f000

	)

43 
	#TRC_ALL
 0x0ffff000

	)

44 
	#TRC_HD_TO_EVENT
(
x
è((x)&0x0fffffff)

	)

45 
	#TRC_HD_CYCLE_FLAG
 (1UL<<31)

	)

46 
	#TRC_HD_INCLUDES_CYCLE_COUNT
(
x
èĞ!!Ğ(xè& 
TRC_HD_CYCLE_FLAG
 ) )

	)

47 
	#TRC_HD_EXTRA
(
x
è(((x)>>
TRACE_EXTRA_SHIFT
)&
TRACE_EXTRA_MAX
)

	)

50 
	#TRC_SUBCLS_SHIFT
 12

	)

53 
	#TRC_HVM_ENTRYEXIT
 0x00081000

	)

54 
	#TRC_HVM_HANDLER
 0x00082000

	)

56 
	#TRC_SCHED_MIN
 0x00021000

	)

57 
	#TRC_SCHED_CLASS
 0x00022000

	)

58 
	#TRC_SCHED_VERBOSE
 0x00028000

	)

61 
	#TRC_LOST_RECORDS
 (
TRC_GEN
 + 1)

	)

62 
	#TRC_TRACE_WRAP_BUFFER
 (
TRC_GEN
 + 2)

	)

63 
	#TRC_TRACE_CPU_CHANGE
 (
TRC_GEN
 + 3)

	)

64 
	#TRC_TRACE_IRQ
 (
TRC_GEN
 + 4)

	)

66 
	#TRC_SCHED_RUNSTATE_CHANGE
 (
TRC_SCHED_MIN
 + 1)

	)

67 
	#TRC_SCHED_CONTINUE_RUNNING
 (
TRC_SCHED_MIN
 + 2)

	)

68 
	#TRC_SCHED_DOM_ADD
 (
TRC_SCHED_VERBOSE
 + 1)

	)

69 
	#TRC_SCHED_DOM_REM
 (
TRC_SCHED_VERBOSE
 + 2)

	)

70 
	#TRC_SCHED_SLEEP
 (
TRC_SCHED_VERBOSE
 + 3)

	)

71 
	#TRC_SCHED_WAKE
 (
TRC_SCHED_VERBOSE
 + 4)

	)

72 
	#TRC_SCHED_YIELD
 (
TRC_SCHED_VERBOSE
 + 5)

	)

73 
	#TRC_SCHED_BLOCK
 (
TRC_SCHED_VERBOSE
 + 6)

	)

74 
	#TRC_SCHED_SHUTDOWN
 (
TRC_SCHED_VERBOSE
 + 7)

	)

75 
	#TRC_SCHED_CTL
 (
TRC_SCHED_VERBOSE
 + 8)

	)

76 
	#TRC_SCHED_ADJDOM
 (
TRC_SCHED_VERBOSE
 + 9)

	)

77 
	#TRC_SCHED_SWITCH
 (
TRC_SCHED_VERBOSE
 + 10)

	)

78 
	#TRC_SCHED_S_TIMER_FN
 (
TRC_SCHED_VERBOSE
 + 11)

	)

79 
	#TRC_SCHED_T_TIMER_FN
 (
TRC_SCHED_VERBOSE
 + 12)

	)

80 
	#TRC_SCHED_DOM_TIMER_FN
 (
TRC_SCHED_VERBOSE
 + 13)

	)

81 
	#TRC_SCHED_SWITCH_INFPREV
 (
TRC_SCHED_VERBOSE
 + 14)

	)

82 
	#TRC_SCHED_SWITCH_INFNEXT
 (
TRC_SCHED_VERBOSE
 + 15)

	)

83 
	#TRC_SCHED_SHUTDOWN_CODE
 (
TRC_SCHED_VERBOSE
 + 16)

	)

85 
	#TRC_MEM_PAGE_GRANT_MAP
 (
TRC_MEM
 + 1)

	)

86 
	#TRC_MEM_PAGE_GRANT_UNMAP
 (
TRC_MEM
 + 2)

	)

87 
	#TRC_MEM_PAGE_GRANT_TRANSFER
 (
TRC_MEM
 + 3)

	)

88 
	#TRC_MEM_SET_P2M_ENTRY
 (
TRC_MEM
 + 4)

	)

89 
	#TRC_MEM_DECREASE_RESERVATION
 (
TRC_MEM
 + 5)

	)

90 
	#TRC_MEM_POD_POPULATE
 (
TRC_MEM
 + 16)

	)

91 
	#TRC_MEM_POD_ZERO_RECLAIM
 (
TRC_MEM
 + 17)

	)

92 
	#TRC_MEM_POD_SUPERPAGE_SPLINTER
 (
TRC_MEM
 + 18)

	)

95 
	#TRC_PV_HYPERCALL
 (
TRC_PV
 + 1)

	)

96 
	#TRC_PV_TRAP
 (
TRC_PV
 + 3)

	)

97 
	#TRC_PV_PAGE_FAULT
 (
TRC_PV
 + 4)

	)

98 
	#TRC_PV_FORCED_INVALID_OP
 (
TRC_PV
 + 5)

	)

99 
	#TRC_PV_EMULATE_PRIVOP
 (
TRC_PV
 + 6)

	)

100 
	#TRC_PV_EMULATE_4GB
 (
TRC_PV
 + 7)

	)

101 
	#TRC_PV_MATH_STATE_RESTORE
 (
TRC_PV
 + 8)

	)

102 
	#TRC_PV_PAGING_FIXUP
 (
TRC_PV
 + 9)

	)

103 
	#TRC_PV_GDT_LDT_MAPPING_FAULT
 (
TRC_PV
 + 10)

	)

104 
	#TRC_PV_PTWR_EMULATION
 (
TRC_PV
 + 11)

	)

105 
	#TRC_PV_PTWR_EMULATION_PAE
 (
TRC_PV
 + 12)

	)

107 
	#TRC_64_FLAG
 (0x100)

	)

109 
	#TRC_SHADOW_NOT_SHADOW
 (
TRC_SHADOW
 + 1)

	)

110 
	#TRC_SHADOW_FAST_PROPAGATE
 (
TRC_SHADOW
 + 2)

	)

111 
	#TRC_SHADOW_FAST_MMIO
 (
TRC_SHADOW
 + 3)

	)

112 
	#TRC_SHADOW_FALSE_FAST_PATH
 (
TRC_SHADOW
 + 4)

	)

113 
	#TRC_SHADOW_MMIO
 (
TRC_SHADOW
 + 5)

	)

114 
	#TRC_SHADOW_FIXUP
 (
TRC_SHADOW
 + 6)

	)

115 
	#TRC_SHADOW_DOMF_DYING
 (
TRC_SHADOW
 + 7)

	)

116 
	#TRC_SHADOW_EMULATE
 (
TRC_SHADOW
 + 8)

	)

117 
	#TRC_SHADOW_EMULATE_UNSHADOW_USER
 (
TRC_SHADOW
 + 9)

	)

118 
	#TRC_SHADOW_EMULATE_UNSHADOW_EVTINJ
 (
TRC_SHADOW
 + 10)

	)

119 
	#TRC_SHADOW_EMULATE_UNSHADOW_UNHANDLED
 (
TRC_SHADOW
 + 11)

	)

120 
	#TRC_SHADOW_WRMAP_BF
 (
TRC_SHADOW
 + 12)

	)

121 
	#TRC_SHADOW_PREALLOC_UNPIN
 (
TRC_SHADOW
 + 13)

	)

122 
	#TRC_SHADOW_RESYNC_FULL
 (
TRC_SHADOW
 + 14)

	)

123 
	#TRC_SHADOW_RESYNC_ONLY
 (
TRC_SHADOW
 + 15)

	)

126 
	#TRC_HVM_VMENTRY
 (
TRC_HVM_ENTRYEXIT
 + 0x01)

	)

127 
	#TRC_HVM_VMEXIT
 (
TRC_HVM_ENTRYEXIT
 + 0x02)

	)

128 
	#TRC_HVM_VMEXIT64
 (
TRC_HVM_ENTRYEXIT
 + 
TRC_64_FLAG
 + 0x02)

	)

129 
	#TRC_HVM_PF_XEN
 (
TRC_HVM_HANDLER
 + 0x01)

	)

130 
	#TRC_HVM_PF_XEN64
 (
TRC_HVM_HANDLER
 + 
TRC_64_FLAG
 + 0x01)

	)

131 
	#TRC_HVM_PF_INJECT
 (
TRC_HVM_HANDLER
 + 0x02)

	)

132 
	#TRC_HVM_PF_INJECT64
 (
TRC_HVM_HANDLER
 + 
TRC_64_FLAG
 + 0x02)

	)

133 
	#TRC_HVM_INJ_EXC
 (
TRC_HVM_HANDLER
 + 0x03)

	)

134 
	#TRC_HVM_INJ_VIRQ
 (
TRC_HVM_HANDLER
 + 0x04)

	)

135 
	#TRC_HVM_REINJ_VIRQ
 (
TRC_HVM_HANDLER
 + 0x05)

	)

136 
	#TRC_HVM_IO_READ
 (
TRC_HVM_HANDLER
 + 0x06)

	)

137 
	#TRC_HVM_IO_WRITE
 (
TRC_HVM_HANDLER
 + 0x07)

	)

138 
	#TRC_HVM_CR_READ
 (
TRC_HVM_HANDLER
 + 0x08)

	)

139 
	#TRC_HVM_CR_READ64
 (
TRC_HVM_HANDLER
 + 
TRC_64_FLAG
 + 0x08)

	)

140 
	#TRC_HVM_CR_WRITE
 (
TRC_HVM_HANDLER
 + 0x09)

	)

141 
	#TRC_HVM_CR_WRITE64
 (
TRC_HVM_HANDLER
 + 
TRC_64_FLAG
 + 0x09)

	)

142 
	#TRC_HVM_DR_READ
 (
TRC_HVM_HANDLER
 + 0x0A)

	)

143 
	#TRC_HVM_DR_WRITE
 (
TRC_HVM_HANDLER
 + 0x0B)

	)

144 
	#TRC_HVM_MSR_READ
 (
TRC_HVM_HANDLER
 + 0x0C)

	)

145 
	#TRC_HVM_MSR_WRITE
 (
TRC_HVM_HANDLER
 + 0x0D)

	)

146 
	#TRC_HVM_CPUID
 (
TRC_HVM_HANDLER
 + 0x0E)

	)

147 
	#TRC_HVM_INTR
 (
TRC_HVM_HANDLER
 + 0x0F)

	)

148 
	#TRC_HVM_NMI
 (
TRC_HVM_HANDLER
 + 0x10)

	)

149 
	#TRC_HVM_SMI
 (
TRC_HVM_HANDLER
 + 0x11)

	)

150 
	#TRC_HVM_VMMCALL
 (
TRC_HVM_HANDLER
 + 0x12)

	)

151 
	#TRC_HVM_HLT
 (
TRC_HVM_HANDLER
 + 0x13)

	)

152 
	#TRC_HVM_INVLPG
 (
TRC_HVM_HANDLER
 + 0x14)

	)

153 
	#TRC_HVM_INVLPG64
 (
TRC_HVM_HANDLER
 + 
TRC_64_FLAG
 + 0x14)

	)

154 
	#TRC_HVM_MCE
 (
TRC_HVM_HANDLER
 + 0x15)

	)

155 
	#TRC_HVM_IOPORT_READ
 (
TRC_HVM_HANDLER
 + 0x16)

	)

156 
	#TRC_HVM_IOMEM_READ
 (
TRC_HVM_HANDLER
 + 0x17)

	)

157 
	#TRC_HVM_CLTS
 (
TRC_HVM_HANDLER
 + 0x18)

	)

158 
	#TRC_HVM_LMSW
 (
TRC_HVM_HANDLER
 + 0x19)

	)

159 
	#TRC_HVM_LMSW64
 (
TRC_HVM_HANDLER
 + 
TRC_64_FLAG
 + 0x19)

	)

160 
	#TRC_HVM_RDTSC
 (
TRC_HVM_HANDLER
 + 0x1a)

	)

161 
	#TRC_HVM_INTR_WINDOW
 (
TRC_HVM_HANDLER
 + 0x20)

	)

162 
	#TRC_HVM_NPF
 (
TRC_HVM_HANDLER
 + 0x21)

	)

164 
	#TRC_HVM_IOPORT_WRITE
 (
TRC_HVM_HANDLER
 + 0x216)

	)

165 
	#TRC_HVM_IOMEM_WRITE
 (
TRC_HVM_HANDLER
 + 0x217)

	)

168 
	#TRC_PM_FREQ
 0x00801000

	)

169 
	#TRC_PM_IDLE
 0x00802000

	)

172 
	#TRC_PM_FREQ_CHANGE
 (
TRC_PM_FREQ
 + 0x01)

	)

173 
	#TRC_PM_IDLE_ENTRY
 (
TRC_PM_IDLE
 + 0x01)

	)

174 
	#TRC_PM_IDLE_EXIT
 (
TRC_PM_IDLE
 + 0x02)

	)

177 
	st_»c
 {

178 
ušt32_t
 
	mev’t
:28;

179 
ušt32_t
 
	mexŒa_u32
:3;

180 
ušt32_t
 
	mcyşes_šşuded
:1;

183 
ušt32_t
 
	mcyşes_lo
, 
	mcyşes_hi
;

184 
ušt32_t
 
	mexŒa_u32
[7];

185 } 
	mcyşes
;

187 
ušt32_t
 
	mexŒa_u32
[7];

188 } 
	mnocyşes
;

189 } 
	mu
;

196 
	st_buf
 {

205 
ušt32_t
 
	mcÚs
;

206 
ušt32_t
 
	m´od
;

214 
	st_šfo
 {

215 
ušt16_t
 
	mtbuf_size
;

216 
ušt16_t
 
	mmâ_off£t
[];

	@/usr/include/xen/version.h

28 #iâdeà
__XEN_PUBLIC_VERSION_H__


29 
	#__XEN_PUBLIC_VERSION_H__


	)

34 
	#XENVER_v”siÚ
 0

	)

37 
	#XENVER_exŒav”siÚ
 1

	)

38 
	tx’_exŒav”siÚ_t
[16];

39 
	#XEN_EXTRAVERSION_LEN
 ((
x’_exŒav”siÚ_t
))

	)

42 
	#XENVER_compe_šfo
 2

	)

43 
	sx’_compe_šfo
 {

44 
	mcomp”
[64];

45 
	mcompe_by
[16];

46 
	mcompe_domaš
[32];

47 
	mcompe_d©e
[32];

49 
x’_compe_šfo
 
	tx’_compe_šfo_t
;

51 
	#XENVER_ÿ·b™›s
 3

	)

52 
	tx’_ÿ·b™›s_šfo_t
[1024];

53 
	#XEN_CAPABILITIES_INFO_LEN
 ((
x’_ÿ·b™›s_šfo_t
))

	)

55 
	#XENVER_chªge£t
 4

	)

56 
	tx’_chªge£t_šfo_t
[64];

57 
	#XEN_CHANGESET_INFO_LEN
 ((
x’_chªge£t_šfo_t
))

	)

59 
	#XENVER_¶©fÜm_·¿m‘”s
 5

	)

60 
	sx’_¶©fÜm_·¿m‘”s
 {

61 
	mvœt_¡¬t
;

63 
x’_¶©fÜm_·¿m‘”s
 
	tx’_¶©fÜm_·¿m‘”s_t
;

65 
	#XENVER_g‘_ã©u»s
 6

	)

66 
	sx’_ã©u»_šfo
 {

67 
	msubm­_idx
;

68 
ušt32_t
 
	msubm­
;

70 
x’_ã©u»_šfo
 
	tx’_ã©u»_šfo_t
;

73 
	~"ã©u»s.h
"

76 
	#XENVER_·gesize
 7

	)

79 
	#XENVER_gue¡_hªdË
 8

	)

81 
	#XENVER_commªdlše
 9

	)

82 
	tx’_commªdlše_t
[1024];

	@/usr/include/xen/xen.h

27 #iâdeà
__XEN_PUBLIC_XEN_H__


28 
	#__XEN_PUBLIC_XEN_H__


	)

30 
	~"x’-com·t.h
"

32 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

33 
	~"¬ch-x86/x’.h
"

34 #–ià
defšed
(
__Ÿ64__
)

35 
	~"¬ch-Ÿ64.h
"

40 #iâdeà
__ASSEMBLY__


42 
DEFINE_XEN_GUEST_HANDLE
();

43 
__DEFINE_XEN_GUEST_HANDLE
(
uch¬
, );

44 
DEFINE_XEN_GUEST_HANDLE
();

45 
__DEFINE_XEN_GUEST_HANDLE
(
ušt
, );

46 
DEFINE_XEN_GUEST_HANDLE
();

47 
__DEFINE_XEN_GUEST_HANDLE
(
ulÚg
, );

48 
DEFINE_XEN_GUEST_HANDLE
();

50 
DEFINE_XEN_GUEST_HANDLE
(
ušt64_t
);

51 
DEFINE_XEN_GUEST_HANDLE
(
x’_pâ_t
);

58 
	#__HYPERVISOR_£t_Œ­_bË
 0

	)

59 
	#__HYPERVISOR_mmu_upd©e
 1

	)

60 
	#__HYPERVISOR_£t_gdt
 2

	)

61 
	#__HYPERVISOR_¡ack_sw™ch
 3

	)

62 
	#__HYPERVISOR_£t_ÿÎbacks
 4

	)

63 
	#__HYPERVISOR_åu_sksw™ch
 5

	)

64 
	#__HYPERVISOR_sched_İ_com·t
 6

	)

65 
	#__HYPERVISOR_¶©fÜm_İ
 7

	)

66 
	#__HYPERVISOR_£t_debug»g
 8

	)

67 
	#__HYPERVISOR_g‘_debug»g
 9

	)

68 
	#__HYPERVISOR_upd©e_desütÜ
 10

	)

69 
	#__HYPERVISOR_memÜy_İ
 12

	)

70 
	#__HYPERVISOR_muÉiÿÎ
 13

	)

71 
	#__HYPERVISOR_upd©e_va_m­pšg
 14

	)

72 
	#__HYPERVISOR_£t_tim”_İ
 15

	)

73 
	#__HYPERVISOR_ev’t_chªÃl_İ_com·t
 16

	)

74 
	#__HYPERVISOR_x’_v”siÚ
 17

	)

75 
	#__HYPERVISOR_cÚsŞe_io
 18

	)

76 
	#__HYPERVISOR_physdev_İ_com·t
 19

	)

77 
	#__HYPERVISOR_g¿Á_bË_İ
 20

	)

78 
	#__HYPERVISOR_vm_assi¡
 21

	)

79 
	#__HYPERVISOR_upd©e_va_m­pšg_Ùh”domaš
 22

	)

80 
	#__HYPERVISOR_œ‘
 23

	)

81 
	#__HYPERVISOR_vıu_İ
 24

	)

82 
	#__HYPERVISOR_£t_£gm’t_ba£
 25

	)

83 
	#__HYPERVISOR_mmuext_İ
 26

	)

84 
	#__HYPERVISOR_xsm_İ
 27

	)

85 
	#__HYPERVISOR_nmi_İ
 28

	)

86 
	#__HYPERVISOR_sched_İ
 29

	)

87 
	#__HYPERVISOR_ÿÎback_İ
 30

	)

88 
	#__HYPERVISOR_x’İrof_İ
 31

	)

89 
	#__HYPERVISOR_ev’t_chªÃl_İ
 32

	)

90 
	#__HYPERVISOR_physdev_İ
 33

	)

91 
	#__HYPERVISOR_hvm_İ
 34

	)

92 
	#__HYPERVISOR_sysùl
 35

	)

93 
	#__HYPERVISOR_domùl
 36

	)

94 
	#__HYPERVISOR_kexec_İ
 37

	)

95 
	#__HYPERVISOR_tmem_İ
 38

	)

98 
	#__HYPERVISOR_¬ch_0
 48

	)

99 
	#__HYPERVISOR_¬ch_1
 49

	)

100 
	#__HYPERVISOR_¬ch_2
 50

	)

101 
	#__HYPERVISOR_¬ch_3
 51

	)

102 
	#__HYPERVISOR_¬ch_4
 52

	)

103 
	#__HYPERVISOR_¬ch_5
 53

	)

104 
	#__HYPERVISOR_¬ch_6
 54

	)

105 
	#__HYPERVISOR_¬ch_7
 55

	)

112 #ià
__XEN_INTERFACE_VERSION__
 < 0x00030101

113 #undeà
__HYPERVISOR_sched_İ


114 
	#__HYPERVISOR_sched_İ
 
__HYPERVISOR_sched_İ_com·t


	)

118 #ià
__XEN_INTERFACE_VERSION__
 < 0x00030202

119 #undeà
__HYPERVISOR_ev’t_chªÃl_İ


120 
	#__HYPERVISOR_ev’t_chªÃl_İ
 
__HYPERVISOR_ev’t_chªÃl_İ_com·t


	)

121 #undeà
__HYPERVISOR_physdev_İ


122 
	#__HYPERVISOR_physdev_İ
 
__HYPERVISOR_physdev_İ_com·t


	)

126 #ià
__XEN_INTERFACE_VERSION__
 < 0x00030204

127 
	#__HYPERVISOR_dom0_İ
 
__HYPERVISOR_¶©fÜm_İ


	)

140 
	#VIRQ_TIMER
 0

	)

141 
	#VIRQ_DEBUG
 1

	)

142 
	#VIRQ_CONSOLE
 2

	)

143 
	#VIRQ_DOM_EXC
 3

	)

144 
	#VIRQ_TBUF
 4

	)

145 
	#VIRQ_DEBUGGER
 6

	)

146 
	#VIRQ_XENOPROF
 7

	)

147 
	#VIRQ_CON_RING
 8

	)

148 
	#VIRQ_PCPU_STATE
 9

	)

149 
	#VIRQ_MEM_EVENT
 10

	)

152 
	#VIRQ_ARCH_0
 16

	)

153 
	#VIRQ_ARCH_1
 17

	)

154 
	#VIRQ_ARCH_2
 18

	)

155 
	#VIRQ_ARCH_3
 19

	)

156 
	#VIRQ_ARCH_4
 20

	)

157 
	#VIRQ_ARCH_5
 21

	)

158 
	#VIRQ_ARCH_6
 22

	)

159 
	#VIRQ_ARCH_7
 23

	)

161 
	#NR_VIRQS
 24

	)

199 
	#MMU_NORMAL_PT_UPDATE
 0

	)

200 
	#MMU_MACHPHYS_UPDATE
 1

	)

201 
	#MMU_PT_UPDATE_PRESERVE_AD
 2

	)

261 
	#MMUEXT_PIN_L1_TABLE
 0

	)

262 
	#MMUEXT_PIN_L2_TABLE
 1

	)

263 
	#MMUEXT_PIN_L3_TABLE
 2

	)

264 
	#MMUEXT_PIN_L4_TABLE
 3

	)

265 
	#MMUEXT_UNPIN_TABLE
 4

	)

266 
	#MMUEXT_NEW_BASEPTR
 5

	)

267 
	#MMUEXT_TLB_FLUSH_LOCAL
 6

	)

268 
	#MMUEXT_INVLPG_LOCAL
 7

	)

269 
	#MMUEXT_TLB_FLUSH_MULTI
 8

	)

270 
	#MMUEXT_INVLPG_MULTI
 9

	)

271 
	#MMUEXT_TLB_FLUSH_ALL
 10

	)

272 
	#MMUEXT_INVLPG_ALL
 11

	)

273 
	#MMUEXT_FLUSH_CACHE
 12

	)

274 
	#MMUEXT_SET_LDT
 13

	)

275 
	#MMUEXT_NEW_USER_BASEPTR
 15

	)

276 
	#MMUEXT_CLEAR_PAGE
 16

	)

277 
	#MMUEXT_COPY_PAGE
 17

	)

278 
	#MMUEXT_FLUSH_CACHE_GLOBAL
 18

	)

279 
	#MMUEXT_MARK_SUPER
 19

	)

280 
	#MMUEXT_UNMARK_SUPER
 20

	)

282 #iâdeà
__ASSEMBLY__


283 
	smmuext_İ
 {

284 
	mcmd
;

288 
x’_pâ_t
 
	mmâ
;

290 
	mlš—r_addr
;

291 } 
	m¬g1
;

294 
	mÄ_’ts
;

296 #ià
__XEN_INTERFACE_VERSION__
 >= 0x00030205

297 
XEN_GUEST_HANDLE
(
cÚ¡_void
è
	mvıumask
;

299 cÚ¡ *
	mvıumask
;

302 
x’_pâ_t
 
	m¤c_mâ
;

303 } 
	m¬g2
;

305 
mmuext_İ
 
	tmmuext_İ_t
;

306 
DEFINE_XEN_GUEST_HANDLE
(
mmuext_İ_t
);

312 
	#UVMF_NONE
 (0UL<<0è

	)

313 
	#UVMF_TLB_FLUSH
 (1UL<<0è

	)

314 
	#UVMF_INVLPG
 (2UL<<0è

	)

315 
	#UVMF_FLUSHTYPE_MASK
 (3UL<<0)

	)

316 
	#UVMF_MULTI
 (0UL<<2è

	)

317 
	#UVMF_LOCAL
 (0UL<<2è

	)

318 
	#UVMF_ALL
 (1UL<<2è

	)

323 
	#CONSOLEIO_wr™e
 0

	)

324 
	#CONSOLEIO_»ad
 1

	)

329 
	#VMASST_CMD_’abË
 0

	)

330 
	#VMASST_CMD_di§bË
 1

	)

333 
	#VMASST_TYPE_4gb_£gm’ts
 0

	)

336 
	#VMASST_TYPE_4gb_£gm’ts_nÙify
 1

	)

343 
	#VMASST_TYPE_wr™abË_·g‘abËs
 2

	)

346 
	#VMASST_TYPE_·e_ex‹nded_ü3
 3

	)

348 
	#MAX_VMASST_TYPE
 3

	)

350 #iâdeà
__ASSEMBLY__


352 
ušt16_t
 
	tdomid_t
;

355 
	#DOMID_FIRST_RESERVED
 (0x7FF0U)

	)

358 
	#DOMID_SELF
 (0x7FF0U)

	)

369 
	#DOMID_IO
 (0x7FF1U)

	)

377 
	#DOMID_XEN
 (0x7FF2U)

	)

381 
	#DOMID_COW
 (0x7FF3U)

	)

384 
	#DOMID_INVALID
 (0x7FF4U)

	)

387 
	#DOMID_IDLE
 (0x7FFFU)

	)

393 
	smmu_upd©e
 {

394 
ušt64_t
 
	m±r
;

395 
ušt64_t
 
	mv®
;

397 
mmu_upd©e
 
	tmmu_upd©e_t
;

398 
DEFINE_XEN_GUEST_HANDLE
(
mmu_upd©e_t
);

404 
	smuÉiÿÎ_’Œy
 {

405 
	mİ
, 
	m»suÉ
;

406 
	m¬gs
[6];

408 
muÉiÿÎ_’Œy
 
	tmuÉiÿÎ_’Œy_t
;

409 
DEFINE_XEN_GUEST_HANDLE
(
muÉiÿÎ_’Œy_t
);

415 
	#NR_EVENT_CHANNELS
 ((è* (è* 64)

	)

417 
	svıu_time_šfo
 {

427 
ušt32_t
 
	mv”siÚ
;

428 
ušt32_t
 
	m·d0
;

429 
ušt64_t
 
	mtsc_time¡amp
;

430 
ušt64_t
 
	msy¡em_time
;

438 
ušt32_t
 
	mtsc_to_sy¡em_mul
;

439 
št8_t
 
	mtsc_shiá
;

440 
št8_t
 
	m·d1
[3];

442 
vıu_time_šfo
 
	tvıu_time_šfo_t
;

444 
	svıu_šfo
 {

470 
ušt8_t
 
	mevtchn_upÿÎ_³ndšg
;

471 
ušt8_t
 
	mevtchn_upÿÎ_mask
;

472 
	mevtchn_³ndšg_£l
;

473 
¬ch_vıu_šfo
 
	m¬ch
;

474 
vıu_time_šfo
 
	mtime
;

476 #iâdeà
__XEN__


477 
vıu_šfo
 
	tvıu_šfo_t
;

488 
	ssh¬ed_šfo
 {

489 
vıu_šfo
 
	mvıu_šfo
[
XEN_LEGACY_MAX_VCPUS
];

522 
	mevtchn_³ndšg
[() * 8];

523 
	mevtchn_mask
[() * 8];

529 
ušt32_t
 
	mwc_v”siÚ
;

530 
ušt32_t
 
	mwc_£c
;

531 
ušt32_t
 
	mwc_n£c
;

533 
¬ch_sh¬ed_šfo
 
	m¬ch
;

536 #iâdeà
__XEN__


537 
sh¬ed_šfo
 
	tsh¬ed_šfo_t
;

564 
	#MAX_GUEST_CMDLINE
 1024

	)

565 
	s¡¬t_šfo
 {

567 
	mmagic
[32];

568 
	mÄ_·ges
;

569 
	msh¬ed_šfo
;

570 
ušt32_t
 
	mæags
;

571 
x’_pâ_t
 
	m¡Üe_mâ
;

572 
ušt32_t
 
	m¡Üe_evtchn
;

575 
x’_pâ_t
 
	mmâ
;

576 
ušt32_t
 
	mevtchn
;

577 } 
	mdomU
;

579 
ušt32_t
 
	mšfo_off
;

580 
ušt32_t
 
	mšfo_size
;

581 } 
	mdom0
;

582 } 
	mcÚsŞe
;

584 
	m±_ba£
;

585 
	mÄ_±_äames
;

586 
	mmâ_li¡
;

587 
	mmod_¡¬t
;

590 
	mmod_Ën
;

591 
št8_t
 
	mcmd_lše
[
MAX_GUEST_CMDLINE
];

593 
	mfœ¡_p2m_pâ
;

594 
	mÄ_p2m_äames
;

596 
¡¬t_šfo
 
	t¡¬t_šfo_t
;

599 #ià
__XEN_INTERFACE_VERSION__
 < 0x00030203

600 
	#cÚsŞe_mâ
 
cÚsŞe
.
domU
.
mâ


	)

601 
	#cÚsŞe_evtchn
 
cÚsŞe
.
domU
.
evtchn


	)

605 
	#SIF_PRIVILEGED
 (1<<0è

	)

606 
	#SIF_INITDOMAIN
 (1<<1è

	)

607 
	#SIF_MULTIBOOT_MOD
 (1<<2è

	)

608 
	#SIF_MOD_START_PFN
 (1<<3è

	)

609 
	#SIF_PM_MASK
 (0xFF<<8è

	)

625 
	sx’_muÉiboÙ_mod_li¡


628 
ušt32_t
 
	mmod_¡¬t
;

630 
ušt32_t
 
	mmod_’d
;

632 
ušt32_t
 
	mcmdlše
;

634 
ušt32_t
 
	m·d
;

637 
	sdom0_vga_cÚsŞe_šfo
 {

638 
ušt8_t
 
	mvideo_ty³
;

639 
	#XEN_VGATYPE_TEXT_MODE_3
 0x03

	)

640 
	#XEN_VGATYPE_VESA_LFB
 0x23

	)

645 
ušt16_t
 
	mfÚt_height
;

647 
ušt16_t
 
	mcursÜ_x
, 
	mcursÜ_y
;

649 
ušt16_t
 
	mrows
, 
	mcŞumns
;

650 } 
	m‹xt_mode_3
;

654 
ušt16_t
 
	mwidth
, 
	mheight
;

656 
ušt16_t
 
	mby‹s_³r_lše
;

658 
ušt16_t
 
	mb™s_³r_pix–
;

660 
ušt32_t
 
	mlfb_ba£
;

661 
ušt32_t
 
	mlfb_size
;

663 
ušt8_t
 
	m»d_pos
, 
	m»d_size
;

664 
ušt8_t
 
	mg»’_pos
, 
	mg»’_size
;

665 
ušt8_t
 
	mblue_pos
, 
	mblue_size
;

666 
ušt8_t
 
	mrsvd_pos
, 
	mrsvd_size
;

667 #ià
__XEN_INTERFACE_VERSION__
 >= 0x00030206

669 
ušt32_t
 
	mgbl_ÿps
;

671 
ušt16_t
 
	mmode_©Œs
;

673 } 
	mve§_lfb
;

674 } 
	mu
;

675 } 
	tdom0_vga_cÚsŞe_šfo_t
;

676 
	#x’_vga_cÚsŞe_šfo
 
dom0_vga_cÚsŞe_šfo


	)

677 
	#x’_vga_cÚsŞe_šfo_t
 
dom0_vga_cÚsŞe_šfo_t


	)

679 
ušt8_t
 
	tx’_domaš_hªdË_t
[16];

682 
	#__mk_unsigÃd_lÚg
(
x
èx ## 
UL


	)

683 
	#mk_unsigÃd_lÚg
(
x
è
	`__mk_unsigÃd_lÚg
(x)

	)

685 
__DEFINE_XEN_GUEST_HANDLE
(
ušt8
, 
ušt8_t
);

686 
__DEFINE_XEN_GUEST_HANDLE
(
ušt16
, 
ušt16_t
);

687 
__DEFINE_XEN_GUEST_HANDLE
(
ušt32
, 
ušt32_t
);

688 
__DEFINE_XEN_GUEST_HANDLE
(
ušt64
, 
ušt64_t
);

693 
	#mk_unsigÃd_lÚg
(
x
è
	)
x

698 #ià
defšed
(
__XEN__
è|| defšed(
__XEN_TOOLS__
)

700 #iâdeà
ušt64_®igÃd_t


701 
	#ušt64_®igÃd_t
 
ušt64_t


	)

703 #iâdeà
XEN_GUEST_HANDLE_64


704 
	#XEN_GUEST_HANDLE_64
(
Çme
è
	`XEN_GUEST_HANDLE
Òame)

	)

707 #iâdeà
__ASSEMBLY__


708 
	sx’ùl_ıum­
 {

709 
XEN_GUEST_HANDLE_64
(
ušt8
è
	mb™m­
;

710 
ušt32_t
 
	mÄ_ıus
;

	@/usr/include/xen/xencomm.h

23 #iâdeà
_XEN_XENCOMM_H_


24 
	#_XEN_XENCOMM_H_


	)

32 
	#XENCOMM_MAGIC
 0x58434F4D

	)

33 
	#XENCOMM_INVALID
 (~0UL)

	)

35 
	sx’comm_desc
 {

36 
ušt32_t
 
	mmagic
;

37 
ušt32_t
 
	mÄ_addrs
;

38 
ušt64_t
 
	madd»ss
[0];

	@/usr/include/xenctrl.h

26 #iâdeà
XENCTRL_H


27 
	#XENCTRL_H


	)

30 #iâdeà
__XEN_TOOLS__


31 
	#__XEN_TOOLS__
 1

	)

34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<¡dio.h
>

37 
	~<x’/x’.h
>

38 
	~<x’/domùl.h
>

39 
	~<x’/physdev.h
>

40 
	~<x’/sysùl.h
>

41 
	~<x’/v”siÚ.h
>

42 
	~<x’/ev’t_chªÃl.h
>

43 
	~<x’/sched.h
>

44 
	~<x’/memÜy.h
>

45 
	~<x’/g¿Á_bË.h
>

46 
	~<x’/hvm/·¿ms.h
>

47 
	~<x’/xsm/acm.h
>

48 
	~<x’/xsm/acm_İs.h
>

49 
	~<x’/xsm/æask_İ.h
>

50 
	~<x’/tmem.h
>

52 
	~"x’toŞlog.h
"

54 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

55 
	~<x’/fÜeign/x86_32.h
>

56 
	~<x’/fÜeign/x86_64.h
>

57 
	~<x’/¬ch-x86/x’-mÿ.h
>

60 #ifdeà
__Ÿ64__


61 
	#XC_PAGE_SHIFT
 14

	)

63 
	#XC_PAGE_SHIFT
 12

	)

65 
	#XC_PAGE_SIZE
 (1UL << 
XC_PAGE_SHIFT
)

	)

66 
	#XC_PAGE_MASK
 (~(
XC_PAGE_SIZE
-1))

	)

68 
	#INVALID_MFN
 (~0UL)

	)

74 #ià
defšed
(
__i386__
)

75 
	#x’_mb
(è
asm
 vŞ©Ğ"lock;‡ddÈ$0,0(%%e¥)" : : : "memÜy" )

	)

76 
	#x’_rmb
(è
asm
 vŞ©Ğ"lock;‡ddÈ$0,0(%%e¥)" : : : "memÜy" )

	)

77 
	#x’_wmb
(è
asm
 vŞ©Ğ"" : : : "memÜy")

	)

78 #–ià
defšed
(
__x86_64__
)

79 
	#x’_mb
(è
asm
 vŞ©Ğ"mãnû" : : : "memÜy")

	)

80 
	#x’_rmb
(è
asm
 vŞ©Ğ"lãnû" : : : "memÜy")

	)

81 
	#x’_wmb
(è
asm
 vŞ©Ğ"" : : : "memÜy")

	)

82 #–ià
defšed
(
__Ÿ64__
)

83 
	#x’_mb
(è
asm
 vŞ©("mf" ::: "memÜy")

	)

84 
	#x’_rmb
(è
asm
 vŞ©("mf" ::: "memÜy")

	)

85 
	#x’_wmb
(è
asm
 vŞ©("mf" ::: "memÜy")

	)

91 
	#XENCTRL_HAS_XC_INTERFACE
 1

	)

117 
xc_š‹rçû_cÜe
 
	txc_š‹rçû
;

118 
xc_š‹rçû_cÜe
 
	txc_evtchn
;

119 
xc_š‹rçû_cÜe
 
	txc_gÁb
;

120 
xc_”rÜ_code
 
	txc_”rÜ_code
;

140 
xc_š‹rçû
 *
xc_š‹rçû_İ’
(
x’toŞlog_logg”
 *
logg”
,

141 
x’toŞlog_logg”
 *
dombud_logg”
,

142 
İ’_æags
);

155 
	exc_İ’_æags
 {

156 
	mXC_OPENFLAG_DUMMY
 = 1<<0,

157 
	mXC_OPENFLAG_NON_REENTRANT
 = 1<<1,

170 
xc_š‹rçû_şo£
(
xc_š‹rçû
 *
xch
);

179 
xc_š‹rçû_is_çke
();

206 
	sxc_hy³rÿÎ_bufãr
 {

208 *
	mhbuf
;

214 
xc_hy³rÿÎ_bufãr
 *
	m·¿m_shadow
;

219 
	mdœ
;

222 *
	mubuf
;

223 
size_t
 
	msz
;

225 
xc_hy³rÿÎ_bufãr
 
	txc_hy³rÿÎ_bufãr_t
;

231 
	#XC__HYPERCALL_BUFFER_NAME
(
_Çme
è
xc__hy³rÿÎ_bufãr_
##
	)
_name

236 
	#HYPERCALL_BUFFER
(
_Çme
) \

237 ({ 
xc_hy³rÿÎ_bufãr_t
 
_v®1
; \

238 
	`ty³of
(
	`XC__HYPERCALL_BUFFER_NAME
(
_Çme
)è*
_v®2
 = &XC__HYPERCALL_BUFFER_NAME(_name); \

239 ()(&
_v®1
 =ğ
_v®2
); \

240 (
_v®2
)->
·¿m_shadow
 ? (_val2)->param_shadow : (_val2); \

241 })

	)

243 
	#HYPERCALL_BUFFER_INIT_NO_BOUNCE
 .
dœ
 = 0, .
sz
 = 0, .
ubuf
 = (*)-1

	)

251 
	#DECLARE_HYPERCALL_BUFFER
(
_ty³
, 
_Çme
) \

252 
_ty³
 *
_Çme
 = 
NULL
; \

253 
xc_hy³rÿÎ_bufãr_t
 
	`XC__HYPERCALL_BUFFER_NAME
(
_Çme
) = { \

254 .
hbuf
 = 
NULL
, \

255 .
·¿m_shadow
 = 
NULL
, \

256 
HYPERCALL_BUFFER_INIT_NO_BOUNCE
 \

257 }

	)

263 
	#DECLARE_HYPERCALL_BUFFER_ARGUMENT
(
_Çme
) \

264 
xc_hy³rÿÎ_bufãr_t
 
	`XC__HYPERCALL_BUFFER_NAME
(
_Çme
) = { \

265 .
hbuf
 = (*)-1, \

266 .
·¿m_shadow
 = 
_Çme
, \

267 
HYPERCALL_BUFFER_INIT_NO_BOUNCE
 \

268 }

	)

274 
	#HYPERCALL_BUFFER_AS_ARG
(
_Çme
) \

275 ({ 
xc_hy³rÿÎ_bufãr_t
 
_v®1
; \

276 
	`ty³of
(
	`XC__HYPERCALL_BUFFER_NAME
(
_Çme
)è*
_v®2
 = 
	`HYPERCALL_BUFFER
(_name); \

277 ()(&
_v®1
 =ğ
_v®2
); \

278 ()(
_v®2
)->
hbuf
; \

279 })

	)

285 #undeà
£t_x’_gue¡_hªdË


286 
	#£t_x’_gue¡_hªdË
(
_hnd
, 
_v®
) \

288 
xc_hy³rÿÎ_bufãr_t
 
_v®1
; \

289 
	`ty³of
(
	`XC__HYPERCALL_BUFFER_NAME
(
_v®
)è*
_v®2
 = 
	`HYPERCALL_BUFFER
(_val); \

290 (è(&
_v®1
 =ğ
_v®2
); \

291 
	`£t_x’_gue¡_hªdË_¿w
(
_hnd
, (
_v®2
)->
hbuf
); \

292 } 0)

	)

295 
xc_hy³rÿÎ_bufãr_t
 
XC__HYPERCALL_BUFFER_NAME
(
HYPERCALL_BUFFER_NULL
);

300 *
xc__hy³rÿÎ_bufãr_®loc
(
xc_š‹rçû
 *
xch
, 
xc_hy³rÿÎ_bufãr_t
 *
b
, 
size_t
 
size
);

301 
	#xc_hy³rÿÎ_bufãr_®loc
(
_xch
, 
_Çme
, 
_size
è
	`xc__hy³rÿÎ_bufãr_®loc
(_xch, 
	`HYPERCALL_BUFFER
(_Çme), _size)

	)

302 
xc__hy³rÿÎ_bufãr_ä“
(
xc_š‹rçû
 *
xch
, 
xc_hy³rÿÎ_bufãr_t
 *
b
);

303 
	#xc_hy³rÿÎ_bufãr_ä“
(
_xch
, 
_Çme
è
	`xc__hy³rÿÎ_bufãr_ä“
(_xch, 
	`HYPERCALL_BUFFER
(_Çme))

	)

308 *
xc__hy³rÿÎ_bufãr_®loc_·ges
(
xc_š‹rçû
 *
xch
, 
xc_hy³rÿÎ_bufãr_t
 *
b
, 
Ä_·ges
);

309 
	#xc_hy³rÿÎ_bufãr_®loc_·ges
(
_xch
, 
_Çme
, 
_Ä
è
	`xc__hy³rÿÎ_bufãr_®loc_·ges
(_xch, 
	`HYPERCALL_BUFFER
(_Çme), _Ä)

	)

310 
xc__hy³rÿÎ_bufãr_ä“_·ges
(
xc_š‹rçû
 *
xch
, 
xc_hy³rÿÎ_bufãr_t
 *
b
, 
Ä_·ges
);

311 
	#xc_hy³rÿÎ_bufãr_ä“_·ges
(
_xch
, 
_Çme
, 
_Ä
è
	`xc__hy³rÿÎ_bufãr_ä“_·ges
(_xch, 
	`HYPERCALL_BUFFER
(_Çme), _Ä)

	)

316 
ušt8_t
 *
	txc_ıum­_t
;

319 
xc_g‘_max_ıus
(
xc_š‹rçû
 *
xch
);

322 
xc_g‘_ıum­_size
(
xc_š‹rçû
 *
xch
);

325 
xc_ıum­_t
 
xc_ıum­_®loc
(
xc_š‹rçû
 *
xch
);

331 
	sxc_cÜe_h—d”
 {

332 
	mxch_magic
;

333 
	mxch_Ä_vıus
;

334 
	mxch_Ä_·ges
;

335 
	mxch_ùxt_off£t
;

336 
	mxch_šdex_off£t
;

337 
	mxch_·ges_off£t
;

338 } 
	txc_cÜe_h—d”_t
;

340 
	#XC_CORE_MAGIC
 0xF00FEBED

	)

341 
	#XC_CORE_MAGIC_HVM
 0xF00FEBEE

	)

347 
	sxc_domšfo
 {

348 
ušt32_t
 
	mdomid
;

349 
ušt32_t
 
	mssid»f
;

350 
	mdyšg
:1, 
	müashed
:1, 
	mshutdown
:1,

351 
	m·u£d
:1, 
	mblocked
:1, 
	mruÂšg
:1,

352 
	mhvm
:1, 
	mdebugged
:1;

353 
	mshutdown_»asÚ
;

354 
	mÄ_·ges
;

355 
	mÄ_sh¬ed_·ges
;

356 
	msh¬ed_šfo_äame
;

357 
ušt64_t
 
	mıu_time
;

358 
	mmax_memkb
;

359 
	mÄ_Úlše_vıus
;

360 
	mmax_vıu_id
;

361 
x’_domaš_hªdË_t
 
	mhªdË
;

362 
	mıupoŞ
;

363 } 
	txc_domšfo_t
;

365 
x’_domùl_g‘domaššfo_t
 
	txc_domaššfo_t
;

369 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

370 
vıu_gue¡_cÚ‹xt_x86_64_t
 
	mx64
;

371 
vıu_gue¡_cÚ‹xt_x86_32_t
 
	mx32
;

373 
vıu_gue¡_cÚ‹xt_t
 
	mc
;

374 } 
	tvıu_gue¡_cÚ‹xt_ªy_t
;

378 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

379 
sh¬ed_šfo_x86_64_t
 
	mx64
;

380 
sh¬ed_šfo_x86_32_t
 
	mx32
;

382 
sh¬ed_šfo_t
 
	ms
;

383 } 
	tsh¬ed_šfo_ªy_t
;

387 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

388 
¡¬t_šfo_x86_64_t
 
	mx64
;

389 
¡¬t_šfo_x86_32_t
 
	mx32
;

391 
¡¬t_šfo_t
 
	ms
;

392 } 
	t¡¬t_šfo_ªy_t
;

395 
xc_domaš_ü—‹
(
xc_š‹rçû
 *
xch
,

396 
ušt32_t
 
ssid»f
,

397 
x’_domaš_hªdË_t
 
hªdË
,

398 
ušt32_t
 
æags
,

399 
ušt32_t
 *
pdomid
);

407 
xc_domaš_dumpcÜe
(
xc_š‹rçû
 *
xch
,

408 
ušt32_t
 
domid
,

409 cÚ¡ *
cÜ’ame
);

417 (
	tdumpcÜe_¹n_t
)(
	txc_š‹rçû
 *
	txch
,

418 *
	t¬g
, *
	tbufãr
, 
	tËngth
);

420 
	`xc_domaš_dumpcÜe_vŸ_ÿÎback
(
xc_š‹rçû
 *
xch
,

421 
ušt32_t
 
domid
,

422 *
¬g
,

423 
dumpcÜe_¹n_t
 
dump_¹n
);

433 
	`xc_domaš_max_vıus
(
xc_š‹rçû
 *
xch
,

434 
ušt32_t
 
domid
,

435 
max
);

445 
	`xc_domaš_·u£
(
xc_š‹rçû
 *
xch
,

446 
ušt32_t
 
domid
);

455 
	`xc_domaš_uÅau£
(
xc_š‹rçû
 *
xch
,

456 
ušt32_t
 
domid
);

467 
	`xc_domaš_de¡roy
(
xc_š‹rçû
 *
xch
,

468 
ušt32_t
 
domid
);

480 
	`xc_domaš_»sume
(
xc_š‹rçû
 *
xch
,

481 
ušt32_t
 
domid
,

482 
ç¡
);

495 
	`xc_domaš_shutdown
(
xc_š‹rçû
 *
xch
,

496 
ušt32_t
 
domid
,

497 
»asÚ
);

499 
	`xc_w©chdog
(
xc_š‹rçû
 *
xch
,

500 
ušt32_t
 
id
,

501 
ušt32_t
 
timeout
);

503 
	`xc_vıu_£ffš™y
(
xc_š‹rçû
 *
xch
,

504 
ušt32_t
 
domid
,

505 
vıu
,

506 
xc_ıum­_t
 
ıum­
);

507 
	`xc_vıu_g‘affš™y
(
xc_š‹rçû
 *
xch
,

508 
ušt32_t
 
domid
,

509 
vıu
,

510 
xc_ıum­_t
 
ıum­
);

527 
	`xc_domaš_g‘šfo
(
xc_š‹rçû
 *
xch
,

528 
ušt32_t
 
fœ¡_domid
,

529 
max_doms
,

530 
xc_domšfo_t
 *
šfo
);

542 
	`xc_vıu_£tcÚ‹xt
(
xc_š‹rçû
 *
xch
,

543 
ušt32_t
 
domid
,

544 
ušt32_t
 
vıu
,

545 
vıu_gue¡_cÚ‹xt_ªy_t
 *
ùxt
);

559 
	`xc_domaš_g‘šfŞi¡
(
xc_š‹rçû
 *
xch
,

560 
ušt32_t
 
fœ¡_domaš
,

561 
max_domašs
,

562 
xc_domaššfo_t
 *
šfo
);

573 
	`xc_domaš_hvm_g‘cÚ‹xt
(
xc_š‹rçû
 *
xch
,

574 
ušt32_t
 
domid
,

575 
ušt8_t
 *
ùxt_buf
,

576 
ušt32_t
 
size
);

590 
	`xc_domaš_hvm_g‘cÚ‹xt_·¹Ÿl
(
xc_š‹rçû
 *
xch
,

591 
ušt32_t
 
domid
,

592 
ušt16_t
 
ty³code
,

593 
ušt16_t
 
š¡ªû
,

594 *
ùxt_buf
,

595 
ušt32_t
 
size
);

606 
	`xc_domaš_hvm_£tcÚ‹xt
(
xc_š‹rçû
 *
xch
,

607 
ušt32_t
 
domid
,

608 
ušt8_t
 *
hvm_ùxt
,

609 
ušt32_t
 
size
);

622 
	`xc_vıu_g‘cÚ‹xt
(
xc_š‹rçû
 *
xch
,

623 
ušt32_t
 
domid
,

624 
ušt32_t
 
vıu
,

625 
vıu_gue¡_cÚ‹xt_ªy_t
 *
ùxt
);

627 
x’_domùl_g‘vıušfo_t
 
	txc_vıušfo_t
;

628 
	`xc_vıu_g‘šfo
(
xc_š‹rçû
 *
xch
,

629 
ušt32_t
 
domid
,

630 
ušt32_t
 
vıu
,

631 
xc_vıušfo_t
 *
šfo
);

633 
	`xc_domaš_g‘_ıu_u§ge
(
xc_š‹rçû
 *
xch
,

634 
domid_t
 
domid
,

635 
vıu
);

637 
	`xc_domaš_£thªdË
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
,

638 
x’_domaš_hªdË_t
 
hªdË
);

640 
x’_domùl_shadow_İ_¡©s_t
 
	txc_shadow_İ_¡©s_t
;

641 
	`xc_shadow_cÚŒŞ
(
xc_š‹rçû
 *
xch
,

642 
ušt32_t
 
domid
,

643 
sİ
,

644 
xc_hy³rÿÎ_bufãr_t
 *
dœty_b™m­
,

645 
·ges
,

646 *
mb
,

647 
ušt32_t
 
mode
,

648 
xc_shadow_İ_¡©s_t
 *
¡©s
);

650 
	`xc_£df_domaš_£t
(
xc_š‹rçû
 *
xch
,

651 
ušt32_t
 
domid
,

652 
ušt64_t
 
³riod
, ušt64_ˆ
¦iû
,

653 
ušt64_t
 
Ï‹ncy
, 
ušt16_t
 
exŒ©ime
,

654 
ušt16_t
 
weight
);

656 
	`xc_£df_domaš_g‘
(
xc_š‹rçû
 *
xch
,

657 
ušt32_t
 
domid
,

658 
ušt64_t
* 
³riod
, ušt64_ˆ*
¦iû
,

659 
ušt64_t
 *
Ï‹ncy
, 
ušt16_t
 *
exŒ©ime
,

660 
ušt16_t
 *
weight
);

662 
	`xc_sched_üed™_domaš_£t
(
xc_š‹rçû
 *
xch
,

663 
ušt32_t
 
domid
,

664 
x’_domùl_sched_üed™
 *
sdom
);

666 
	`xc_sched_üed™_domaš_g‘
(
xc_š‹rçû
 *
xch
,

667 
ušt32_t
 
domid
,

668 
x’_domùl_sched_üed™
 *
sdom
);

670 
	`xc_sched_üed™2_domaš_£t
(
xc_š‹rçû
 *
xch
,

671 
ušt32_t
 
domid
,

672 
x’_domùl_sched_üed™2
 *
sdom
);

674 
	`xc_sched_üed™2_domaš_g‘
(
xc_š‹rçû
 *
xch
,

675 
ušt32_t
 
domid
,

676 
x’_domùl_sched_üed™2
 *
sdom
);

679 
	`xc_sched_¬šc653_scheduË_£t
(

680 
xc_š‹rçû
 *
xch
,

681 
x’_sysùl_¬šc653_scheduË
 *
scheduË
);

684 
	`xc_sched_¬šc653_scheduË_g‘
(

685 
xc_š‹rçû
 *
xch
,

686 
x’_sysùl_¬šc653_scheduË
 *
scheduË
);

697 
	`xc_domaš_£nd_Œigg”
(
xc_š‹rçû
 *
xch
,

698 
ušt32_t
 
domid
,

699 
ušt32_t
 
Œigg”
,

700 
ušt32_t
 
vıu
);

710 
	`xc_domaš_£tdebuggšg
(
xc_š‹rçû
 *
xch
,

711 
ušt32_t
 
domid
,

712 
’abË
);

723 
	`xc_domaš_£t_acûss_»quœed
(
xc_š‹rçû
 *
xch
,

724 
ušt32_t
 
domid
,

725 
»quœed
);

731 
	sxc_ıupoŞšfo
 {

732 
ušt32_t
 
ıupoŞ_id
;

733 
ušt32_t
 
sched_id
;

734 
ušt32_t
 
n_dom
;

735 
xc_ıum­_t
 
ıum­
;

736 } 
	txc_ıupoŞšfo_t
;

746 
	`xc_ıupoŞ_ü—‹
(
xc_š‹rçû
 *
xch
,

747 
ušt32_t
 *
µoŞid
,

748 
ušt32_t
 
sched_id
);

757 
	`xc_ıupoŞ_de¡roy
(
xc_š‹rçû
 *
xch
,

758 
ušt32_t
 
poŞid
);

767 
xc_ıupoŞšfo_t
 *
	`xc_ıupoŞ_g‘šfo
(
xc_š‹rçû
 *
xch
,

768 
ušt32_t
 
poŞid
);

775 
	`xc_ıupoŞ_šfoä“
(
xc_š‹rçû
 *
xch
,

776 
xc_ıupoŞšfo_t
 *
šfo
);

786 
	`xc_ıupoŞ_addıu
(
xc_š‹rçû
 *
xch
,

787 
ušt32_t
 
poŞid
,

788 
ıu
);

798 
	`xc_ıupoŞ_»moveıu
(
xc_š‹rçû
 *
xch
,

799 
ušt32_t
 
poŞid
,

800 
ıu
);

810 
	`xc_ıupoŞ_movedomaš
(
xc_š‹rçû
 *
xch
,

811 
ušt32_t
 
poŞid
,

812 
ušt32_t
 
domid
);

820 
xc_ıum­_t
 
	`xc_ıupoŞ_ä“šfo
(
xc_š‹rçû
 *
xch
);

830 
	tevtchn_pÜt_Ü_”rÜ_t
;

846 
evtchn_pÜt_Ü_”rÜ_t


847 
	`xc_evtchn_®loc_unbound
(
xc_š‹rçû
 *
xch
,

848 
ušt32_t
 
dom
,

849 
ušt32_t
 
»mÙe_dom
);

851 
	`xc_evtchn_»£t
(
xc_š‹rçû
 *
xch
,

852 
ušt32_t
 
dom
);

854 
evtchn_¡©us
 
	txc_evtchn_¡©us_t
;

855 
	`xc_evtchn_¡©us
(
xc_š‹rçû
 *
xch
, 
xc_evtchn_¡©us_t
 *
¡©us
);

863 
xc_evtchn
 *
	`xc_evtchn_İ’
(
x’toŞlog_logg”
 *
logg”
,

864 
İ’_æags
);

869 
	`xc_evtchn_şo£
(
xc_evtchn
 *
xû
);

874 
	`xc_evtchn_fd
(
xc_evtchn
 *
xû
);

880 
	`xc_evtchn_nÙify
(
xc_evtchn
 *
xû
, 
evtchn_pÜt_t
 
pÜt
);

886 
evtchn_pÜt_Ü_”rÜ_t


887 
	`xc_evtchn_bšd_unbound_pÜt
(
xc_evtchn
 *
xû
, 
domid
);

893 
evtchn_pÜt_Ü_”rÜ_t


894 
	`xc_evtchn_bšd_š‹rdomaš
(
xc_evtchn
 *
xû
, 
domid
,

895 
evtchn_pÜt_t
 
»mÙe_pÜt
);

901 
evtchn_pÜt_Ü_”rÜ_t


902 
	`xc_evtchn_bšd_vœq
(
xc_evtchn
 *
xû
, 
vœq
);

908 
	`xc_evtchn_unbšd
(
xc_evtchn
 *
xû
, 
evtchn_pÜt_t
 
pÜt
);

914 
evtchn_pÜt_Ü_”rÜ_t


915 
	`xc_evtchn_³ndšg
(
xc_evtchn
 *
xû
);

921 
	`xc_evtchn_unmask
(
xc_evtchn
 *
xû
, 
evtchn_pÜt_t
 
pÜt
);

923 
	`xc_physdev_pci_acûss_modify
(
xc_š‹rçû
 *
xch
,

924 
ušt32_t
 
domid
,

925 
bus
,

926 
dev
,

927 
func
,

928 
’abË
);

930 
	`xc_»adcÚsŞ”šg
(
xc_š‹rçû
 *
xch
,

931 *
bufãr
,

932 *
²r_ch¬s
,

933 
ş—r
, 
šüem’l
, 
ušt32_t
 *
pšdex
);

935 
	`xc_£nd_debug_keys
(
xc_š‹rçû
 *
xch
, *
keys
);

937 
x’_sysùl_physšfo_t
 
	txc_physšfo_t
;

938 
x’_sysùl_tİŞogyšfo_t
 
	txc_tİŞogyšfo_t
;

939 
x’_sysùl_numašfo_t
 
	txc_numašfo_t
;

941 
ušt32_t
 
	txc_ıu_to_node_t
;

942 
ušt32_t
 
	txc_ıu_to_sock‘_t
;

943 
ušt32_t
 
	txc_ıu_to_cÜe_t
;

944 
ušt64_t
 
	txc_node_to_memsize_t
;

945 
ušt64_t
 
	txc_node_to_memä“_t
;

946 
ušt32_t
 
	txc_node_to_node_di¡_t
;

948 
	`xc_physšfo
(
xc_š‹rçû
 *
xch
, 
xc_physšfo_t
 *
šfo
);

949 
	`xc_tİŞogyšfo
(
xc_š‹rçû
 *
xch
, 
xc_tİŞogyšfo_t
 *
šfo
);

950 
	`xc_numašfo
(
xc_š‹rçû
 *
xch
, 
xc_numašfo_t
 *
šfo
);

952 
	`xc_sched_id
(
xc_š‹rçû
 *
xch
,

953 *
sched_id
);

955 
	`xc_machphys_mâ_li¡
(
xc_š‹rçû
 *
xch
,

956 
max_ex‹Ás
,

957 
x’_pâ_t
 *
ex‹Á_¡¬t
);

959 
x’_sysùl_ıušfo_t
 
	txc_ıušfo_t
;

960 
	`xc_g‘ıušfo
(
xc_š‹rçû
 *
xch
, 
max_ıus
,

961 
xc_ıušfo_t
 *
šfo
, *
Ä_ıus
);

963 
	`xc_domaš_£tmaxmem
(
xc_š‹rçû
 *
xch
,

964 
ušt32_t
 
domid
,

965 
max_memkb
);

967 
	`xc_domaš_£t_memm­_lim™
(
xc_š‹rçû
 *
xch
,

968 
ušt32_t
 
domid
,

969 
m­_lim™kb
);

971 
	`xc_domaš_£t_time_off£t
(
xc_š‹rçû
 *
xch
,

972 
ušt32_t
 
domid
,

973 
št32_t
 
time_off£t_£cÚds
);

975 
	`xc_domaš_£t_tsc_šfo
(
xc_š‹rçû
 *
xch
,

976 
ušt32_t
 
domid
,

977 
ušt32_t
 
tsc_mode
,

978 
ušt64_t
 
–­£d_n£c
,

979 
ušt32_t
 
gtsc_khz
,

980 
ušt32_t
 
šÿº©iÚ
);

982 
	`xc_domaš_g‘_tsc_šfo
(
xc_š‹rçû
 *
xch
,

983 
ušt32_t
 
domid
,

984 
ušt32_t
 *
tsc_mode
,

985 
ušt64_t
 *
–­£d_n£c
,

986 
ušt32_t
 *
gtsc_khz
,

987 
ušt32_t
 *
šÿº©iÚ
);

989 
	`xc_domaš_di§bË_mig¿‹
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
);

991 
	`xc_domaš_maximum_gpâ
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domid
);

993 
	`xc_domaš_šü—£_»£rv©iÚ
(
xc_š‹rçû
 *
xch
,

994 
ušt32_t
 
domid
,

995 
Ä_ex‹Ás
,

996 
ex‹Á_Üd”
,

997 
mem_æags
,

998 
x’_pâ_t
 *
ex‹Á_¡¬t
);

1000 
	`xc_domaš_šü—£_»£rv©iÚ_exaù
(
xc_š‹rçû
 *
xch
,

1001 
ušt32_t
 
domid
,

1002 
Ä_ex‹Ás
,

1003 
ex‹Á_Üd”
,

1004 
mem_æags
,

1005 
x’_pâ_t
 *
ex‹Á_¡¬t
);

1007 
	`xc_domaš_deü—£_»£rv©iÚ
(
xc_š‹rçû
 *
xch
,

1008 
ušt32_t
 
domid
,

1009 
Ä_ex‹Ás
,

1010 
ex‹Á_Üd”
,

1011 
x’_pâ_t
 *
ex‹Á_¡¬t
);

1013 
	`xc_domaš_deü—£_»£rv©iÚ_exaù
(
xc_š‹rçû
 *
xch
,

1014 
ušt32_t
 
domid
,

1015 
Ä_ex‹Ás
,

1016 
ex‹Á_Üd”
,

1017 
x’_pâ_t
 *
ex‹Á_¡¬t
);

1019 
	`xc_domaš_add_to_physm­
(
xc_š‹rçû
 *
xch
,

1020 
ušt32_t
 
domid
,

1021 
¥aû
,

1022 
idx
,

1023 
x’_pâ_t
 
gpâ
);

1025 
	`xc_domaš_pİuÏ‹_physm­
(
xc_š‹rçû
 *
xch
,

1026 
ušt32_t
 
domid
,

1027 
Ä_ex‹Ás
,

1028 
ex‹Á_Üd”
,

1029 
mem_æags
,

1030 
x’_pâ_t
 *
ex‹Á_¡¬t
);

1032 
	`xc_domaš_pİuÏ‹_physm­_exaù
(
xc_š‹rçû
 *
xch
,

1033 
ušt32_t
 
domid
,

1034 
Ä_ex‹Ás
,

1035 
ex‹Á_Üd”
,

1036 
mem_æags
,

1037 
x’_pâ_t
 *
ex‹Á_¡¬t
);

1039 
	`xc_domaš_memÜy_exchªge_·ges
(
xc_š‹rçû
 *
xch
,

1040 
domid
,

1041 
Ä_š_ex‹Ás
,

1042 
š_Üd”
,

1043 
x’_pâ_t
 *
š_ex‹Ás
,

1044 
Ä_out_ex‹Ás
,

1045 
out_Üd”
,

1046 
x’_pâ_t
 *
out_ex‹Ás
);

1048 
	`xc_domaš_£t_pod_rg‘
(
xc_š‹rçû
 *
xch
,

1049 
ušt32_t
 
domid
,

1050 
ušt64_t
 
rg‘_·ges
,

1051 
ušt64_t
 *
tÙ_·ges
,

1052 
ušt64_t
 *
pod_ÿche_·ges
,

1053 
ušt64_t
 *
pod_’Œ›s
);

1055 
	`xc_domaš_g‘_pod_rg‘
(
xc_š‹rçû
 *
xch
,

1056 
ušt32_t
 
domid
,

1057 
ušt64_t
 *
tÙ_·ges
,

1058 
ušt64_t
 *
pod_ÿche_·ges
,

1059 
ušt64_t
 *
pod_’Œ›s
);

1061 
	`xc_domaš_iİÜt_³rmissiÚ
(
xc_š‹rçû
 *
xch
,

1062 
ušt32_t
 
domid
,

1063 
ušt32_t
 
fœ¡_pÜt
,

1064 
ušt32_t
 
Ä_pÜts
,

1065 
ušt32_t
 
®low_acûss
);

1067 
	`xc_domaš_œq_³rmissiÚ
(
xc_š‹rçû
 *
xch
,

1068 
ušt32_t
 
domid
,

1069 
ušt8_t
 
pœq
,

1070 
ušt8_t
 
®low_acûss
);

1072 
	`xc_domaš_iomem_³rmissiÚ
(
xc_š‹rçû
 *
xch
,

1073 
ušt32_t
 
domid
,

1074 
fœ¡_mâ
,

1075 
Ä_mâs
,

1076 
ušt8_t
 
®low_acûss
);

1078 
	`xc_domaš_pš_memÜy_ÿch—‰r
(
xc_š‹rçû
 *
xch
,

1079 
ušt32_t
 
domid
,

1080 
ušt64_t
 
¡¬t
,

1081 
ušt64_t
 
’d
,

1082 
ušt32_t
 
ty³
);

1084 
	`xc_make_·ge_b–ow_4G
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
,

1085 
mâ
);

1087 
x’_sysùl_³rfc_desc_t
 
	txc_³rfc_desc_t
;

1088 
x’_sysùl_³rfc_v®_t
 
	txc_³rfc_v®_t
;

1089 
	`xc_³rfc_»£t
(
xc_š‹rçû
 *
xch
);

1090 
	`xc_³rfc_qu”y_numb”
(
xc_š‹rçû
 *
xch
,

1091 *
nbr_desc
,

1092 *
nbr_v®
);

1093 
	`xc_³rfc_qu”y
(
xc_š‹rçû
 *
xch
,

1094 
xc_hy³rÿÎ_bufãr_t
 *
desc
,

1095 
xc_hy³rÿÎ_bufãr_t
 *
v®
);

1097 
x’_sysùl_lock´of_d©a_t
 
	txc_lock´of_d©a_t
;

1098 
	`xc_lock´of_»£t
(
xc_š‹rçû
 *
xch
);

1099 
	`xc_lock´of_qu”y_numb”
(
xc_š‹rçû
 *
xch
,

1100 
ušt32_t
 *
n_–ems
);

1101 
	`xc_lock´of_qu”y
(
xc_š‹rçû
 *
xch
,

1102 
ušt32_t
 *
n_–ems
,

1103 
ušt64_t
 *
time
,

1104 
xc_hy³rÿÎ_bufãr_t
 *
d©a
);

1121 *
	`xc_m­_fÜeign_¿nge
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
dom
,

1122 
size
, 
´Ù
,

1123 
mâ
 );

1125 *
	`xc_m­_fÜeign_·ges
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
dom
, 
´Ù
,

1126 cÚ¡ 
x’_pâ_t
 *
¬r
, 
num
 );

1135 *
	`xc_m­_fÜeign_b©ch
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
dom
, 
´Ù
,

1136 
x’_pâ_t
 *
¬r
, 
num
 );

1143 *
	`xc_m­_fÜeign_bulk
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
dom
, 
´Ù
,

1144 cÚ¡ 
x’_pâ_t
 *
¬r
, *
”r
, 
num
);

1156 
	`xc_Œª¦©e_fÜeign_add»ss
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
dom
,

1157 
vıu
, 
vœt
);

1164 
	`xc_g‘_pâ_li¡
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
, 
ušt64_t
 *
pâ_buf
,

1165 
max_pâs
);

1167 
	`xc_Ÿ64_å¤_deçuÉ
();

1169 
	`xc_cİy_to_domaš_·ge
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
,

1170 
d¡_pâ
, cÚ¡ *
¤c_·ge
);

1172 
	`xc_ş—r_domaš_·ge
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
,

1173 
d¡_pâ
);

1175 
	`xc_mmuext_İ
(
xc_š‹rçû
 *
xch
, 
mmuext_İ
 *
İ
, 
Ä_İs
,

1176 
domid_t
 
dom
);

1179 
	`xc_maximum_¿m_·ge
(
xc_š‹rçû
 *
xch
);

1182 
	`xc_g‘_tÙ_·ges
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
domid
);

1196 
	`xc_avah—p
(
xc_š‹rçû
 *
xch
, 
mš_width
, 
max_width
, 
node
,

1197 
ušt64_t
 *
by‹s
);

1214 
	`xc_tbuf_’abË
(
xc_š‹rçû
 *
xch
, 
·ges
,

1215 *
mâ
, *
size
);

1220 
	`xc_tbuf_di§bË
(
xc_š‹rçû
 *
xch
);

1232 
	`xc_tbuf_£t_size
(
xc_š‹rçû
 *
xch
, 
size
);

1242 
	`xc_tbuf_g‘_size
(
xc_š‹rçû
 *
xch
, *
size
);

1244 
	`xc_tbuf_£t_ıu_mask
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
mask
);

1246 
	`xc_tbuf_£t_evt_mask
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
mask
);

1248 
	`xc_domùl
(
xc_š‹rçû
 *
xch
, 
x’_domùl
 *
domùl
);

1249 
	`xc_sysùl
(
xc_š‹rçû
 *
xch
, 
x’_sysùl
 *
sysùl
);

1251 
	`xc_v”siÚ
(
xc_š‹rçû
 *
xch
, 
cmd
, *
¬g
);

1253 
	`xc_acm_İ
(
xc_š‹rçû
 *
xch
, 
cmd
, *
¬g
, 
¬g_size
);

1255 
	`xc_æask_İ
(
xc_š‹rçû
 *
xch
, 
æask_İ_t
 *
İ
);

1261 
	`xc_domaš_subsüibe_fÜ_su¥’d
(

1262 
xc_š‹rçû
 *
xch
, 
domid_t
 
domid
, 
evtchn_pÜt_t
 
pÜt
);

1275 
xc_gÁb
 *
	`xc_gÁb_İ’
(
x’toŞlog_logg”
 *
logg”
,

1276 
İ’_æags
);

1282 
	`xc_gÁb_şo£
(
xc_gÁb
 *
xcg
);

1293 *
	`xc_gÁb_m­_g¿Á_»f
(
xc_gÁb
 *
xcg
,

1294 
ušt32_t
 
domid
,

1295 
ušt32_t
 
»f
,

1296 
´Ù
);

1310 *
	`xc_gÁb_m­_g¿Á_»fs
(
xc_gÁb
 *
xcg
,

1311 
ušt32_t
 
couÁ
,

1312 
ušt32_t
 *
domids
,

1313 
ušt32_t
 *
»fs
,

1314 
´Ù
);

1327 *
	`xc_gÁb_m­_domaš_g¿Á_»fs
(
xc_gÁb
 *
xcg
,

1328 
ušt32_t
 
couÁ
,

1329 
ušt32_t
 
domid
,

1330 
ušt32_t
 *
»fs
,

1331 
´Ù
);

1337 
	`xc_gÁb_munm­
(
xc_gÁb
 *
xcg
,

1338 *
¡¬t_add»ss
,

1339 
ušt32_t
 
couÁ
);

1352 
	`xc_gÁb_£t_max_g¿Ás
(
xc_gÁb
 *
xcg
,

1353 
ušt32_t
 
couÁ
);

1355 
	`xc_gÁb_İ
(
xc_š‹rçû
 *
xch
, 
cmd
,

1356 * 
İ
, 
İ_size
, 
couÁ
);

1359 
	`xc_gÁb_g‘_v”siÚ
(
xc_š‹rçû
 *
xch
, 
domid
);

1360 
g¿Á_’Œy_v1_t
 *
	`xc_gÁb_m­_bË_v1
(
xc_š‹rçû
 *
xch
, 
domid
, *
gÁ_num
);

1361 
g¿Á_’Œy_v2_t
 *
	`xc_gÁb_m­_bË_v2
(
xc_š‹rçû
 *
xch
, 
domid
, *
gÁ_num
);

1364 
	`xc_physdev_m­_pœq
(
xc_š‹rçû
 *
xch
,

1365 
domid
,

1366 
šdex
,

1367 *
pœq
);

1369 
	`xc_physdev_m­_pœq_msi
(
xc_š‹rçû
 *
xch
,

1370 
domid
,

1371 
šdex
,

1372 *
pœq
,

1373 
devâ
,

1374 
bus
,

1375 
’Œy_Ä
,

1376 
ušt64_t
 
bË_ba£
);

1378 
	`xc_physdev_unm­_pœq
(
xc_š‹rçû
 *
xch
,

1379 
domid
,

1380 
pœq
);

1382 
	`xc_hvm_£t_pci_štx_Ëv–
(

1383 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
,

1384 
ušt8_t
 
domaš
, ušt8_ˆ
bus
, ušt8_ˆ
deviû
, ušt8_ˆ
štx
,

1385 
Ëv–
);

1386 
	`xc_hvm_£t_i§_œq_Ëv–
(

1387 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
,

1388 
ušt8_t
 
i§_œq
,

1389 
Ëv–
);

1391 
	`xc_hvm_£t_pci_lšk_rou‹
(

1392 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
, 
ušt8_t
 
lšk
, ušt8_ˆ
i§_œq
);

1406 
	`xc_hvm_Œack_dœty_v¿m
(

1407 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
,

1408 
ušt64_t
 
fœ¡_pâ
, ušt64_ˆ
Ä
,

1409 *
b™m­
);

1414 
	`xc_hvm_modif›d_memÜy
(

1415 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
, 
ušt64_t
 
fœ¡_pâ
, ušt64_ˆ
Ä
);

1421 
	`xc_hvm_£t_mem_ty³
(

1422 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
, 
hvmmem_ty³_t
 
memty³
, 
ušt64_t
 
fœ¡_pâ
, ušt64_ˆ
Ä
);

1429 
	`xc_hvm_£t_mem_acûss
(

1430 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
, 
hvmmem_acûss_t
 
memacûss
, 
ušt64_t
 
fœ¡_pâ
, ušt64_ˆ
Ä
);

1435 
	`xc_hvm_g‘_mem_acûss
(

1436 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
, 
ušt64_t
 
pâ
, 
hvmmem_acûss_t
* 
memacûss
);

1442 
	`xc_hvm_šjeù_Œ­
(

1443 
xc_š‹rçû
 *
xch
, 
domid_t
 
dom
, 
vıu
, 
ušt32_t
 
Œ­
, ušt32_ˆ
”rÜ_code
,

1444 
ušt64_t
 
ü2
);

1451 
	exc_”rÜ_code
 {

1452 
XC_ERROR_NONE
 = 0,

1453 
XC_INTERNAL_ERROR
 = 1,

1454 
XC_INVALID_KERNEL
 = 2,

1455 
XC_INVALID_PARAM
 = 3,

1456 
XC_OUT_OF_MEMORY
 = 4,

1460 
	#XC_MAX_ERROR_MSG_LEN
 1024

	)

1461 
	sxc_”rÜ
 {

1462 
xc_”rÜ_code
 
code
;

1463 
mes§ge
[
XC_MAX_ERROR_MSG_LEN
];

1464 } 
	txc_”rÜ
;

1472 cÚ¡ *
	`xc_”rÜ_code_to_desc
(
code
);

1477 cÚ¡ *
	`xc_¡»¼Ü
(
xc_š‹rçû
 *
xch
, 
”rcode
);

1485 cÚ¡ 
xc_”rÜ
 *
	`xc_g‘_Ï¡_”rÜ
(
xc_š‹rçû
 *
hªdË
);

1490 
	`xc_ş—r_Ï¡_”rÜ
(
xc_š‹rçû
 *
xch
);

1493 
	`xc_£t_hvm_·¿m
(
xc_š‹rçû
 *
hªdË
, 
domid_t
 
dom
, 
·¿m
, 
v®ue
);

1494 
	`xc_g‘_hvm_·¿m
(
xc_š‹rçû
 *
hªdË
, 
domid_t
 
dom
, 
·¿m
, *
v®ue
);

1497 
	`xc_Ÿ64_§ve_to_nv¿m
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
dom
);

1500 
	`xc_Ÿ64_nv¿m_š™
(
xc_š‹rçû
 *
xch
, *
dom_Çme
, 
ušt32_t
 
dom
);

1503 
	`xc_Ÿ64_£t_os_ty³
(
xc_š‹rçû
 *
xch
, *
gue¡_os_ty³
, 
ušt32_t
 
dom
);

1506 
	`xc_assign_deviû
(
xc_š‹rçû
 *
xch
,

1507 
ušt32_t
 
domid
,

1508 
ušt32_t
 
machše_bdf
);

1510 
	`xc_g‘_deviû_group
(
xc_š‹rçû
 *
xch
,

1511 
ušt32_t
 
domid
,

1512 
ušt32_t
 
machše_bdf
,

1513 
ušt32_t
 
max_sdevs
,

1514 
ušt32_t
 *
num_sdevs
,

1515 
ušt32_t
 *
sdev_¬¿y
);

1517 
	`xc_‹¡_assign_deviû
(
xc_š‹rçû
 *
xch
,

1518 
ušt32_t
 
domid
,

1519 
ušt32_t
 
machše_bdf
);

1521 
	`xc_d—ssign_deviû
(
xc_š‹rçû
 *
xch
,

1522 
ušt32_t
 
domid
,

1523 
ušt32_t
 
machše_bdf
);

1525 
	`xc_domaš_memÜy_m­pšg
(
xc_š‹rçû
 *
xch
,

1526 
ušt32_t
 
domid
,

1527 
fœ¡_gâ
,

1528 
fœ¡_mâ
,

1529 
Ä_mâs
,

1530 
ušt32_t
 
add_m­pšg
);

1532 
	`xc_domaš_iİÜt_m­pšg
(
xc_š‹rçû
 *
xch
,

1533 
ušt32_t
 
domid
,

1534 
ušt32_t
 
fœ¡_gpÜt
,

1535 
ušt32_t
 
fœ¡_mpÜt
,

1536 
ušt32_t
 
Ä_pÜts
,

1537 
ušt32_t
 
add_m­pšg
);

1539 
	`xc_domaš_upd©e_msi_œq
(

1540 
xc_š‹rçû
 *
xch
,

1541 
ušt32_t
 
domid
,

1542 
ušt32_t
 
gvec
,

1543 
ušt32_t
 
pœq
,

1544 
ušt32_t
 
gæags
,

1545 
ušt64_t
 
gbË
);

1547 
	`xc_domaš_unbšd_msi_œq
(
xc_š‹rçû
 *
xch
,

1548 
ušt32_t
 
domid
,

1549 
ušt32_t
 
gvec
,

1550 
ušt32_t
 
pœq
,

1551 
ušt32_t
 
gæags
);

1553 
	`xc_domaš_bšd_±_œq
(
xc_š‹rçû
 *
xch
,

1554 
ušt32_t
 
domid
,

1555 
ušt8_t
 
machše_œq
,

1556 
ušt8_t
 
œq_ty³
,

1557 
ušt8_t
 
bus
,

1558 
ušt8_t
 
deviû
,

1559 
ušt8_t
 
štx
,

1560 
ušt8_t
 
i§_œq
);

1562 
	`xc_domaš_unbšd_±_œq
(
xc_š‹rçû
 *
xch
,

1563 
ušt32_t
 
domid
,

1564 
ušt8_t
 
machše_œq
,

1565 
ušt8_t
 
œq_ty³
,

1566 
ušt8_t
 
bus
,

1567 
ušt8_t
 
deviû
,

1568 
ušt8_t
 
štx
,

1569 
ušt8_t
 
i§_œq
);

1571 
	`xc_domaš_bšd_±_pci_œq
(
xc_š‹rçû
 *
xch
,

1572 
ušt32_t
 
domid
,

1573 
ušt8_t
 
machše_œq
,

1574 
ušt8_t
 
bus
,

1575 
ušt8_t
 
deviû
,

1576 
ušt8_t
 
štx
);

1578 
	`xc_domaš_bšd_±_i§_œq
(
xc_š‹rçû
 *
xch
,

1579 
ušt32_t
 
domid
,

1580 
ušt8_t
 
machše_œq
);

1582 
	`xc_domaš_£t_machše_add»ss_size
(
xc_š‹rçû
 *
xch
,

1583 
ušt32_t
 
domid
,

1584 
width
);

1585 
	`xc_domaš_g‘_machše_add»ss_size
(
xc_š‹rçû
 *
xch
,

1586 
ušt32_t
 
domid
);

1588 
	`xc_domaš_suµ»ss_¥urious_·ge_çuÉs
(
xc_š‹rçû
 *
xch
,

1589 
ušt32_t
 
domid
);

1592 
	`xc_domaš_£t_rg‘
(
xc_š‹rçû
 *
xch
,

1593 
ušt32_t
 
domid
,

1594 
ušt32_t
 
rg‘
);

1597 
	`xc_domaš_debug_cÚŒŞ
(
xc_š‹rçû
 *
xch
,

1598 
ušt32_t
 
domid
,

1599 
ušt32_t
 
sİ
,

1600 
ušt32_t
 
vıu
);

1602 #ià
	`defšed
(
__i386__
è|| defšed(
__x86_64__
)

1603 
	`xc_ıuid_check
(
xc_š‹rçû
 *
xch
,

1604 cÚ¡ *
šput
,

1605 cÚ¡ **
cÚfig
,

1606 **
cÚfig_ŒªsfÜmed
);

1607 
	`xc_ıuid_£t
(
xc_š‹rçû
 *
xch
,

1608 
domid_t
 
domid
,

1609 cÚ¡ *
šput
,

1610 cÚ¡ **
cÚfig
,

1611 **
cÚfig_ŒªsfÜmed
);

1612 
	`xc_ıuid_­¶y_pŞicy
(
xc_š‹rçû
 *
xch
,

1613 
domid_t
 
domid
);

1614 
	`xc_ıuid_to_¡r
(cÚ¡ *
»gs
,

1615 **
¡rs
);

1616 
	`xc_mÿ_İ
(
xc_š‹rçû
 *
xch
, 
x’_mc
 *
mc
);

1619 
	sxc_px_v®
 {

1620 
ušt64_t
 
äeq
;

1621 
ušt64_t
 
»sid’cy
;

1622 
ušt64_t
 
couÁ
;

1625 
	sxc_px_¡©
 {

1626 
ušt8_t
 
tÙ®
;

1627 
ušt8_t
 
u§bË
;

1628 
ušt8_t
 
Ï¡
;

1629 
ušt8_t
 
cur
;

1630 
ušt64_t
 *
Œªs_±
;

1631 
xc_px_v®
 *
±
;

1634 
	`xc_pm_g‘_max_px
(
xc_š‹rçû
 *
xch
, 
ıuid
, *
max_px
);

1635 
	`xc_pm_g‘_px¡©
(
xc_š‹rçû
 *
xch
, 
ıuid
, 
xc_px_¡©
 *
px±
);

1636 
	`xc_pm_»£t_px¡©
(
xc_š‹rçû
 *
xch
, 
ıuid
);

1638 
	sxc_cx_¡©
 {

1639 
ušt32_t
 
Ä
;

1640 
ušt32_t
 
Ï¡
;

1641 
ušt64_t
 
idË_time
;

1642 
ušt64_t
 *
Œigg”s
;

1643 
ušt64_t
 *
»sid’c›s
;

1644 
ušt64_t
 
pc3
;

1645 
ušt64_t
 
pc6
;

1646 
ušt64_t
 
pc7
;

1647 
ušt64_t
 
cc3
;

1648 
ušt64_t
 
cc6
;

1650 
xc_cx_¡©
 
	txc_cx_¡©_t
;

1652 
	`xc_pm_g‘_max_cx
(
xc_š‹rçû
 *
xch
, 
ıuid
, *
max_cx
);

1653 
	`xc_pm_g‘_cx¡©
(
xc_š‹rçû
 *
xch
, 
ıuid
, 
xc_cx_¡©
 *
cx±
);

1654 
	`xc_pm_»£t_cx¡©
(
xc_š‹rçû
 *
xch
, 
ıuid
);

1656 
	`xc_ıu_Úlše
(
xc_š‹rçû
 *
xch
, 
ıu
);

1657 
	`xc_ıu_ofæše
(
xc_š‹rçû
 *
xch
, 
ıu
);

1663 
x’_u£r¥aû_t
 
	txc_u£r¥aû_t
;

1664 
x’_Údemªd_t
 
	txc_Údemªd_t
;

1666 
	sxc_g‘_ıuäeq_·¿
 {

1668 
ušt32_t
 
ıu_num
;

1669 
ušt32_t
 
äeq_num
;

1670 
ušt32_t
 
gov_num
;

1674 
ušt32_t
 *
afãùed_ıus
;

1675 
ušt32_t
 *
sÿlšg_avaabË_äequ’c›s
;

1676 *
sÿlšg_avaabË_gov”nÜs
;

1677 
sÿlšg_driv”
[
CPUFREQ_NAME_LEN
];

1679 
ušt32_t
 
ıušfo_cur_äeq
;

1680 
ušt32_t
 
ıušfo_max_äeq
;

1681 
ušt32_t
 
ıušfo_mš_äeq
;

1682 
ušt32_t
 
sÿlšg_cur_äeq
;

1684 
sÿlšg_gov”nÜ
[
CPUFREQ_NAME_LEN
];

1685 
ušt32_t
 
sÿlšg_max_äeq
;

1686 
ušt32_t
 
sÿlšg_mš_äeq
;

1690 
xc_u£r¥aû_t
 
u£r¥aû
;

1691 
xc_Údemªd_t
 
Údemªd
;

1692 } 
u
;

1694 
št32_t
 
turbo_’abËd
;

1697 
	`xc_g‘_ıuäeq_·¿
(
xc_š‹rçû
 *
xch
, 
ıuid
,

1698 
xc_g‘_ıuäeq_·¿
 *
u£r_·¿
);

1699 
	`xc_£t_ıuäeq_gov
(
xc_š‹rçû
 *
xch
, 
ıuid
, *
govÇme
);

1700 
	`xc_£t_ıuäeq_·¿
(
xc_š‹rçû
 *
xch
, 
ıuid
,

1701 
ù¾_ty³
, 
ù¾_v®ue
);

1702 
	`xc_g‘_ıuäeq_avgäeq
(
xc_š‹rçû
 *
xch
, 
ıuid
, *
avg_äeq
);

1704 
	`xc_£t_sched_İt_smt
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
v®ue
);

1705 
	`xc_£t_vıu_mig¿tiÚ_d–ay
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
v®ue
);

1706 
	`xc_g‘_vıu_mig¿tiÚ_d–ay
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 *
v®ue
);

1708 
	`xc_g‘_ıuidË_max_c¡©e
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 *
v®ue
);

1709 
	`xc_£t_ıuidË_max_c¡©e
(
xc_š‹rçû
 *
xch
, 
ušt32_t
 
v®ue
);

1711 
	`xc_’abË_turbo
(
xc_š‹rçû
 *
xch
, 
ıuid
);

1712 
	`xc_di§bË_turbo
(
xc_š‹rçû
 *
xch
, 
ıuid
);

1717 
	stmem_oid
 {

1718 
ušt64_t
 
oid
[3];

1721 
	`xc_tmem_cÚŒŞ_oid
(
xc_š‹rçû
 *
xch
, 
št32_t
 
poŞ_id
, 
ušt32_t
 
subİ
,

1722 
ušt32_t
 
şi_id
, ušt32_ˆ
¬g1
, ušt32_ˆ
¬g2
,

1723 
tmem_oid
 
oid
, *
buf
);

1724 
	`xc_tmem_cÚŒŞ
(
xc_š‹rçû
 *
xch
,

1725 
št32_t
 
poŞ_id
, 
ušt32_t
 
subİ
, ušt32_ˆ
şi_id
,

1726 
ušt32_t
 
¬g1
, ušt32_ˆ
¬g2
, 
ušt64_t
 
¬g3
, *
buf
);

1727 
	`xc_tmem_auth
(
xc_š‹rçû
 *
xch
, 
şi_id
, *
uuid_¡r
, 
¬g1
);

1728 
	`xc_tmem_§ve
(
xc_š‹rçû
 *
xch
, 
dom
, 
live
, 
fd
, 
f›ld_m¬k”
);

1729 
	`xc_tmem_§ve_exŒa
(
xc_š‹rçû
 *
xch
, 
dom
, 
fd
, 
f›ld_m¬k”
);

1730 
	`xc_tmem_§ve_dÚe
(
xc_š‹rçû
 *
xch
, 
dom
);

1731 
	`xc_tmem_»¡Üe
(
xc_š‹rçû
 *
xch
, 
dom
, 
fd
);

1732 
	`xc_tmem_»¡Üe_exŒa
(
xc_š‹rçû
 *
xch
, 
dom
, 
fd
);

1737 
	`xc_mem_ev’t_cÚŒŞ
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
, 
İ
,

1738 
mode
, *
sh¬ed_·ge
,

1739 *
ršg_·ge
, 
gâ
);

1741 
	`xc_mem_ev’t_’abË
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
,

1742 *
sh¬ed_·ge
, *
ršg_·ge
);

1743 
	`xc_mem_ev’t_di§bË
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
);

1745 
	`xc_mem_·gšg_nomš©e
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
,

1746 
gâ
);

1747 
	`xc_mem_·gšg_eviù
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
, 
gâ
);

1748 
	`xc_mem_·gšg_´•
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
, 
gâ
);

1749 
	`xc_mem_·gšg_»sume
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
,

1750 
gâ
);

1751 
	`xc_mem_acûss_»sume
(
xc_š‹rçû
 *
xch
, 
domid_t
 
domaš_id
,

1752 
gâ
);

1757 
	`xc_memshr_cÚŒŞ
(
xc_š‹rçû
 *
xch
,

1758 
ušt32_t
 
domid
,

1759 
’abË
);

1760 
	`xc_memshr_nomš©e_gâ
(
xc_š‹rçû
 *
xch
,

1761 
ušt32_t
 
domid
,

1762 
gâ
,

1763 
ušt64_t
 *
hªdË
);

1764 
	`xc_memshr_nomš©e_g»f
(
xc_š‹rçû
 *
xch
,

1765 
ušt32_t
 
domid
,

1766 
g¿Á_»f_t
 
g»f
,

1767 
ušt64_t
 *
hªdË
);

1768 
	`xc_memshr_sh¬e
(
xc_š‹rçû
 *
xch
,

1769 
ušt64_t
 
sourû_hªdË
,

1770 
ušt64_t
 
ş›Á_hªdË
);

1771 
	`xc_memshr_domaš_»sume
(
xc_š‹rçû
 *
xch
,

1772 
ušt32_t
 
domid
);

1773 
	`xc_memshr_debug_gâ
(
xc_š‹rçû
 *
xch
,

1774 
ušt32_t
 
domid
,

1775 
gâ
);

1776 
	`xc_memshr_debug_mâ
(
xc_š‹rçû
 *
xch
,

1777 
ušt32_t
 
domid
,

1778 
mâ
);

1779 
	`xc_memshr_debug_g»f
(
xc_š‹rçû
 *
xch
,

1780 
ušt32_t
 
domid
,

1781 
g¿Á_»f_t
 
g»f
);

1783 
	`xc_æask_lßd
(
xc_š‹rçû
 *
xc_hªdË
, *
buf
, 
ušt32_t
 
size
);

1784 
	`xc_æask_cÚ‹xt_to_sid
(
xc_š‹rçû
 *
xc_hªdË
, *
buf
, 
ušt32_t
 
size
, ušt32_ˆ*
sid
);

1785 
	`xc_æask_sid_to_cÚ‹xt
(
xc_š‹rçû
 *
xc_hªdË
, 
sid
, *
buf
, 
ušt32_t
 
size
);

1786 
	`xc_æask_g‘’fÜû
(
xc_š‹rçû
 *
xc_hªdË
);

1787 
	`xc_æask_£‹nfÜû
(
xc_š‹rçû
 *
xc_hªdË
, 
mode
);

1788 
	`xc_æask_add_pœq
(
xc_š‹rçû
 *
xc_hªdË
, 
pœq
, *
scÚ‹xt
);

1789 
	`xc_æask_add_iİÜt
(
xc_š‹rçû
 *
xc_hªdË
, 
low
, 
high
,

1790 *
scÚ‹xt
);

1791 
	`xc_æask_add_iomem
(
xc_š‹rçû
 *
xc_hªdË
, 
low
, 
high
,

1792 *
scÚ‹xt
);

1793 
	`xc_æask_add_deviû
(
xc_š‹rçû
 *
xc_hªdË
, 
deviû
, *
scÚ‹xt
);

1794 
	`xc_æask_d–_pœq
(
xc_š‹rçû
 *
xc_hªdË
, 
pœq
);

1795 
	`xc_æask_d–_iİÜt
(
xc_š‹rçû
 *
xc_hªdË
, 
low
, 
high
);

1796 
	`xc_æask_d–_iomem
(
xc_š‹rçû
 *
xc_hªdË
, 
low
, 
high
);

1797 
	`xc_æask_d–_deviû
(
xc_š‹rçû
 *
xc_hªdË
, 
deviû
);

1798 
	`xc_æask_acûss
(
xc_š‹rçû
 *
xc_hªdË
, cÚ¡ *
scÚ
, cÚ¡ *
tcÚ
,

1799 
ušt16_t
 
tşass
, 
ušt32_t
 
»q
,

1800 
ušt32_t
 *
®lowed
, ušt32_ˆ*
decided
,

1801 
ušt32_t
 *
aud™®low
, ušt32_ˆ*
aud™d’y
,

1802 
ušt32_t
 *
£qno
);

1803 
	`xc_æask_avc_ÿche¡©s
(
xc_š‹rçû
 *
xc_hªdË
, *
buf
, 
size
);

1804 
	`xc_æask_pŞicyv”s
(
xc_š‹rçû
 *
xc_hªdË
, *
buf
, 
size
);

1805 
	`xc_æask_avc_hash¡©s
(
xc_š‹rçû
 *
xc_hªdË
, *
buf
, 
size
);

1806 
	`xc_æask_g‘avc_th»shŞd
(
xc_š‹rçû
 *
xc_hªdË
);

1807 
	`xc_æask_£vc_th»shŞd
(
xc_š‹rçû
 *
xc_hªdË
, 
th»shŞd
);

1809 
–f_bš¬y
;

1810 
	`xc_–f_£t_logfe
(
xc_š‹rçû
 *
xch
, 
–f_bš¬y
 *
–f
,

1811 
v”bo£
);

	@/usr/include/alloca.h

19 #iâdef 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

27 
	g__BEGIN_DECLS


30 #undeà
®loÿ


33 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

35 #ifdef 
__GNUC__


36 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

39 
__END_DECLS


	@/usr/include/asm-generic/types.h

1 #iâdeà
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-g’”ic/št-Î64.h
>

9 #iâdeà
__ASSEMBLY__


11 
	tumode_t
;

	@/usr/include/bits/byteswap.h

21 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


25 #iâdeà
_BITS_BYTESWAP_H


26 
	#_BITS_BYTESWAP_H
 1

	)

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8))

	)

34 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

35 
	#__bsw­_16
(
x
) \

36 (
__ex‹nsiÚ__
 \

37 ({ 
__v
, 
__x
 = (
x
); \

38 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

39 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

41 
	`__asm__
 ("rorw $8, %w0" \

42 : "ô" (
__v
) \

43 : "0" (
__x
) \

45 
__v
; }))

	)

48 
	#__bsw­_16
(
x
) \

49 (
__ex‹nsiÚ__
 \

50 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_16
 (__x); }))

	)

55 
	#__bsw­_cÚ¡ªt_32
(
x
) \

56 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

57 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

59 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

60 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

61 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

62 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

63 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

64 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

65 || 
defšed
 
	g__amdçm10__
)

68 
	#__bsw­_32
(
x
) \

69 (
__ex‹nsiÚ__
 \

70 ({ 
__v
, 
__x
 = (
x
); \

71 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

72 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

74 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

75 
__v
; }))

	)

77 
	#__bsw­_32
(
x
) \

78 (
__ex‹nsiÚ__
 \

79 ({ 
__v
, 
__x
 = (
x
); \

80 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

81 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

83 
	`__asm__
 ("rorw $8, %w0;" \

86 : "ô" (
__v
) \

87 : "0" (
__x
) \

89 
__v
; }))

	)

92 
	#__bsw­_32
(
x
) \

93 (
__ex‹nsiÚ__
 \

94 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

98 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

100 
	#__bsw­_cÚ¡ªt_64
(
x
) \

101 ((((
x
) & 0xff00000000000000ull) >> 56) \

102 | (((
x
) & 0x00ff000000000000ull) >> 40) \

103 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

104 | (((
x
) & 0x000000ff00000000ull) >> 8) \

105 | (((
x
) & 0x00000000ff000000ull) << 8) \

106 | (((
x
) & 0x0000000000ff0000ull) << 24) \

107 | (((
x
) & 0x000000000000ff00ull) << 40) \

108 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

110 #ià
__WORDSIZE
 == 64

111 
	#__bsw­_64
(
x
) \

112 (
__ex‹nsiÚ__
 \

113 ({ 
__v
, 
__x
 = (
x
); \

114 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

115 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

117 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

118 
__v
; }))

	)

120 
	#__bsw­_64
(
x
) \

121 (
__ex‹nsiÚ__
 \

122 ({ uniÚ { 
__ex‹nsiÚ__
 
__Î
; \

123 
__l
[2]; } 
__w
, 
__r
; \

124 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

125 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

128 
__w
.
__Î
 = (
x
); \

129 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

130 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

132 
__r
.
__Î
; }))

	)

	@/usr/include/bits/pthreadtypes.h

20 #iâdeà
_BITS_PTHREADTYPES_H


21 
	#_BITS_PTHREADTYPES_H
 1

	)

23 
	~<b™s/wÜdsize.h
>

25 #ià
__WORDSIZE
 == 64

26 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

27 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

28 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

29 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

30 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

31 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

32 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

33 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

34 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

36 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

37 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

38 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

39 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

40 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

41 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

42 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

43 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

44 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

50 
	t±h»ad_t
;

55 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

56 
	m__®ign
;

57 } 
	t±h»ad_©Œ_t
;

60 #ià
__WORDSIZE
 == 64

61 
	s__±h»ad_š‹º®_li¡


63 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

64 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

65 } 
	t__±h»ad_li¡_t
;

67 
	s__±h»ad_š‹º®_¦i¡


69 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

70 } 
	t__±h»ad_¦i¡_t
;

78 
	s__±h»ad_mu‹x_s


80 
	m__lock
;

81 
	m__couÁ
;

82 
	m__owÃr
;

83 #ià
__WORDSIZE
 == 64

84 
	m__nu£rs
;

88 
	m__kšd
;

89 #ià
__WORDSIZE
 == 64

90 
	m__¥šs
;

91 
__±h»ad_li¡_t
 
	m__li¡
;

92 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

94 
	m__nu£rs
;

95 
__ex‹nsiÚ__
 union

97 
	m__¥šs
;

98 
__±h»ad_¦i¡_t
 
	m__li¡
;

101 } 
	m__d©a
;

102 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

103 
	m__®ign
;

104 } 
	t±h»ad_mu‹x_t
;

108 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

109 
	m__®ign
;

110 } 
	t±h»ad_mu‹x©Œ_t
;

119 
	m__lock
;

120 
	m__fu‹x
;

121 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

122 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

123 
__ex‹nsiÚ__
 
	m__wok’_£q
;

124 *
	m__mu‹x
;

125 
	m__nwa™”s
;

126 
	m__brßdÿ¡_£q
;

127 } 
	m__d©a
;

128 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

129 
__ex‹nsiÚ__
 
	m__®ign
;

130 } 
	t±h»ad_cÚd_t
;

134 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

135 
	m__®ign
;

136 } 
	t±h»ad_cÚd©Œ_t
;

140 
	t±h»ad_key_t
;

144 
	t±h»ad_Úû_t
;

147 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


152 #ià
__WORDSIZE
 == 64

155 
	m__lock
;

156 
	m__Ä_»ad”s
;

157 
	m__»ad”s_wakeup
;

158 
	m__wr™”_wakeup
;

159 
	m__Ä_»ad”s_queued
;

160 
	m__Ä_wr™”s_queued
;

161 
	m__wr™”
;

162 
	m__sh¬ed
;

163 
	m__·d1
;

164 
	m__·d2
;

167 
	m__æags
;

168 } 
	m__d©a
;

172 
	m__lock
;

173 
	m__Ä_»ad”s
;

174 
	m__»ad”s_wakeup
;

175 
	m__wr™”_wakeup
;

176 
	m__Ä_»ad”s_queued
;

177 
	m__Ä_wr™”s_queued
;

180 
	m__æags
;

181 
	m__sh¬ed
;

182 
	m__·d1
;

183 
	m__·d2
;

184 
	m__wr™”
;

185 } 
	m__d©a
;

187 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

188 
	m__®ign
;

189 } 
	t±h»ad_rwlock_t
;

193 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

194 
	m__®ign
;

195 } 
	t±h»ad_rwlock©Œ_t
;

199 #ifdeà
__USE_XOPEN2K


201 vŞ©
	t±h»ad_¥šlock_t
;

208 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

209 
	m__®ign
;

210 } 
	t±h»ad_b¬r›r_t
;

214 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

215 
	m__®ign
;

216 } 
	t±h»ad_b¬r›¿‰r_t
;

220 #ià
__WORDSIZE
 == 32

222 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/stdio-ldbl.h

20 #iâdeà
_STDIO_H


24 
__BEGIN_NAMESPACE_STD


25 
	$__LDBL_REDIR_DECL
 (
årštf
)

26 
	$__LDBL_REDIR_DECL
 (
´štf
)

27 
	$__LDBL_REDIR_DECL
 (
¥rštf
)

28 
	$__LDBL_REDIR_DECL
 (
vårštf
)

29 
	$__LDBL_REDIR_DECL
 (
v´štf
)

30 
	$__LDBL_REDIR_DECL
 (
v¥rštf
)

31 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

32 && !
defšed
 
__REDIRECT
 \

33 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

34 
	$__LDBL_REDIR1_DECL
 (
fsÿnf
, 
__Ædbl___isoc99_fsÿnf
)

35 
	$__LDBL_REDIR1_DECL
 (
sÿnf
, 
__Ædbl___isoc99_sÿnf
)

36 
	$__LDBL_REDIR1_DECL
 (
ssÿnf
, 
__Ædbl___isoc99_ssÿnf
)

38 
	$__LDBL_REDIR_DECL
 (
fsÿnf
)

39 
	$__LDBL_REDIR_DECL
 (
sÿnf
)

40 
	$__LDBL_REDIR_DECL
 (
ssÿnf
)

42 
__END_NAMESPACE_STD


44 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


45 
__BEGIN_NAMESPACE_C99


46 
	$__LDBL_REDIR_DECL
 (
¢´štf
)

47 
	$__LDBL_REDIR_DECL
 (
v¢´štf
)

48 
__END_NAMESPACE_C99


51 #ifdef 
__USE_ISOC99


52 
__BEGIN_NAMESPACE_C99


53 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

54 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

55 
	$__LDBL_REDIR1_DECL
 (
vfsÿnf
, 
__Ædbl___isoc99_vfsÿnf
)

56 
	$__LDBL_REDIR1_DECL
 (
vsÿnf
, 
__Ædbl___isoc99_vsÿnf
)

57 
	$__LDBL_REDIR1_DECL
 (
vssÿnf
, 
__Ædbl___isoc99_vssÿnf
)

59 
	$__LDBL_REDIR_DECL
 (
vfsÿnf
)

60 
	$__LDBL_REDIR_DECL
 (
vssÿnf
)

61 
	$__LDBL_REDIR_DECL
 (
vsÿnf
)

63 
__END_NAMESPACE_C99


66 #ifdeà
__USE_GNU


67 
	$__LDBL_REDIR_DECL
 (
vd´štf
)

68 
	$__LDBL_REDIR_DECL
 (
d´štf
)

69 
	$__LDBL_REDIR_DECL
 (
va¥rštf
)

70 
	$__LDBL_REDIR_DECL
 (
__a¥rštf
)

71 
	$__LDBL_REDIR_DECL
 (
a¥rštf
)

72 
	$__LDBL_REDIR_DECL
 (
ob¡ack_´štf
)

73 
	$__LDBL_REDIR_DECL
 (
ob¡ack_v´štf
)

76 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


77 
	$__LDBL_REDIR_DECL
 (
__¥rštf_chk
)

78 
	$__LDBL_REDIR_DECL
 (
__v¥rštf_chk
)

79 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


80 
	$__LDBL_REDIR_DECL
 (
__¢´štf_chk
)

81 
	$__LDBL_REDIR_DECL
 (
__v¢´štf_chk
)

83 #ià
__USE_FORTIFY_LEVEL
 > 1

84 
	$__LDBL_REDIR_DECL
 (
__årštf_chk
)

85 
	$__LDBL_REDIR_DECL
 (
__´štf_chk
)

86 
	$__LDBL_REDIR_DECL
 (
__vårštf_chk
)

87 
	$__LDBL_REDIR_DECL
 (
__v´štf_chk
)

88 #ifdeà
__USE_GNU


89 
	$__LDBL_REDIR_DECL
 (
__a¥rštf_chk
)

90 
	$__LDBL_REDIR_DECL
 (
__va¥rštf_chk
)

91 
	$__LDBL_REDIR_DECL
 (
__d´štf_chk
)

92 
	$__LDBL_REDIR_DECL
 (
__vd´štf_chk
)

93 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_´štf_chk
)

94 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_v´štf_chk
)

	@/usr/include/bits/stdio.h

20 #iâdeà
_STDIO_H


24 #iâdeà
__ex‹º_šlše


25 
	#__STDIO_INLINE
 
šlše


	)

27 
	#__STDIO_INLINE
 
__ex‹º_šlše


	)

31 #ifdeà
__USE_EXTERN_INLINES


34 #ià!(
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
)

36 
__STDIO_INLINE
 

37 
	$v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

39  
	`vårštf
 (
¡dout
, 
__fmt
, 
__¬g
);

40 
	}
}

44 
__STDIO_INLINE
 

45 
	$g‘ch¬
 ()

47  
	`_IO_g‘c
 (
¡dš
);

48 
	}
}

51 #ifdeà
__USE_MISC


53 
__STDIO_INLINE
 

54 
	$fg‘c_uÆocked
 (
FILE
 *
__å
)

56  
	`_IO_g‘c_uÆocked
 (
__å
);

57 
	}
}

61 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


63 
__STDIO_INLINE
 

64 
	$g‘c_uÆocked
 (
FILE
 *
__å
)

66  
	`_IO_g‘c_uÆocked
 (
__å
);

67 
	}
}

70 
__STDIO_INLINE
 

71 
	$g‘ch¬_uÆocked
 ()

73  
	`_IO_g‘c_uÆocked
 (
¡dš
);

74 
	}
}

79 
__STDIO_INLINE
 

80 
	$putch¬
 (
__c
)

82  
	`_IO_putc
 (
__c
, 
¡dout
);

83 
	}
}

86 #ifdeà
__USE_MISC


88 
__STDIO_INLINE
 

89 
	$åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

91  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

92 
	}
}

96 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


98 
__STDIO_INLINE
 

99 
	$putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

101  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

102 
	}
}

105 
__STDIO_INLINE
 

106 
	$putch¬_uÆocked
 (
__c
)

108  
	`_IO_putc_uÆocked
 (
__c
, 
¡dout
);

109 
	}
}

113 #ifdef 
__USE_GNU


115 
__STDIO_INLINE
 
_IO_ssize_t


116 
	$g‘lše
 (**
__lš•Œ
, 
size_t
 *
__n
, 
FILE
 *
__¡»am
)

118  
	`__g‘d–im
 (
__lš•Œ
, 
__n
, '\n', 
__¡»am
);

119 
	}
}

123 #ifdeà
__USE_MISC


125 
__STDIO_INLINE
 

126 
__NTH
 (
	$ãof_uÆocked
 (
FILE
 *
__¡»am
))

128  
	`_IO_ãof_uÆocked
 (
__¡»am
);

129 
	}
}

132 
__STDIO_INLINE
 

133 
__NTH
 (
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
))

135  
	`_IO_ã¼Ü_uÆocked
 (
__¡»am
);

136 
	}
}

142 #ià
defšed
 
__USE_MISC
 && defšed 
__GNUC__
 && defšed 
__OPTIMIZE__
 \

143 && !
defšed
 
	g__ılu¥lus


145 
	#ä—d_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

146 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

147 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

148 && (
size_t
è(
size
) != 0) \

149 ? ({ *
__±r
 = (*è(
±r
); \

150 
FILE
 *
__¡»am
 = (
¡»am
); \

151 
size_t
 
__út
; \

152 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

153 
__út
 > 0; --__cnt) \

155 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
); \

156 ià(
__c
 =ğ
EOF
) \

158 *
__±r
++ = 
__c
; \

160 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

161 / (
size_t
è(
size
); }) \

162 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

163 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

165 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

166 (è(
n
), (
size_t
) 0) \

167 : 
	`ä—d_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

169 
	#fwr™e_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

170 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

171 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

172 && (
size_t
è(
size
) != 0) \

173 ? ({ cÚ¡ *
__±r
 = (cÚ¡ *è(
±r
); \

174 
FILE
 *
__¡»am
 = (
¡»am
); \

175 
size_t
 
__út
; \

176 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

177 
__út
 > 0; --__cnt) \

178 ià(
	`_IO_putc_uÆocked
 (*
__±r
++, 
__¡»am
è=ğ
EOF
) \

180 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

181 / (
size_t
è(
size
); }) \

182 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

183 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

185 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

186 (è(
n
), (
size_t
) 0) \

187 : 
	`fwr™e_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

191 #undeà
__STDIO_INLINE


	@/usr/include/bits/stdio2.h

20 #iâdeà
_STDIO_H


24 
	$__¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

25 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

26 
	$__v¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

27 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

28 
_G_va_li¡
 
__­
è
__THROW
;

30 #ifdeà
__va_¬g_·ck


31 
__ex‹º_®ways_šlše
 

32 
	`__NTH
 (
	$¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fmt
, ...))

34  
	`__butš___¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

35 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

36 
	}
}

37 #–ià!
defšed
 
__ılu¥lus


38 
	#¥rštf
(
¡r
, ...) \

39 
	`__butš___¥rštf_chk
 (
¡r
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

40 
__VA_ARGS__
)

	)

43 
__ex‹º_®ways_šlše
 

44 
__NTH
 (
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fmt
,

45 
_G_va_li¡
 
__­
))

47  
	`__butš___v¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

48 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

49 
	}
}

51 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


53 
	$__¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

54 
size_t
 
__¦’
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

55 ...è
__THROW
;

56 
	$__v¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

57 
size_t
 
__¦’
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

58 
_G_va_li¡
 
__­
è
__THROW
;

60 #ifdeà
__va_¬g_·ck


61 
__ex‹º_®ways_šlše
 

62 
	`__NTH
 (
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

63 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...))

65  
	`__butš___¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

66 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

67 
	}
}

68 #–ià!
defšed
 
__ılu¥lus


69 
	#¢´štf
(
¡r
, 
Ën
, ...) \

70 
	`__butš___¢´štf_chk
 (
¡r
, 
Ën
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

71 
__VA_ARGS__
)

	)

74 
__ex‹º_®ways_šlše
 

75 
__NTH
 (
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

76 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

78  
	`__butš___v¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

79 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

80 
	}
}

84 #ià
__USE_FORTIFY_LEVEL
 > 1

86 
__årštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

87 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

88 
__´štf_chk
 (
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

89 
__vårštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

90 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__­
);

91 
__v´štf_chk
 (
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

92 
_G_va_li¡
 
__­
);

94 #ifdeà
__va_¬g_·ck


95 
__ex‹º_®ways_šlše
 

96 
	$årštf
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__cÚ¡
 *__»¡riù 
__fmt
, ...)

98  
	`__årštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

99 
	`__va_¬g_·ck
 ());

100 
	}
}

102 
__ex‹º_®ways_šlše
 

103 
	$´štf
 (
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

105  
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

106 
	}
}

107 #–ià!
defšed
 
__ılu¥lus


108 
	#´štf
(...) \

109 
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

110 
	#årštf
(
¡»am
, ...) \

111 
	`__årštf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

114 
__ex‹º_®ways_šlše
 

115 
	$v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

117 #ifdeà
__USE_EXTERN_INLINES


118  
	`__vårštf_chk
 (
¡dout
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

120  
	`__v´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

122 
	}
}

124 
__ex‹º_®ways_šlše
 

125 
	$vårštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

126 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

128  
	`__vårštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

129 
	}
}

131 #ifdeà
__USE_GNU


133 
	$__a¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

134 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

135 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 4))è
__wur
;

136 
	$__va¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

137 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

138 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 0))è
__wur
;

139 
	$__d´štf_chk
 (
__fd
, 
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

140 ...è
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

141 
	$__vd´štf_chk
 (
__fd
, 
__æag
,

142 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

143 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

144 
	$__ob¡ack_´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

145 
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

147 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

148 
	$__ob¡ack_v´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

149 
__æag
,

150 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

151 
_G_va_li¡
 
__¬gs
)

152 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

154 #ifdeà
__va_¬g_·ck


155 
__ex‹º_®ways_šlše
 

156 
	`__NTH
 (
	$a¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__fmt
, ...))

158  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

159 
	`__va_¬g_·ck
 ());

160 
	}
}

162 
__ex‹º_®ways_šlše
 

163 
__NTH
 (
	$__a¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__fmt
,

166  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

167 
	`__va_¬g_·ck
 ());

168 
	}
}

170 
__ex‹º_®ways_šlše
 

171 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

173  
	`__d´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

174 
	`__va_¬g_·ck
 ());

175 
	}
}

177 
__ex‹º_®ways_šlše
 

178 
__NTH
 (
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

179 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...))

181  
	`__ob¡ack_´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

182 
	`__va_¬g_·ck
 ());

183 
	}
}

184 #–ià!
defšed
 
__ılu¥lus


185 
	#a¥rštf
(
±r
, ...) \

186 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

187 
	#__a¥rštf
(
±r
, ...) \

188 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

189 
	#d´štf
(
fd
, ...) \

190 
	`__d´štf_chk
 (
fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

191 
	#ob¡ack_´štf
(
ob¡ack
, ...) \

192 
	`__ob¡ack_´štf_chk
 (
ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

195 
__ex‹º_®ways_šlše
 

196 
__NTH
 (
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__fmt
,

197 
_G_va_li¡
 
__­
))

199  
	`__va¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

200 
	}
}

202 
__ex‹º_®ways_šlše
 

203 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

205  
	`__vd´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

206 
	}
}

208 
__ex‹º_®ways_šlše
 

209 
__NTH
 (
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

210 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

212  
	`__ob¡ack_v´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

213 
__­
);

214 
	}
}

220 *
	$__g‘s_chk
 (*
__¡r
, 
size_t
è
__wur
;

221 *
	`__REDIRECT
 (
__g‘s_w¬n
, (*
__¡r
), 
g‘s
)

222 
__wur
 
	`__w¬Ç‰r
 ("please use fgets or getline instead, gets can't "

225 
__ex‹º_®ways_šlše
 
__wur
 *

226 
	$g‘s
 (*
__¡r
)

228 ià(
	`__bos
 (
__¡r
è!ğ(
size_t
) -1)

229  
	`__g‘s_chk
 (
__¡r
, 
	`__bos
 (__str));

230  
	`__g‘s_w¬n
 (
__¡r
);

231 
	}
}

233 *
	$__fg‘s_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

234 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

235 *
	`__REDIRECT
 (
__fg‘s_®Ÿs
,

236 (*
__»¡riù
 
__s
, 
__n
,

237 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s
è
__wur
;

238 *
	`__REDIRECT
 (
__fg‘s_chk_w¬n
,

239 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

240 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_chk
)

241 
__wur
 
	`__w¬Ç‰r
 ("fgets called with bigger sizehan†ength "

244 
__ex‹º_®ways_šlše
 
__wur
 *

245 
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

247 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

249 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

250  
	`__fg‘s_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

252 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

253  
	`__fg‘s_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

255  
	`__fg‘s_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

256 
	}
}

258 
size_t
 
	$__ä—d_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

259 
size_t
 
__size
, size_ˆ
__n
,

260 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

261 
size_t
 
	`__REDIRECT
 (
__ä—d_®Ÿs
,

262 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

263 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

264 
ä—d
è
__wur
;

265 
size_t
 
	`__REDIRECT
 (
__ä—d_chk_w¬n
,

266 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

267 
size_t
 
__size
, size_ˆ
__n
,

268 
FILE
 *
__»¡riù
 
__¡»am
),

269 
__ä—d_chk
)

270 
__wur
 
	`__w¬Ç‰r
 ("fread called with bigger size *‚membhan†ength "

273 
__ex‹º_®ways_šlše
 
__wur
 
size_t


274 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

275 
FILE
 *
__»¡riù
 
__¡»am
)

277 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

279 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

280 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

281 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

282  
	`__ä—d_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

284 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

285  
	`__ä—d_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

287  
	`__ä—d_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

288 
	}
}

290 #ifdeà
__USE_GNU


291 *
	$__fg‘s_uÆocked_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
,

292 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

293 *
	`__REDIRECT
 (
__fg‘s_uÆocked_®Ÿs
,

294 (*
__»¡riù
 
__s
, 
__n
,

295 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s_uÆocked
è
__wur
;

296 *
	`__REDIRECT
 (
__fg‘s_uÆocked_chk_w¬n
,

297 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

298 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_uÆocked_chk
)

299 
__wur
 
	`__w¬Ç‰r
 ("fgets_unlocked called with bigger sizehan†ength "

302 
__ex‹º_®ways_šlše
 
__wur
 *

303 
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

305 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

307 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

308  
	`__fg‘s_uÆocked_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

310 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

311  
	`__fg‘s_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

313  
	`__fg‘s_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

314 
	}
}

317 #ifdeà
__USE_MISC


318 #undeà
ä—d_uÆocked


319 
size_t
 
	$__ä—d_uÆocked_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

320 
size_t
 
__size
, size_ˆ
__n
,

321 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

322 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_®Ÿs
,

323 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

324 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

325 
ä—d_uÆocked
è
__wur
;

326 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_chk_w¬n
,

327 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

328 
size_t
 
__size
, size_ˆ
__n
,

329 
FILE
 *
__»¡riù
 
__¡»am
),

330 
__ä—d_uÆocked_chk
)

331 
__wur
 
	`__w¬Ç‰r
 ("fread_unlocked called with bigger size *‚membhan "

334 
__ex‹º_®ways_šlše
 
__wur
 
size_t


335 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

336 
FILE
 *
__»¡riù
 
__¡»am
)

338 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

340 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

341 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

342 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

343  
	`__ä—d_uÆocked_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

344 
__¡»am
);

346 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

347  
	`__ä—d_uÆocked_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

348 
__¡»am
);

351 #ifdeà
__USE_EXTERN_INLINES


352 ià(
	`__butš_cÚ¡ªt_p
 (
__size
)

353 && 
	`__butš_cÚ¡ªt_p
 (
__n
)

354 && (
__size
 | 
__n
è< (((
size_t
) 1) << (8 *  (size_t) / 2))

355 && 
__size
 * 
__n
 <= 8)

357 
size_t
 
__út
 = 
__size
 * 
__n
;

358 *
__ıŒ
 = (*è
__±r
;

359 ià(
__út
 == 0)

362 ; 
__út
 > 0; --__cnt)

364 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
);

365 ià(
__c
 =ğ
EOF
)

367 *
__ıŒ
++ = 
__c
;

369  (
__ıŒ
 - (*è
__±r
è/ 
__size
;

372  
	`__ä—d_uÆocked_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

373 
	}
}

	@/usr/include/bits/stdio_lim.h

19 #ià!
defšed
 
_STDIO_H
 && !defšed 
__Ãed_FOPEN_MAX
 && !defšed 
__Ãed_IOV_MAX


23 #ifdeà
_STDIO_H


24 
	#L_tm²am
 20

	)

25 
	#TMP_MAX
 238328

	)

26 
	#FILENAME_MAX
 4096

	)

28 #ifdeà
__USE_POSIX


29 
	#L_ù”mid
 9

	)

30 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


31 
	#L_cu£rid
 9

	)

36 #ià
defšed
 
__Ãed_FOPEN_MAX
 || defšed 
_STDIO_H


37 #undeà
FOPEN_MAX


38 
	#FOPEN_MAX
 16

	)

41 #ià
defšed
 
__Ãed_IOV_MAX
 && !defšed 
IOV_MAX


42 
	#IOV_MAX
 1024

	)

	@/usr/include/bits/stdlib-ldbl.h

20 #iâdeà
_STDLIB_H


24 #ifdef 
__USE_ISOC99


25 
__BEGIN_NAMESPACE_C99


26 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd
, 
¡¹od
)

27 
__END_NAMESPACE_C99


30 #ifdeà
__USE_GNU


31 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd_l
, 
¡¹od_l
)

34 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


35 #ifdeà
__USE_MISC


36 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

38 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

39 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

40 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

20 #iâdeà
_STDLIB_H


24 *
	$__»®·th_chk
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

25 *
__»¡riù
 
__»sŞved
,

26 
size_t
 
__»sŞvedËn
è
__THROW
 
__wur
;

27 *
	`__REDIRECT_NTH
 (
__»®·th_®Ÿs
,

28 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

29 *
__»¡riù
 
__»sŞved
), 
»®·th
è
__wur
;

30 *
	`__REDIRECT_NTH
 (
__»®·th_chk_w¬n
,

31 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

32 *
__»¡riù
 
__»sŞved
,

33 
size_t
 
__»sŞvedËn
), 
__»®·th_chk
è
__wur


34 
	`__w¬Ç‰r
 ("second‡rgument of„ealpath must beƒither NULL or‡t "

37 
__ex‹º_®ways_šlše
 
__wur
 *

38 
	`__NTH
 (
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
, *__»¡riù 
__»sŞved
))

40 ià(
	`__bos
 (
__»sŞved
è!ğ(
size_t
) -1)

42 #ià
defšed
 
_LIBC_LIMITS_H_
 && defšed 
PATH_MAX


43 ià(
	`__bos
 (
__»sŞved
è< 
PATH_MAX
)

44  
	`__»®·th_chk_w¬n
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

46  
	`__»®·th_chk
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

49  
	`__»®·th_®Ÿs
 (
__Çme
, 
__»sŞved
);

50 
	}
}

53 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

54 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

55 
	`__REDIRECT_NTH
 (
__±¢ame_r_®Ÿs
, (
__fd
, *
__buf
,

56 
size_t
 
__buæ’
), 
±¢ame_r
)

57 
	`__nÚnuÎ
 ((2));

58 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¬n
,

59 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

60 
size_t
 
__Ä—l
), 
__±¢ame_r_chk
)

61 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ptsname_r called with buflen biggerhan "

64 
__ex‹º_®ways_šlše
 

65 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

67 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

69 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

70  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

71 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

72  
	`__±¢ame_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

74  
	`__±¢ame_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

75 
	}
}

78 
	$__wùomb_chk
 (*
__s
, 
wch¬_t
 
__wch¬
, 
size_t
 
__buæ’
)

79 
__THROW
 
__wur
;

80 
	`__REDIRECT_NTH
 (
__wùomb_®Ÿs
, (*
__s
, 
wch¬_t
 
__wch¬
),

81 
wùomb
è
__wur
;

83 
__ex‹º_®ways_šlše
 
__wur
 

84 
	`__NTH
 (
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
))

89 
	#__STDLIB_MB_LEN_MAX
 16

	)

90 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__STDLIB_MB_LEN_MAX


93 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

94  
	`__wùomb_chk
 (
__s
, 
__wch¬
, 
	`__bos
 (__s));

95  
	`__wùomb_®Ÿs
 (
__s
, 
__wch¬
);

96 
	}
}

99 
size_t
 
	$__mb¡owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

100 
__cÚ¡
 *
__»¡riù
 
__¤c
,

101 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

102 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_®Ÿs
,

103 (
wch¬_t
 *
__»¡riù
 
__d¡
,

104 
__cÚ¡
 *
__»¡riù
 
__¤c
,

105 
size_t
 
__Ën
), 
mb¡owcs
);

106 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_chk_w¬n
,

107 (
wch¬_t
 *
__»¡riù
 
__d¡
,

108 
__cÚ¡
 *
__»¡riù
 
__¤c
,

109 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__mb¡owcs_chk
)

110 
	`__w¬Ç‰r
 ("mbstowcs called with dst buffer smallerhan†en "

113 
__ex‹º_®ways_šlše
 
size_t


114 
	`__NTH
 (
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

115 
size_t
 
__Ën
))

117 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

119 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

120  
	`__mb¡owcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
,

121 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

123 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

124  
	`__mb¡owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
,

125 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

127  
	`__mb¡owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

128 
	}
}

131 
size_t
 
	$__wc¡ombs_chk
 (*
__»¡riù
 
__d¡
,

132 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

133 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

134 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_®Ÿs
,

135 (*
__»¡riù
 
__d¡
,

136 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

137 
size_t
 
__Ën
), 
wc¡ombs
);

138 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_chk_w¬n
,

139 (*
__»¡riù
 
__d¡
,

140 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

141 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__wc¡ombs_chk
)

142 
	`__w¬Ç‰r
 ("wcstombs called with dst buffer smallerhan†en");

144 
__ex‹º_®ways_šlše
 
size_t


145 
	`__NTH
 (
	$wc¡ombs
 (*
__»¡riù
 
__d¡
, 
__cÚ¡
 
wch¬_t
 *__»¡riù 
__¤c
,

146 
size_t
 
__Ën
))

148 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

150 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

151  
	`__wc¡ombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

152 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

153  
	`__wc¡ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

155  
	`__wc¡ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

156 
	}
}

	@/usr/include/bits/string.h

20 #iâdeà
_STRING_H


26 
	#_STRING_ARCH_uÇligÃd
 1

	)

	@/usr/include/bits/string2.h

21 #iâdeà
_STRING_H


25 #ià!
defšed
 
__NO_STRING_INLINES
 && !defšed 
__BOUNDED_POINTERS__


42 #iâdeà
__STRING_INLINE


43 #ifdeà
__ılu¥lus


44 
	#__STRING_INLINE
 
šlše


	)

46 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

50 #ià
_STRING_ARCH_uÇligÃd


52 
	~<’dŸn.h
>

53 
	~<b™s/ty³s.h
>

55 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


56 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

57 (((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1] << 8 \

58 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
])

	)

59 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

60 (((((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

61 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

62 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

63 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
])

	)

65 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

66 (((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
] << 8 \

67 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1])

	)

68 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

69 (((((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
] << 8 \

70 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

71 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

72 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 3])

	)

77 
	#__STRING2_COPY_TYPE
(
N
) \

78 ¡ruù { 
__¬r
[
N
]; } \

79 
	t__©Œibu‹__
 ((
	t__·cked__
)è
	t__STRING2_COPY_ARR
##
	tN


	)

80 
	t__STRING2_COPY_TYPE
 (2);

81 
__STRING2_COPY_TYPE
 (3);

82 
__STRING2_COPY_TYPE
 (4);

83 
__STRING2_COPY_TYPE
 (5);

84 
__STRING2_COPY_TYPE
 (6);

85 
__STRING2_COPY_TYPE
 (7);

86 
__STRING2_COPY_TYPE
 (8);

87 #undeà
__STRING2_COPY_TYPE


93 
	#__¡ršg2_1b±r_p
(
__x
) \

94 ((
size_t
)(cÚ¡ *)((
__x
è+ 1è- (size_t)(cÚ¡ *)(__xè=ğ1)

	)

97 #ià!
defšed
 
_HAVE_STRING_ARCH_mem£t


98 #ià!
__GNUC_PREREQ
 (3, 0)

99 #ià
_STRING_ARCH_uÇligÃd


100 
	#mem£t
(
s
, 
c
, 
n
) \

101 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

102 ? ((
n
) == 1 \

103 ? 
	`__mem£t_1
 (
s
, 
c
) \

104 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

105 : (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

106 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

107 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

109 
	#__mem£t_1
(
s
, 
c
è({ *
__s
 = (s); \

110 *((
__ušt8_t
 *è
__s
èğ(__ušt8_tè
c
; __s; })

	)

112 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

113 ({ *
__s
 = (
s
); \

115 
__ui
; \

116 
__usi
; \

117 
__uc
; \

118 } *
__u
 = 
__s
; \

119 
__ušt8_t
 
__c
 = (__ušt8_tè(
c
); \

122 (è(
n
)) \

125 
__u
->
__ui
 = 
__c
 * 0x01010101; \

126 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

128 
__u
->
__ui
 = 
__c
 * 0x01010101; \

129 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

131 
__u
->
__ui
 = 
__c
 * 0x01010101; \

132 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

134 
__u
->
__usi
 = (è
__c
 * 0x0101; \

135 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

136 
__u
->
__uc
 = (è
__c
; \

140 
__u
->
__ui
 = 
__c
 * 0x01010101; \

141 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

143 
__u
->
__ui
 = 
__c
 * 0x01010101; \

144 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

146 
__u
->
__ui
 = 
__c
 * 0x01010101; \

147 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

149 
__u
->
__usi
 = (è
__c
 * 0x0101; \

153 
__u
->
__ui
 = 
__c
 * 0x01010101; \

154 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

156 
__u
->
__ui
 = 
__c
 * 0x01010101; \

157 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

159 
__u
->
__ui
 = 
__c
 * 0x01010101; \

160 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

162 
__u
->
__uc
 = (è
__c
; \

166 
__u
->
__ui
 = 
__c
 * 0x01010101; \

167 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

169 
__u
->
__ui
 = 
__c
 * 0x01010101; \

170 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

172 
__u
->
__ui
 = 
__c
 * 0x01010101; \

173 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

175 
__u
->
__ui
 = 
__c
 * 0x01010101; \

180 
__s
; })

	)

182 
	#mem£t
(
s
, 
c
, 
n
) \

183 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

184 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

185 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

194 #ià
__GNUC_PREREQ
 (2, 91)

195 
	#__bz”o
(
s
, 
n
è
	`__butš_mem£t
 (s, '\0',‚)

	)

203 #ifdeà
__USE_GNU


204 #ià!
defšed
 
_HAVE_STRING_ARCH_mempıy
 || defšed 
_FORCE_INLINES


205 #iâdeà
_HAVE_STRING_ARCH_mempıy


206 #ià
__GNUC_PREREQ
 (3, 4)

207 
	#__mempıy
(
de¡
, 
¤c
, 
n
è
	`__butš_mempıy
 (de¡, src,‚)

	)

208 #–ià
__GNUC_PREREQ
 (3, 0)

209 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

210 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

211 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

212 ? 
	`__butš_memıy
 (
de¡
, 
¤c
, 
n
) + (n) \

213 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

215 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

216 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

217 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

218 ? 
	`__mempıy_sm®l
 (
de¡
, 
	`__mempıy_¬gs
 (
¤c
), 
n
) \

219 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

223 
	#mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy
 (de¡, src,‚)

	)

226 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


227 #ià
_STRING_ARCH_uÇligÃd


228 #iâdeà
_FORCE_INLINES


229 
	#__mempıy_¬gs
(
¤c
) \

230 ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[2], \

231 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[6], \

232 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

233 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

234 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

235 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

237 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , , , ,

238 
__ušt16_t
, __ušt16_t, 
__ušt32_t
,

239 
__ušt32_t
, 
size_t
);

240 
__STRING_INLINE
 *

241 
	$__mempıy_sm®l
 (*
__de¡1
,

242 
__¤c0_1
, 
__¤c2_1
, 
__¤c4_1
, 
__¤c6_1
,

243 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

244 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

245 
size_t
 
__¤ş’
)

248 
__ušt32_t
 
__ui
;

249 
__ušt16_t
 
__usi
;

250 
__uc
;

251 
__c
;

252 } *
__u
 = 
__de¡1
;

253 (è
__¤ş’
)

256 
__u
->
__c
 = 
__¤c0_1
;

257 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

260 
__u
->
__usi
 = 
__¤c0_2
;

261 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

264 
__u
->
__usi
 = 
__¤c0_2
;

265 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

266 
__u
->
__c
 = 
__¤c2_1
;

267 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

270 
__u
->
__ui
 = 
__¤c0_4
;

271 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

274 
__u
->
__ui
 = 
__¤c0_4
;

275 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

276 
__u
->
__c
 = 
__¤c4_1
;

277 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

280 
__u
->
__ui
 = 
__¤c0_4
;

281 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

282 
__u
->
__usi
 = 
__¤c4_2
;

283 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

286 
__u
->
__ui
 = 
__¤c0_4
;

287 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

288 
__u
->
__usi
 = 
__¤c4_2
;

289 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

290 
__u
->
__c
 = 
__¤c6_1
;

291 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

294 
__u
->
__ui
 = 
__¤c0_4
;

295 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

296 
__u
->
__ui
 = 
__¤c4_4
;

297 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

300  (*è
__u
;

301 
	}
}

303 #iâdeà
_FORCE_INLINES


304 
	#__mempıy_¬gs
(
¤c
) \

305 ((
__cÚ¡
 *è(
¤c
))[0], \

306 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

307 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1] } }), \

308 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

309 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

310 ((
__cÚ¡
 *è(
¤c
))[2] } }), \

311 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

312 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

313 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3] } }), \

314 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

315 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

316 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

317 ((
__cÚ¡
 *è(
¤c
))[4] } }), \

318 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

319 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

320 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

321 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5] } }), \

322 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

323 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

324 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

325 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

326 ((
__cÚ¡
 *è(
¤c
))[6] } }), \

327 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

328 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

329 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

330 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

331 ((
__cÚ¡
 *è(
¤c
))[6], ((__cÚ¡ *è(¤c))[7] } })

	)

333 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , 
__STRING2_COPY_ARR2
,

334 
__STRING2_COPY_ARR3
,

335 
__STRING2_COPY_ARR4
,

336 
__STRING2_COPY_ARR5
,

337 
__STRING2_COPY_ARR6
,

338 
__STRING2_COPY_ARR7
,

339 
__STRING2_COPY_ARR8
, 
size_t
);

340 
__STRING_INLINE
 *

341 
	$__mempıy_sm®l
 (*
__de¡
, 
__¤c1
,

342 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

343 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

344 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

345 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

348 
__c
;

349 
__STRING2_COPY_ARR2
 
__sÿ2
;

350 
__STRING2_COPY_ARR3
 
__sÿ3
;

351 
__STRING2_COPY_ARR4
 
__sÿ4
;

352 
__STRING2_COPY_ARR5
 
__sÿ5
;

353 
__STRING2_COPY_ARR6
 
__sÿ6
;

354 
__STRING2_COPY_ARR7
 
__sÿ7
;

355 
__STRING2_COPY_ARR8
 
__sÿ8
;

356 } *
__u
 = 
__de¡
;

357 (è
__¤ş’
)

360 
__u
->
__c
 = 
__¤c1
;

363 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

366 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

369 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

372 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

375 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

378 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

381 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

384  
	`__ex‹nsiÚ__
 ((*è
__u
 + 
__¤ş’
);

385 
	}
}

393 #iâdeà
_HAVE_STRING_ARCH_¡rchr


394 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

395 #ià
__GNUC_PREREQ
 (3, 2)

396 
	#¡rchr
(
s
, 
c
) \

397 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
è&& !__butš_cÚ¡ªt_°(
s
) \

398 && (
c
) == '\0' \

399 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

400 : 
	`__butš_¡rchr
 (
s
, 
c
)))

	)

402 
	#¡rchr
(
s
, 
c
) \

403 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

404 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

405 : 
	`¡rchr
 (
s
, 
c
)))

	)

411 #ià(!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)) \

412 || 
defšed
 
	g_FORCE_INLINES


413 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)

414 
	#¡rıy
(
de¡
, 
¤c
) \

415 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

416 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

417 ? 
	`__¡rıy_sm®l
 (
de¡
, 
	`__¡rıy_¬gs
 (
¤c
), \

418 
	`¡¾’
 (
¤c
) + 1) \

419 : (*è
	`memıy
 (
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1)) \

420 : 
	`¡rıy
 (
de¡
, 
¤c
)))

	)

423 #ià
_STRING_ARCH_uÇligÃd


424 #iâdeà
_FORCE_INLINES


425 
	#__¡rıy_¬gs
(
¤c
) \

426 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

427 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

428 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

429 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

431 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

432 
__ušt32_t
, __ušt32_t, 
size_t
);

433 
__STRING_INLINE
 *

434 
	$__¡rıy_sm®l
 (*
__de¡
,

435 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

436 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

437 
size_t
 
__¤ş’
)

440 
__ušt32_t
 
__ui
;

441 
__ušt16_t
 
__usi
;

442 
__uc
;

443 } *
__u
 = (*è
__de¡
;

444 (è
__¤ş’
)

447 
__u
->
__uc
 = '\0';

450 
__u
->
__usi
 = 
__¤c0_2
;

453 
__u
->
__usi
 = 
__¤c0_2
;

454 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

455 
__u
->
__uc
 = '\0';

458 
__u
->
__ui
 = 
__¤c0_4
;

461 
__u
->
__ui
 = 
__¤c0_4
;

462 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

463 
__u
->
__uc
 = '\0';

466 
__u
->
__ui
 = 
__¤c0_4
;

467 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

468 
__u
->
__usi
 = 
__¤c4_2
;

471 
__u
->
__ui
 = 
__¤c0_4
;

472 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

473 
__u
->
__usi
 = 
__¤c4_2
;

474 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

475 
__u
->
__uc
 = '\0';

478 
__u
->
__ui
 = 
__¤c0_4
;

479 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

480 
__u
->
__ui
 = 
__¤c4_4
;

483  
__de¡
;

484 
	}
}

486 #iâdeà
_FORCE_INLINES


487 
	#__¡rıy_¬gs
(
¤c
) \

488 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

489 { { ((
__cÚ¡
 *è(
¤c
))[0], '\0' } }), \

490 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

491 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

493 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

494 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

495 ((
__cÚ¡
 *è(
¤c
))[2], '\0' } }), \

496 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

497 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

498 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

500 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

501 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

502 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

503 ((
__cÚ¡
 *è(
¤c
))[4], '\0' } }), \

504 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

505 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

506 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

507 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

509 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

510 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

511 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

512 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

513 ((
__cÚ¡
 *è(
¤c
))[6], '\0' } })

	)

515 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

516 
__STRING2_COPY_ARR3
,

517 
__STRING2_COPY_ARR4
,

518 
__STRING2_COPY_ARR5
,

519 
__STRING2_COPY_ARR6
,

520 
__STRING2_COPY_ARR7
,

521 
__STRING2_COPY_ARR8
, 
size_t
);

522 
__STRING_INLINE
 *

523 
	$__¡rıy_sm®l
 (*
__de¡
,

524 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

525 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

526 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

527 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

530 
__c
;

531 
__STRING2_COPY_ARR2
 
__sÿ2
;

532 
__STRING2_COPY_ARR3
 
__sÿ3
;

533 
__STRING2_COPY_ARR4
 
__sÿ4
;

534 
__STRING2_COPY_ARR5
 
__sÿ5
;

535 
__STRING2_COPY_ARR6
 
__sÿ6
;

536 
__STRING2_COPY_ARR7
 
__sÿ7
;

537 
__STRING2_COPY_ARR8
 
__sÿ8
;

538 } *
__u
 = (*è
__de¡
;

539 (è
__¤ş’
)

542 
__u
->
__c
 = '\0';

545 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

548 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

551 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

554 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

557 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

560 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

563 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

566  
__de¡
;

567 
	}
}

573 #ifdeà
__USE_GNU


574 #ià!
defšed
 
_HAVE_STRING_ARCH_¡pıy
 || defšed 
_FORCE_INLINES


575 #iâdeà
_HAVE_STRING_ARCH_¡pıy


576 #ià
__GNUC_PREREQ
 (3, 4)

577 
	#__¡pıy
(
de¡
, 
¤c
è
	`__butš_¡pıy
 (de¡, src)

	)

578 #–ià
__GNUC_PREREQ
 (3, 0)

579 
	#__¡pıy
(
de¡
, 
¤c
) \

580 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

581 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

582 ? 
	`__butš_¡rıy
 (
de¡
, 
¤c
è+ 
	`¡¾’
 (src) \

583 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

585 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

587 
	#__¡pıy
(
de¡
, 
¤c
) \

588 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

589 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

590 ? 
	`__¡pıy_sm®l
 (
de¡
, 
	`__¡pıy_¬gs
 (
¤c
), \

591 
	`¡¾’
 (
¤c
) + 1) \

592 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

594 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

598 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 (de¡, src)

	)

601 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


602 #ià
_STRING_ARCH_uÇligÃd


603 #iâdeà
_FORCE_INLINES


604 
	#__¡pıy_¬gs
(
¤c
) \

605 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

606 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

607 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

608 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

610 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

611 
__ušt32_t
, __ušt32_t, 
size_t
);

612 
__STRING_INLINE
 *

613 
	$__¡pıy_sm®l
 (*
__de¡
,

614 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

615 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

616 
size_t
 
__¤ş’
)

619 
__ui
;

620 
__usi
;

621 
__uc
;

622 
__c
;

623 } *
__u
 = (*è
__de¡
;

624 (è
__¤ş’
)

627 
__u
->
__uc
 = '\0';

630 
__u
->
__usi
 = 
__¤c0_2
;

631 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

634 
__u
->
__usi
 = 
__¤c0_2
;

635 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

636 
__u
->
__uc
 = '\0';

639 
__u
->
__ui
 = 
__¤c0_4
;

640 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

643 
__u
->
__ui
 = 
__¤c0_4
;

644 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

645 
__u
->
__uc
 = '\0';

648 
__u
->
__ui
 = 
__¤c0_4
;

649 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

650 
__u
->
__usi
 = 
__¤c4_2
;

651 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

654 
__u
->
__ui
 = 
__¤c0_4
;

655 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

656 
__u
->
__usi
 = 
__¤c4_2
;

657 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

658 
__u
->
__uc
 = '\0';

661 
__u
->
__ui
 = 
__¤c0_4
;

662 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

663 
__u
->
__ui
 = 
__¤c4_4
;

664 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

667  &
__u
->
__c
;

668 
	}
}

670 #iâdeà
_FORCE_INLINES


671 
	#__¡pıy_¬gs
(
¤c
) \

672 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

673 { { ((
__cÚ¡
 *è(
¤c
))[0], '\0' } }), \

674 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

675 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

677 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

678 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

679 ((
__cÚ¡
 *è(
¤c
))[2], '\0' } }), \

680 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

681 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

682 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

684 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

685 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

686 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

687 ((
__cÚ¡
 *è(
¤c
))[4], '\0' } }), \

688 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

689 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

690 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

691 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

693 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

694 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

695 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

696 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

697 ((
__cÚ¡
 *è(
¤c
))[6], '\0' } })

	)

699 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

700 
__STRING2_COPY_ARR3
,

701 
__STRING2_COPY_ARR4
,

702 
__STRING2_COPY_ARR5
,

703 
__STRING2_COPY_ARR6
,

704 
__STRING2_COPY_ARR7
,

705 
__STRING2_COPY_ARR8
, 
size_t
);

706 
__STRING_INLINE
 *

707 
	$__¡pıy_sm®l
 (*
__de¡
,

708 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

709 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

710 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

711 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

714 
__c
;

715 
__STRING2_COPY_ARR2
 
__sÿ2
;

716 
__STRING2_COPY_ARR3
 
__sÿ3
;

717 
__STRING2_COPY_ARR4
 
__sÿ4
;

718 
__STRING2_COPY_ARR5
 
__sÿ5
;

719 
__STRING2_COPY_ARR6
 
__sÿ6
;

720 
__STRING2_COPY_ARR7
 
__sÿ7
;

721 
__STRING2_COPY_ARR8
 
__sÿ8
;

722 } *
__u
 = (*è
__de¡
;

723 (è
__¤ş’
)

726 
__u
->
__c
 = '\0';

729 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

732 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

735 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

738 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

741 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

744 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

747 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

750  
__de¡
 + 
__¤ş’
 - 1;

751 
	}
}

759 #iâdeà
_HAVE_STRING_ARCH_¡ºıy


760 #ià
__GNUC_PREREQ
 (3, 2)

761 
	#¡ºıy
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºıy
 (de¡, src,‚)

	)

763 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

764 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

765 ? (
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

766 ? (*è
	`memıy
 (
de¡
, 
¤c
, 
n
) \

767 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)) \

768 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)))

	)

774 #iâdeà
_HAVE_STRING_ARCH_¡ºÿt


775 #ifdeà
_USE_STRING_ARCH_¡rchr


776 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

777 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

778 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

779 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

780 ? 
	`¡rÿt
 (
__de¡
, 
¤c
) \

781 : (*((*è
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

782 
¤c
, 
n
)èğ'\0', 
__de¡
)) \

783 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
); }))

	)

784 #–ià
__GNUC_PREREQ
 (3, 2)

785 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºÿt
 (de¡, src,‚)

	)

787 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

788 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

789 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

790 ? 
	`¡rÿt
 (
de¡
, 
¤c
) \

791 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)) \

792 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)))

	)

798 #iâdeà
_HAVE_STRING_ARCH_¡rcmp


799 #ià
__GNUC_PREREQ
 (3, 2)

800 
	#¡rcmp
(
s1
, 
s2
) \

801 
__ex‹nsiÚ__
 \

802 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

803 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

804 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

805 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

806 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

807 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

808 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

809 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

810 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

811 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

812 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

813 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

814 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

815 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

816 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

817 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

818 : 
	`__butš_¡rcmp
 (
s1
, 
s2
)))); })

	)

820 
	#¡rcmp
(
s1
, 
s2
) \

821 
__ex‹nsiÚ__
 \

822 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

823 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

824 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

825 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

826 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

827 ? 
	`memcmp
 ((
__cÚ¡
 *è(
s1
), (__cÚ¡ *è(
s2
), \

828 (
__s1_Ën
 < 
__s2_Ën
 ? __s1_len : __s2_len) + 1) \

829 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

830 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

831 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

832 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s1_Ën
) \

833 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

834 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

835 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

836 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

837 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s2_Ën
) \

838 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

839 : 
	`¡rcmp
 (
s1
, 
s2
)))); })

	)

842 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

843 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = \

844 (((
__cÚ¡
 *è(__cÚ¡ *è(
s1
))[0] \

845 - ((
__cÚ¡
 *è(__cÚ¡ *)(
s2
))[0]);\

846 ià(
l
 > 0 && 
__»suÉ
 == 0) \

848 
__»suÉ
 = (((
__cÚ¡
 *) \

849 (
__cÚ¡
 *è(
s1
))[1] \

850 - ((
__cÚ¡
 *) \

851 (
__cÚ¡
 *è(
s2
))[1]); \

852 ià(
l
 > 1 && 
__»suÉ
 == 0) \

854 
__»suÉ
 = \

855 (((
__cÚ¡
 *) \

856 (
__cÚ¡
 *è(
s1
))[2] \

857 - ((
__cÚ¡
 *) \

858 (
__cÚ¡
 *è(
s2
))[2]); \

859 ià(
l
 > 2 && 
__»suÉ
 == 0) \

860 
__»suÉ
 = \

861 (((
__cÚ¡
 *) \

862 (
__cÚ¡
 *è(
s1
))[3] \

863 - ((
__cÚ¡
 *) \

864 (
__cÚ¡
 *è(
s2
))[3]); \

867 
__»suÉ
; }))

	)

869 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

870 (
	`__ex‹nsiÚ__
 ({ 
__cÚ¡
 *
__s2
 = \

871 (
__cÚ¡
 *è(__cÚ¡ *è(
s2
); \

872 
__»suÉ
 = \

873 (((
__cÚ¡
 *è(__cÚ¡ *è(
s1
))[0] \

874 - 
__s2
[0]); \

875 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

877 
__»suÉ
 = (((
__cÚ¡
 *) \

878 (
__cÚ¡
 *è(
s1
))[1] - 
__s2
[1]); \

879 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

881 
__»suÉ
 = (((
__cÚ¡
 *) \

882 (
__cÚ¡
 *è(
s1
))[2] - 
__s2
[2]);\

883 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

884 
__»suÉ
 = (((
__cÚ¡
 *) \

885 (
__cÚ¡
 *è(
s1
))[3] \

886 - 
__s2
[3]); \

889 
__»suÉ
; }))

	)

891 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

892 (
	`__ex‹nsiÚ__
 ({ 
__cÚ¡
 *
__s1
 = \

893 (
__cÚ¡
 *è(__cÚ¡ *è(
s1
); \

894 
__»suÉ
 = \

895 
__s1
[0] - ((
__cÚ¡
 *) \

896 (
__cÚ¡
 *è(
s2
))[0]; \

897 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

899 
__»suÉ
 = (
__s1
[1] \

900 - ((
__cÚ¡
 *) \

901 (
__cÚ¡
 *è(
s2
))[1]); \

902 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

904 
__»suÉ
 = \

905 (
__s1
[2] - ((
__cÚ¡
 *) \

906 (
__cÚ¡
 *è(
s2
))[2]); \

907 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

908 
__»suÉ
 = \

909 (
__s1
[3] \

910 - ((
__cÚ¡
 *) \

911 (
__cÚ¡
 *è(
s2
))[3]); \

914 
__»suÉ
; }))

	)

919 #iâdeà
_HAVE_STRING_ARCH_¡ºcmp


920 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

921 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

922 && ((
	`__butš_cÚ¡ªt_p
 (
s1
) \

923 && 
	`¡¾’
 (
s1
è< ((
size_t
è(
n
))) \

924 || (
	`__butš_cÚ¡ªt_p
 (
s2
) \

925 && 
	`¡¾’
 (
s2
è< ((
size_t
è(
n
)))) \

926 ? 
	`¡rcmp
 (
s1
, 
s2
è: 
	`¡ºcmp
 (s1, s2, 
n
)))

	)

932 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rc¥n
 || defšed 
_FORCE_INLINES


933 #iâdeà
_HAVE_STRING_ARCH_¡rc¥n


934 #ià
__GNUC_PREREQ
 (3, 2)

935 
	#¡rc¥n
(
s
, 
»jeù
) \

936 
__ex‹nsiÚ__
 \

937 ({ 
__r0
, 
__r1
, 
__r2
; \

938 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

939 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

940 ? 
	`__butš_¡rc¥n
 (
s
, 
»jeù
) \

941 : ((
__r0
 = ((
__cÚ¡
 *è(
»jeù
))[0], __r0 == '\0') \

942 ? 
	`¡¾’
 (
s
) \

943 : ((
__r1
 = ((
__cÚ¡
 *è(
»jeù
))[1], __r1 == '\0') \

944 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

945 : ((
__r2
 = ((
__cÚ¡
 *è(
»jeù
))[2], __r2 == '\0') \

946 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

947 : (((
__cÚ¡
 *è(
»jeù
))[3] == '\0' \

948 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

949 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)))))) \

950 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)); })

	)

952 
	#¡rc¥n
(
s
, 
»jeù
) \

953 
__ex‹nsiÚ__
 \

954 ({ 
__r0
, 
__r1
, 
__r2
; \

955 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

956 ? ((
__r0
 = ((
__cÚ¡
 *è(
»jeù
))[0], __r0 == '\0') \

957 ? 
	`¡¾’
 (
s
) \

958 : ((
__r1
 = ((
__cÚ¡
 *è(
»jeù
))[1], __r1 == '\0') \

959 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

960 : ((
__r2
 = ((
__cÚ¡
 *è(
»jeù
))[2], __r2 == '\0') \

961 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

962 : (((
__cÚ¡
 *è(
»jeù
))[3] == '\0' \

963 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

964 : 
	`¡rc¥n
 (
s
, 
»jeù
))))) \

965 : 
	`¡rc¥n
 (
s
, 
»jeù
)); })

	)

969 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (
__cÚ¡
 *
__s
, 
__»jeù
);

970 
__STRING_INLINE
 
size_t


971 
	$__¡rc¥n_c1
 (
__cÚ¡
 *
__s
, 
__»jeù
)

973 
size_t
 
__»suÉ
 = 0;

974 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù
)

975 ++
__»suÉ
;

976  
__»suÉ
;

977 
	}
}

979 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c2
 (
__cÚ¡
 *
__s
, 
__»jeù1
,

980 
__»jeù2
);

981 
__STRING_INLINE
 
size_t


982 
	$__¡rc¥n_c2
 (
__cÚ¡
 *
__s
, 
__»jeù1
, 
__»jeù2
)

984 
size_t
 
__»suÉ
 = 0;

985 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


986 && 
__s
[
__»suÉ
] !ğ
__»jeù2
)

987 ++
__»suÉ
;

988  
__»suÉ
;

989 
	}
}

991 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c3
 (
__cÚ¡
 *
__s
, 
__»jeù1
,

992 
__»jeù2
, 
__»jeù3
);

993 
__STRING_INLINE
 
size_t


994 
	$__¡rc¥n_c3
 (
__cÚ¡
 *
__s
, 
__»jeù1
, 
__»jeù2
,

995 
__»jeù3
)

997 
size_t
 
__»suÉ
 = 0;

998 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


999 && 
__s
[
__»suÉ
] !ğ
__»jeù2
 && __s[__»suÉ] !ğ
__»jeù3
)

1000 ++
__»suÉ
;

1001  
__»suÉ
;

1002 
	}
}

1008 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¥n
 || defšed 
_FORCE_INLINES


1009 #iâdeà
_HAVE_STRING_ARCH_¡r¥n


1010 #ià
__GNUC_PREREQ
 (3, 2)

1011 
	#¡r¥n
(
s
, 
acû±
) \

1012 
__ex‹nsiÚ__
 \

1013 ({ 
__a0
, 
__a1
, 
__a2
; \

1014 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1015 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1016 ? 
	`__butš_¡r¥n
 (
s
, 
acû±
) \

1017 : ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1018 ? ((è(
s
), 0) \

1019 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1020 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1021 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1022 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1023 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1024 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1025 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)))))) \

1026 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)); })

	)

1028 
	#¡r¥n
(
s
, 
acû±
) \

1029 
__ex‹nsiÚ__
 \

1030 ({ 
__a0
, 
__a1
, 
__a2
; \

1031 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1032 ? ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1033 ? ((è(
s
), 0) \

1034 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1035 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1036 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1037 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1038 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1039 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1040 : 
	`¡r¥n
 (
s
, 
acû±
))))) \

1041 : 
	`¡r¥n
 (
s
, 
acû±
)); })

	)

1045 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (
__cÚ¡
 *
__s
, 
__acû±
);

1046 
__STRING_INLINE
 
size_t


1047 
	$__¡r¥n_c1
 (
__cÚ¡
 *
__s
, 
__acû±
)

1049 
size_t
 
__»suÉ
 = 0;

1051 
__s
[
__»suÉ
] =ğ
__acû±
)

1052 ++
__»suÉ
;

1053  
__»suÉ
;

1054 
	}
}

1056 
__STRING_INLINE
 
size_t
 
__¡r¥n_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1057 
__acû±2
);

1058 
__STRING_INLINE
 
size_t


1059 
	$__¡r¥n_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
)

1061 
size_t
 
__»suÉ
 = 0;

1063 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2
)

1064 ++
__»suÉ
;

1065  
__»suÉ
;

1066 
	}
}

1068 
__STRING_INLINE
 
size_t
 
__¡r¥n_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1069 
__acû±2
, 
__acû±3
);

1070 
__STRING_INLINE
 
size_t


1071 
	$__¡r¥n_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1073 
size_t
 
__»suÉ
 = 0;

1075 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2


1076 || 
__s
[
__»suÉ
] =ğ
__acû±3
)

1077 ++
__»suÉ
;

1078  
__»suÉ
;

1079 
	}
}

1084 #ià!
defšed
 
_HAVE_STRING_ARCH_¡½brk
 || defšed 
_FORCE_INLINES


1085 #iâdeà
_HAVE_STRING_ARCH_¡½brk


1086 #ià
__GNUC_PREREQ
 (3, 2)

1087 
	#¡½brk
(
s
, 
acû±
) \

1088 
__ex‹nsiÚ__
 \

1089 ({ 
__a0
, 
__a1
, 
__a2
; \

1090 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1091 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1092 ? 
	`__butš_¡½brk
 (
s
, 
acû±
) \

1093 : ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1094 ? ((è(
s
), (*è
NULL
) \

1095 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1096 ? 
	`__butš_¡rchr
 (
s
, 
__a0
) \

1097 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1098 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1099 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1100 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1101 : 
	`__butš_¡½brk
 (
s
, 
acû±
)))))) \

1102 : 
	`__butš_¡½brk
 (
s
, 
acû±
)); })

	)

1104 
	#¡½brk
(
s
, 
acû±
) \

1105 
__ex‹nsiÚ__
 \

1106 ({ 
__a0
, 
__a1
, 
__a2
; \

1107 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1108 ? ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1109 ? ((è(
s
), (*è
NULL
) \

1110 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1111 ? 
	`¡rchr
 (
s
, 
__a0
) \

1112 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1113 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1114 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1115 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1116 : 
	`¡½brk
 (
s
, 
acû±
))))) \

1117 : 
	`¡½brk
 (
s
, 
acû±
)); })

	)

1121 
__STRING_INLINE
 *
__¡½brk_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1122 
__acû±2
);

1123 
__STRING_INLINE
 *

1124 
	$__¡½brk_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
)

1127 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2
)

1128 ++
__s
;

1129  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1130 
	}
}

1132 
__STRING_INLINE
 *
__¡½brk_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1133 
__acû±2
, 
__acû±3
);

1134 
__STRING_INLINE
 *

1135 
	$__¡½brk_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
,

1136 
__acû±3
)

1139 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2


1140 && *
__s
 !ğ
__acû±3
)

1141 ++
__s
;

1142  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1143 
	}
}

1149 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¡r
 && !
__GNUC_PREREQ
 (2, 97)

1150 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1151 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
è&& 
	`__¡ršg2_1b±r_p
 (needle) \

1152 ? (((
__cÚ¡
 *è(
ÃedË
))[0] == '\0' \

1153 ? (*è(
size_t
è(
hay¡ack
) \

1154 : (((
__cÚ¡
 *è(
ÃedË
))[1] == '\0' \

1155 ? 
	`¡rchr
 (
hay¡ack
, \

1156 ((
__cÚ¡
 *è(
ÃedË
))[0]) \

1157 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
))) \

1158 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
)))

	)

1162 #ià!
defšed
 
_HAVE_STRING_ARCH_¡¹ok_r
 || defšed 
_FORCE_INLINES


1163 #iâdeà
_HAVE_STRING_ARCH_¡¹ok_r


1164 
	#__¡¹ok_r
(
s
, 
£p
, 
Ãx
) \

1165 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
£p
è&& 
	`__¡ršg2_1b±r_p
 (sep) \

1166 && ((
__cÚ¡
 *è(
£p
))[0] != '\0' \

1167 && ((
__cÚ¡
 *è(
£p
))[1] == '\0' \

1168 ? 
	`__¡¹ok_r_1c
 (
s
, ((
__cÚ¡
 *è(
£p
))[0], 
Ãx
) \

1169 : 
	`__¡¹ok_r
 (
s
, 
£p
, 
Ãx
)))

	)

1172 
__STRING_INLINE
 *
__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
);

1173 
__STRING_INLINE
 *

1174 
	$__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
)

1176 *
__»suÉ
;

1177 ià(
__s
 =ğ
NULL
)

1178 
__s
 = *
__Ãx
;

1179 *
__s
 =ğ
__£p
)

1180 ++
__s
;

1181 
__»suÉ
 = 
NULL
;

1182 ià(*
__s
 != '\0')

1184 
__»suÉ
 = 
__s
++;

1185 *
__s
 != '\0')

1186 ià(*
__s
++ =ğ
__£p
)

1188 
__s
[-1] = '\0';

1192 *
__Ãx
 = 
__s
;

1193  
__»suÉ
;

1194 
	}
}

1195 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


1196 
	#¡¹ok_r
(
s
, 
£p
, 
Ãx
è
	`__¡¹ok_r
 (s, s•,‚ex)

	)

1201 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r£p
 || defšed 
_FORCE_INLINES


1202 #iâdeà
_HAVE_STRING_ARCH_¡r£p


1204 *
__¡r£p_g
 (**
__¡ršgp
, 
__cÚ¡
 *
__d–im
);

1205 
	#__¡r£p
(
s
, 
»jeù
) \

1206 
__ex‹nsiÚ__
 \

1207 ({ 
__r0
, 
__r1
, 
__r2
; \

1208 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

1209 && (
__r0
 = ((
__cÚ¡
 *è(
»jeù
))[0], \

1210 ((
__cÚ¡
 *è(
»jeù
))[0] != '\0') \

1211 ? ((
__r1
 = ((
__cÚ¡
 *è(
»jeù
))[1], \

1212 ((
__cÚ¡
 *è(
»jeù
))[1] == '\0') \

1213 ? 
	`__¡r£p_1c
 (
s
, 
__r0
) \

1214 : ((
__r2
 = ((
__cÚ¡
 *è(
»jeù
))[2], __r2 == '\0') \

1215 ? 
	`__¡r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1216 : (((
__cÚ¡
 *è(
»jeù
))[3] == '\0' \

1217 ? 
	`__¡r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1218 : 
	`__¡r£p_g
 (
s
, 
»jeù
)))) \

1219 : 
	`__¡r£p_g
 (
s
, 
»jeù
)); })

	)

1222 
__STRING_INLINE
 *
__¡r£p_1c
 (**
__s
, 
__»jeù
);

1223 
__STRING_INLINE
 *

1224 
	$__¡r£p_1c
 (**
__s
, 
__»jeù
)

1226 *
__»tv®
 = *
__s
;

1227 ià(
__»tv®
 !ğ
NULL
 && (*
__s
 = 
	`¡rchr
 (__»tv®, 
__»jeù
)) != NULL)

1228 *(*
__s
)++ = '\0';

1229  
__»tv®
;

1230 
	}
}

1232 
__STRING_INLINE
 *
__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
);

1233 
__STRING_INLINE
 *

1234 
	$__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
)

1236 *
__»tv®
 = *
__s
;

1237 ià(
__»tv®
 !ğ
NULL
)

1239 *
__ı
 = 
__»tv®
;

1242 ià(*
__ı
 == '\0')

1244 
__ı
 = 
NULL
;

1247 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
)

1249 *
__ı
++ = '\0';

1252 ++
__ı
;

1254 *
__s
 = 
__ı
;

1256  
__»tv®
;

1257 
	}
}

1259 
__STRING_INLINE
 *
__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
,

1260 
__»jeù3
);

1261 
__STRING_INLINE
 *

1262 
	$__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
, 
__»jeù3
)

1264 *
__»tv®
 = *
__s
;

1265 ià(
__»tv®
 !ğ
NULL
)

1267 *
__ı
 = 
__»tv®
;

1270 ià(*
__ı
 == '\0')

1272 
__ı
 = 
NULL
;

1275 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
 || *__ı =ğ
__»jeù3
)

1277 *
__ı
++ = '\0';

1280 ++
__ı
;

1282 *
__s
 = 
__ı
;

1284  
__»tv®
;

1285 
	}
}

1286 #ifdeà
__USE_BSD


1287 
	#¡r£p
(
s
, 
»jeù
è
	`__¡r£p
 (s,„ejeù)

	)

1294 #ifdeà
__USE_MISC


1296 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rdup
 || !defšed 
_HAVE_STRING_ARCH_¡ºdup


1297 
	#__Ãed_m®loc_ªd_ÿÎoc


	)

1298 
	~<¡dlib.h
>

1301 #iâdeà
_HAVE_STRING_ARCH_¡rdup


1303 *
	$__¡rdup
 (
__cÚ¡
 *
__¡ršg
è
__THROW
 
__©Œibu‹_m®loc__
;

1304 
	#__¡rdup
(
s
) \

1305 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1306 ? (((
__cÚ¡
 *è(
s
))[0] == '\0' \

1307 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1308 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1309 *
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1310 ià(
__»tv®
 !ğ
NULL
) \

1311 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, 
__Ën
); \

1312 
__»tv®
; 
	}
})) \

1313 : 
	`__¡rdup
 (
s
)))

	)

1315 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1316 
	#¡rdup
(
s
è
	`__¡rdup
 (s)

	)

1320 #iâdeà
_HAVE_STRING_ARCH_¡ºdup


1322 *
	$__¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

1323 
__THROW
 
__©Œibu‹_m®loc__
;

1324 
	#__¡ºdup
(
s
, 
n
) \

1325 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1326 ? (((
__cÚ¡
 *è(
s
))[0] == '\0' \

1327 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1328 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1329 
size_t
 
__n
 = (
n
); \

1330 *
__»tv®
; \

1331 ià(
__n
 < 
__Ën
) \

1332 
__Ën
 = 
__n
 + 1; \

1333 
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1334 ià(
__»tv®
 !ğ
NULL
) \

1336 
__»tv®
[
__Ën
 - 1] = '\0'; \

1337 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, \

1338 
__Ën
 - 1); \

1340 
__»tv®
; 
	}
})) \

1341 : 
	`__¡ºdup
 (
s
, 
n
)))

	)

1343 #ifdeà
__USE_GNU


1344 
	#¡ºdup
(
s
, 
n
è
	`__¡ºdup
 (s,‚)

	)

1350 #iâdeà
_FORCE_INLINES


1351 #undeà
__STRING_INLINE


	@/usr/include/bits/string3.h

19 #iâdeà
_STRING_H


23 
__w¬ndeş
 (
__w¬n_mem£t_z”o_Ën
,

26 #iâdeà
__ılu¥lus


30 #undeà
memıy


31 #undeà
memmove


32 #undeà
mem£t


33 #undeà
¡rÿt


34 #undeà
¡rıy


35 #undeà
¡ºÿt


36 #undeà
¡ºıy


37 #ifdeà
__USE_GNU


38 #undeà
mempıy


39 #undeà
¡pıy


41 #ifdeà
__USE_BSD


42 #undeà
bcİy


43 #undeà
bz”o


48 
__ex‹º_®ways_šlše
 *

49 
__NTH
 (
	$memıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

50 
size_t
 
__Ën
))

52  
	`__butš___memıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

53 
	}
}

55 
__ex‹º_®ways_šlše
 *

56 
__NTH
 (
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__Ën
))

58  
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

59 
	}
}

61 #ifdeà
__USE_GNU


62 
__ex‹º_®ways_šlše
 *

63 
__NTH
 (
	$mempıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

64 
size_t
 
__Ën
))

66  
	`__butš___mempıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

67 
	}
}

76 
__ex‹º_®ways_šlše
 *

77 
__NTH
 (
	$mem£t
 (*
__de¡
, 
__ch
, 
size_t
 
__Ën
))

79 ià(
	`__butš_cÚ¡ªt_p
 (
__Ën
) && __len == 0

80 && (!
	`__butš_cÚ¡ªt_p
 (
__ch
) || __ch != 0))

82 
	`__w¬n_mem£t_z”o_Ën
 ();

83  
__de¡
;

85  
	`__butš___mem£t_chk
 (
__de¡
, 
__ch
, 
__Ën
, 
	`__bos0
 (__dest));

86 
	}
}

88 #ifdeà
__USE_BSD


89 
__ex‹º_®ways_šlše
 

90 
__NTH
 (
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__Ën
))

92 (è
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

93 
	}
}

95 
__ex‹º_®ways_šlše
 

96 
__NTH
 (
	$bz”o
 (*
__de¡
, 
size_t
 
__Ën
))

98 (è
	`__butš___mem£t_chk
 (
__de¡
, '\0', 
__Ën
, 
	`__bos0
 (__dest));

99 
	}
}

102 
__ex‹º_®ways_šlše
 *

103 
__NTH
 (
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
))

105  
	`__butš___¡rıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

106 
	}
}

108 #ifdeà
__USE_GNU


109 
__ex‹º_®ways_šlše
 *

110 
__NTH
 (
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
))

112  
	`__butš___¡pıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

113 
	}
}

117 
__ex‹º_®ways_šlše
 *

118 
__NTH
 (
	$¡ºıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

119 
size_t
 
__Ën
))

121  
	`__butš___¡ºıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

122 
	}
}

125 *
	$__¡²ıy_chk
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

126 
size_t
 
__de¡Ën
è
__THROW
;

127 *
	`__REDIRECT_NTH
 (
__¡²ıy_®Ÿs
, (*
__de¡
,

128 
__cÚ¡
 *
__¤c
,

129 
size_t
 
__n
), 
¡²ıy
);

131 
__ex‹º_®ways_šlše
 *

132 
	`__NTH
 (
	$¡²ıy
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
))

134 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1

135 && (!
	`__butš_cÚ¡ªt_p
 (
__n
è|| __À<ğ
	`__bos
 (
__de¡
)))

136  
	`__¡²ıy_chk
 (
__de¡
, 
__¤c
, 
__n
, 
	`__bos
 (__dest));

137  
	`__¡²ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

138 
	}
}

141 
__ex‹º_®ways_šlše
 *

142 
__NTH
 (
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
))

144  
	`__butš___¡rÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

145 
	}
}

148 
__ex‹º_®ways_šlše
 *

149 
__NTH
 (
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

150 
size_t
 
__Ën
))

152  
	`__butš___¡ºÿt_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

153 
	}
}

	@/usr/include/bits/sys_errlist.h

20 #iâdeà
_STDIO_H


26 #ifdeà 
__USE_BSD


27 
sys_Ã¼
;

28 
__cÚ¡
 *__cÚ¡ 
sys_”¾i¡
[];

30 #ifdeà 
__USE_GNU


31 
_sys_Ã¼
;

32 
__cÚ¡
 *__cÚ¡ 
_sys_”¾i¡
[];

	@/usr/include/bits/types.h

24 #iâdef 
_BITS_TYPES_H


25 
	#_BITS_TYPES_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	t__u_ch¬
;

32 
	t__u_shÜt
;

33 
	t__u_št
;

34 
	t__u_lÚg
;

37 sigÃd 
	t__št8_t
;

38 
	t__ušt8_t
;

39 sigÃd 
	t__št16_t
;

40 
	t__ušt16_t
;

41 sigÃd 
	t__št32_t
;

42 
	t__ušt32_t
;

43 #ià
__WORDSIZE
 == 64

44 sigÃd 
	t__št64_t
;

45 
	t__ušt64_t
;

46 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


47 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

48 
__ex‹nsiÚ__
 
	t__ušt64_t
;

52 #ià
__WORDSIZE
 == 64

53 
	t__quad_t
;

54 
	t__u_quad_t
;

55 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


56 
__ex‹nsiÚ__
 
	t__quad_t
;

57 
__ex‹nsiÚ__
 
	t__u_quad_t
;

61 
	m__v®
[2];

62 } 
	t__quad_t
;

65 
__u_lÚg
 
	m__v®
[2];

66 } 
	t__u_quad_t
;

99 
	#__S16_TYPE
 

	)

100 
	#__U16_TYPE
 

	)

101 
	#__S32_TYPE
 

	)

102 
	#__U32_TYPE
 

	)

103 
	#__SLONGWORD_TYPE
 

	)

104 
	#__ULONGWORD_TYPE
 

	)

105 #ià
__WORDSIZE
 == 32

106 
	#__SQUAD_TYPE
 
__quad_t


	)

107 
	#__UQUAD_TYPE
 
__u_quad_t


	)

108 
	#__SWORD_TYPE
 

	)

109 
	#__UWORD_TYPE
 

	)

110 
	#__SLONG32_TYPE
 

	)

111 
	#__ULONG32_TYPE
 

	)

112 
	#__S64_TYPE
 
__quad_t


	)

113 
	#__U64_TYPE
 
__u_quad_t


	)

116 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

117 #–ià
__WORDSIZE
 == 64

118 
	t__SQUAD_TYPE
 

	)

119 
	t__UQUAD_TYPE
 

	)

120 
	t__SWORD_TYPE
 

	)

121 
	t__UWORD_TYPE
 

	)

122 
	t__SLONG32_TYPE
 

	)

123 
	t__ULONG32_TYPE
 

	)

124 
	t__S64_TYPE
 

	)

125 
	t__U64_TYPE
 

	)

127 
	t__STD_TYPE
 

	)

131 
	~<b™s/ty³sizes.h
>

134 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

135 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

136 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

137 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

138 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

139 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

140 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

141 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

142 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

143 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

144 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

145 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

146 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

147 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

148 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

149 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

150 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

151 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

153 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

154 
__STD_TYPE
 
__SWBLK_T_TYPE
 
	g__swblk_t
;

155 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

158 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

161 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

164 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

169 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

170 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

173 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

174 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

177 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

178 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

180 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__off64_t
 
	t__loff_t
;

185 
__quad_t
 *
	t__qaddr_t
;

186 *
	t__ÿddr_t
;

189 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

192 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

195 #undeà
__STD_TYPE


	@/usr/include/bits/waitflags.h

20 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


26 
	#WNOHANG
 1

	)

27 
	#WUNTRACED
 2

	)

30 
	#WSTOPPED
 2

	)

31 
	#WEXITED
 4

	)

32 
	#WCONTINUED
 8

	)

33 
	#WNOWAIT
 0x01000000

	)

35 
	#__WNOTHREAD
 0x20000000

	)

37 
	#__WALL
 0x40000000

	)

38 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

20 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


29 
	#__WEXITSTATUS
(
¡©us
è(((¡©usè& 0xff00è>> 8)

	)

32 
	#__WTERMSIG
(
¡©us
è((¡©usè& 0x7f)

	)

35 
	#__WSTOPSIG
(
¡©us
è
	`__WEXITSTATUS
(¡©us)

	)

38 
	#__WIFEXITED
(
¡©us
è(
	`__WTERMSIG
(¡©usè=ğ0)

	)

41 
	#__WIFSIGNALED
(
¡©us
) \

42 (((sigÃd è(((
¡©us
è& 0x7fè+ 1è>> 1è> 0)

	)

45 
	#__WIFSTOPPED
(
¡©us
è(((¡©usè& 0xffè=ğ0x7f)

	)

49 #ifdeà
WCONTINUED


50 
	#__WIFCONTINUED
(
¡©us
è((¡©usè=ğ
__W_CONTINUED
)

	)

54 
	#__WCOREDUMP
(
¡©us
è((¡©usè& 
__WCOREFLAG
)

	)

57 
	#__W_EXITCODE
(
»t
, 
sig
è(Ô‘è<< 8 | (sig))

	)

58 
	#__W_STOPCODE
(
sig
è((sigè<< 8 | 0x7f)

	)

59 
	#__W_CONTINUED
 0xffff

	)

60 
	#__WCOREFLAG
 0x80

	)

63 #ifdef 
__USE_BSD


65 
	~<’dŸn.h
>

67 
	uwa™


69 
	mw_¡©us
;

72 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


73 
	m__w_‹rmsig
:7;

74 
	m__w_cÜedump
:1;

75 
	m__w_»tcode
:8;

78 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


80 
	m__w_»tcode
:8;

81 
	m__w_cÜedump
:1;

82 
	m__w_‹rmsig
:7;

84 } 
	m__wa™_‹rmš©ed
;

87 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


88 
	m__w_¡İv®
:8;

89 
	m__w_¡İsig
:8;

92 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


94 
	m__w_¡İsig
:8;

95 
	m__w_¡İv®
:8;

97 } 
	m__wa™_¡İ³d
;

100 
	#w_‹rmsig
 
__wa™_‹rmš©ed
.
__w_‹rmsig


	)

101 
	#w_cÜedump
 
__wa™_‹rmš©ed
.
__w_cÜedump


	)

102 
	#w_»tcode
 
__wa™_‹rmš©ed
.
__w_»tcode


	)

103 
	#w_¡İsig
 
__wa™_¡İ³d
.
__w_¡İsig


	)

104 
	#w_¡İv®
 
__wa™_¡İ³d
.
__w_¡İv®


	)

	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

19 #iâdef 
_FEATURES_H


20 
	#_FEATURES_H
 1

	)

96 #undeà
__USE_ISOC99


97 #undeà
__USE_ISOC95


98 #undeà
__USE_POSIX


99 #undeà
__USE_POSIX2


100 #undeà
__USE_POSIX199309


101 #undeà
__USE_POSIX199506


102 #undeà
__USE_XOPEN


103 #undeà
__USE_XOPEN_EXTENDED


104 #undeà
__USE_UNIX98


105 #undeà
__USE_XOPEN2K


106 #undeà
__USE_XOPEN2KXSI


107 #undeà
__USE_XOPEN2K8


108 #undeà
__USE_XOPEN2K8XSI


109 #undeà
__USE_LARGEFILE


110 #undeà
__USE_LARGEFILE64


111 #undeà
__USE_FILE_OFFSET64


112 #undeà
__USE_BSD


113 #undeà
__USE_SVID


114 #undeà
__USE_MISC


115 #undeà
__USE_ATFILE


116 #undeà
__USE_GNU


117 #undeà
__USE_REENTRANT


118 #undeà
__USE_FORTIFY_LEVEL


119 #undeà
__FAVOR_BSD


120 #undeà
__KERNEL_STRICT_NAMES


124 #iâdeà
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

129 
	#__USE_ANSI
 1

	)

138 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


139 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

140 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

142 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

147 #ià
defšed
 
_BSD_SOURCE
 && \

148 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

149 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

150 
	#__FAVOR_BSD
 1

	)

154 #ifdeà
_GNU_SOURCE


155 #undeà
_ISOC95_SOURCE


156 
	#_ISOC95_SOURCE
 1

	)

157 #undeà
_ISOC99_SOURCE


158 
	#_ISOC99_SOURCE
 1

	)

159 #undeà
_POSIX_SOURCE


160 
	#_POSIX_SOURCE
 1

	)

161 #undeà
_POSIX_C_SOURCE


162 
	#_POSIX_C_SOURCE
 200809L

	)

163 #undeà
_XOPEN_SOURCE


164 
	#_XOPEN_SOURCE
 700

	)

165 #undeà
_XOPEN_SOURCE_EXTENDED


166 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

167 #undeà
_LARGEFILE64_SOURCE


168 
	#_LARGEFILE64_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

180 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

181 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

182 
	#_BSD_SOURCE
 1

	)

183 
	#_SVID_SOURCE
 1

	)

190 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

191 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

192 
	#__USE_ISOC99
 1

	)

196 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

197 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

198 
	#__USE_ISOC95
 1

	)

203 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

204 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

205 
	#_POSIX_SOURCE
 1

	)

206 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

207 
	#_POSIX_C_SOURCE
 2

	)

208 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

209 
	#_POSIX_C_SOURCE
 199506L

	)

210 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

211 
	#_POSIX_C_SOURCE
 200112L

	)

213 
	#_POSIX_C_SOURCE
 200809L

	)

215 
	#__USE_POSIX_IMPLICITLY
 1

	)

218 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


219 
	#__USE_POSIX
 1

	)

222 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


223 
	#__USE_POSIX2
 1

	)

226 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

227 
	#__USE_POSIX199309
 1

	)

230 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

231 
	#__USE_POSIX199506
 1

	)

234 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

235 
	#__USE_XOPEN2K
 1

	)

236 #undeà
__USE_ISOC95


237 
	#__USE_ISOC95
 1

	)

238 #undeà
__USE_ISOC99


239 
	#__USE_ISOC99
 1

	)

242 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

243 
	#__USE_XOPEN2K8
 1

	)

244 #undeà
_ATFILE_SOURCE


245 
	#_ATFILE_SOURCE
 1

	)

248 #ifdef 
_XOPEN_SOURCE


249 
	#__USE_XOPEN
 1

	)

250 #ià(
_XOPEN_SOURCE
 - 0) >= 500

251 
	#__USE_XOPEN_EXTENDED
 1

	)

252 
	#__USE_UNIX98
 1

	)

253 #undeà
_LARGEFILE_SOURCE


254 
	#_LARGEFILE_SOURCE
 1

	)

255 #ià(
_XOPEN_SOURCE
 - 0) >= 600

256 #ià(
_XOPEN_SOURCE
 - 0) >= 700

257 
	#__USE_XOPEN2K8
 1

	)

258 
	#__USE_XOPEN2K8XSI
 1

	)

260 
	#__USE_XOPEN2K
 1

	)

261 
	#__USE_XOPEN2KXSI
 1

	)

262 #undeà
__USE_ISOC95


263 
	#__USE_ISOC95
 1

	)

264 #undeà
__USE_ISOC99


265 
	#__USE_ISOC99
 1

	)

268 #ifdeà
_XOPEN_SOURCE_EXTENDED


269 
	#__USE_XOPEN_EXTENDED
 1

	)

274 #ifdeà
_LARGEFILE_SOURCE


275 
	#__USE_LARGEFILE
 1

	)

278 #ifdeà
_LARGEFILE64_SOURCE


279 
	#__USE_LARGEFILE64
 1

	)

282 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

283 
	#__USE_FILE_OFFSET64
 1

	)

286 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


287 
	#__USE_MISC
 1

	)

290 #ifdef 
_BSD_SOURCE


291 
	#__USE_BSD
 1

	)

294 #ifdef 
_SVID_SOURCE


295 
	#__USE_SVID
 1

	)

298 #ifdef 
_ATFILE_SOURCE


299 
	#__USE_ATFILE
 1

	)

302 #ifdef 
_GNU_SOURCE


303 
	#__USE_GNU
 1

	)

306 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


307 
	#__USE_REENTRANT
 1

	)

310 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

311 && 
defšed
 
__OPTIMIZE__
 && __OPTIMIZE__ > 0

312 #ià!
__GNUC_PREREQ
 (4, 1)

313 #ifdeà
__GNUC_RH_RELEASE__


314 #w¬nšg 
_FORTIFY_SOURCE
 
suµÜ‹d
 
Úly
 
w™h
 
GCC
 4.1 
ªd
 
Ï‹r


316 
	#__USE_FORTIFY_LEVEL
 0

	)

317 #–ià
_FORTIFY_SOURCE
 > 1

318 
	#__USE_FORTIFY_LEVEL
 2

	)

320 
	#__USE_FORTIFY_LEVEL
 1

	)

323 
	#__USE_FORTIFY_LEVEL
 0

	)

327 
	#__STDC_IEC_559__
 1

	)

328 
	#__STDC_IEC_559_COMPLEX__
 1

	)

331 
	#__STDC_ISO_10646__
 200009L

	)

339 #undeà
__GNU_LIBRARY__


340 
	#__GNU_LIBRARY__
 6

	)

344 
	#__GLIBC__
 2

	)

345 
	#__GLIBC_MINOR__
 12

	)

347 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

348 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

351 #ià
defšed
 
__GNUC__
 \

352 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

353 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

354 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

355 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

359 #iâdeà
__ASSEMBLER__


360 #iâdeà
_SYS_CDEFS_H


361 
	~<sys/cdefs.h
>

366 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


367 
	#__USE_LARGEFILE
 1

	)

368 
	#__USE_LARGEFILE64
 1

	)

374 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

375 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

376 && 
defšed
 
	g__ex‹º_šlše


377 
	#__USE_EXTERN_INLINES
 1

	)

385 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

21 #iâdeà
_GETOPT_H


23 #iâdeà
__Ãed_g‘İt


24 
	#_GETOPT_H
 1

	)

34 #ià!
defšed
 
__GNU_LIBRARY__


35 
	~<ùy³.h
>

38 #iâdeà
__THROW


39 #iâdeà
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

42 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__ılu¥lus


59 *
İrg
;

73 
İtšd
;

78 
İ‹¼
;

82 
İtİt
;

84 #iâdeà
__Ãed_g‘İt


106 
	sİtiÚ


108 cÚ¡ *
	gÇme
;

111 
	ghas_¬g
;

112 *
	gæag
;

113 
	gv®
;

118 
	#no_¬gum’t
 0

	)

119 
	#»quœed_¬gum’t
 1

	)

120 
	#İtiÚ®_¬gum’t
 2

	)

148 #ifdeà
__GNU_LIBRARY__


152 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

153 
__THROW
;

155 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

156 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


160 #ifdeà
__REDIRECT


161 
__REDIRECT
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

162 cÚ¡ *
__shÜtİts
),

163 
__posix_g‘İt
è
__THROW
;

165 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

166 cÚ¡ *
__shÜtİts
è
__THROW
;

167 
	#g‘İt
 
__posix_g‘İt


	)

171 
g‘İt
 ();

174 #iâdeà
__Ãed_g‘İt


175 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

176 cÚ¡ *
__shÜtİts
,

177 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

178 
__THROW
;

179 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

180 cÚ¡ *
__shÜtİts
,

181 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

182 
__THROW
;

186 #ifdef 
__ılu¥lus


191 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

29 #iâdeà
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cÚfig.h
>

34 
	#_IO_pos_t
 
_G_åos_t


	)

35 
	#_IO_åos_t
 
_G_åos_t


	)

36 
	#_IO_åos64_t
 
_G_åos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li¡
 
_G_va_li¡


	)

48 
	#_IO_wšt_t
 
_G_wšt_t


	)

50 #ifdeà
_G_NEED_STDARG_H


52 
	#__Ãed___va_li¡


	)

53 
	~<¡d¬g.h
>

54 #ifdeà
__GNUC_VA_LIST


55 #undeà
_IO_va_li¡


56 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

60 #iâdeà
__P


61 #ià
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifdeà
__STDC__


65 
	#__P
(
p
è
	)
p

66 
	#__PMT
(
p
è
	)
p

68 
	#__P
(
p
è()

	)

69 
	#__PMT
(
p
è()

	)

75 #iâdeà
_PARAMS


76 
	#_PARAMS
(
´Ùos
è
	`__P
ÕrÙos)

	)

79 #iâdeà
__STDC__


81 cÚ¡

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #iâdeà
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #iâdeà
EOF


90 
	#EOF
 (-1)

	)

92 #iâdeà
NULL


93 #ià
defšed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuÎ
)

	)

97 #ià!
defšed
(
__ılu¥lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifdeà
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifdeà
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

151 
	#_IO_SKIPWS
 01

	)

152 
	#_IO_LEFT
 02

	)

153 
	#_IO_RIGHT
 04

	)

154 
	#_IO_INTERNAL
 010

	)

155 
	#_IO_DEC
 020

	)

156 
	#_IO_OCT
 040

	)

157 
	#_IO_HEX
 0100

	)

158 
	#_IO_SHOWBASE
 0200

	)

159 
	#_IO_SHOWPOINT
 0400

	)

160 
	#_IO_UPPERCASE
 01000

	)

161 
	#_IO_SHOWPOS
 02000

	)

162 
	#_IO_SCIENTIFIC
 04000

	)

163 
	#_IO_FIXED
 010000

	)

164 
	#_IO_UNITBUF
 020000

	)

165 
	#_IO_STDIO
 040000

	)

166 
	#_IO_DONT_CLOSE
 0100000

	)

167 
	#_IO_BOOLALPHA
 0200000

	)

170 
_IO_jump_t
; 
	g_IO_FILE
;

173 #ifdeà
_IO_MTSAFE_IO


174 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

175 
	~<b™s/¡dio-lock.h
>

180 
	t_IO_lock_t
;

186 
	s_IO_m¬k”
 {

187 
_IO_m¬k”
 *
	m_Ãxt
;

188 
_IO_FILE
 *
	m_sbuf
;

192 
	m_pos
;

194 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

195 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

196 
	mpublic
:

197 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

198 ~
¡»amm¬k”
();

199 
§všg
(è{  
	m_¥os
 == -2; }

200 
d–
(
¡»amm¬k”
&);

201 
d–
();

206 
	e__codecvt_»suÉ


208 
	m__codecvt_ok
,

209 
	m__codecvt_·¹Ÿl
,

210 
	m__codecvt_”rÜ
,

211 
	m__codecvt_nocÚv


214 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


217 
	s_IO_codecvt


219 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

220 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

221 
	m__mb¡©e_t
 *,

222 cÚ¡ 
	mwch¬_t
 *,

223 cÚ¡ 
	mwch¬_t
 *,

224 cÚ¡ 
	mwch¬_t
 **, *,

226 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

227 
	m__mb¡©e_t
 *, *,

229 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

230 
	m__mb¡©e_t
 *,

232 cÚ¡ **, 
	mwch¬_t
 *,

233 
	mwch¬_t
 *, wchar_t **);

234 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

235 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

236 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

237 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

238 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

240 
_IO_icÚv_t
 
	m__cd_š
;

241 
_IO_icÚv_t
 
	m__cd_out
;

245 
	s_IO_wide_d©a


247 
wch¬_t
 *
	m_IO_»ad_±r
;

248 
wch¬_t
 *
	m_IO_»ad_’d
;

249 
wch¬_t
 *
	m_IO_»ad_ba£
;

250 
wch¬_t
 *
	m_IO_wr™e_ba£
;

251 
wch¬_t
 *
	m_IO_wr™e_±r
;

252 
wch¬_t
 *
	m_IO_wr™e_’d
;

253 
wch¬_t
 *
	m_IO_buf_ba£
;

254 
wch¬_t
 *
	m_IO_buf_’d
;

256 
wch¬_t
 *
	m_IO_§ve_ba£
;

257 
wch¬_t
 *
	m_IO_backup_ba£
;

259 
wch¬_t
 *
	m_IO_§ve_’d
;

261 
__mb¡©e_t
 
	m_IO_¡©e
;

262 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

263 
_IO_codecvt
 
	m_codecvt
;

265 
wch¬_t
 
	m_shÜtbuf
[1];

267 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

271 
	s_IO_FILE
 {

272 
	m_æags
;

273 
	#_IO_fe_æags
 
_æags


	)

277 * 
	m_IO_»ad_±r
;

278 * 
	m_IO_»ad_’d
;

279 * 
	m_IO_»ad_ba£
;

280 * 
	m_IO_wr™e_ba£
;

281 * 
	m_IO_wr™e_±r
;

282 * 
	m_IO_wr™e_’d
;

283 * 
	m_IO_buf_ba£
;

284 * 
	m_IO_buf_’d
;

286 *
	m_IO_§ve_ba£
;

287 *
	m_IO_backup_ba£
;

288 *
	m_IO_§ve_’d
;

290 
_IO_m¬k”
 *
	m_m¬k”s
;

292 
_IO_FILE
 *
	m_chaš
;

294 
	m_f’o
;

296 
	m_blksize
;

298 
	m_æags2
;

300 
_IO_off_t
 
	m_Şd_off£t
;

302 
	#__HAVE_COLUMN


	)

304 
	m_cur_cŞumn
;

305 sigÃd 
	m_vbË_off£t
;

306 
	m_shÜtbuf
[1];

310 
_IO_lock_t
 *
	m_lock
;

311 #ifdeà
_IO_USE_OLD_IO_FILE


314 
	s_IO_FILE_com¶‘e


316 
_IO_FILE
 
	m_fe
;

318 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

319 
_IO_off64_t
 
	m_off£t
;

320 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


322 
_IO_codecvt
 *
	m_codecvt
;

323 
_IO_wide_d©a
 *
	m_wide_d©a
;

324 
_IO_FILE
 *
	m_ä“»s_li¡
;

325 *
	m_ä“»s_buf
;

326 
size_t
 
	m_ä“»s_size
;

328 *
	m__·d1
;

329 *
	m__·d2
;

330 *
	m__·d3
;

331 *
	m__·d4
;

332 
size_t
 
	m__·d5
;

334 
	m_mode
;

336 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

340 #iâdeà
__ılu¥lus


341 
_IO_FILE
 
	t_IO_FILE
;

344 
	g_IO_FILE_¶us
;

346 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

347 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

348 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

349 #iâdeà
_LIBC


350 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

351 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

352 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

354 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

355 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

356 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

364 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

372 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, 
	t__cÚ¡
 *
	t__buf
,

373 
	tsize_t
 
	t__n
);

381 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

384 
	t__io_şo£_â
 (*
	t__cook›
);

387 #ifdeà
_GNU_SOURCE


389 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

390 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

391 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

392 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

397 
__io_»ad_â
 *
	m»ad
;

398 
__io_wr™e_â
 *
	mwr™e
;

399 
__io_£ek_â
 *
	m£ek
;

400 
__io_şo£_â
 *
	mşo£
;

401 } 
	t_IO_cook›_io_funùiÚs_t
;

402 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

404 
	g_IO_cook›_fe
;

407 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

408 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

412 #ifdeà
__ılu¥lus


416 
__und”æow
 (
_IO_FILE
 *);

417 
__uæow
 (
_IO_FILE
 *);

418 
__ov”æow
 (
_IO_FILE
 *, );

419 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


420 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

421 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

422 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

425 #ià 
__GNUC__
 >= 3

426 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

428 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

431 
	#_IO_g‘c_uÆocked
(
_å
) \

432 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

433 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

434 
	#_IO_³ekc_uÆocked
(
_å
) \

435 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

436 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

437 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

438 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

439 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

440 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

441 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

443 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


444 
	#_IO_g‘wc_uÆocked
(
_å
) \

445 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

446 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

447 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

448 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

449 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

450 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

451 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

452 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

453 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

454 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

457 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

458 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

460 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

461 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

462 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

463 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

465 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

468 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

469 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

471 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

472 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

473 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

475 #ifdeà
_IO_MTSAFE_IO


476 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

477 
	#_IO_æockfe
(
_å
) \

478 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

479 
	#_IO_fuÆockfe
(
_å
) \

480 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

482 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

483 
	#_IO_æockfe
(
_å
è

	)

484 
	#_IO_fuÆockfe
(
_å
è

	)

485 
	#_IO_árylockfe
(
_å
è

	)

486 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

487 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

490 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

491 
_IO_va_li¡
, *
__»¡riù
);

492 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

493 
_IO_va_li¡
);

494 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

495 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

497 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

498 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

500 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

502 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


503 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

504 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

505 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

506 #ià
__GNUC__
 >= 2

509 #ià
defšed
 
_LIBC
 && defšed 
SHARED


510 
	~<shlib-com·t.h
>

511 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

512 
	#_IO_fwide_maybe_šcom·tibË
 \

513 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

514 cÚ¡ 
_IO_¡dš_u£d
;

515 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

518 #iâdeà
_IO_fwide_maybe_šcom·tibË


519 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

523 
	#_IO_fwide
(
__å
, 
__mode
) \

524 ({ 
__»suÉ
 = (
__mode
); \

525 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

527 ià((
__å
)->
_mode
 == 0) \

529 (
__å
)->
_mode
 = -1; \

530 
__»suÉ
 = (
__å
)->
_mode
; \

532 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

533 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

535 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

536 
__»suÉ
; })

	)

539 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

540 
_IO_va_li¡
, *
__»¡riù
);

541 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

542 
_IO_va_li¡
);

543 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

544 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

547 #ifdeà
__LDBL_COMPAT


548 
	~<b™s/libio-ldbl.h
>

551 #ifdeà
__ılu¥lus


	@/usr/include/linux/byteorder/little_endian.h

1 #iâdeà
_LINUX_BYTEORDER_LITTLE_ENDIAN_H


2 
	#_LINUX_BYTEORDER_LITTLE_ENDIAN_H


	)

4 #iâdeà
__LITTLE_ENDIAN


5 
	#__LITTLE_ENDIAN
 1234

	)

7 #iâdeà
__LITTLE_ENDIAN_BITFIELD


8 
	#__LITTLE_ENDIAN_BITFIELD


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/swab.h
>

14 
	#__cÚ¡ªt_htÚl
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

15 
	#__cÚ¡ªt_Áohl
(
x
è
	`___cÚ¡ªt_swab32
((
__be32
)(x))

	)

16 
	#__cÚ¡ªt_htÚs
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

17 
	#__cÚ¡ªt_Áohs
(
x
è
	`___cÚ¡ªt_swab16
((
__be16
)(x))

	)

18 
	#__cÚ¡ªt_ıu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

19 
	#__cÚ¡ªt_Ë64_to_ıu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

20 
	#__cÚ¡ªt_ıu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

21 
	#__cÚ¡ªt_Ë32_to_ıu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

22 
	#__cÚ¡ªt_ıu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

23 
	#__cÚ¡ªt_Ë16_to_ıu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

24 
	#__cÚ¡ªt_ıu_to_be64
(
x
è((
__be64
)
	`___cÚ¡ªt_swab64
((x)))

	)

25 
	#__cÚ¡ªt_be64_to_ıu
(
x
è
	`___cÚ¡ªt_swab64
((
__u64
)(
__be64
)(x))

	)

26 
	#__cÚ¡ªt_ıu_to_be32
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

27 
	#__cÚ¡ªt_be32_to_ıu
(
x
è
	`___cÚ¡ªt_swab32
((
__u32
)(
__be32
)(x))

	)

28 
	#__cÚ¡ªt_ıu_to_be16
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

29 
	#__cÚ¡ªt_be16_to_ıu
(
x
è
	`___cÚ¡ªt_swab16
((
__u16
)(
__be16
)(x))

	)

30 
	#__ıu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

31 
	#__Ë64_to_ıu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

32 
	#__ıu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

33 
	#__Ë32_to_ıu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

34 
	#__ıu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

35 
	#__Ë16_to_ıu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

36 
	#__ıu_to_be64
(
x
è((
__be64
)
	`__swab64
((x)))

	)

37 
	#__be64_to_ıu
(
x
è
	`__swab64
((
__u64
)(
__be64
)(x))

	)

38 
	#__ıu_to_be32
(
x
è((
__be32
)
	`__swab32
((x)))

	)

39 
	#__be32_to_ıu
(
x
è
	`__swab32
((
__u32
)(
__be32
)(x))

	)

40 
	#__ıu_to_be16
(
x
è((
__be16
)
	`__swab16
((x)))

	)

41 
	#__be16_to_ıu
(
x
è
	`__swab16
((
__u16
)(
__be16
)(x))

	)

43 
__šlše__
 
__Ë64
 
	$__ıu_to_Ë64p
(cÚ¡ 
__u64
 *
p
)

45  (
__Ë64
)*
p
;

46 
	}
}

47 
__šlše__
 
__u64
 
	$__Ë64_to_ıup
(cÚ¡ 
__Ë64
 *
p
)

49  (
__u64
)*
p
;

50 
	}
}

51 
__šlše__
 
__Ë32
 
	$__ıu_to_Ë32p
(cÚ¡ 
__u32
 *
p
)

53  (
__Ë32
)*
p
;

54 
	}
}

55 
__šlše__
 
__u32
 
	$__Ë32_to_ıup
(cÚ¡ 
__Ë32
 *
p
)

57  (
__u32
)*
p
;

58 
	}
}

59 
__šlše__
 
__Ë16
 
	$__ıu_to_Ë16p
(cÚ¡ 
__u16
 *
p
)

61  (
__Ë16
)*
p
;

62 
	}
}

63 
__šlše__
 
__u16
 
	$__Ë16_to_ıup
(cÚ¡ 
__Ë16
 *
p
)

65  (
__u16
)*
p
;

66 
	}
}

67 
__šlše__
 
__be64
 
	$__ıu_to_be64p
(cÚ¡ 
__u64
 *
p
)

69  (
__be64
)
	`__swab64p
(
p
);

70 
	}
}

71 
__šlše__
 
__u64
 
	$__be64_to_ıup
(cÚ¡ 
__be64
 *
p
)

73  
	`__swab64p
((
__u64
 *)
p
);

74 
	}
}

75 
__šlše__
 
__be32
 
	$__ıu_to_be32p
(cÚ¡ 
__u32
 *
p
)

77  (
__be32
)
	`__swab32p
(
p
);

78 
	}
}

79 
__šlše__
 
__u32
 
	$__be32_to_ıup
(cÚ¡ 
__be32
 *
p
)

81  
	`__swab32p
((
__u32
 *)
p
);

82 
	}
}

83 
__šlše__
 
__be16
 
	$__ıu_to_be16p
(cÚ¡ 
__u16
 *
p
)

85  (
__be16
)
	`__swab16p
(
p
);

86 
	}
}

87 
__šlše__
 
__u16
 
	$__be16_to_ıup
(cÚ¡ 
__be16
 *
p
)

89  
	`__swab16p
((
__u16
 *)
p
);

90 
	}
}

91 
	#__ıu_to_Ë64s
(
x
èdØ{ ()(x); } 0)

	)

92 
	#__Ë64_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

93 
	#__ıu_to_Ë32s
(
x
èdØ{ ()(x); } 0)

	)

94 
	#__Ë32_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

95 
	#__ıu_to_Ë16s
(
x
èdØ{ ()(x); } 0)

	)

96 
	#__Ë16_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

97 
	#__ıu_to_be64s
(
x
è
	`__swab64s
((x))

	)

98 
	#__be64_to_ıus
(
x
è
	`__swab64s
((x))

	)

99 
	#__ıu_to_be32s
(
x
è
	`__swab32s
((x))

	)

100 
	#__be32_to_ıus
(
x
è
	`__swab32s
((x))

	)

101 
	#__ıu_to_be16s
(
x
è
	`__swab16s
((x))

	)

102 
	#__be16_to_ıus
(
x
è
	`__swab16s
((x))

	)

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty³s.h
>

6 #iâdeà
__ASSEMBLY__


8 
	~<lšux/posix_ty³s.h
>

16 #ifdeà
__CHECKER__


17 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

19 
	#__b™wi£__


	)

21 #ifdeà
__CHECK_ENDIAN__


22 
	#__b™wi£
 
__b™wi£__


	)

24 
	#__b™wi£


	)

27 
__u16
 
	t__b™wi£
 
	t__Ë16
;

28 
__u16
 
	t__b™wi£
 
	t__be16
;

29 
__u32
 
	t__b™wi£
 
	t__Ë32
;

30 
__u32
 
	t__b™wi£
 
	t__be32
;

31 
__u64
 
	t__b™wi£
 
	t__Ë64
;

32 
__u64
 
	t__b™wi£
 
	t__be64
;

34 
__u16
 
	t__b™wi£
 
	t__sum16
;

35 
__u32
 
	t__b™wi£
 
	t__wsum
;

	@/usr/include/stdint.h

23 #iâdeà
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wch¬.h
>

28 
	~<b™s/wÜdsize.h
>

35 #iâdeà
__št8_t_defšed


36 
	#__št8_t_defšed


	)

37 sigÃd 
	tšt8_t
;

38 
	tšt16_t
;

39 
	tšt32_t
;

40 #ià
__WORDSIZE
 == 64

41 
	tšt64_t
;

43 
__ex‹nsiÚ__


44 
	tšt64_t
;

49 
	tušt8_t
;

50 
	tušt16_t
;

51 #iâdeà
__ušt32_t_defšed


52 
	tušt32_t
;

53 
	#__ušt32_t_defšed


	)

55 #ià
__WORDSIZE
 == 64

56 
	tušt64_t
;

58 
__ex‹nsiÚ__


59 
	tušt64_t
;

66 sigÃd 
	tšt_Ëa¡8_t
;

67 
	tšt_Ëa¡16_t
;

68 
	tšt_Ëa¡32_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_Ëa¡64_t
;

72 
__ex‹nsiÚ__


73 
	tšt_Ëa¡64_t
;

77 
	tušt_Ëa¡8_t
;

78 
	tušt_Ëa¡16_t
;

79 
	tušt_Ëa¡32_t
;

80 #ià
__WORDSIZE
 == 64

81 
	tušt_Ëa¡64_t
;

83 
__ex‹nsiÚ__


84 
	tušt_Ëa¡64_t
;

91 sigÃd 
	tšt_ç¡8_t
;

92 #ià
__WORDSIZE
 == 64

93 
	tšt_ç¡16_t
;

94 
	tšt_ç¡32_t
;

95 
	tšt_ç¡64_t
;

97 
	tšt_ç¡16_t
;

98 
	tšt_ç¡32_t
;

99 
__ex‹nsiÚ__


100 
	tšt_ç¡64_t
;

104 
	tušt_ç¡8_t
;

105 #ià
__WORDSIZE
 == 64

106 
	tušt_ç¡16_t
;

107 
	tušt_ç¡32_t
;

108 
	tušt_ç¡64_t
;

110 
	tušt_ç¡16_t
;

111 
	tušt_ç¡32_t
;

112 
__ex‹nsiÚ__


113 
	tušt_ç¡64_t
;

118 #ià
__WORDSIZE
 == 64

119 #iâdeà
__šŒ_t_defšed


120 
	tšŒ_t
;

121 
	#__šŒ_t_defšed


	)

123 
	tušŒ_t
;

125 #iâdeà
__šŒ_t_defšed


126 
	tšŒ_t
;

127 
	#__šŒ_t_defšed


	)

129 
	tušŒ_t
;

134 #ià
__WORDSIZE
 == 64

135 
	tštmax_t
;

136 
	tuštmax_t
;

138 
__ex‹nsiÚ__


139 
	tštmax_t
;

140 
__ex‹nsiÚ__


141 
	tuštmax_t
;

147 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_LIMIT_MACROS


149 #ià
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
èø## 
L


	)

151 
	#__UINT64_C
(
c
èø## 
UL


	)

153 
	#__INT64_C
(
c
èø## 
LL


	)

154 
	#__UINT64_C
(
c
èø## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #ià
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #ià
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #ià
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #ià
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #ià
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #ià
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #iâdeà
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
è
	)
c

291 
	#INT16_C
(
c
è
	)
c

292 
	#INT32_C
(
c
è
	)
c

293 #ià
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
èø## 
L


	)

296 
	#INT64_C
(
c
èø## 
LL


	)

300 
	#UINT8_C
(
c
è
	)
c

301 
	#UINT16_C
(
c
è
	)
c

302 
	#UINT32_C
(
c
èø## 
U


	)

303 #ià
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
èø## 
UL


	)

306 
	#UINT64_C
(
c
èø## 
ULL


	)

310 #ià
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
èø## 
L


	)

312 
	#UINTMAX_C
(
c
èø## 
UL


	)

314 
	#INTMAX_C
(
c
èø## 
LL


	)

315 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/sys/select.h

22 #iâdeà
_SYS_SELECT_H


23 
	#_SYS_SELECT_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

31 
	~<b™s/£Ëù.h
>

34 
	~<b™s/sig£t.h
>

36 #iâdeà
__sig£t_t_defšed


37 
	#__sig£t_t_defšed


	)

38 
__sig£t_t
 
	tsig£t_t
;

42 
	#__Ãed_time_t


	)

43 
	#__Ãed_time¥ec


	)

44 
	~<time.h
>

45 
	#__Ãed_timev®


	)

46 
	~<b™s/time.h
>

48 #iâdeà
__su£cÚds_t_defšed


49 
__su£cÚds_t
 
	tsu£cÚds_t
;

50 
	#__su£cÚds_t_defšed


	)

55 
	t__fd_mask
;

58 #undeà
__NFDBITS


59 #undeà
__FDELT


60 #undeà
__FDMASK


62 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

63 
	#__FDELT
(
d
è((dè/ 
__NFDBITS
)

	)

64 
	#__FDMASK
(
d
è((
__fd_mask
è1 << ((dè% 
__NFDBITS
))

	)

71 #ifdeà
__USE_XOPEN


72 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

75 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

76 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

78 } 
	tfd_£t
;

81 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

83 #ifdeà
__USE_MISC


85 
__fd_mask
 
	tfd_mask
;

88 
	#NFDBITS
 
__NFDBITS


	)

93 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

94 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

95 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

96 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

99 
__BEGIN_DECLS


109 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

110 
fd_£t
 *
__»¡riù
 
__wr™efds
,

111 
fd_£t
 *
__»¡riù
 
__exû±fds
,

112 
timev®
 *
__»¡riù
 
__timeout
);

114 #ifdeà
__USE_XOPEN2K


121 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

122 
fd_£t
 *
__»¡riù
 
__wr™efds
,

123 
fd_£t
 *
__»¡riù
 
__exû±fds
,

124 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

125 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

128 
	g__END_DECLS


	@/usr/include/sys/sysmacros.h

21 #iâdeà
_SYS_SYSMACROS_H


22 
	#_SYS_SYSMACROS_H
 1

	)

24 
	~<ã©u»s.h
>

29 #ifdeà
__GLIBC_HAVE_LONG_LONG


30 
__ex‹nsiÚ__


31 
	$gnu_dev_majÜ
 (
__dev
)

32 
__THROW
;

33 
__ex‹nsiÚ__


34 
	$gnu_dev_mšÜ
 (
__dev
)

35 
__THROW
;

36 
__ex‹nsiÚ__


37 
	$gnu_dev_makedev
 (
__majÜ
,

38 
__mšÜ
)

39 
__THROW
;

41 #ià
defšed
 
__GNUC__
 && __GNUC__ >ğ2 && defšed 
__USE_EXTERN_INLINES


42 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

43 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

45  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

46 
	}
}

48 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

49 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

51  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

52 
	}
}

54 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

55 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

57  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

58 | (((è(
__mšÜ
 & ~0xff)) << 12)

59 | (((è(
__majÜ
 & ~0xfff)) << 32));

60 
	}
}

65 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

66 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

67 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/xen/arch-x86/xen-mca.h

53 #iâdeà
__XEN_PUBLIC_ARCH_X86_MCA_H__


54 
	#__XEN_PUBLIC_ARCH_X86_MCA_H__


	)

57 
	#__HYPERVISOR_mÿ
 
__HYPERVISOR_¬ch_0


	)

65 
	#XEN_MCA_INTERFACE_VERSION
 0x01ecc003

	)

68 
	#XEN_MC_NONURGENT
 0x0001

	)

70 
	#XEN_MC_URGENT
 0x0002

	)

72 
	#XEN_MC_ACK
 0x0004

	)

75 
	#XEN_MC_OK
 0x0

	)

77 
	#XEN_MC_FETCHFAILED
 0x1

	)

79 
	#XEN_MC_NODATA
 0x2

	)

83 
	#XEN_MC_NOMATCH
 0x4

	)

86 
	#XEN_MC_CANNOTHANDLE
 0x8

	)

88 
	#XEN_MC_NOTDELIVERED
 0x10

	)

92 #iâdeà
__ASSEMBLY__


94 
	#VIRQ_MCA
 
VIRQ_ARCH_0


	)

104 
	#MC_TYPE_GLOBAL
 0

	)

105 
	#MC_TYPE_BANK
 1

	)

106 
	#MC_TYPE_EXTENDED
 2

	)

107 
	#MC_TYPE_RECOVERY
 3

	)

109 
	smcšfo_commÚ
 {

110 
ušt16_t
 
	mty³
;

111 
ušt16_t
 
	msize
;

115 
	#MC_FLAG_CORRECTABLE
 (1 << 0)

	)

116 
	#MC_FLAG_UNCORRECTABLE
 (1 << 1)

	)

117 
	#MC_FLAG_RECOVERABLE
 (1 << 2)

	)

118 
	#MC_FLAG_POLLED
 (1 << 3)

	)

119 
	#MC_FLAG_RESET
 (1 << 4)

	)

120 
	#MC_FLAG_CMCI
 (1 << 5)

	)

121 
	#MC_FLAG_MCE
 (1 << 6)

	)

123 
	smcšfo_glob®
 {

124 
mcšfo_commÚ
 
	mcommÚ
;

127 
ušt16_t
 
	mmc_domid
;

128 
ušt16_t
 
	mmc_vıuid
;

129 
ušt32_t
 
	mmc_sock‘id
;

130 
ušt16_t
 
	mmc_cÜeid
;

131 
ušt16_t
 
	mmc_cÜe_th»adid
;

132 
ušt32_t
 
	mmc_­icid
;

133 
ušt32_t
 
	mmc_æags
;

134 
ušt64_t
 
	mmc_g¡©us
;

138 
	smcšfo_bªk
 {

139 
mcšfo_commÚ
 
	mcommÚ
;

141 
ušt16_t
 
	mmc_bªk
;

142 
ušt16_t
 
	mmc_domid
;

144 
ušt64_t
 
	mmc_¡©us
;

145 
ušt64_t
 
	mmc_addr
;

147 
ušt64_t
 
	mmc_misc
;

148 
ušt64_t
 
	mmc_ù¾2
;

149 
ušt64_t
 
	mmc_tsc
;

153 
	smcšfo_m¤
 {

154 
ušt64_t
 
	m»g
;

155 
ušt64_t
 
	mv®ue
;

160 
	smcšfo_ex‹nded
 {

161 
mcšfo_commÚ
 
	mcommÚ
;

167 
ušt32_t
 
	mmc_m¤s
;

173 
mcšfo_m¤
 
	mmc_m¤
[(*) * 4];

179 
	#REC_ACTION_RECOVERED
 (0x1 << 0)

	)

181 
	#REC_ACTION_NONE
 (0x1 << 1)

	)

183 
	#REC_ACTION_NEED_RESET
 (0x1 << 2)

	)

190 
	#MC_ACTION_PAGE_OFFLINE
 (0x1 << 0)

	)

192 
	#MC_ACTION_CPU_OFFLINE
 (0x1 << 1)

	)

194 
	#MC_ACTION_CACHE_SHRINK
 (0x1 << 2)

	)

203 
	s·ge_ofæše_aùiÚ


206 
ušt64_t
 
	mmâ
;

207 
ušt64_t
 
	m¡©us
;

210 
	sıu_ofæše_aùiÚ


213 
ušt32_t
 
	mmc_sock‘id
;

214 
ušt16_t
 
	mmc_cÜeid
;

215 
ušt16_t
 
	mmc_cÜe_th»adid
;

218 
	#MAX_UNION_SIZE
 16

	)

219 
	smcšfo_»cov”y


221 
mcšfo_commÚ
 
	mcommÚ
;

222 
ušt16_t
 
	mmc_bªk
;

223 
ušt8_t
 
	maùiÚ_æags
;

224 
ušt8_t
 
	maùiÚ_ty³s
;

226 
·ge_ofæše_aùiÚ
 
	m·ge_»tœe
;

227 
ıu_ofæše_aùiÚ
 
	mıu_ofæše
;

228 
ušt8_t
 
	m·d
[
MAX_UNION_SIZE
];

229 } 
	maùiÚ_šfo
;

233 
	#MCINFO_HYPERCALLSIZE
 1024

	)

234 
	#MCINFO_MAXSIZE
 768

	)

236 
	#MCINFO_FLAGS_UNCOMPLETE
 0x1

	)

237 
	smc_šfo
 {

239 
ušt32_t
 
	mmi_ÃÁr›s
;

240 
ušt32_t
 
	mæags
;

241 
ušt64_t
 
	mmi_d©a
[(
MCINFO_MAXSIZE
 - 1) / 8];

243 
mc_šfo
 
	tmc_šfo_t
;

244 
DEFINE_XEN_GUEST_HANDLE
(
mc_šfo_t
);

246 
	#__MC_MSR_ARRAYSIZE
 8

	)

247 
	#__MC_NMSRS
 1

	)

248 
	#MC_NCAPS
 7

	)

249 
	#MC_CAPS_STD_EDX
 0

	)

250 
	#MC_CAPS_AMD_EDX
 1

	)

251 
	#MC_CAPS_TM
 2

	)

252 
	#MC_CAPS_LINUX
 3

	)

253 
	#MC_CAPS_STD_ECX
 4

	)

254 
	#MC_CAPS_VIA
 5

	)

255 
	#MC_CAPS_AMD_ECX
 6

	)

257 
	smcšfo_logiÿl_ıu
 {

258 
ušt32_t
 
	mmc_ıuÄ
;

259 
ušt32_t
 
	mmc_chid
;

260 
ušt16_t
 
	mmc_cÜeid
;

261 
ušt16_t
 
	mmc_th»adid
;

262 
ušt32_t
 
	mmc_­icid
;

263 
ušt32_t
 
	mmc_şu¡”id
;

264 
ušt32_t
 
	mmc_ncÜes
;

265 
ušt32_t
 
	mmc_ncÜes_aùive
;

266 
ušt32_t
 
	mmc_Áh»ads
;

267 
št32_t
 
	mmc_ıuid_Ëv–
;

268 
ušt32_t
 
	mmc_çmy
;

269 
ušt32_t
 
	mmc_v’dÜ
;

270 
ušt32_t
 
	mmc_mod–
;

271 
ušt32_t
 
	mmc_¡•
;

272 
	mmc_v’dÜid
[16];

273 
	mmc_b¿ndid
[64];

274 
ušt32_t
 
	mmc_ıu_ÿps
[
MC_NCAPS
];

275 
ušt32_t
 
	mmc_ÿche_size
;

276 
ušt32_t
 
	mmc_ÿche_®ignm’t
;

277 
št32_t
 
	mmc_nm¤v®s
;

278 
mcšfo_m¤
 
	mmc_m¤v®ues
[
__MC_MSR_ARRAYSIZE
];

280 
mcšfo_logiÿl_ıu
 
	tx’_mc_logiÿl_ıu_t
;

281 
DEFINE_XEN_GUEST_HANDLE
(
x’_mc_logiÿl_ıu_t
);

293 
	#x86_mcšfo_ÃÁr›s
(
_mi
) \

294 (
_mi
)->
mi_ÃÁr›s


	)

298 
	#x86_mcšfo_fœ¡
(
_mi
) \

299 ((
mcšfo_commÚ
 *)(
_mi
)->
mi_d©a
)

	)

303 
	#x86_mcšfo_Ãxt
(
_mic
) \

304 ((
mcšfo_commÚ
 *)((
ušt8_t
 *)(
_mic
è+ (_mic)->
size
))

	)

309 
	#x86_mcšfo_lookup
(
_»t
, 
_mi
, 
_ty³
) \

311 
ušt32_t
 
found
, 
i
; \

312 
mcšfo_commÚ
 *
_mic
; \

314 
found
 = 0; \

315 (
_»t
èğ
NULL
; \

316 ià(
_mi
 =ğ
NULL
) ; \

317 
_mic
 = 
	`x86_mcšfo_fœ¡
(
_mi
); \

318 
i
 = 0; i < 
	`x86_mcšfo_ÃÁr›s
(
_mi
); i++) { \

319 ià(
_mic
->
ty³
 =ğ(
_ty³
)) { \

320 
found
 = 1; \

323 
_mic
 = 
	`x86_mcšfo_Ãxt
(_mic); \

325 (
_»t
èğ
found
 ? 
_mic
 : 
NULL
; \

326 } 0)

	)

343 
	#XEN_MC_ãtch
 1

	)

344 
	sx’_mc_ãtch
 {

346 
ušt32_t
 
	mæags
;

350 
ušt32_t
 
	m_·d0
;

351 
ušt64_t
 
	mãtch_id
;

354 
XEN_GUEST_HANDLE
(
mc_šfo_t
è
	md©a
;

356 
x’_mc_ãtch
 
	tx’_mc_ãtch_t
;

357 
DEFINE_XEN_GUEST_HANDLE
(
x’_mc_ãtch_t
);

363 
	#XEN_MC_nÙifydomaš
 2

	)

364 
	sx’_mc_nÙifydomaš
 {

366 
ušt16_t
 
	mmc_domid
;

367 
ušt16_t
 
	mmc_vıuid
;

371 
ušt32_t
 
	mæags
;

376 
x’_mc_nÙifydomaš
 
	tx’_mc_nÙifydomaš_t
;

377 
DEFINE_XEN_GUEST_HANDLE
(
x’_mc_nÙifydomaš_t
);

379 
	#XEN_MC_physıušfo
 3

	)

380 
	sx’_mc_physıušfo
 {

382 
ušt32_t
 
	mnıus
;

383 
ušt32_t
 
	m_·d0
;

385 
XEN_GUEST_HANDLE
(
x’_mc_logiÿl_ıu_t
è
	mšfo
;

388 
	#XEN_MC_m¤šjeù
 4

	)

389 
	#MC_MSRINJ_MAXMSRS
 8

	)

390 
	sx’_mc_m¤šjeù
 {

392 
ušt32_t
 
	mmcšj_ıuÄ
;

393 
ušt32_t
 
	mmcšj_æags
;

394 
ušt32_t
 
	mmcšj_couÁ
;

395 
ušt32_t
 
	m_·d0
;

396 
mcšfo_m¤
 
	mmcšj_m¤
[
MC_MSRINJ_MAXMSRS
];

400 
	#MC_MSRINJ_F_INTERPOSE
 0x1

	)

402 
	#XEN_MC_mûšjeù
 5

	)

403 
	sx’_mc_mûšjeù
 {

404 
	mmûšj_ıuÄ
;

407 #ià
defšed
(
__XEN__
è|| defšed(
__XEN_TOOLS__
)

408 
	#XEN_MC_šjeù_v2
 6

	)

409 
	#XEN_MC_INJECT_TYPE_MASK
 0x7

	)

410 
	#XEN_MC_INJECT_TYPE_MCE
 0x0

	)

411 
	#XEN_MC_INJECT_TYPE_CMCI
 0x1

	)

413 
	#XEN_MC_INJECT_CPU_BROADCAST
 0x8

	)

415 
	sx’_mc_šjeù_v2
 {

416 
ušt32_t
 
	mæags
;

417 
x’ùl_ıum­
 
	mıum­
;

421 
	sx’_mc
 {

422 
ušt32_t
 
	mcmd
;

423 
ušt32_t
 
	mš‹rçû_v”siÚ
;

425 
x’_mc_ãtch
 
	mmc_ãtch
;

426 
x’_mc_nÙifydomaš
 
	mmc_nÙifydomaš
;

427 
x’_mc_physıušfo
 
	mmc_physıušfo
;

428 
x’_mc_m¤šjeù
 
	mmc_m¤šjeù
;

429 
x’_mc_mûšjeù
 
	mmc_mûšjeù
;

430 #ià
defšed
(
__XEN__
è|| defšed(
__XEN_TOOLS__
)

431 
x’_mc_šjeù_v2
 
	mmc_šjeù_v2
;

433 } 
	mu
;

435 
x’_mc
 
	tx’_mc_t
;

436 
DEFINE_XEN_GUEST_HANDLE
(
x’_mc_t
);

	@/usr/include/xen/domctl.h

28 #iâdeà
__XEN_PUBLIC_DOMCTL_H__


29 
	#__XEN_PUBLIC_DOMCTL_H__


	)

31 #ià!
defšed
(
__XEN__
è&& !defšed(
__XEN_TOOLS__
)

35 
	~"x’.h
"

36 
	~"g¿Á_bË.h
"

38 
	#XEN_DOMCTL_INTERFACE_VERSION
 0x00000007

	)

45 
	sx’_domùl_ü—‹domaš
 {

47 
ušt32_t
 
	mssid»f
;

48 
x’_domaš_hªdË_t
 
	mhªdË
;

50 
	#_XEN_DOMCTL_CDF_hvm_gue¡
 0

	)

51 
	#XEN_DOMCTL_CDF_hvm_gue¡
 (1U<<
_XEN_DOMCTL_CDF_hvm_gue¡
)

	)

53 
	#_XEN_DOMCTL_CDF_h­
 1

	)

54 
	#XEN_DOMCTL_CDF_h­
 (1U<<
_XEN_DOMCTL_CDF_h­
)

	)

56 
	#_XEN_DOMCTL_CDF_s3_š‹gr™y
 2

	)

57 
	#XEN_DOMCTL_CDF_s3_š‹gr™y
 (1U<<
_XEN_DOMCTL_CDF_s3_š‹gr™y
)

	)

59 
	#_XEN_DOMCTL_CDF_oos_off
 3

	)

60 
	#XEN_DOMCTL_CDF_oos_off
 (1U<<
_XEN_DOMCTL_CDF_oos_off
)

	)

61 
ušt32_t
 
	mæags
;

63 
x’_domùl_ü—‹domaš
 
	tx’_domùl_ü—‹domaš_t
;

64 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_ü—‹domaš_t
);

67 
	sx’_domùl_g‘domaššfo
 {

69 
domid_t
 
	mdomaš
;

71 
	#_XEN_DOMINF_dyšg
 0

	)

72 
	#XEN_DOMINF_dyšg
 (1U<<
_XEN_DOMINF_dyšg
)

	)

74 
	#_XEN_DOMINF_hvm_gue¡
 1

	)

75 
	#XEN_DOMINF_hvm_gue¡
 (1U<<
_XEN_DOMINF_hvm_gue¡
)

	)

77 
	#_XEN_DOMINF_shutdown
 2

	)

78 
	#XEN_DOMINF_shutdown
 (1U<<
_XEN_DOMINF_shutdown
)

	)

80 
	#_XEN_DOMINF_·u£d
 3

	)

81 
	#XEN_DOMINF_·u£d
 (1U<<
_XEN_DOMINF_·u£d
)

	)

83 
	#_XEN_DOMINF_blocked
 4

	)

84 
	#XEN_DOMINF_blocked
 (1U<<
_XEN_DOMINF_blocked
)

	)

86 
	#_XEN_DOMINF_ruÂšg
 5

	)

87 
	#XEN_DOMINF_ruÂšg
 (1U<<
_XEN_DOMINF_ruÂšg
)

	)

89 
	#_XEN_DOMINF_debugged
 6

	)

90 
	#XEN_DOMINF_debugged
 (1U<<
_XEN_DOMINF_debugged
)

	)

92 
	#XEN_DOMINF_shutdownmask
 255

	)

93 
	#XEN_DOMINF_shutdownshiá
 16

	)

94 
ušt32_t
 
	mæags
;

95 
ušt64_®igÃd_t
 
	mtÙ_·ges
;

96 
ušt64_®igÃd_t
 
	mmax_·ges
;

97 
ušt64_®igÃd_t
 
	mshr_·ges
;

98 
ušt64_®igÃd_t
 
	msh¬ed_šfo_äame
;

99 
ušt64_®igÃd_t
 
	mıu_time
;

100 
ušt32_t
 
	mÄ_Úlše_vıus
;

101 
ušt32_t
 
	mmax_vıu_id
;

102 
ušt32_t
 
	mssid»f
;

103 
x’_domaš_hªdË_t
 
	mhªdË
;

104 
ušt32_t
 
	mıupoŞ
;

106 
x’_domùl_g‘domaššfo
 
	tx’_domùl_g‘domaššfo_t
;

107 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_g‘domaššfo_t
);

111 
	sx’_domùl_g‘memli¡
 {

114 
ušt64_®igÃd_t
 
	mmax_pâs
;

116 
ušt64_®igÃd_t
 
	m¡¬t_pâ
;

117 
XEN_GUEST_HANDLE_64
(
ušt64
è
	mbufãr
;

119 
ušt64_®igÃd_t
 
	mnum_pâs
;

121 
x’_domùl_g‘memli¡
 
	tx’_domùl_g‘memli¡_t
;

122 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_g‘memli¡_t
);

127 
	#XEN_DOMCTL_PFINFO_LTAB_SHIFT
 28

	)

128 
	#XEN_DOMCTL_PFINFO_NOTAB
 (0x0U<<28)

	)

129 
	#XEN_DOMCTL_PFINFO_L1TAB
 (0x1U<<28)

	)

130 
	#XEN_DOMCTL_PFINFO_L2TAB
 (0x2U<<28)

	)

131 
	#XEN_DOMCTL_PFINFO_L3TAB
 (0x3U<<28)

	)

132 
	#XEN_DOMCTL_PFINFO_L4TAB
 (0x4U<<28)

	)

133 
	#XEN_DOMCTL_PFINFO_LTABTYPE_MASK
 (0x7U<<28)

	)

134 
	#XEN_DOMCTL_PFINFO_LPINTAB
 (0x1U<<31)

	)

135 
	#XEN_DOMCTL_PFINFO_XTAB
 (0xfU<<28è

	)

136 
	#XEN_DOMCTL_PFINFO_PAGEDTAB
 (0x8U<<28)

	)

137 
	#XEN_DOMCTL_PFINFO_LTAB_MASK
 (0xfU<<28)

	)

139 
	sx’_domùl_g‘·geäamešfo
 {

141 
ušt64_®igÃd_t
 
	mgmâ
;

144 
ušt32_t
 
	mty³
;

146 
x’_domùl_g‘·geäamešfo
 
	tx’_domùl_g‘·geäamešfo_t
;

147 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_g‘·geäamešfo_t
);

151 
	sx’_domùl_g‘·geäamešfo2
 {

153 
ušt64_®igÃd_t
 
	mnum
;

155 
XEN_GUEST_HANDLE_64
(
ušt32
è
	m¬¿y
;

157 
x’_domùl_g‘·geäamešfo2
 
	tx’_domùl_g‘·geäamešfo2_t
;

158 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_g‘·geäamešfo2_t
);

161 
	sx’_domùl_g‘·geäamešfo3
 {

163 
ušt64_®igÃd_t
 
	mnum
;

165 
XEN_GUEST_HANDLE_64
(
x’_pâ_t
è
	m¬¿y
;

175 
	#XEN_DOMCTL_SHADOW_OP_OFF
 0

	)

178 
	#XEN_DOMCTL_SHADOW_OP_ENABLE
 32

	)

182 
	#XEN_DOMCTL_SHADOW_OP_CLEAN
 11

	)

184 
	#XEN_DOMCTL_SHADOW_OP_PEEK
 12

	)

187 
	#XEN_DOMCTL_SHADOW_OP_GET_ALLOCATION
 30

	)

188 
	#XEN_DOMCTL_SHADOW_OP_SET_ALLOCATION
 31

	)

192 
	#XEN_DOMCTL_SHADOW_OP_ENABLE_TEST
 1

	)

194 
	#XEN_DOMCTL_SHADOW_OP_ENABLE_LOGDIRTY
 2

	)

196 
	#XEN_DOMCTL_SHADOW_OP_ENABLE_TRANSLATE
 3

	)

203 
	#XEN_DOMCTL_SHADOW_ENABLE_REFCOUNT
 (1 << 1)

	)

208 
	#XEN_DOMCTL_SHADOW_ENABLE_LOG_DIRTY
 (1 << 2)

	)

212 
	#XEN_DOMCTL_SHADOW_ENABLE_TRANSLATE
 (1 << 3)

	)

217 
	#XEN_DOMCTL_SHADOW_ENABLE_EXTERNAL
 (1 << 4)

	)

219 
	sx’_domùl_shadow_İ_¡©s
 {

220 
ušt32_t
 
	mçuÉ_couÁ
;

221 
ušt32_t
 
	mdœty_couÁ
;

223 
x’_domùl_shadow_İ_¡©s
 
	tx’_domùl_shadow_İ_¡©s_t
;

224 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_shadow_İ_¡©s_t
);

226 
	sx’_domùl_shadow_İ
 {

228 
ušt32_t
 
	mİ
;

231 
ušt32_t
 
	mmode
;

234 
ušt32_t
 
	mmb
;

237 
XEN_GUEST_HANDLE_64
(
ušt8
è
	mdœty_b™m­
;

238 
ušt64_®igÃd_t
 
	m·ges
;

239 
x’_domùl_shadow_İ_¡©s
 
	m¡©s
;

241 
x’_domùl_shadow_İ
 
	tx’_domùl_shadow_İ_t
;

242 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_shadow_İ_t
);

246 
	sx’_domùl_max_mem
 {

248 
ušt64_®igÃd_t
 
	mmax_memkb
;

250 
x’_domùl_max_mem
 
	tx’_domùl_max_mem_t
;

251 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_max_mem_t
);

256 
	sx’_domùl_vıucÚ‹xt
 {

257 
ušt32_t
 
	mvıu
;

258 
XEN_GUEST_HANDLE_64
(
vıu_gue¡_cÚ‹xt_t
è
	mùxt
;

260 
x’_domùl_vıucÚ‹xt
 
	tx’_domùl_vıucÚ‹xt_t
;

261 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_vıucÚ‹xt_t
);

265 
	sx’_domùl_g‘vıušfo
 {

267 
ušt32_t
 
	mvıu
;

269 
ušt8_t
 
	mÚlše
;

270 
ušt8_t
 
	mblocked
;

271 
ušt8_t
 
	mruÂšg
;

272 
ušt64_®igÃd_t
 
	mıu_time
;

273 
ušt32_t
 
	mıu
;

275 
x’_domùl_g‘vıušfo
 
	tx’_domùl_g‘vıušfo_t
;

276 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_g‘vıušfo_t
);

282 
	sx’_domùl_vıuaffš™y
 {

283 
ušt32_t
 
	mvıu
;

284 
x’ùl_ıum­
 
	mıum­
;

286 
x’_domùl_vıuaffš™y
 
	tx’_domùl_vıuaffš™y_t
;

287 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_vıuaffš™y_t
);

291 
	sx’_domùl_max_vıus
 {

292 
ušt32_t
 
	mmax
;

294 
x’_domùl_max_vıus
 
	tx’_domùl_max_vıus_t
;

295 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_max_vıus_t
);

300 
	#XEN_SCHEDULER_SEDF
 4

	)

301 
	#XEN_SCHEDULER_CREDIT
 5

	)

302 
	#XEN_SCHEDULER_CREDIT2
 6

	)

303 
	#XEN_SCHEDULER_ARINC653
 7

	)

305 
	#XEN_DOMCTL_SCHEDOP_putšfo
 0

	)

306 
	#XEN_DOMCTL_SCHEDOP_g‘šfo
 1

	)

307 
	sx’_domùl_scheduËr_İ
 {

308 
ušt32_t
 
	msched_id
;

309 
ušt32_t
 
	mcmd
;

311 
	sx’_domùl_sched_£df
 {

312 
ušt64_®igÃd_t
 
	m³riod
;

313 
ušt64_®igÃd_t
 
	m¦iû
;

314 
ušt64_®igÃd_t
 
	mÏ‹ncy
;

315 
ušt32_t
 
	mexŒ©ime
;

316 
ušt32_t
 
	mweight
;

317 } 
	m£df
;

318 
	sx’_domùl_sched_üed™
 {

319 
ušt16_t
 
	mweight
;

320 
ušt16_t
 
	mÿp
;

321 } 
	müed™
;

322 
	sx’_domùl_sched_üed™2
 {

323 
ušt16_t
 
	mweight
;

324 } 
	müed™2
;

325 } 
	mu
;

327 
x’_domùl_scheduËr_İ
 
	tx’_domùl_scheduËr_İ_t
;

328 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_scheduËr_İ_t
);

332 
	sx’_domùl_£tdomašhªdË
 {

333 
x’_domaš_hªdË_t
 
	mhªdË
;

335 
x’_domùl_£tdomašhªdË
 
	tx’_domùl_£tdomašhªdË_t
;

336 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£tdomašhªdË_t
);

340 
	sx’_domùl_£tdebuggšg
 {

341 
ušt8_t
 
	m’abË
;

343 
x’_domùl_£tdebuggšg
 
	tx’_domùl_£tdebuggšg_t
;

344 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£tdebuggšg_t
);

348 
	sx’_domùl_œq_³rmissiÚ
 {

349 
ušt8_t
 
	mpœq
;

350 
ušt8_t
 
	m®low_acûss
;

352 
x’_domùl_œq_³rmissiÚ
 
	tx’_domùl_œq_³rmissiÚ_t
;

353 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_œq_³rmissiÚ_t
);

357 
	sx’_domùl_iomem_³rmissiÚ
 {

358 
ušt64_®igÃd_t
 
	mfœ¡_mâ
;

359 
ušt64_®igÃd_t
 
	mÄ_mâs
;

360 
ušt8_t
 
	m®low_acûss
;

362 
x’_domùl_iomem_³rmissiÚ
 
	tx’_domùl_iomem_³rmissiÚ_t
;

363 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_iomem_³rmissiÚ_t
);

367 
	sx’_domùl_iİÜt_³rmissiÚ
 {

368 
ušt32_t
 
	mfœ¡_pÜt
;

369 
ušt32_t
 
	mÄ_pÜts
;

370 
ušt8_t
 
	m®low_acûss
;

372 
x’_domùl_iİÜt_³rmissiÚ
 
	tx’_domùl_iİÜt_³rmissiÚ_t
;

373 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_iİÜt_³rmissiÚ_t
);

377 
	sx’_domùl_hy³rÿÎ_š™
 {

378 
ušt64_®igÃd_t
 
	mgmâ
;

380 
x’_domùl_hy³rÿÎ_š™
 
	tx’_domùl_hy³rÿÎ_š™_t
;

381 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_hy³rÿÎ_š™_t
);

385 
	#_XEN_DOMAINSETUP_hvm_gue¡
 0

	)

386 
	#XEN_DOMAINSETUP_hvm_gue¡
 (1UL<<
_XEN_DOMAINSETUP_hvm_gue¡
)

	)

387 
	#_XEN_DOMAINSETUP_qu”y
 1

	)

388 
	#XEN_DOMAINSETUP_qu”y
 (1UL<<
_XEN_DOMAINSETUP_qu”y
)

	)

389 
	#_XEN_DOMAINSETUP_siÛmu_gue¡
 2

	)

390 
	#XEN_DOMAINSETUP_siÛmu_gue¡
 (1UL<<
_XEN_DOMAINSETUP_siÛmu_gue¡
)

	)

391 
	sx’_domùl_¬ch_£tup
 {

392 
ušt64_®igÃd_t
 
	mæags
;

393 #ifdeà
__Ÿ64__


394 
ušt64_®igÃd_t
 
	mbp
;

395 
ušt64_®igÃd_t
 
	mmaxmem
;

396 
ušt64_®igÃd_t
 
	mxsi_va
;

397 
ušt32_t
 
	mhy³rÿÎ_imm
;

398 
št8_t
 
	mvh±_size_log2
;

400 } 
	tx’_domùl_¬ch_£tup_t
;

401 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_¬ch_£tup_t
);

405 
	sx’_domùl_£‰imeoff£t
 {

406 
št32_t
 
	mtime_off£t_£cÚds
;

408 
x’_domùl_£‰imeoff£t
 
	tx’_domùl_£‰imeoff£t_t
;

409 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£‰imeoff£t_t
);

413 
	sx’_domùl_hvmcÚ‹xt
 {

414 
ušt32_t
 
	msize
;

415 
XEN_GUEST_HANDLE_64
(
ušt8
è
	mbufãr
;

418 } 
	tx’_domùl_hvmcÚ‹xt_t
;

419 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_hvmcÚ‹xt_t
);

424 
	sx’_domùl_add»ss_size
 {

425 
ušt32_t
 
	msize
;

426 } 
	tx’_domùl_add»ss_size_t
;

427 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_add»ss_size_t
);

431 
	sx’_domùl_»®_mode_¬—
 {

432 
ušt32_t
 
	mlog
;

434 
x’_domùl_»®_mode_¬—
 
	tx’_domùl_»®_mode_¬—_t
;

435 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_»®_mode_¬—_t
);

439 
	#XEN_DOMCTL_SENDTRIGGER_NMI
 0

	)

440 
	#XEN_DOMCTL_SENDTRIGGER_RESET
 1

	)

441 
	#XEN_DOMCTL_SENDTRIGGER_INIT
 2

	)

442 
	#XEN_DOMCTL_SENDTRIGGER_POWER
 3

	)

443 
	#XEN_DOMCTL_SENDTRIGGER_SLEEP
 4

	)

444 
	sx’_domùl_£ndŒigg”
 {

445 
ušt32_t
 
	mŒigg”
;

446 
ušt32_t
 
	mvıu
;

448 
x’_domùl_£ndŒigg”
 
	tx’_domùl_£ndŒigg”_t
;

449 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£ndŒigg”_t
);

456 
	sx’_domùl_assign_deviû
 {

457 
ušt32_t
 
	mmachše_bdf
;

459 
x’_domùl_assign_deviû
 
	tx’_domùl_assign_deviû_t
;

460 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_assign_deviû_t
);

464 
	sx’_domùl_g‘_deviû_group
 {

465 
ušt32_t
 
	mmachše_bdf
;

466 
ušt32_t
 
	mmax_sdevs
;

467 
ušt32_t
 
	mnum_sdevs
;

468 
XEN_GUEST_HANDLE_64
(
ušt32
è
	msdev_¬¿y
;

470 
x’_domùl_g‘_deviû_group
 
	tx’_domùl_g‘_deviû_group_t
;

471 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_g‘_deviû_group_t
);

476 
	e±_œq_ty³_e
 {

477 
	mPT_IRQ_TYPE_PCI
,

478 
	mPT_IRQ_TYPE_ISA
,

479 
	mPT_IRQ_TYPE_MSI
,

480 
	mPT_IRQ_TYPE_MSI_TRANSLATE
,

481 } 
	t±_œq_ty³_t
;

482 
	sx’_domùl_bšd_±_œq
 {

483 
ušt32_t
 
	mmachše_œq
;

484 
±_œq_ty³_t
 
	mœq_ty³
;

485 
ušt32_t
 
	mhvm_domid
;

489 
ušt8_t
 
	mi§_œq
;

490 } 
	mi§
;

492 
ušt8_t
 
	mbus
;

493 
ušt8_t
 
	mdeviû
;

494 
ušt8_t
 
	mštx
;

495 } 
	mpci
;

497 
ušt8_t
 
	mgvec
;

498 
ušt32_t
 
	mgæags
;

499 
ušt64_®igÃd_t
 
	mgbË
;

500 } 
	mmsi
;

501 } 
	mu
;

503 
x’_domùl_bšd_±_œq
 
	tx’_domùl_bšd_±_œq_t
;

504 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_bšd_±_œq_t
);

509 
	#DPCI_ADD_MAPPING
 1

	)

510 
	#DPCI_REMOVE_MAPPING
 0

	)

511 
	sx’_domùl_memÜy_m­pšg
 {

512 
ušt64_®igÃd_t
 
	mfœ¡_gâ
;

513 
ušt64_®igÃd_t
 
	mfœ¡_mâ
;

514 
ušt64_®igÃd_t
 
	mÄ_mâs
;

515 
ušt32_t
 
	madd_m­pšg
;

516 
ušt32_t
 
	m·ddšg
;

518 
x’_domùl_memÜy_m­pšg
 
	tx’_domùl_memÜy_m­pšg_t
;

519 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_memÜy_m­pšg_t
);

524 
	sx’_domùl_iİÜt_m­pšg
 {

525 
ušt32_t
 
	mfœ¡_gpÜt
;

526 
ušt32_t
 
	mfœ¡_mpÜt
;

527 
ušt32_t
 
	mÄ_pÜts
;

528 
ušt32_t
 
	madd_m­pšg
;

530 
x’_domùl_iİÜt_m­pšg
 
	tx’_domùl_iİÜt_m­pšg_t
;

531 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_iİÜt_m­pšg_t
);

539 
	#XEN_DOMCTL_MEM_CACHEATTR_UC
 0

	)

540 
	#XEN_DOMCTL_MEM_CACHEATTR_WC
 1

	)

541 
	#XEN_DOMCTL_MEM_CACHEATTR_WT
 4

	)

542 
	#XEN_DOMCTL_MEM_CACHEATTR_WP
 5

	)

543 
	#XEN_DOMCTL_MEM_CACHEATTR_WB
 6

	)

544 
	#XEN_DOMCTL_MEM_CACHEATTR_UCM
 7

	)

545 
	sx’_domùl_pš_mem_ÿch—‰r
 {

546 
ušt64_®igÃd_t
 
	m¡¬t
, 
	m’d
;

547 
ušt32_t
 
	mty³
;

549 
x’_domùl_pš_mem_ÿch—‰r
 
	tx’_domùl_pš_mem_ÿch—‰r_t
;

550 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_pš_mem_ÿch—‰r_t
);

555 
	sx’_domùl_ext_vıucÚ‹xt
 {

557 
ušt32_t
 
	mvıu
;

562 
ušt32_t
 
	msize
;

563 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

566 
ušt64_®igÃd_t
 
	msysÿÎ32_ÿÎback_e
;

567 
ušt64_®igÃd_t
 
	msy£Á”_ÿÎback_e
;

568 
ušt16_t
 
	msysÿÎ32_ÿÎback_cs
;

569 
ušt16_t
 
	msy£Á”_ÿÎback_cs
;

570 
ušt8_t
 
	msysÿÎ32_di§bËs_ev’ts
;

571 
ušt8_t
 
	msy£Á”_di§bËs_ev’ts
;

574 
x’_domùl_ext_vıucÚ‹xt
 
	tx’_domùl_ext_vıucÚ‹xt_t
;

575 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_ext_vıucÚ‹xt_t
);

581 
	sx’_domùl_£t_İt_ã©u»
 {

582 #ià
defšed
(
__Ÿ64__
)

583 
x’_Ÿ64_İt_ã©u»
 
	mİtf
;

586 
ušt64_t
 
	mdummy
;

589 
x’_domùl_£t_İt_ã©u»
 
	tx’_domùl_£t_İt_ã©u»_t
;

590 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£t_İt_ã©u»_t
);

596 
	sx’_domùl_£t_rg‘
 {

597 
domid_t
 
	mrg‘
;

599 
x’_domùl_£t_rg‘
 
	tx’_domùl_£t_rg‘_t
;

600 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£t_rg‘_t
);

602 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

603 
	#XEN_CPUID_INPUT_UNUSED
 0xFFFFFFFF

	)

605 
	sx’_domùl_ıuid
 {

606 
ušt32_t
 
	mšput
[2];

607 
ušt32_t
 
	m—x
;

608 
ušt32_t
 
	mebx
;

609 
ušt32_t
 
	mecx
;

610 
ušt32_t
 
	medx
;

612 
x’_domùl_ıuid
 
	tx’_domùl_ıuid_t
;

613 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_ıuid_t
);

617 
	sx’_domùl_subsüibe
 {

618 
ušt32_t
 
	mpÜt
;

620 
x’_domùl_subsüibe
 
	tx’_domùl_subsüibe_t
;

621 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_subsüibe_t
);

636 
	#XEN_DOMCTL_DEBUG_OP_SINGLE_STEP_OFF
 0

	)

637 
	#XEN_DOMCTL_DEBUG_OP_SINGLE_STEP_ON
 1

	)

638 
	sx’_domùl_debug_İ
 {

639 
ušt32_t
 
	mİ
;

640 
ušt32_t
 
	mvıu
;

642 
x’_domùl_debug_İ
 
	tx’_domùl_debug_İ_t
;

643 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_debug_İ_t
);

649 
	sx’_domùl_hvmcÚ‹xt_·¹Ÿl
 {

650 
ušt32_t
 
	mty³
;

651 
ušt32_t
 
	mš¡ªû
;

652 
XEN_GUEST_HANDLE_64
(
ušt8
è
	mbufãr
;

653 } 
	tx’_domùl_hvmcÚ‹xt_·¹Ÿl_t
;

654 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_hvmcÚ‹xt_·¹Ÿl_t
);

657 
	sx’_domùl_di§bË_mig¿‹
 {

658 
ušt32_t
 
	mdi§bË
;

659 } 
	tx’_domùl_di§bË_mig¿‹_t
;

664 
	sx’_gue¡_tsc_šfo
 {

665 
ušt32_t
 
	mtsc_mode
;

666 
ušt32_t
 
	mgtsc_khz
;

667 
ušt32_t
 
	mšÿº©iÚ
;

668 
ušt32_t
 
	m·d
;

669 
ušt64_®igÃd_t
 
	m–­£d_n£c
;

671 
x’_gue¡_tsc_šfo
 
	tx’_gue¡_tsc_šfo_t
;

672 
DEFINE_XEN_GUEST_HANDLE
(
x’_gue¡_tsc_šfo_t
);

673 
	sx’_domùl_tsc_šfo
 {

674 
XEN_GUEST_HANDLE_64
(
x’_gue¡_tsc_šfo_t
è
	mout_šfo
;

675 
x’_gue¡_tsc_šfo_t
 
	mšfo
;

676 } 
	tx’_domùl_tsc_šfo_t
;

679 
	sx’_domùl_gdbsx_memio
 {

681 
ušt64_®igÃd_t
 
	mpgd3v®
;

682 
ušt64_®igÃd_t
 
	mgva
;

683 
ušt64_®igÃd_t
 
	muva
;

684 
ušt32_t
 
	mËn
;

685 
ušt8_t
 
	mgwr
;

687 
ušt32_t
 
	m»maš
;

692 
	sx’_domùl_gdbsx_·u£uÅ_vıu
 {

693 
ušt32_t
 
	mvıu
;

697 
	sx’_domùl_gdbsx_dom¡©us
 {

699 
ušt8_t
 
	m·u£d
;

700 
ušt32_t
 
	mvıu_id
;

701 
ušt32_t
 
	mvıu_ev
;

711 
	#XEN_DOMCTL_MEM_EVENT_OP_ENABLE
 0

	)

712 
	#XEN_DOMCTL_MEM_EVENT_OP_DISABLE
 1

	)

717 
	#XEN_DOMCTL_MEM_EVENT_OP_PAGING
 1

	)

720 
	#XEN_DOMCTL_MEM_EVENT_OP_PAGING_NOMINATE
 0

	)

721 
	#XEN_DOMCTL_MEM_EVENT_OP_PAGING_EVICT
 1

	)

722 
	#XEN_DOMCTL_MEM_EVENT_OP_PAGING_PREP
 2

	)

723 
	#XEN_DOMCTL_MEM_EVENT_OP_PAGING_RESUME
 3

	)

735 
	#XEN_DOMCTL_MEM_EVENT_OP_ACCESS
 2

	)

736 
	#XEN_DOMCTL_MEM_EVENT_OP_ACCESS_RESUME
 0

	)

738 
	sx’_domùl_mem_ev’t_İ
 {

739 
ušt32_t
 
	mİ
;

740 
ušt32_t
 
	mmode
;

743 
ušt64_®igÃd_t
 
	msh¬ed_addr
;

744 
ušt64_®igÃd_t
 
	mršg_addr
;

747 
ušt64_®igÃd_t
 
	mgâ
;

749 
x’_domùl_mem_ev’t_İ
 
	tx’_domùl_mem_ev’t_İ_t
;

750 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_mem_ev’t_İ_t
);

757 
	#XEN_DOMCTL_MEM_SHARING_OP_CONTROL
 0

	)

758 
	#XEN_DOMCTL_MEM_SHARING_OP_NOMINATE_GFN
 1

	)

759 
	#XEN_DOMCTL_MEM_SHARING_OP_NOMINATE_GREF
 2

	)

760 
	#XEN_DOMCTL_MEM_SHARING_OP_SHARE
 3

	)

761 
	#XEN_DOMCTL_MEM_SHARING_OP_RESUME
 4

	)

762 
	#XEN_DOMCTL_MEM_SHARING_OP_DEBUG_GFN
 5

	)

763 
	#XEN_DOMCTL_MEM_SHARING_OP_DEBUG_MFN
 6

	)

764 
	#XEN_DOMCTL_MEM_SHARING_OP_DEBUG_GREF
 7

	)

766 
	#XEN_DOMCTL_MEM_SHARING_S_HANDLE_INVALID
 (-10)

	)

767 
	#XEN_DOMCTL_MEM_SHARING_C_HANDLE_INVALID
 (-9)

	)

769 
	sx’_domùl_mem_sh¬šg_İ
 {

770 
ušt8_t
 
	mİ
;

773 
ušt8_t
 
	m’abË
;

775 
	smem_sh¬šg_İ_nomš©e
 {

777 
ušt64_®igÃd_t
 
	mgâ
;

778 
ušt32_t
 
	mg¿Á_»f
;

779 } 
	mu
;

780 
ušt64_®igÃd_t
 
	mhªdË
;

781 } 
	mnomš©e
;

782 
	smem_sh¬šg_İ_sh¬e
 {

783 
ušt64_®igÃd_t
 
	msourû_hªdË
;

784 
ušt64_®igÃd_t
 
	mş›Á_hªdË
;

785 } 
	msh¬e
;

786 
	smem_sh¬šg_İ_debug
 {

788 
ušt64_®igÃd_t
 
	mgâ
;

789 
ušt64_®igÃd_t
 
	mmâ
;

790 
g¿Á_»f_t
 
	mg»f
;

791 } 
	mu
;

792 } 
	mdebug
;

793 } 
	mu
;

795 
x’_domùl_mem_sh¬šg_İ
 
	tx’_domùl_mem_sh¬šg_İ_t
;

796 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_mem_sh¬šg_İ_t
);

798 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

801 
	sx’_domùl_vıuext¡©e
 {

803 
ušt32_t
 
	mvıu
;

811 
ušt64_®igÃd_t
 
	mxã©u»_mask
;

816 
ušt64_®igÃd_t
 
	msize
;

817 
XEN_GUEST_HANDLE_64
(
ušt64
è
	mbufãr
;

819 
x’_domùl_vıuext¡©e
 
	tx’_domùl_vıuext¡©e_t
;

820 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_vıuext¡©e_t
);

827 
	sx’_domùl_£t_acûss_»quœed
 {

828 
ušt8_t
 
	macûss_»quœed
;

830 
x’_domùl_£t_acûss_»quœed
 
	tx’_domùl_£t_acûss_»quœed_t
;

831 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_£t_acûss_»quœed_t
);

833 
	sx’_domùl
 {

834 
ušt32_t
 
	mcmd
;

835 
	#XEN_DOMCTL_ü—‹domaš
 1

	)

836 
	#XEN_DOMCTL_de¡roydomaš
 2

	)

837 
	#XEN_DOMCTL_·u£domaš
 3

	)

838 
	#XEN_DOMCTL_uÅau£domaš
 4

	)

839 
	#XEN_DOMCTL_g‘domaššfo
 5

	)

840 
	#XEN_DOMCTL_g‘memli¡
 6

	)

841 
	#XEN_DOMCTL_g‘·geäamešfo
 7

	)

842 
	#XEN_DOMCTL_g‘·geäamešfo2
 8

	)

843 
	#XEN_DOMCTL_£tvıuaffš™y
 9

	)

844 
	#XEN_DOMCTL_shadow_İ
 10

	)

845 
	#XEN_DOMCTL_max_mem
 11

	)

846 
	#XEN_DOMCTL_£tvıucÚ‹xt
 12

	)

847 
	#XEN_DOMCTL_g‘vıucÚ‹xt
 13

	)

848 
	#XEN_DOMCTL_g‘vıušfo
 14

	)

849 
	#XEN_DOMCTL_max_vıus
 15

	)

850 
	#XEN_DOMCTL_scheduËr_İ
 16

	)

851 
	#XEN_DOMCTL_£tdomašhªdË
 17

	)

852 
	#XEN_DOMCTL_£tdebuggšg
 18

	)

853 
	#XEN_DOMCTL_œq_³rmissiÚ
 19

	)

854 
	#XEN_DOMCTL_iomem_³rmissiÚ
 20

	)

855 
	#XEN_DOMCTL_iİÜt_³rmissiÚ
 21

	)

856 
	#XEN_DOMCTL_hy³rÿÎ_š™
 22

	)

857 
	#XEN_DOMCTL_¬ch_£tup
 23

	)

858 
	#XEN_DOMCTL_£‰imeoff£t
 24

	)

859 
	#XEN_DOMCTL_g‘vıuaffš™y
 25

	)

860 
	#XEN_DOMCTL_»®_mode_¬—
 26

	)

861 
	#XEN_DOMCTL_»sumedomaš
 27

	)

862 
	#XEN_DOMCTL_£ndŒigg”
 28

	)

863 
	#XEN_DOMCTL_subsüibe
 29

	)

864 
	#XEN_DOMCTL_g‘hvmcÚ‹xt
 33

	)

865 
	#XEN_DOMCTL_£thvmcÚ‹xt
 34

	)

866 
	#XEN_DOMCTL_£t_add»ss_size
 35

	)

867 
	#XEN_DOMCTL_g‘_add»ss_size
 36

	)

868 
	#XEN_DOMCTL_assign_deviû
 37

	)

869 
	#XEN_DOMCTL_bšd_±_œq
 38

	)

870 
	#XEN_DOMCTL_memÜy_m­pšg
 39

	)

871 
	#XEN_DOMCTL_iİÜt_m­pšg
 40

	)

872 
	#XEN_DOMCTL_pš_mem_ÿch—‰r
 41

	)

873 
	#XEN_DOMCTL_£t_ext_vıucÚ‹xt
 42

	)

874 
	#XEN_DOMCTL_g‘_ext_vıucÚ‹xt
 43

	)

875 
	#XEN_DOMCTL_£t_İt_ã©u»
 44

	)

876 
	#XEN_DOMCTL_‹¡_assign_deviû
 45

	)

877 
	#XEN_DOMCTL_£t_rg‘
 46

	)

878 
	#XEN_DOMCTL_d—ssign_deviû
 47

	)

879 
	#XEN_DOMCTL_unbšd_±_œq
 48

	)

880 
	#XEN_DOMCTL_£t_ıuid
 49

	)

881 
	#XEN_DOMCTL_g‘_deviû_group
 50

	)

882 
	#XEN_DOMCTL_£t_machše_add»ss_size
 51

	)

883 
	#XEN_DOMCTL_g‘_machše_add»ss_size
 52

	)

884 
	#XEN_DOMCTL_suµ»ss_¥urious_·ge_çuÉs
 53

	)

885 
	#XEN_DOMCTL_debug_İ
 54

	)

886 
	#XEN_DOMCTL_g‘hvmcÚ‹xt_·¹Ÿl
 55

	)

887 
	#XEN_DOMCTL_mem_ev’t_İ
 56

	)

888 
	#XEN_DOMCTL_mem_sh¬šg_İ
 57

	)

889 
	#XEN_DOMCTL_di§bË_mig¿‹
 58

	)

890 
	#XEN_DOMCTL_g‘tscšfo
 59

	)

891 
	#XEN_DOMCTL_£‰scšfo
 60

	)

892 
	#XEN_DOMCTL_g‘·geäamešfo3
 61

	)

893 
	#XEN_DOMCTL_£tvıuext¡©e
 62

	)

894 
	#XEN_DOMCTL_g‘vıuext¡©e
 63

	)

895 
	#XEN_DOMCTL_£t_acûss_»quœed
 64

	)

896 
	#XEN_DOMCTL_gdbsx_gue¡memio
 1000

	)

897 
	#XEN_DOMCTL_gdbsx_·u£vıu
 1001

	)

898 
	#XEN_DOMCTL_gdbsx_uÅau£vıu
 1002

	)

899 
	#XEN_DOMCTL_gdbsx_dom¡©us
 1003

	)

900 
ušt32_t
 
	mš‹rçû_v”siÚ
;

901 
domid_t
 
	mdomaš
;

903 
x’_domùl_ü—‹domaš
 
	mü—‹domaš
;

904 
x’_domùl_g‘domaššfo
 
	mg‘domaššfo
;

905 
x’_domùl_g‘memli¡
 
	mg‘memli¡
;

906 
x’_domùl_g‘·geäamešfo
 
	mg‘·geäamešfo
;

907 
x’_domùl_g‘·geäamešfo2
 
	mg‘·geäamešfo2
;

908 
x’_domùl_g‘·geäamešfo3
 
	mg‘·geäamešfo3
;

909 
x’_domùl_vıuaffš™y
 
	mvıuaffš™y
;

910 
x’_domùl_shadow_İ
 
	mshadow_İ
;

911 
x’_domùl_max_mem
 
	mmax_mem
;

912 
x’_domùl_vıucÚ‹xt
 
	mvıucÚ‹xt
;

913 
x’_domùl_g‘vıušfo
 
	mg‘vıušfo
;

914 
x’_domùl_max_vıus
 
	mmax_vıus
;

915 
x’_domùl_scheduËr_İ
 
	mscheduËr_İ
;

916 
x’_domùl_£tdomašhªdË
 
	m£tdomašhªdË
;

917 
x’_domùl_£tdebuggšg
 
	m£tdebuggšg
;

918 
x’_domùl_œq_³rmissiÚ
 
	mœq_³rmissiÚ
;

919 
x’_domùl_iomem_³rmissiÚ
 
	miomem_³rmissiÚ
;

920 
x’_domùl_iİÜt_³rmissiÚ
 
	miİÜt_³rmissiÚ
;

921 
x’_domùl_hy³rÿÎ_š™
 
	mhy³rÿÎ_š™
;

922 
x’_domùl_¬ch_£tup
 
	m¬ch_£tup
;

923 
x’_domùl_£‰imeoff£t
 
	m£‰imeoff£t
;

924 
x’_domùl_di§bË_mig¿‹
 
	mdi§bË_mig¿‹
;

925 
x’_domùl_tsc_šfo
 
	mtsc_šfo
;

926 
x’_domùl_»®_mode_¬—
 
	m»®_mode_¬—
;

927 
x’_domùl_hvmcÚ‹xt
 
	mhvmcÚ‹xt
;

928 
x’_domùl_hvmcÚ‹xt_·¹Ÿl
 
	mhvmcÚ‹xt_·¹Ÿl
;

929 
x’_domùl_add»ss_size
 
	madd»ss_size
;

930 
x’_domùl_£ndŒigg”
 
	m£ndŒigg”
;

931 
x’_domùl_g‘_deviû_group
 
	mg‘_deviû_group
;

932 
x’_domùl_assign_deviû
 
	massign_deviû
;

933 
x’_domùl_bšd_±_œq
 
	mbšd_±_œq
;

934 
x’_domùl_memÜy_m­pšg
 
	mmemÜy_m­pšg
;

935 
x’_domùl_iİÜt_m­pšg
 
	miİÜt_m­pšg
;

936 
x’_domùl_pš_mem_ÿch—‰r
 
	mpš_mem_ÿch—‰r
;

937 
x’_domùl_ext_vıucÚ‹xt
 
	mext_vıucÚ‹xt
;

938 
x’_domùl_£t_İt_ã©u»
 
	m£t_İt_ã©u»
;

939 
x’_domùl_£t_rg‘
 
	m£t_rg‘
;

940 
x’_domùl_subsüibe
 
	msubsüibe
;

941 
x’_domùl_debug_İ
 
	mdebug_İ
;

942 
x’_domùl_mem_ev’t_İ
 
	mmem_ev’t_İ
;

943 
x’_domùl_mem_sh¬šg_İ
 
	mmem_sh¬šg_İ
;

944 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

945 
x’_domùl_ıuid
 
	mıuid
;

946 
x’_domùl_vıuext¡©e
 
	mvıuext¡©e
;

948 
x’_domùl_£t_acûss_»quœed
 
	macûss_»quœed
;

949 
x’_domùl_gdbsx_memio
 
	mgdbsx_gue¡_memio
;

950 
x’_domùl_gdbsx_·u£uÅ_vıu
 
	mgdbsx_·u£uÅ_vıu
;

951 
x’_domùl_gdbsx_dom¡©us
 
	mgdbsx_dom¡©us
;

952 
ušt8_t
 
	m·d
[128];

953 } 
	mu
;

955 
x’_domùl
 
	tx’_domùl_t
;

956 
DEFINE_XEN_GUEST_HANDLE
(
x’_domùl_t
);

	@/usr/include/xen/event_channel.h

27 #iâdeà
__XEN_PUBLIC_EVENT_CHANNEL_H__


28 
	#__XEN_PUBLIC_EVENT_CHANNEL_H__


	)

30 
	~"x’.h
"

39 
ušt32_t
 
	tevtchn_pÜt_t
;

40 
DEFINE_XEN_GUEST_HANDLE
(
evtchn_pÜt_t
);

50 
	#EVTCHNOP_®loc_unbound
 6

	)

51 
	sevtchn_®loc_unbound
 {

53 
domid_t
 
	mdom
, 
	m»mÙe_dom
;

55 
evtchn_pÜt_t
 
	mpÜt
;

57 
evtchn_®loc_unbound
 
	tevtchn_®loc_unbound_t
;

68 
	#EVTCHNOP_bšd_š‹rdomaš
 0

	)

69 
	sevtchn_bšd_š‹rdomaš
 {

71 
domid_t
 
	m»mÙe_dom
;

72 
evtchn_pÜt_t
 
	m»mÙe_pÜt
;

74 
evtchn_pÜt_t
 
	mloÿl_pÜt
;

76 
evtchn_bšd_š‹rdomaš
 
	tevtchn_bšd_š‹rdomaš_t
;

90 
	#EVTCHNOP_bšd_vœq
 1

	)

91 
	sevtchn_bšd_vœq
 {

93 
ušt32_t
 
	mvœq
;

94 
ušt32_t
 
	mvıu
;

96 
evtchn_pÜt_t
 
	mpÜt
;

98 
evtchn_bšd_vœq
 
	tevtchn_bšd_vœq_t
;

106 
	#EVTCHNOP_bšd_pœq
 2

	)

107 
	sevtchn_bšd_pœq
 {

109 
ušt32_t
 
	mpœq
;

110 
	#BIND_PIRQ__WILL_SHARE
 1

	)

111 
ušt32_t
 
	mæags
;

113 
evtchn_pÜt_t
 
	mpÜt
;

115 
evtchn_bšd_pœq
 
	tevtchn_bšd_pœq_t
;

123 
	#EVTCHNOP_bšd_i
 7

	)

124 
	sevtchn_bšd_i
 {

125 
ušt32_t
 
	mvıu
;

127 
evtchn_pÜt_t
 
	mpÜt
;

129 
evtchn_bšd_i
 
	tevtchn_bšd_i_t
;

136 
	#EVTCHNOP_şo£
 3

	)

137 
	sevtchn_şo£
 {

139 
evtchn_pÜt_t
 
	mpÜt
;

141 
evtchn_şo£
 
	tevtchn_şo£_t
;

147 
	#EVTCHNOP_£nd
 4

	)

148 
	sevtchn_£nd
 {

150 
evtchn_pÜt_t
 
	mpÜt
;

152 
evtchn_£nd
 
	tevtchn_£nd_t
;

162 
	#EVTCHNOP_¡©us
 5

	)

163 
	sevtchn_¡©us
 {

165 
domid_t
 
	mdom
;

166 
evtchn_pÜt_t
 
	mpÜt
;

168 
	#EVTCHNSTAT_şo£d
 0

	)

169 
	#EVTCHNSTAT_unbound
 1

	)

170 
	#EVTCHNSTAT_š‹rdomaš
 2

	)

171 
	#EVTCHNSTAT_pœq
 3

	)

172 
	#EVTCHNSTAT_vœq
 4

	)

173 
	#EVTCHNSTAT_i
 5

	)

174 
ušt32_t
 
	m¡©us
;

175 
ušt32_t
 
	mvıu
;

178 
domid_t
 
	mdom
;

179 } 
	munbound
;

181 
domid_t
 
	mdom
;

182 
evtchn_pÜt_t
 
	mpÜt
;

183 } 
	mš‹rdomaš
;

184 
ušt32_t
 
	mpœq
;

185 
ušt32_t
 
	mvœq
;

186 } 
	mu
;

188 
evtchn_¡©us
 
	tevtchn_¡©us_t
;

202 
	#EVTCHNOP_bšd_vıu
 8

	)

203 
	sevtchn_bšd_vıu
 {

205 
evtchn_pÜt_t
 
	mpÜt
;

206 
ušt32_t
 
	mvıu
;

208 
evtchn_bšd_vıu
 
	tevtchn_bšd_vıu_t
;

214 
	#EVTCHNOP_unmask
 9

	)

215 
	sevtchn_unmask
 {

217 
evtchn_pÜt_t
 
	mpÜt
;

219 
evtchn_unmask
 
	tevtchn_unmask_t
;

227 
	#EVTCHNOP_»£t
 10

	)

228 
	sevtchn_»£t
 {

230 
domid_t
 
	mdom
;

232 
evtchn_»£t
 
	tevtchn_»£t_t
;

238 
	sevtchn_İ
 {

239 
ušt32_t
 
	mcmd
;

241 
evtchn_®loc_unbound
 
	m®loc_unbound
;

242 
evtchn_bšd_š‹rdomaš
 
	mbšd_š‹rdomaš
;

243 
evtchn_bšd_vœq
 
	mbšd_vœq
;

244 
evtchn_bšd_pœq
 
	mbšd_pœq
;

245 
evtchn_bšd_i
 
	mbšd_i
;

246 
evtchn_şo£
 
	mşo£
;

247 
evtchn_£nd
 
	m£nd
;

248 
evtchn_¡©us
 
	m¡©us
;

249 
evtchn_bšd_vıu
 
	mbšd_vıu
;

250 
evtchn_unmask
 
	munmask
;

251 } 
	mu
;

253 
evtchn_İ
 
	tevtchn_İ_t
;

254 
DEFINE_XEN_GUEST_HANDLE
(
evtchn_İ_t
);

	@/usr/include/xen/foreign/x86_32.h

7 #iâdeà
__FOREIGN_X86_32_H__


8 
	#__FOREIGN_X86_32_H__
 1

	)

11 
	#__i386___X86_32
 1

	)

12 #´agm¨
·ck
(4)

14 
	#FLAT_RING1_CS_X86_32
 0xe019

	)

15 
	#FLAT_RING1_DS_X86_32
 0xe021

	)

16 
	#FLAT_RING1_SS_X86_32
 0xe021

	)

17 
	#FLAT_KERNEL_CS_X86_32
 
FLAT_RING1_CS_X86_32


	)

18 
	#FLAT_KERNEL_DS_X86_32
 
FLAT_RING1_DS_X86_32


	)

19 
	#FLAT_KERNEL_SS_X86_32
 
FLAT_RING1_SS_X86_32


	)

20 
	#x’_pâ_to_ü3_x86_32
(
pâ
è((()Õâè<< 12è| (()Õâè>> 20))

	)

21 
	#x’_ü3_to_pâ_x86_32
(
ü3
è((()(ü3è>> 12è| (()(ü3è<< 20))

	)

22 
	#XEN_LEGACY_MAX_VCPUS_X86_32
 32

	)

23 
	#_VGCF_i387_v®id_X86_32
 0

	)

24 
	#VGCF_i387_v®id_X86_32
 (1<<
_VGCF_i387_v®id_X86_32
)

	)

25 
	#_VGCF_š_k”Ãl_X86_32
 2

	)

26 
	#VGCF_š_k”Ãl_X86_32
 (1<<
_VGCF_š_k”Ãl_X86_32
)

	)

27 
	#_VGCF_ç§ã_di§bËs_ev’ts_X86_32
 3

	)

28 
	#VGCF_ç§ã_di§bËs_ev’ts_X86_32
 (1<<
_VGCF_ç§ã_di§bËs_ev’ts_X86_32
)

	)

29 
	#_VGCF_sysÿÎ_di§bËs_ev’ts_X86_32
 4

	)

30 
	#VGCF_sysÿÎ_di§bËs_ev’ts_X86_32
 (1<<
_VGCF_sysÿÎ_di§bËs_ev’ts_X86_32
)

	)

31 
	#_VGCF_Úlše_X86_32
 5

	)

32 
	#VGCF_Úlše_X86_32
 (1<<
_VGCF_Úlše_X86_32
)

	)

33 
	#MAX_GUEST_CMDLINE_X86_32
 1024

	)

35 
	#x86_32_has_no_vıu_ü_»gs
 1

	)

37 
	#x86_32_has_no_vıu_¬_»gs
 1

	)

39 
	s¡¬t_šfo_x86_32
 {

40 
	mmagic
[32];

41 
ušt32_t
 
	mÄ_·ges
;

42 
ušt32_t
 
	msh¬ed_šfo
;

43 
ušt32_t
 
	mæags
;

44 
ušt32_t
 
	m¡Üe_mâ
;

45 
ušt32_t
 
	m¡Üe_evtchn
;

48 
ušt32_t
 
	mmâ
;

49 
ušt32_t
 
	mevtchn
;

50 } 
	mdomU
;

52 
ušt32_t
 
	mšfo_off
;

53 
ušt32_t
 
	mšfo_size
;

54 } 
	mdom0
;

55 } 
	mcÚsŞe
;

56 
ušt32_t
 
	m±_ba£
;

57 
ušt32_t
 
	mÄ_±_äames
;

58 
ušt32_t
 
	mmâ_li¡
;

59 
ušt32_t
 
	mmod_¡¬t
;

60 
ušt32_t
 
	mmod_Ën
;

61 
št8_t
 
	mcmd_lše
[
MAX_GUEST_CMDLINE_X86_32
];

62 
ušt32_t
 
	mfœ¡_p2m_pâ
;

63 
ušt32_t
 
	mÄ_p2m_äames
;

65 
¡¬t_šfo_x86_32
 
	t¡¬t_šfo_x86_32_t
;

67 
	sŒ­_šfo_x86_32
 {

68 
ušt8_t
 
	mveùÜ
;

69 
ušt8_t
 
	mæags
;

70 
ušt16_t
 
	mcs
;

71 
ušt32_t
 
	madd»ss
;

73 
Œ­_šfo_x86_32
 
	tŒ­_šfo_x86_32_t
;

75 
	#x86_32_has_no_±_å»g
 1

	)

77 
	sıu_u£r_»gs_x86_32
 {

78 
ušt32_t
 
	mebx
;

79 
ušt32_t
 
	mecx
;

80 
ušt32_t
 
	medx
;

81 
ušt32_t
 
	mesi
;

82 
ušt32_t
 
	medi
;

83 
ušt32_t
 
	mebp
;

84 
ušt32_t
 
	m—x
;

85 
ušt16_t
 
	m”rÜ_code
;

86 
ušt16_t
 
	m’Œy_veùÜ
;

87 
ušt32_t
 
	me
;

88 
ušt16_t
 
	mcs
;

89 
ušt8_t
 
	m§ved_upÿÎ_mask
;

90 
ušt8_t
 
	m_·d0
;

91 
ušt32_t
 
	meæags
;

92 
ušt32_t
 
	me¥
;

93 
ušt16_t
 
	mss
, 
	m_·d1
;

94 
ušt16_t
 
	mes
, 
	m_·d2
;

95 
ušt16_t
 
	mds
, 
	m_·d3
;

96 
ušt16_t
 
	mfs
, 
	m_·d4
;

97 
ušt16_t
 
	mgs
, 
	m_·d5
;

99 
ıu_u£r_»gs_x86_32
 
	tıu_u£r_»gs_x86_32_t
;

101 
	#x86_32_has_no_x’_Ÿ64_boÙ_·¿m
 1

	)

103 
	#x86_32_has_no_Ÿ64_Œ_’Œy
 1

	)

105 
	#x86_32_has_no_vıu_Œ_»gs
 1

	)

107 
	#x86_32_has_no_vıu_gue¡_cÚ‹xt_»gs
 1

	)

109 
	svıu_gue¡_cÚ‹xt_x86_32
 {

110 ¡ruù { 
	mx
[512]; } 
	måu_ùxt
;

111 
ušt32_t
 
	mæags
;

112 
ıu_u£r_»gs_x86_32
 
	mu£r_»gs
;

113 
Œ­_šfo_x86_32
 
	mŒ­_ùxt
[256];

114 
ušt32_t
 
	mldt_ba£
, 
	mldt_’ts
;

115 
ušt32_t
 
	mgdt_äames
[16], 
	mgdt_’ts
;

116 
ušt32_t
 
	mk”Ãl_ss
, 
	mk”Ãl_¥
;

117 
ušt32_t
 
	mù¾»g
[8];

118 
ušt32_t
 
	mdebug»g
[8];

119 #ifdeà
__i386___X86_32


120 
ušt32_t
 
	mev’t_ÿÎback_cs
;

121 
ušt32_t
 
	mev’t_ÿÎback_e
;

122 
ušt32_t
 
	mç§ã_ÿÎback_cs
;

123 
ušt32_t
 
	mç§ã_ÿÎback_e
;

125 
ušt32_t
 
	mev’t_ÿÎback_e
;

126 
ušt32_t
 
	mç§ã_ÿÎback_e
;

127 #ifdeà
__XEN__


129 
ušt32_t
 
	msysÿÎ_ÿÎback_e
;

131 
	mev’t_ÿÎback_cs
;

132 
	mç§ã_ÿÎback_cs
;

136 
ušt32_t
 
	msysÿÎ_ÿÎback_e
;

139 
ušt32_t
 
	mvm_assi¡
;

140 #ifdeà
__x86_64___X86_32


141 
ušt64_t
 
	mfs_ba£
;

142 
ušt64_t
 
	mgs_ba£_k”Ãl
;

143 
ušt64_t
 
	mgs_ba£_u£r
;

146 
vıu_gue¡_cÚ‹xt_x86_32
 
	tvıu_gue¡_cÚ‹xt_x86_32_t
;

148 
	s¬ch_vıu_šfo_x86_32
 {

149 
ušt32_t
 
	mü2
;

150 
ušt32_t
 
	m·d
[5];

152 
¬ch_vıu_šfo_x86_32
 
	t¬ch_vıu_šfo_x86_32_t
;

154 
	svıu_time_šfo_x86_32
 {

155 
ušt32_t
 
	mv”siÚ
;

156 
ušt32_t
 
	m·d0
;

157 
ušt64_t
 
	mtsc_time¡amp
;

158 
ušt64_t
 
	msy¡em_time
;

159 
ušt32_t
 
	mtsc_to_sy¡em_mul
;

160 
št8_t
 
	mtsc_shiá
;

161 
št8_t
 
	m·d1
[3];

163 
vıu_time_šfo_x86_32
 
	tvıu_time_šfo_x86_32_t
;

165 
	svıu_šfo_x86_32
 {

166 
ušt8_t
 
	mevtchn_upÿÎ_³ndšg
;

167 
ušt8_t
 
	mevtchn_upÿÎ_mask
;

168 
ušt32_t
 
	mevtchn_³ndšg_£l
;

169 
¬ch_vıu_šfo_x86_32
 
	m¬ch
;

170 
vıu_time_šfo_x86_32
 
	mtime
;

172 
vıu_šfo_x86_32
 
	tvıu_šfo_x86_32_t
;

174 
	s¬ch_sh¬ed_šfo_x86_32
 {

175 
ušt32_t
 
	mmax_pâ
;

176 
ušt32_t
 
	mpâ_to_mâ_äame_li¡_li¡
;

177 
ušt32_t
 
	mnmi_»asÚ
;

178 
ušt64_t
 
	m·d
[32];

180 
¬ch_sh¬ed_šfo_x86_32
 
	t¬ch_sh¬ed_šfo_x86_32_t
;

182 
	ssh¬ed_šfo_x86_32
 {

183 
vıu_šfo_x86_32
 
	mvıu_šfo
[
XEN_LEGACY_MAX_VCPUS_X86_32
];

184 
ušt32_t
 
	mevtchn_³ndšg
[(uint32_t) * 8];

185 
ušt32_t
 
	mevtchn_mask
[(uint32_t) * 8];

186 
ušt32_t
 
	mwc_v”siÚ
;

187 
ušt32_t
 
	mwc_£c
;

188 
ušt32_t
 
	mwc_n£c
;

189 
¬ch_sh¬ed_šfo_x86_32
 
	m¬ch
;

191 
sh¬ed_šfo_x86_32
 
	tsh¬ed_šfo_x86_32_t
;

194 #´agm¨
·ck
()

	@/usr/include/xen/foreign/x86_64.h

7 #iâdeà
__FOREIGN_X86_64_H__


8 
	#__FOREIGN_X86_64_H__
 1

	)

11 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

12 
	#__DECL_REG
(
Çme
èuniÚ { 
ušt64_t
 
r
 ##‚ame, 
e
 ##‚ame; }

	)

13 
	#__®ign8__
 
	`__©Œibu‹__
((
	`®igÃd
 (8)))

	)

15 
	#__DECL_REG
(
Çme
è
ušt64_t
 
r
 ## 
	)
name

16 
	#__®ign8__
 
FIXME


	)

18 
	#__x86_64___X86_64
 1

	)

20 
	#FLAT_RING3_CS64_X86_64
 0xe033

	)

21 
	#FLAT_RING3_DS64_X86_64
 0x0000

	)

22 
	#FLAT_RING3_SS64_X86_64
 0xe02b

	)

23 
	#FLAT_KERNEL_DS64_X86_64
 
FLAT_RING3_DS64_X86_64


	)

24 
	#FLAT_KERNEL_DS_X86_64
 
FLAT_KERNEL_DS64_X86_64


	)

25 
	#FLAT_KERNEL_CS64_X86_64
 
FLAT_RING3_CS64_X86_64


	)

26 
	#FLAT_KERNEL_CS_X86_64
 
FLAT_KERNEL_CS64_X86_64


	)

27 
	#FLAT_KERNEL_SS64_X86_64
 
FLAT_RING3_SS64_X86_64


	)

28 
	#FLAT_KERNEL_SS_X86_64
 
FLAT_KERNEL_SS64_X86_64


	)

29 
	#x’_pâ_to_ü3_x86_64
(
pâ
è((
__®ign8__
 
ušt64_t
)Õâè<< 12)

	)

30 
	#x’_ü3_to_pâ_x86_64
(
ü3
è((
__®ign8__
 
ušt64_t
)(ü3è>> 12)

	)

31 
	#XEN_LEGACY_MAX_VCPUS_X86_64
 32

	)

32 
	#_VGCF_i387_v®id_X86_64
 0

	)

33 
	#VGCF_i387_v®id_X86_64
 (1<<
_VGCF_i387_v®id_X86_64
)

	)

34 
	#_VGCF_š_k”Ãl_X86_64
 2

	)

35 
	#VGCF_š_k”Ãl_X86_64
 (1<<
_VGCF_š_k”Ãl_X86_64
)

	)

36 
	#_VGCF_ç§ã_di§bËs_ev’ts_X86_64
 3

	)

37 
	#VGCF_ç§ã_di§bËs_ev’ts_X86_64
 (1<<
_VGCF_ç§ã_di§bËs_ev’ts_X86_64
)

	)

38 
	#_VGCF_sysÿÎ_di§bËs_ev’ts_X86_64
 4

	)

39 
	#VGCF_sysÿÎ_di§bËs_ev’ts_X86_64
 (1<<
_VGCF_sysÿÎ_di§bËs_ev’ts_X86_64
)

	)

40 
	#_VGCF_Úlše_X86_64
 5

	)

41 
	#VGCF_Úlše_X86_64
 (1<<
_VGCF_Úlše_X86_64
)

	)

42 
	#MAX_GUEST_CMDLINE_X86_64
 1024

	)

44 
	#x86_64_has_no_vıu_ü_»gs
 1

	)

46 
	#x86_64_has_no_vıu_¬_»gs
 1

	)

48 
	s¡¬t_šfo_x86_64
 {

49 
	mmagic
[32];

50 
__®ign8__
 
ušt64_t
 
	mÄ_·ges
;

51 
__®ign8__
 
ušt64_t
 
	msh¬ed_šfo
;

52 
ušt32_t
 
	mæags
;

53 
__®ign8__
 
ušt64_t
 
	m¡Üe_mâ
;

54 
ušt32_t
 
	m¡Üe_evtchn
;

57 
__®ign8__
 
ušt64_t
 
	mmâ
;

58 
ušt32_t
 
	mevtchn
;

59 } 
	mdomU
;

61 
ušt32_t
 
	mšfo_off
;

62 
ušt32_t
 
	mšfo_size
;

63 } 
	mdom0
;

64 } 
	mcÚsŞe
;

65 
__®ign8__
 
ušt64_t
 
	m±_ba£
;

66 
__®ign8__
 
ušt64_t
 
	mÄ_±_äames
;

67 
__®ign8__
 
ušt64_t
 
	mmâ_li¡
;

68 
__®ign8__
 
ušt64_t
 
	mmod_¡¬t
;

69 
__®ign8__
 
ušt64_t
 
	mmod_Ën
;

70 
št8_t
 
	mcmd_lše
[
MAX_GUEST_CMDLINE_X86_64
];

71 
__®ign8__
 
ušt64_t
 
	mfœ¡_p2m_pâ
;

72 
__®ign8__
 
ušt64_t
 
	mÄ_p2m_äames
;

74 
¡¬t_šfo_x86_64
 
	t¡¬t_šfo_x86_64_t
;

76 
	sŒ­_šfo_x86_64
 {

77 
ušt8_t
 
	mveùÜ
;

78 
ušt8_t
 
	mæags
;

79 
ušt16_t
 
	mcs
;

80 
__®ign8__
 
ušt64_t
 
	madd»ss
;

82 
Œ­_šfo_x86_64
 
	tŒ­_šfo_x86_64_t
;

84 
	#x86_64_has_no_±_å»g
 1

	)

86 
	sıu_u£r_»gs_x86_64
 {

87 
ušt64_t
 
	mr15
;

88 
ušt64_t
 
	mr14
;

89 
ušt64_t
 
	mr13
;

90 
ušt64_t
 
	mr12
;

91 
__DECL_REG
(
bp
);

92 
__DECL_REG
(
bx
);

93 
ušt64_t
 
	mr11
;

94 
ušt64_t
 
	mr10
;

95 
ušt64_t
 
	mr9
;

96 
ušt64_t
 
	mr8
;

97 
__DECL_REG
(
ax
);

98 
__DECL_REG
(
cx
);

99 
__DECL_REG
(
dx
);

100 
__DECL_REG
(
si
);

101 
__DECL_REG
(
di
);

102 
ušt32_t
 
	m”rÜ_code
;

103 
ušt32_t
 
	m’Œy_veùÜ
;

104 
__DECL_REG
(

);

105 
ušt16_t
 
	mcs
, 
	m_·d0
[1];

106 
ušt8_t
 
	m§ved_upÿÎ_mask
;

107 
ušt8_t
 
	m_·d1
[3];

108 
__DECL_REG
(
æags
);

109 
__DECL_REG
(
¥
);

110 
ušt16_t
 
	mss
, 
	m_·d2
[3];

111 
ušt16_t
 
	mes
, 
	m_·d3
[3];

112 
ušt16_t
 
	mds
, 
	m_·d4
[3];

113 
ušt16_t
 
	mfs
, 
	m_·d5
[3];

114 
ušt16_t
 
	mgs
, 
	m_·d6
[3];

116 
ıu_u£r_»gs_x86_64
 
	tıu_u£r_»gs_x86_64_t
;

118 
	#x86_64_has_no_x’_Ÿ64_boÙ_·¿m
 1

	)

120 
	#x86_64_has_no_Ÿ64_Œ_’Œy
 1

	)

122 
	#x86_64_has_no_vıu_Œ_»gs
 1

	)

124 
	#x86_64_has_no_vıu_gue¡_cÚ‹xt_»gs
 1

	)

126 
	svıu_gue¡_cÚ‹xt_x86_64
 {

127 ¡ruù { 
	mx
[512]; } 
	måu_ùxt
;

128 
__®ign8__
 
ušt64_t
 
	mæags
;

129 
ıu_u£r_»gs_x86_64
 
	mu£r_»gs
;

130 
Œ­_šfo_x86_64
 
	mŒ­_ùxt
[256];

131 
__®ign8__
 
ušt64_t
 
	mldt_ba£
, 
	mldt_’ts
;

132 
__®ign8__
 
ušt64_t
 
	mgdt_äames
[16], 
	mgdt_’ts
;

133 
__®ign8__
 
ušt64_t
 
	mk”Ãl_ss
, 
	mk”Ãl_¥
;

134 
__®ign8__
 
ušt64_t
 
	mù¾»g
[8];

135 
__®ign8__
 
ušt64_t
 
	mdebug»g
[8];

136 #ifdeà
__i386___X86_64


137 
__®ign8__
 
ušt64_t
 
	mev’t_ÿÎback_cs
;

138 
__®ign8__
 
ušt64_t
 
	mev’t_ÿÎback_e
;

139 
__®ign8__
 
ušt64_t
 
	mç§ã_ÿÎback_cs
;

140 
__®ign8__
 
ušt64_t
 
	mç§ã_ÿÎback_e
;

142 
__®ign8__
 
ušt64_t
 
	mev’t_ÿÎback_e
;

143 
__®ign8__
 
ušt64_t
 
	mç§ã_ÿÎback_e
;

144 #ifdeà
__XEN__


146 
__®ign8__
 
ušt64_t
 
	msysÿÎ_ÿÎback_e
;

148 
	mev’t_ÿÎback_cs
;

149 
	mç§ã_ÿÎback_cs
;

153 
__®ign8__
 
ušt64_t
 
	msysÿÎ_ÿÎback_e
;

156 
__®ign8__
 
ušt64_t
 
	mvm_assi¡
;

157 #ifdeà
__x86_64___X86_64


158 
ušt64_t
 
	mfs_ba£
;

159 
ušt64_t
 
	mgs_ba£_k”Ãl
;

160 
ušt64_t
 
	mgs_ba£_u£r
;

163 
vıu_gue¡_cÚ‹xt_x86_64
 
	tvıu_gue¡_cÚ‹xt_x86_64_t
;

165 
	s¬ch_vıu_šfo_x86_64
 {

166 
__®ign8__
 
ušt64_t
 
	mü2
;

167 
__®ign8__
 
ušt64_t
 
	m·d
;

169 
¬ch_vıu_šfo_x86_64
 
	t¬ch_vıu_šfo_x86_64_t
;

171 
	svıu_time_šfo_x86_64
 {

172 
ušt32_t
 
	mv”siÚ
;

173 
ušt32_t
 
	m·d0
;

174 
ušt64_t
 
	mtsc_time¡amp
;

175 
ušt64_t
 
	msy¡em_time
;

176 
ušt32_t
 
	mtsc_to_sy¡em_mul
;

177 
št8_t
 
	mtsc_shiá
;

178 
št8_t
 
	m·d1
[3];

180 
vıu_time_šfo_x86_64
 
	tvıu_time_šfo_x86_64_t
;

182 
	svıu_šfo_x86_64
 {

183 
ušt8_t
 
	mevtchn_upÿÎ_³ndšg
;

184 
ušt8_t
 
	mevtchn_upÿÎ_mask
;

185 
__®ign8__
 
ušt64_t
 
	mevtchn_³ndšg_£l
;

186 
¬ch_vıu_šfo_x86_64
 
	m¬ch
;

187 
vıu_time_šfo_x86_64
 
	mtime
;

189 
vıu_šfo_x86_64
 
	tvıu_šfo_x86_64_t
;

191 
	s¬ch_sh¬ed_šfo_x86_64
 {

192 
__®ign8__
 
ušt64_t
 
	mmax_pâ
;

193 
__®ign8__
 
ušt64_t
 
	mpâ_to_mâ_äame_li¡_li¡
;

194 
__®ign8__
 
ušt64_t
 
	mnmi_»asÚ
;

195 
ušt64_t
 
	m·d
[32];

197 
¬ch_sh¬ed_šfo_x86_64
 
	t¬ch_sh¬ed_šfo_x86_64_t
;

199 
	ssh¬ed_šfo_x86_64
 {

200 
vıu_šfo_x86_64
 
	mvıu_šfo
[
XEN_LEGACY_MAX_VCPUS_X86_64
];

201 
__®ign8__
 
ušt64_t
 
	mevtchn_³ndšg
[(__align8__ uint64_t) * 8];

202 
__®ign8__
 
ušt64_t
 
	mevtchn_mask
[(__align8__ uint64_t) * 8];

203 
ušt32_t
 
	mwc_v”siÚ
;

204 
ušt32_t
 
	mwc_£c
;

205 
ušt32_t
 
	mwc_n£c
;

206 
¬ch_sh¬ed_šfo_x86_64
 
	m¬ch
;

208 
sh¬ed_šfo_x86_64
 
	tsh¬ed_šfo_x86_64_t
;

	@/usr/include/xen/grant_table.h

28 #iâdeà
__XEN_PUBLIC_GRANT_TABLE_H__


29 
	#__XEN_PUBLIC_GRANT_TABLE_H__


	)

31 
	~"x’.h
"

90 
ušt32_t
 
	tg¿Á_»f_t
;

103 #ià
__XEN_INTERFACE_VERSION__
 < 0x0003020a

104 
	#g¿Á_’Œy_v1
 
g¿Á_’Œy


	)

105 
	#g¿Á_’Œy_v1_t
 
g¿Á_’Œy_t


	)

107 
	sg¿Á_’Œy_v1
 {

109 
ušt16_t
 
	mæags
;

111 
domid_t
 
	mdomid
;

116 
ušt32_t
 
	mäame
;

118 
g¿Á_’Œy_v1
 
	tg¿Á_’Œy_v1_t
;

129 
	#GTF_šv®id
 (0U<<0)

	)

130 
	#GTF_³rm™_acûss
 (1U<<0)

	)

131 
	#GTF_acû±_Œªsãr
 (2U<<0)

	)

132 
	#GTF_Œªs™ive
 (3U<<0)

	)

133 
	#GTF_ty³_mask
 (3U<<0)

	)

145 
	#_GTF_»adÚly
 (2)

	)

146 
	#GTF_»adÚly
 (1U<<
_GTF_»adÚly
)

	)

147 
	#_GTF_»adšg
 (3)

	)

148 
	#GTF_»adšg
 (1U<<
_GTF_»adšg
)

	)

149 
	#_GTF_wr™šg
 (4)

	)

150 
	#GTF_wr™šg
 (1U<<
_GTF_wr™šg
)

	)

151 
	#_GTF_PWT
 (5)

	)

152 
	#GTF_PWT
 (1U<<
_GTF_PWT
)

	)

153 
	#_GTF_PCD
 (6)

	)

154 
	#GTF_PCD
 (1U<<
_GTF_PCD
)

	)

155 
	#_GTF_PAT
 (7)

	)

156 
	#GTF_PAT
 (1U<<
_GTF_PAT
)

	)

157 
	#_GTF_sub_·ge
 (8)

	)

158 
	#GTF_sub_·ge
 (1U<<
_GTF_sub_·ge
)

	)

170 
	#_GTF_Œªsãr_comm™‹d
 (2)

	)

171 
	#GTF_Œªsãr_comm™‹d
 (1U<<
_GTF_Œªsãr_comm™‹d
)

	)

172 
	#_GTF_Œªsãr_com¶‘ed
 (3)

	)

173 
	#GTF_Œªsãr_com¶‘ed
 (1U<<
_GTF_Œªsãr_com¶‘ed
)

	)

184 #ià
__XEN_INTERFACE_VERSION__
 >= 0x0003020a

190 
	sg¿Á_’Œy_h—d”
 {

191 
ušt16_t
 
	mæags
;

192 
domid_t
 
	mdomid
;

194 
g¿Á_’Œy_h—d”
 
	tg¿Á_’Œy_h—d”_t
;

199 
	ug¿Á_’Œy_v2
 {

200 
g¿Á_’Œy_h—d”_t
 
	mhdr
;

212 
g¿Á_’Œy_h—d”_t
 
	mhdr
;

213 
ušt32_t
 
	m·d0
;

214 
ušt64_t
 
	mäame
;

215 } 
	mfuÎ_·ge
;

223 
g¿Á_’Œy_h—d”_t
 
	mhdr
;

224 
ušt16_t
 
	m·ge_off
;

225 
ušt16_t
 
	mËngth
;

226 
ušt64_t
 
	mäame
;

227 } 
	msub_·ge
;

239 
g¿Á_’Œy_h—d”_t
 
	mhdr
;

240 
domid_t
 
	mŒªs_domid
;

241 
ušt16_t
 
	m·d0
;

242 
g¿Á_»f_t
 
	mg»f
;

243 } 
	mŒªs™ive
;

245 
ušt32_t
 
	m__¥aûr
[4];

247 
g¿Á_’Œy_v2
 
	tg¿Á_’Œy_v2_t
;

249 
ušt16_t
 
	tg¿Á_¡©us_t
;

260 
ušt32_t
 
	tg¿Á_hªdË_t
;

279 
	#GNTTABOP_m­_g¿Á_»f
 0

	)

280 
	sgÁb_m­_g¿Á_»f
 {

282 
ušt64_t
 
	mho¡_addr
;

283 
ušt32_t
 
	mæags
;

284 
g¿Á_»f_t
 
	m»f
;

285 
domid_t
 
	mdom
;

287 
št16_t
 
	m¡©us
;

288 
g¿Á_hªdË_t
 
	mhªdË
;

289 
ušt64_t
 
	mdev_bus_addr
;

291 
gÁb_m­_g¿Á_»f
 
	tgÁb_m­_g¿Á_»f_t
;

292 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_m­_g¿Á_»f_t
);

305 
	#GNTTABOP_unm­_g¿Á_»f
 1

	)

306 
	sgÁb_unm­_g¿Á_»f
 {

308 
ušt64_t
 
	mho¡_addr
;

309 
ušt64_t
 
	mdev_bus_addr
;

310 
g¿Á_hªdË_t
 
	mhªdË
;

312 
št16_t
 
	m¡©us
;

314 
gÁb_unm­_g¿Á_»f
 
	tgÁb_unm­_g¿Á_»f_t
;

315 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_unm­_g¿Á_»f_t
);

326 
	#GNTTABOP_£tup_bË
 2

	)

327 
	sgÁb_£tup_bË
 {

329 
domid_t
 
	mdom
;

330 
ušt32_t
 
	mÄ_äames
;

332 
št16_t
 
	m¡©us
;

333 
XEN_GUEST_HANDLE
(
ulÚg
è
	mäame_li¡
;

335 
gÁb_£tup_bË
 
	tgÁb_£tup_bË_t
;

336 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_£tup_bË_t
);

342 
	#GNTTABOP_dump_bË
 3

	)

343 
	sgÁb_dump_bË
 {

345 
domid_t
 
	mdom
;

347 
št16_t
 
	m¡©us
;

349 
gÁb_dump_bË
 
	tgÁb_dump_bË_t
;

350 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_dump_bË_t
);

360 
	#GNTTABOP_Œªsãr
 4

	)

361 
	sgÁb_Œªsãr
 {

363 
x’_pâ_t
 
	mmâ
;

364 
domid_t
 
	mdomid
;

365 
g¿Á_»f_t
 
	m»f
;

367 
št16_t
 
	m¡©us
;

369 
gÁb_Œªsãr
 
	tgÁb_Œªsãr_t
;

370 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_Œªsãr_t
);

391 
	#_GNTCOPY_sourû_g»f
 (0)

	)

392 
	#GNTCOPY_sourû_g»f
 (1<<
_GNTCOPY_sourû_g»f
)

	)

393 
	#_GNTCOPY_de¡_g»f
 (1)

	)

394 
	#GNTCOPY_de¡_g»f
 (1<<
_GNTCOPY_de¡_g»f
)

	)

395 
	#_GNTCOPY_ÿn_ç
 (2)

	)

396 
	#GNTCOPY_ÿn_ç
 (1<<
_GNTCOPY_ÿn_ç
)

	)

398 
	#GNTTABOP_cİy
 5

	)

399 
	sgÁb_cİy
 {

403 
g¿Á_»f_t
 
	m»f
;

404 
x’_pâ_t
 
	mgmâ
;

405 } 
	mu
;

406 
domid_t
 
	mdomid
;

407 
ušt16_t
 
	moff£t
;

408 } 
	msourû
, 
	mde¡
;

409 
ušt16_t
 
	mËn
;

410 
ušt16_t
 
	mæags
;

412 
št16_t
 
	m¡©us
;

413 } 
	tgÁb_cİy_t
;

414 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_cİy_t
);

423 
	#GNTTABOP_qu”y_size
 6

	)

424 
	sgÁb_qu”y_size
 {

426 
domid_t
 
	mdom
;

428 
ušt32_t
 
	mÄ_äames
;

429 
ušt32_t
 
	mmax_Ä_äames
;

430 
št16_t
 
	m¡©us
;

432 
gÁb_qu”y_size
 
	tgÁb_qu”y_size_t
;

433 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_qu”y_size_t
);

446 
	#GNTTABOP_unm­_ªd_»¶aû
 7

	)

447 
	sgÁb_unm­_ªd_»¶aû
 {

449 
ušt64_t
 
	mho¡_addr
;

450 
ušt64_t
 
	mÃw_addr
;

451 
g¿Á_hªdË_t
 
	mhªdË
;

453 
št16_t
 
	m¡©us
;

455 
gÁb_unm­_ªd_»¶aû
 
	tgÁb_unm­_ªd_»¶aû_t
;

456 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_unm­_ªd_»¶aû_t
);

458 #ià
__XEN_INTERFACE_VERSION__
 >= 0x0003020a

466 
	#GNTTABOP_£t_v”siÚ
 8

	)

467 
	sgÁb_£t_v”siÚ
 {

469 
ušt32_t
 
	mv”siÚ
;

471 
gÁb_£t_v”siÚ
 
	tgÁb_£t_v”siÚ_t
;

472 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_£t_v”siÚ_t
);

487 
	#GNTTABOP_g‘_¡©us_äames
 9

	)

488 
	sgÁb_g‘_¡©us_äames
 {

490 
ušt32_t
 
	mÄ_äames
;

491 
domid_t
 
	mdom
;

493 
št16_t
 
	m¡©us
;

494 
XEN_GUEST_HANDLE
(
ušt64_t
è
	mäame_li¡
;

496 
gÁb_g‘_¡©us_äames
 
	tgÁb_g‘_¡©us_äames_t
;

497 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_g‘_¡©us_äames_t
);

503 
	#GNTTABOP_g‘_v”siÚ
 10

	)

504 
	sgÁb_g‘_v”siÚ
 {

506 
domid_t
 
	mdom
;

507 
ušt16_t
 
	m·d
;

509 
ušt32_t
 
	mv”siÚ
;

511 
gÁb_g‘_v”siÚ
 
	tgÁb_g‘_v”siÚ_t
;

512 
DEFINE_XEN_GUEST_HANDLE
(
gÁb_g‘_v”siÚ_t
);

520 
	#_GNTMAP_deviû_m­
 (0)

	)

521 
	#GNTMAP_deviû_m­
 (1<<
_GNTMAP_deviû_m­
)

	)

523 
	#_GNTMAP_ho¡_m­
 (1)

	)

524 
	#GNTMAP_ho¡_m­
 (1<<
_GNTMAP_ho¡_m­
)

	)

526 
	#_GNTMAP_»adÚly
 (2)

	)

527 
	#GNTMAP_»adÚly
 (1<<
_GNTMAP_»adÚly
)

	)

533 
	#_GNTMAP_­¶iÿtiÚ_m­
 (3)

	)

534 
	#GNTMAP_­¶iÿtiÚ_m­
 (1<<
_GNTMAP_­¶iÿtiÚ_m­
)

	)

541 
	#_GNTMAP_cÚšs_±e
 (4)

	)

542 
	#GNTMAP_cÚšs_±e
 (1<<
_GNTMAP_cÚšs_±e
)

	)

544 
	#_GNTMAP_ÿn_ç
 (5)

	)

545 
	#GNTMAP_ÿn_ç
 (1<<
_GNTMAP_ÿn_ç
)

	)

551 
	#_GNTMAP_gue¡_ava0
 (16)

	)

552 
	#GNTMAP_gue¡_ava_mask
 ((
ušt32_t
)~0 << 
_GNTMAP_gue¡_ava0
)

	)

557 
	#GNTST_okay
 (0è

	)

558 
	#GNTST_g’”®_”rÜ
 (-1è

	)

559 
	#GNTST_bad_domaš
 (-2è

	)

560 
	#GNTST_bad_gÁ»f
 (-3è

	)

561 
	#GNTST_bad_hªdË
 (-4è

	)

562 
	#GNTST_bad_vœt_addr
 (-5è

	)

563 
	#GNTST_bad_dev_addr
 (-6è

	)

564 
	#GNTST_no_deviû_¥aû
 (-7è

	)

565 
	#GNTST_³rmissiÚ_d’›d
 (-8è

	)

566 
	#GNTST_bad_·ge
 (-9è

	)

567 
	#GNTST_bad_cİy_¬g
 (-10è

	)

568 
	#GNTST_add»ss_too_big
 (-11è

	)

569 
	#GNTST_—gaš
 (-12è

	)

571 
	#GNTTABOP_”rÜ_msgs
 { \

585 }

	)

	@/usr/include/xen/hvm/params.h

21 #iâdeà
__XEN_PUBLIC_HVM_PARAMS_H__


22 
	#__XEN_PUBLIC_HVM_PARAMS_H__


	)

24 
	~"hvm_İ.h
"

41 
	#HVM_PARAM_CALLBACK_IRQ
 0

	)

47 
	#HVM_PARAM_STORE_PFN
 1

	)

48 
	#HVM_PARAM_STORE_EVTCHN
 2

	)

50 
	#HVM_PARAM_PAE_ENABLED
 4

	)

52 
	#HVM_PARAM_IOREQ_PFN
 5

	)

54 
	#HVM_PARAM_BUFIOREQ_PFN
 6

	)

56 #ifdeà
__Ÿ64__


58 
	#HVM_PARAM_NVRAM_FD
 7

	)

59 
	#HVM_PARAM_VHPT_SIZE
 8

	)

60 
	#HVM_PARAM_BUFPIOREQ_PFN
 9

	)

62 #–ià
defšed
(
__i386__
è|| defšed(
__x86_64__
)

65 
	#HVM_PARAM_VIRIDIAN
 9

	)

88 
	#HVM_PARAM_TIMER_MODE
 10

	)

89 
	#HVMPTM_d–ay_fÜ_mis£d_ticks
 0

	)

90 
	#HVMPTM_no_d–ay_fÜ_mis£d_ticks
 1

	)

91 
	#HVMPTM_no_mis£d_ticks_³ndšg
 2

	)

92 
	#HVMPTM_Úe_mis£d_tick_³ndšg
 3

	)

95 
	#HVM_PARAM_HPET_ENABLED
 11

	)

98 
	#HVM_PARAM_IDENT_PT
 12

	)

101 
	#HVM_PARAM_DM_DOMAIN
 13

	)

104 
	#HVM_PARAM_ACPI_S_STATE
 14

	)

107 
	#HVM_PARAM_VM86_TSS
 15

	)

110 
	#HVM_PARAM_VPT_ALIGN
 16

	)

113 
	#HVM_PARAM_CONSOLE_PFN
 17

	)

114 
	#HVM_PARAM_CONSOLE_EVTCHN
 18

	)

125 
	#HVM_PARAM_ACPI_IOPORTS_LOCATION
 19

	)

129 
	#HVM_PARAM_MEMORY_EVENT_CR0
 20

	)

130 
	#HVM_PARAM_MEMORY_EVENT_CR3
 21

	)

131 
	#HVM_PARAM_MEMORY_EVENT_CR4
 22

	)

132 
	#HVM_PARAM_MEMORY_EVENT_INT3
 23

	)

133 
	#HVM_PARAM_MEMORY_EVENT_SINGLE_STEP
 25

	)

135 
	#HVMPME_MODE_MASK
 (3 << 0)

	)

136 
	#HVMPME_mode_di§bËd
 0

	)

137 
	#HVMPME_mode_async
 1

	)

138 
	#HVMPME_mode_sync
 2

	)

139 
	#HVMPME_ÚchªgeÚly
 (1 << 2)

	)

141 
	#HVM_NR_PARAMS
 26

	)

	@/usr/include/xen/memory.h

27 #iâdeà
__XEN_PUBLIC_MEMORY_H__


28 
	#__XEN_PUBLIC_MEMORY_H__


	)

30 
	~"x’.h
"

37 
	#XENMEM_šü—£_»£rv©iÚ
 0

	)

38 
	#XENMEM_deü—£_»£rv©iÚ
 1

	)

39 
	#XENMEM_pİuÏ‹_physm­
 6

	)

41 #ià
__XEN_INTERFACE_VERSION__
 >= 0x00030209

48 
	#XENMEMF_add»ss_b™s
(
x
è(x)

	)

49 
	#XENMEMF_g‘_add»ss_b™s
(
x
è((xè& 0xffu)

	)

51 
	#XENMEMF_node
(
x
è(((xè+ 1è<< 8)

	)

52 
	#XENMEMF_g‘_node
(
x
è((((xè>> 8è- 1è& 0xffu)

	)

54 
	#XENMEMF_pİuÏ‹_Ú_demªd
 (1<<16)

	)

56 
	#XENMEMF_exaù_node_»que¡
 (1<<17)

	)

57 
	#XENMEMF_exaù_node
(
n
è(
	`XENMEMF_node
Òè| 
XENMEMF_exaù_node_»que¡
)

	)

60 
	sx’_memÜy_»£rv©iÚ
 {

72 
XEN_GUEST_HANDLE
(
x’_pâ_t
è
	mex‹Á_¡¬t
;

75 
x’_ulÚg_t
 
	mÄ_ex‹Ás
;

76 
	mex‹Á_Üd”
;

78 #ià
__XEN_INTERFACE_VERSION__
 >= 0x00030209

80 
	mmem_æags
;

82 
	madd»ss_b™s
;

89 
domid_t
 
	mdomid
;

91 
x’_memÜy_»£rv©iÚ
 
	tx’_memÜy_»£rv©iÚ_t
;

92 
DEFINE_XEN_GUEST_HANDLE
(
x’_memÜy_»£rv©iÚ_t
);

101 
	#XENMEM_exchªge
 11

	)

102 
	sx’_memÜy_exchªge
 {

107 
x’_memÜy_»£rv©iÚ
 
	mš
;

119 
x’_memÜy_»£rv©iÚ
 
	mout
;

132 
x’_ulÚg_t
 
	mÄ_exchªged
;

134 
x’_memÜy_exchªge
 
	tx’_memÜy_exchªge_t
;

135 
DEFINE_XEN_GUEST_HANDLE
(
x’_memÜy_exchªge_t
);

142 
	#XENMEM_maximum_¿m_·ge
 2

	)

149 
	#XENMEM_cu¼’t_»£rv©iÚ
 3

	)

150 
	#XENMEM_maximum_»£rv©iÚ
 4

	)

155 
	#XENMEM_maximum_gpâ
 14

	)

163 
	#XENMEM_machphys_mâ_li¡
 5

	)

164 
	sx’_machphys_mâ_li¡
 {

169 
	mmax_ex‹Ás
;

176 
XEN_GUEST_HANDLE
(
x’_pâ_t
è
	mex‹Á_¡¬t
;

182 
	mÄ_ex‹Ás
;

184 
x’_machphys_mâ_li¡
 
	tx’_machphys_mâ_li¡_t
;

185 
DEFINE_XEN_GUEST_HANDLE
(
x’_machphys_mâ_li¡_t
);

193 
	#XENMEM_machphys_m­pšg
 12

	)

194 
	sx’_machphys_m­pšg
 {

195 
x’_ulÚg_t
 
	mv_¡¬t
, 
	mv_’d
;

196 
x’_ulÚg_t
 
	mmax_mâ
;

198 
x’_machphys_m­pšg
 
	tx’_machphys_m­pšg_t
;

199 
DEFINE_XEN_GUEST_HANDLE
(
x’_machphys_m­pšg_t
);

206 
	#XENMEM_add_to_physm­
 7

	)

207 
	sx’_add_to_physm­
 {

209 
domid_t
 
	mdomid
;

212 
	#XENMAPSPACE_sh¬ed_šfo
 0

	)

213 
	#XENMAPSPACE_g¿Á_bË
 1

	)

214 
	#XENMAPSPACE_gmâ
 2

	)

215 
	m¥aû
;

217 
	#XENMAPIDX_g¿Á_bË_¡©us
 0x80000000

	)

220 
x’_ulÚg_t
 
	midx
;

223 
x’_pâ_t
 
	mgpâ
;

225 
x’_add_to_physm­
 
	tx’_add_to_physm­_t
;

226 
DEFINE_XEN_GUEST_HANDLE
(
x’_add_to_physm­_t
);

236 
	#XENMEM_memÜy_m­
 9

	)

237 
	sx’_memÜy_m­
 {

243 
	mÄ_’Œ›s
;

249 
XEN_GUEST_HANDLE
(è
	mbufãr
;

251 
x’_memÜy_m­
 
	tx’_memÜy_m­_t
;

252 
DEFINE_XEN_GUEST_HANDLE
(
x’_memÜy_m­_t
);

259 
	#XENMEM_machše_memÜy_m­
 10

	)

266 
	#XENMEM_£t_memÜy_m­
 13

	)

267 
	sx’_fÜeign_memÜy_m­
 {

268 
domid_t
 
	mdomid
;

269 
x’_memÜy_m­
 
	mm­
;

271 
x’_fÜeign_memÜy_m­
 
	tx’_fÜeign_memÜy_m­_t
;

272 
DEFINE_XEN_GUEST_HANDLE
(
x’_fÜeign_memÜy_m­_t
);

274 
	#XENMEM_£t_pod_rg‘
 16

	)

275 
	#XENMEM_g‘_pod_rg‘
 17

	)

276 
	sx’_pod_rg‘
 {

278 
ušt64_t
 
	mrg‘_·ges
;

280 
ušt64_t
 
	mtÙ_·ges
;

281 
ušt64_t
 
	mpod_ÿche_·ges
;

282 
ušt64_t
 
	mpod_’Œ›s
;

284 
domid_t
 
	mdomid
;

286 
x’_pod_rg‘
 
	tx’_pod_rg‘_t
;

292 
	#XENMEM_g‘_sh¬šg_ä“d_·ges
 18

	)

	@/usr/include/xen/physdev.h

21 #iâdeà
__XEN_PUBLIC_PHYSDEV_H__


22 
	#__XEN_PUBLIC_PHYSDEV_H__


	)

24 
	~"x’.h
"

37 
	#PHYSDEVOP_eoi
 12

	)

38 
	sphysdev_eoi
 {

40 
ušt32_t
 
	mœq
;

42 
physdev_eoi
 
	tphysdev_eoi_t
;

43 
DEFINE_XEN_GUEST_HANDLE
(
physdev_eoi_t
);

52 
	#PHYSDEVOP_pœq_eoi_gmâ
 17

	)

53 
	sphysdev_pœq_eoi_gmâ
 {

55 
x’_pâ_t
 
	mgmâ
;

57 
physdev_pœq_eoi_gmâ
 
	tphysdev_pœq_eoi_gmâ_t
;

58 
DEFINE_XEN_GUEST_HANDLE
(
physdev_pœq_eoi_gmâ_t
);

64 
	#PHYSDEVOP_œq_¡©us_qu”y
 5

	)

65 
	sphysdev_œq_¡©us_qu”y
 {

67 
ušt32_t
 
	mœq
;

69 
ušt32_t
 
	mæags
;

71 
physdev_œq_¡©us_qu”y
 
	tphysdev_œq_¡©us_qu”y_t
;

72 
DEFINE_XEN_GUEST_HANDLE
(
physdev_œq_¡©us_qu”y_t
);

75 
	#_XENIRQSTAT_Ãeds_eoi
 (0)

	)

76 
	#XENIRQSTAT_Ãeds_eoi
 (1U<<
_XENIRQSTAT_Ãeds_eoi
)

	)

79 
	#_XENIRQSTAT_sh¬ed
 (1)

	)

80 
	#XENIRQSTAT_sh¬ed
 (1U<<
_XENIRQSTAT_sh¬ed
)

	)

86 
	#PHYSDEVOP_£t_iİl
 6

	)

87 
	sphysdev_£t_iİl
 {

89 
ušt32_t
 
	miİl
;

91 
physdev_£t_iİl
 
	tphysdev_£t_iİl_t
;

92 
DEFINE_XEN_GUEST_HANDLE
(
physdev_£t_iİl_t
);

98 
	#PHYSDEVOP_£t_iob™m­
 7

	)

99 
	sphysdev_£t_iob™m­
 {

101 #ià
__XEN_INTERFACE_VERSION__
 >= 0x00030205

102 
XEN_GUEST_HANDLE
(
ušt8
è
	mb™m­
;

104 
ušt8_t
 *
	mb™m­
;

106 
ušt32_t
 
	mÄ_pÜts
;

108 
physdev_£t_iob™m­
 
	tphysdev_£t_iob™m­_t
;

109 
DEFINE_XEN_GUEST_HANDLE
(
physdev_£t_iob™m­_t
);

115 
	#PHYSDEVOP_­ic_»ad
 8

	)

116 
	#PHYSDEVOP_­ic_wr™e
 9

	)

117 
	sphysdev_­ic
 {

119 
	m­ic_physba£
;

120 
ušt32_t
 
	m»g
;

122 
ušt32_t
 
	mv®ue
;

124 
physdev_­ic
 
	tphysdev_­ic_t
;

125 
DEFINE_XEN_GUEST_HANDLE
(
physdev_­ic_t
);

131 
	#PHYSDEVOP_®loc_œq_veùÜ
 10

	)

132 
	#PHYSDEVOP_ä“_œq_veùÜ
 11

	)

133 
	sphysdev_œq
 {

135 
ušt32_t
 
	mœq
;

137 
ušt32_t
 
	mveùÜ
;

139 
physdev_œq
 
	tphysdev_œq_t
;

140 
DEFINE_XEN_GUEST_HANDLE
(
physdev_œq_t
);

142 
	#MAP_PIRQ_TYPE_MSI
 0x0

	)

143 
	#MAP_PIRQ_TYPE_GSI
 0x1

	)

144 
	#MAP_PIRQ_TYPE_UNKNOWN
 0x2

	)

146 
	#PHYSDEVOP_m­_pœq
 13

	)

147 
	sphysdev_m­_pœq
 {

148 
domid_t
 
	mdomid
;

150 
	mty³
;

152 
	mšdex
;

154 
	mpœq
;

156 
	mbus
;

158 
	mdevâ
;

160 
	m’Œy_Ä
;

162 
ušt64_t
 
	mbË_ba£
;

164 
physdev_m­_pœq
 
	tphysdev_m­_pœq_t
;

165 
DEFINE_XEN_GUEST_HANDLE
(
physdev_m­_pœq_t
);

167 
	#PHYSDEVOP_unm­_pœq
 14

	)

168 
	sphysdev_unm­_pœq
 {

169 
domid_t
 
	mdomid
;

171 
	mpœq
;

174 
physdev_unm­_pœq
 
	tphysdev_unm­_pœq_t
;

175 
DEFINE_XEN_GUEST_HANDLE
(
physdev_unm­_pœq_t
);

177 
	#PHYSDEVOP_mªage_pci_add
 15

	)

178 
	#PHYSDEVOP_mªage_pci_»move
 16

	)

179 
	sphysdev_mªage_pci
 {

181 
ušt8_t
 
	mbus
;

182 
ušt8_t
 
	mdevâ
;

185 
physdev_mªage_pci
 
	tphysdev_mªage_pci_t
;

186 
DEFINE_XEN_GUEST_HANDLE
(
physdev_mªage_pci_t
);

188 
	#PHYSDEVOP_»¡Üe_msi
 19

	)

189 
	sphysdev_»¡Üe_msi
 {

191 
ušt8_t
 
	mbus
;

192 
ušt8_t
 
	mdevâ
;

194 
physdev_»¡Üe_msi
 
	tphysdev_»¡Üe_msi_t
;

195 
DEFINE_XEN_GUEST_HANDLE
(
physdev_»¡Üe_msi_t
);

197 
	#PHYSDEVOP_mªage_pci_add_ext
 20

	)

198 
	sphysdev_mªage_pci_ext
 {

200 
ušt8_t
 
	mbus
;

201 
ušt8_t
 
	mdevâ
;

202 
	mis_extâ
;

203 
	mis_vœtâ
;

205 
ušt8_t
 
	mbus
;

206 
ušt8_t
 
	mdevâ
;

207 } 
	mphysâ
;

210 
physdev_mªage_pci_ext
 
	tphysdev_mªage_pci_ext_t
;

211 
DEFINE_XEN_GUEST_HANDLE
(
physdev_mªage_pci_ext_t
);

217 
	sphysdev_İ
 {

218 
ušt32_t
 
	mcmd
;

220 
physdev_œq_¡©us_qu”y
 
	mœq_¡©us_qu”y
;

221 
physdev_£t_iİl
 
	m£t_iİl
;

222 
physdev_£t_iob™m­
 
	m£t_iob™m­
;

223 
physdev_­ic
 
	m­ic_İ
;

224 
physdev_œq
 
	mœq_İ
;

225 } 
	mu
;

227 
physdev_İ
 
	tphysdev_İ_t
;

228 
DEFINE_XEN_GUEST_HANDLE
(
physdev_İ_t
);

230 
	#PHYSDEVOP_£tup_gsi
 21

	)

231 
	sphysdev_£tup_gsi
 {

232 
	mgsi
;

234 
ušt8_t
 
	mŒigg”šg
;

236 
ušt8_t
 
	mpŞ¬™y
;

240 
physdev_£tup_gsi
 
	tphysdev_£tup_gsi_t
;

241 
DEFINE_XEN_GUEST_HANDLE
(
physdev_£tup_gsi_t
);

247 
	#PHYSDEVOP_g‘_ä“_pœq
 23

	)

248 
	sphysdev_g‘_ä“_pœq
 {

250 
	mty³
;

252 
ušt32_t
 
	mpœq
;

255 
physdev_g‘_ä“_pœq
 
	tphysdev_g‘_ä“_pœq_t
;

256 
DEFINE_XEN_GUEST_HANDLE
(
physdev_g‘_ä“_pœq_t
);

263 
	#PHYSDEVOP_IRQ_UNMASK_NOTIFY
 4

	)

269 
	#PHYSDEVOP_IRQ_STATUS_QUERY
 
PHYSDEVOP_œq_¡©us_qu”y


	)

270 
	#PHYSDEVOP_SET_IOPL
 
PHYSDEVOP_£t_iİl


	)

271 
	#PHYSDEVOP_SET_IOBITMAP
 
PHYSDEVOP_£t_iob™m­


	)

272 
	#PHYSDEVOP_APIC_READ
 
PHYSDEVOP_­ic_»ad


	)

273 
	#PHYSDEVOP_APIC_WRITE
 
PHYSDEVOP_­ic_wr™e


	)

274 
	#PHYSDEVOP_ASSIGN_VECTOR
 
PHYSDEVOP_®loc_œq_veùÜ


	)

275 
	#PHYSDEVOP_FREE_VECTOR
 
PHYSDEVOP_ä“_œq_veùÜ


	)

276 
	#PHYSDEVOP_IRQ_NEEDS_UNMASK_NOTIFY
 
XENIRQSTAT_Ãeds_eoi


	)

277 
	#PHYSDEVOP_IRQ_SHARED
 
XENIRQSTAT_sh¬ed


	)

	@/usr/include/xen/sysctl.h

27 #iâdeà
__XEN_PUBLIC_SYSCTL_H__


28 
	#__XEN_PUBLIC_SYSCTL_H__


	)

30 #ià!
defšed
(
__XEN__
è&& !defšed(
__XEN_TOOLS__
)

34 
	~"x’.h
"

35 
	~"domùl.h
"

37 
	#XEN_SYSCTL_INTERFACE_VERSION
 0x00000008

	)

43 
	sx’_sysùl_»adcÚsŞe
 {

45 
ušt8_t
 
	mş—r
;

47 
ušt8_t
 
	mšüem’l
;

48 
ušt8_t
 
	m·d0
, 
	m·d1
;

53 
ušt32_t
 
	mšdex
;

55 
XEN_GUEST_HANDLE_64
(è
	mbufãr
;

57 
ušt32_t
 
	mcouÁ
;

59 
x’_sysùl_»adcÚsŞe
 
	tx’_sysùl_»adcÚsŞe_t
;

60 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_»adcÚsŞe_t
);

64 
	sx’_sysùl_tbuf_İ
 {

66 
	#XEN_SYSCTL_TBUFOP_g‘_šfo
 0

	)

67 
	#XEN_SYSCTL_TBUFOP_£t_ıu_mask
 1

	)

68 
	#XEN_SYSCTL_TBUFOP_£t_evt_mask
 2

	)

69 
	#XEN_SYSCTL_TBUFOP_£t_size
 3

	)

70 
	#XEN_SYSCTL_TBUFOP_’abË
 4

	)

71 
	#XEN_SYSCTL_TBUFOP_di§bË
 5

	)

72 
ušt32_t
 
	mcmd
;

74 
x’ùl_ıum­
 
	mıu_mask
;

75 
ušt32_t
 
	mevt_mask
;

77 
ušt64_®igÃd_t
 
	mbufãr_mâ
;

78 
ušt32_t
 
	msize
;

80 
x’_sysùl_tbuf_İ
 
	tx’_sysùl_tbuf_İ_t
;

81 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_tbuf_İ_t
);

88 
	#_XEN_SYSCTL_PHYSCAP_hvm
 0

	)

89 
	#XEN_SYSCTL_PHYSCAP_hvm
 (1u<<
_XEN_SYSCTL_PHYSCAP_hvm
)

	)

91 
	#_XEN_SYSCTL_PHYSCAP_hvm_dœeùio
 1

	)

92 
	#XEN_SYSCTL_PHYSCAP_hvm_dœeùio
 (1u<<
_XEN_SYSCTL_PHYSCAP_hvm_dœeùio
)

	)

93 
	sx’_sysùl_physšfo
 {

94 
ušt32_t
 
	mth»ads_³r_cÜe
;

95 
ušt32_t
 
	mcÜes_³r_sock‘
;

96 
ušt32_t
 
	mÄ_ıus
;

97 
ušt32_t
 
	mmax_ıu_id
;

98 
ušt32_t
 
	mÄ_nodes
;

99 
ušt32_t
 
	mmax_node_id
;

100 
ušt32_t
 
	mıu_khz
;

101 
ušt64_®igÃd_t
 
	mtÙ®_·ges
;

102 
ušt64_®igÃd_t
 
	mä“_·ges
;

103 
ušt64_®igÃd_t
 
	msüub_·ges
;

104 
ušt32_t
 
	mhw_ÿp
[8];

107 
ušt32_t
 
	mÿ·b™›s
;

109 
x’_sysùl_physšfo
 
	tx’_sysùl_physšfo_t
;

110 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_physšfo_t
);

116 
	sx’_sysùl_sched_id
 {

118 
ušt32_t
 
	msched_id
;

120 
x’_sysùl_sched_id
 
	tx’_sysùl_sched_id_t
;

121 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_sched_id_t
);

126 
	#XEN_SYSCTL_PERFCOP_»£t
 1

	)

127 
	#XEN_SYSCTL_PERFCOP_qu”y
 2

	)

128 
	sx’_sysùl_³rfc_desc
 {

129 
	mÇme
[80];

130 
ušt32_t
 
	mÄ_v®s
;

132 
x’_sysùl_³rfc_desc
 
	tx’_sysùl_³rfc_desc_t
;

133 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_³rfc_desc_t
);

134 
ušt32_t
 
	tx’_sysùl_³rfc_v®_t
;

135 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_³rfc_v®_t
);

137 
	sx’_sysùl_³rfc_İ
 {

139 
ušt32_t
 
	mcmd
;

141 
ušt32_t
 
	mÄ_couÁ”s
;

142 
ušt32_t
 
	mÄ_v®s
;

144 
XEN_GUEST_HANDLE_64
(
x’_sysùl_³rfc_desc_t
è
	mdesc
;

146 
XEN_GUEST_HANDLE_64
(
x’_sysùl_³rfc_v®_t
è
	mv®
;

148 
x’_sysùl_³rfc_İ
 
	tx’_sysùl_³rfc_İ_t
;

149 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_³rfc_İ_t
);

152 
	sx’_sysùl_g‘domaššfŞi¡
 {

154 
domid_t
 
	mfœ¡_domaš
;

155 
ušt32_t
 
	mmax_domašs
;

156 
XEN_GUEST_HANDLE_64
(
x’_domùl_g‘domaššfo_t
è
	mbufãr
;

158 
ušt32_t
 
	mnum_domašs
;

160 
x’_sysùl_g‘domaššfŞi¡
 
	tx’_sysùl_g‘domaššfŞi¡_t
;

161 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_g‘domaššfŞi¡_t
);

165 
	sx’_sysùl_debug_keys
 {

167 
XEN_GUEST_HANDLE_64
(è
	mkeys
;

168 
ušt32_t
 
	mÄ_keys
;

170 
x’_sysùl_debug_keys
 
	tx’_sysùl_debug_keys_t
;

171 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_debug_keys_t
);

175 
	sx’_sysùl_ıušfo
 {

176 
ušt64_®igÃd_t
 
	midËtime
;

178 
x’_sysùl_ıušfo
 
	tx’_sysùl_ıušfo_t
;

179 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_ıušfo_t
);

180 
	sx’_sysùl_g‘ıušfo
 {

182 
ušt32_t
 
	mmax_ıus
;

183 
XEN_GUEST_HANDLE_64
(
x’_sysùl_ıušfo_t
è
	mšfo
;

185 
ušt32_t
 
	mÄ_ıus
;

187 
x’_sysùl_g‘ıušfo
 
	tx’_sysùl_g‘ıušfo_t
;

188 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_g‘ıušfo_t
);

191 
	sx’_sysùl_avah—p
 {

193 
ušt32_t
 
	mmš_b™width
;

194 
ušt32_t
 
	mmax_b™width
;

195 
št32_t
 
	mnode
;

197 
ušt64_®igÃd_t
 
	mava_by‹s
;

199 
x’_sysùl_avah—p
 
	tx’_sysùl_avah—p_t
;

200 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_avah—p_t
);

203 
	spm_px_v®
 {

204 
ušt64_®igÃd_t
 
	mäeq
;

205 
ušt64_®igÃd_t
 
	m»sid’cy
;

206 
ušt64_®igÃd_t
 
	mcouÁ
;

208 
pm_px_v®
 
	tpm_px_v®_t
;

209 
DEFINE_XEN_GUEST_HANDLE
(
pm_px_v®_t
);

211 
	spm_px_¡©
 {

212 
ušt8_t
 
	mtÙ®
;

213 
ušt8_t
 
	mu§bË
;

214 
ušt8_t
 
	mÏ¡
;

215 
ušt8_t
 
	mcur
;

216 
XEN_GUEST_HANDLE_64
(
ušt64
è
	mŒªs_±
;

217 
XEN_GUEST_HANDLE_64
(
pm_px_v®_t
è
	m±
;

219 
pm_px_¡©
 
	tpm_px_¡©_t
;

220 
DEFINE_XEN_GUEST_HANDLE
(
pm_px_¡©_t
);

222 
	spm_cx_¡©
 {

223 
ušt32_t
 
	mÄ
;

224 
ušt32_t
 
	mÏ¡
;

225 
ušt64_®igÃd_t
 
	midË_time
;

226 
XEN_GUEST_HANDLE_64
(
ušt64
è
	mŒigg”s
;

227 
XEN_GUEST_HANDLE_64
(
ušt64
è
	m»sid’c›s
;

228 
ušt64_®igÃd_t
 
	mpc3
;

229 
ušt64_®igÃd_t
 
	mpc6
;

230 
ušt64_®igÃd_t
 
	mpc7
;

231 
ušt64_®igÃd_t
 
	mcc3
;

232 
ušt64_®igÃd_t
 
	mcc6
;

235 
	sx’_sysùl_g‘_pm¡©
 {

236 
	#PMSTAT_CATEGORY_MASK
 0xf0

	)

237 
	#PMSTAT_PX
 0x10

	)

238 
	#PMSTAT_CX
 0x20

	)

239 
	#PMSTAT_g‘_max_px
 (
PMSTAT_PX
 | 0x1)

	)

240 
	#PMSTAT_g‘_px¡©
 (
PMSTAT_PX
 | 0x2)

	)

241 
	#PMSTAT_»£t_px¡©
 (
PMSTAT_PX
 | 0x3)

	)

242 
	#PMSTAT_g‘_max_cx
 (
PMSTAT_CX
 | 0x1)

	)

243 
	#PMSTAT_g‘_cx¡©
 (
PMSTAT_CX
 | 0x2)

	)

244 
	#PMSTAT_»£t_cx¡©
 (
PMSTAT_CX
 | 0x3)

	)

245 
ušt32_t
 
	mty³
;

246 
ušt32_t
 
	mıuid
;

248 
pm_px_¡©
 
	mg‘px
;

249 
pm_cx_¡©
 
	mg‘cx
;

251 } 
	mu
;

253 
x’_sysùl_g‘_pm¡©
 
	tx’_sysùl_g‘_pm¡©_t
;

254 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_g‘_pm¡©_t
);

257 
	sx’_sysùl_ıu_hÙ¶ug
 {

259 
ušt32_t
 
	mıu
;

260 
	#XEN_SYSCTL_CPU_HOTPLUG_ONLINE
 0

	)

261 
	#XEN_SYSCTL_CPU_HOTPLUG_OFFLINE
 1

	)

262 
ušt32_t
 
	mİ
;

264 
x’_sysùl_ıu_hÙ¶ug
 
	tx’_sysùl_ıu_hÙ¶ug_t
;

265 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_ıu_hÙ¶ug_t
);

272 
	sx’_u£r¥aû
 {

273 
ušt32_t
 
	msÿlšg_£t¥“d
;

275 
x’_u£r¥aû
 
	tx’_u£r¥aû_t
;

277 
	sx’_Údemªd
 {

278 
ušt32_t
 
	m§m¶šg_¿‹_max
;

279 
ušt32_t
 
	m§m¶šg_¿‹_mš
;

281 
ušt32_t
 
	m§m¶šg_¿‹
;

282 
ušt32_t
 
	mup_th»shŞd
;

284 
x’_Údemªd
 
	tx’_Údemªd_t
;

290 
	#CPUFREQ_NAME_LEN
 16

	)

291 
	sx’_g‘_ıuäeq_·¿
 {

293 
ušt32_t
 
	mıu_num
;

294 
ušt32_t
 
	mäeq_num
;

295 
ušt32_t
 
	mgov_num
;

299 
XEN_GUEST_HANDLE_64
(
ušt32
è
	mafãùed_ıus
;

300 
XEN_GUEST_HANDLE_64
(
ušt32
è
	msÿlšg_avaabË_äequ’c›s
;

301 
XEN_GUEST_HANDLE_64
(è
	msÿlšg_avaabË_gov”nÜs
;

302 
	msÿlšg_driv”
[
CPUFREQ_NAME_LEN
];

304 
ušt32_t
 
	mıušfo_cur_äeq
;

305 
ušt32_t
 
	mıušfo_max_äeq
;

306 
ušt32_t
 
	mıušfo_mš_äeq
;

307 
ušt32_t
 
	msÿlšg_cur_äeq
;

309 
	msÿlšg_gov”nÜ
[
CPUFREQ_NAME_LEN
];

310 
ušt32_t
 
	msÿlšg_max_äeq
;

311 
ušt32_t
 
	msÿlšg_mš_äeq
;

315 
x’_u£r¥aû
 
	mu£r¥aû
;

316 
x’_Údemªd
 
	mÚdemªd
;

317 } 
	mu
;

319 
št32_t
 
	mturbo_’abËd
;

322 
	sx’_£t_ıuäeq_gov
 {

323 
	msÿlšg_gov”nÜ
[
CPUFREQ_NAME_LEN
];

326 
	sx’_£t_ıuäeq_·¿
 {

327 
	#SCALING_MAX_FREQ
 1

	)

328 
	#SCALING_MIN_FREQ
 2

	)

329 
	#SCALING_SETSPEED
 3

	)

330 
	#SAMPLING_RATE
 4

	)

331 
	#UP_THRESHOLD
 5

	)

333 
ušt32_t
 
	mù¾_ty³
;

334 
ušt32_t
 
	mù¾_v®ue
;

337 
	sx’_sysùl_pm_İ
 {

338 
	#PM_PARA_CATEGORY_MASK
 0xf0

	)

339 
	#CPUFREQ_PARA
 0x10

	)

342 
	#GET_CPUFREQ_PARA
 (
CPUFREQ_PARA
 | 0x01)

	)

343 
	#SET_CPUFREQ_GOV
 (
CPUFREQ_PARA
 | 0x02)

	)

344 
	#SET_CPUFREQ_PARA
 (
CPUFREQ_PARA
 | 0x03)

	)

345 
	#GET_CPUFREQ_AVGFREQ
 (
CPUFREQ_PARA
 | 0x04)

	)

348 
	#XEN_SYSCTL_pm_İ_£t_sched_İt_smt
 0x21

	)

351 
	#XEN_SYSCTL_pm_İ_g‘_max_c¡©e
 0x22

	)

352 
	#XEN_SYSCTL_pm_İ_£t_max_c¡©e
 0x23

	)

355 
	#XEN_SYSCTL_pm_İ_£t_vıu_mig¿tiÚ_d–ay
 0x24

	)

356 
	#XEN_SYSCTL_pm_İ_g‘_vıu_mig¿tiÚ_d–ay
 0x25

	)

359 
	#XEN_SYSCTL_pm_İ_’abË_turbo
 0x26

	)

360 
	#XEN_SYSCTL_pm_İ_di§bË_turbo
 0x27

	)

362 
ušt32_t
 
	mcmd
;

363 
ušt32_t
 
	mıuid
;

365 
x’_g‘_ıuäeq_·¿
 
	mg‘_·¿
;

366 
x’_£t_ıuäeq_gov
 
	m£t_gov
;

367 
x’_£t_ıuäeq_·¿
 
	m£t_·¿
;

368 
ušt64_®igÃd_t
 
	mg‘_avgäeq
;

369 
ušt32_t
 
	m£t_sched_İt_smt
;

370 
ušt32_t
 
	mg‘_max_c¡©e
;

371 
ušt32_t
 
	m£t_max_c¡©e
;

372 
ušt32_t
 
	mg‘_vıu_mig¿tiÚ_d–ay
;

373 
ušt32_t
 
	m£t_vıu_mig¿tiÚ_d–ay
;

374 } 
	mu
;

378 
	sx’_sysùl_·ge_ofæše_İ
 {

380 
	#sysùl_·ge_ofæše
 1

	)

381 
	#sysùl_·ge_Úlše
 2

	)

382 
	#sysùl_qu”y_·ge_ofæše
 3

	)

383 
ušt32_t
 
	mcmd
;

384 
ušt32_t
 
	m¡¬t
;

385 
ušt32_t
 
	m’d
;

391 
XEN_GUEST_HANDLE
(
ušt32
è
	m¡©us
;

394 
	#PG_OFFLINE_STATUS_MASK
 (0xFFUL)

	)

397 
	#PG_OFFLINE_INVALID
 (0x1UL << 0)

	)

399 
	#PG_OFFLINE_OFFLINED
 (0x1UL << 1)

	)

400 
	#PG_OFFLINE_PENDING
 (0x1UL << 2)

	)

401 
	#PG_OFFLINE_FAILED
 (0x1UL << 3)

	)

403 
	#PG_ONLINE_FAILED
 
PG_OFFLINE_FAILED


	)

404 
	#PG_ONLINE_ONLINED
 
PG_OFFLINE_OFFLINED


	)

406 
	#PG_OFFLINE_STATUS_OFFLINED
 (0x1UL << 1)

	)

407 
	#PG_OFFLINE_STATUS_ONLINE
 (0x1UL << 2)

	)

408 
	#PG_OFFLINE_STATUS_OFFLINE_PENDING
 (0x1UL << 3)

	)

409 
	#PG_OFFLINE_STATUS_BROKEN
 (0x1UL << 4)

	)

411 
	#PG_OFFLINE_MISC_MASK
 (0xFFUL << 4)

	)

414 
	#PG_OFFLINE_XENPAGE
 (0x1UL << 8)

	)

415 
	#PG_OFFLINE_DOM0PAGE
 (0x1UL << 9)

	)

416 
	#PG_OFFLINE_ANONYMOUS
 (0x1UL << 10)

	)

417 
	#PG_OFFLINE_NOT_CONV_RAM
 (0x1UL << 11)

	)

418 
	#PG_OFFLINE_OWNED
 (0x1UL << 12)

	)

420 
	#PG_OFFLINE_BROKEN
 (0x1UL << 13)

	)

421 
	#PG_ONLINE_BROKEN
 
PG_OFFLINE_BROKEN


	)

423 
	#PG_OFFLINE_OWNER_SHIFT
 16

	)

427 
	#XEN_SYSCTL_LOCKPROF_»£t
 1

	)

428 
	#XEN_SYSCTL_LOCKPROF_qu”y
 2

	)

430 
	#LOCKPROF_TYPE_GLOBAL
 0

	)

431 
	#LOCKPROF_TYPE_PERDOM
 1

	)

432 
	#LOCKPROF_TYPE_N
 2

	)

433 
	sx’_sysùl_lock´of_d©a
 {

434 
	mÇme
[40];

435 
št32_t
 
	mty³
;

436 
št32_t
 
	midx
;

437 
ušt64_®igÃd_t
 
	mlock_út
;

438 
ušt64_®igÃd_t
 
	mblock_út
;

439 
ušt64_®igÃd_t
 
	mlock_time
;

440 
ušt64_®igÃd_t
 
	mblock_time
;

442 
x’_sysùl_lock´of_d©a
 
	tx’_sysùl_lock´of_d©a_t
;

443 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_lock´of_d©a_t
);

444 
	sx’_sysùl_lock´of_İ
 {

446 
ušt32_t
 
	mcmd
;

447 
ušt32_t
 
	mmax_–em
;

449 
ušt32_t
 
	mÄ_–em
;

450 
ušt64_®igÃd_t
 
	mtime
;

452 
XEN_GUEST_HANDLE_64
(
x’_sysùl_lock´of_d©a_t
è
	md©a
;

454 
x’_sysùl_lock´of_İ
 
	tx’_sysùl_lock´of_İ_t
;

455 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_lock´of_İ_t
);

458 
	#INVALID_TOPOLOGY_ID
 (~0U)

	)

459 
	sx’_sysùl_tİŞogyšfo
 {

466 
ušt32_t
 
	mmax_ıu_šdex
;

476 
XEN_GUEST_HANDLE_64
(
ušt32
è
	mıu_to_cÜe
;

477 
XEN_GUEST_HANDLE_64
(
ušt32
è
	mıu_to_sock‘
;

478 
XEN_GUEST_HANDLE_64
(
ušt32
è
	mıu_to_node
;

480 
x’_sysùl_tİŞogyšfo
 
	tx’_sysùl_tİŞogyšfo_t
;

481 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_tİŞogyšfo_t
);

484 
	sx’_sysùl_numašfo
 {

490 
ušt32_t
 
	mmax_node_šdex
;

493 
XEN_GUEST_HANDLE_64
(
ušt64
è
	mnode_to_memsize
;

494 
XEN_GUEST_HANDLE_64
(
ušt64
è
	mnode_to_memä“
;

510 
XEN_GUEST_HANDLE_64
(
ušt32
è
	mnode_to_node_di¡ªû
;

512 
x’_sysùl_numašfo
 
	tx’_sysùl_numašfo_t
;

513 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_numašfo_t
);

516 
	#XEN_SYSCTL_CPUPOOL_OP_CREATE
 1

	)

517 
	#XEN_SYSCTL_CPUPOOL_OP_DESTROY
 2

	)

518 
	#XEN_SYSCTL_CPUPOOL_OP_INFO
 3

	)

519 
	#XEN_SYSCTL_CPUPOOL_OP_ADDCPU
 4

	)

520 
	#XEN_SYSCTL_CPUPOOL_OP_RMCPU
 5

	)

521 
	#XEN_SYSCTL_CPUPOOL_OP_MOVEDOMAIN
 6

	)

522 
	#XEN_SYSCTL_CPUPOOL_OP_FREEINFO
 7

	)

523 
	#XEN_SYSCTL_CPUPOOL_PAR_ANY
 0xFFFFFFFF

	)

524 
	sx’_sysùl_ıupoŞ_İ
 {

525 
ušt32_t
 
	mİ
;

526 
ušt32_t
 
	mıupoŞ_id
;

527 
ušt32_t
 
	msched_id
;

528 
ušt32_t
 
	mdomid
;

529 
ušt32_t
 
	mıu
;

530 
ušt32_t
 
	mn_dom
;

531 
x’ùl_ıum­
 
	mıum­
;

533 
x’_sysùl_ıupoŞ_İ
 
	tx’_sysùl_ıupoŞ_İ_t
;

534 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_ıupoŞ_İ_t
);

536 
	#ARINC653_MAX_DOMAINS_PER_SCHEDULE
 64

	)

541 
	sx’_sysùl_¬šc653_scheduË
 {

544 
ušt64_®igÃd_t
 
	mmajÜ_äame
;

547 
ušt8_t
 
	mnum_sched_’Œ›s
;

551 
x’_domaš_hªdË_t
 
	mdom_hªdË
;

555 
	mvıu_id
;

558 
ušt64_®igÃd_t
 
	mruÁime
;

559 } 
	msched_’Œ›s
[
ARINC653_MAX_DOMAINS_PER_SCHEDULE
];

561 
x’_sysùl_¬šc653_scheduË
 
	tx’_sysùl_¬šc653_scheduË_t
;

562 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_¬šc653_scheduË_t
);

566 
	#XEN_SYSCTL_SCHEDOP_putšfo
 0

	)

567 
	#XEN_SYSCTL_SCHEDOP_g‘šfo
 1

	)

568 
	sx’_sysùl_scheduËr_İ
 {

569 
ušt32_t
 
	mıupoŞ_id
;

570 
ušt32_t
 
	msched_id
;

571 
ušt32_t
 
	mcmd
;

573 
	sx’_sysùl_sched_¬šc653
 {

574 
XEN_GUEST_HANDLE_64
(
x’_sysùl_¬šc653_scheduË_t
è
	mscheduË
;

575 } 
	msched_¬šc653
;

576 } 
	mu
;

578 
x’_sysùl_scheduËr_İ
 
	tx’_sysùl_scheduËr_İ_t
;

579 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_scheduËr_İ_t
);

581 
	sx’_sysùl
 {

582 
ušt32_t
 
	mcmd
;

583 
	#XEN_SYSCTL_»adcÚsŞe
 1

	)

584 
	#XEN_SYSCTL_tbuf_İ
 2

	)

585 
	#XEN_SYSCTL_physšfo
 3

	)

586 
	#XEN_SYSCTL_sched_id
 4

	)

587 
	#XEN_SYSCTL_³rfc_İ
 5

	)

588 
	#XEN_SYSCTL_g‘domaššfŞi¡
 6

	)

589 
	#XEN_SYSCTL_debug_keys
 7

	)

590 
	#XEN_SYSCTL_g‘ıušfo
 8

	)

591 
	#XEN_SYSCTL_avah—p
 9

	)

592 
	#XEN_SYSCTL_g‘_pm¡©
 10

	)

593 
	#XEN_SYSCTL_ıu_hÙ¶ug
 11

	)

594 
	#XEN_SYSCTL_pm_İ
 12

	)

595 
	#XEN_SYSCTL_·ge_ofæše_İ
 14

	)

596 
	#XEN_SYSCTL_lock´of_İ
 15

	)

597 
	#XEN_SYSCTL_tİŞogyšfo
 16

	)

598 
	#XEN_SYSCTL_numašfo
 17

	)

599 
	#XEN_SYSCTL_ıupoŞ_İ
 18

	)

600 
	#XEN_SYSCTL_scheduËr_İ
 19

	)

601 
ušt32_t
 
	mš‹rçû_v”siÚ
;

603 
x’_sysùl_»adcÚsŞe
 
	m»adcÚsŞe
;

604 
x’_sysùl_tbuf_İ
 
	mtbuf_İ
;

605 
x’_sysùl_physšfo
 
	mphysšfo
;

606 
x’_sysùl_tİŞogyšfo
 
	mtİŞogyšfo
;

607 
x’_sysùl_numašfo
 
	mnumašfo
;

608 
x’_sysùl_sched_id
 
	msched_id
;

609 
x’_sysùl_³rfc_İ
 
	m³rfc_İ
;

610 
x’_sysùl_g‘domaššfŞi¡
 
	mg‘domaššfŞi¡
;

611 
x’_sysùl_debug_keys
 
	mdebug_keys
;

612 
x’_sysùl_g‘ıušfo
 
	mg‘ıušfo
;

613 
x’_sysùl_avah—p
 
	mavah—p
;

614 
x’_sysùl_g‘_pm¡©
 
	mg‘_pm¡©
;

615 
x’_sysùl_ıu_hÙ¶ug
 
	mıu_hÙ¶ug
;

616 
x’_sysùl_pm_İ
 
	mpm_İ
;

617 
x’_sysùl_·ge_ofæše_İ
 
	m·ge_ofæše
;

618 
x’_sysùl_lock´of_İ
 
	mlock´of_İ
;

619 
x’_sysùl_ıupoŞ_İ
 
	mıupoŞ_İ
;

620 
x’_sysùl_scheduËr_İ
 
	mscheduËr_İ
;

621 
ušt8_t
 
	m·d
[128];

622 } 
	mu
;

624 
x’_sysùl
 
	tx’_sysùl_t
;

625 
DEFINE_XEN_GUEST_HANDLE
(
x’_sysùl_t
);

	@/usr/include/xen/xsm/acm.h

26 #iâdeà
_XEN_PUBLIC_ACM_H


27 
	#_XEN_PUBLIC_ACM_H


	)

29 
	~"../x’.h
"

32 
	#ACM_DEFAULT_SSID
 0x0

	)

33 
	#ACM_DEFAULT_LOCAL_SSID
 0x0

	)

36 
	#ACM_OK
 0

	)

37 
	#ACM_UNDEF
 -1

	)

38 
	#ACM_INIT_SSID_ERROR
 -2

	)

39 
	#ACM_INIT_SOID_ERROR
 -3

	)

40 
	#ACM_ERROR
 -4

	)

43 
	#ACM_ACCESS_PERMITTED
 0

	)

44 
	#ACM_ACCESS_DENIED
 -111

	)

45 
	#ACM_NULL_POINTER_ERROR
 -200

	)

53 
	#ACM_EVTCHN_SHARING_VIOLATION
 0x100

	)

54 
	#ACM_GNTTAB_SHARING_VIOLATION
 0x101

	)

55 
	#ACM_DOMAIN_LOOKUP
 0x102

	)

56 
	#ACM_CHWALL_CONFLICT
 0x103

	)

57 
	#ACM_SSIDREF_IN_USE
 0x104

	)

61 
	#ACM_NULL_POLICY
 0

	)

62 
	#ACM_CHINESE_WALL_POLICY
 1

	)

63 
	#ACM_SIMPLE_TYPE_ENFORCEMENT_POLICY
 2

	)

64 
	#ACM_POLICY_UNDEFINED
 15

	)

67 
	#ACM_CHINESE_WALL_AND_SIMPLE_TYPE_ENFORCEMENT_POLICY
 \

68 ((
ACM_SIMPLE_TYPE_ENFORCEMENT_POLICY
 << 4è| 
ACM_CHINESE_WALL_POLICY
)

	)

71 
	#ACM_POLICY_NAME
(
X
) \

72 ((
X
è=ğ(
ACM_NULL_POLICY
)) ? "NULL" : \

73 ((
X
è=ğ(
ACM_CHINESE_WALL_POLICY
)) ? "CHINESE WALL" : \

74 ((
X
è=ğ(
ACM_SIMPLE_TYPE_ENFORCEMENT_POLICY
)) ? "SIMPLE TYPE ENFORCEMENT" : \

75 ((
X
è=ğ(
ACM_CHINESE_WALL_AND_SIMPLE_TYPE_ENFORCEMENT_POLICY
)) ? "CHINESE WALL AND SIMPLE TYPE ENFORCEMENT" : \

76 "UNDEFINED"

	)

82 
	#ACM_POLICY_VERSION
 4

	)

83 
	#ACM_CHWALL_VERSION
 1

	)

84 
	#ACM_STE_VERSION
 1

	)

87 
ušt32_t
 
	tssid»f_t
;

90 
	#ACMHOOK_nÚe
 0

	)

91 
	#ACMHOOK_sh¬šg
 1

	)

92 
	#ACMHOOK_authÜiz©iÚ
 2

	)

93 
	#ACMHOOK_cÚæiù£t
 3

	)

98 
ušt16_t
 
	tdomašty³_t
;

120 
	#ACM_MAGIC
 0x0001debc

	)

124 
	#ACM_SHA1_HASH_SIZE
 20

	)

130 
	sacm_pŞicy_v”siÚ


132 
ušt32_t
 
	mmajÜ
;

133 
ušt32_t
 
	mmšÜ
;

145 
	sacm_pŞicy_bufãr
 {

146 
ušt32_t
 
	mmagic
;

147 
ušt32_t
 
	mpŞicy_v”siÚ
;

148 
ušt32_t
 
	mËn
;

149 
ušt32_t
 
	mpŞicy_»ã»nû_off£t
;

150 
ušt32_t
 
	m´im¬y_pŞicy_code
;

151 
ušt32_t
 
	m´im¬y_bufãr_off£t
;

152 
ušt32_t
 
	m£cÚd¬y_pŞicy_code
;

153 
ušt32_t
 
	m£cÚd¬y_bufãr_off£t
;

154 
acm_pŞicy_v”siÚ
 
	mxml_pŞ_v”siÚ
;

155 
ušt8_t
 
	mxml_pŞicy_hash
[
ACM_SHA1_HASH_SIZE
];

159 
	sacm_pŞicy_»ã»nû_bufãr
 {

160 
ušt32_t
 
	mËn
;

163 
	sacm_chw®l_pŞicy_bufãr
 {

164 
ušt32_t
 
	mpŞicy_v”siÚ
;

165 
ušt32_t
 
	mpŞicy_code
;

166 
ušt32_t
 
	mchw®l_max_ty³s
;

167 
ušt32_t
 
	mchw®l_max_ssid»fs
;

168 
ušt32_t
 
	mchw®l_max_cÚæiù£ts
;

169 
ušt32_t
 
	mchw®l_ssid_off£t
;

170 
ušt32_t
 
	mchw®l_cÚæiù_£ts_off£t
;

171 
ušt32_t
 
	mchw®l_ruÂšg_ty³s_off£t
;

172 
ušt32_t
 
	mchw®l_cÚæiù_agg»g©e_off£t
;

175 
	sacm_¡e_pŞicy_bufãr
 {

176 
ušt32_t
 
	mpŞicy_v”siÚ
;

177 
ušt32_t
 
	mpŞicy_code
;

178 
ušt32_t
 
	m¡e_max_ty³s
;

179 
ušt32_t
 
	m¡e_max_ssid»fs
;

180 
ušt32_t
 
	m¡e_ssid_off£t
;

183 
	sacm_¡©s_bufãr
 {

184 
ušt32_t
 
	mmagic
;

185 
ušt32_t
 
	mËn
;

186 
ušt32_t
 
	m´im¬y_pŞicy_code
;

187 
ušt32_t
 
	m´im¬y_¡©s_off£t
;

188 
ušt32_t
 
	m£cÚd¬y_pŞicy_code
;

189 
ušt32_t
 
	m£cÚd¬y_¡©s_off£t
;

192 
	sacm_¡e_¡©s_bufãr
 {

193 
ušt32_t
 
	mec_ev®_couÁ
;

194 
ušt32_t
 
	mgt_ev®_couÁ
;

195 
ušt32_t
 
	mec_d’›d_couÁ
;

196 
ušt32_t
 
	mgt_d’›d_couÁ
;

197 
ušt32_t
 
	mec_ÿcheh™_couÁ
;

198 
ušt32_t
 
	mgt_ÿcheh™_couÁ
;

201 
	sacm_ssid_bufãr
 {

202 
ušt32_t
 
	mËn
;

203 
ssid»f_t
 
	mssid»f
;

204 
ušt32_t
 
	mpŞicy_»ã»nû_off£t
;

205 
ušt32_t
 
	m´im¬y_pŞicy_code
;

206 
ušt32_t
 
	m´im¬y_max_ty³s
;

207 
ušt32_t
 
	m´im¬y_ty³s_off£t
;

208 
ušt32_t
 
	m£cÚd¬y_pŞicy_code
;

209 
ušt32_t
 
	m£cÚd¬y_max_ty³s
;

210 
ušt32_t
 
	m£cÚd¬y_ty³s_off£t
;

	@/usr/include/xen/xsm/acm_ops.h

26 #iâdeà
__XEN_PUBLIC_ACM_OPS_H__


27 
	#__XEN_PUBLIC_ACM_OPS_H__


	)

29 
	~"../x’.h
"

30 
	~"acm.h
"

37 
	#ACM_INTERFACE_VERSION
 0xAAAA000A

	)

49 
	#ACMOP_£Şicy
 1

	)

50 
	sacm_£Şicy
 {

52 
XEN_GUEST_HANDLE_64
(è
	mpushÿche
;

53 
ušt32_t
 
	mpushÿche_size
;

57 
	#ACMOP_g‘pŞicy
 2

	)

58 
	sacm_g‘pŞicy
 {

60 
XEN_GUEST_HANDLE_64
(è
	mpuÎÿche
;

61 
ušt32_t
 
	mpuÎÿche_size
;

65 
	#ACMOP_dump¡©s
 3

	)

66 
	sacm_dump¡©s
 {

68 
XEN_GUEST_HANDLE_64
(è
	mpuÎÿche
;

69 
ušt32_t
 
	mpuÎÿche_size
;

73 
	#ACMOP_g‘ssid
 4

	)

74 
	#ACM_GETBY_ssid»f
 1

	)

75 
	#ACM_GETBY_domašid
 2

	)

76 
	sacm_g‘ssid
 {

78 
ušt32_t
 
	mg‘_ssid_by
;

80 
domašty³_t
 
	mdomašid
;

81 
ssid»f_t
 
	mssid»f
;

82 } 
	mid
;

83 
XEN_GUEST_HANDLE_64
(è
	mssidbuf
;

84 
ušt32_t
 
	mssidbuf_size
;

87 
	#ACMOP_g‘decisiÚ
 5

	)

88 
	sacm_g‘decisiÚ
 {

90 
ušt32_t
 
	mg‘_decisiÚ_by1
;

91 
ušt32_t
 
	mg‘_decisiÚ_by2
;

93 
domašty³_t
 
	mdomašid
;

94 
ssid»f_t
 
	mssid»f
;

95 } 
	mid1
;

97 
domašty³_t
 
	mdomašid
;

98 
ssid»f_t
 
	mssid»f
;

99 } 
	mid2
;

100 
ušt32_t
 
	mhook
;

102 
ušt32_t
 
	macm_decisiÚ
;

106 
	#ACMOP_chgpŞicy
 6

	)

107 
	sacm_chªge_pŞicy
 {

109 
XEN_GUEST_HANDLE_64
(è
	mpŞicy_pushÿche
;

110 
ušt32_t
 
	mpŞicy_pushÿche_size
;

111 
XEN_GUEST_HANDLE_64
(è
	md–_¬¿y
;

112 
ušt32_t
 
	md–¬¿y_size
;

113 
XEN_GUEST_HANDLE_64
(è
	mchg_¬¿y
;

114 
ušt32_t
 
	mchg¬¿y_size
;

117 
XEN_GUEST_HANDLE_64
(è
	m”r_¬¿y
;

118 
ušt32_t
 
	m”¿¼ay_size
;

121 
	#ACMOP_»Ïb–doms
 7

	)

122 
	sacm_»Ïb–_doms
 {

124 
XEN_GUEST_HANDLE_64
(è
	m»Ïb–_m­
;

125 
ušt32_t
 
	m»Ïb–_m­_size
;

127 
XEN_GUEST_HANDLE_64
(è
	m”r_¬¿y
;

128 
ušt32_t
 
	m”¿¼ay_size
;

132 
	sx’_acmùl
 {

133 
ušt32_t
 
	mcmd
;

134 
ušt32_t
 
	mš‹rçû_v”siÚ
;

136 
acm_£Şicy
 
	m£Şicy
;

137 
acm_g‘pŞicy
 
	mg‘pŞicy
;

138 
acm_dump¡©s
 
	mdump¡©s
;

139 
acm_g‘ssid
 
	mg‘ssid
;

140 
acm_g‘decisiÚ
 
	mg‘decisiÚ
;

141 
acm_chªge_pŞicy
 
	mchªge_pŞicy
;

142 
acm_»Ïb–_doms
 
	m»Ïb–_doms
;

143 } 
	mu
;

146 
x’_acmùl
 
	tx’_acmùl_t
;

147 
DEFINE_XEN_GUEST_HANDLE
(
x’_acmùl_t
);

	@/usr/include/xen/xsm/flask_op.h

25 #iâdeà
__FLASK_OP_H__


26 
	#__FLASK_OP_H__


	)

28 
	#FLASK_LOAD
 1

	)

29 
	#FLASK_GETENFORCE
 2

	)

30 
	#FLASK_SETENFORCE
 3

	)

31 
	#FLASK_CONTEXT_TO_SID
 4

	)

32 
	#FLASK_SID_TO_CONTEXT
 5

	)

33 
	#FLASK_ACCESS
 6

	)

34 
	#FLASK_CREATE
 7

	)

35 
	#FLASK_RELABEL
 8

	)

36 
	#FLASK_USER
 9

	)

37 
	#FLASK_POLICYVERS
 10

	)

38 
	#FLASK_GETBOOL
 11

	)

39 
	#FLASK_SETBOOL
 12

	)

40 
	#FLASK_COMMITBOOLS
 13

	)

41 
	#FLASK_MLS
 14

	)

42 
	#FLASK_DISABLE
 15

	)

43 
	#FLASK_GETAVC_THRESHOLD
 16

	)

44 
	#FLASK_SETAVC_THRESHOLD
 17

	)

45 
	#FLASK_AVC_HASHSTATS
 18

	)

46 
	#FLASK_AVC_CACHESTATS
 19

	)

47 
	#FLASK_MEMBER
 20

	)

48 
	#FLASK_ADD_OCONTEXT
 21

	)

49 
	#FLASK_DEL_OCONTEXT
 22

	)

51 
	#FLASK_LAST
 
FLASK_DEL_OCONTEXT


	)

53 
	sæask_İ
 {

54 
ušt32_t
 
	mcmd
;

55 
ušt32_t
 
	msize
;

56 *
	mbuf
;

57 } 
	tæask_İ_t
;

59 
DEFINE_XEN_GUEST_HANDLE
(
æask_İ_t
);

	@/usr/include/xentoollog.h

22 #iâdeà
XENTOOLLOG_H


23 
	#XENTOOLLOG_H


	)

25 
	~<¡dio.h
>

26 
	~<¡d¬g.h
>

31 
	ex’toŞlog_Ëv–
 {

32 
	mXTL_NONE
,

33 
	mXTL_DEBUG
,

34 
	mXTL_VERBOSE
,

35 
	mXTL_DETAIL
,

36 
	mXTL_PROGRESS
,

37 
	mXTL_INFO
,

38 
	mXTL_NOTICE
,

39 
	mXTL_WARN
,

40 
	mXTL_ERROR
,

41 
	mXTL_CRITICAL
,

42 
	mXTL_NUM_LEVELS


43 } 
	tx’toŞlog_Ëv–
;

45 
x’toŞlog_logg”
 
	tx’toŞlog_logg”
;

46 
	sx’toŞlog_logg”
 {

47 (*
	mvmes§ge
)(
x’toŞlog_logg”
 *
	mlogg”
,

48 
x’toŞlog_Ëv–
 
	mËv–
,

49 
	m”ºov®
 ,

50 cÚ¡ *
	mcÚ‹xt
 ,

51 cÚ¡ *
	mfÜm©
 ,

52 
va_li¡
 
	m®
)

53 
__©Œibu‹__
((
fÜm©
(
´štf
,5,0)));

54 (*
	m´og»ss
)(
x’toŞlog_logg”
 *
	mlogg”
,

55 cÚ¡ *
	mcÚ‹xt
 ,

56 cÚ¡ *
	mdošg_wh©
 ,

57 
	m³rûÁ
, 
	mdÚe
, 
	mtÙ®
)

61 (*
	mde¡roy
)(
x’toŞlog_logg”
 *
	mlogg”
);

68 
	#XTL_STDIOSTREAM_SHOW_PID
 01u

	)

69 
	#XTL_STDIOSTREAM_SHOW_DATE
 02u

	)

70 
	#XTL_STDIOSTREAM_HIDE_PROGRESS
 04u

	)

72 
x’toŞlog_logg”_¡dio¡»am
 
	tx’toŞlog_logg”_¡dio¡»am
;

74 
x’toŞlog_logg”_¡dio¡»am
 *
	gx_ü—‹logg”_¡dio¡»am


75 (
FILE
 *
	gf
, 
x’toŞlog_Ëv–
 
	gmš_Ëv–
, 
	gæags
);

79 
x_¡dio¡»am_£t_mšËv–
(
x’toŞlog_logg”_¡dio¡»am
*,

80 
x’toŞlog_Ëv–
 
mš_Ëv–
);

81 
x_¡dio¡»am_adju¡_æags
(
x’toŞlog_logg”_¡dio¡»am
*,

82 
£t_æags
, 
ş—r_æags
);

85 
x_logg”_de¡roy
(
x’toŞlog_logg”
 *
logg”
 );

90 
	$x_logv
(
x’toŞlog_logg”
 *
logg”
,

91 
x’toŞlog_Ëv–
 
Ëv–
,

92 
”ºov®
 ,

93 cÚ¡ *
cÚ‹xt
 ,

94 cÚ¡ *
fÜm©
 ,

95 
va_li¡
è
	`__©Œibu‹__
((
	`fÜm©
(
´štf
,5,0)));

97 
	$x_log
(
x’toŞlog_logg”
 *
logg”
,

98 
x’toŞlog_Ëv–
 
Ëv–
,

99 
”ºov®
 ,

100 cÚ¡ *
cÚ‹xt
 ,

101 cÚ¡ *
fÜm©
 ,

102 ...è
	`__©Œibu‹__
((
	`fÜm©
(
´štf
,5,6)));

104 
	`x_´og»ss
(
x’toŞlog_logg”
 *
logg”
,

105 cÚ¡ *
cÚ‹xt
 ,

106 cÚ¡ *
došg_wh©
,

107 
dÚe
, 
tÙ®
);

112 cÚ¡ *
	`x_Ëv–_to_¡ršg
(
x’toŞlog_Ëv–
);

115 
	#XTL_NEW_LOGGER
(
LOGGER
,
bufãr
) ({ \

116 
x’toŞlog_logg”_
##
LOGGER
 *
Ãw_cÚsum”
; \

118 (
bufãr
).
vbË
.
vmes§ge
 = 
LOGGER
##
_vmes§ge
; \

119 (
bufãr
).
vbË
.
´og»ss
 = 
LOGGER
##
_´og»ss
; \

120 (
bufãr
).
vbË
.
de¡roy
 = 
LOGGER
##
_de¡roy
; \

122 
Ãw_cÚsum”
 = 
	`m®loc
((*new_consumer)); \

123 ià(!
Ãw_cÚsum”
) { \

124 
	`x_log
((
x’toŞlog_logg”
*)&
bufãr
, \

125 
XTL_CRITICAL
, 
”ºo
, "xtl", \

128 *
Ãw_cÚsum”
 = 
bufãr
; \

131 
Ãw_cÚsum”
; \

132 
	}
});

	)

	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
__loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb¡©e_t
 
	m__¡©e
;

26 } 
	t_G_åos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb¡©e_t
 
	m__¡©e
;

31 } 
	t_G_åos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¬_t
 
wch¬_t


	)

38 
	#_G_wšt_t
 
wšt_t


	)

39 
	#_G_¡©64
 
¡©64


	)

40 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gcÚv.h
>

44 
__gcÚv_šfo
 
	m__cd
;

47 
__gcÚv_šfo
 
	m__cd
;

48 
__gcÚv_¡•_d©a
 
	m__d©a
;

49 } 
	m__combšed
;

50 } 
	t_G_icÚv_t
;

53 
	t_G_št16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_št32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_ušt16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_ušt32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__İ’64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm­64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
è
	`__fx¡©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #ià
defšed
 
__ılu¥lus
 || defšed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
è
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
è()

	)

	@/usr/include/asm-generic/int-ll64.h

8 #iâdeà
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__ASSEMBLY__


19 
__sigÃd__
 
	t__s8
;

20 
	t__u8
;

22 
__sigÃd__
 
	t__s16
;

23 
	t__u16
;

25 
__sigÃd__
 
	t__s32
;

26 
	t__u32
;

28 #ifdeà
__GNUC__


29 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

30 
__ex‹nsiÚ__
 
	t__u64
;

32 
__sigÃd__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/libio-ldbl.h

20 #iâdeà
_IO_STDIO_H


24 
	$__LDBL_REDIR_DECL
 (
_IO_vfsÿnf
)

25 
	`__LDBL_REDIR_DECL
 (
_IO_vårštf
)

	@/usr/include/bits/select.h

19 #iâdeà
_SYS_SELECT_H


23 
	~<b™s/wÜdsize.h
>

26 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

28 #ià
__WORDSIZE
 == 64

29 
	#__FD_ZERO_STOS
 "¡osq"

	)

31 
	#__FD_ZERO_STOS
 "¡o¦"

	)

34 
	#__FD_ZERO
(
fd¥
) \

36 
__d0
, 
__d1
; \

37 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

38 : "=c" (
__d0
), "=D" (
__d1
) \

39 : "a" (0), "0" ( (
fd_£t
) \

40 /  (
__fd_mask
)), \

41 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

43 } 0)

	)

49 
	#__FD_ZERO
(
£t
) \

51 
__i
; \

52 
fd_£t
 *
__¬r
 = (
£t
); \

53 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

54 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

55 } 0)

	)

59 
	#__FD_SET
(
d
, 
£t
è(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] |ğ
	`__FDMASK
 (d))

	)

60 
	#__FD_CLR
(
d
, 
£t
è(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] &ğ~
	`__FDMASK
 (d))

	)

61 
	#__FD_ISSET
(
d
, 
£t
) \

62 ((
	`__FDS_BITS
 (
£t
)[
	`__FDELT
 (
d
)] & 
	`__FDMASK
 (d)è!ğ0)

	)

	@/usr/include/bits/sigset.h

21 #iâdef 
_SIGSET_H_ty³s


22 
	#_SIGSET_H_ty³s
 1

	)

24 
	t__sig_©omic_t
;

28 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

31 
	m__v®
[
_SIGSET_NWORDS
];

32 } 
	t__sig£t_t
;

43 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


44 
	#_SIGSET_H_âs
 1

	)

46 #iâdeà
_EXTERN_INLINE


47 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

51 
	#__sigmask
(
sig
) \

52 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

55 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

57 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

58 
	#__sigem±y£t
(
£t
) \

59 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

60 
sig£t_t
 *
__£t
 = (
£t
); \

61 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

62 0; }))

	)

63 
	#__sigfl£t
(
£t
) \

64 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

65 
sig£t_t
 *
__£t
 = (
£t
); \

66 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

67 0; }))

	)

69 #ifdeà
__USE_GNU


73 
	#__sigi£m±y£t
(
£t
) \

74 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

75 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

76 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

77 !
__»t
 && --
__út
 >= 0) \

78 
__»t
 = 
__£t
->
__v®
[
__út
]; \

79 
__»t
 =ğ0; }))

	)

80 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

81 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

82 
sig£t_t
 *
__de¡
 = (
de¡
); \

83 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

84 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

85 --
__út
 >= 0) \

86 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

87 & 
__right
->
__v®
[
__út
]); \

88 0; }))

	)

89 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

90 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

91 
sig£t_t
 *
__de¡
 = (
de¡
); \

92 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

93 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

94 --
__út
 >= 0) \

95 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

96 | 
__right
->
__v®
[
__út
]); \

97 0; }))

	)

104 
__sigismemb”
 (
__cÚ¡
 
__sig£t_t
 *, );

105 
__sigadd£t
 (
__sig£t_t
 *, );

106 
__sigd–£t
 (
__sig£t_t
 *, );

108 #ifdeà
__USE_EXTERN_INLINES


109 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

110 
_EXTERN_INLINE
 \

111 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

113 
__mask
 = 
	`__sigmask
 (
__sig
); \

114 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

115  
BODY
; \

116 }

	)

118 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
è? 1 : 0, 
__cÚ¡
)

119 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

120 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

122 #undeà
__SIGSETFN


	@/usr/include/bits/stdio-lock.h

20 #iâdeà
_BITS_STDIO_LOCK_H


21 
	#_BITS_STDIO_LOCK_H
 1

	)

23 
	~<b™s/libc-lock.h
>

25 
	$__libc_lock_defše_»cursive
 (, 
_IO_lock_t
)

28 #ifdeà
	t_LIBC_LOCK_RECURSIVE_INITIALIZER


29 
	t_IO_lock_š™Ÿliz”
 
	t_LIBC_LOCK_RECURSIVE_INITIALIZER


	)

30 #–ià
	t_IO_MTSAFE_IO


31 #”rÜ 
	tlibio
 
	tÃeds
 
	t»cursive
 
	tmu‹xes
 
	t_IO_MTSAFE_IO


34 
	t_IO_lock_š™
(
	t_Çme
è
	t__libc_lock_š™_»cursive
 (_Çme)

	)

35 
	t_IO_lock_fši
(
	t_Çme
è
	t__libc_lock_fši_»cursive
 (_Çme)

	)

36 
	t_IO_lock_lock
(
	t_Çme
è
	t__libc_lock_lock_»cursive
 (_Çme)

	)

37 
	t_IO_lock_Œylock
(
	t_Çme
è
	t__libc_lock_Œylock_»cursive
 (_Çme)

	)

38 
	t_IO_lock_uÆock
(
	t_Çme
è
	t__libc_lock_uÆock_»cursive
 (_Çme)

	)

41 
	t_IO_ş—nup_»giÚ_¡¬t
(
	t_fù
, 
	t_å
) \

42 
	t__libc_ş—nup_»giÚ_¡¬t
 (((
	t_å
)->
	t_æags
 & 
	t_IO_USER_LOCK
è=ğ0, 
	t_fù
, _å)

	)

43 
	t_IO_ş—nup_»giÚ_¡¬t_nßrg
(
	t_fù
) \

44 
	t__libc_ş—nup_»giÚ_¡¬t
 (1, 
	t_fù
, 
	tNULL
)

	)

45 
	t_IO_ş—nup_»giÚ_’d
(
	t_do™
) \

46 
	t__libc_ş—nup_»giÚ_’d
 (
	t_do™
)

	)

48 #ià
	tdefšed
 
	t_LIBC
 && !defšed 
	tNOT_IN_libc


49 
	t_IO_acquœe_lock
(
	t_å
) \

50 
	t_IO_ş—nup_»giÚ_¡¬t
 (((*è(*)è
	t_IO_fuÆockfe
, (
	t_å
)); \

51 
	`_IO_æockfe
 (
_å
)

	)

53 
	#_IO_»Ëa£_lock
(
_å
) \

54 
	`_IO_fuÆockfe
 (
_å
); \

55 
	`_IO_ş—nup_»giÚ_’d
 (0)

	)

	@/usr/include/bits/time.h

24 #iâdeà
__Ãed_timev®


25 #iâdeà
_BITS_TIME_H


26 
	#_BITS_TIME_H
 1

	)

34 
	#CLOCKS_PER_SEC
 1000000l

	)

36 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


39 
	~<b™s/ty³s.h
>

40 
__syscÚf
 ();

41 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

44 #ifdeà
__USE_POSIX199309


46 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

50 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

52 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

54 
	#CLOCK_MONOTONIC_RAW
 4

	)

56 
	#CLOCK_REALTIME_COARSE
 5

	)

58 
	#CLOCK_MONOTONIC_COARSE
 6

	)

61 
	#TIMER_ABSTIME
 1

	)

67 #ifdeà
__Ãed_timev®


68 #undeà
__Ãed_timev®


69 #iâdeà
_STRUCT_TIMEVAL


70 
	#_STRUCT_TIMEVAL
 1

	)

71 
	~<b™s/ty³s.h
>

75 
	stimev®


77 
__time_t
 
	mtv_£c
;

78 
__su£cÚds_t
 
	mtv_u£c
;

	@/usr/include/bits/typesizes.h

20 #iâdeà
_BITS_TYPES_H


24 #iâdef 
_BITS_TYPESIZES_H


25 
	#_BITS_TYPESIZES_H
 1

	)

30 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

31 
	#__UID_T_TYPE
 
__U32_TYPE


	)

32 
	#__GID_T_TYPE
 
__U32_TYPE


	)

33 
	#__INO_T_TYPE
 
__ULONGWORD_TYPE


	)

34 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

35 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

36 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

37 
	#__OFF_T_TYPE
 
__SLONGWORD_TYPE


	)

38 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

39 
	#__PID_T_TYPE
 
__S32_TYPE


	)

40 
	#__RLIM_T_TYPE
 
__ULONGWORD_TYPE


	)

41 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

42 
	#__BLKCNT_T_TYPE
 
__SLONGWORD_TYPE


	)

43 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

44 
	#__FSBLKCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

45 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

46 
	#__FSFILCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

47 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

48 
	#__ID_T_TYPE
 
__U32_TYPE


	)

49 
	#__CLOCK_T_TYPE
 
__SLONGWORD_TYPE


	)

50 
	#__TIME_T_TYPE
 
__SLONGWORD_TYPE


	)

51 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

52 
	#__SUSECONDS_T_TYPE
 
__SLONGWORD_TYPE


	)

53 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

54 
	#__SWBLK_T_TYPE
 
__SLONGWORD_TYPE


	)

55 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

56 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

57 
	#__TIMER_T_TYPE
 *

	)

58 
	#__BLKSIZE_T_TYPE
 
__SLONGWORD_TYPE


	)

59 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

60 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

63 
	#__FD_SETSIZE
 65535

	)

	@/usr/include/bits/wchar.h

20 #iâdeà
_BITS_WCHAR_H


21 
	#_BITS_WCHAR_H
 1

	)

23 
	#__WCHAR_MIN
 (-2147483647 - 1)

	)

24 
	#__WCHAR_MAX
 (2147483647)

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__


4 
	#__WORDSIZE
 64

	)

5 
	#__WORDSIZE_COMPAT32
 1

	)

7 
	#__WORDSIZE
 32

	)

	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

91 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

92 
	#__tßscii
(
c
è((cè& 0x7fè

	)

94 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__exùy³
 (
i§Êum
);

103 
	`__exùy³
 (
i§Íha
);

104 
	`__exùy³
 (
isúŒl
);

105 
	`__exùy³
 (
isdig™
);

106 
	`__exùy³
 (
i¦ow”
);

107 
	`__exùy³
 (
isg¿ph
);

108 
	`__exùy³
 (
i¥ršt
);

109 
	`__exùy³
 (
i¥unù
);

110 
	`__exùy³
 (
is¥aû
);

111 
	`__exùy³
 (
isuµ”
);

112 
	`__exùy³
 (
isxdig™
);

116 
	$tŞow”
 (
__c
è
__THROW
;

119 
	$touµ”
 (
__c
è
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__exùy³
 (
isbÏnk
);

130 
__END_NAMESPACE_C99


133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE
 && !defšed 
__ılu¥lus


173 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

174 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

175 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

176 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

177 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

178 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

179 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

180 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

181 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

182 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

183 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

185 #ifdeà
__USE_ISOC99


186 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

189 #ifdeà
__USE_EXTERN_INLINES


190 
__ex‹º_šlše
 

191 
__NTH
 (
	$tŞow”
 (
__c
))

193  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

194 
	}
}

196 
__ex‹º_šlše
 

197 
__NTH
 (
	$touµ”
 (
__c
))

199  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

200 
	}
}

203 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


204 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

205 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

208 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


209 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

210 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

212 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

213 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

219 #ifdeà
__USE_XOPEN2K8


233 
	~<xloÿË.h
>

237 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

238 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

240 
	#__exùy³_l
(
Çme
) \

241 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

247 
__exùy³_l
 (
i§Êum_l
);

248 
__exùy³_l
 (
i§Íha_l
);

249 
__exùy³_l
 (
isúŒl_l
);

250 
__exùy³_l
 (
isdig™_l
);

251 
__exùy³_l
 (
i¦ow”_l
);

252 
__exùy³_l
 (
isg¿ph_l
);

253 
__exùy³_l
 (
i¥ršt_l
);

254 
__exùy³_l
 (
i¥unù_l
);

255 
__exùy³_l
 (
is¥aû_l
);

256 
__exùy³_l
 (
isuµ”_l
);

257 
__exùy³_l
 (
isxdig™_l
);

259 
__exùy³_l
 (
isbÏnk_l
);

263 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

264 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

267 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

268 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

270 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


271 
	#__tŞow”_l
(
c
, 
loÿË
) \

272 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

273 
	#__touµ”_l
(
c
, 
loÿË
) \

274 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

275 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

276 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

280 #iâdeà
__NO_CTYPE


281 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

282 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

283 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

284 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

285 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

286 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

287 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

288 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

289 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

290 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

291 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

293 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

295 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


296 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

297 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

300 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

301 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

302 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

303 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

304 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

305 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

306 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

307 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

308 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

309 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

310 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

312 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

314 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


315 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

316 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/gnu/stubs.h

4 
	~<b™s/wÜdsize.h
>

6 #ià
__WORDSIZE
 == 32

7 
	~<gnu/¡ubs-32.h
>

8 #–ià
__WORDSIZE
 == 64

9 
	~<gnu/¡ubs-64.h
>

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__NFDBITS


22 
	#__NFDBITS
 (8 * ())

	)

24 #undeà
__FD_SETSIZE


25 
	#__FD_SETSIZE
 1024

	)

27 #undeà
__FDSET_LONGS


28 
	#__FDSET_LONGS
 (
__FD_SETSIZE
/
__NFDBITS
)

	)

30 #undeà
__FDELT


31 
	#__FDELT
(
d
è((dè/ 
__NFDBITS
)

	)

33 #undeà
__FDMASK


34 
	#__FDMASK
(
d
è(1UL << ((dè% 
__NFDBITS
))

	)

37 
	mfds_b™s
 [
__FDSET_LONGS
];

38 } 
	t__k”Ãl_fd_£t
;

41 (*
	t__k”Ãl_sighªdËr_t
)();

44 
	t__k”Ãl_key_t
;

45 
	t__k”Ãl_mqd_t
;

47 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/swab.h

1 #iâdeà
_LINUX_SWAB_H


2 
	#_LINUX_SWAB_H


	)

4 
	~<lšux/ty³s.h
>

6 
	~<asm/swab.h
>

12 
	#___cÚ¡ªt_swab16
(
x
è((
__u16
)( \

13 (((
__u16
)(
x
) & (__u16)0x00ffU) << 8) | \

14 (((
__u16
)(
x
è& (__u16)0xff00Uè>> 8)))

	)

16 
	#___cÚ¡ªt_swab32
(
x
è((
__u32
)( \

17 (((
__u32
)(
x
) & (__u32)0x000000ffUL) << 24) | \

18 (((
__u32
)(
x
) & (__u32)0x0000ff00UL) << 8) | \

19 (((
__u32
)(
x
) & (__u32)0x00ff0000UL) >> 8) | \

20 (((
__u32
)(
x
è& (__u32)0xff000000ULè>> 24)))

	)

22 
	#___cÚ¡ªt_swab64
(
x
è((
__u64
)( \

23 (((
__u64
)(
x
) & (__u64)0x00000000000000ffULL) << 56) | \

24 (((
__u64
)(
x
) & (__u64)0x000000000000ff00ULL) << 40) | \

25 (((
__u64
)(
x
) & (__u64)0x0000000000ff0000ULL) << 24) | \

26 (((
__u64
)(
x
) & (__u64)0x00000000ff000000ULL) << 8) | \

27 (((
__u64
)(
x
) & (__u64)0x000000ff00000000ULL) >> 8) | \

28 (((
__u64
)(
x
) & (__u64)0x0000ff0000000000ULL) >> 24) | \

29 (((
__u64
)(
x
) & (__u64)0x00ff000000000000ULL) >> 40) | \

30 (((
__u64
)(
x
è& (__u64)0xff00000000000000ULLè>> 56)))

	)

32 
	#___cÚ¡ªt_swahw32
(
x
è((
__u32
)( \

33 (((
__u32
)(
x
) & (__u32)0x0000ffffUL) << 16) | \

34 (((
__u32
)(
x
è& (__u32)0xffff0000ULè>> 16)))

	)

36 
	#___cÚ¡ªt_swahb32
(
x
è((
__u32
)( \

37 (((
__u32
)(
x
) & (__u32)0x00ff00ffUL) << 8) | \

38 (((
__u32
)(
x
è& (__u32)0xff00ff00ULè>> 8)))

	)

46 
__šlše__
 
__u16
 
	$__fswab16
(
__u16
 
v®
)

48 #ifdeà
__¬ch_swab16


49  
	`__¬ch_swab16
(
v®
);

51  
	`___cÚ¡ªt_swab16
(
v®
);

53 
	}
}

55 
__šlše__
 
__u32
 
	$__fswab32
(
__u32
 
v®
)

57 #ifdeà
__¬ch_swab32


58  
	`__¬ch_swab32
(
v®
);

60  
	`___cÚ¡ªt_swab32
(
v®
);

62 
	}
}

64 
__šlše__
 
__u64
 
	$__fswab64
(
__u64
 
v®
)

66 #ifdeà
__¬ch_swab64


67  
	`__¬ch_swab64
(
v®
);

68 #–ià
	`defšed
(
__SWAB_64_THRU_32__
)

69 
__u32
 
h
 = 
v®
 >> 32;

70 
__u32
 
l
 = 
v®
 & ((1ULL << 32) - 1);

71  (((
__u64
)
	`__fswab32
(
l
)è<< 32è| ((__u64)(__fswab32(
h
)));

73  
	`___cÚ¡ªt_swab64
(
v®
);

75 
	}
}

77 
__šlše__
 
__u32
 
	$__fswahw32
(
__u32
 
v®
)

79 #ifdeà
__¬ch_swahw32


80  
	`__¬ch_swahw32
(
v®
);

82  
	`___cÚ¡ªt_swahw32
(
v®
);

84 
	}
}

86 
__šlše__
 
__u32
 
	$__fswahb32
(
__u32
 
v®
)

88 #ifdeà
__¬ch_swahb32


89  
	`__¬ch_swahb32
(
v®
);

91  
	`___cÚ¡ªt_swahb32
(
v®
);

93 
	}
}

99 
	#__swab16
(
x
) \

100 (
	`__butš_cÚ¡ªt_p
((
__u16
)(
x
)) ? \

101 
	`___cÚ¡ªt_swab16
(
x
) : \

102 
	`__fswab16
(
x
))

	)

108 
	#__swab32
(
x
) \

109 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

110 
	`___cÚ¡ªt_swab32
(
x
) : \

111 
	`__fswab32
(
x
))

	)

117 
	#__swab64
(
x
) \

118 (
	`__butš_cÚ¡ªt_p
((
__u64
)(
x
)) ? \

119 
	`___cÚ¡ªt_swab64
(
x
) : \

120 
	`__fswab64
(
x
))

	)

128 
	#__swahw32
(
x
) \

129 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

130 
	`___cÚ¡ªt_swahw32
(
x
) : \

131 
	`__fswahw32
(
x
))

	)

139 
	#__swahb32
(
x
) \

140 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

141 
	`___cÚ¡ªt_swahb32
(
x
) : \

142 
	`__fswahb32
(
x
))

	)

148 
__šlše__
 
__u16
 
	$__swab16p
(cÚ¡ 
__u16
 *
p
)

150 #ifdeà
__¬ch_swab16p


151  
	`__¬ch_swab16p
(
p
);

153  
	`__swab16
(*
p
);

155 
	}
}

161 
__šlše__
 
__u32
 
	$__swab32p
(cÚ¡ 
__u32
 *
p
)

163 #ifdeà
__¬ch_swab32p


164  
	`__¬ch_swab32p
(
p
);

166  
	`__swab32
(*
p
);

168 
	}
}

174 
__šlše__
 
__u64
 
	$__swab64p
(cÚ¡ 
__u64
 *
p
)

176 #ifdeà
__¬ch_swab64p


177  
	`__¬ch_swab64p
(
p
);

179  
	`__swab64
(*
p
);

181 
	}
}

189 
__šlše__
 
__u32
 
	$__swahw32p
(cÚ¡ 
__u32
 *
p
)

191 #ifdeà
__¬ch_swahw32p


192  
	`__¬ch_swahw32p
(
p
);

194  
	`__swahw32
(*
p
);

196 
	}
}

204 
__šlše__
 
__u32
 
	$__swahb32p
(cÚ¡ 
__u32
 *
p
)

206 #ifdeà
__¬ch_swahb32p


207  
	`__¬ch_swahb32p
(
p
);

209  
	`__swahb32
(*
p
);

211 
	}
}

217 
__šlše__
 
	$__swab16s
(
__u16
 *
p
)

219 #ifdeà
__¬ch_swab16s


220 
	`__¬ch_swab16s
(
p
);

222 *
p
 = 
	`__swab16p
(p);

224 
	}
}

229 
__šlše__
 
	$__swab32s
(
__u32
 *
p
)

231 #ifdeà
__¬ch_swab32s


232 
	`__¬ch_swab32s
(
p
);

234 *
p
 = 
	`__swab32p
(p);

236 
	}
}

242 
__šlše__
 
	$__swab64s
(
__u64
 *
p
)

244 #ifdeà
__¬ch_swab64s


245 
	`__¬ch_swab64s
(
p
);

247 *
p
 = 
	`__swab64p
(p);

249 
	}
}

257 
__šlše__
 
	$__swahw32s
(
__u32
 *
p
)

259 #ifdeà
__¬ch_swahw32s


260 
	`__¬ch_swahw32s
(
p
);

262 *
p
 = 
	`__swahw32p
(p);

264 
	}
}

272 
__šlše__
 
	$__swahb32s
(
__u32
 *
p
)

274 #ifdeà
__¬ch_swahb32s


275 
	`__¬ch_swahb32s
(
p
);

277 *
p
 = 
	`__swahb32p
(p);

279 
	}
}

	@/usr/include/sys/cdefs.h

20 #iâdef 
_SYS_CDEFS_H


21 
	#_SYS_CDEFS_H
 1

	)

24 #iâdeà
_FEATURES_H


25 
	~<ã©u»s.h
>

31 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


36 #undeà
__P


37 #undeà
__PMT


39 #ifdeà
__GNUC__


46 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

47 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

48 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
)è
	)
fct

50 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

51 
	#__THROW
 
	`throw
 ()

	)

52 
	#__NTH
(
fù
èfù 
	`throw
 ()

	)

54 
	#__THROW


	)

55 
	#__NTH
(
fù
è
	)
fct

61 
	#__šlše


	)

63 
	#__THROW


	)

64 
	#__NTH
(
fù
è
	)
fct

66 
	#__cÚ¡
 cÚ¡

	)

67 
	#__sigÃd
 sigÃd

	)

68 
	#__vŞ©e
 vŞ©e

	)

74 
	#__P
(
¬gs
è
	)
args

75 
	#__PMT
(
¬gs
è
	)
args

80 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

81 
	#__STRING
(
x
è#x

	)

84 
	#__±r_t
 *

	)

85 
	#__lÚg_doubË_t
 

	)

89 #ifdef 
__ılu¥lus


90 
	#__BEGIN_DECLS
 "C" {

	)

91 
	#__END_DECLS
 }

	)

93 
	#__BEGIN_DECLS


	)

94 
	#__END_DECLS


	)

103 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


104 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

105 
	#__END_NAMESPACE_STD
 }

	)

106 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

107 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

108 
	#__END_NAMESPACE_C99
 }

	)

109 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

114 
	#__BEGIN_NAMESPACE_STD


	)

115 
	#__END_NAMESPACE_STD


	)

116 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

117 
	#__BEGIN_NAMESPACE_C99


	)

118 
	#__END_NAMESPACE_C99


	)

119 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

124 #iâdeà
__BOUNDED_POINTERS__


125 
	#__bounded


	)

126 
	#__unbounded


	)

127 
	#__±rv®ue


	)

132 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

135 #ià
__GNUC_PREREQ
 (4,3) \

136 || (
defšed
 
	g__GNUC_RH_RELEASE__
 && 
	g__GNUC__
 == 4 \

137 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

138 && 
__GNUC_RH_RELEASE__
 >= 31)

139 
	#__w¬ndeş
(
Çme
, 
msg
) \

140 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

141 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

142 
	#__”rÜdeş
(
Çme
, 
msg
) \

143 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

145 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

146 
	#__w¬Ç‰r
(
msg
)

	)

147 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

151 #ià
__GNUC_PREREQ
 (2,97)

153 
	#__æex¬r
 []

	)

155 #ifdeà
__GNUC__


156 
	#__æex¬r
 [0]

	)

158 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

159 
	#__æex¬r
 []

	)

162 
	#__æex¬r
 [1]

	)

178 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

180 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

181 #ifdeà
__ılu¥lus


182 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

183 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

185 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

186 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

188 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

189 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

202 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

203 
	#__©Œibu‹__
(
xyz
è

	)

209 #ià
__GNUC_PREREQ
 (2,96)

210 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

212 
	#__©Œibu‹_m®loc__


	)

218 #ià
__GNUC_PREREQ
 (2,96)

219 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

221 
	#__©Œibu‹_pu»__


	)

227 #ià
__GNUC_PREREQ
 (3,1)

228 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

229 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

231 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

232 
	#__©Œibu‹_nošlše__


	)

236 #ià
__GNUC_PREREQ
 (3,2)

237 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

239 
	#__©Œibu‹_d•»ÿ‹d__


	)

248 #ià
__GNUC_PREREQ
 (2,8)

249 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

251 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

258 #ià
__GNUC_PREREQ
 (2,97)

259 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

260 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

262 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

267 #ià
__GNUC_PREREQ
 (3,3)

268 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

270 
	#__nÚnuÎ
(
·¿ms
)

	)

275 #ià
__GNUC_PREREQ
 (3,4)

276 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

277 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

278 #ià
__USE_FORTIFY_LEVEL
 > 0

279 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

282 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

284 #iâdeà
__wur


285 
	#__wur


	)

289 #ià
__GNUC_PREREQ
 (3,2)

290 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

292 
	#__®ways_šlše
 
__šlše


	)

297 #ià!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3) \

298 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

299 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

300 && 
__GNUC_RH_RELEASE__
 >= 31)

301 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


302 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

303 #ià
__GNUC_PREREQ
 (4,3) \

304 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

305 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

306 && 
__GNUC_RH_RELEASE__
 >= 31)

307 
	#__ex‹º_®ways_šlše
 \

308 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
, 
__¬tificŸl__
))

	)

310 
	#__ex‹º_®ways_šlše
 \

311 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

314 
	#__ex‹º_šlše
 
__šlše


	)

315 #ià
__GNUC_PREREQ
 (4,3)

316 
	#__ex‹º_®ways_šlše
 \

317 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

319 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

326 #ià
__GNUC_PREREQ
 (4,3) \

327 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

328 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

329 && 
__GNUC_RH_RELEASE__
 >= 31)

330 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

331 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

338 #ià!
__GNUC_PREREQ
 (2,8)

339 
	#__ex‹nsiÚ__


	)

343 #ià!
__GNUC_PREREQ
 (2,92)

344 
	#__»¡riù


	)

350 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


351 
	#__»¡riù_¬r
 
__»¡riù


	)

353 #ifdeà
__GNUC__


354 
	#__»¡riù_¬r


	)

356 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

357 
	#__»¡riù_¬r
 
»¡riù


	)

360 
	#__»¡riù_¬r


	)

365 
	~<b™s/wÜdsize.h
>

367 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


368 
	#__LDBL_COMPAT
 1

	)

369 #ifdeà
__REDIRECT


370 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

371 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

372 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

373 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

374 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

375 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

376 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

377 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

378 
	#__LDBL_REDIR_DECL
(
Çme
) \

379 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

380 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

381 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

382 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

383 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

386 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


387 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

388 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

389 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

390 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

391 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

392 #ifdeà
__REDIRECT


393 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

394 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

395 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/asm/bitsperlong.h

1 #iâdeà
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifdeà
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-g’”ic/b™¥”lÚg.h
>

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~"posix_ty³s_32.h
"

4 
	~"posix_ty³s_64.h
"

	@/usr/include/asm/swab.h

1 #iâdeà
_ASM_X86_SWAB_H


2 
	#_ASM_X86_SWAB_H


	)

4 
	~<lšux/ty³s.h
>

7 
__šlše__
 
__u32
 
	$__¬ch_swab32
(
__u32
 
v®
)

9 #ifdeà
__i386__


10 #ifdeà
CONFIG_X86_BSWAP


11 
	`__asm__
("bsw­ %0" : "ô" (
v®
) : "0" (val));

13 
	`__asm__
("xchgb %b0,%h0\n\t"

16 : "=q" (
v®
)

17 : "0" (
v®
));

21 
	`__asm__
("bswapl %0"

22 : "ô" (
v®
)

23 : "0" (
v®
));

25  
v®
;

26 
	}
}

27 
	#__¬ch_swab32
 
__¬ch_swab32


	)

29 
__šlše__
 
__u64
 
	$__¬ch_swab64
(
__u64
 
v®
)

31 #ifdeà
__i386__


34 
__u32
 
a
;

35 
__u32
 
b
;

36 } 
s
;

37 
__u64
 
u
;

38 } 
v
;

39 
v
.
u
 = 
v®
;

40 #ifdeà
CONFIG_X86_BSWAP


41 
	`__asm__
("bswapl %0 ; bswapl %1 ; xchgl %0,%1"

42 : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
)

43 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

45 
v
.
s
.
a
 = 
	`__¬ch_swab32
(v.s.a);

46 
v
.
s
.
b
 = 
	`__¬ch_swab32
(v.s.b);

47 
	`__asm__
("xchgl %0,%1"

48 : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
)

49 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

51  
v
.
u
;

53 
	`__asm__
("bswapq %0"

54 : "ô" (
v®
)

55 : "0" (
v®
));

56  
v®
;

58 
	}
}

59 
	#__¬ch_swab64
 
__¬ch_swab64


	)

	@/usr/include/bits/libc-lock.h

21 #iâdeà
_BITS_LIBC_LOCK_H


22 
	#_BITS_LIBC_LOCK_H
 1

	)

24 
	~<±h»ad.h
>

27 #ifdeà
_IO_MTSAFE_IO


28 
±h»ad_mu‹x_t
 
	t__libc_lock_t
;

29 ¡ruù { 
±h»ad_mu‹x_t
 
	mmu‹x
; } 
	t__libc_lock_»cursive_t
;

30 #ifdeà
__USE_UNIX98


31 
±h»ad_rwlock_t
 
	t__libc_rwlock_t
;

33 
__libc_rwlock_İaque__
 
	t__libc_rwlock_t
;

35 
__libc_lock_»cursive_t
 
	t__¹ld_lock_»cursive_t
;

37 
__libc_lock_İaque__
 
	t__libc_lock_t
;

38 
__libc_lock_»cursive_İaque__
 
	t__libc_lock_»cursive_t
;

39 
__libc_rwlock_İaque__
 
	t__libc_rwlock_t
;

43 
±h»ad_key_t
 
	t__libc_key_t
;

52 
	#__libc_lock_defše
(
CLASS
,
NAME
) \

53 
CLASS
 
__libc_lock_t
 
NAME
;

	)

54 
	#__libc_rwlock_defše
(
CLASS
,
NAME
) \

55 
CLASS
 
__libc_rwlock_t
 
NAME
;

	)

56 
	#__libc_lock_defše_»cursive
(
CLASS
,
NAME
) \

57 
CLASS
 
__libc_lock_»cursive_t
 
NAME
;

	)

58 
	#__¹ld_lock_defše_»cursive
(
CLASS
,
NAME
) \

59 
CLASS
 
__¹ld_lock_»cursive_t
 
NAME
;

	)

70 #ià
__LT_SPINLOCK_INIT
 == 0

71 
	#__libc_lock_defše_š™Ÿlized
(
CLASS
,
NAME
) \

72 
CLASS
 
__libc_lock_t
 
NAME
;

	)

74 
	#__libc_lock_defše_š™Ÿlized
(
CLASS
,
NAME
) \

75 
CLASS
 
__libc_lock_t
 
NAME
 = 
PTHREAD_MUTEX_INITIALIZER
;

	)

78 
	#__libc_rwlock_defše_š™Ÿlized
(
CLASS
,
NAME
) \

79 
CLASS
 
__libc_rwlock_t
 
NAME
 = 
PTHREAD_RWLOCK_INITIALIZER
;

	)

83 
	#__libc_lock_defše_š™Ÿlized_»cursive
(
CLASS
,
NAME
) \

84 
CLASS
 
__libc_lock_»cursive_t
 
NAME
 = 
_LIBC_LOCK_RECURSIVE_INITIALIZER
;

	)

85 
	#_LIBC_LOCK_RECURSIVE_INITIALIZER
 \

86 {
PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
}

	)

88 
	#__¹ld_lock_defše_š™Ÿlized_»cursive
(
CLASS
,
NAME
) \

89 
CLASS
 
__¹ld_lock_»cursive_t
 
NAME
 = 
_RTLD_LOCK_RECURSIVE_INITIALIZER
;

	)

90 
	#_RTLD_LOCK_RECURSIVE_INITIALIZER
 \

91 {
PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
}

	)

93 #ià
defšed
 
__PIC__


94 
	#__libc_maybe_ÿÎ
(
FUNC
, 
ARGS
, 
ELSE
) \

95 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of
 (
FUNC
è*
_â
 = (FUNC); \

96 
_â
 !ğ
NULL
 ? (*_âè
ARGS
 : 
ELSE
; }))

	)

98 
	#__libc_maybe_ÿÎ
(
FUNC
, 
ARGS
, 
ELSE
) \

99 (
FUNC
 !ğ
NULL
 ? FUNC 
ARGS
 : 
ELSE
)

	)

101 
	#__libc_maybe_ÿÎ2
(
FUNC
, 
ARGS
, 
ELSE
è
	`__libc_maybe_ÿÎ
 (
__
##FUNC, ARGS, ELSE)

	)

105 
	#__libc_lock_š™
(
NAME
) \

106 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_š™
, (&(
NAME
), 
NULL
), 0))

	)

107 
	#__libc_rwlock_š™
(
NAME
) \

108 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_š™
, (&(
NAME
), 
NULL
), 0));

	)

111 
	#__libc_lock_š™_»cursive
(
NAME
) \

113 ià(
__±h»ad_mu‹x_š™
 !ğ
NULL
) \

115 
±h»ad_mu‹x©Œ_t
 
__©Œ
; \

116 
	`__±h»ad_mu‹x©Œ_š™
 (&
__©Œ
); \

117 
	`__±h»ad_mu‹x©Œ_£‰y³
 (&
__©Œ
, 
PTHREAD_MUTEX_RECURSIVE_NP
); \

118 
	`__±h»ad_mu‹x_š™
 (&(
NAME
).
mu‹x
, &
__©Œ
); \

119 
	`__±h»ad_mu‹x©Œ_de¡roy
 (&
__©Œ
); \

121 } 0);

	)

122 
	#__¹ld_lock_š™_»cursive
(
NAME
) \

123 
	`__libc_lock_š™_»cursive
 (
NAME
)

	)

128 
	#__libc_lock_fši
(
NAME
) \

129 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_de¡roy
, (&(
NAME
)), 0));

	)

130 
	#__libc_rwlock_fši
(
NAME
) \

131 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_de¡roy
, (&(
NAME
)), 0));

	)

134 
	#__libc_lock_fši_»cursive
(
NAME
è
	`__libc_lock_fši
 ((NAME).
mu‹x
)

	)

135 
	#__¹ld_lock_fši_»cursive
(
NAME
è
	`__libc_lock_fši_»cursive
 (NAME)

	)

138 
	#__libc_lock_lock
(
NAME
) \

139 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_lock
, (&(
NAME
)), 0));

	)

140 
	#__libc_rwlock_rdlock
(
NAME
) \

141 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_rdlock
, (&(
NAME
)), 0));

	)

142 
	#__libc_rwlock_w¾ock
(
NAME
) \

143 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_w¾ock
, (&(
NAME
)), 0));

	)

146 
	#__libc_lock_lock_»cursive
(
NAME
è
	`__libc_lock_lock
 ((NAME).
mu‹x
)

	)

149 
	#__libc_lock_Œylock
(
NAME
) \

150 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_Œylock
, (&(
NAME
)), 0))

	)

151 
	#__libc_rwlock_Œyrdlock
(
NAME
) \

152 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_Œyrdlock
, (&(
NAME
)), 0))

	)

153 
	#__libc_rwlock_Œyw¾ock
(
NAME
) \

154 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_Œyw¾ock
, (&(
NAME
)), 0))

	)

157 
	#__libc_lock_Œylock_»cursive
(
NAME
è
	`__libc_lock_Œylock
 ((NAME).
mu‹x
)

	)

158 
	#__¹ld_lock_Œylock_»cursive
(
NAME
) \

159 
	`__libc_lock_Œylock_»cursive
 (
NAME
)

	)

162 
	#__libc_lock_uÆock
(
NAME
) \

163 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_uÆock
, (&(
NAME
)), 0));

	)

164 
	#__libc_rwlock_uÆock
(
NAME
) \

165 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_uÆock
, (&(
NAME
)), 0));

	)

168 
	#__libc_lock_uÆock_»cursive
(
NAME
è
	`__libc_lock_uÆock
 ((NAME).
mu‹x
)

	)

170 
	#__¹ld_lock_lock_»cursive
(
NAME
è
	`__libc_lock_lock_»cursive
 (NAME)

	)

171 
	#__¹ld_lock_uÆock_»cursive
(
NAME
è
	`__libc_lock_uÆock_»cursive
 (NAME)

	)

174 #ià
PTHREAD_ONCE_INIT
 == 0

177 
	#__libc_Úû_defše
(
CLASS
, 
NAME
) \

178 
CLASS
 
±h»ad_Úû_t
 
NAME


	)

180 
	#__libc_Úû_defše
(
CLASS
, 
NAME
) \

181 
CLASS
 
±h»ad_Úû_t
 
NAME
 = 
PTHREAD_ONCE_INIT


	)

185 
	#__libc_Úû
(
ONCE_CONTROL
, 
INIT_FUNCTION
) \

187 ià(
__±h»ad_Úû
 !ğ
NULL
) \

188 
	`__±h»ad_Úû
 (&(
ONCE_CONTROL
), (
INIT_FUNCTION
)); \

189 ià((
ONCE_CONTROL
è=ğ
PTHREAD_ONCE_INIT
) { \

190 
	`INIT_FUNCTION
 (); \

191 (
ONCE_CONTROL
) = 2; \

193 } 0)

	)

197 
	#__libc_ş—nup_»giÚ_¡¬t
(
DOIT
, 
FCT
, 
ARG
) \

198 { 
_±h»ad_ş—nup_bufãr
 
_bufãr
; \

199 
_ava
 = (
DOIT
è&& 
_±h»ad_ş—nup_push_deãr
 !ğ
NULL
; \

200 ià(
_ava
) { \

201 
	`_±h»ad_ş—nup_push_deãr
 (&
_bufãr
, (
FCT
), (
ARG
)); \

202 }

	)

205 
	#__libc_ş—nup_»giÚ_’d
(
DOIT
) \

206 ià(
_ava
) { \

207 
	`_±h»ad_ş—nup_pİ_»¡Üe
 (&
_bufãr
, (
DOIT
)); \

209 }

	)

212 
	#__libc_ş—nup_’d
(
DOIT
) \

213 ià(
_ava
) { \

214 
	`_±h»ad_ş—nup_pİ_»¡Üe
 (&
_bufãr
, (
DOIT
)); \

215 }

	)

217 
	#__libc_ş—nup_push
(
fù
, 
¬g
) \

218 { 
_±h»ad_ş—nup_bufãr
 
_bufãr
; \

219 
	`__libc_maybe_ÿÎ
 (
_±h»ad_ş—nup_push
, (&
_bufãr
, (
fù
), (
¬g
)), 0)

	)

221 
	#__libc_ş—nup_pİ
(
execu‹
) \

222 
	`__libc_maybe_ÿÎ
 (
_±h»ad_ş—nup_pİ
, (&
_bufãr
, 
execu‹
), 0); \

223 }

	)

226 
	#__libc_key_ü—‹
(
KEY
, 
DESTRUCTOR
) \

227 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_key_ü—‹
, (
KEY
, 
DESTRUCTOR
), 1))

	)

230 
	#__libc_g‘¥ecific
(
KEY
) \

231 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_g‘¥ecific
, (
KEY
), 
NULL
))

	)

234 
	#__libc_£t¥ecific
(
KEY
, 
VALUE
) \

235 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_£t¥ecific
, (
KEY
, 
VALUE
), 0))

	)

239 
	#__libc_©fÜk
(
PREPARE
, 
PARENT
, 
CHILD
) \

240 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_©fÜk
, (
PREPARE
, 
PARENT
, 
CHILD
), 0))

	)

242 
__BEGIN_DECLS


244 
_±h»ad_ş—nup_push_deãr
 (
_±h»ad_ş—nup_bufãr
 *
__bufãr
,

245 (*
__routše
) (*),

246 *
__¬g
è
__THROW
;

248 
	$_±h»ad_ş—nup_pİ_»¡Üe
 (
_±h»ad_ş—nup_bufãr
 *
__bufãr
,

249 
__execu‹
è
__THROW
;

255 
	`__±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

256 
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__mu‹x_©Œ
);

258 
	`__±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

260 
	`__±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

262 
	`__±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

264 
	`__±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

266 
	`__±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
);

268 
	`__±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
);

270 
	`__±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

271 
__kšd
);

273 #ifdeà
__USE_UNIX98


274 
	`__±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__rwlock
,

275 
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *
__©Œ
);

277 
	`__±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
);

279 
	`__±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
);

281 
	`__±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
);

283 
	`__±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
);

285 
	`__±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
);

287 
	`__±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
);

290 
	`__±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

291 (*
__de¡r_funùiÚ
) (*));

293 
	`__±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

294 
__cÚ¡
 *
__poš‹r
);

296 *
	`__±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
);

298 
	`__±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

299 (*
__š™_routše
) ());

301 
	`__±h»ad_©fÜk
 ((*
__´•¬e
) (),

302 (*
__·»Á
) (),

303 (*
__chd
) ());

305 
__END_DECLS


309 #iâdeà
__NO_WEAK_PTHREAD_ALIASES


310 #´agm¨
w—k
 
__±h»ad_mu‹x_š™


311 #´agm¨
w—k
 
__±h»ad_mu‹x_de¡roy


312 #´agm¨
w—k
 
__±h»ad_mu‹x_lock


313 #´agm¨
w—k
 
__±h»ad_mu‹x_Œylock


314 #´agm¨
w—k
 
__±h»ad_mu‹x_uÆock


315 #´agm¨
w—k
 
__±h»ad_mu‹x©Œ_š™


316 #´agm¨
w—k
 
__±h»ad_mu‹x©Œ_de¡roy


317 #´agm¨
w—k
 
__±h»ad_mu‹x©Œ_£‰y³


318 #´agm¨
w—k
 
__±h»ad_rwlock_de¡roy


319 #´agm¨
w—k
 
__±h»ad_rwlock_rdlock


320 #´agm¨
w—k
 
__±h»ad_rwlock_Œyrdlock


321 #´agm¨
w—k
 
__±h»ad_rwlock_w¾ock


322 #´agm¨
w—k
 
__±h»ad_rwlock_Œyw¾ock


323 #´agm¨
w—k
 
__±h»ad_rwlock_uÆock


324 #´agm¨
w—k
 
__±h»ad_key_ü—‹


325 #´agm¨
w—k
 
__±h»ad_£t¥ecific


326 #´agm¨
w—k
 
__±h»ad_g‘¥ecific


327 #´agm¨
w—k
 
__±h»ad_Úû


328 #´agm¨
w—k
 
__±h»ad_š™Ÿlize


329 #´agm¨
w—k
 
__±h»ad_©fÜk


330 #´agm¨
w—k
 
_±h»ad_ş—nup_push_deãr


331 #´agm¨
w—k
 
_±h»ad_ş—nup_pİ_»¡Üe


332 #´agm¨
w—k
 
_±h»ad_ş—nup_push


333 #´agm¨
w—k
 
_±h»ad_ş—nup_pİ


338 
	#__libc_mu‹x_uÆock
 
__±h»ad_mu‹x_uÆock


	)

	@/usr/include/gconv.h

23 #iâdeà
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	#__Ãed_mb¡©e_t


	)

28 
	#__Ãed_wšt_t


	)

29 
	~<wch¬.h
>

30 
	#__Ãed_size_t


	)

31 
	#__Ãed_wch¬_t


	)

32 
	~<¡ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

72 
	t__cÚ¡
 **, __const *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

86 
	t__cÚ¡
 *,

87 
	t__cÚ¡
 **,

88 
	t__cÚ¡
 *, **,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
è(*, 
	t__cÚ¡
 *,

93 
	t__cÚ¡
 *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
è(
	t__cÚ¡
 *, __const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 
__cÚ¡
 *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/gnu/stubs-32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___k”Ãl_co¦


	)

11 
	#__¡ub___k”Ãl_sšl


	)

12 
	#__¡ub___k”Ãl_Æ


	)

13 
	#__¡ub_chæags


	)

14 
	#__¡ub_ç‰ach


	)

15 
	#__¡ub_fchæags


	)

16 
	#__¡ub_fd‘ach


	)

17 
	#__¡ub_g‰y


	)

18 
	#__¡ub_lchmod


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/linux/stddef.h

1 #iâdeà
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

6 #undeà
NULL


7 #ià
defšed
(
__ılu¥lus
)

8 
	#NULL
 0

	)

10 
	#NULL
 ((*)0)

	)

	@/usr/include/wchar.h

24 #iâdeà
_WCHAR_H


26 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<ã©u»s.h
>

31 #ifdeà
_WCHAR_H


33 
	#__Ãed___FILE


	)

34 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


35 
	#__Ãed_FILE


	)

37 
	~<¡dio.h
>

39 
	#__Ãed___va_li¡


	)

40 
	~<¡d¬g.h
>

42 
	~<b™s/wch¬.h
>

45 
	#__Ãed_size_t


	)

46 
	#__Ãed_wch¬_t


	)

47 
	#__Ãed_NULL


	)

49 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


50 #undeà
__Ãed_wšt_t


51 
	#__Ãed_wšt_t


	)

52 
	~<¡ddef.h
>

56 #iâdeà
_WINT_T


61 
	#_WINT_T


	)

62 
	twšt_t
;

66 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
defšed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twšt_t
;

70 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
__mb¡©e_t_defšed


81 
	#__mb¡©e_t_defšed
 1

	)

85 
	m__couÁ
;

88 #ifdeà
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wšt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__v®ue
;

95 } 
	t__mb¡©e_t
;

97 #undeà
__Ãed_mb¡©e_t


102 #ifdeà
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 #ifdeà
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

112 #iâdeà
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #iâdeà
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


125 
	~<wùy³.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

147 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

155 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
)

161 
__THROW
 
__©Œibu‹_pu»__
;

163 
	$wc¢cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__©Œibu‹_pu»__
;

165 
__END_NAMESPACE_STD


167 #ifdeà
__USE_XOPEN2K8


169 
	$wcsÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

172 
	$wc¢ÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

173 
size_t
 
__n
è
__THROW
;

177 
	~<xloÿË.h
>

179 
	$wcsÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

180 
__loÿË_t
 
__loc
è
__THROW
;

182 
	$wc¢ÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

183 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscŞl
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

193 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

194 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

195 
__END_NAMESPACE_STD


197 #ifdeà
__USE_XOPEN2K8


203 
	$wcscŞl_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

204 
__loÿË_t
 
__loc
è
__THROW
;

209 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

210 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

213 
wch¬_t
 *
	$wcsdup
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

221 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
__©Œibu‹_pu»__
;

228 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

230 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

231 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

232 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
__©Œibu‹_pu»__
;

237 
__END_NAMESPACE_STD


239 #ifdeà
__USE_GNU


242 
wch¬_t
 *
	$wcschºul
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

243 
__THROW
 
__©Œibu‹_pu»__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcsc¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__»jeù
)

250 
__THROW
 
__©Œibu‹_pu»__
;

253 
size_t
 
	$wcs¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

254 
__THROW
 
__©Œibu‹_pu»__
;

256 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, 
__cÚ¡
 wch¬_ˆ*
__acû±
)

258 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

259 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
,

260 
__cÚ¡
 
wch¬_t
 *
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

263 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
__©Œibu‹_pu»__
;

267 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

269 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

270 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

271 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

274 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
__©Œibu‹_pu»__
;

279 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

280 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__d–im
,

281 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

284 
size_t
 
	$wc¦’
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

285 
__END_NAMESPACE_STD


287 #ifdeà
__USE_XOPEN


289 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

291 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

292 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

293 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

296 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
__©Œibu‹_pu»__
;

301 #ifdeà
__USE_XOPEN2K8


303 
size_t
 
	$wc¢Ën
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

304 
__THROW
 
__©Œibu‹_pu»__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

313 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

317 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
__©Œibu‹_pu»__
;

322 
	$wmemcmp
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s1
,

323 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

324 
__THROW
 
__©Œibu‹_pu»__
;

327 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

328 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

332 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
)

333 
__THROW
;

336 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

337 
__END_NAMESPACE_STD


339 #ifdeà
__USE_GNU


342 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

343 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

344 
__THROW
;

348 
__BEGIN_NAMESPACE_STD


351 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

355 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

359 
	$mbsš™
 (
__cÚ¡
 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

363 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

364 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

365 
mb¡©e_t
 *
__p
è
__THROW
;

368 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

369 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

372 
size_t
 
	$__mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

373 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
__END_NAMESPACE_STD


378 #ifdeà
__USE_EXTERN_INLINES


384 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

385 
__ex‹º_šlše
 
wšt_t


386 
	`__NTH
 (
	$btowc
 (
__c
))

387 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

388 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

390 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

391 
__ex‹º_šlše
 

392 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

393 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

394 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

396 
__ex‹º_šlše
 
size_t


397 
__NTH
 (
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

398 
mb¡©e_t
 *
__»¡riù
 
__ps
))

399 {  (
__ps
 !ğ
NULL


400 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

403 
__BEGIN_NAMESPACE_STD


406 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

407 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

408 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

412 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

413 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

414 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

415 
__END_NAMESPACE_STD


418 #ifdef 
__USE_XOPEN2K8


421 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

422 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

423 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

427 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

428 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

429 
size_t
 
__nwc
, size_ˆ
__Ën
,

430 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

435 #ifdeà
__USE_XOPEN


437 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

441 
	$wcswidth
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

445 
__BEGIN_NAMESPACE_STD


448 
	$wc¡od
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

449 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

450 
__END_NAMESPACE_STD


452 #ifdeà
__USE_ISOC99


453 
__BEGIN_NAMESPACE_C99


455 
	$wc¡of
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

456 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

457 
	$wc¡Şd
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
__END_NAMESPACE_C99


463 
__BEGIN_NAMESPACE_STD


466 
	$wc¡Ş
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

467 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

471 
	$wc¡oul
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

472 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

473 
__THROW
;

474 
__END_NAMESPACE_STD


476 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GNUC__
 && defšed 
__USE_GNU
)

477 
__BEGIN_NAMESPACE_C99


480 
__ex‹nsiÚ__


481 
	$wc¡Şl
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

482 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

483 
__THROW
;

487 
__ex‹nsiÚ__


488 
	$wc¡ouÎ
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

489 
wch¬_t
 **
__»¡riù
 
__’d±r
,

490 
__ba£
è
__THROW
;

491 
__END_NAMESPACE_C99


494 #ià
defšed
 
__GNUC__
 && defšed 
__USE_GNU


497 
__ex‹nsiÚ__


498 
	$wc¡oq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

499 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

500 
__THROW
;

504 
__ex‹nsiÚ__


505 
	$wc¡ouq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

506 
wch¬_t
 **
__»¡riù
 
__’d±r
,

507 
__ba£
è
__THROW
;

510 #ifdeà
__USE_GNU


524 
	~<xloÿË.h
>

528 
	$wc¡Ş_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

529 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

530 
__loÿË_t
 
__loc
è
__THROW
;

532 
	$wc¡oul_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

533 
wch¬_t
 **
__»¡riù
 
__’d±r
,

534 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

536 
__ex‹nsiÚ__


537 
	$wc¡Şl_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

538 
wch¬_t
 **
__»¡riù
 
__’d±r
,

539 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

541 
__ex‹nsiÚ__


542 
	$wc¡ouÎ_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

543 
wch¬_t
 **
__»¡riù
 
__’d±r
,

544 
__ba£
, 
__loÿË_t
 
__loc
)

545 
__THROW
;

547 
	$wc¡od_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

548 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

549 
__THROW
;

551 
	$wc¡of_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

552 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

553 
__THROW
;

555 
	$wc¡Şd_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

556 
wch¬_t
 **
__»¡riù
 
__’d±r
,

557 
__loÿË_t
 
__loc
è
__THROW
;

562 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

563 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

567 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

568 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

569 
__THROW
;

575 #ifdef 
__USE_XOPEN2K8


578 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

581 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


582 
__BEGIN_NAMESPACE_STD


585 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

592 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

593 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

599 
	`w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

602 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

603 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
__THROW
 ;

610 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

611 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

612 
__gnuc_va_li¡
 
__¬g
)

618 
	`vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

619 
__gnuc_va_li¡
 
__¬g
)

623 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

624 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

625 
__gnuc_va_li¡
 
__¬g
)

626 
__THROW
 ;

633 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

634 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

640 
	`wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

643 
	$swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

644 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
__THROW
 ;

647 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

648 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

649 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

650 #ifdeà
__REDIRECT


654 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

655 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

656 
__isoc99_fwsÿnf
)

658 
	`__REDIRECT
 (
wsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

659 
__isoc99_wsÿnf
)

661 
	`__REDIRECT
 (
swsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

662 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

663 
__isoc99_swsÿnf
)

664 
__THROW
 ;

666 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

667 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

668 
	`__isoc99_wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

669 
	$__isoc99_swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

670 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

671 
__THROW
;

672 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

673 
	#wsÿnf
 
__isoc99_wsÿnf


	)

674 
	#swsÿnf
 
__isoc99_swsÿnf


	)

678 
__END_NAMESPACE_STD


681 #ifdeà
__USE_ISOC99


682 
__BEGIN_NAMESPACE_C99


687 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

688 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

689 
__gnuc_va_li¡
 
__¬g
)

695 
	`vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

696 
__gnuc_va_li¡
 
__¬g
)

699 
	$vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

700 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

701 
__gnuc_va_li¡
 
__¬g
)

702 
__THROW
 ;

704 #ià!
defšed
 
__USE_GNU
 \

705 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

706 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

707 #ifdeà
__REDIRECT


708 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

709 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

710 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

712 
	`__REDIRECT
 (
vwsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

713 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

715 
	`__REDIRECT
 (
vswsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

716 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

717 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

718 
__THROW
 ;

720 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

721 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

722 
__gnuc_va_li¡
 
__¬g
);

723 
	`__isoc99_vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	$__isoc99_vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

726 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

727 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

728 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

729 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

730 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

734 
__END_NAMESPACE_C99


738 
__BEGIN_NAMESPACE_STD


743 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

744 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

750 
wšt_t
 
	`g‘wch¬
 ();

757 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

758 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

764 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

772 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

773 
__FILE
 *
__»¡riù
 
__¡»am
);

779 
	`åutws
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

780 
__FILE
 *
__»¡riù
 
__¡»am
);

787 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

788 
__END_NAMESPACE_STD


791 #ifdeà
__USE_GNU


799 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

800 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

808 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

816 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

825 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

826 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

835 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

836 
__FILE
 *
__»¡riù
 
__¡»am
);

844 
	`åutws_uÆocked
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

845 
__FILE
 *
__»¡riù
 
__¡»am
);

849 
__BEGIN_NAMESPACE_C99


853 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

854 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

855 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

856 
__END_NAMESPACE_C99


858 #ifdeà
__USE_GNU


859 
	~<xloÿË.h
>

863 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

864 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

865 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

866 
__loÿË_t
 
__loc
è
__THROW
;

875 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


876 
	#__Ãed_iswxxx


	)

877 
	~<wùy³.h
>

881 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


882 
	~<b™s/wch¬2.h
>

885 #ifdeà
__LDBL_COMPAT


886 
	~<b™s/wch¬-ldbl.h
>

889 
__END_DECLS


897 #undeà
__Ãed_mb¡©e_t


898 #undeà
__Ãed_wšt_t


	@/usr/include/asm-generic/bitsperlong.h

1 #iâdeà
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #iâdeà
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@/usr/include/bits/wchar-ldbl.h

20 #iâdeà
_WCHAR_H


24 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


25 
__BEGIN_NAMESPACE_C99


26 
__LDBL_REDIR_DECL
 (
fw´štf
);

27 
__LDBL_REDIR_DECL
 (
w´štf
);

28 
__LDBL_REDIR_DECL
 (
sw´štf
);

29 
__LDBL_REDIR_DECL
 (
vfw´štf
);

30 
__LDBL_REDIR_DECL
 (
vw´štf
);

31 
__LDBL_REDIR_DECL
 (
vsw´štf
);

32 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

33 && !
defšed
 
	g__REDIRECT
 \

34 && (
defšed
 
	g__STRICT_ANSI__
 || defšed 
	g__USE_XOPEN2K
)

35 
	$__LDBL_REDIR1_DECL
 (
fwsÿnf
, 
__Ædbl___isoc99_fwsÿnf
)

36 
	$__LDBL_REDIR1_DECL
 (
wsÿnf
, 
__Ædbl___isoc99_wsÿnf
)

37 
	$__LDBL_REDIR1_DECL
 (
swsÿnf
, 
__Ædbl___isoc99_swsÿnf
)

39 
	`__LDBL_REDIR_DECL
 (
fwsÿnf
);

40 
	`__LDBL_REDIR_DECL
 (
wsÿnf
);

41 
	`__LDBL_REDIR_DECL
 (
swsÿnf
);

43 
__END_NAMESPACE_C99


46 #ifdeà
__USE_ISOC99


47 
__BEGIN_NAMESPACE_C99


48 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd
, 
wc¡od
);

49 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

50 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

51 
	$__LDBL_REDIR1_DECL
 (
vfwsÿnf
, 
__Ædbl___isoc99_vfwsÿnf
)

52 
	$__LDBL_REDIR1_DECL
 (
vwsÿnf
, 
__Ædbl___isoc99_vwsÿnf
)

53 
	$__LDBL_REDIR1_DECL
 (
vswsÿnf
, 
__Ædbl___isoc99_vswsÿnf
)

55 
	`__LDBL_REDIR_DECL
 (
vfwsÿnf
);

56 
	`__LDBL_REDIR_DECL
 (
vwsÿnf
);

57 
	`__LDBL_REDIR_DECL
 (
vswsÿnf
);

59 
__END_NAMESPACE_C99


62 #ifdeà
__USE_GNU


63 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd_l
, 
wc¡od_l
);

66 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


67 
	$__LDBL_REDIR_DECL
 (
__sw´štf_chk
)

68 
	$__LDBL_REDIR_DECL
 (
__vsw´štf_chk
)

69 #ià
__USE_FORTIFY_LEVEL
 > 1

70 
	$__LDBL_REDIR_DECL
 (
__fw´štf_chk
)

71 
	$__LDBL_REDIR_DECL
 (
__w´štf_chk
)

72 
	$__LDBL_REDIR_DECL
 (
__vfw´štf_chk
)

73 
	$__LDBL_REDIR_DECL
 (
__vw´štf_chk
)

	@/usr/include/bits/wchar2.h

20 #iâdeà
_WCHAR_H


25 
wch¬_t
 *
	$__wmemıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

26 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

27 
size_t
 
__ns1
è
__THROW
;

28 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_®Ÿs
,

29 (
wch¬_t
 *
__»¡riù
 
__s1
,

30 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
),

31 
wmemıy
);

32 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_chk_w¬n
,

33 (
wch¬_t
 *
__»¡riù
 
__s1
,

34 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

35 
size_t
 
__ns1
), 
__wmemıy_chk
)

36 
	`__w¬Ç‰r
 ("wmemcpy called with†ength biggerhan size of destination "

39 
__ex‹º_®ways_šlše
 
wch¬_t
 *

40 
	`__NTH
 (
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__s2
,

41 
size_t
 
__n
))

43 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

45 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

46  
	`__wmemıy_chk
 (
__s1
, 
__s2
, 
__n
,

47 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

49 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

50  
	`__wmemıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

51 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

53  
	`__wmemıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

54 
	}
}

57 
wch¬_t
 *
	$__wmemmove_chk
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

58 
size_t
 
__n
, size_ˆ
__ns1
è
__THROW
;

59 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_®Ÿs
, (wch¬_ˆ*
__s1
,

60 
__cÚ¡
 
wch¬_t
 *
__s2
,

61 
size_t
 
__n
), 
wmemmove
);

62 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_chk_w¬n
,

63 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

64 
size_t
 
__n
, size_ˆ
__ns1
), 
__wmemmove_chk
)

65 
	`__w¬Ç‰r
 ("wmemmove called with†ength biggerhan size of destination "

68 
__ex‹º_®ways_šlše
 
wch¬_t
 *

69 
	`__NTH
 (
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
))

71 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

73 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

74  
	`__wmemmove_chk
 (
__s1
, 
__s2
, 
__n
,

75 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

77 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

78  
	`__wmemmove_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

79 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

81  
	`__wmemmove_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

82 
	}
}

85 #ifdeà
__USE_GNU


86 
wch¬_t
 *
	$__wmempıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

87 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

88 
size_t
 
__ns1
è
__THROW
;

89 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_®Ÿs
,

90 (
wch¬_t
 *
__»¡riù
 
__s1
,

91 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
,

92 
size_t
 
__n
), 
wmempıy
);

93 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_chk_w¬n
,

94 (
wch¬_t
 *
__»¡riù
 
__s1
,

95 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

96 
size_t
 
__ns1
), 
__wmempıy_chk
)

97 
	`__w¬Ç‰r
 ("wmempcpy called with†ength biggerhan size of destination "

100 
__ex‹º_®ways_šlše
 
wch¬_t
 *

101 
	`__NTH
 (
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__s2
,

102 
size_t
 
__n
))

104 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

106 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

107  
	`__wmempıy_chk
 (
__s1
, 
__s2
, 
__n
,

108 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

110 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

111  
	`__wmempıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

112 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

114  
	`__wmempıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

115 
	}
}

119 
wch¬_t
 *
	$__wmem£t_chk
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

120 
size_t
 
__ns
è
__THROW
;

121 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_®Ÿs
, (wch¬_ˆ*
__s
, wch¬_ˆ
__c
,

122 
size_t
 
__n
), 
wmem£t
);

123 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_chk_w¬n
,

124 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

125 
size_t
 
__ns
), 
__wmem£t_chk
)

126 
	`__w¬Ç‰r
 ("wmemset called with†ength biggerhan size of destination "

129 
__ex‹º_®ways_šlše
 
wch¬_t
 *

130 
	`__NTH
 (
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
))

132 ià(
	`__bos0
 (
__s
è!ğ(
size_t
) -1)

134 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

135  
	`__wmem£t_chk
 (
__s
, 
__c
, 
__n
, 
	`__bos0
 (__sè/  (
wch¬_t
));

137 ià(
__n
 > 
	`__bos0
 (
__s
è/  (
wch¬_t
))

138  
	`__wmem£t_chk_w¬n
 (
__s
, 
__c
, 
__n
,

139 
	`__bos0
 (
__s
è/  (
wch¬_t
));

141  
	`__wmem£t_®Ÿs
 (
__s
, 
__c
, 
__n
);

142 
	}
}

145 
wch¬_t
 *
	$__wcsıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

146 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

147 
size_t
 
__n
è
__THROW
;

148 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsıy_®Ÿs
,

149 (
wch¬_t
 *
__»¡riù
 
__de¡
,

150 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsıy
);

152 
__ex‹º_®ways_šlše
 
wch¬_t
 *

153 
	`__NTH
 (
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
))

155 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

156  
	`__wcsıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

157  
	`__wcsıy_®Ÿs
 (
__de¡
, 
__¤c
);

158 
	}
}

161 
wch¬_t
 *
	$__wııy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

162 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

163 
size_t
 
__de¡Ën
è
__THROW
;

164 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wııy_®Ÿs
,

165 (
wch¬_t
 *
__»¡riù
 
__de¡
,

166 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wııy
);

168 
__ex‹º_®ways_šlše
 
wch¬_t
 *

169 
	`__NTH
 (
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
))

171 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

172  
	`__wııy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

173  
	`__wııy_®Ÿs
 (
__de¡
, 
__¤c
);

174 
	}
}

177 
wch¬_t
 *
	$__wc¢ıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

178 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

179 
size_t
 
__de¡Ën
è
__THROW
;

180 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_®Ÿs
,

181 (
wch¬_t
 *
__»¡riù
 
__de¡
,

182 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

183 
size_t
 
__n
), 
wc¢ıy
);

184 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_chk_w¬n
,

185 (
wch¬_t
 *
__»¡riù
 
__de¡
,

186 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

187 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wc¢ıy_chk
)

188 
	`__w¬Ç‰r
 ("wcsncpy called with†ength biggerhan size of destination "

191 
__ex‹º_®ways_šlše
 
wch¬_t
 *

192 
	`__NTH
 (
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
,

193 
size_t
 
__n
))

195 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

197 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

198  
	`__wc¢ıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

199 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

200 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

201  
	`__wc¢ıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

202 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

204  
	`__wc¢ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

205 
	}
}

208 
wch¬_t
 *
	$__wınıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

209 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

210 
size_t
 
__de¡Ën
è
__THROW
;

211 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_®Ÿs
,

212 (
wch¬_t
 *
__»¡riù
 
__de¡
,

213 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

214 
size_t
 
__n
), 
wınıy
);

215 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_chk_w¬n
,

216 (
wch¬_t
 *
__»¡riù
 
__de¡
,

217 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

218 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wınıy_chk
)

219 
	`__w¬Ç‰r
 ("wcpncpy called with†ength biggerhan size of destination "

222 
__ex‹º_®ways_šlše
 
wch¬_t
 *

223 
	`__NTH
 (
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
,

224 
size_t
 
__n
))

226 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

228 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

229  
	`__wınıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

230 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

231 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

232  
	`__wınıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

233 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

235  
	`__wınıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

236 
	}
}

239 
wch¬_t
 *
	$__wcsÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

240 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

241 
size_t
 
__de¡Ën
è
__THROW
;

242 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsÿt_®Ÿs
,

243 (
wch¬_t
 *
__»¡riù
 
__de¡
,

244 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsÿt
);

246 
__ex‹º_®ways_šlše
 
wch¬_t
 *

247 
	`__NTH
 (
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
))

249 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

250  
	`__wcsÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

251  
	`__wcsÿt_®Ÿs
 (
__de¡
, 
__¤c
);

252 
	}
}

255 
wch¬_t
 *
	$__wc¢ÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

256 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

257 
size_t
 
__n
, size_ˆ
__de¡Ën
è
__THROW
;

258 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ÿt_®Ÿs
,

259 (
wch¬_t
 *
__»¡riù
 
__de¡
,

260 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

261 
size_t
 
__n
), 
wc¢ÿt
);

263 
__ex‹º_®ways_šlše
 
wch¬_t
 *

264 
	`__NTH
 (
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
,

265 
size_t
 
__n
))

267 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

268  
	`__wc¢ÿt_chk
 (
__de¡
, 
__¤c
, 
__n
,

269 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

270  
	`__wc¢ÿt_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

271 
	}
}

274 
	$__sw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

275 
__æag
, 
size_t
 
__s_Ën
,

276 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

277 
__THROW
 ;

279 
	`__REDIRECT_NTH_LDBL
 (
__sw´štf_®Ÿs
,

280 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

281 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, ...),

282 
sw´štf
);

284 #ifdeà
__va_¬g_·ck


285 
__ex‹º_®ways_šlše
 

286 
	`__NTH
 (
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

287 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, ...))

289 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

290  
	`__sw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

291 
	`__bos
 (
__s
è/  (
wch¬_t
),

292 
__fmt
, 
	`__va_¬g_·ck
 ());

293  
	`__sw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
	`__va_¬g_·ck
 ());

294 
	}
}

295 #–ià!
defšed
 
__ılu¥lus


297 
	#sw´štf
(
s
, 
n
, ...) \

298 (
	`__bos
 (
s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1 \

299 ? 
	`__sw´štf_chk
 (
s
, 
n
, 
__USE_FORTIFY_LEVEL
 - 1, \

300 
	`__bos
 (
s
è/  (
wch¬_t
), 
__VA_ARGS__
) \

301 : 
	`sw´štf
 (
s
, 
n
, 
__VA_ARGS__
))

	)

304 
	$__vsw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

305 
__æag
, 
size_t
 
__s_Ën
,

306 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

307 
__gnuc_va_li¡
 
__¬g
)

308 
__THROW
 ;

310 
	`__REDIRECT_NTH_LDBL
 (
__vsw´štf_®Ÿs
,

311 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

312 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
,

313 
__gnuc_va_li¡
 
__­
), 
vsw´štf
);

315 
__ex‹º_®ways_šlše
 

316 
	`__NTH
 (
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

317 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
))

319 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

320  
	`__vsw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

321 
	`__bos
 (
__s
è/  (
wch¬_t
), 
__fmt
, 
__­
);

322  
	`__vsw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
__­
);

323 
	}
}

326 #ià
__USE_FORTIFY_LEVEL
 > 1

328 
__fw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

329 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

330 
__w´štf_chk
 (
__æag
, 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

332 
__vfw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

333 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

334 
__gnuc_va_li¡
 
__­
);

335 
__vw´štf_chk
 (
__æag
, 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

336 
__gnuc_va_li¡
 
__­
);

338 #ifdeà
__va_¬g_·ck


339 
__ex‹º_®ways_šlše
 

340 
	$w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, ...)

342  
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

343 
	}
}

345 
__ex‹º_®ways_šlše
 

346 
	$fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__cÚ¡
 
wch¬_t
 *__»¡riù 
__fmt
, ...)

348  
	`__fw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

349 
	`__va_¬g_·ck
 ());

350 
	}
}

351 #–ià!
defšed
 
__ılu¥lus


352 
	#w´štf
(...) \

353 
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

354 
	#fw´štf
(
¡»am
, ...) \

355 
	`__fw´štf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

358 
__ex‹º_®ways_šlše
 

359 
	$vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

361  
	`__vw´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

362 
	}
}

364 
__ex‹º_®ways_šlše
 

365 
	$vfw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

366 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

368  
	`__vfw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

369 
	}
}

373 
wch¬_t
 *
	$__fg‘ws_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

374 
__FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

375 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_®Ÿs
,

376 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

377 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws
è
__wur
;

378 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_chk_w¬n
,

379 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

380 
__FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘ws_chk
)

381 
__wur
 
	`__w¬Ç‰r
 ("fgetws called with bigger sizehan†ength "

384 
__ex‹º_®ways_šlše
 
__wur
 
wch¬_t
 *

385 
	$fg‘ws
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

387 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

389 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

390  
	`__fg‘ws_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

391 
__n
, 
__¡»am
);

393 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

394  
	`__fg‘ws_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

395 
__n
, 
__¡»am
);

397  
	`__fg‘ws_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

398 
	}
}

400 #ifdeà
__USE_GNU


401 
wch¬_t
 *
	$__fg‘ws_uÆocked_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
,

402 
__n
, 
__FILE
 *
__»¡riù
 
__¡»am
)

403 
__wur
;

404 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_®Ÿs
,

405 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

406 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws_uÆocked
)

407 
__wur
;

408 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_chk_w¬n
,

409 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

410 
__FILE
 *
__»¡riù
 
__¡»am
),

411 
__fg‘ws_uÆocked_chk
)

412 
__wur
 
	`__w¬Ç‰r
 ("fgetws_unlocked called with bigger sizehan†ength "

415 
__ex‹º_®ways_šlše
 
__wur
 
wch¬_t
 *

416 
	$fg‘ws_uÆocked
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

418 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

420 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

421  
	`__fg‘ws_uÆocked_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

422 
__n
, 
__¡»am
);

424 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

425  
	`__fg‘ws_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

426 
__n
, 
__¡»am
);

428  
	`__fg‘ws_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

429 
	}
}

433 
size_t
 
	$__wütomb_chk
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

434 
mb¡©e_t
 *
__»¡riù
 
__p
,

435 
size_t
 
__buæ’
è
__THROW
 
__wur
;

436 
size_t
 
	`__REDIRECT_NTH
 (
__wütomb_®Ÿs
,

437 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

438 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wütomb
è
__wur
;

440 
__ex‹º_®ways_šlše
 
__wur
 
size_t


441 
	`__NTH
 (
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

442 
mb¡©e_t
 *
__»¡riù
 
__ps
))

447 
	#__WCHAR_MB_LEN_MAX
 16

	)

448 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__WCHAR_MB_LEN_MAX


451 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__WCHAR_MB_LEN_MAX
 > __bos (__s))

452  
	`__wütomb_chk
 (
__s
, 
__wch¬
, 
__ps
, 
	`__bos
 (__s));

453  
	`__wütomb_®Ÿs
 (
__s
, 
__wch¬
, 
__ps
);

454 
	}
}

457 
size_t
 
	$__mb¤towcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

458 
__cÚ¡
 **
__»¡riù
 
__¤c
,

459 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

460 
size_t
 
__d¡Ën
è
__THROW
;

461 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_®Ÿs
,

462 (
wch¬_t
 *
__»¡riù
 
__d¡
,

463 
__cÚ¡
 **
__»¡riù
 
__¤c
,

464 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

465 
mb¤towcs
);

466 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_chk_w¬n
,

467 (
wch¬_t
 *
__»¡riù
 
__d¡
,

468 
__cÚ¡
 **
__»¡riù
 
__¤c
,

469 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

470 
size_t
 
__d¡Ën
), 
__mb¤towcs_chk
)

471 
	`__w¬Ç‰r
 ("mbsrtowcs called with dst buffer smallerhan†en "

474 
__ex‹º_®ways_šlše
 
size_t


475 
	`__NTH
 (
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, 
__cÚ¡
 **__»¡riù 
__¤c
,

476 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

478 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

480 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

481  
	`__mb¤towcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

482 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

484 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

485  
	`__mb¤towcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

486 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

488  
	`__mb¤towcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

489 
	}
}

492 
size_t
 
	$__wc¤tombs_chk
 (*
__»¡riù
 
__d¡
,

493 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

494 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

495 
size_t
 
__d¡Ën
è
__THROW
;

496 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_®Ÿs
,

497 (*
__»¡riù
 
__d¡
,

498 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

499 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

500 
wc¤tombs
);

501 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_chk_w¬n
,

502 (*
__»¡riù
 
__d¡
,

503 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

504 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

505 
size_t
 
__d¡Ën
), 
__wc¤tombs_chk
)

506 
	`__w¬Ç‰r
 ("wcsrtombs called with dst buffer smallerhan†en");

508 
__ex‹º_®ways_šlše
 
size_t


509 
	`__NTH
 (
	$wc¤tombs
 (*
__»¡riù
 
__d¡
, 
__cÚ¡
 
wch¬_t
 **__»¡riù 
__¤c
,

510 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

512 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

514 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

515  
	`__wc¤tombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

517 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

518  
	`__wc¤tombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

520  
	`__wc¤tombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

521 
	}
}

524 #ifdeà
__USE_GNU


525 
size_t
 
	$__mb¢¹owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

526 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

527 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

528 
size_t
 
__d¡Ën
è
__THROW
;

529 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_®Ÿs
,

530 (
wch¬_t
 *
__»¡riù
 
__d¡
,

531 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

532 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

533 
mb¢¹owcs
);

534 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_chk_w¬n
,

535 (
wch¬_t
 *
__»¡riù
 
__d¡
,

536 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

537 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

538 
size_t
 
__d¡Ën
), 
__mb¢¹owcs_chk
)

539 
	`__w¬Ç‰r
 ("mbsnrtowcs called with dst buffer smallerhan†en "

542 
__ex‹º_®ways_šlše
 
size_t


543 
	`__NTH
 (
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, 
__cÚ¡
 **__»¡riù 
__¤c
,

544 
size_t
 
__nmc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

546 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

548 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

549  
	`__mb¢¹owcs_chk
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

550 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

552 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

553  
	`__mb¢¹owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

554 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

556  
	`__mb¢¹owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
);

557 
	}
}

560 
size_t
 
	$__wc¢¹ombs_chk
 (*
__»¡riù
 
__d¡
,

561 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

562 
size_t
 
__nwc
, size_ˆ
__Ën
,

563 
mb¡©e_t
 *
__»¡riù
 
__ps
, 
size_t
 
__d¡Ën
)

564 
__THROW
;

565 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_®Ÿs
,

566 (*
__»¡riù
 
__d¡
,

567 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

568 
size_t
 
__nwc
, size_ˆ
__Ën
,

569 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wc¢¹ombs
);

570 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_chk_w¬n
,

571 (*
__»¡riù
 
__d¡
,

572 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

573 
size_t
 
__nwc
, size_ˆ
__Ën
,

574 
mb¡©e_t
 *
__»¡riù
 
__ps
,

575 
size_t
 
__d¡Ën
), 
__wc¢¹ombs_chk
)

576 
	`__w¬Ç‰r
 ("wcsnrtombs called with dst buffer smallerhan†en");

578 
__ex‹º_®ways_šlše
 
size_t


579 
	`__NTH
 (
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
, 
__cÚ¡
 
wch¬_t
 **__»¡riù 
__¤c
,

580 
size_t
 
__nwc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

582 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

584 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

585  
	`__wc¢¹ombs_chk
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

586 
	`__bos
 (
__d¡
));

588 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

589  
	`__wc¢¹ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

590 
	`__bos
 (
__d¡
));

592  
	`__wc¢¹ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
);

593 
	}
}

	@/usr/include/pthread.h

20 #iâdeà
_PTHREAD_H


21 
	#_PTHREAD_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<’dŸn.h
>

25 
	~<sched.h
>

26 
	~<time.h
>

28 
	~<b™s/±h»adty³s.h
>

29 
	~<b™s/£tjmp.h
>

30 
	~<b™s/wÜdsize.h
>

36 
	mPTHREAD_CREATE_JOINABLE
,

37 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

38 
	mPTHREAD_CREATE_DETACHED


39 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

46 
	mPTHREAD_MUTEX_TIMED_NP
,

47 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

48 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

49 
	mPTHREAD_MUTEX_ADAPTIVE_NP


50 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


52 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

53 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

54 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

55 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


57 #ifdeà
__USE_GNU


59 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


64 #ifdeà
__USE_XOPEN2K


68 
	mPTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

70 
	mPTHREAD_MUTEX_ROBUST
,

71 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


76 #ifdeà
__USE_UNIX98


80 
	mPTHREAD_PRIO_NONE
,

81 
	mPTHREAD_PRIO_INHERIT
,

82 
	mPTHREAD_PRIO_PROTECT


88 #ià
__WORDSIZE
 == 64

89 
	#PTHREAD_MUTEX_INITIALIZER
 \

90 { { 0, 0, 0, 0, 0, 0, { 0, 0 } } }

	)

91 #ifdeà
__USE_GNU


92 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0, 0 } } }

	)

94 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0, 0 } } }

	)

96 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

97 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0, 0 } } }

	)

100 
	#PTHREAD_MUTEX_INITIALIZER
 \

101 { { 0, 0, 0, 0, 0, { 0 } } }

	)

102 #ifdeà
__USE_GNU


103 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0 } } }

	)

105 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0 } } }

	)

107 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

108 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0 } } }

	)

114 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


124 
	#PTHREAD_RWLOCK_INITIALIZER
 \

125 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

126 #ifdeà
__USE_GNU


127 #ià
__WORDSIZE
 == 64

128 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

130 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

132 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


133 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

134 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

135 0, 0, 0, 0 } }

	)

137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

139 0 } }

	)

149 
	mPTHREAD_INHERIT_SCHED
,

150 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

151 
	mPTHREAD_EXPLICIT_SCHED


152 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

159 
	mPTHREAD_SCOPE_SYSTEM
,

160 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

161 
	mPTHREAD_SCOPE_PROCESS


162 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

169 
	mPTHREAD_PROCESS_PRIVATE
,

170 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

171 
	mPTHREAD_PROCESS_SHARED


172 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

178 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

182 
	s_±h»ad_ş—nup_bufãr


184 (*
	m__routše
) (*);

185 *
	m__¬g
;

186 
	m__ÿnûÉy³
;

187 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

193 
	mPTHREAD_CANCEL_ENABLE
,

194 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

195 
	mPTHREAD_CANCEL_DISABLE


196 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

200 
	mPTHREAD_CANCEL_DEFERRED
,

201 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

202 
	mPTHREAD_CANCEL_ASYNCHRONOUS


203 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

205 
	#PTHREAD_CANCELED
 ((*è-1)

	)

209 
	#PTHREAD_ONCE_INIT
 0

	)

212 #ifdeà
__USE_XOPEN2K


216 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

220 
__BEGIN_DECLS


225 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

226 
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

227 *(*
__¡¬t_routše
) (*),

228 *
__»¡riù
 
__¬g
è
__THROW
 
__nÚnuÎ
 ((1, 3));

234 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

242 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

244 #ifdeà
__USE_GNU


247 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

255 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

256 
__cÚ¡
 
time¥ec
 *
__ab¡ime
);

263 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

267 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

270 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
è
__THROW
;

278 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

281 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

282 
__THROW
 
	`__nÚnuÎ
 ((1));

285 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

286 *
__d‘ach¡©e
)

287 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

290 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

291 
__d‘ach¡©e
)

292 
__THROW
 
	`__nÚnuÎ
 ((1));

296 
	$±h»ad_©Œ_g‘gu¬dsize
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

297 
size_t
 *
__gu¬dsize
)

298 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

301 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

302 
size_t
 
__gu¬dsize
)

303 
__THROW
 
	`__nÚnuÎ
 ((1));

307 
	$±h»ad_©Œ_g‘sched·¿m
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


308 
__©Œ
,

309 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

310 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

313 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

314 
__cÚ¡
 
sched_·¿m
 *
__»¡riù


315 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

318 
	$±h»ad_©Œ_g‘schedpŞicy
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


319 
__©Œ
, *
__»¡riù
 
__pŞicy
)

320 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

323 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

324 
__THROW
 
	`__nÚnuÎ
 ((1));

327 
	$±h»ad_©Œ_g‘šh”™sched
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


328 
__©Œ
, *
__»¡riù
 
__šh”™
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

333 
__šh”™
)

334 
__THROW
 
	`__nÚnuÎ
 ((1));

338 
	$±h»ad_©Œ_g‘scİe
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

339 *
__»¡riù
 
__scİe
)

340 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

343 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

344 
__THROW
 
	`__nÚnuÎ
 ((1));

347 
	$±h»ad_©Œ_g‘¡ackaddr
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


348 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

349 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

355 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

356 *
__¡ackaddr
)

357 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

360 
	$±h»ad_©Œ_g‘¡acksize
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


361 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

362 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

367 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

368 
size_t
 
__¡acksize
)

369 
__THROW
 
	`__nÚnuÎ
 ((1));

371 #ifdeà
__USE_XOPEN2K


373 
	$±h»ad_©Œ_g‘¡ack
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

374 **
__»¡riù
 
__¡ackaddr
,

375 
size_t
 *
__»¡riù
 
__¡acksize
)

376 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

381 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

382 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

385 #ifdeà
__USE_GNU


388 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

389 
size_t
 
__ıu£tsize
,

390 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
)

391 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

395 
	$±h»ad_©Œ_g‘affš™y_Å
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

396 
size_t
 
__ıu£tsize
,

397 
ıu_£t_t
 *
__ıu£t
)

398 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

404 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

405 
__THROW
 
	`__nÚnuÎ
 ((2));

413 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

414 
__cÚ¡
 
sched_·¿m
 *
__·¿m
)

415 
__THROW
 
	`__nÚnuÎ
 ((3));

418 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

419 *
__»¡riù
 
__pŞicy
,

420 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

421 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

424 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

425 
__THROW
;

428 #ifdeà
__USE_GNU


430 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

431 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

435 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, 
__cÚ¡
 *
__Çme
)

436 
__THROW
 
	`__nÚnuÎ
 ((2));

440 #ifdeà
__USE_UNIX98


442 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

445 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

448 #ifdeà
__USE_GNU


453 
	$±h»ad_y›ld
 (è
__THROW
;

458 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

459 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
)

460 
__THROW
 
	`__nÚnuÎ
 ((3));

463 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

464 
ıu_£t_t
 *
__ıu£t
)

465 
__THROW
 
	`__nÚnuÎ
 ((3));

478 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

479 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

490 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

494 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

497 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

502 
	`±h»ad_‹¡ÿnûl
 ();

511 
__jmp_buf
 
__ÿnûl_jmp_buf
;

512 
__mask_was_§ved
;

513 } 
__ÿnûl_jmp_buf
[1];

514 *
__·d
[4];

515 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

518 #iâdeà
__ş—nup_fù_©Œibu‹


519 
	#__ş—nup_fù_©Œibu‹


	)

524 
	s__±h»ad_ş—nup_äame


526 (*
__ÿnûl_routše
) (*);

527 *
__ÿnûl_¬g
;

528 
__do_™
;

529 
__ÿnûl_ty³
;

532 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


533 #ifdeà
__ılu¥lus


535 şas 
	c__±h»ad_ş—nup_şass


537 (*
__ÿnûl_routše
) (*);

538 *
__ÿnûl_¬g
;

539 
__do_™
;

540 
__ÿnûl_ty³
;

542 
public
:

543 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

544 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

545 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

546 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

547 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

548 &
__ÿnûl_ty³
); 
	}
}

549 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

559 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

561 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

565 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

566 
__şäame
.
	`__£tdo™
 (
execu‹
); \

567 } 0)

	)

569 #ifdeà
__USE_GNU


573 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

575 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

576 
__şäame
.
	`__deãr
 ()

	)

581 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

582 
__şäame
.
	`__»¡Üe
 (); \

583 
__şäame
.
	`__£tdo™
 (
execu‹
); \

584 } 0)

	)

591 
__ex‹º_šlše
 

592 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

594 ià(
__äame
->
__do_™
)

595 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

596 
	}
}

605 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

607 
__±h»ad_ş—nup_äame
 
__şäame
 \

608 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

609 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

610 .
__do_™
 = 1 };

	)

614 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

615 
__şäame
.
__do_™
 = (
execu‹
); \

616 } 0)

	)

618 #ifdeà
__USE_GNU


622 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

624 
__±h»ad_ş—nup_äame
 
__şäame
 \

625 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

626 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

627 .
__do_™
 = 1 }; \

628 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

629 &
__şäame
.
__ÿnûl_ty³
)

	)

634 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

635 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

636 
__şäame
.
__do_™
 = (
execu‹
); \

637 } 0)

	)

648 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

650 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

651 (*
__ÿnûl_routše
è(*èğ(
routše
); \

652 *
__ÿnûl_¬g
 = (
¬g
); \

653 
nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

654 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

655 ià(
	`__butš_ex³ù
 (
nÙ_fœ¡_ÿÎ
, 0)) \

657 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

658 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

662 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

663 dØ{

	)

664 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

665 
__ş—nup_fù_©Œibu‹
;

669 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

672 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

673 ià(
execu‹
) \

674 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

675 } 0)

	)

676 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

677 
__ş—nup_fù_©Œibu‹
;

679 #ifdeà
__USE_GNU


683 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

685 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

686 (*
__ÿnûl_routše
è(*èğ(
routše
); \

687 *
__ÿnûl_¬g
 = (
¬g
); \

688 
nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

689 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

690 ià(
	`__butš_ex³ù
 (
nÙ_fœ¡_ÿÎ
, 0)) \

692 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

693 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

697 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

698 dØ{

	)

699 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

700 
__ş—nup_fù_©Œibu‹
;

705 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

708 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

709 ià(
execu‹
) \

710 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

711 
	}
} 0)

	)

712 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

713 
__ş—nup_fù_©Œibu‹
;

717 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

718 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

719 #iâdeà
SHARED


720 
	`__©Œibu‹__
 ((
__w—k__
))

726 
__jmp_buf_g
;

727 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROW
;

733 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

734 
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

735 
__THROW
 
	`__nÚnuÎ
 ((1));

738 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

739 
__THROW
 
	`__nÚnuÎ
 ((1));

742 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

743 
__THROW
 
	`__nÚnuÎ
 ((1));

746 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

747 
__THROW
 
	`__nÚnuÎ
 ((1));

749 #ifdeà
__USE_XOPEN2K


751 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

752 
__cÚ¡
 
time¥ec
 *
__»¡riù


753 
__ab¡ime
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

757 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

758 
__THROW
 
	`__nÚnuÎ
 ((1));

762 
	$±h»ad_mu‹x_g‘´ioûšg
 (
__cÚ¡
 
±h»ad_mu‹x_t
 *

763 
__»¡riù
 
__mu‹x
,

764 *
__»¡riù
 
__´ioûšg
)

765 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

769 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

770 
__´ioûšg
,

771 *
__»¡riù
 
__Şd_ûšg
)

772 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

775 #ifdeà
__USE_XOPEN2K8


777 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

778 
__THROW
 
	`__nÚnuÎ
 ((1));

779 #ifdeà
__USE_GNU


780 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

781 
__THROW
 
	`__nÚnuÎ
 ((1));

790 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

791 
__THROW
 
	`__nÚnuÎ
 ((1));

794 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

795 
__THROW
 
	`__nÚnuÎ
 ((1));

798 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

799 
__»¡riù
 
__©Œ
,

800 *
__»¡riù
 
__psh¬ed
)

801 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

804 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

805 
__psh¬ed
)

806 
__THROW
 
	`__nÚnuÎ
 ((1));

808 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


810 
	$±h»ad_mu‹x©Œ_g‘ty³
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


811 
__©Œ
, *
__»¡riù
 
__kšd
)

812 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

817 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

818 
__THROW
 
	`__nÚnuÎ
 ((1));

822 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

823 
__»¡riù
 
__©Œ
,

824 *
__»¡riù
 
__´ÙocŞ
)

825 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

829 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

830 
__´ÙocŞ
)

831 
__THROW
 
	`__nÚnuÎ
 ((1));

834 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

835 
__»¡riù
 
__©Œ
,

836 *
__»¡riù
 
__´ioûšg
)

837 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

840 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

841 
__´ioûšg
)

842 
__THROW
 
	`__nÚnuÎ
 ((1));

844 #ifdeà
__USE_XOPEN2K


846 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

847 *
__robu¡Ãss
)

848 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

849 #ifdeà
__USE_GNU


850 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

851 *
__robu¡Ãss
)

852 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__robu¡Ãss
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

859 #ifdeà
__USE_GNU


860 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

861 
__robu¡Ãss
)

862 
__THROW
 
	`__nÚnuÎ
 ((1));

867 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


872 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

873 
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *
__»¡riù


874 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

877 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

878 
__THROW
 
	`__nÚnuÎ
 ((1));

881 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

882 
__THROW
 
	`__nÚnuÎ
 ((1));

885 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

886 
__THROW
 
	`__nÚnuÎ
 ((1));

888 #ifdeà
__USE_XOPEN2K


890 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

891 
__cÚ¡
 
time¥ec
 *
__»¡riù


892 
__ab¡ime
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

896 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

897 
__THROW
 
	`__nÚnuÎ
 ((1));

900 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

901 
__THROW
 
	`__nÚnuÎ
 ((1));

903 #ifdeà
__USE_XOPEN2K


905 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

906 
__cÚ¡
 
time¥ec
 *
__»¡riù


907 
__ab¡ime
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

911 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

912 
__THROW
 
	`__nÚnuÎ
 ((1));

918 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

919 
__THROW
 
	`__nÚnuÎ
 ((1));

922 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

923 
__THROW
 
	`__nÚnuÎ
 ((1));

926 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *

927 
__»¡riù
 
__©Œ
,

928 *
__»¡riù
 
__psh¬ed
)

929 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

932 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

933 
__psh¬ed
)

934 
__THROW
 
	`__nÚnuÎ
 ((1));

937 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *

938 
__»¡riù
 
__©Œ
,

939 *
__»¡riù
 
__´ef
)

940 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

943 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

944 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

952 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

953 
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *
__»¡riù


954 
__cÚd_©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

957 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

958 
__THROW
 
	`__nÚnuÎ
 ((1));

961 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

962 
__THROW
 
	`__nÚnuÎ
 ((1));

965 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

966 
__THROW
 
	`__nÚnuÎ
 ((1));

973 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

974 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

975 
	`__nÚnuÎ
 ((1, 2));

984 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

985 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

986 
__cÚ¡
 
time¥ec
 *
__»¡riù


987 
__ab¡ime
è
	`__nÚnuÎ
 ((1, 2, 3));

992 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

993 
__THROW
 
	`__nÚnuÎ
 ((1));

996 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

997 
__THROW
 
	`__nÚnuÎ
 ((1));

1000 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *

1001 
__»¡riù
 
__©Œ
,

1002 *
__»¡riù
 
__psh¬ed
)

1003 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1006 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1007 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1009 #ifdeà
__USE_XOPEN2K


1011 
	$±h»ad_cÚd©Œ_g‘şock
 (
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *

1012 
__»¡riù
 
__©Œ
,

1013 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1014 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1017 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1018 
__şockid_t
 
__şock_id
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1));

1023 #ifdeà
__USE_XOPEN2K


1028 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1029 
__THROW
 
	`__nÚnuÎ
 ((1));

1032 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1033 
__THROW
 
	`__nÚnuÎ
 ((1));

1036 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1037 
__THROW
 
	`__nÚnuÎ
 ((1));

1040 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1041 
__THROW
 
	`__nÚnuÎ
 ((1));

1044 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1045 
__THROW
 
	`__nÚnuÎ
 ((1));

1052 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1053 
__cÚ¡
 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1054 
__©Œ
, 
__couÁ
)

1055 
__THROW
 
	`__nÚnuÎ
 ((1));

1058 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1059 
__THROW
 
	`__nÚnuÎ
 ((1));

1062 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1063 
__THROW
 
	`__nÚnuÎ
 ((1));

1067 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1068 
__THROW
 
	`__nÚnuÎ
 ((1));

1071 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1072 
__THROW
 
	`__nÚnuÎ
 ((1));

1075 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_b¬r›¿‰r_t
 *

1076 
__»¡riù
 
__©Œ
,

1077 *
__»¡riù
 
__psh¬ed
)

1078 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1081 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1082 
__psh¬ed
)

1083 
__THROW
 
	`__nÚnuÎ
 ((1));

1095 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1096 (*
__de¡r_funùiÚ
) (*))

1097 
__THROW
 
	`__nÚnuÎ
 ((1));

1100 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1103 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1106 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1107 
__cÚ¡
 *
__poš‹r
è
__THROW
 ;

1110 #ifdeà
__USE_XOPEN2K


1112 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1113 
__şockid_t
 *
__şock_id
)

1114 
__THROW
 
	`__nÚnuÎ
 ((2));

1129 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1130 (*
__·»Á
) (),

1131 (*
__chd
è()è
__THROW
;

1134 #ifdeà
__USE_EXTERN_INLINES


1136 
__ex‹º_šlše
 

1137 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1139  
__th»ad1
 =ğ
__th»ad2
;

1140 
	}
}

1143 
	g__END_DECLS


	@/usr/include/wctype.h

24 #iâdeà
_WCTYPE_H


26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #iâdeà
__Ãed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__Ãed_wšt_t


	)

34 
	~<wch¬.h
>

38 #iâdeà
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #undeà
__Ãed_iswxxx


47 #iâdeà
__iswxxx_defšed


48 
	#__iswxxx_defšed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	twùy³_t
;

54 
	g__END_NAMESPACE_C99


56 #iâdeà
_ISwb™


61 
	~<’dŸn.h
>

62 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


63 
	#_ISwb™
(
b™
è(1 << (b™))

	)

65 
	#_ISwb™
(
b™
) \

66 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (è((1UL << (
b™
)è>> 24))))

	)

74 
	m__ISwuµ”
 = 0,

75 
	m__ISwlow”
 = 1,

76 
	m__ISw®pha
 = 2,

77 
	m__ISwdig™
 = 3,

78 
	m__ISwxdig™
 = 4,

79 
	m__ISw¥aû
 = 5,

80 
	m__ISw´št
 = 6,

81 
	m__ISwg¿ph
 = 7,

82 
	m__ISwbÏnk
 = 8,

83 
	m__ISwúŒl
 = 9,

84 
	m__ISwpunù
 = 10,

85 
	m__ISw®num
 = 11,

87 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

88 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

89 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

90 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

91 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

92 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

93 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

94 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

95 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

96 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

97 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

98 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

118 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

121 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

125 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

129 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

134 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

137 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

142 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

147 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

152 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

157 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

162 #ifdeà
__USE_ISOC99


163 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

172 
wùy³_t
 
	$wùy³
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

176 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__cÚ¡
 
	t__št32_t
 *
	twù¿ns_t
;

188 
__END_NAMESPACE_C99


189 #ifdeà
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

198 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifdeà
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
wù¿ns_t
 
	$wù¿ns
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

222 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifdeà
__USE_XOPEN2K8


227 
	~<xloÿË.h
>

231 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

237 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

240 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

244 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

248 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

253 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

256 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

261 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

266 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

271 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

276 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

281 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

285 
wùy³_t
 
	$wùy³_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

286 
__THROW
;

290 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

291 
__THROW
;

299 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

302 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

306 
wù¿ns_t
 
	$wù¿ns_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

307 
__THROW
;

310 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

311 
__loÿË_t
 
__loÿË
è
__THROW
;

315 
__END_DECLS


	@/usr/include/bits/setjmp.h

20 #iâdeà
_BITS_SETJMP_H


21 
	#_BITS_SETJMP_H
 1

	)

23 #ià!
defšed
 
_SETJMP_H
 && !defšed 
_PTHREAD_H


27 
	~<b™s/wÜdsize.h
>

29 #iâdeà
_ASM


31 #ià
__WORDSIZE
 == 64

32 
	t__jmp_buf
[8];

34 
	t__jmp_buf
[6];

	@/usr/include/sched.h

21 #iâdef 
_SCHED_H


22 
	#_SCHED_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 
	#__Ãed_size_t


	)

30 
	~<¡ddef.h
>

32 
	#__Ãed_time_t


	)

33 
	#__Ãed_time¥ec


	)

34 
	~<time.h
>

36 #iâdeà
__pid_t_defšed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

45 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

48 
__BEGIN_DECLS


51 
	$sched_£¬am
 (
__pid_t
 
__pid
, 
__cÚ¡
 
sched_·¿m
 *
__·¿m
)

52 
__THROW
;

55 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

58 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

59 
__cÚ¡
 
sched_·¿m
 *
__·¿m
è
__THROW
;

62 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

65 
	$sched_y›ld
 (è
__THROW
;

68 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

71 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

77 #ifdeà
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

81 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

82 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

83 
ıu£
)

	)

84 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

87 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

88 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

89 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
ıu£
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

94 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

101 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

103 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

113 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

114 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

118 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

119 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

122 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

123 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

126 
__END_DECLS


	@/usr/include/bits/sched.h

22 #iâdeà
__Ãed_sched·¿m


24 #iâdeà
_SCHED_H


30 
	#SCHED_OTHER
 0

	)

31 
	#SCHED_FIFO
 1

	)

32 
	#SCHED_RR
 2

	)

33 #ifdeà
__USE_GNU


34 
	#SCHED_BATCH
 3

	)

35 
	#SCHED_IDLE
 5

	)

37 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

40 #ifdeà
__USE_MISC


42 
	#CSIGNAL
 0x000000fà

	)

43 
	#CLONE_VM
 0x00000100

	)

44 
	#CLONE_FS
 0x00000200

	)

45 
	#CLONE_FILES
 0x00000400

	)

46 
	#CLONE_SIGHAND
 0x00000800

	)

47 
	#CLONE_PTRACE
 0x00002000

	)

48 
	#CLONE_VFORK
 0x00004000

	)

50 
	#CLONE_PARENT
 0x00008000

	)

52 
	#CLONE_THREAD
 0x00010000

	)

53 
	#CLONE_NEWNS
 0x00020000

	)

54 
	#CLONE_SYSVSEM
 0x00040000

	)

55 
	#CLONE_SETTLS
 0x00080000

	)

56 
	#CLONE_PARENT_SETTID
 0x00100000

	)

58 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

60 
	#CLONE_DETACHED
 0x00400000

	)

61 
	#CLONE_UNTRACED
 0x00800000

	)

63 
	#CLONE_CHILD_SETTID
 0x01000000

	)

65 
	#CLONE_NEWUTS
 0x04000000

	)

66 
	#CLONE_NEWIPC
 0x08000000

	)

67 
	#CLONE_NEWUSER
 0x10000000

	)

68 
	#CLONE_NEWPID
 0x20000000

	)

69 
	#CLONE_NEWNET
 0x40000000

	)

70 
	#CLONE_IO
 0x80000000

	)

74 
	ssched_·¿m


76 
	m__sched_´iÜ™y
;

79 
	g__BEGIN_DECLS


81 #ifdeà
__USE_MISC


83 
şÚe
 ((*
__â
è(*
__¬g
), *
__chd_¡ack
,

84 
__æags
, *
__¬g
, ...è
__THROW
;

87 
	$unsh¬e
 (
__æags
è
__THROW
;

90 
	$sched_g‘ıu
 (è
__THROW
;

93 
__END_DECLS


97 #ià!
defšed
 
__defšed_sched·¿m
 \

98 && (
defšed
 
__Ãed_sched·¿m
 || defšed 
_SCHED_H
)

99 
	#__defšed_sched·¿m
 1

	)

101 
	s__sched_·¿m


103 
__sched_´iÜ™y
;

105 #undeà
__Ãed_sched·¿m


109 #ià
defšed
 
_SCHED_H
 && !defšed 
__ıu_£t_t_defšed


110 
	#__ıu_£t_t_defšed


	)

112 
	#__CPU_SETSIZE
 1024

	)

113 
	#__NCPUBITS
 (8 *  (
__ıu_mask
))

	)

116 
	t__ıu_mask
;

119 
	#__CPUELT
(
ıu
è((ıuè/ 
__NCPUBITS
)

	)

120 
	#__CPUMASK
(
ıu
è((
__ıu_mask
è1 << ((ıuè% 
__NCPUBITS
))

	)

125 
__ıu_mask
 
__b™s
[
__CPU_SETSIZE
 / 
__NCPUBITS
];

126 } 
	tıu_£t_t
;

129 #ià
	`__GNUC_PREREQ
 (2, 91)

130 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

131 dØ
	`__butš_mem£t
 (
ıu£
, '\0', 
£tsize
); 0)

	)

133 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

135 
size_t
 
__i
; \

136 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

137 
__ıu_mask
 *
__b™s
 = (
ıu£
)->__bits; \

138 
__i
 = 0; __˜< 
__imax
; ++__i) \

139 
__b™s
[
__i
] = 0; \

140 
	}
} 0)

	)

142 
	#__CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
) \

143 (
__ex‹nsiÚ__
 \

144 ({ 
size_t
 
__ıu
 = (
ıu
); \

145 
__ıu
 < 8 * (
£tsize
) \

146 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

147 |ğ
	`__CPUMASK
 (
__ıu
)) \

148 : 0; }))

	)

149 
	#__CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
) \

150 (
__ex‹nsiÚ__
 \

151 ({ 
size_t
 
__ıu
 = (
ıu
); \

152 
__ıu
 < 8 * (
£tsize
) \

153 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

154 &ğ~
	`__CPUMASK
 (
__ıu
)) \

155 : 0; }))

	)

156 
	#__CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
) \

157 (
__ex‹nsiÚ__
 \

158 ({ 
size_t
 
__ıu
 = (
ıu
); \

159 
__ıu
 < 8 * (
£tsize
) \

160 ? ((((
__cÚ¡
 
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

161 & 
	`__CPUMASK
 (
__ıu
))) != 0 \

162 : 0; }))

	)

164 
	#__CPU_COUNT_S
(
£tsize
, 
ıu£
) \

165 
	`__sched_ıucouÁ
 (
£tsize
, 
ıu£
)

	)

167 #ià
__GNUC_PREREQ
 (2, 91)

168 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

169 (
	`__butš_memcmp
 (
ıu£1
, 
ıu£2
, 
£tsize
è=ğ0)

	)

171 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

172 (
__ex‹nsiÚ__
 \

173 ({ 
__cÚ¡
 
__ıu_mask
 *
__¬r1
 = (
ıu£1
)->
__b™s
; \

174 
__cÚ¡
 
__ıu_mask
 *
__¬r2
 = (
ıu£2
)->
__b™s
; \

175 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

176 
size_t
 
__i
; \

177 
__i
 = 0; __˜< 
__imax
; ++__i) \

178 ià(
__b™s
[
__i
] != __bits[__i]) \

180 
__i
 =ğ
__imax
; }))

	)

183 
	#__CPU_OP_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, 
İ
) \

184 (
__ex‹nsiÚ__
 \

185 ({ 
ıu_£t_t
 *
__de¡
 = (
de¡£t
); \

186 
__cÚ¡
 
__ıu_mask
 *
__¬r1
 = (
¤c£t1
)->
__b™s
; \

187 
__cÚ¡
 
__ıu_mask
 *
__¬r2
 = (
¤c£t2
)->
__b™s
; \

188 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

189 
size_t
 
__i
; \

190 
__i
 = 0; __˜< 
__imax
; ++__i) \

191 ((
__ıu_mask
 *è
__de¡
->
__b™s
)[
__i
] = 
__¬r1
[__i] 
İ
 
__¬r2
[__i]; \

192 
__de¡
; }))

	)

194 
	#__CPU_ALLOC_SIZE
(
couÁ
) \

195 ((((
couÁ
è+ 
__NCPUBITS
 - 1è/ __NCPUBITSè*  (
__ıu_mask
))

	)

196 
	#__CPU_ALLOC
(
couÁ
è
	`__sched_ıu®loc
 (couÁ)

	)

197 
	#__CPU_FREE
(
ıu£t
è
	`__sched_ıuä“
 (ıu£t)

	)

199 
__BEGIN_DECLS


201 
	$__sched_ıucouÁ
 (
size_t
 
__£tsize
, cÚ¡ 
ıu_£t_t
 *
__£
)

202 
__THROW
;

203 
ıu_£t_t
 *
	$__sched_ıu®loc
 (
size_t
 
__couÁ
è
__THROW
 
__wur
;

204 
	$__sched_ıuä“
 (
ıu_£t_t
 *
__£t
è
__THROW
;

206 
__END_DECLS


	@
1
.
1
/usr/include
168
3496
bitmap.c
bunzip2.c
compat/domain.c
compat/grant_table.c
compat/kernel.c
compat/memory.c
compat/multicall.c
compat/schedule.c
compat/tmem_xen.c
compat/xenoprof.c
compat/xlat.c
cpu.c
cpupool.c
decompress.c
decompress.h
domain.c
domctl.c
estate-driver.c
event_channel.c
gdbstub.c
grant_table.c
heterovisor.c
hvm/save.c
inflate.c
kernel.c
kexec.c
keyhandler.c
lib.c
libelf/libelf-dominfo.c
libelf/libelf-loader.c
libelf/libelf-private.h
libelf/libelf-relocate.c
libelf/libelf-tools.c
lzo.c
memory.c
multicall.c
myperfmon.c
notifier.c
page_alloc.c
perfc.c
preempt.c
radix-tree.c
rangeset.c
rbtree.c
rcupdate.c
sched_arinc653.c
sched_credit.c
sched_credit2.c
sched_sedf.c
schedule.c
shutdown.c
softirq.c
sort.c
spinlock.c
stop_machine.c
string.c
symbols-dummy.c
symbols.c
sysctl.c
tasklet.c
time.c
timer.c
tmem.c
tmem_xen.c
trace.c
unlzma.c
unlzo.c
version.c
vsprintf.c
wait.c
xencomm.c
xenoprof.c
xmalloc_tlsf.c
/usr/include/asm/byteorder.h
/usr/include/asm/types.h
/usr/include/byteswap.h
/usr/include/inttypes.h
/usr/include/linux/kernel.h
/usr/include/linux/time.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/sys/types.h
/usr/include/xen/elfnote.h
/usr/include/xen/kexec.h
/usr/include/xen/nmi.h
/usr/include/xen/sched.h
/usr/include/xen/tmem.h
/usr/include/xen/trace.h
/usr/include/xen/version.h
/usr/include/xen/xen.h
/usr/include/xen/xencomm.h
/usr/include/xenctrl.h
/usr/include/alloca.h
/usr/include/asm-generic/types.h
/usr/include/bits/byteswap.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/stdio-ldbl.h
/usr/include/bits/stdio.h
/usr/include/bits/stdio2.h
/usr/include/bits/stdio_lim.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/bits/sys_errlist.h
/usr/include/bits/types.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/linux/byteorder/little_endian.h
/usr/include/linux/types.h
/usr/include/stdint.h
/usr/include/sys/select.h
/usr/include/sys/sysmacros.h
/usr/include/time.h
/usr/include/xen/arch-x86/xen-mca.h
/usr/include/xen/domctl.h
/usr/include/xen/event_channel.h
/usr/include/xen/foreign/x86_32.h
/usr/include/xen/foreign/x86_64.h
/usr/include/xen/grant_table.h
/usr/include/xen/hvm/params.h
/usr/include/xen/memory.h
/usr/include/xen/physdev.h
/usr/include/xen/sysctl.h
/usr/include/xen/xsm/acm.h
/usr/include/xen/xsm/acm_ops.h
/usr/include/xen/xsm/flask_op.h
/usr/include/xentoollog.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/asm-generic/int-ll64.h
/usr/include/bits/endian.h
/usr/include/bits/libio-ldbl.h
/usr/include/bits/select.h
/usr/include/bits/sigset.h
/usr/include/bits/stdio-lock.h
/usr/include/bits/time.h
/usr/include/bits/typesizes.h
/usr/include/bits/wchar.h
/usr/include/bits/wordsize.h
/usr/include/ctype.h
/usr/include/gnu/stubs.h
/usr/include/linux/posix_types.h
/usr/include/linux/swab.h
/usr/include/sys/cdefs.h
/usr/include/asm/bitsperlong.h
/usr/include/asm/posix_types.h
/usr/include/asm/swab.h
/usr/include/bits/libc-lock.h
/usr/include/gconv.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/linux/stddef.h
/usr/include/wchar.h
/usr/include/asm-generic/bitsperlong.h
/usr/include/bits/wchar-ldbl.h
/usr/include/bits/wchar2.h
/usr/include/pthread.h
/usr/include/wctype.h
/usr/include/bits/setjmp.h
/usr/include/sched.h
/usr/include/bits/sched.h
